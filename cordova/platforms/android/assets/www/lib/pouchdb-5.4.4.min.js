!function(c){if("object"==typeof exports&&"undefined"!=typeof module){module.exports=c()}else{if("function"==typeof define&&define.amd){define([],c)}else{var d;d="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,d.PouchDB=c()}}}(function(){var c;return function d(e,a,i){function b(n,h){if(!a[n]){if(!e[n]){var j="function"==typeof require&&require;if(!h&&j){return j(n,!0)}if(k){return k(n,!0)}var f=new Error("Cannot find module '"+n+"'");throw f.code="MODULE_NOT_FOUND",f}var g=a[n]={exports:{}};e[n][0].call(g.exports,function(q){var m=e[n][1][q];return b(m?m:q)},g,g.exports,d,e,a,i)}return a[n].exports}for(var k="function"==typeof require&&require,l=0;l<i.length;l++){b(i[l])}return b}({1:[function(e,n,a){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function b(f){return"function"==typeof f}function o(f){return"number"==typeof f}function p(f){return"object"==typeof f&&null!==f}function m(f){return void 0===f}n.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(f){if(!o(f)||0>f||isNaN(f)){throw TypeError("n must be a positive number")}return this._maxListeners=f,this},i.prototype.emit=function(j){var l,g,k,r,f,h;if(this._events||(this._events={}),"error"===j&&(!this._events.error||p(this._events.error)&&!this._events.error.length)){if(l=arguments[1],l instanceof Error){throw l}throw TypeError('Uncaught, unspecified "error" event.')}if(g=this._events[j],m(g)){return !1}if(b(g)){switch(arguments.length){case 1:g.call(this);break;case 2:g.call(this,arguments[1]);break;case 3:g.call(this,arguments[1],arguments[2]);break;default:r=Array.prototype.slice.call(arguments,1),g.apply(this,r)}}else{if(p(g)){for(r=Array.prototype.slice.call(arguments,1),h=g.slice(),k=h.length,f=0;k>f;f++){h[f].apply(this,r)}}}return !0},i.prototype.addListener=function(f,g){var h;if(!b(g)){throw TypeError("listener must be a function")}return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",f,b(g.listener)?g.listener:g),this._events[f]?p(this._events[f])?this._events[f].push(g):this._events[f]=[this._events[f],g]:this._events[f]=g,p(this._events[f])&&!this._events[f].warned&&(h=m(this._maxListeners)?i.defaultMaxListeners:this._maxListeners,h&&h>0&&this._events[f].length>h&&(this._events[f].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[f].length),"function"==typeof console.trace&&console.trace())),this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(j,g){function h(){this.removeListener(j,h),f||(f=!0,g.apply(this,arguments))}if(!b(g)){throw TypeError("listener must be a function")}var f=!1;return h.listener=g,this.on(j,h),this},i.prototype.removeListener=function(h,l){var g,j,f,k;if(!b(l)){throw TypeError("listener must be a function")}if(!this._events||!this._events[h]){return this}if(g=this._events[h],f=g.length,j=-1,g===l||b(g.listener)&&g.listener===l){delete this._events[h],this._events.removeListener&&this.emit("removeListener",h,l)}else{if(p(g)){for(k=f;k-->0;){if(g[k]===l||g[k].listener&&g[k].listener===l){j=k;break}}if(0>j){return this}1===g.length?(g.length=0,delete this._events[h]):g.splice(j,1),this._events.removeListener&&this.emit("removeListener",h,l)}}return this},i.prototype.removeAllListeners=function(f){var g,h;if(!this._events){return this}if(!this._events.removeListener){return 0===arguments.length?this._events={}:this._events[f]&&delete this._events[f],this}if(0===arguments.length){for(g in this._events){"removeListener"!==g&&this.removeAllListeners(g)}return this.removeAllListeners("removeListener"),this._events={},this}if(h=this._events[f],b(h)){this.removeListener(f,h)}else{if(h){for(;h.length;){this.removeListener(f,h[h.length-1])}}}return delete this._events[f],this},i.prototype.listeners=function(f){var g;return g=this._events&&this._events[f]?b(this._events[f])?[this._events[f]]:this._events[f].slice():[]},i.prototype.listenerCount=function(f){if(this._events){var g=this._events[f];if(b(g)){return 1}if(g){return g.length}}return 0},i.listenerCount=function(f,g){return f.listenerCount(g)}},{}],2:[function(u,e,l){function o(){t&&D&&(t=!1,D.length?i=D.concat(i):a=-1,i.length&&n())}function n(){if(!t){var g=b(o);t=!0;for(var j=i.length;j;){for(D=i,i=[];++a<j;){D&&D[a].run()}a=-1,j=i.length}D=null,t=!1,h(g)}}function f(g,j){this.fun=g,this.array=j}function r(){}var b,h,s=e.exports={};!function(){try{b=setTimeout}catch(g){b=function(){throw new Error("setTimeout is not defined")}}try{h=clearTimeout}catch(g){h=function(){throw new Error("clearTimeout is not defined")}}}();var D,i=[],t=!1,a=-1;s.nextTick=function(j){var k=new Array(arguments.length-1);if(arguments.length>1){for(var g=1;g<arguments.length;g++){k[g-1]=arguments[g]}}i.push(new f(j,k)),1!==i.length||t||b(n,0)},f.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=r,s.addListener=r,s.once=r,s.off=r,s.removeListener=r,s.removeAllListeners=r,s.emit=r,s.binding=function(g){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(g){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}},{}],3:[function(b,e,a){(function(fV,gf){function fY(t){return t&&"object"==typeof t&&"default" in t?t["default"]:t}function fn(t){return t instanceof ArrayBuffer||"undefined"!=typeof Blob&&t instanceof Blob}function ee(aa){if("function"==typeof aa.slice){return aa.slice(0)}var ac=new ArrayBuffer(aa.byteLength),t=new Uint8Array(ac),ab=new Uint8Array(aa);return t.set(ab),ac}function L(aa){if(aa instanceof ArrayBuffer){return ee(aa)}var ab=aa.size,t=aa.type;return"function"==typeof aa.slice?aa.slice(0,ab,t):aa.webkitSlice(0,ab,t)}function P(aa){var ab=Object.getPrototypeOf(aa);if(null===ab){return !0}var t=ab.constructor;return"function"==typeof t&&t instanceof t&&g4.call(t)==hE}function es(ab){var ad,t,ac;if(!ab||"object"!=typeof ab){return ab}if(Array.isArray(ab)){for(ad=[],t=0,ac=ab.length;ac>t;t++){ad[t]=es(ab[t])}return ad}if(ab instanceof Date){return ab.toISOString()}if(fn(ab)){return L(ab)}if(!P(ab)){return ab}ad={};for(t in ab){if(Object.prototype.hasOwnProperty.call(ab,t)){var aa=es(ab[t]);"undefined"!=typeof aa&&(ad[t]=aa)}}return ad}function fa(t){var aa=!1;return g0(function(ab){if(aa){throw new Error("once called more than once")}aa=!0,t.apply(this,ab)})}function fx(t){return g0(function(ac){ac=es(ac);var ab,aa=this,ad="function"==typeof ac[ac.length-1]?ac.pop():!1;ad&&(ab=function(ah,ag){fV.nextTick(function(){ad(ah,ag)})});var af=new iQ(function(ag,ah){var ak;try{var al=fa(function(ap,am){ap?ah(ap):ag(am)});ac.push(al),ak=t.apply(aa,ac),ak&&"function"==typeof ak.then&&ag(ak)}catch(aj){ah(aj)}});return ab&&af.then(function(ag){ab(null,ag)},ab),af})}function ev(aa,ab){function t(ac,af,ah){if(h0.enabled){for(var ad=[ac._db_name,af],aj=0;aj<ah.length-1;aj++){ad.push(ah[aj])}h0.apply(null,ad);var ag=ah[ah.length-1];ah[ah.length-1]=function(ak,am){var al=[ac._db_name,af];al=al.concat(ak?["error",ak]:["success",am]),h0.apply(null,al),ag(ak,am)}}}return fx(g0(function(ad){if(this._closed){return iQ.reject(new Error("database is closed"))}if(this._destroyed){return iQ.reject(new Error("database is destroyed"))}var ac=this;return t(ac,aa,ad),this.taskqueue.isReady?ab.apply(this,ad):new iQ(function(ag,af){ac.taskqueue.addTask(function(ah){ah?af(ah):ag(ac[aa].apply(ac,ad))})})}))}function fi(ab,ad){for(var t={},ac=0,aa=ad.length;aa>ac;ac++){var af=ad[ac];af in ab&&(t[af]=ab[af])}return t}function gb(t){return t}function Q(t){return[{ok:t}]}function Y(ab,aa,aj){function al(){var av=[];au.forEach(function(aw){aw.docs.forEach(function(ax){av.push({id:aw.id,docs:[ax]})})}),aj(null,{results:av})}function ak(){++ah===ac&&al()}function ag(av,aw,ax){au[av]={id:aw,docs:ax},ak()}function am(){if(!(af>=ap.length)){var av=Math.min(af+hd,ap.length),aw=ap.slice(af,av);t(aw,af),af+=aw.length}}function t(av,aw){av.forEach(function(ax,ay){var aB=aw+ay,aC=aq[ax],aA=fi(aC[0],["atts_since","attachments"]);aA.open_revs=aC.map(function(aD){return aD.rev}),aA.open_revs=aA.open_revs.filter(gb);var az=gb;0===aA.open_revs.length&&(delete aA.open_revs,az=Q),["revs","attachments","binary","ajax"].forEach(function(aD){aD in aa&&(aA[aD]=aa[aD])}),ab.get(ax,aA,function(aD,aF){var aE;aE=aD?[{error:aD}]:az(aF),ag(aB,ax,aE),am()})})}var ad=aa.docs,aq={};ad.forEach(function(av){av.id in aq?aq[av.id].push(av):aq[av.id]=[av]});var ac=Object.keys(aq).length,ah=0,au=new Array(ac),ap=Object.keys(aq),af=0;am()}function gN(){return"undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage&&"undefined"!=typeof chrome.storage.local}function fS(){return et}function ff(t){gN()?chrome.storage.onChanged.addListener(function(aa){null!=aa.db_name&&t.emit(aa.dbName.newValue)}):fS()&&("undefined"!=typeof addEventListener?addEventListener("storage",function(aa){t.emit(aa.key)}):window.attachEvent("storage",function(aa){t.emit(aa.key)}))}function en(){K.EventEmitter.call(this),this._listeners={},ff(this)}function S(t){if("undefined"!==console&&t in console){var aa=Array.prototype.slice.call(arguments,1);console[t].apply(console,aa)}}function de(ab,ad){var t=600000;ab=parseInt(ab,10)||0,ad=parseInt(ad,10),ad!==ad||ab>=ad?ad=(ab||1)<<1:ad+=1,ad>t&&(ab=t>>1,ad=t);var ac=Math.random(),aa=ad-ab;return ~~(aa*ac+ab)}function J(t){var aa=0;return t||(aa=2000),de(t,aa)}function fv(t,aa){S("info","The above "+t+" is totally normal. "+aa)}function ge(t){Error.call(this,t.reason),this.status=t.status,this.name=t.error,this.message=t.reason,this.error=!0}function U(aa,ac,t){function ab(af){for(var ad in aa){"function"!=typeof aa[ad]&&(this[ad]=aa[ad])}void 0!==t&&(this.name=t),void 0!==af&&(this.reason=af)}return ab.prototype=ge.prototype,new ab(ac)}function br(ab){var ad,t,ac,aa,af;return t=ab.error===!0&&"string"==typeof ab.name?ab.name:ab.error,af=ab.reason,ac=gR("name",t,af),ab.missing||"missing"===af||"deleted"===af||"not_found"===t?ac=y:"doc_validation"===t?(ac=be,aa=af):"bad_request"===t&&ac.message!==af&&(ac=fu),ac||(ac=gR("status",ab.status,af)||iN),ad=U(ac,af,t),aa&&(ad.message=aa),ab.id&&(ad.id=ab.id),ab.status&&(ad.status=ab.status),ab.missing&&(ad.missing=ab.missing),ad}function go(ab,ad,t){try{return !ab(ad,t)}catch(ac){var aa="Filter function threw: "+ac.toString();return U(fu,aa)}}function D(aa){var ab={},t=aa.filter&&"function"==typeof aa.filter;return ab.query=aa.query_params,function(ad){ad.doc||(ad.doc={});var ac=t&&go(aa.filter,ad.doc,ab);if("object"==typeof ac){return ac}if(ac){return !1}if(aa.include_docs){if(!aa.attachments){for(var af in ad.doc._attachments){ad.doc._attachments.hasOwnProperty(af)&&(ad.doc._attachments[af].stub=!0)}}}else{delete ad.doc}return !0}}function fp(aa){for(var ac=[],t=0,ab=aa.length;ab>t;t++){ac=ac.concat(aa[t])}return ac}function ci(t){var aa;if(t?"string"!=typeof t?aa=U(iF):/^_/.test(t)&&!/^_(design|local)/.test(t)&&(aa=U(h)):aa=U(gT),aa){throw aa}}function z(t,aa){return"listenerCount" in t?t.listenerCount(aa):K.EventEmitter.listenerCount(t,aa)}function u(t){if(!t){return null}var aa=t.split("/");return 2===aa.length?aa:1===aa.length?[t,t]:null}function cr(t){var aa=u(t);return aa?aa.join("/"):null}function I(aa){for(var ac=at.exec(aa),ag={},ab=14;ab--;){var t=hg[ab],ad=ac[ab]||"",af=-1!==["user","password"].indexOf(t);ag[t]=af?decodeURIComponent(ad):ad}return ag[ji]={},ag[hg[12]].replace(fy,function(aj,ah,ak){ah&&(ag[ji][ah]=ak)}),ag}function C(aa,ab,t){return new iQ(function(ad,ac){aa.get(ab,function(aj,ag){if(aj){if(404!==aj.status){return ac(aj)}ag={}}var ah=ag._rev,af=t(ag);return af?(af._id=ab,af._rev=ah,void ad(ce(aa,af,t))):ad({updated:!1,rev:ah})})})}function ce(aa,ab,t){return aa.put(ab).then(function(ac){return{updated:!0,rev:ac.rev}},function(ac){if(409!==ac.status){throw ac}return C(aa,ab._id,t)})}function A(t){return 0|Math.random()*t}function di(aa,ac){ac=ac||h1.length;var t="",ab=-1;if(aa){for(;++ab<aa;){t+=h1[A(ac)]}return t}for(;++ab<36;){switch(ab){case 8:case 13:case 18:case 23:t+="-";break;case 19:t+=h1[3&A(16)|8];break;default:t+=h1[A(16)]}}return t}function gs(t){for(var aj,af,ah,ag,ac=t.rev_tree.slice();ag=ac.pop();){var al=ag.ids,ab=al[2],ak=ag.pos;if(ab.length){for(var am=0,aa=ab.length;aa>am;am++){ac.push({pos:ak+1,ids:ab[am]})}}else{var ad=!!al[1].deleted,ap=al[0];aj&&!(ah!==ad?ah:af!==ak?ak>af:ap>aj)||(aj=ap,af=ak,ah=ad)}}return af+"-"+aj}function F(ac,ak){for(var af,ah=ac.slice();af=ah.pop();){for(var ag=af.pos,ad=af.ids,aa=ad[2],aj=ak(0===aa.length,ag,ad[0],af.ctx,ad[1]),t=0,ab=aa.length;ab>t;t++){ah.push({pos:ag+1,ids:aa[t],ctx:aj})}}}function s(t,aa){return t.pos-aa.pos}function x(aa){var ac=[];F(aa,function(ad,ah,af,aj,ag){ad&&ac.push({rev:ah+"-"+af,pos:ah,opts:ag})}),ac.sort(s).reverse();for(var t=0,ab=ac.length;ab>t;t++){delete ac[t].pos}return ac}function w(aa){for(var ac=gs(aa),ag=x(aa.rev_tree),ab=[],t=0,ad=ag.length;ad>t;t++){var af=ag[t];af.rev===ac||af.opts.deleted||ab.push(af.rev)}return ab}function gz(t){var aa=[];return F(t.rev_tree,function(ac,ag,ad,ab,af){"available"!==af.status||ac||(aa.push(ag+"-"+ad),af.status="missing")}),aa}function ae(t){for(var aj,af=[],ah=t.slice();aj=ah.pop();){var ag=aj.pos,ac=aj.ids,al=ac[0],ab=ac[1],ak=ac[2],am=0===ak.length,aa=aj.history?aj.history.slice():[];aa.push({id:al,opts:ab}),am&&af.push({pos:ag+1-aa.length,ids:aa});for(var ad=0,ap=ak.length;ap>ad;ad++){ah.push({pos:ag+1,ids:ak[ad],history:aa})}}return af.reverse()}function gC(t,aa){return t.pos-aa.pos}function q(ab,ad,t){for(var ac,aa=0,af=ab.length;af>aa;){ac=aa+af>>>1,t(ab[ac],ad)<0?aa=ac+1:af=ac}return aa}function gw(aa,ac,t){var ab=q(aa,ac,t);aa.splice(ab,0,ac)}function H(t,ac){for(var ag,aa,ah=ac,ad=t.length;ad>ah;ah++){var af=t[ah],ab=[af.id,af.opts,[]];aa?(aa[2].push(ab),aa=ab):ag=aa=ab}return ag}function R(t,aa){return t[0]<aa[0]?-1:1}function gE(ac,ak){for(var af=[{tree1:ac,tree2:ak}],ah=!1;af.length>0;){var ag=af.pop(),ad=ag.tree1,aa=ag.tree2;(ad[1].status||aa[1].status)&&(ad[1].status="available"===ad[1].status||"available"===aa[1].status?"available":"missing");for(var aj=0;aj<aa[2].length;aj++){if(ad[2][0]){for(var t=!1,ab=0;ab<ad[2].length;ab++){ad[2][ab][0]===aa[2][aj][0]&&(af.push({tree1:ad[2][ab],tree2:aa[2][aj]}),t=!0)}t||(ah="new_branch",gw(ad[2],aa[2][aj],R))}else{ah="new_leaf",ad[2][0]=aa[2][aj]}}}return{conflicts:ah,tree:ac}}function gJ(af,ak,au){var ad,av=[],am=!1,aa=!1;if(!af.length){return{tree:[ak],conflicts:"new_leaf"}}for(var ah=0,aw=af.length;aw>ah;ah++){var ab=af[ah];if(ab.pos===ak.pos&&ab.ids[0]===ak.ids[0]){ad=gE(ab.ids,ak.ids),av.push({pos:ab.pos,ids:ad.tree}),am=am||ad.conflicts,aa=!0}else{if(au!==!0){var ag=ab.pos<ak.pos?ab:ak,ap=ab.pos<ak.pos?ak:ab,ac=ap.pos-ag.pos,al=[],ax=[];for(ax.push({ids:ag.ids,diff:ac,parent:null,parentIdx:null});ax.length>0;){var ay=ax.pop();if(0!==ay.diff){for(var az=ay.ids[2],t=0,aq=az.length;aq>t;t++){ax.push({ids:az[t],diff:ay.diff-1,parent:ay.ids,parentIdx:t})}}else{ay.ids[0]===ap.ids[0]&&al.push(ay)}}var aj=al[0];aj?(ad=gE(aj.ids,ap.ids),aj.parent[2][aj.parentIdx]=ad.tree,av.push({pos:ag.pos,ids:ag.ids}),am=am||ad.conflicts,aa=!0):av.push(ab)}else{av.push(ab)}}}return aa||av.push(ak),av.sort(gC),{tree:av,conflicts:am||"internal_node"}}function dn(t,aj){for(var af,ah=ae(t),ag={},ac=0,al=ah.length;al>ac;ac++){for(var ab=ah[ac],ak=ab.ids,am=Math.max(0,ak.length-aj),aa={pos:ab.pos+am,ids:H(ak,am)},ad=0;am>ad;ad++){var ap=ab.pos+ad+"-"+ak[ad].id;ag[ap]=!0}af=af?gJ(af,aa,!0).tree:[aa]}return F(af,function(aq,au,av){delete ag[au+"-"+av]}),{tree:af,revs:Object.keys(ag)}}function j(ab,ad,t){var ac=gJ(ab,ad),aa=dn(ac.tree,t);return{tree:aa.tree,stemmedRevs:aa.revs,conflicts:ac.conflicts}}function gl(ac,ak){for(var af,ah=ac.slice(),ag=ak.split("-"),ad=parseInt(ag[0],10),aa=ag[1];af=ah.pop();){if(af.pos===ad&&af.ids[0]===aa){return !0}for(var aj=af.ids[2],t=0,ab=aj.length;ab>t;t++){ah.push({pos:af.pos+1,ids:aj[t]})}}return !1}function iV(t){return t.ids}function ha(ab,ad){ad||(ad=gs(ab));for(var t,ac=ad.substring(ad.indexOf("-")+1),aa=ab.rev_tree.map(iV);t=aa.pop();){if(t[0]===ac){return !!t[1].deleted}aa=aa.concat(t[2])}}function fc(t){return/^_local/.test(t)}function T(t){return ij("return "+t+";",{})}function hL(t){return new Function("doc",["var emitted = false;","var emit = function (a, b) {","  emitted = true;","};","var view = "+t+";","view(doc);","if (emitted) {","  return true;","}"].join("\n"))}function jd(aa,ab){try{aa.emit("change",ab)}catch(t){S("error",'Error in .on("change", function):',t)}}function ez(aa,ac,ag){function ab(){t.cancel()}K.EventEmitter.call(this);var t=this;this.db=aa,ac=ac?es(ac):{};var ad=ac.complete=fa(function(ah,aj){ah?z(t,"error")>0&&t.emit("error",ah):t.emit("complete",aj),t.removeAllListeners(),aa.removeListener("destroyed",ab)});ag&&(t.on("complete",function(ah){ag(null,ah)}),t.on("error",ag)),aa.once("destroyed",ab),ac.onChange=function(ah){ac.isCancelled||(jd(t,ah),t.startSeq&&t.startSeq<=ah.seq&&(t.startSeq=!1))};var af=new iQ(function(ah,aj){ac.complete=function(al,ak){al?aj(al):ah(ak)}});t.once("cancel",function(){aa.removeListener("destroyed",ab),ac.complete(null,{status:"cancelled"})}),this.then=af.then.bind(af),this["catch"]=af["catch"].bind(af),this.then(function(ah){ad(null,ah)},ad),aa.taskqueue.isReady?t.doChanges(ac):aa.taskqueue.addTask(function(){t.isCancelled?t.emit("cancel"):t.doChanges(ac)})}function gk(ab,ad,t){var ac=[{rev:ab._rev}];"all_docs"===t.style&&(ac=x(ad.rev_tree).map(function(af){return{rev:af.rev}}));var aa={id:ad.id,changes:ac,doc:ab};return ha(ad,ab._rev)&&(aa.deleted=!0),t.conflicts&&(aa.doc._conflicts=w(ad),aa.doc._conflicts.length||delete aa.doc._conflicts),aa}function hv(t,aa){return aa>t?-1:t>aa?1:0}function a0(aa,ab){for(var t=0;t<aa.length;t++){if(ab(aa[t],t)===!0){return aa[t]}}}function g5(t){return function(ab,aa){ab||aa[0]&&aa[0].error?t(ab||aa[0]):t(null,aa.length?aa[0]:aa)}}function jq(ab){for(var ad=0;ad<ab.length;ad++){var t=ab[ad];if(t._deleted){delete t._attachments}else{if(t._attachments){for(var ac=Object.keys(t._attachments),aa=0;aa<ac.length;aa++){var af=ac[aa];t._attachments[af]=fi(t._attachments[af],["data","digest","content_type","length","revpos","stub"])}}}}}function jv(ab,ad){var t=hv(ab._id,ad._id);if(0!==t){return t}var ac=ab._revisions?ab._revisions.start:0,aa=ad._revisions?ad._revisions.start:0;return hv(ac,aa)}function fg(aa){var ab={},t=[];return F(aa,function(ac,ad,ah,af){var ag=ad+"-"+ah;return ac&&(ab[ag]=0),void 0!==af&&t.push({from:af,to:ag}),ag}),t.reverse(),t.forEach(function(ac){void 0===ab[ac.from]?ab[ac.from]=1+ab[ac.to]:ab[ac.from]=Math.min(ab[ac.from],1+ab[ac.to])}),ab}function iA(ab,ad,t){var ac="limit" in ad?ad.keys.slice(ad.skip,ad.limit+ad.skip):ad.skip>0?ad.keys.slice(ad.skip):ad.keys;if(ad.descending&&ac.reverse(),!ac.length){return ab._allDocs({limit:0},t)}var aa={offset:ad.skip};return iQ.all(ac.map(function(af){var ag=iv.extend({key:af,deleted:"ok"},ad);return["limit","skip","keys"].forEach(function(ah){delete ag[ah]}),new iQ(function(ah,aj){ab._allDocs(ag,function(ak,al){return ak?aj(ak):(aa.total_rows=al.total_rows,void ah(al.rows[0]||{key:af,error:"not_found"}))})})})).then(function(af){return aa.rows=af,aa})}function hT(aa){var ac=aa._compactionQueue[0],ab=ac.opts,t=ac.callback;aa.get("_local/compaction")["catch"](function(){return !1}).then(function(ad){ad&&ad.last_seq&&(ab.last_seq=ad.last_seq),aa._compact(ab,function(ag,af){ag?t(ag):t(null,af),fV.nextTick(function(){aa._compactionQueue.shift(),aa._compactionQueue.length&&hT(aa)})})})}function gM(t){return"_"===t.charAt(0)?t+"is not a valid attachment name, attachment names cannot start with '_'":!1}function dr(){K.EventEmitter.call(this)}function ia(){this.isReady=!1,this.failed=!1,this.queue=[]}function jB(t){t&&gf.debug&&S("error",t)}function hs(aa,ac){function ag(){ad.emit("destroyed",t)}function ab(){aa.removeListener("destroyed",ag),aa.emit("destroyed",aa)}var t=ac.originalName,ad=aa.constructor,af=ad._destructionListeners;aa.once("destroyed",ag),af.has(t)||af.set(t,[]),af.get(t).push(ab)}function iy(aa,ac,ag){if(!(this instanceof iy)){return new iy(aa,ac,ag)}var ab=this;if("function"!=typeof ac&&"undefined"!=typeof ac||(ag=ac,ac={}),aa&&"object"==typeof aa&&(ac=aa,aa=void 0),"undefined"==typeof ag){ag=jB}else{var t=ag;ag=function(){return S("warn","Using a callback for new PouchDB()is deprecated."),t.apply(null,arguments)}}aa=aa||ac.name,ac=es(ac),delete ac.name,this.__opts=ac;var ad=ag;ab.auto_compaction=ac.auto_compaction,ab.prefix=iy.prefix,dr.call(ab),ab.taskqueue=new ia;var af=new iQ(function(ah,ak){ag=function(ap,am){return ap?ak(ap):(delete am.then,void ah(am))},ac=es(ac);var al,aj;return function(){try{if("string"!=typeof aa){throw aj=new Error("Missing/invalid DB name"),aj.code=400,aj}var ap=(ac.prefix||"")+aa;if(al=iy.parseAdapter(ap,ac),ac.originalName=aa,ac.name=al.name,ac.adapter=ac.adapter||al.adapter,ab._adapter=ac.adapter,jz("pouchdb:adapter")("Picked adapter: "+ac.adapter),ab._db_name=aa,!iy.adapters[ac.adapter]){throw aj=new Error("Adapter is missing"),aj.code=404,aj}if(!iy.adapters[ac.adapter].valid()){throw aj=new Error("Invalid Adapter"),aj.code=404,aj}}catch(am){ab.taskqueue.fail(am)}}(),aj?ak(aj):(ab.adapter=ac.adapter,ab.replicate={},ab.replicate.from=function(aq,am,ap){return ab.constructor.replicate(aq,ab,am,ap)},ab.replicate.to=function(aq,am,ap){return ab.constructor.replicate(ab,aq,am,ap)},ab.sync=function(aq,am,ap){return ab.constructor.sync(ab,aq,am,ap)},ab.replicate.sync=ab.sync,void iy.adapters[ac.adapter].call(ab,ac,function(am){return am?(ab.taskqueue.fail(am),void ag(am)):(hs(ab,ac),ab.emit("created",ab),iy.emit("created",ac.originalName),ab.taskqueue.ready(ab),void ag(null,ab))}))});af.then(function(ah){ad(null,ah)},ad),ab.then=af.then.bind(af),ab["catch"]=af["catch"].bind(af)}function iD(t){Object.keys(K.EventEmitter.prototype).forEach(function(ab){"function"==typeof K.EventEmitter.prototype[ab]&&(t[ab]=jk[ab].bind(jk))});var aa=t._destructionListeners=new h8.Map;t.on("destroyed",function(ab){aa.get(ab).forEach(function(ac){ac()}),aa["delete"](ab)})}function iS(t){return t.reduce(function(aa,ab){return aa[ab]=!0,aa},{})}function hn(aa){if(!/^\d+\-./.test(aa)){return U(g2)}var ac=aa.indexOf("-"),t=aa.substring(0,ac),ab=aa.substring(ac+1);return{prefix:parseInt(t,10),id:ab}}function hS(aa,ac){for(var ag=aa.start-aa.ids.length+1,ab=aa.ids,t=[ab[0],ac,[]],ad=1,af=ab.length;af>ad;ad++){t=[ab[ad],{status:"missing"},[t]]}return[{pos:ag,ids:t}]}function g3(ac,ak){var af,ah,ag,ad={status:"available"};if(ac._deleted&&(ad.deleted=!0),ak){if(ac._id||(ac._id=di()),ah=di(32,16).toLowerCase(),ac._rev){if(ag=hn(ac._rev),ag.error){return ag}ac._rev_tree=[{pos:ag.prefix,ids:[ag.id,{status:"missing"},[[ah,ad,[]]]]}],af=ag.prefix+1}else{ac._rev_tree=[{pos:1,ids:[ah,ad,[]]}],af=1}}else{if(ac._revisions&&(ac._rev_tree=hS(ac._revisions,ad),af=ac._revisions.start,ah=ac._revisions.ids[0]),!ac._rev_tree){if(ag=hn(ac._rev),ag.error){return ag}af=ag.prefix,ah=ag.id,ac._rev_tree=[{pos:af,ids:[ah,ad,[]]}]}}ci(ac._id),ac._rev=af+"-"+ah;var aa={metadata:{},data:{}};for(var aj in ac){if(Object.prototype.hasOwnProperty.call(ac,aj)){var t="_"===aj[0];if(t&&!hM[aj]){var ab=U(be,aj);throw ab.message=be.message+": "+aj,ab}t&&!eo[aj]?aa.metadata[aj.slice(1)]=ac[aj]:aa.data[aj]=ac[aj]}}return aa}function fZ(ab){for(var ad="",t=new Uint8Array(ab),ac=t.byteLength,aa=0;ac>aa;aa++){ad+=String.fromCharCode(t[aa])}return ad}function i5(t){return jy(fZ(t))}function ct(ab,ad){ab=ab||[],ad=ad||{};try{return new Blob(ab,ad)}catch(t){if("TypeError"!==t.name){throw t}for(var ac="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder,aa=new ac,af=0;af<ab.length;af+=1){aa.append(ab[af])}return aa.getBlob(ad.type)}}function bn(ab){for(var ad=ab.length,t=new ArrayBuffer(ad),ac=new Uint8Array(t),aa=0;ad>aa;aa++){ac[aa]=ab.charCodeAt(aa)}return t}function jp(t,aa){return ct([bn(t)],{type:aa})}function iu(t,aa){return jp(it(t),aa)}function gL(aa,ac){if("undefined"==typeof FileReader){return ac(fZ((new FileReaderSync).readAsArrayBuffer(aa)))}var t=new FileReader,ab="function"==typeof t.readAsBinaryString;t.onloadend=function(af){var ad=af.target.result||"";return ab?ac(ad):void ac(fZ(ad))},ab?t.readAsBinaryString(aa):t.readAsArrayBuffer(aa)}function h6(t,aa){gL(t,function(ab){aa(jy(ab))})}function hI(aa,ab){if("undefined"==typeof FileReader){return ab((new FileReaderSync).readAsArrayBuffer(aa))}var t=new FileReader;t.onloadend=function(ad){var ac=ad.target.result||new ArrayBuffer(0);ab(ac)},t.readAsArrayBuffer(aa)}function ix(t){return jy(t)}function gj(aa,ac,t,ab){(t>0||ab<ac.byteLength)&&(ac=new Uint8Array(ac,t,Math.min(ab,ac.byteLength)-t)),aa.append(ac)}function ey(aa,ac,t,ab){(t>0||ab<ac.length)&&(ac=ac.substring(t,ab)),aa.appendBinary(ac)}function O(ac,ak){function af(){var aq=aj*ad,al=aq+ad;if(aj++,aa>aj){ab(t,ac,aq,al),fo(af)}else{ab(t,ac,aq,al);var ap=t.end(!0),am=ix(ap);ak(am),t.destroy()}}var ah="string"==typeof ac,ag=ah?ac.length:ac.byteLength,ad=Math.min(iX,ag),aa=Math.ceil(ag/ad),aj=0,t=ah?new jE:new jE.ArrayBuffer,ab=ah?ey:gj;af()}function ao(t){return jE.hash(t)}function gK(t,ac,ag){function aa(al){try{return it(al)}catch(aj){var ak=U(gB,"Attachment is not a valid base64 string");return{error:ak}}}function ah(aj,ak){if(aj.stub){return ak()}if("string"==typeof aj.data){var al=aa(aj.data);if(al.error){return ak(al.error)}aj.length=al.length,"blob"===ac?aj.data=jp(al,aj.content_type):"base64"===ac?aj.data=jy(al):aj.data=al,O(al,function(am){aj.digest="md5-"+am,ak()})}else{hI(aj.data,function(am){"binary"===ac?aj.data=fZ(am):"base64"===ac&&(aj.data=i5(am)),O(am,function(ap){aj.digest="md5-"+ap,aj.length=am.byteLength,ak()})})}}function ad(){ab++,t.length===ab&&(af?ag(af):ag())}if(!t.length){return ag()}var af,ab=0;t.forEach(function(ak){function am(aq){af=aq,al++,al===aj.length&&ad()}var aj=ak.data&&ak.data._attachments?Object.keys(ak.data._attachments):[],al=0;if(!aj.length){return ad()}for(var ap in ak.data._attachments){ak.data._attachments.hasOwnProperty(ap)&&ah(ak.data._attachments[ap],am)}})}function jo(ag,al,av,af,aw,ap,aa,aj){if(gl(al.rev_tree,av.metadata.rev)){return af[aw]=av,ap()}var ax=al.winningRev||gs(al),ac="deleted" in al?al.deleted:ha(al,ax),ah="deleted" in av.metadata?av.metadata.deleted:ha(av.metadata),aq=/^1-/.test(av.metadata.rev);if(ac&&!ah&&aj&&aq){var ad=av.data;ad._rev=ax,ad._id=av.metadata.id,av=g3(ad,aj)}var am=j(al.rev_tree,av.metadata.rev_tree[0],ag),ay=aj&&(ac&&ah||!ac&&"new_leaf"!==am.conflicts||ac&&!ah&&"new_branch"===am.conflicts);if(ay){var az=U(jt);return af[aw]=az,ap()}var aA=av.metadata.rev;av.metadata.rev_tree=am.tree,av.stemmedRevs=am.stemmedRevs||[],al.rev_map&&(av.metadata.rev_map=al.rev_map);var t,au=gs(av.metadata),ak=ha(av.metadata,au),ab=ac===ak?0:ak>ac?-1:1;t=aA===au?ak:ha(av.metadata,aA),aa(av,au,ak,t,!0,ab,aw,ap)}function an(t){return"missing"===t.metadata.rev_tree[0].ids[1].status}function iz(al,t,af,aj,ag,aq,ac,au,ab){function ad(aA,ax,aw){var av=gs(aA.metadata),aB=ha(aA.metadata,av);if("was_delete" in au&&aB){return aq[ax]=U(y,"deleted"),aw()}var az=aa&&an(aA);if(az){var ay=U(jt);return aq[ax]=ay,aw()}var aC=aB?0:1;ac(aA,av,aB,aB,!1,aC,ax,aw)}function am(){++ap===ah&&ab&&ab()}al=al||1000;var aa=au.new_edits,ak=new h8.Map,ap=0,ah=t.length;t.forEach(function(ay,aw){if(ay._id&&fc(ay._id)){var av=ay._deleted?"_removeLocal":"_putLocal";return void af[av](ay,{ctx:ag},function(aA,az){aq[aw]=aA||az,am()})}var ax=ay.metadata.id;ak.has(ax)?(ah--,ak.get(ax).push([ay,aw])):ak.set(ax,[[ay,aw]])}),ak.forEach(function(aw,ay){function az(){++ax<aw.length?av():am()}function av(){var aC=aw[ax],aA=aC[0],aB=aC[1];if(aj.has(ay)){jo(al,aj.get(ay),aA,aq,aB,az,ac,aa)}else{var aD=j([],aA.metadata.rev_tree[0],al);aA.metadata.rev_tree=aD.tree,aA.stemmedRevs=aD.stemmedRevs||[],ad(aA,aB,az)}}var ax=0;av()})}function er(t){try{return JSON.parse(t)}catch(aa){return hG.parse(t)}}function g7(t){return t.length<50000?JSON.parse(t):er(t)}function fW(t){try{return JSON.stringify(t)}catch(aa){return hG.stringify(t)}}function gI(ab,ad,t,ac){try{ab.apply(ad,t)}catch(aa){ac.emit("error",aa)}}function iT(t){if(!gy.running&&gy.queue.length){gy.running=!0;var aa=gy.queue.shift();aa.action(function(ac,ab){gI(aa.callback,this,[ac,ab],t),gy.running=!1,fV.nextTick(function(){iT(t)})})}}function hr(t){return function(ab){var aa="unknown_error";ab.target&&ab.target.error&&(aa=ab.target.error.name||ab.target.error.message),t(U(iJ,aa,ab.type))}}function hF(aa,ab,t){return{data:fW(aa),winningRev:ab,deletedOrLocal:t?"1":"0",seq:aa.seq,id:aa.id}}function o(t){if(!t){return null}var aa=g7(t.data);return aa.winningRev=t.winningRev,aa.deleted="1"===t.deletedOrLocal,aa.seq=t.seq,aa}function gV(t){if(!t){return t}var aa=t._doc_id_rev.lastIndexOf(":");return t._id=t._doc_id_rev.substring(0,aa-1),t._rev=t._doc_id_rev.substring(aa+1),delete t._doc_id_rev,t}function hk(aa,ac,t,ab){t?ab(aa?"string"!=typeof aa?aa:iu(aa,ac):ct([""],{type:ac})):aa?"string"!=typeof aa?gL(aa,function(ad){ab(jy(ad))}):ab(aa):ab("")}function jl(t,ac,ag,aa){function ah(){++ab===af.length&&aa&&aa()}function ad(aj,al){var ak=aj._attachments[al],am=ak.digest,ap=ag.objectStore(ig).get(am);ap.onsuccess=function(aq){ak.body=aq.target.result.body,ah()}}var af=Object.keys(t._attachments||{});if(!af.length){return aa&&aa()}var ab=0;af.forEach(function(aj){ac.attachments&&ac.include_docs?ad(t,aj):(t._attachments[aj].stub=!0,ah())})}function fU(t,aa){return iQ.all(t.map(function(ac){if(ac.doc&&ac.doc._attachments){var ab=Object.keys(ac.doc._attachments);return iQ.all(ab.map(function(ah){var af=ac.doc._attachments[ah];if("body" in af){var ad=af.body,ag=af.content_type;return new iQ(function(aj){hk(ad,ag,aa,function(ak){ac.doc._attachments[ah]=iv.extend(fi(af,["digest","content_type"]),{data:ak}),aj()})})}}))}}))}function a2(ac,ak,af){function ah(){ab--,ab||ag()}function ag(){ad.length&&ad.forEach(function(am){var al=t.index("digestSeq").count(IDBKeyRange.bound(am+"::",am+"::￿",!1,!1));al.onsuccess=function(aq){var ap=aq.target.result;ap||aj["delete"](am)}})}var ad=[],aa=af.objectStore(G),aj=af.objectStore(ig),t=af.objectStore(jD),ab=ac.length;ac.forEach(function(al){var am=aa.index("_doc_id_rev"),ap=ak+"::"+al;am.getKey(ap).onsuccess=function(au){var av=au.target.result;if("number"!=typeof av){return ah()}aa["delete"](av);var aq=t.index("seq").openCursor(IDBKeyRange.only(av));aq.onsuccess=function(ax){var ay=ax.target.result;if(ay){var aw=ay.value.digestSeq.split("::")[0];ad.push(aw),t["delete"](ay.primaryKey),ay["continue"]()}else{ah()}}}})}function h4(aa,ac,t){try{return{txn:aa.transaction(ac,t)}}catch(ab){return{error:ab}}}function jn(t,am,ab,aj,ac,aG,aD){function al(){var aN=[gY,G,ig,hj,jD],aO=h4(ac,aN,"readwrite");return aO.error?aD(aO.error):(aa=aO.txn,aa.onabort=hr(aD),aa.ontimeout=hr(aD),aa.oncomplete=ah,aC=aa.objectStore(gY),aK=aa.objectStore(G),ax=aa.objectStore(ig),ap=aa.objectStore(jD),void aM(function(aP){return aP?(aB=!0,aD(aP)):void aL()}))}function au(){iz(t.revs_limit,aI,aj,ak,aa,aH,aF,ab)}function aL(){function aO(){++aT===aI.length&&au()}function aQ(aU){var aV=o(aU.target.result);aV&&ak.set(aV.id,aV),aO()}if(aI.length){for(var aT=0,aP=0,aN=aI.length;aN>aP;aP++){var aR=aI[aP];if(aR._id&&fc(aR._id)){aO()}else{var aS=aC.get(aR.metadata.id);aS.onsuccess=aQ}}}}function ah(){aB||(aG.notify(aj._meta.name),aj._meta.docCount+=ag,aD(null,aH))}function aJ(aO,aP){var aN=ax.get(aO);aN.onsuccess=function(aQ){if(aQ.target.result){aP()}else{var aR=U(hU,"unknown stub attachment with digest "+aO);aR.status=412,aP(aR)}}}function aM(aP){function aR(){++aO===aN.length&&aP(aQ)}var aN=[];if(aI.forEach(function(aS){aS.data&&aS.data._attachments&&Object.keys(aS.data._attachments).forEach(function(aT){var aU=aS.data._attachments[aT];aU.stub&&aN.push(aU.digest)})}),!aN.length){return aP()}var aQ,aO=0;aN.forEach(function(aS){aJ(aS,function(aT){aT&&!aQ&&(aQ=aT),aR()})})}function aF(aQ,aW,aS,aU,aT,aR,aO,aV){ag+=aR,aQ.metadata.winningRev=aW,aQ.metadata.deleted=aS;var aN=aQ.data;aN._id=aQ.metadata.id,aN._rev=aQ.metadata.rev,aU&&(aN._deleted=!0);var aP=aN._attachments&&Object.keys(aN._attachments).length;return aP?av(aQ,aW,aS,aT,aO,aV):void ad(aQ,aW,aS,aT,aO,aV)}function ad(aP,aW,aU,aV,aS,aY){function aQ(bb){var aZ=aP.stemmedRevs||[];aV&&aj.auto_compaction&&(aZ=aZ.concat(gz(aP.metadata))),aZ&&aZ.length&&a2(aZ,aP.metadata.id,aa),aT.seq=bb.target.result,delete aT.rev;var ba=hF(aT,aW,aU),bc=aC.put(ba);bc.onsuccess=aN}function aX(aZ){aZ.preventDefault(),aZ.stopPropagation();var ba=aK.index("_doc_id_rev"),bb=ba.getKey(aR._doc_id_rev);bb.onsuccess=function(bc){var bd=aK.put(aR,bc.target.result);bd.onsuccess=aQ}}function aN(){aH[aS]={ok:!0,id:aT.id,rev:aW},ak.set(aP.metadata.id,aP.metadata),aA(aP,aT.seq,aY)}var aR=aP.data,aT=aP.metadata;aR._doc_id_rev=aT.id+"::"+aT.rev,delete aR._id,delete aR._rev;var aO=aK.put(aR);aO.onsuccess=aQ,aO.onerror=aX}function av(aP,aW,aS,aU,aT,aR){function aN(){aO===aQ.length&&ad(aP,aW,aS,aU,aT,aR)}function aV(){aO++,aN()}var aX=aP.data,aO=0,aQ=Object.keys(aX._attachments);aQ.forEach(function(bb){var aZ=aP.data._attachments[bb];if(aZ.stub){aO++,aN()}else{var aY=aZ.data;delete aZ.data,aZ.revpos=parseInt(aW,10);var ba=aZ.digest;ay(ba,aY,aV)}})}function aA(aN,aQ,aT){function aO(){++aR===aS.length&&aT()}function aU(aV){var aW=aN.data._attachments[aV].digest,aX=ap.put({seq:aQ,digestSeq:aW+"::"+aQ});aX.onsuccess=aO,aX.onerror=function(aY){aY.preventDefault(),aY.stopPropagation(),aO()}}var aR=0,aS=Object.keys(aN.data._attachments||{});if(!aS.length){return aT()}for(var aP=0;aP<aS.length;aP++){aU(aS[aP])}}function ay(aO,aQ,aN){var aP=ax.count(aO);aP.onsuccess=function(aR){var aU=aR.target.result;if(aU){return aN()}var aS={digest:aO,body:aQ},aT=ax.put(aS);aT.onsuccess=aN}}for(var aa,aC,aK,ax,ap,aq,aI=am.docs,ag=0,af=0,aw=aI.length;aw>af;af++){var aE=aI[af];aE._id&&fc(aE._id)||(aE=aI[af]=g3(aE,ab.new_edits),aE.error&&!aq&&(aq=aE))}if(aq){return aD(aq)}var aH=new Array(aI.length),ak=new h8.Map,aB=!1,az=aj._meta.blobSupport?"blob":"base64";gK(aI,az,function(aN){return aN?aD(aN):void al()})}function N(ab,ad,t,ac,aa){try{if(ab&&ad){return aa?IDBKeyRange.bound(ad,ab,!t,!1):IDBKeyRange.bound(ab,ad,!1,!t)}if(ab){return aa?IDBKeyRange.upperBound(ab):IDBKeyRange.lowerBound(ab)}if(ad){return aa?IDBKeyRange.lowerBound(ad,!t):IDBKeyRange.upperBound(ad,!t)}if(ac){return IDBKeyRange.only(ac)}}catch(af){return{error:af}}return null}function gH(aa,ac,t,ab){return"DataError"===t.name&&0===t.code?ab(null,{total_rows:aa._meta.docCount,offset:ac.skip,rows:[]}):void ab(U(iJ,t.name,t.message))}function hQ(ab,ad,t,ac){function aa(am,aE){function aA(aK,aL,aN){var aM=aK.id+"::"+aN;aJ.get(aM).onsuccess=function(aO){aL.doc=gV(aO.target.result),am.conflicts&&(aL.doc._conflicts=w(aK)),jl(aL.doc,am,aq)}}function av(aM,aK,aL){var aN={id:aL.id,key:aL.id,value:{rev:aK}},aO=aL.deleted;if("ok"===am.deleted){aw.push(aN),aO?(aN.value.deleted=!0,aN.doc=null):am.include_docs&&aA(aL,aN,aK)}else{if(!aO&&al--<=0&&(aw.push(aN),am.include_docs&&aA(aL,aN,aK),0===--au)){return}}aM["continue"]()}function ah(aN){aD=ad._meta.docCount;var aL=aN.target.result;if(aL){var aK=o(aL.value),aM=aK.winningRev;av(aL,aM,aK)}}function aF(){aE(null,{total_rows:aD,offset:am.skip,rows:aw})}function aH(){am.attachments?fU(aw,am.binary).then(aF):aF()}var ak="startkey" in am?am.startkey:!1,ap="endkey" in am?am.endkey:!1,ay="key" in am?am.key:!1,al=am.skip||0,au="number"==typeof am.limit?am.limit:-1,aC=am.inclusive_end!==!1,aI="descending" in am&&am.descending?"prev":null,aB=N(ak,ap,aC,ay,aI);if(aB&&aB.error){return gH(ad,am,aB.error,aE)}var ag=[gY,G];am.attachments&&ag.push(ig);var az=h4(t,ag,"readonly");if(az.error){return aE(az.error)}var aq=az.txn,aj=aq.objectStore(gY),ax=aq.objectStore(G),aG=aI?aj.openCursor(aB,aI):aj.openCursor(aB),aJ=ax.index("_doc_id_rev"),aw=[],aD=0;aq.oncomplete=aH,aG.onsuccess=ah}function af(ag,ah){return 0===ag.limit?ah(null,{total_rows:ad._meta.docCount,offset:ag.skip,rows:[]}):void aa(ag,ah)}af(ab,ac)}function co(t){return new iQ(function(ab){var aa=ct([""]);t.objectStore(iO).put(aa,"key"),t.onabort=function(ac){ac.preventDefault(),ac.stopPropagation(),ab(!1)},t.oncomplete=function(){var ad=navigator.userAgent.match(/Chrome\/(\d+)/),ac=navigator.userAgent.match(/Edge\//);ab(ac||!ad||parseInt(ad[1],10)>=43)}})["catch"](function(){return !1})}function eu(aa,ab){var t=this;gy.queue.push({action:function(ac){iw(t,aa,ac)},callback:ab}),iT(t.constructor)}function iw(ab,aa,al){function aj(au){var av=au.createObjectStore(gY,{keyPath:"id"});au.createObjectStore(G,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),au.createObjectStore(ig,{keyPath:"digest"}),au.createObjectStore(hA,{keyPath:"id",autoIncrement:!1}),au.createObjectStore(iO),av.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),au.createObjectStore(hj,{keyPath:"_id"});var aw=au.createObjectStore(jD,{autoIncrement:!0});aw.createIndex("seq","seq"),aw.createIndex("digestSeq","digestSeq",{unique:!0})}function ah(au,av){var aw=au.objectStore(gY);aw.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),aw.openCursor().onsuccess=function(ay){var az=ay.target.result;if(az){var ax=az.value,aA=ha(ax);ax.deletedOrLocal=aA?"1":"0",aw.put(ax),az["continue"]()}else{av()}}}function am(au){au.createObjectStore(hj,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}function t(av,ay){var az=av.objectStore(hj),ax=av.objectStore(gY),au=av.objectStore(G),aw=ax.openCursor();aw.onsuccess=function(aI){var aL=aI.target.result;if(aL){var aF=aL.value,aC=aF.id,aD=fc(aC),aG=gs(aF);if(aD){var aJ=aC+"::"+aG,aA=aC+"::",aH=aC+"::~",aK=au.index("_doc_id_rev"),aB=IDBKeyRange.bound(aA,aH,!1,!1),aE=aK.openCursor(aB);aE.onsuccess=function(aN){if(aE=aN.target.result){var aM=aE.value;aM._doc_id_rev===aJ&&az.put(aM),au["delete"](aE.primaryKey),aE["continue"]()}else{ax["delete"](aL.primaryKey),aL["continue"]()}}}else{aL["continue"]()}}else{ay&&ay()}}}function ac(au){var av=au.createObjectStore(jD,{autoIncrement:!0});av.createIndex("seq","seq"),av.createIndex("digestSeq","digestSeq",{unique:!0})}function af(av,ay){var az=av.objectStore(G),ax=av.objectStore(ig),au=av.objectStore(jD),aw=ax.count();aw.onsuccess=function(aB){var aA=aB.target.result;return aA?void (az.openCursor().onsuccess=function(aG){var aK=aG.target.result;if(!aK){return ay()}for(var aL=aK.value,aI=aK.primaryKey,aE=Object.keys(aL._attachments||{}),aC={},aD=0;aD<aE.length;aD++){var aF=aL._attachments[aE[aD]];aC[aF.digest]=!0}var aH=Object.keys(aC);for(aD=0;aD<aH.length;aD++){var aJ=aH[aD];au.put({seq:aI,digestSeq:aJ+"::"+aI})}aK["continue"]()}):ay()}}function aq(ay){function ax(az){return az.data?o(az):(az.deleted="1"===az.deletedOrLocal,az)}var au=ay.objectStore(G),av=ay.objectStore(gY),aw=av.openCursor();aw.onsuccess=function(aC){function aB(){var aF=aD.id+"::",aH=aD.id+"::￿",aG=au.index("_doc_id_rev").openCursor(IDBKeyRange.bound(aF,aH)),aE=0;aG.onsuccess=function(aJ){var aK=aJ.target.result;if(!aK){return aD.seq=aE,az()}var aI=aK.primaryKey;aI>aE&&(aE=aI),aK["continue"]()}}function az(){var aE=hF(aD,aD.winningRev,aD.deleted),aF=av.put(aE);aF.onsuccess=function(){aA["continue"]()}}var aA=aC.target.result;if(aA){var aD=ax(aA.value);return aD.winningRev=aD.winningRev||gs(aD),aD.seq?az():void aB()}}}var ag=aa.name,ak=null;ab._meta=null,ab.type=function(){return"idb"},ab._id=fx(function(au){au(null,ab._meta.instanceId)}),ab._bulkDocs=function(aw,av,au){jn(aa,aw,av,ab,ak,hX,au)},ab._get=function(aC,ay,az){function av(){az(aB,{doc:au,metadata:aw,ctx:ax})}var au,aw,aB,ax=ay.ctx;if(!ax){var aA=h4(ak,[gY,G,ig],"readonly");if(aA.error){return az(aA.error)}ax=aA.txn}ax.objectStore(gY).get(aC).onsuccess=function(aG){if(aw=o(aG.target.result),!aw){return aB=U(y,"missing"),av()}if(ha(aw)&&!ay.rev){return aB=U(y,"deleted"),av()}var aE=ax.objectStore(G),aD=ay.rev||aw.winningRev,aF=aw.id+"::"+aD;aE.index("_doc_id_rev").get(aF).onsuccess=function(aH){return au=aH.target.result,au&&(au=gV(au)),au?void av():(aB=U(y,"missing"),av())}}},ab._getAttachment=function(aC,ay,az,av,au){var aw;if(av.ctx){aw=av.ctx}else{var aB=h4(ak,[gY,G,ig],"readonly");if(aB.error){return au(aB.error)}aw=aB.txn}var ax=az.digest,aA=az.content_type;aw.objectStore(ig).get(ax).onsuccess=function(aE){var aD=aE.target.result.body;hk(aD,aA,av.binary,function(aF){au(null,aF)})}},ab._info=function(av){if(null===ak||!hz.has(ag)){var ax=new Error("db isn't open");return ax.id="idbNull",av(ax)}var aA,ay,az=h4(ak,[G],"readonly");if(az.error){return av(az.error)}var aw=az.txn,au=aw.objectStore(G).openCursor(null,"prev");au.onsuccess=function(aB){var aC=aB.target.result;aA=aC?aC.key:0,ay=ab._meta.docCount},aw.oncomplete=function(){av(null,{doc_count:ay,update_seq:aA,idb_attachment_format:ab._meta.blobSupport?"binary":"base64"})}},ab._allDocs=function(av,au){hQ(av,ab,ak,au)},ab._changes=function(aH){function aD(aS){function aM(){return aN.seq!==aR?aS["continue"]():(aI=aR,aN.winningRev===aQ._rev?aO(aQ):void aP())}function aP(){var aU=aQ._id+"::"+aN.winningRev,aT=au.get(aU);aT.onsuccess=function(aV){aO(gV(aV.target.result))}}function aO(aU){var aT=aH.processChange(aU,aN,aH);aT.seq=aN.seq;var aV=aw(aT);return"object"==typeof aV?aH.complete(aV):(aV&&(az++,aB&&aC.push(aT),aH.attachments&&aH.include_docs?jl(aU,aH,ax,function(){fU([aT],aH.binary).then(function(){aH.onChange(aT)})}):aH.onChange(aT)),void (az!==ay&&aS["continue"]()))}var aQ=gV(aS.value),aR=aS.key;if(aG&&!aG.has(aQ._id)){return aS["continue"]()}var aN;return(aN=aK.get(aQ._id))?aM():void (aL.get(aQ._id).onsuccess=function(aT){aN=o(aT.target.result),aK.set(aQ._id,aN),aM()})}function aF(aN){var aM=aN.target.result;aM&&aD(aM)}function aE(){var aM=[gY,G];aH.attachments&&aM.push(ig);var aN=h4(ak,aM,"readonly");if(aN.error){return aH.complete(aN.error)}ax=aN.txn,ax.onabort=hr(aH.complete),ax.oncomplete=aA,aJ=ax.objectStore(G),aL=ax.objectStore(gY),au=aJ.index("_doc_id_rev");var aO;aO=aH.descending?aJ.openCursor(null,"prev"):aJ.openCursor(IDBKeyRange.lowerBound(aH.since,!0)),aO.onsuccess=aF}function aA(){function aM(){aH.complete(null,{results:aC,last_seq:aI})}!aH.continuous&&aH.attachments?fU(aC).then(aM):aM()}if(aH=es(aH),aH.continuous){var av=ag+":"+di();return hX.addListener(ag,av,ab,aH),hX.notify(ag),{cancel:function(){hX.removeListener(ag,av)}}}var aG=aH.doc_ids&&new h8.Set(aH.doc_ids);aH.since=aH.since||0;var aI=aH.since,ay="limit" in aH?aH.limit:-1;0===ay&&(ay=1);var aB;aB="return_docs" in aH?aH.return_docs:"returnDocs" in aH?aH.returnDocs:!0;var ax,aJ,aL,au,aC=[],az=0,aw=D(aH),aK=new h8.Map;aE()},ab._close=function(au){return null===ak?au(U(gv)):(ak.close(),hz["delete"](ag),ak=null,void au())},ab._getRevisionTree=function(ay,ax){var au=h4(ak,[gY],"readonly");if(au.error){return ax(au.error)}var av=au.txn,aw=av.objectStore(gY).get(ay);aw.onsuccess=function(aA){var az=o(aA.target.result);az?ax(null,az.rev_tree):ax(U(y))}},ab._doCompaction=function(au,ax,ay){var av=[gY,G,ig,jD],aA=h4(ak,av,"readwrite");if(aA.error){return ay(aA.error)}var az=aA.txn,aw=az.objectStore(gY);aw.get(au).onsuccess=function(aC){var aE=o(aC.target.result);F(aE.rev_tree,function(aF,aJ,aG,aK,aH){var aI=aJ+"-"+aG;-1!==ax.indexOf(aI)&&(aH.status="missing")}),a2(ax,au,az);var aD=aE.winningRev,aB=aE.deleted;az.objectStore(gY).put(hF(aE,aD,aB))},az.onabort=hr(ay),az.oncomplete=function(){ay()}},ab._getLocal=function(ay,ax){var au=h4(ak,[hj],"readonly");if(au.error){return ax(au.error)}var av=au.txn,aw=av.objectStore(hj).get(ay);aw.onerror=hr(ax),aw.onsuccess=function(aA){var az=aA.target.result;az?(delete az._doc_id_rev,ax(null,az)):ax(U(y))}},ab._putLocal=function(aD,ay,aA){"function"==typeof ay&&(aA=ay,ay={}),delete aD._revisions;var av=aD._rev,au=aD._id;av?aD._rev="0-"+(parseInt(av.split("-")[1],10)+1):aD._rev="0-1";var aw,aB=ay.ctx;if(!aB){var ax=h4(ak,[hj],"readwrite");if(ax.error){return aA(ax.error)}aB=ax.txn,aB.onerror=hr(aA),aB.oncomplete=function(){aw&&aA(null,aw)}}var az,aC=aB.objectStore(hj);av?(az=aC.get(au),az.onsuccess=function(aE){var aF=aE.target.result;if(aF&&aF._rev===av){var aG=aC.put(aD);aG.onsuccess=function(){aw={ok:!0,id:aD._id,rev:aD._rev},ay.ctx&&aA(null,aw)}}else{aA(U(jt))}}):(az=aC.add(aD),az.onerror=function(aE){aA(U(jt)),aE.preventDefault(),aE.stopPropagation()},az.onsuccess=function(){aw={ok:!0,id:aD._id,rev:aD._rev},ay.ctx&&aA(null,aw)})},ab._removeLocal=function(aC,ay,az){"function"==typeof ay&&(az=ay,ay={});var av=ay.ctx;if(!av){var au=h4(ak,[hj],"readwrite");if(au.error){return az(au.error)}av=au.txn,av.oncomplete=function(){aw&&az(null,aw)}}var aw,aB=aC._id,ax=av.objectStore(hj),aA=ax.get(aB);aA.onerror=hr(az),aA.onsuccess=function(aD){var aE=aD.target.result;aE&&aE._rev===aC._rev?(ax["delete"](aB),aw={ok:!0,id:aB,rev:"0-0"},ay.ctx&&az(null,aw)):az(U(y))}},ab._destroy=function(ax,av){hX.removeAllListeners(ag);var aw=g9.get(ag);aw&&aw.result&&(aw.result.close(),hz["delete"](ag));var au=indexedDB.deleteDatabase(ag);au.onsuccess=function(){g9["delete"](ag),fS()&&ag in localStorage&&delete localStorage[ag],av(null,{ok:!0})},au.onerror=hr(av)};var ad=hz.get(ag);if(ad){return ak=ad.idb,ab._meta=ad.global,void fV.nextTick(function(){al(null,ab)})}var ap;ap=aa.storage?jA(ag,aa.storage):indexedDB.open(ag,h7),g9.set(ag,ap),ap.onupgradeneeded=function(ay){function av(){var aA=ax[aw-1];aw++,aA&&aA(az,av)}var au=ay.target.result;if(ay.oldVersion<1){return aj(au)}var az=ay.currentTarget.transaction;ay.oldVersion<3&&am(au),ay.oldVersion<4&&ac(au);var ax=[ah,t,af,aq],aw=ay.oldVersion;av()},ap.onsuccess=function(ax){ak=ax.target.result,ak.onversionchange=function(){ak.close(),hz["delete"](ag)},ak.onabort=function(aA){S("error","Database has a global failure",aA.target.error),ak.close(),hz["delete"](ag)};var az=ak.transaction([hA,iO,gY],"readwrite"),au=az.objectStore(hA).get(hA),ay=null,aw=null,av=null;au.onsuccess=function(aB){var aD=function(){null!==ay&&null!==aw&&null!==av&&(ab._meta={name:ag,instanceId:av,blobSupport:ay,docCount:aw},hz.set(ag,{idb:ak,global:ab._meta}),al(null,ab))},aA=aB.target.result||{id:hA};ag+"_id" in aA?(av=aA[ag+"_id"],aD()):(av=di(),aA[ag+"_id"]=av,az.objectStore(hA).put(aA).onsuccess=function(){aD()}),gD||(gD=co(az)),gD.then(function(aE){ay=aE,aD()});var aC=az.objectStore(gY).index("deletedOrLocal");aC.count(IDBKeyRange.only("0")).onsuccess=function(aE){aw=aE.target.result,aD()}}},ap.onerror=function(){var au="Failed to open indexedDB, are you in private browsing mode?";S("error",au),al(U(iJ,au))}}function jA(aa,ab){try{return indexedDB.open(aa,{version:h7,storage:ab})}catch(t){return indexedDB.open(aa,h7)}}function M(t){t.adapter("idb",eu,!0)}function i1(t){return decodeURIComponent(escape(t))}function gi(t){return 65>t?t-48:t-55}function g1(aa,ac,t){for(var ab="";t>ac;){ab+=String.fromCharCode(gi(aa.charCodeAt(ac++))<<4|gi(aa.charCodeAt(ac++)))}return ab}function gu(aa,ac,t){for(var ab="";t>ac;){ab+=String.fromCharCode(gi(aa.charCodeAt(ac+2))<<12|gi(aa.charCodeAt(ac+3))<<8|gi(aa.charCodeAt(ac))<<4|gi(aa.charCodeAt(ac+1))),ac+=4}return ab}function im(t,aa){return"UTF-8"===aa?i1(g1(t,0,t.length)):gu(t,0,t.length)}function h9(t){return"'"+t+"'"}function hH(t){return t.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"")}function hq(t){return t.replace(/\u0001\u0001/g,"\x00").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,"")}function iR(t){return delete t._id,delete t._rev,JSON.stringify(t)}function p(aa,ab,t){return aa=JSON.parse(aa),aa._id=ab,aa._rev=t,aa}function hJ(t){for(var aa="(";t--;){aa+="?",t&&(aa+=",")}return aa+")"}function h2(ab,ad,t,ac,aa){return"SELECT "+ab+" FROM "+("string"==typeof ad?ad:ad.join(" JOIN "))+(t?" ON "+t:"")+(ac?" WHERE "+("string"==typeof ac?ac:ac.join(" AND ")):"")+(aa?" ORDER BY "+aa:"")}function dt(aa,ac,ag){function ab(){++ad===aa.length&&t()}function t(){if(af.length){var ah="SELECT DISTINCT digest AS digest FROM "+gQ+" WHERE seq IN "+hJ(af.length);ag.executeSql(ah,af,function(al,ap){for(var aj=[],am=0;am<ap.rows.length;am++){aj.push(ap.rows.item(am).digest)}if(aj.length){var ak="DELETE FROM "+gQ+" WHERE seq IN ("+af.map(function(){return"?"}).join(",")+")";al.executeSql(ak,af,function(aq){var au="SELECT digest FROM "+gQ+" WHERE digest IN ("+aj.map(function(){return"?"}).join(",")+")";aq.executeSql(au,aj,function(ax,aw){for(var ay=new h8.Set,av=0;av<aw.rows.length;av++){ay.add(aw.rows.item(av).digest)}aj.forEach(function(az){ay.has(az)||(ax.executeSql("DELETE FROM "+gQ+" WHERE digest=?",[az]),ax.executeSql("DELETE FROM "+v+" WHERE digest=?",[az]))})})})}})}}if(aa.length){var ad=0,af=[];aa.forEach(function(ah){var aj="SELECT seq FROM "+hm+" WHERE doc_id=? AND rev=?";ag.executeSql(aj,[ac,ah],function(al,am){if(!am.rows.length){return ab()}var ak=am.rows.item(0).seq;af.push(ak),al.executeSql("DELETE FROM "+hm+" WHERE seq=?",[ak],ab)})})}}function ir(t){return function(ad){S("error","WebSQL threw an error",ad);var aa=ad&&ad.constructor.toString().match(/function ([^\(]+)/),ac=aa&&aa[1]||ad.type,ab=ad.target||ad.message;t(U(fb,ab,ac))}}function jb(t){if("size" in t){return 1000000*t.size}var aa="undefined"!=typeof navigator&&/Android/.test(navigator.userAgent);return aa?5000000:1}function hu(af,ah,au,ax,av,am,aa){function az(){return aj?aa(aj):(am.notify(ax._name),ax._docCount=-1,void aa(null,ab))}function al(aD,aE){var aC="SELECT count(*) as cnt FROM "+v+" WHERE digest=?";aq.executeSql(aC,[aD],function(aH,aG){if(0===aG.rows.item(0).cnt){var aF=U(hU,"unknown stub attachment with digest "+aD);aE(aF)}else{aE()}})}function ac(aE){function aG(){++aD===aC.length&&aE(aF)}var aC=[];if(aB.forEach(function(aH){aH.data&&aH.data._attachments&&Object.keys(aH.data._attachments).forEach(function(aJ){var aI=aH.data._attachments[aJ];aI.stub&&aC.push(aI.digest)})}),!aC.length){return aE()}var aF,aD=0;aC.forEach(function(aH){al(aH,function(aI){aI&&!aF&&(aF=aI),aG()})})}function ag(aL,aD,aI,aN,aP,aG,aQ,aE){function aJ(){function aT(bf,ba){function bc(){return ++bb===bg.length&&ba(),!1}function bd(bi){var bh="INSERT INTO "+gQ+" (digest, seq) VALUES (?,?)",bj=[aU._attachments[bi].digest,bf];aq.executeSql(bh,bj,bc,bc)}var bb=0,bg=Object.keys(aU._attachments||{});if(!bg.length){return ba()}for(var aZ=0;aZ<bg.length;aZ++){bd(bg[aZ])}}var aU=aL.data,aR=aN?1:0,aW=aU._id,aS=aU._rev,aY=iR(aU),aX="INSERT INTO "+hm+" (doc_id, rev, json, deleted) VALUES (?, ?, ?, ?);",aV=[aW,aS,aY,aR];aq.executeSql(aX,aV,function(bb,aZ){var ba=aZ.insertId;aT(ba,function(){aK(bb,ba)})},function(){var aZ=h2("seq",hm,null,"doc_id=? AND rev=?");return aq.executeSql(aZ,[aW,aS],function(bb,bf){var ba=bf.rows.item(0).seq,bc="UPDATE "+hm+" SET json=?, deleted=? WHERE doc_id=? AND rev=?;",bd=[aY,aR,aW,aS];bb.executeSql(bc,bd,function(bg){aT(ba,function(){aK(bg,ba)})})}),!1})}function aM(aR){aO||(aR?(aO=aR,aE(aO)):aF===aH.length&&aJ())}function aC(aR){aF++,aM(aR)}function aK(aR,aS){var aW=aL.metadata.id,aX=aL.stemmedRevs||[];aP&&ax.auto_compaction&&(aX=gz(aL.metadata).concat(aX)),aX.length&&dt(aX,aW,aR),aL.metadata.seq=aS,delete aL.metadata.rev;var aV=aP?"UPDATE "+i8+" SET json=?, max_seq=?, winningseq=(SELECT seq FROM "+hm+" WHERE doc_id="+i8+".id AND rev=?) WHERE id=?":"INSERT INTO "+i8+" (id, winningseq, max_seq, json) VALUES (?,?,?,?);",aU=fW(aL.metadata),aT=aP?[aU,aS,aD,aW]:[aW,aS,aS,aU];aR.executeSql(aV,aT,function(){ab[aQ]={ok:!0,id:aL.metadata.id,rev:aD},aA.set(aW,aL.metadata),aE()})}var aO=null,aF=0;aL.data._id=aL.metadata.id,aL.data._rev=aL.metadata.rev;var aH=Object.keys(aL.data._attachments||{});aN&&(aL.data._deleted=!0),aH.forEach(function(aS){var aU=aL.data._attachments[aS];if(aU.stub){aF++,aM()}else{var aT=aU.data;delete aU.data,aU.revpos=parseInt(aD,10);var aR=aU.digest;ak(aR,aT,aC)}}),aH.length||aJ()}function ap(){iz(af.revs_limit,aB,ax,aA,aq,ab,ag,au)}function ad(aD){function aE(){++aC===aB.length&&aD()}if(!aB.length){return aD()}var aC=0;aB.forEach(function(aG){if(aG._id&&fc(aG._id)){return aE()}var aF=aG.metadata.id;aq.executeSql("SELECT json FROM "+i8+" WHERE id = ?",[aF],function(aI,aJ){if(aJ.rows.length){var aH=g7(aJ.rows.item(0).json);aA.set(aF,aH)}aE()})})}function ak(aD,aF,aC){var aE="SELECT digest FROM "+v+" WHERE digest=?";aq.executeSql(aE,[aD],function(aH,aG){return aG.rows.length?aC():(aE="INSERT INTO "+v+" (digest, body, escaped) VALUES (?,?,1)",void aH.executeSql(aE,[aD,hH(aF)],function(){aC()},function(){return aC(),!1}))})}var aw=au.new_edits,ay=ah.docs,aB=ay.map(function(aC){if(aC._id&&fc(aC._id)){return aC}var aD=g3(aC,aw);return aD}),t=aB.filter(function(aC){return aC.error});if(t.length){return aa(t[0])}var aq,aj,ab=new Array(aB.length),aA=new h8.Map;gK(aB,"binary",function(aC){return aC?aa(aC):void av.transaction(function(aD){aq=aD,ac(function(aE){aE?aj=aE:ad(ap)})},ir(aa),az)})}function B(t){return t.websql(t.name,t.version,t.description,t.size)}function ju(t){try{return{db:B(t)}}catch(aa){return{error:aa}}}function hf(t){var aa=g.get(t.name);return aa||(aa=ju(t),g.set(t.name,aa),aa.db&&(aa.db._sqlitePlugin="undefined"!=typeof sqlitePlugin)),aa}function gU(ac,t,af,ah,ag){function ad(){++aa===aj.length&&ag&&ag()}function ab(am,ak){var al=am._attachments[ak],ap={binary:t.binary,ctx:ah};af._getAttachment(am._id,ak,al,ap,function(au,aq){am._attachments[ak]=iv.extend(fi(al,["digest","content_type"]),{data:aq}),ad()})}var aj=Object.keys(ac._attachments||{});if(!aj.length){return ag&&ag()}var aa=0;aj.forEach(function(ak){t.attachments&&t.include_docs?ab(ac,ak):(ac._attachments[ak].stub=!0,ad())})}function i(ad,ay){function am(){fS()&&(window.localStorage["_pouch__websqldb_"+ag._name]=!0),ay(null,ag)}function aw(aD,aE){aD.executeSql(W),aD.executeSql("ALTER TABLE "+hm+" ADD COLUMN deleted TINYINT(1) DEFAULT 0",[],function(){aD.executeSql(gr),aD.executeSql("ALTER TABLE "+i8+" ADD COLUMN local TINYINT(1) DEFAULT 0",[],function(){aD.executeSql("CREATE INDEX IF NOT EXISTS 'doc-store-local-idx' ON "+i8+" (local, id)");var aF="SELECT "+i8+".winningseq AS seq, "+i8+".json AS metadata FROM "+hm+" JOIN "+i8+" ON "+hm+".seq = "+i8+".winningseq";aD.executeSql(aF,[],function(aN,aJ){for(var aG=[],aL=[],aK=0;aK<aJ.rows.length;aK++){var aI=aJ.rows.item(aK),aH=aI.seq,aM=JSON.parse(aI.metadata);ha(aM)&&aG.push(aH),fc(aM.id)&&aL.push(aM.id)}aN.executeSql("UPDATE "+i8+"SET local = 1 WHERE id IN "+hJ(aL.length),aL,function(){aN.executeSql("UPDATE "+hm+" SET deleted = 1 WHERE seq IN "+hJ(aG.length),aG,aE)})})})})}function aq(aE,aF){var aD="CREATE TABLE IF NOT EXISTS "+js+" (id UNIQUE, rev, json)";aE.executeSql(aD,[],function(){var aG="SELECT "+i8+".id AS id, "+hm+".json AS data FROM "+hm+" JOIN "+i8+" ON "+hm+".seq = "+i8+".winningseq WHERE local = 1";aE.executeSql(aG,[],function(aJ,aH){function aK(){if(!aI.length){return aF(aJ)}var aM=aI.shift(),aN=JSON.parse(aM.data)._rev;aJ.executeSql("INSERT INTO "+js+" (id, rev, json) VALUES (?,?,?)",[aM.id,aN,aM.data],function(aO){aO.executeSql("DELETE FROM "+i8+" WHERE id=?",[aM.id],function(aP){aP.executeSql("DELETE FROM "+hm+" WHERE seq=?",[aM.seq],function(){aK()})})})}for(var aI=[],aL=0;aL<aH.rows.length;aL++){aI.push(aH.rows.item(aL))}aK()})})}function aj(aE,aG){function aD(aH){function aI(){if(!aH.length){return aG(aE)}var aJ=aH.shift(),aL=im(aJ.hex,t),aO=aL.lastIndexOf("::"),aK=aL.substring(0,aO),aM=aL.substring(aO+2),aN="UPDATE "+hm+" SET doc_id=?, rev=? WHERE doc_id_rev=?";aE.executeSql(aN,[aK,aM,aL],function(){aI()})}aI()}var aF="ALTER TABLE "+hm+" ADD COLUMN doc_id";aE.executeSql(aF,[],function(aH){var aI="ALTER TABLE "+hm+" ADD COLUMN rev";aH.executeSql(aI,[],function(aJ){aJ.executeSql(fl,[],function(aK){var aL="SELECT hex(doc_id_rev) as hex FROM "+hm;aK.executeSql(aL,[],function(aN,aP){for(var aO=[],aM=0;aM<aP.rows.length;aM++){aO.push(aP.rows.item(aM))}aD(aO)})})})})}function aa(aE,aG){function aD(aI){var aH="SELECT COUNT(*) AS cnt FROM "+v;aI.executeSql(aH,[],function(aK,aO){function aL(){var aP=h2(a7+", "+i8+".id AS id",[i8,hm],ic,null,i8+".id ");aP+=" LIMIT "+aN+" OFFSET "+aM,aM+=aN,aK.executeSql(aP,[],function(aR,aW){function bb(bc,bd){var bf=aU[bc]=aU[bc]||[];-1===bf.indexOf(bd)&&bf.push(bd)}if(!aW.rows.length){return aG(aR)}for(var aU={},aZ=0;aZ<aW.rows.length;aZ++){for(var aX=aW.rows.item(aZ),aY=p(aX.data,aX.id,aX.rev),ba=Object.keys(aY._attachments||{}),aS=0;aS<ba.length;aS++){var aV=aY._attachments[ba[aS]];bb(aV.digest,aX.seq)}}var aQ=[];if(Object.keys(aU).forEach(function(bc){var bd=aU[bc];bd.forEach(function(bf){aQ.push([bc,bf])})}),!aQ.length){return aL()}var aT=0;aQ.forEach(function(bd){var bc="INSERT INTO "+gQ+" (digest, seq) VALUES (?,?)";aR.executeSql(bc,bd,function(){++aT===aQ.length&&aL()})})})}var aJ=aO.rows.item(0).cnt;if(!aJ){return aG(aK)}var aM=0,aN=10;aL()})}var aF="CREATE TABLE IF NOT EXISTS "+gQ+" (digest, seq INTEGER)";aE.executeSql(aF,[],function(aH){aH.executeSql(fk,[],function(aI){aI.executeSql(a4,[],aD)})})}function ax(aE,aF){var aD="ALTER TABLE "+v+" ADD COLUMN escaped TINYINT(1) DEFAULT 0";aE.executeSql(aD,[],aF)}function ak(aE,aF){var aD="ALTER TABLE "+i8+" ADD COLUMN max_seq INTEGER";aE.executeSql(aD,[],function(aG){var aH="UPDATE "+i8+" SET max_seq=(SELECT MAX(seq) FROM "+hm+" WHERE doc_id=id)";aG.executeSql(aH,[],function(aJ){var aI="CREATE UNIQUE INDEX IF NOT EXISTS 'doc-max-seq-idx' ON "+i8+" (max_seq)";aJ.executeSql(aI,[],aF)})})}function af(aD,aE){aD.executeSql('SELECT HEX("a") AS hex',[],function(aF,aH){var aG=aH.rows.item(0).hex;t=2===aG.length?"UTF-8":"UTF-16",aE()})}function ac(){for(;az.length>0;){var aD=az.pop();aD(null,ab)}}function ah(aO,aG){if(0===aG){var aJ="CREATE TABLE IF NOT EXISTS "+iC+" (dbid, db_version INTEGER)",aM="CREATE TABLE IF NOT EXISTS "+v+" (digest UNIQUE, escaped TINYINT(1), body BLOB)",aD="CREATE TABLE IF NOT EXISTS "+gQ+" (digest, seq INTEGER)",aF="CREATE TABLE IF NOT EXISTS "+i8+" (id unique, json, winningseq, max_seq INTEGER UNIQUE)",aE="CREATE TABLE IF NOT EXISTS "+hm+" (seq INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, json, deleted TINYINT(1), doc_id, rev)",aK="CREATE TABLE IF NOT EXISTS "+js+" (id UNIQUE, rev, json)";aO.executeSql(aM),aO.executeSql(aK),aO.executeSql(aD,[],function(){aO.executeSql(a4),aO.executeSql(fk)}),aO.executeSql(aF,[],function(){aO.executeSql(W),aO.executeSql(aE,[],function(){aO.executeSql(gr),aO.executeSql(fl),aO.executeSql(aJ,[],function(){var aP="INSERT INTO "+iC+" (db_version, dbid) VALUES (?,?)";ab=di();var aQ=[il,ab];aO.executeSql(aP,aQ,function(){ac()})})})})}else{var aI=function(){var aQ=il>aG;aQ&&aO.executeSql("UPDATE "+iC+" SET db_version = "+il);var aP="SELECT dbid FROM "+iC;aO.executeSql(aP,[],function(aR,aS){ab=aS.rows.item(0).dbid,ac()})},aL=[aw,aq,aj,aa,ax,ak,aI],aN=aG,aH=function(aP){aL[aN-1](aP,aH),aN++};aH(aO)}}function au(){av.transaction(function(aD){af(aD,function(){ap(aD)})},ir(ay),am)}function ap(aD){var aE="SELECT sql FROM sqlite_master WHERE tbl_name = "+iC;aD.executeSql(aE,[],function(aF,aG){aG.rows.length?/db_version/.test(aG.rows.item(0).sql)?aF.executeSql("SELECT db_version FROM "+iC,[],function(aI,aJ){var aH=aJ.rows.item(0).db_version;ah(aI,aH)}):aF.executeSql("ALTER TABLE "+iC+" ADD COLUMN db_version INTEGER",[],function(){ah(aF,1)}):ah(aF,0)})}function aB(aE,aF){if(-1!==ag._docCount){return aF(ag._docCount)}var aD=h2("COUNT("+i8+".id) AS 'num'",[i8,hm],ic,hm+".deleted=0");aE.executeSql(aD,[],function(aG,aH){ag._docCount=aH.rows.item(0).num,aF(ag._docCount)})}var t,ag=this,ab=null,aA=jb(ad),az=[];ag._docCount=-1,ag._name=ad.name;var aC=iv.extend({},ad,{version:iI,description:ad.name,size:aA}),al=hf(aC);if(al.error){return ir(ay)(al.error)}var av=al.db;"function"!=typeof av.readTransaction&&(av.readTransaction=av.transaction),au(),ag.type=function(){return"websql"},ag._id=fx(function(aD){aD(null,ab)}),ag._info=function(aD){av.readTransaction(function(aE){aB(aE,function(aF){var aG="SELECT MAX(seq) AS seq FROM "+hm;aE.executeSql(aG,[],function(aJ,aI){var aH=aI.rows.item(0).seq||0;aD(null,{doc_count:aF,update_seq:aH,sqlite_plugin:av._sqlitePlugin,websql_encoding:t})})})},ir(aD))},ag._bulkDocs=function(aF,aD,aE){hu(ad,aF,aD,ag,av,gn,aE)},ag._get=function(aD,aM,aF){function aI(){aF(aK,{doc:aH,metadata:aE,ctx:aG})}var aH,aE,aK,aG=aM.ctx;if(!aG){return av.readTransaction(function(aN){ag._get(aD,iv.extend({ctx:aN},aM),aF)})}var aJ,aL;aM.rev?(aJ=h2(a7,[i8,hm],i8+".id="+hm+".doc_id",[hm+".doc_id=?",hm+".rev=?"]),aL=[aD,aM.rev]):(aJ=h2(a7,[i8,hm],ic,i8+".id=?"),aL=[aD]),aG.executeSql(aJ,aL,function(aP,aO){if(!aO.rows.length){return aK=U(y,"missing"),aI()}var aN=aO.rows.item(0);return aE=g7(aN.metadata),aN.deleted&&!aM.rev?(aK=U(y,"deleted"),aI()):(aH=p(aN.data,aE.id,aN.rev),void aI())})},ag._allDocs=function(aQ,aG){var aF,aM=[],aK="startkey" in aQ?aQ.startkey:!1,aP="endkey" in aQ?aQ.endkey:!1,aI="key" in aQ?aQ.key:!1,aE="descending" in aQ?aQ.descending:!1,aH="limit" in aQ?aQ.limit:-1,aJ="skip" in aQ?aQ.skip:0,aN=aQ.inclusive_end!==!1,aD=[],aL=[];if(aI!==!1){aL.push(i8+".id = ?"),aD.push(aI)}else{if(aK!==!1||aP!==!1){if(aK!==!1&&(aL.push(i8+".id "+(aE?"<=":">=")+" ?"),aD.push(aK)),aP!==!1){var aO=aE?">":"<";aN&&(aO+="="),aL.push(i8+".id "+aO+" ?"),aD.push(aP)}aI!==!1&&(aL.push(i8+".id = ?"),aD.push(aI))}}"ok"!==aQ.deleted&&aL.push(hm+".deleted = 0"),av.readTransaction(function(aR){aB(aR,function(aS){if(aF=aS,0!==aH){var aT=h2(a7,[i8,hm],ic,aL,i8+".id "+(aE?"DESC":"ASC"));aT+=" LIMIT "+aH+" OFFSET "+aJ,aR.executeSql(aT,aD,function(aW,bd){for(var aU=0,ba=bd.rows.length;ba>aU;aU++){var aX=bd.rows.item(aU),aV=g7(aX.metadata),bb=aV.id,aY=p(aX.data,bb,aX.rev),aZ=aY._rev,bc={id:bb,key:bb,value:{rev:aZ}};if(aQ.include_docs&&(bc.doc=aY,bc.doc._rev=aZ,aQ.conflicts&&(bc.doc._conflicts=w(aV)),gU(bc.doc,aQ,ag,aW)),aX.deleted){if("ok"!==aQ.deleted){continue}bc.value.deleted=!0,bc.doc=null}aM.push(bc)}})}})},ir(aG),function(){aG(null,{total_rows:aF,offset:aQ.skip,rows:aM})})},ag._changes=function(aG){function aF(){var aN=i8+".json AS metadata, "+i8+".max_seq AS maxSeq, "+hm+".json AS winningDoc, "+hm+".rev AS winningRev ",aM=i8+" JOIN "+hm,aO=i8+".id="+hm+".doc_id AND "+i8+".winningseq="+hm+".seq",aP=["maxSeq > ?"],aR=[aG.since];aG.doc_ids&&(aP.push(i8+".id IN "+hJ(aG.doc_ids.length)),aR=aR.concat(aG.doc_ids));var aL="maxSeq "+(aJ?"DESC":"ASC"),aS=h2(aN,aM,aO,aP,aL),aT=D(aG);aG.view||aG.filter||(aS+=" LIMIT "+aE);var aQ=aG.since||0;av.readTransaction(function(aU){aU.executeSql(aS,aR,function(aY,aX){function aZ(bg){return function(){aG.onChange(bg)}}for(var ba=0,bd=aX.rows.length;bd>ba;ba++){var aV=aX.rows.item(ba),aW=g7(aV.metadata);aQ=aV.maxSeq;var bf=p(aV.winningDoc,aW.id,aV.winningRev),bb=aG.processChange(bf,aW,aG);bb.seq=aV.maxSeq;var bc=aT(bb);if("object"==typeof bc){return aG.complete(bc)}if(bc&&(aK++,aH&&aI.push(bb),aG.attachments&&aG.include_docs?gU(bf,aG,ag,aY,aZ(bb)):aZ(bb)()),aK===aE){break}}})},ir(aG.complete),function(){aG.continuous||aG.complete(null,{results:aI,last_seq:aQ})})}if(aG=es(aG),aG.continuous){var aD=ag._name+":"+di();return gn.addListener(ag._name,aD,ag,aG),gn.notify(ag._name),{cancel:function(){gn.removeListener(ag._name,aD)}}}var aJ=aG.descending;aG.since=aG.since&&!aJ?aG.since:0;var aE="limit" in aG?aG.limit:-1;0===aE&&(aE=1);var aH;aH="return_docs" in aG?aG.return_docs:"returnDocs" in aG?aG.returnDocs:!0;var aI=[],aK=0;aF()},ag._close=function(aD){aD()},ag._getAttachment=function(aD,aM,aF,aI,aH){var aE,aK=aI.ctx,aG=aF.digest,aJ=aF.content_type,aL="SELECT escaped, CASE WHEN escaped = 1 THEN body ELSE HEX(body) END AS body FROM "+v+" WHERE digest=?";aK.executeSql(aL,[aG],function(aP,aQ){var aO=aQ.rows.item(0),aN=aO.escaped?hq(aO.body):im(aO.body,t);aE=aI.binary?jp(aN,aJ):jy(aN),aH(null,aE)})},ag._getRevisionTree=function(aD,aE){av.readTransaction(function(aF){var aG="SELECT json AS metadata FROM "+i8+" WHERE id = ?";aF.executeSql(aG,[aD],function(aI,aH){if(aH.rows.length){var aJ=g7(aH.rows.item(0).metadata);aE(null,aJ.rev_tree)}else{aE(U(y))}})})},ag._doCompaction=function(aE,aF,aD){return aF.length?void av.transaction(function(aH){var aG="SELECT json AS metadata FROM "+i8+" WHERE id = ?";aH.executeSql(aG,[aE],function(aI,aK){var aJ=g7(aK.rows.item(0).metadata);F(aJ.rev_tree,function(aQ,aO,aR,aP,aM){var aN=aO+"-"+aR;-1!==aF.indexOf(aN)&&(aM.status="missing")});var aL="UPDATE "+i8+" SET json = ? WHERE id = ?";aI.executeSql(aL,[fW(aJ),aE])}),dt(aF,aE,aH)},ir(aD),function(){aD()}):aD()},ag._getLocal=function(aD,aE){av.readTransaction(function(aF){var aG="SELECT json, rev FROM "+js+" WHERE id=?";aF.executeSql(aG,[aD],function(aH,aJ){if(aJ.rows.length){var aI=aJ.rows.item(0),aK=p(aI.json,aD,aI.rev);aE(null,aK)}else{aE(U(y))}})})},ag._putLocal=function(aD,aI,aF){function aH(aO){var aM,aN;aE?(aM="UPDATE "+js+" SET rev=?, json=? WHERE id=? AND rev=?",aN=[aG,aJ,aK,aE]):(aM="INSERT INTO "+js+" (id, rev, json) VALUES (?,?,?)",aN=[aK,aG,aJ]),aO.executeSql(aM,aN,function(aP,aQ){aQ.rowsAffected?(aL={ok:!0,id:aK,rev:aG},aI.ctx&&aF(null,aL)):aF(U(jt))},function(){return aF(U(jt)),!1})}"function"==typeof aI&&(aF=aI,aI={}),delete aD._revisions;var aG,aE=aD._rev,aK=aD._id;aG=aE?aD._rev="0-"+(parseInt(aE.split("-")[1],10)+1):aD._rev="0-1";var aL,aJ=iR(aD);aI.ctx?aH(aI.ctx):av.transaction(aH,ir(aF),function(){aL&&aF(null,aL)})},ag._removeLocal=function(aE,aG,aH){function aF(aI){var aJ="DELETE FROM "+js+" WHERE id=? AND rev=?",aK=[aE._id,aE._rev];aI.executeSql(aJ,aK,function(aL,aM){return aM.rowsAffected?(aD={ok:!0,id:aE._id,rev:"0-0"},void (aG.ctx&&aH(null,aD))):aH(U(y))})}"function"==typeof aG&&(aH=aG,aG={});var aD;aG.ctx?aF(aG.ctx):av.transaction(aF,ir(aH),function(){aD&&aH(null,aD)})},ag._destroy=function(aD,aE){gn.removeAllListeners(ag._name),av.transaction(function(aF){var aG=[i8,hm,v,iC,js,gQ];aG.forEach(function(aH){aF.executeSql("DROP TABLE IF EXISTS "+aH,[])})},ir(aE),function(){fS()&&(delete window.localStorage["_pouch__websqldb_"+ag._name],delete window.localStorage[ag._name]),aE(null,{ok:!0})})}}function gx(){try{return openDatabase("_pouch_validate_websql",1,"",1),!0}catch(t){return !1}}function iP(){if("undefined"==typeof indexedDB||null===indexedDB||!/iP(hone|od|ad)/.test(navigator.userAgent)){return !0}var aa=fS(),ab="_pouch__websqldb_valid_"+navigator.userAgent;if(aa&&localStorage[ab]){return"1"===localStorage[ab]}var t=gx();return aa&&(localStorage[ab]=t?"1":"0"),t}function gF(){return"undefined"!=typeof SQLitePlugin?!0:"undefined"==typeof openDatabase?!1:iP()}function fw(t){return function(ad,aa,ac,ab){if("undefined"!=typeof sqlitePlugin){var af=iv.extend({},t,{name:ad,version:aa,description:ac,size:ab});return sqlitePlugin.openDatabase(af)}return openDatabase(ad,aa,ac,ab)}}function ai(aa,ac){var t=fw(aa),ab=iv.extend({websql:t},aa);i.call(this,ab,ac)}function bo(t){t.adapter("websql",ai,!0)}function fz(){for(var aa={},ac=new iQ(function(af,ad){aa.resolve=af,aa.reject=ad}),t=new Array(arguments.length),ab=0;ab<t.length;ab++){t[ab]=arguments[ab]}return aa.promise=ac,iQ.resolve().then(function(){return fetch.apply(null,t)}).then(function(ad){aa.resolve(ad)})["catch"](function(ad){aa.reject(ad)}),aa}function io(aa,ac){var ag,ab,t,ad=new Headers,af={method:aa.method,credentials:"include",headers:ad};return aa.json&&(ad.set("Accept","application/json"),ad.set("Content-Type",aa.headers["Content-Type"]||"application/json")),aa.body&&aa.body instanceof Blob?hI(aa.body,function(ah){af.body=ah}):aa.body&&aa.processData&&"string"!=typeof aa.body?af.body=JSON.stringify(aa.body):"body" in aa?af.body=aa.body:af.body=null,Object.keys(aa.headers).forEach(function(ah){aa.headers.hasOwnProperty(ah)&&ad.set(ah,aa.headers[ah])}),ag=fz(aa.url,af),aa.timeout>0&&(ab=setTimeout(function(){ag.reject(new Error("Load timeout for resource: "+aa.url))},aa.timeout)),ag.promise.then(function(ah){return t={statusCode:ah.status},aa.timeout>0&&clearTimeout(ab),t.statusCode>=200&&t.statusCode<300?aa.binary?ah.blob():ah.text():ah.json()}).then(function(ah){t.statusCode>=200&&t.statusCode<300?ac(null,t,ah):ac(ah,t)})["catch"](function(ah){ac(ah,t)}),{abort:ag.reject}}function a9(ac,t){var af,ah,ag=!1,ad=function(){af.abort()},ab=function(){ag=!0,af.abort()};af=ac.xhr?new ac.xhr:new XMLHttpRequest;try{af.open(ac.method,ac.url)}catch(aj){t(aj,{statusCode:413})}af.withCredentials="withCredentials" in ac?ac.withCredentials:!0,"GET"===ac.method?delete ac.headers["Content-Type"]:ac.json&&(ac.headers.Accept="application/json",ac.headers["Content-Type"]=ac.headers["Content-Type"]||"application/json",ac.body&&ac.processData&&"string"!=typeof ac.body&&(ac.body=JSON.stringify(ac.body))),ac.binary&&(af.responseType="arraybuffer"),"body" in ac||(ac.body=null);for(var aa in ac.headers){ac.headers.hasOwnProperty(aa)&&af.setRequestHeader(aa,ac.headers[aa])}return ac.timeout>0&&(ah=setTimeout(ab,ac.timeout),af.onprogress=function(){clearTimeout(ah),4!==af.readyState&&(ah=setTimeout(ab,ac.timeout))},"undefined"!=typeof af.upload&&(af.upload.onprogress=af.onprogress)),af.onreadystatechange=function(){if(4===af.readyState){var ak={statusCode:af.status};if(af.status>=200&&af.status<300){var am;am=ac.binary?ct([af.response||""],{type:af.getResponseHeader("Content-Type")}):af.responseText,t(null,ak,am)}else{var ap={};if(ag){ap=new Error("ETIMEDOUT"),ak.statusCode=400}else{try{ap=JSON.parse(af.response)}catch(al){}}t(ap,ak)}}},ac.body&&ac.body instanceof Blob?hI(ac.body,function(ak){af.send(ak)}):af.send(ac.body),{abort:ad}}function iL(){try{return new XMLHttpRequest,!0}catch(t){return !1}}function fd(t,aa){return iG||t.xhr?a9(t,aa):io(t,aa)}function je(){return""}function ih(ab,ad){function t(ag,ah,af){if(!ab.binary&&ab.json&&"string"==typeof ag){try{ag=JSON.parse(ag)}catch(aj){return af(aj)}}Array.isArray(ag)&&(ag=ag.map(function(ak){return ak.error||ak.missing?br(ak):ak})),ab.binary&&ex(ag,ah),af(null,ag,ah)}function ac(ak,af){var ah,al;if(ak.code&&ak.status){var aj=new Error(ak.message||ak.code);return aj.status=ak.status,af(aj)}if(ak.message&&"ETIMEDOUT"===ak.message){return af(ak)}try{ah=JSON.parse(ak.responseText),al=br(ah)}catch(ag){al=br(ak)}af(al)}ab=es(ab);var aa={method:"GET",headers:{},json:!0,processData:!0,timeout:10000,cache:!1};return ab=iv.extend(aa,ab),ab.json&&(ab.binary||(ab.headers.Accept="application/json"),ab.headers["Content-Type"]=ab.headers["Content-Type"]||"application/json"),ab.binary&&(ab.encoding=null,ab.json=!1),ab.processData||(ab.json=!1),fd(ab,function(aj,am,ag){if(aj){return aj.status=am?am.statusCode:400,ac(aj,ad)}var al,af=am.headers&&am.headers["content-type"],ah=ag||je();if(!ab.binary&&(ab.json||!ab.processData)&&"object"!=typeof ah&&(/json/.test(af)||/^[\s]*\{/.test(ah)&&/\}[\s]*$/.test(ah))){try{ah=JSON.parse(ah.toString())}catch(ak){}}am.statusCode>=200&&am.statusCode<300?t(ah,am,ad):(al=br(ah),al.status=am.statusCode,ad(al))})}function g6(ac,ak){var af=navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",ah=-1!==af.indexOf("safari")&&-1===af.indexOf("chrome"),ag=-1!==af.indexOf("msie"),ad=-1!==af.indexOf("edge"),aa=ah||(ag||ad)&&"GET"===ac.method,aj="cache" in ac?ac.cache:!0,t=/^blob:/.test(ac.url);if(!t&&(aa||!aj)){var ab=-1!==ac.url.indexOf("?");ac.url+=(ab?"&":"?")+"_nonce="+Date.now()}return ih(ac,ak)}function i4(t){var aa=t.doc&&t.doc._attachments;aa&&Object.keys(aa).forEach(function(ac){var ab=aa[ac];ab.data=iu(ab.data,ab.content_type)})}function hV(t){return/^_design/.test(t)?"_design/"+encodeURIComponent(t.slice(8)):/^_local/.test(t)?"_local/"+encodeURIComponent(t.slice(7)):encodeURIComponent(t)}function hx(t){return t._attachments&&Object.keys(t._attachments)?iQ.all(Object.keys(t._attachments).map(function(ab){var aa=t._attachments[ab];return aa.data&&"string"!=typeof aa.data?new iQ(function(ac){h6(aa.data,ac)}).then(function(ac){aa.data=ac}):void 0})):iQ.resolve()}function l(aa){var ab=I(aa);(ab.user||ab.password)&&(ab.auth={username:ab.user,password:ab.password});var t=ab.path.replace(/(^\/|\/$)/g,"").split("/");return ab.db=t.pop(),-1===ab.db.indexOf("%")&&(ab.db=encodeURIComponent(ab.db)),ab.path=t.join("/"),ab}function gO(t,aa){return he(t,t.db+"/"+aa)}function he(aa,ab){var t=aa.path?"/":"";return aa.protocol+"://"+aa.host+(aa.port?":"+aa.port:"")+"/"+aa.path+t+ab}function jg(t){return"?"+Object.keys(t).map(function(aa){return aa+"="+encodeURIComponent(t[aa])}).join("&")}function ar(ac,aq){function ab(ax,az,aA){var ay=ax.ajax||{},aw=iv.extend(es(ag),ay,az);return hP(aw.method+" "+aw.url),ap._ajax(aw,aA)}function ah(aw,ax){return new iQ(function(az,ay){ab(aw,ax,function(aA,aB){return aA?ay(aA):void az(aB)})})}function af(aw,ax){return ev(aw,g0(function(ay){ak().then(function(){return ax.apply(this,ay)})["catch"](function(az){var aA=ay.pop();aA(az)})}))}function ak(){if(ac.skipSetup||ac.skip_setup){return iQ.resolve()}if(aj){return aj}var aw={method:"GET",url:al};return aj=ah({},aw)["catch"](function(ax){return ax&&ax.status&&404===ax.status?(fv(404,"PouchDB is just detecting if the remote exists."),ah({},{method:"PUT",url:al})):iQ.reject(ax)})["catch"](function(ax){return ax&&ax.status&&412===ax.status?!0:iQ.reject(ax)}),aj["catch"](function(){aj=null}),aj}function aa(aw){return aw.split("/").map(encodeURIComponent).join("/")}var ap=this,au=l;ac.getHost&&(au=ac.getHost);var ad=au(ac.name,ac),al=gO(ad,"");ac=es(ac);var ag=ac.ajax||{};if(ap.getUrl=function(){return al},ap.getHeaders=function(){return ag.headers||{}},ac.auth||ad.auth){var av=ac.auth||ad.auth,t=av.username+":"+av.password,am=jy(unescape(encodeURIComponent(t)));ag.headers=ag.headers||{},ag.headers.Authorization="Basic "+am}ap._ajax=g6;var aj;setTimeout(function(){aq(null,ap)}),ap.type=function(){return"http"},ap.id=af("id",function(aw){ab({},{method:"GET",url:he(ad,"")},function(az,ax){var ay=ax&&ax.uuid?ax.uuid+ad.db:gO(ad,"");aw(null,ay)})}),ap.request=af("request",function(aw,ax){aw.url=gO(ad,aw.url),ab({},aw,ax)}),ap.compact=af("compact",function(aw,ax){"function"==typeof aw&&(ax=aw,aw={}),aw=es(aw),ab(aw,{url:gO(ad,"_compact"),method:"POST"},function(){function ay(){ap.info(function(az,aA){aA&&!aA.compact_running?ax(null,{ok:!0}):setTimeout(ay,aw.interval||200)})}ay()})}),ap.bulkGet=ev("bulkGet",function(az,aw){function aB(aD){var aE={};az.revs&&(aE.revs=!0),az.attachments&&(aE.attachments=!0),ab({},{url:gO(ad,"_bulk_get"+jg(aE)),method:"POST",body:{docs:az.docs}},aD)}function ay(){function aI(aK){return function(aM,aL){aF[aK]=aL.results,++aH===aD&&aw(null,{results:fp(aF)})}}for(var aE=gd,aD=Math.ceil(az.docs.length/aE),aH=0,aF=new Array(aD),aG=0;aD>aG;aG++){var aJ=fi(az,["revs","attachments"]);aJ.ajax=ag,aJ.docs=az.docs.slice(aG*aE,Math.min(az.docs.length,(aG+1)*aE)),Y(ax,aJ,aI(aG))}}var ax=this,aA=he(ad,""),aC=gZ[aA];"boolean"!=typeof aC?aB(function(aF,aE){if(aF){var aD=Math.floor(aF.status/100);4===aD||5===aD?(gZ[aA]=!1,fv(aF.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),ay()):aw(aF)}else{gZ[aA]=!0,aw(null,aE)}}):aC?aB(aw):ay()}),ap._info=function(aw){ak().then(function(){ab({},{method:"GET",url:gO(ad,"")},function(ay,ax){return ay?aw(ay):(ax.host=gO(ad,""),void aw(null,ax))})})["catch"](aw)},ap.get=af("get",function(aB,aw,az){function ay(aE){var aD=aE._attachments,aF=aD&&Object.keys(aD);return aD&&aF.length?iQ.all(aF.map(function(aG){var aI=aD[aG],aH=hV(aE._id)+"/"+aa(aG)+"?rev="+aE._rev;return ah(aw,{method:"GET",url:gO(ad,aH),binary:!0}).then(function(aJ){return aw.binary?aJ:new iQ(function(aK){h6(aJ,aK)})}).then(function(aJ){delete aI.stub,delete aI.length,aI.data=aJ})})):void 0}function ax(aD){return Array.isArray(aD)?iQ.all(aD.map(function(aE){return aE.ok?ay(aE.ok):void 0})):ay(aD)}"function"==typeof aw&&(az=aw,aw={}),aw=es(aw);var aC={};aw.revs&&(aC.revs=!0),aw.revs_info&&(aC.revs_info=!0),aw.open_revs&&("all"!==aw.open_revs&&(aw.open_revs=JSON.stringify(aw.open_revs)),aC.open_revs=aw.open_revs),aw.rev&&(aC.rev=aw.rev),aw.conflicts&&(aC.conflicts=aw.conflicts),aB=hV(aB);var aA={method:"GET",url:gO(ad,aB+jg(aC))};ah(aw,aA).then(function(aD){return iQ.resolve().then(function(){return aw.attachments?ax(aD):void 0}).then(function(){az(null,aD)})})["catch"](az)}),ap.remove=af("remove",function(aA,aw,aB,ay){var ax;"string"==typeof aw?(ax={_id:aA,_rev:aw},"function"==typeof aB&&(ay=aB,aB={})):(ax=aA,"function"==typeof aw?(ay=aw,aB={}):(ay=aB,aB=aw));var az=ax._rev||aB.rev;ab(aB,{method:"DELETE",url:gO(ad,hV(ax._id))+"?rev="+az},ay)}),ap.getAttachment=af("getAttachment",function(aA,ax,aB,ay){"function"==typeof aB&&(ay=aB,aB={});var az=aB.rev?"?rev="+aB.rev:"",aw=gO(ad,hV(aA))+"/"+aa(ax)+az;ab(aB,{method:"GET",url:aw,binary:!0},ay)}),ap.removeAttachment=af("removeAttachment",function(aA,ax,aw,az){var ay=gO(ad,hV(aA)+"/"+aa(ax))+"?rev="+aw;ab({},{method:"DELETE",url:ay},az)}),ap.putAttachment=af("putAttachment",function(aF,aB,az,ay,aw,aA){"function"==typeof aw&&(aA=aw,aw=ay,ay=az,az=null);var aC=hV(aF)+"/"+aa(aB),aD=gO(ad,aC);if(az&&(aD+="?rev="+az),"string"==typeof ay){var ax;try{ax=it(ay)}catch(aE){return aA(U(gB,"Attachment is not a valid base64 string"))}ay=ax?jp(ax,aw):""}var aG={headers:{"Content-Type":aw},method:"PUT",url:aD,processData:!1,body:ay,timeout:ag.timeout||60000};ab({},aG,aA)}),ap._bulkDocs=function(aw,ay,ax){aw.new_edits=ay.new_edits,ak().then(function(){return iQ.all(aw.docs.map(hx))}).then(function(){ab(ay,{method:"POST",url:gO(ad,"_bulk_docs"),body:aw},function(aA,az){return aA?ax(aA):(az.forEach(function(aB){aB.ok=!0}),void ax(null,az))})})["catch"](ax)},ap.allDocs=af("allDocs",function(aB,aw){"function"==typeof aB&&(aw=aB,aB={}),aB=es(aB);var ay,az={},ax="GET";aB.conflicts&&(az.conflicts=!0),aB.descending&&(az.descending=!0),aB.include_docs&&(az.include_docs=!0),aB.attachments&&(az.attachments=!0),aB.key&&(az.key=JSON.stringify(aB.key)),aB.start_key&&(aB.startkey=aB.start_key),aB.startkey&&(az.startkey=JSON.stringify(aB.startkey)),aB.end_key&&(aB.endkey=aB.end_key),aB.endkey&&(az.endkey=JSON.stringify(aB.endkey)),"undefined"!=typeof aB.inclusive_end&&(az.inclusive_end=!!aB.inclusive_end),"undefined"!=typeof aB.limit&&(az.limit=aB.limit),"undefined"!=typeof aB.skip&&(az.skip=aB.skip);var aA=jg(az);if("undefined"!=typeof aB.keys){var aC="keys="+encodeURIComponent(JSON.stringify(aB.keys));aC.length+aA.length+1<=iY?aA+="&"+aC:(ax="POST",ay={keys:aB.keys})}ah(aB,{method:ax,url:gO(ad,"_all_docs"+aA),body:ay}).then(function(aD){aB.include_docs&&aB.attachments&&aB.binary&&aD.rows.forEach(i4),aw(null,aD)})["catch"](aw)}),ap._changes=function(aH){var az="batch_size" in aH?aH.batch_size:i7;aH=es(aH),aH.timeout="timeout" in aH?aH.timeout:"timeout" in ag?ag.timeout:30000;var aB,ax=aH.timeout?{timeout:aH.timeout-5000}:{},aE="undefined"!=typeof aH.limit?aH.limit:!1;aB="return_docs" in aH?aH.return_docs:"returnDocs" in aH?aH.returnDocs:!0;var ay=aE;if(aH.style&&(ax.style=aH.style),(aH.include_docs||aH.filter&&"function"==typeof aH.filter)&&(ax.include_docs=!0),aH.attachments&&(ax.attachments=!0),aH.continuous&&(ax.feed="longpoll"),aH.conflicts&&(ax.conflicts=!0),aH.descending&&(ax.descending=!0),"heartbeat" in aH?aH.heartbeat&&(ax.heartbeat=aH.heartbeat):ax.heartbeat=10000,aH.filter&&"string"==typeof aH.filter&&(ax.filter=aH.filter),aH.view&&"string"==typeof aH.view&&(ax.filter="_view",ax.view=aH.view),aH.query_params&&"object"==typeof aH.query_params){for(var aA in aH.query_params){aH.query_params.hasOwnProperty(aA)&&(ax[aA]=aH.query_params[aA])}}var aK,aG="GET";if(aH.doc_ids){ax.filter="_doc_ids";var aJ=JSON.stringify(aH.doc_ids);aJ.length<iY?ax.doc_ids=aJ:(aG="POST",aK={doc_ids:aH.doc_ids})}var aC,aF,aD=function(aM,aN){if(!aH.aborted){ax.since=aM,"object"==typeof ax.since&&(ax.since=JSON.stringify(ax.since)),aH.descending?aE&&(ax.limit=ay):ax.limit=!aE||ay>az?az:ay;var aL={method:aG,url:gO(ad,"_changes"+jg(ax)),timeout:aH.timeout,body:aK};aF=aM,aH.aborted||ak().then(function(){aC=ab(aH,aL,aN)})["catch"](aN)}},aw={results:[]},aI=function(aN,aL){if(!aH.aborted){var aM=0;if(aL&&aL.results){aM=aL.results.length,aw.last_seq=aL.last_seq;var aP={};aP.query=aH.query_params,aL.results=aL.results.filter(function(aR){ay--;var aQ=D(aH)(aR);return aQ&&(aH.include_docs&&aH.attachments&&aH.binary&&i4(aR),aB&&aw.results.push(aR),aH.onChange(aR)),aQ})}else{if(aN){return aH.aborted=!0,void aH.complete(aN)}}aL&&aL.last_seq&&(aF=aL.last_seq);var aO=aE&&0>=ay||aL&&az>aM||aH.descending;(!aH.continuous||aE&&0>=ay)&&aO?aH.complete(null,aw):setTimeout(function(){aD(aF,aI)},0)}};return aD(aH.since||0,aI),{cancel:function(){aH.aborted=!0,aC&&aC.abort()}}},ap.revsDiff=af("revsDiff",function(aw,ay,ax){"function"==typeof ay&&(ax=ay,ay={}),ab(ay,{method:"POST",url:gO(ad,"_revs_diff"),body:aw},ax)}),ap._close=function(aw){aw()},ap._destroy=function(aw,ax){ab(aw,{url:gO(ad,""),method:"DELETE"},function(az,ay){return az&&az.status&&404!==az.status?ax(az):void ax(null,ay)})}}function hY(t){t.adapter("http",ar,!1),t.adapter("https",ar,!1)}function jh(){this.promise=new iQ(function(t){t()})}function fX(t){var ac=t.db,ag=t.viewName,aa=t.map,ah=t.reduce,ad=t.temporary,af=aa.toString()+(ah&&ah.toString())+"undefined";if(!ad&&ac._cachedViews){var ab=ac._cachedViews[af];if(ab){return iQ.resolve(ab)}}return ac.info().then(function(ak){function al(am){am.views=am.views||{};var aq=ag;-1===aq.indexOf("/")&&(aq=ag+"/"+ag);var ap=am.views[aq]=am.views[aq]||{};if(!ap[aj]){return ap[aj]=!0,am}}var aj=ak.db_name+"-mrview-"+(ad?"temp":ao(af));return C(ac,"_local/mrviews",al).then(function(){return ac.registerDependentDatabase(aj).then(function(ap){var am=ap.db;am.auto_compaction=!0;var aq={name:aj,db:am,sourceDB:ac,adapter:ac.adapter,mapFun:aa,reduceFun:ah};return aq.db.get("_local/lastSeq")["catch"](function(au){if(404!==au.status){throw au}}).then(function(au){return aq.seq=au?au.seq:0,ad||(ac._cachedViews=ac._cachedViews||{},ac._cachedViews[af]=aq,aq.db.once("destroyed",function(){delete ac._cachedViews[af]})),aq})})})})}function gA(ab,ad,t,ac,aa,af){return ij("return ("+ab.replace(/;\s*$/,"")+");",{emit:ad,sum:t,log:ac,isArray:aa,toJSON:af})}function hK(t){return -1===t.indexOf("/")?[t,t]:t.split("/")}function bt(t){return 1===t.length&&/^1-/.test(t[0].rev)}function ei(aa,ab){try{aa.emit("error",ab)}catch(t){S("error","The user's map/reduce function threw an uncaught error.\nYou can debug this error by doing:\nmyDatabase.on('error', function (err) { debugger; });\nPlease double-check your map/reduce function."),S("error",ab)}}function ip(aa,ac,t){try{return{output:ac.apply(null,t)}}catch(ab){return ei(aa,ab),{error:ab}}}function jx(aa,ab){var t=ho.collate(aa.key,ab.key);return 0!==t?t:ho.collate(aa.value,ab.value)}function fm(aa,ab,t){return t=t||0,"number"==typeof ab?aa.slice(t,ab+t):t>0?aa.slice(t):aa}function iU(aa){var ab=aa.value,t=ab&&"object"==typeof ab&&ab._id||aa.id;return t}function h5(t){t.rows.forEach(function(aa){var ab=aa.doc&&aa.doc._attachments;ab&&Object.keys(ab).forEach(function(ad){var ac=ab[ad];ab[ad].data=iu(ac.data,ac.content_type)})})}function gW(t){return function(aa){return t.include_docs&&t.attachments&&t.binary&&h5(aa),aa}}function E(t){var aa="builtin "+t+" function requires map values to be numbers or number arrays";return new fe(aa)}function id(t){for(var ac=0,ag=0,aa=t.length;aa>ag;ag++){var ah=t[ag];if("number"!=typeof ah){if(!Array.isArray(ah)){throw E("_sum")}ac="number"==typeof ac?[ac]:ac;for(var ad=0,af=ah.length;af>ad;ad++){var ab=ah[ad];if("number"!=typeof ab){throw E("_sum")}"undefined"==typeof ac[ad]?ac.push(ab):ac[ad]+=ab}}else{"number"==typeof ac?ac+=ah:ac[0]+=ah}}return ac}function jC(ab,ad,t,ac){var aa=ad[ab];"undefined"!=typeof aa&&(ac&&(aa=encodeURIComponent(JSON.stringify(aa))),t.push(ab+"="+aa))}function hy(t){if("undefined"!=typeof t){var aa=Number(t);return isNaN(aa)||aa!==parseInt(t,10)?t:aa}}function hh(t){return t.group_level=hy(t.group_level),t.limit=hy(t.limit),t.skip=hy(t.skip),t}function iM(t){if(t){if("number"!=typeof t){return new V('Invalid value for integer: "'+t+'"')}if(0>t){return new V('Invalid value for positive integer: "'+t+'"')}}}function i2(aa,ac){var t=aa.descending?"endkey":"startkey",ab=aa.descending?"startkey":"endkey";if("undefined"!=typeof aa[t]&&"undefined"!=typeof aa[ab]&&ho.collate(aa[t],aa[ab])>0){throw new V("No rows can match your key range, reverse your start_key and end_key or set {descending : true}")}if(ac.reduce&&aa.reduce!==!1){if(aa.include_docs){throw new V("{include_docs:true} is invalid for reduce")}if(aa.keys&&aa.keys.length>1&&!aa.group&&!aa.group_level){throw new V("Multi-key fetches for reduce views must use {group: true}")}}["group_level","limit","skip"].forEach(function(af){var ad=iM(aa[af]);if(ad){throw ad}})}function hw(ac,t,af){var ah,ag=[],ad="GET";if(jC("reduce",af,ag),jC("include_docs",af,ag),jC("attachments",af,ag),jC("limit",af,ag),jC("descending",af,ag),jC("group",af,ag),jC("group_level",af,ag),jC("skip",af,ag),jC("stale",af,ag),jC("conflicts",af,ag),jC("startkey",af,ag,!0),jC("start_key",af,ag,!0),jC("endkey",af,ag,!0),jC("end_key",af,ag,!0),jC("inclusive_end",af,ag),jC("key",af,ag,!0),ag=ag.join("&"),ag=""===ag?"":"?"+ag,"undefined"!=typeof af.keys){var ab=2000,aj="keys="+encodeURIComponent(JSON.stringify(af.keys));aj.length+ag.length+1<=ab?ag+=("?"===ag[0]?"&":"?")+aj:(ad="POST","string"==typeof t?ah={keys:af.keys}:t.keys=af.keys)}if("string"==typeof t){var aa=hK(t);return ac.request({method:ad,url:"_design/"+aa[0]+"/_view/"+aa[1]+ag,body:ah}).then(gW(af))}return ah=ah||{},Object.keys(t).forEach(function(ak){Array.isArray(t[ak])?ah[ak]=t[ak]:ah[ak]=t[ak].toString()}),ac.request({method:"POST",url:"_temp_view"+ag,body:ah}).then(gW(af))}function hW(aa,ab,t){return new iQ(function(ad,ac){aa._query(ab,t,function(af,ag){return af?ac(af):void ad(ag)})})}function g8(t){return new iQ(function(ab,aa){t._viewCleanup(function(ac,ad){return ac?aa(ac):void ab(ad)})})}function ii(t){return function(aa){if(404===aa.status){return t}throw aa}}function i6(ab,ak,af){function ah(){return bt(ac)?iQ.resolve(aj):ak.db.get(t)["catch"](ii(aj))}function ag(am){return am.keys.length?ak.db.allDocs({keys:am.keys,include_docs:!0}):iQ.resolve({rows:[]})}function ad(am,ay){for(var au=[],aw={},av=0,aq=ay.rows.length;aq>av;av++){var aA=ay.rows[av],ax=aA.doc;if(ax&&(au.push(ax),aw[ax._id]=!0,ax._deleted=!aa[ax._id],!ax._deleted)){var az=aa[ax._id];"value" in az&&(ax.value=az.value)}}var ap=Object.keys(aa);return ap.forEach(function(aD){if(!aw[aD]){var aB={_id:aD},aC=aa[aD];"value" in aC&&(aB.value=aC.value),au.push(aB)}}),am.keys=i9(ap.concat(am.keys)),au.push(am),au}var t="_local/doc_"+ab,aj={_id:t,keys:[]},al=af[ab],aa=al.indexableKeysToKeyValues,ac=al.changes;return ah().then(function(am){return ag(am).then(function(ap){return ad(am,ap)})})}function hl(aa,ac,t){var ab="_local/lastSeq";return aa.db.get(ab)["catch"](ii({_id:ab,seq:0})).then(function(af){var ad=Object.keys(ac);return iQ.all(ad.map(function(ag){return i6(ag,aa,ac)})).then(function(ag){var ah=fp(ag);return af.seq=t,ah.push(af),aa.db.bulkDocs({docs:ah})})})}function r(aa){var ab="string"==typeof aa?aa:aa.name,t=fs[ab];return t||(t=fs[ab]=new jh),t}function jr(t){return i0(r(t),function(){return iB(t)})()}function iB(ac){function t(am,ak){var al={id:ag._id,key:ho.normalizeKey(am)};"undefined"!=typeof ak&&null!==ak&&(al.value=ho.normalizeKey(ak)),ah.push(al)}function af(ak,al){return function(){return hl(ac,ak,al)}}var ah,ag,ad;if("function"==typeof ac.mapFun&&2===ac.mapFun.length){var ab=ac.mapFun;ad=function(ak){return ab(ak,t)}}else{ad=gA(ac.mapFun.toString(),t,id,jf,Array.isArray,JSON.parse)}var aj=ac.seq||0,aa=new jh;return new iQ(function(ap,ak){function al(){aa.finish().then(function(){ac.seq=aj,ap()})}function am(){function aq(au){ak(au)}ac.sourceDB.changes({conflicts:!0,include_docs:!0,style:"all_docs",since:aj,limit:hR}).on("complete",function(aA){var aF=aA.results;if(!aF.length){return al()}for(var ay={},av=0,ax=aF.length;ax>av;av++){var aE=aF[av];if("_"!==aE.doc._id[0]){ah=[],ag=aE.doc,ag._deleted||ip(ac.sourceDB,ad,[ag]),ah.sort(jx);for(var aB,aG={},aC=0,az=ah.length;az>aC;aC++){var aw=ah[aC],au=[aw.key,aw.id];0===ho.collate(aw.key,aB)&&au.push(aC);var aD=ho.toIndexableString(au);aG[aD]=aw,aB=aw.key}ay[aE.doc._id]={indexableKeysToKeyValues:aG,changes:aE.changes}}aj=aE.seq}return aa.add(af(ay,aj)),aF.length<hR?al():am()}).on("error",aq)}am()})}function gP(ab,ak,af){0===af.group_level&&delete af.group_level;var ah,ag=af.group||af.group_level;ah=fr[ab.reduceFun]?fr[ab.reduceFun]:gA(ab.reduceFun.toString(),null,id,jf,Array.isArray,JSON.parse);var ad=[],t=isNaN(af.group_level)?Number.POSITIVE_INFINITY:af.group_level;ak.forEach(function(aq){var am=ad[ad.length-1],ap=ag?aq.key:null;return ag&&Array.isArray(ap)&&(ap=ap.slice(0,t)),am&&0===ho.collate(am.groupKey,ap)?(am.keys.push([aq.key,aq.id]),void am.values.push(aq.value)):void ad.push({keys:[[aq.key,aq.id]],values:[aq.value],groupKey:ap})}),ak=[];for(var aj=0,al=ad.length;al>aj;aj++){var aa=ad[aj],ac=ip(ab.sourceDB,ah,[aa.keys,aa.values,!1]);if(ac.error&&ac.error instanceof fe){throw ac.error}ak.push({value:ac.error?null:ac.output,key:aa.groupKey})}return{rows:fm(ak,af.limit,af.skip)}}function f(t,aa){return i0(r(t),function(){return gm(t,aa)})()}function gm(t,aj){function af(aq){return aq.include_docs=!0,t.db.allDocs(aq).then(function(au){return ag=au.total_rows,au.rows.map(function(av){if("value" in av.doc&&"object"==typeof av.doc.value&&null!==av.doc.value){var ax=Object.keys(av.doc.value).sort(),ay=["id","key","value"];if(!(ay>ax||ax>ay)){return av.doc.value}}var aw=ho.parseIndexableString(av.doc._id);return{key:aw[0],id:aw[1],value:"value" in av.doc?av.doc.value:null}})})}function ah(av){var aq;if(aq=ac?gP(t,av,aj):{total_rows:ag,offset:al,rows:av},aj.include_docs){var au=i9(av.map(iU));return t.sourceDB.allDocs({keys:au,include_docs:!0,conflicts:aj.conflicts,attachments:aj.attachments,binary:aj.binary}).then(function(aw){var ax={};return aw.rows.forEach(function(ay){ay.doc&&(ax["$"+ay.id]=ay.doc)}),av.forEach(function(ay){var aA=iU(ay),az=ax["$"+aA];az&&(ay.doc=az)}),aq})}return aq}var ag,ac=t.reduceFun&&aj.reduce!==!1,al=aj.skip||0;if("undefined"==typeof aj.keys||aj.keys.length||(aj.limit=0,delete aj.keys),"undefined"!=typeof aj.keys){var ab=aj.keys,ak=ab.map(function(aq){var au={startkey:ho.toIndexableString([aq]),endkey:ho.toIndexableString([aq,{}])};return af(au)});return iQ.all(ak).then(fp).then(ah)}var am={descending:aj.descending};if(aj.start_key&&(aj.startkey=aj.start_key),aj.end_key&&(aj.endkey=aj.end_key),"undefined"!=typeof aj.startkey&&(am.startkey=aj.descending?ho.toIndexableString([aj.startkey,{}]):ho.toIndexableString([aj.startkey])),"undefined"!=typeof aj.endkey){var aa=aj.inclusive_end!==!1;aj.descending&&(aa=!aa),am.endkey=ho.toIndexableString(aa?[aj.endkey,{}]:[aj.endkey])}if("undefined"!=typeof aj.key){var ad=ho.toIndexableString([aj.key]),ap=ho.toIndexableString([aj.key,{}]);am.descending?(am.endkey=ad,am.startkey=ap):(am.startkey=ad,am.endkey=ap)}return ac||("number"==typeof aj.limit&&(am.limit=aj.limit),am.skip=al),af(am).then(ah)}function iH(t){return t.request({method:"POST",url:"_view_cleanup"})}function gp(t){return t.get("_local/mrviews").then(function(ac){var aa={};Object.keys(ac.views).forEach(function(ad){var ag=hK(ad),af="_design/"+ag[0],ah=ag[1];aa[af]=aa[af]||{},aa[af][ah]=!0});var ab={keys:Object.keys(aa),include_docs:!0};return t.allDocs(ab).then(function(ad){var ah={};ad.rows.forEach(function(aj){var ak=aj.key.substring(8);Object.keys(aa[aj.key]).forEach(function(al){var ap=ak+"/"+al;ac.views[ap]||(ap=al);var aq=Object.keys(ac.views[ap]),am=aj.doc&&aj.doc.views&&aj.doc.views[al];aq.forEach(function(au){ah[au]=ah[au]||am})})});var af=Object.keys(ah).filter(function(aj){return !ah[aj]}),ag=af.map(function(aj){return i0(r(aj),function(){return new t.constructor(aj,t.__opts).destroy()})()});return iQ.all(ag).then(function(){return{ok:!0}})})},ii({ok:!0}))}function fj(ah,ab,t){if("http"===ah.type()){return hw(ah,ab,t)}if("function"==typeof ah._query){return hW(ah,ab,t)}if("string"!=typeof ab){i2(t,ab);var ag={db:ah,viewName:"temp_view/temp_view",map:ab.map,reduce:ab.reduce,temporary:!0};return X.add(function(){return fX(ag).then(function(ak){function aj(){return ak.db.destroy()}return gt(jr(ak).then(function(){return f(ak,t)}),aj)})}),X.finish()}var ac=ab,af=hK(ac),aa=af[0],ad=af[1];return ah.get("_design/"+aa).then(function(al){var ak=al.views&&al.views[ad];if(!ak||"string"!=typeof ak.map){throw new a3("ddoc "+aa+" has no view named "+ad)}i2(t,ak);var aj={db:ah,viewName:ac,map:ak.map,reduce:ak.reduce};return fX(aj).then(function(am){return"ok"===t.stale||"update_after"===t.stale?("update_after"===t.stale&&fV.nextTick(function(){jr(am)}),f(am,t)):jr(am).then(function(){return f(am,t)})})})}function V(t){this.status=400,this.name="query_parse_error",this.message=t,this.error=!0;try{Error.captureStackTrace(this,V)}catch(aa){}}function a3(t){this.status=404,this.name="not_found",this.message=t,this.error=!0;try{Error.captureStackTrace(this,a3)}catch(aa){}}function fe(t){this.status=500,this.name="invalid_value",this.message=t,this.error=!0;try{Error.captureStackTrace(this,fe)}catch(aa){}}function ib(t){return/^1-/.test(t)}function a5(aa,ab,t){return !aa._attachments||!aa._attachments[t]||aa._attachments[t].digest!==ab._attachments[t].digest}function iE(aa,ab){var t=Object.keys(ab._attachments);return iQ.all(t.map(function(ac){return aa.getAttachment(ab._id,ac,{rev:ab._rev})}))}function ew(ab,ad,t){var ac="http"===ad.type()&&"http"!==ab.type(),aa=Object.keys(t._attachments);return ac?ab.get(t._id).then(function(af){return iQ.all(aa.map(function(ag){return a5(af,t,ag)?ad.getAttachment(t._id,ag):ab.getAttachment(af._id,ag)}))})["catch"](function(af){if(404!==af.status){throw af}return iE(ad,t)}):iE(ad,t)}function hc(t){var aa=[];return Object.keys(t).forEach(function(ab){var ac=t[ab].missing;ac.forEach(function(ad){aa.push({id:ab,rev:ad})})}),{docs:aa,revs:!0}}function gc(t,aj,ad,ag){function af(){var am=hc(ad);if(am.docs.length){return t.bulkGet(am).then(function(ap){if(ag.cancelled){throw new Error("cancelled")}return iQ.all(ap.results.map(function(aq){return iQ.all(aq.docs.map(function(au){var av=au.ok;return au.error&&(ac=!1),av&&av._attachments?ew(aj,t,av).then(function(aw){var ax=Object.keys(av._attachments);return aw.forEach(function(az,aA){var ay=av._attachments[ax[aA]];delete ay.stub,delete ay.length,ay.data=az}),av}):av}))})).then(function(aq){aa=aa.concat(fp(aq).filter(Boolean))})})}}function ab(am){return am._attachments&&Object.keys(am._attachments).length>0}function al(am){return t.allDocs({keys:am,include_docs:!0}).then(function(ap){if(ag.cancelled){throw new Error("cancelled")}ap.rows.forEach(function(aq){!aq.deleted&&aq.doc&&ib(aq.value.rev)&&!ab(aq.doc)&&(aa.push(aq.doc),delete ad[aq.id])})})}function ah(){var am=Object.keys(ad).filter(function(aq){var ap=ad[aq].missing;return 1===ap.length&&ib(ap[0])});return am.length>0?al(am):void 0}function ak(){return{ok:ac,docs:aa}}ad=es(ad);var aa=[],ac=!0;return iQ.resolve().then(ah).then(af).then(ak)}function gX(ab,ad,t,ac,aa){return ab.get(ad)["catch"](function(af){if(404===af.status){return"http"===ab.type()&&fv(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:ac,_id:ad,history:[],replicator:ie,version:hb}}throw af}).then(function(af){return aa.cancelled?void 0:(af.history=(af.history||[]).filter(function(ag){return ag.session_id!==ac}),af.history.unshift({last_seq:t,session_id:ac}),af.history=af.history.slice(0,jw),af.version=hb,af.replicator=ie,af.session_id=ac,af.last_seq=t,ab.put(af)["catch"](function(ag){if(409===ag.status){return gX(ab,ad,t,ac,aa)}throw ag}))})}function iW(aa,ac,t,ab){this.src=aa,this.target=ac,this.id=t,this.returnValue=ab}function hN(t,aa){return t.session_id===aa.session_id?{last_seq:t.last_seq,history:t.history}:hD(t.history,aa.history)}function hD(t,ac){var ag=t[0],aa=t.slice(1),ah=ac[0],ad=ac.slice(1);if(!ag||0===ac.length){return{last_seq:fh,history:[]}}var af=ag.session_id;if(n(af,ac)){return{last_seq:ag.last_seq,history:t}}var ab=ah.session_id;return n(ab,aa)?{last_seq:ah.last_seq,history:ad}:hD(aa,ad)}function n(aa,ac){var t=ac[0],ab=ac.slice(1);return aa&&0!==ac.length?aa===t.session_id?!0:n(aa,ab):!1}function gS(t){return"number"==typeof t.status&&4===Math.floor(t.status/100)}function hi(aa,ac,t,ab){return aa.retry===!1?(ac.emit("error",t),void ac.removeAllListeners()):("function"!=typeof aa.back_off_function&&(aa.back_off_function=J),ac.emit("requestError",t),"active"!==ac.state&&"pending"!==ac.state||(ac.emit("paused",t),ac.state="stopped",ac.once("active",function(){aa.current_back_off=hZ})),aa.current_back_off=aa.current_back_off||hZ,aa.current_back_off=aa.back_off_function(aa.current_back_off),void setTimeout(ab,aa.current_back_off))}function jj(t){return Object.keys(t).sort(ho.collate).reduce(function(ab,aa){return ab[aa]=t[aa],ab},{})}function fT(aa,ac,ag){var ab=ag.doc_ids?ag.doc_ids.sort(ho.collate):"",t=ag.filter?ag.filter.toString():"",ad="",af="";return ag.filter&&ag.query_params&&(ad=JSON.stringify(jj(ag.query_params))),ag.filter&&"_view"===ag.filter&&(af=ag.view.toString()),iQ.all([aa.id(),ac.id()]).then(function(aj){var ah=aj[0]+aj[1]+t+af+ad+ab;return new iQ(function(ak){O(ah,ak)})}).then(function(ah){return ah=ah.replace(/\//g,".").replace(/\+/g,"_"),"_local/"+ah})}function a1(av,ag,aL,aQ,aM){function aF(){return az?iQ.resolve():fT(av,ag,aL).then(function(aS){aj=aS,az=new iW(av,ag,aj,aQ)})}function aR(){if(ab=[],0!==ax.docs.length){var aS=ax.docs;return ag.bulkDocs({docs:aS,new_edits:!1}).then(function(aV){if(aQ.cancelled){throw aN(),new Error("cancelled")}var aT=[],aW={};aV.forEach(function(aY){aY.error&&(aM.doc_write_failures++,aT.push(aY),aW[aY.id]=aY)}),aw=aw.concat(aT),aM.docs_written+=ax.docs.length-aT.length;var aX=aT.filter(function(aY){return"unauthorized"!==aY.name&&"forbidden"!==aY.name});if(aS.forEach(function(aZ){var aY=aW[aZ._id];aY?aQ.emit("denied",es(aY)):ab.push(aZ)}),aX.length>0){var aU=new Error("bulkDocs error");throw aU.other_errors=aT,aE("target.bulkDocs failed to write docs",aU),new Error("bulkWrite partial failure")}},function(aT){throw aM.doc_write_failures+=aS.length,aT})}}function af(){if(ax.error){throw new Error("There was a problem getting docs.")}aM.last_seq=aG=ax.seq;var aS=es(aM);return ab.length&&(aS.docs=ab,aQ.emit("change",aS)),aC=!0,az.writeCheckpoint(ax.seq,au).then(function(){if(aC=!1,aQ.cancelled){throw aN(),new Error("cancelled")}ax=void 0,aJ()})["catch"](ah)}function ap(){var aS={};return ax.changes.forEach(function(aT){"_user/"!==aT.id&&(aS[aT.id]=aT.changes.map(function(aU){return aU.rev}))}),ag.revsDiff(aS).then(function(aT){if(aQ.cancelled){throw aN(),new Error("cancelled")}ax.diffs=aT})}function aA(){return gc(av,ag,ax.diffs,aQ).then(function(aS){ax.error=!aS.ok,aS.docs.forEach(function(aT){delete ax.diffs[aT._id],aM.docs_read++,ax.docs.push(aT)})})}function aI(){if(!aQ.cancelled&&!ax){if(0===aH.length){return void al(!0)}ax=aH.shift(),ap().then(aA).then(aR).then(af).then(aI)["catch"](function(aS){aE("batch processing terminated with error",aS)})}}function al(aS){return 0===aO.changes.length?void (0!==aH.length||ax||((ac&&aK.live||aa)&&(aQ.state="pending",aQ.emit("paused")),aa&&aN())):void ((aS||aa||aO.changes.length>=am)&&(aH.push(aO),aO={seq:0,changes:[],docs:[]},"pending"!==aQ.state&&"stopped"!==aQ.state||(aQ.state="active",aQ.emit("active")),aI()))}function aE(aS,aT){aB||(aT.message||(aT.message=aS),aM.ok=!1,aM.status="aborting",aM.errors.push(aT),aw=aw.concat(aT),aH=[],aO={seq:0,changes:[],docs:[]},aN())}function aN(){if(!(aB||aQ.cancelled&&(aM.status="cancelled",aC))){aM.status=aM.status||"complete",aM.end_time=new Date,aM.last_seq=aG,aB=!0;var aS=aw.filter(function(aU){return"unauthorized"!==aU.name&&"forbidden"!==aU.name});if(aS.length>0){var aT=aw.pop();aw.length>0&&(aT.other_errors=aw),aT.result=aM,hi(aL,aQ,aT,function(){a1(av,ag,aL,aQ)})}else{aM.errors=aw,aQ.emit("complete",aM),aQ.removeAllListeners()}}}function aq(aS){if(aQ.cancelled){return aN()}var aT=D(aL)(aS);aT&&(aO.seq=aS.seq,aO.changes.push(aS),al(0===aH.length&&aK.live))}function t(aS){if(ad=!1,aQ.cancelled){return aN()}if(aS.results.length>0){aK.since=aS.last_seq,aJ(),al(!0)}else{var aT=function(){ac?(aK.live=!0,aJ()):aa=!0,al(!0)};ax||0!==aS.results.length?aT():(aC=!0,az.writeCheckpoint(aS.last_seq,au).then(function(){aC=!1,aM.last_seq=aG=aS.last_seq,aT()})["catch"](ah))}}function aP(aS){return ad=!1,aQ.cancelled?aN():void aE("changes rejected",aS)}function aJ(){function aT(){aU.cancel()}function aS(){aQ.removeListener("cancel",aT)}if(!ad&&!aa&&aH.length<ak){ad=!0,aQ._changes&&(aQ.removeListener("cancel",aQ._abortChanges),aQ._changes.cancel()),aQ.once("cancel",aT);var aU=av.changes(aK).on("change",aq);aU.then(aS,aS),aU.then(t)["catch"](aP),aL.retry&&(aQ._changes=aU,aQ._abortChanges=aT)}}function aD(){aF().then(function(){return aQ.cancelled?void aN():az.getCheckpoint().then(function(aS){aG=aS,aK={since:aG,limit:am,batch_size:am,style:"all_docs",doc_ids:ay,return_docs:!0},aL.filter&&("string"!=typeof aL.filter?aK.include_docs=!0:aK.filter=aL.filter),"heartbeat" in aL&&(aK.heartbeat=aL.heartbeat),"timeout" in aL&&(aK.timeout=aL.timeout),aL.query_params&&(aK.query_params=aL.query_params),aL.view&&(aK.view=aL.view),aJ()})})["catch"](function(aS){aE("getCheckpoint rejected with ",aS)})}function ah(aS){throw aC=!1,aE("writeCheckpoint completed with error",aS),aS}var ax,aj,az,aH=[],aO={seq:0,changes:[],docs:[]},aC=!1,aa=!1,aB=!1,aG=0,ac=aL.continuous||aL.live||!1,am=aL.batch_size||100,ak=aL.batches_limit||10,ad=!1,ay=aL.doc_ids,aw=[],ab=[],au=di();aM=aM||{ok:!0,start_time:new Date,docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var aK={};return aQ.ready(av,ag),aQ.cancelled?void aN():(aQ._addedListeners||(aQ.once("cancel",aN),"function"==typeof aL.complete&&(aQ.once("error",aL.complete),aQ.once("complete",function(aS){aL.complete(null,aS)})),aQ._addedListeners=!0),void ("undefined"==typeof aL.since?aD():aF().then(function(){return aC=!0,az.writeCheckpoint(aL.since,au)}).then(function(){return aC=!1,aQ.cancelled?void aN():(aG=aL.since,void aD())})["catch"](ah)))}function h3(){K.EventEmitter.call(this),this.cancelled=!1,this.state="pending";var t=this,aa=new iQ(function(ac,ab){t.once("complete",ac),t.once("error",ab)});t.then=function(ac,ab){return aa.then(ac,ab)},t["catch"]=function(ab){return aa["catch"](ab)},t["catch"](function(){})}function jm(aa,ab){var t=ab.PouchConstructor;return"string"==typeof aa?new t(aa,ab):aa}function gh(aa,ac,ag,ab){if("function"==typeof ag&&(ab=ag,ag={}),"undefined"==typeof ag&&(ag={}),ag.doc_ids&&!Array.isArray(ag.doc_ids)){throw U(fu,"`doc_ids` filter parameter is not a list.")}ag.complete=ab,ag=es(ag),ag.continuous=ag.continuous||ag.live,ag.retry="retry" in ag?ag.retry:!1,ag.PouchConstructor=ag.PouchConstructor||this;var t=new h3(ag),ad=jm(aa,ag),af=jm(ac,ag);return a1(ad,af,ag,t),t}function gG(aa,ac,t,ab){return"function"==typeof t&&(ab=t,t={}),"undefined"==typeof t&&(t={}),t=es(t),t.PouchConstructor=t.PouchConstructor||this,aa=jm(aa,t),ac=jm(ac,t),new hO(aa,ac,t,ab)}function hO(ah,au,aq,af){function t(ay){ak.emit("change",{direction:"pull",change:ay})}function al(ay){ak.emit("change",{direction:"push",change:ay})}function ab(ay){ak.emit("denied",{direction:"push",doc:ay})}function ap(ay){ak.emit("denied",{direction:"pull",doc:ay})}function av(){ak.pushPaused=!0,ak.pullPaused&&ak.emit("paused")}function ad(){ak.pullPaused=!0,ak.pushPaused&&ak.emit("paused")}function aj(){ak.pushPaused=!1,ak.pullPaused&&ak.emit("active",{direction:"push"})}function am(){ak.pullPaused=!1,ak.pushPaused&&ak.emit("active",{direction:"pull"})}function ag(ay){return function(az,aE){var aD="change"===az&&(aE===t||aE===al),aA="denied"===az&&(aE===ap||aE===ab),aC="paused"===az&&(aE===ad||aE===av),aB="active"===az&&(aE===am||aE===aj);(aD||aA||aC||aB)&&(az in ax||(ax[az]={}),ax[az][ay]=!0,2===Object.keys(ax[az]).length&&ak.removeAllListeners(az))}}var ak=this;this.canceled=!1;var ac=aq.push?iv.extend({},aq,aq.push):aq,aw=aq.pull?iv.extend({},aq,aq.pull):aq;this.push=gh(ah,au,ac),this.pull=gh(au,ah,aw),this.pushPaused=!0,this.pullPaused=!0;var ax={};aq.live&&(this.push.on("complete",ak.pull.cancel.bind(ak.pull)),this.pull.on("complete",ak.push.cancel.bind(ak.push))),this.on("newListener",function(ay){"change"===ay?(ak.pull.on("change",t),ak.push.on("change",al)):"denied"===ay?(ak.pull.on("denied",ap),ak.push.on("denied",ab)):"active"===ay?(ak.pull.on("active",am),ak.push.on("active",aj)):"paused"===ay&&(ak.pull.on("paused",ad),ak.push.on("paused",av))}),this.on("removeListener",function(ay){"change"===ay?(ak.pull.removeListener("change",t),ak.push.removeListener("change",al)):"denied"===ay?(ak.pull.removeListener("denied",ap),ak.push.removeListener("denied",ab)):"active"===ay?(ak.pull.removeListener("active",am),ak.push.removeListener("active",aj)):"paused"===ay&&(ak.pull.removeListener("paused",ad),ak.push.removeListener("paused",av))}),this.pull.on("removeListener",ag("pull")),this.push.on("removeListener",ag("push"));var aa=iQ.all([this.push,this.pull]).then(function(ay){var az={push:ay[0],pull:ay[1]};return ak.emit("complete",az),af&&af(null,az),ak.removeAllListeners(),az},function(ay){if(ak.cancel(),af?af(ay):ak.emit("error",ay),ak.removeAllListeners(),af){throw ay}});this.then=function(ay,az){return aa.then(ay,az)},this["catch"]=function(ay){return aa["catch"](ay)}}function cn(t){t.replicate=gh,t.sync=gG}var et,iv=b(9),jz=fY(b(5)),fq=fY(b(8)),iZ=fY(b(10)),h8=b(14),g0=fY(b(4)),K=b(1),ij=fY(b(15)),jE=fY(b(16)),hG=fY(b(17)),ho=b(12),iQ="function"==typeof Promise?Promise:iZ,g4=Function.prototype.toString,hE=g4.call(Object),h0=jz("pouchdb:api"),hd=6;if(gN()){et=!1}else{try{localStorage.setItem("_pouch_check_localstorage",1),et=!!localStorage.getItem("_pouch_check_localstorage")}catch(iq){et=!1}}fq(en,K.EventEmitter),en.prototype.addListener=function(aa,ac,ag,ab){function t(){function aj(){af=!1}if(ad._listeners[ac]){if(af){return void (af="waiting")}af=!0;var ah=fi(ab,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary"]);ag.changes(ah).on("change",function(ak){ak.seq>ab.since&&!ab.cancelled&&(ab.since=ak.seq,ab.onChange(ak))}).on("complete",function(){"waiting"===af&&setTimeout(function(){t()},0),af=!1}).on("error",aj)}}if(!this._listeners[ac]){var ad=this,af=!1;this._listeners[ac]=t,this.on(aa,t)}},en.prototype.removeListener=function(t,aa){aa in this._listeners&&K.EventEmitter.prototype.removeListener.call(this,t,this._listeners[aa])},en.prototype.notifyLocalWindows=function(t){gN()?chrome.storage.local.set({dbName:t}):fS()&&(localStorage[t]="a"===localStorage[t]?"b":"a")},en.prototype.notify=function(t){this.emit(t),this.notifyLocalWindows(t)},fq(ge,Error),ge.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};var ja=new ge({status:401,error:"unauthorized",reason:"Name or password is incorrect."}),ht=new ge({status:400,error:"bad_request",reason:"Missing JSON list of 'docs'"}),y=new ge({status:404,error:"not_found",reason:"missing"}),jt=new ge({status:409,error:"conflict",reason:"Document update conflict"}),iF=new ge({status:400,error:"invalid_id",reason:"_id field must contain a string"}),gT=new ge({status:412,error:"missing_id",reason:"_id is required for puts"}),h=new ge({status:400,error:"bad_request",reason:"Only reserved document ids may start with underscore."}),gv=new ge({status:412,error:"precondition_failed",reason:"Database not open"}),iN=new ge({status:500,error:"unknown_error",reason:"Database encountered an unknown error"}),gB=new ge({status:500,error:"badarg",reason:"Some query argument is invalid"}),ft=new ge({status:400,error:"invalid_request",reason:"Request was invalid"}),Z=new ge({status:400,error:"query_parse_error",reason:"Some query parameter is invalid"}),be=new ge({status:500,error:"doc_validation",reason:"Bad special document member"}),fu=new ge({status:400,error:"bad_request",reason:"Something wrong with the request"}),ik=new ge({status:400,error:"bad_request",reason:"Document must be a JSON object"}),a8=new ge({status:404,error:"not_found",reason:"Database not found"}),iJ=new ge({status:500,error:"indexed_db_went_bad",reason:"unknown"}),fb=new ge({status:500,error:"web_sql_went_bad",reason:"unknown"}),jc=new ge({status:500,error:"levelDB_went_went_bad",reason:"unknown"}),gg=new ge({status:403,error:"forbidden",reason:"Forbidden by design doc validate_doc_update function"}),g2=new ge({status:400,error:"bad_request",reason:"Invalid rev format"}),i3=new ge({status:412,error:"file_exists",reason:"The database could not be created, the file already exists."}),hU=new ge({status:412,error:"missing_stub"}),hB=new ge({status:413,error:"invalid_url",reason:"Provided URL is invalid"}),m=[ja,ht,y,jt,iF,gT,h,gv,iN,gB,ft,Z,be,fu,ik,a8,fb,jc,gg,g2,i3,hU,iJ,hB],gR=function(aa,ac,t){var ab=m.filter(function(ad){return ad[aa]===ac});return t&&ab.filter(function(ad){return ad.message===t})[0]||ab[0]},hg=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],ji="queryKey",fy=/(?:^|&)([^&=]*)=?([^&]*)/g,at=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,h1="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");fq(ez,K.EventEmitter),ez.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")},ez.prototype.doChanges=function(ab){var ad=this,t=ab.complete;if(ab=es(ab),"live" in ab&&!("continuous" in ab)&&(ab.continuous=ab.live),ab.processChange=gk,"latest"===ab.since&&(ab.since="now"),ab.since||(ab.since=0),"now"===ab.since){return void this.db.info().then(function(af){return ad.isCancelled?void t(null,{status:"cancelled"}):(ab.since=af.update_seq,void ad.doChanges(ab))},t)}if(ab.continuous&&"now"!==ab.since&&this.db.info().then(function(af){ad.startSeq=af.update_seq},function(af){if("idbNull"!==af.id){throw af}}),ab.view&&!ab.filter&&(ab.filter="_view"),ab.filter&&"string"==typeof ab.filter&&("_view"===ab.filter?ab.view=cr(ab.view):ab.filter=cr(ab.filter),"http"!==this.db.type()&&!ab.doc_ids)){return this.filterChanges(ab)}"descending" in ab||(ab.descending=!1),ab.limit=0===ab.limit?1:ab.limit,ab.complete=t;var ac=this.db._changes(ab);if(ac&&"function"==typeof ac.cancel){var aa=ad.cancel;ad.cancel=g0(function(af){ac.cancel(),aa.apply(this,af)})}},ez.prototype.filterChanges=function(ab){var ad=this,t=ab.complete;if("_view"===ab.filter){if(!ab.view||"string"!=typeof ab.view){var ac=U(fu,"`view` filter parameter not found or invalid.");return t(ac)}var aa=u(ab.view);this.db.get("_design/"+aa[0],function(ag,ah){if(ad.isCancelled){return t(null,{status:"cancelled"})}if(ag){return t(br(ag))}var aj=ah&&ah.views&&ah.views[aa[1]]&&ah.views[aa[1]].map;return aj?(ab.filter=hL(aj),void ad.doChanges(ab)):t(U(y,ah.views?"missing json key: "+aa[1]:"missing json key: views"))})}else{var af=u(ab.filter);if(!af){return ad.doChanges(ab)}this.db.get("_design/"+af[0],function(aj,ah){if(ad.isCancelled){return t(null,{status:"cancelled"})}if(aj){return t(br(aj))}var ag=ah&&ah.filters&&ah.filters[af[1]];return ag?(ab.filter=T(ag),void ad.doChanges(ab)):t(U(y,ah&&ah.filters?"missing json key: "+af[1]:"missing json key: filters"))})}},fq(dr,K.EventEmitter),dr.prototype.post=ev("post",function(aa,ab,t){return"function"==typeof ab&&(t=ab,ab={}),"object"!=typeof aa||Array.isArray(aa)?t(U(ik)):void this.bulkDocs({docs:[aa]},ab,g5(t))}),dr.prototype.put=ev("put",g0(function(ac){function t(){ab||(S("warn","db.put(doc, id, rev) has been deprecated and will be removed in a future release, please use db.put({_id: id, _rev: rev}) instead"),ab=!0)}var af,ah,ag,ad,ab=!1,aj=ac.shift(),aa="_id" in aj;if("object"!=typeof aj||Array.isArray(aj)){return(ad=ac.pop())(U(ik))}for(;;){if(af=ac.shift(),ah=typeof af,"string"!==ah||aa?"string"!==ah||!aa||"_rev" in aj?"object"===ah?ag=af:"function"===ah&&(ad=af):(t(),aj._rev=af):(t(),aj._id=af,aa=!0),!ac.length){break}}return ag=ag||{},ci(aj._id),fc(aj._id)&&"function"==typeof this._putLocal?aj._deleted?this._removeLocal(aj,ad):this._putLocal(aj,ad):void this.bulkDocs({docs:[aj]},ag,g5(ad))})),dr.prototype.putAttachment=ev("putAttachment",function(aa,ac,ag,ab,t){function ad(ah){var aj="_rev" in ah?parseInt(ah._rev,10):0;return ah._attachments=ah._attachments||{},ah._attachments[ac]={content_type:t,data:ab,revpos:++aj},af.put(ah)}var af=this;return"function"==typeof t&&(t=ab,ab=ag,ag=null),"undefined"==typeof t&&(t=ab,ab=ag,ag=null),af.get(aa).then(function(ah){if(ah._rev!==ag){throw U(jt)}return ad(ah)},function(ah){if(ah.reason===y.message){return ad({_id:aa})}throw ah})}),dr.prototype.removeAttachment=ev("removeAttachment",function(ab,ad,t,ac){var aa=this;aa.get(ab,function(af,ag){return af?void ac(af):ag._rev!==t?void ac(U(jt)):ag._attachments?(delete ag._attachments[ad],0===Object.keys(ag._attachments).length&&delete ag._attachments,void aa.put(ag,ac)):ac()})}),dr.prototype.remove=ev("remove",function(ab,ad,t,ac){var aa;"string"==typeof ad?(aa={_id:ab,_rev:ad},"function"==typeof t&&(ac=t,t={})):(aa=ab,"function"==typeof ad?(ac=ad,t={}):(ac=t,t=ad)),t=t||{},t.was_delete=!0;var af={_id:aa._id,_rev:aa._rev||t.rev};return af._deleted=!0,fc(af._id)&&"function"==typeof this._removeLocal?this._removeLocal(aa,ac):void this.bulkDocs({docs:[af]},t,g5(ac))}),dr.prototype.revsDiff=ev("revsDiff",function(t,ac,ag){function aa(ak,aj){ab.has(ak)||ab.set(ak,{missing:[]}),ab.get(ak).missing.push(aj)}function ah(aj,ak){var al=t[aj].slice(0);F(ak,function(ax,ap,aq,aw,am){var au=ap+"-"+aq,av=al.indexOf(au);-1!==av&&(al.splice(av,1),"available"!==am.status&&aa(aj,au))}),al.forEach(function(am){aa(aj,am)})}"function"==typeof ac&&(ag=ac,ac={});var ad=Object.keys(t);if(!ad.length){return ag(null,{})}var af=0,ab=new h8.Map;ad.map(function(aj){this._getRevisionTree(aj,function(al,am){if(al&&404===al.status&&"missing"===al.message){ab.set(aj,{missing:t[aj]})}else{if(al){return ag(al)}ah(aj,am)}if(++af===ad.length){var ak={};return ab.forEach(function(ap,aq){ak[aq]=ap}),ag(null,ak)}})},this)}),dr.prototype.bulkGet=ev("bulkGet",function(t,aa){Y(this,t,aa)}),dr.prototype.compactDocument=ev("compactDocument",function(aa,ac,t){var ab=this;this._getRevisionTree(aa,function(ah,ad){if(ah){return t(ah)}var ag=fg(ad),aj=[],af=[];Object.keys(ag).forEach(function(ak){ag[ak]>ac&&aj.push(ak)}),F(ad,function(am,aq,ak,ap,al){var au=aq+"-"+ak;"available"===al.status&&-1!==aj.indexOf(au)&&af.push(au)}),ab._doCompaction(aa,af,t)})}),dr.prototype.compact=ev("compact",function(aa,ab){"function"==typeof aa&&(ab=aa,aa={});var t=this;aa=aa||{},t._compactionQueue=t._compactionQueue||[],t._compactionQueue.push({opts:aa,callback:ab}),1===t._compactionQueue.length&&hT(t)}),dr.prototype._compact=function(aa,ac){function ag(ah){af.push(t.compactDocument(ah.id,0))}function ab(ah){var aj=ah.last_seq;iQ.all(af).then(function(){return C(t,"_local/compaction",function(ak){return !ak.last_seq||ak.last_seq<aj?(ak.last_seq=aj,ak):!1})}).then(function(){ac(null,{ok:!0})})["catch"](ac)}var t=this,ad={return_docs:!1,last_seq:aa.last_seq||0},af=[];t.changes(ad).on("change",ag).on("complete",ab).on("error",ac)},dr.prototype.get=ev("get",function(t,ac,ag){function aa(){var ak=[],aj=ah.length;return aj?void ah.forEach(function(al){ad.get(t,{rev:al,revs:ac.revs,attachments:ac.attachments},function(am,ap){am?ak.push({missing:al}):ak.push({ok:ap}),aj--,aj||ag(null,ak)})}):ag(null,ak)}if("function"==typeof ac&&(ag=ac,ac={}),"string"!=typeof t){return ag(U(iF))}if(fc(t)&&"function"==typeof this._getLocal){return this._getLocal(t,ag)}var ah=[],ad=this;if(!ac.open_revs){return this._get(t,ac,function(al,aq){if(al){return ag(al)}var ax=aq.doc,aA=aq.metadata,aw=aq.ctx;if(ac.conflicts){var ay=w(aA);ay.length&&(ax._conflicts=ay)}if(ha(aA,ax._rev)&&(ax._deleted=!0),ac.revs||ac.revs_info){var aj=ae(aA.rev_tree),am=a0(aj,function(aC){return -1!==aC.ids.map(function(aD){return aD.id}).indexOf(ax._rev.split("-")[1])}),av=am.ids.map(function(aC){return aC.id}).indexOf(ax._rev.split("-")[1])+1,ak=am.ids.length-av;if(am.ids.splice(av,ak),am.ids.reverse(),ac.revs&&(ax._revisions={start:am.pos+am.ids.length-1,ids:am.ids.map(function(aC){return aC.id})}),ac.revs_info){var au=am.pos+am.ids.length;ax._revs_info=am.ids.map(function(aC){return au--,{rev:au+"-"+aC.id,status:aC.opts.status}})}}if(ac.attachments&&ax._attachments){var ap=ax._attachments,az=Object.keys(ap).length;if(0===az){return ag(null,ax)}Object.keys(ap).forEach(function(aC){this._getAttachment(ax._id,aC,ap[aC],{rev:ax._rev,binary:ac.binary,ctx:aw},function(aE,aD){var aF=ax._attachments[aC];aF.data=aD,delete aF.stub,delete aF.length,--az||ag(null,ax)})},ad)}else{if(ax._attachments){for(var aB in ax._attachments){ax._attachments.hasOwnProperty(aB)&&(ax._attachments[aB].stub=!0)}}ag(null,ax)}})}if("all"===ac.open_revs){this._getRevisionTree(t,function(ak,aj){return ak?ag(ak):(ah=x(aj).map(function(al){return al.rev}),void aa())})}else{if(!Array.isArray(ac.open_revs)){return ag(U(iN,"function_clause"))}ah=ac.open_revs;for(var af=0;af<ah.length;af++){var ab=ah[af];if("string"!=typeof ab||!/^\d+-/.test(ab)){return ag(U(g2))}}aa()}}),dr.prototype.getAttachment=ev("getAttachment",function(ab,ad,t,ac){var aa=this;t instanceof Function&&(ac=t,t={}),this._get(ab,t,function(af,ag){return af?ac(af):ag.doc._attachments&&ag.doc._attachments[ad]?(t.ctx=ag.ctx,t.binary=!0,aa._getAttachment(ab,ad,ag.doc._attachments[ad],t,ac),void 0):ac(U(y))})}),dr.prototype.allDocs=ev("allDocs",function(aa,ab){if("function"==typeof aa&&(ab=aa,aa={}),aa.skip="undefined"!=typeof aa.skip?aa.skip:0,aa.start_key&&(aa.startkey=aa.start_key),aa.end_key&&(aa.endkey=aa.end_key),"keys" in aa){if(!Array.isArray(aa.keys)){return ab(new TypeError("options.keys must be an array"))}var t=["startkey","endkey","key"].filter(function(ac){return ac in aa})[0];if(t){return void ab(U(Z,"Query parameter `"+t+"` is not compatible with multi-get"))}if("http"!==this.type()){return iA(this,aa,ab)}}return this._allDocs(aa,ab)}),dr.prototype.changes=function(t,aa){return"function"==typeof t&&(aa=t,t={}),new ez(this,t,aa)},dr.prototype.close=ev("close",function(t){return this._closed=!0,this._close(t)}),dr.prototype.info=ev("info",function(t){var aa=this;this._info(function(ab,ac){return ab?t(ab):(ac.db_name=ac.db_name||aa._db_name,ac.auto_compaction=!(!aa.auto_compaction||"http"===aa.type()),ac.adapter=aa.type(),void t(null,ac))})}),dr.prototype.id=ev("id",function(t){return this._id(t)}),dr.prototype.type=function(){return"function"==typeof this._type?this._type():this.adapter},dr.prototype.bulkDocs=ev("bulkDocs",function(ab,ad,t){if("function"==typeof ad&&(t=ad,ad={}),ad=ad||{},Array.isArray(ab)&&(ab={docs:ab}),!ab||!ab.docs||!Array.isArray(ab.docs)){return t(U(ht))}for(var ac=0;ac<ab.docs.length;++ac){if("object"!=typeof ab.docs[ac]||Array.isArray(ab.docs[ac])){return t(U(ik))}}var aa;return ab.docs.forEach(function(af){af._attachments&&Object.keys(af._attachments).forEach(function(ag){aa=aa||gM(ag)})}),aa?t(U(fu,aa)):("new_edits" in ad||("new_edits" in ab?ad.new_edits=ab.new_edits:ad.new_edits=!0),ad.new_edits||"http"===this.type()||ab.docs.sort(jv),jq(ab.docs),this._bulkDocs(ab,ad,function(af,ag){return af?t(af):(ad.new_edits||(ag=ag.filter(function(ah){return ah.error})),void t(null,ag))}))}),dr.prototype.registerDependentDatabase=ev("registerDependentDatabase",function(aa,ac){function t(ad){return ad.dependentDbs=ad.dependentDbs||{},ad.dependentDbs[aa]?!1:(ad.dependentDbs[aa]=!0,ad)}var ab=new this.constructor(aa,this.__opts);C(this,"_local/_pouch_dependentDbs",t).then(function(){ac(null,{db:ab})})["catch"](ac)}),dr.prototype.destroy=ev("destroy",function(ab,ad){function t(){ac._destroy(ab,function(ag,af){return ag?ad(ag):(ac._destroyed=!0,ac.emit("destroyed"),void ad(null,af||{ok:!0}))})}"function"==typeof ab&&(ad=ab,ab={});var ac=this,aa="use_prefix" in ac?ac.use_prefix:!0;return"http"===ac.type()?t():void ac.get("_local/_pouch_dependentDbs",function(ah,ak){if(ah){return 404!==ah.status?ad(ah):t()}var ag=ak.dependentDbs,aj=ac.constructor,af=Object.keys(ag).map(function(al){var am=aa?al.replace(new RegExp("^"+aj.prefix),""):al;return new aj(am,ac.__opts).destroy()});iQ.all(af).then(t,ad)})}),ia.prototype.execute=function(){var t;if(this.failed){for(;t=this.queue.shift();){t(this.failed)}}else{for(;t=this.queue.shift();){t()}}},ia.prototype.fail=function(t){this.failed=t,this.execute()},ia.prototype.ready=function(t){this.isReady=!0,this.db=t,this.execute()},ia.prototype.addTask=function(t){this.queue.push(t),this.failed&&this.execute()},fq(iy,dr),iy.debug=jz,iy.adapters={},iy.preferredAdapters=[],iy.prefix="_pouch_";var jk=new K.EventEmitter;iD(iy),iy.parseAdapter=function(t,ac){var ag,aa,ah=t.match(/([a-z\-]*):\/\/(.*)/);if(ah){if(t=/http(s?)/.test(ah[1])?ah[1]+"://"+ah[2]:ah[2],ag=ah[1],!iy.adapters[ag].valid()){throw"Invalid adapter"}return{name:t,adapter:ah[1]}}var ad="idb" in iy.adapters&&"websql" in iy.adapters&&fS()&&localStorage["_pouch__websqldb_"+iy.prefix+t];if(ac.adapter){aa=ac.adapter}else{if("undefined"!=typeof ac&&ac.db){aa="leveldb"}else{for(var af=0;af<iy.preferredAdapters.length;++af){if(aa=iy.preferredAdapters[af],aa in iy.adapters){if(ad&&"idb"===aa){S("log",'PouchDB is downgrading "'+t+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.');continue}break}}}}ag=iy.adapters[aa];var ab=ag&&"use_prefix" in ag?ag.use_prefix:!0;return{name:ab?iy.prefix+t:t,adapter:aa}},iy.adapter=function(aa,ab,t){ab.valid()&&(iy.adapters[aa]=ab,t&&iy.preferredAdapters.push(aa))},iy.plugin=function(t){return"function"==typeof t?t(iy):Object.keys(t).forEach(function(aa){iy.prototype[aa]=t[aa]}),iy},iy.defaults=function(t){function aa(ab,ad,ac){return this instanceof aa?("function"!=typeof ad&&"undefined"!=typeof ad||(ac=ad,ad={}),ab&&"object"==typeof ab&&(ad=ab,ab=void 0),ad=iv.extend({},t,ad),void iy.call(this,ab,ad,ac)):new aa(ab,ad,ac)}return fq(aa,iy),aa.preferredAdapters=iy.preferredAdapters.slice(),Object.keys(iy).forEach(function(ab){ab in aa||(aa[ab]=iy[ab])}),aa};var ga="5.4.4";iy.version=ga;var gD,hM=iS(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),eo=iS(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]),it=function(t){return atob(t)},jy=function(t){return btoa(t)},fo=gf.setImmediate||gf.setTimeout,iX=32768,h7=5,gY="document-store",G="by-sequence",ig="attach-store",jD="attach-seq-store",hA="meta-store",hj="local-store",iO="detect-blob-support",gy={running:!1,queue:[]},hz=new h8.Map,hX=new en,g9=new h8.Map;eu.valid=function(){var t="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform);return !t&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange};var il=7,i8=h9("document-store"),hm=h9("by-sequence"),v=h9("attach-store"),js=h9("local-store"),iC=h9("metadata-store"),gQ=h9("attach-seq-store"),g=new h8.Map,gn=new en,iI=1,gr="CREATE INDEX IF NOT EXISTS 'by-seq-deleted-idx' ON "+hm+" (seq, deleted)",fl="CREATE UNIQUE INDEX IF NOT EXISTS 'by-seq-doc-id-rev' ON "+hm+" (doc_id, rev)",W="CREATE INDEX IF NOT EXISTS 'doc-winningseq-idx' ON "+i8+" (winningseq)",a4="CREATE INDEX IF NOT EXISTS 'attach-seq-seq-idx' ON "+gQ+" (seq)",fk="CREATE UNIQUE INDEX IF NOT EXISTS 'attach-seq-digest-idx' ON "+gQ+" (digest, seq)",ic=hm+".seq = "+i8+".winningseq",a7=hm+".seq AS seq, "+hm+".deleted AS deleted, "+hm+".json AS data, "+hm+".rev AS rev, "+i8+".json AS metadata";ai.valid=gF,ai.use_prefix=!0;var iG=iL(),ex=function(){},i7=25,gd=50,gZ={},iY=1800,hP=jz("pouchdb:http");ar.valid=function(){return !0},jh.prototype.add=function(t){return this.promise=this.promise["catch"](function(){}).then(function(){return t()}),this.promise},jh.prototype.finish=function(){return this.promise};var hp=function(t,aa){return aa&&t.then(function(ab){fV.nextTick(function(){aa(null,ab)})},function(ab){fV.nextTick(function(){aa(ab)})}),t},k=function(t){return g0(function(ac){var aa=ac.pop(),ab=t.apply(this,ac);return"function"==typeof aa&&hp(ab,aa),ab})},gt=function(t,aa){return t.then(function(ab){return aa().then(function(){return ab})},function(ab){return aa().then(function(){throw ab})})},i0=function(t,aa){return function(){var ab=arguments,ac=this;return t.add(function(){return aa.apply(ac,ab)})}},i9=function(ab){for(var ad={},t=0,ac=ab.length;ac>t;t++){ad["$"+ab[t]]=!0}var aa=Object.keys(ad),af=new Array(aa.length);for(t=0,ac=aa.length;ac>t;t++){af[t]=aa[t].substring(1)}return af},fs={},X=new jh,hR=50,jf=S.bind(null,"log"),fr={_sum:function(t,aa){return id(aa)},_count:function(t,aa){return aa.length},_stats:function(aa,ab){function t(ad){for(var ag=0,ah=0,af=ad.length;af>ah;ah++){var ac=ad[ah];ag+=ac*ac}return ag}return{sum:id(ab),min:Math.min.apply(null,ab),max:Math.max.apply(null,ab),count:ab.length,sumsqr:t(ab)}}},gq=k(function(){var t=this;return"http"===t.type()?iH(t):"function"==typeof t._viewCleanup?g8(t):gp(t)}),hC=function(ab,ad,t){"function"==typeof ad&&(t=ad,ad={}),ad=ad?hh(ad):{},"function"==typeof ab&&(ab={map:ab});var ac=this,aa=iQ.resolve().then(function(){return fj(ac,ab,ad)});return hp(aa,t),aa};fq(V,Error),fq(a3,Error),fq(fe,Error);var a6={query:hC,viewCleanup:gq},hb=1,ie="pouchdb",jw=5,fh=0;iW.prototype.writeCheckpoint=function(aa,ab){var t=this;return this.updateTarget(aa,ab).then(function(){return t.updateSource(aa,ab)})},iW.prototype.updateTarget=function(t,aa){return gX(this.target,this.id,t,aa,this.returnValue)},iW.prototype.updateSource=function(aa,ab){var t=this;return this.readOnlySource?iQ.resolve(!0):gX(this.src,this.id,aa,ab,this.returnValue)["catch"](function(ac){if(gS(ac)){return t.readOnlySource=!0,!0}throw ac})};var iK={undefined:function(t,aa){return 0===ho.collate(t.last_seq,aa.last_seq)?aa.last_seq:0},1:function(t,aa){return hN(aa,t).last_seq}};iW.prototype.getCheckpoint=function(){var t=this;return t.target.get(t.id).then(function(aa){return t.readOnlySource?iQ.resolve(aa.last_seq):t.src.get(t.id).then(function(ac){if(aa.version!==ac.version){return fh}var ab;return ab=aa.version?aa.version.toString():"undefined",ab in iK?iK[ab](aa,ac):fh},function(ab){if(404===ab.status&&aa.last_seq){return t.src.put({_id:t.id,last_seq:fh}).then(function(){return fh},function(ac){return gS(ac)?(t.readOnlySource=!0,aa.last_seq):fh})}throw ab})})["catch"](function(aa){if(404!==aa.status){throw aa}return fh})};var hZ=0;fq(h3,K.EventEmitter),h3.prototype.cancel=function(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")},h3.prototype.ready=function(ab,ad){function t(){aa.cancel()}function ac(){ab.removeListener("destroyed",t),ad.removeListener("destroyed",t)}var aa=this;aa._readyCalled||(aa._readyCalled=!0,ab.once("destroyed",t),ad.once("destroyed",t),aa.once("complete",ac))},fq(hO,K.EventEmitter),hO.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())},iy.plugin(M).plugin(bo).plugin(hY).plugin(a6).plugin(cn),e.exports=iy}).call(this,b(2),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{1:1,10:10,12:12,14:14,15:15,16:16,17:17,2:2,4:4,5:5,8:8,9:9}],4:[function(b,h,a){function e(f){return function(){var l=arguments.length;if(l){for(var g=[],k=-1;++k<l;){g[k]=arguments[k]}return f.call(this,g)}return f.call(this,[])}}h.exports=e},{}],5:[function(n,b,p){function r(){return"WebkitAppearance" in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function q(){var g=arguments,j=this.useColors;if(g[0]=(j?"%c":"")+this.namespace+(j?" %c":" ")+g[0]+(j?"%c ":" ")+"+"+p.humanize(this.diff),!j){return g}var h="color: "+this.color;g=[g[0],h,"color: inherit"].concat(Array.prototype.slice.call(g,1));var f=0,k=0;return g[0].replace(/%[a-z%]/g,function(l){"%%"!==l&&(f++,"%c"===l&&(k=f))}),g.splice(k,0,h),g}function o(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function i(g){try{null==g?p.storage.removeItem("debug"):p.storage.debug=g}catch(f){}}function a(){var g;try{g=p.storage.debug}catch(f){}return g}function e(){try{return window.localStorage}catch(f){}}p=b.exports=n(6),p.log=o,p.formatArgs=q,p.save=i,p.load=a,p.useColors=r,p.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:e(),p.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],p.formatters.j=function(f){return JSON.stringify(f)},p.enable(a())},{6:6}],6:[function(f,u,o){function s(){return o.colors[i++%o.colors.length]}function r(k){function h(){}function g(){var w=g,q=+new Date,v=q-(e||q);w.diff=v,w.prev=e,w.curr=q,e=q,null==w.useColors&&(w.useColors=o.useColors()),null==w.color&&w.useColors&&(w.color=s());var p=Array.prototype.slice.call(arguments);p[0]=o.coerce(p[0]),"string"!=typeof p[0]&&(p=["%o"].concat(p));var m=0;p[0]=p[0].replace(/%([a-z%])/g,function(y,x){if("%%"===y){return y}m++;var A=o.formatters[x];if("function"==typeof A){var z=p[m];y=A.call(w,z),p.splice(m,1),m--}return y}),"function"==typeof o.formatArgs&&(p=o.formatArgs.apply(w,p));var l=g.log||o.log||console.log.bind(console);l.apply(w,p)}h.enabled=!1,g.enabled=!0;var j=o.enabled(k)?g:h;return j.namespace=k,j}function n(g){o.save(g);for(var k=(g||"").split(/[\s,]+/),h=k.length,j=0;h>j;j++){k[j]&&(g=k[j].replace(/\*/g,".*?"),"-"===g[0]?o.skips.push(new RegExp("^"+g.substr(1)+"$")):o.names.push(new RegExp("^"+g+"$")))}}function b(){o.enable("")}function t(g){var j,h;for(j=0,h=o.skips.length;h>j;j++){if(o.skips[j].test(g)){return !1}}for(j=0,h=o.names.length;h>j;j++){if(o.names[j].test(g)){return !0}}return !1}function a(g){return g instanceof Error?g.stack||g.message:g}o=u.exports=r,o.coerce=a,o.disable=b,o.enable=n,o.enabled=t,o.humanize=f(11),o.names=[],o.skips=[],o.formatters={};var e,i=0},{11:11}],7:[function(b,e,a){(function(f){function o(){i=!0;for(var g,h,j=n.length;j;){for(h=n,n=[],g=-1;++g<j;){h[g]()}j=n.length}i=!1}function s(g){1!==n.push(g)||i||r()}var r,l=f.MutationObserver||f.WebKitMutationObserver;if(l){var z=0,u=new l(o),y=f.document.createTextNode("");u.observe(y,{characterData:!0}),r=function(){y.data=z=++z%2}}else{if(f.setImmediate||"undefined"==typeof f.MessageChannel){r="document" in f&&"onreadystatechange" in f.document.createElement("script")?function(){var g=f.document.createElement("script");g.onreadystatechange=function(){o(),g.onreadystatechange=null,g.parentNode.removeChild(g),g=null},f.document.documentElement.appendChild(g)}:function(){setTimeout(o,0)}}else{var A=new f.MessageChannel;A.port1.onmessage=o,r=function(){A.port2.postMessage(0)}}}var i,n=[];e.exports=s}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],8:[function(b,e,a){"function"==typeof Object.create?e.exports=function(f,i){f.super_=i,f.prototype=Object.create(i.prototype,{constructor:{value:f,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(j,k){j.super_=k;var f=function(){};f.prototype=k.prototype,j.prototype=new f,j.prototype.constructor=j}},{}],9:[function(b,e,a){(function(){var j=Array.prototype.slice,k=Array.prototype.forEach,f=function(h){if("object"!=typeof h){throw h+" is not an object"}var g=j.call(arguments,1);return k.call(g,function(i){if(i){for(var m in i){"object"==typeof i[m]&&h[m]?f.call(h,h[m],i[m]):h[m]=i[m]}}}),h};this.extend=f}).call(this)},{}],10:[function(l,u,t){function i(){}function v(g){if("function"!=typeof g){throw new TypeError("resolver must be a function")}this.state=s,this.queue=[],this.outcome=void 0,g!==i&&y(this,g)}function p(j,k,g){this.promise=j,"function"==typeof k&&(this.onFulfilled=k,this.callFulfilled=this.otherCallFulfilled),"function"==typeof g&&(this.onRejected=g,this.callRejected=this.otherCallRejected)}function b(j,k,g){e(function(){var w;try{w=k(g)}catch(q){return M.reject(j,q)}w===j?M.reject(j,new TypeError("Cannot resolve promise with itself")):M.resolve(j,w)})}function m(g){var j=g&&g.then;return g&&"object"==typeof g&&"function"==typeof j?function(){j.apply(g,arguments)}:void 0}function y(j,q){function w(A){x||(x=!0,M.reject(j,A))}function k(A){x||(x=!0,M.resolve(j,A))}function g(){q(k,w)}var x=!1,z=f(g);"error"===z.status&&w(z.value)}function f(j,q){var g={};try{g.value=j(q),g.status="success"}catch(k){g.status="error",g.value=k}return g}function n(g){return g instanceof this?g:M.resolve(new this(i),g)}function r(g){var j=new this(i);return M.reject(j,g)}function h(q){function B(E,D){function C(F){j[D]=F,++A!==z||w||(w=!0,M.resolve(k,j))}x.resolve(E).then(C,function(F){w||(w=!0,M.reject(k,F))})}var x=this;if("[object Array]"!==Object.prototype.toString.call(q)){return this.reject(new TypeError("must be an array"))}var z=q.length,w=!1;if(!z){return this.resolve([])}for(var j=new Array(z),A=0,g=-1,k=new this(i);++g<z;){B(q[g],g)}return k}function o(j){function q(A){w.resolve(A).then(function(B){x||(x=!0,M.resolve(k,B))},function(B){x||(x=!0,M.reject(k,B))})}var w=this;if("[object Array]"!==Object.prototype.toString.call(j)){return this.reject(new TypeError("must be an array"))}var g=j.length,x=!1;if(!g){return this.resolve([])}for(var z=-1,k=new this(i);++z<g;){q(j[z])}return k}var e=l(7),M={},N=["REJECTED"],a=["FULFILLED"],s=["PENDING"];u.exports=v,v.prototype["catch"]=function(g){return this.then(null,g)},v.prototype.then=function(k,q){if("function"!=typeof k&&this.state===a||"function"!=typeof q&&this.state===N){return this}var g=new this.constructor(i);if(this.state!==s){var j=this.state===a?k:q;b(g,j,this.outcome)}else{this.queue.push(new p(g,k,q))}return g},p.prototype.callFulfilled=function(g){M.resolve(this.promise,g)},p.prototype.otherCallFulfilled=function(g){b(this.promise,this.onFulfilled,g)},p.prototype.callRejected=function(g){M.reject(this.promise,g)},p.prototype.otherCallRejected=function(g){b(this.promise,this.onRejected,g)},M.resolve=function(k,w){var g=f(m,w);if("error"===g.status){return M.reject(k,g.value)}var q=g.value;if(q){y(k,q)}else{k.state=a,k.outcome=w;for(var j=-1,x=k.queue.length;++j<x;){k.queue[j].callFulfilled(w)}}return k},M.reject=function(j,q){j.state=N,j.outcome=q;for(var g=-1,k=j.queue.length;++g<k;){j.queue[g].callRejected(q)}return j},v.resolve=n,v.reject=r,v.all=h,v.race=o},{7:7}],11:[function(b,s,l){function o(h){if(h=""+h,!(h.length>10000)){var k=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(h);if(k){var g=parseFloat(k[1]),j=(k[2]||"ms").toLowerCase();switch(j){case"years":case"year":case"yrs":case"yr":case"y":return g*i;case"days":case"day":case"d":return g*e;case"hours":case"hour":case"hrs":case"hr":case"h":return g*a;case"minutes":case"minute":case"mins":case"min":case"m":return g*t;case"seconds":case"second":case"secs":case"sec":case"s":return g*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return g}}}}function n(g){return g>=e?Math.round(g/e)+"d":g>=a?Math.round(g/a)+"h":g>=t?Math.round(g/t)+"m":g>=r?Math.round(g/r)+"s":g+"ms"}function f(g){return u(g,e,"day")||u(g,a,"hour")||u(g,t,"minute")||u(g,r,"second")||g+" ms"}function u(h,j,g){return j>h?void 0:1.5*j>h?Math.floor(h/j)+" "+g:Math.ceil(h/j)+" "+g+"s"}var r=1000,t=60*r,a=60*t,e=24*a,i=365.25*e;s.exports=function(g,h){return h=h||{},"string"==typeof g?o(g):h["long"]?f(g):n(g)}},{}],12:[function(r,a,i){function o(w){if(null!==w){switch(typeof w){case"boolean":return w?1:0;case"number":return s(w);case"string":return w.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var k=Array.isArray(w),g=k?w:Object.keys(w),m=-1,q=g.length,v="";if(k){for(;++m<q;){v+=i.toIndexableString(g[m])}}else{for(;++m<q;){var j=g[m];v+=i.toIndexableString(j)+i.toIndexableString(w[j])}}return v}}return""}function l(g,w){var k,q=w,m="1"===g[w];if(m){k=0,w++}else{var j="0"===g[w];w++;var y="",v=g.substring(w,w+p),x=parseInt(v,10)+b;for(j&&(x=-x),w+=p;;){var z=g[w];if("\x00"===z){break}y+=z,w++}y=y.split("."),k=1===y.length?parseInt(y,10):parseFloat(y[0]+"."+y[1]),j&&(k-=10),0!==x&&(k=parseFloat(k+"e"+x))}return{num:k,length:w-q}}function u(g,m){var k=g.pop();if(m.length){var j=m[m.length-1];k===j.element&&(m.pop(),j=m[m.length-1]);var q=j.element,v=j.index;if(Array.isArray(q)){q.push(k)}else{if(v===g.length-2){var w=g.pop();q[w]=k}else{g.push(k)}}}}function f(j,m){for(var k=Math.min(j.length,m.length),g=0;k>g;g++){var q=i.collate(j[g],m[g]);if(0!==q){return q}}return j.length===m.length?0:j.length>m.length?1:-1}function F(g,j){return g===j?0:g>j?1:-1}function e(w,k){for(var g=Object.keys(w),m=Object.keys(k),q=Math.min(g.length,m.length),v=0;q>v;v++){var j=i.collate(g[v],m[v]);if(0!==j){return j}if(j=i.collate(w[g[v]],k[m[v]]),0!==j){return j}}return g.length===m.length?0:g.length>m.length?1:-1}function h(j){var k=["boolean","number","string","object"],g=k.indexOf(typeof j);return ~g?null===j?1:Array.isArray(j)?5:3>g?g+2:g+3:Array.isArray(j)?5:void 0}function s(j){if(0===j){return"1"}var x=j.toExponential().split(/e\+?/),m=parseInt(x[1],10),v=0>j,q=v?"0":"2",k=(v?-m:m)-b,g=n.padLeft(k.toString(),"0",p);q+=t+g;var w=Math.abs(parseFloat(x[0]));v&&(w=10-w);var y=w.toFixed(20);return y=y.replace(/\.?0+$/,""),q+=t+y}var b=-324,p=3,t="",n=r(13);i.collate=function(j,m){if(j===m){return 0}j=i.normalizeKey(j),m=i.normalizeKey(m);var k=h(j),g=h(m);if(k-g!==0){return k-g}if(null===j){return 0}switch(typeof j){case"number":return j-m;case"boolean":return j===m?0:m>j?-1:1;case"string":return F(j,m)}return Array.isArray(j)?f(j,m):e(j,m)},i.normalizeKey=function(g){switch(typeof g){case"undefined":return null;case"number":return g===1/0||g===-(1/0)||isNaN(g)?null:g;case"object":var k=g;if(Array.isArray(g)){var j=g.length;g=new Array(j);for(var v=0;j>v;v++){g[v]=i.normalizeKey(k[v])}}else{if(g instanceof Date){return g.toJSON()}if(null!==g){g={};for(var m in k){if(k.hasOwnProperty(m)){var q=k[m];"undefined"!=typeof q&&(g[m]=i.normalizeKey(q))}}}}}return g},i.toIndexableString=function(g){var j="\x00";return g=i.normalizeKey(g),h(g)+t+o(g)+j},i.parseIndexableString=function(g){for(var w=[],m=[],q=0;;){var y=g[q++];if("\x00"!==y){switch(y){case"1":w.push(null);break;case"2":w.push("1"===g[q]),q++;break;case"3":var v=l(g,q);w.push(v.num),q+=v.length;break;case"4":for(var x="";;){var z=g[q];if("\x00"===z){break}x+=z,q++}x=x.replace(/\u0001\u0001/g,"\x00").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),w.push(x);break;case"5":var j={element:[],index:w.length};w.push(j.element),m.push(j);break;case"6":var k={element:{},index:w.length};w.push(k.element),m.push(k);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+y)}}else{if(1===w.length){return w.pop()}u(w,m)}}}},{13:13}],13:[function(b,h,a){function e(m,o,f){for(var n="",g=f-m.length;n.length<g;){n+=o}return n}a.padLeft=function(l,m,f){var g=e(l,m,f);return g+l},a.padRight=function(l,m,f){var g=e(l,m,f);return l+g},a.stringLexCompare=function(f,i){var r,g=f.length,s=i.length;for(r=0;g>r;r++){if(r===s){return 1}var n=f.charAt(r),o=i.charAt(r);if(n!==o){return o>n?-1:1}}return s>g?-1:0},a.intToDecimalForm=function(g){var m=0>g,f="";do{var l=m?-Math.ceil(g%10):Math.floor(g%10);f=l+f,g=m?Math.ceil(g/10):Math.floor(g/10)}while(g);return m&&"0"!==f&&(f="-"+f),f}},{}],14:[function(e,j,a){function i(){this.store={}}function b(g){if(this.store=new i,g&&Array.isArray(g)){for(var h=0,f=g.length;f>h;h++){this.add(g[h])}}}a.Map=i,a.Set=b,i.prototype.mangle=function(f){if("string"!=typeof f){throw new TypeError("key must be a string but Got "+f)}return"$"+f},i.prototype.unmangle=function(f){return f.substring(1)},i.prototype.get=function(f){var g=this.mangle(f);return g in this.store?this.store[g]:void 0},i.prototype.set=function(g,h){var f=this.mangle(g);return this.store[f]=h,!0},i.prototype.has=function(f){var g=this.mangle(f);return g in this.store},i.prototype["delete"]=function(f){var g=this.mangle(f);return g in this.store?(delete this.store[g],!0):!1},i.prototype.forEach=function(f){for(var h=Object.keys(this.store),o=0,g=h.length;g>o;o++){var r=h[o],n=this.store[r];r=this.unmangle(r),f(n,r)}},b.prototype.add=function(f){return this.store.set(f,!0)},b.prototype.has=function(f){return this.store.has(f)},b.prototype["delete"]=function(f){return this.store["delete"](f)}},{}],15:[function(b,e,a){(function(){var i={}.hasOwnProperty,f=[].slice;e.exports=function(o,g){var r,p,q,h;p=[],h=[];for(r in g){i.call(g,r)&&(q=g[r],"this"!==r&&(p.push(r),h.push(q)))}return Function.apply(null,f.call(p).concat([o])).apply(g["this"],h)}}).call(this)},{}],16:[function(f,a,b){!function(i){if("object"==typeof b){a.exports=i()}else{if("function"==typeof c&&c.amd){c(i)}else{var e;try{e=window}catch(j){e=self}e.SparkMD5=i()}}}(function(n){function s(k,w,z,q,j,x){return w=r(r(w,k),r(q,x)),r(w<<j|w>>>32-j,z)}function P(j,q,k,A,x,z,w){return s(q&k|~q&A,j,q,x,z,w)}function m(j,q,k,A,x,z,w){return s(q&A|k&~A,j,q,x,z,w)}function Q(j,q,k,A,x,z,w){return s(q^k^A,j,q,x,z,w)}function u(j,q,k,A,x,z,w){return s(k^(q|~A),j,q,x,z,w)}function g(k,w){var z=k[0],q=k[1],x=k[2],j=k[3];z=P(z,q,x,j,w[0],7,-680876936),j=P(j,z,q,x,w[1],12,-389564586),x=P(x,j,z,q,w[2],17,606105819),q=P(q,x,j,z,w[3],22,-1044525330),z=P(z,q,x,j,w[4],7,-176418897),j=P(j,z,q,x,w[5],12,1200080426),x=P(x,j,z,q,w[6],17,-1473231341),q=P(q,x,j,z,w[7],22,-45705983),z=P(z,q,x,j,w[8],7,1770035416),j=P(j,z,q,x,w[9],12,-1958414417),x=P(x,j,z,q,w[10],17,-42063),q=P(q,x,j,z,w[11],22,-1990404162),z=P(z,q,x,j,w[12],7,1804603682),j=P(j,z,q,x,w[13],12,-40341101),x=P(x,j,z,q,w[14],17,-1502002290),q=P(q,x,j,z,w[15],22,1236535329),z=m(z,q,x,j,w[1],5,-165796510),j=m(j,z,q,x,w[6],9,-1069501632),x=m(x,j,z,q,w[11],14,643717713),q=m(q,x,j,z,w[0],20,-373897302),z=m(z,q,x,j,w[5],5,-701558691),j=m(j,z,q,x,w[10],9,38016083),x=m(x,j,z,q,w[15],14,-660478335),q=m(q,x,j,z,w[4],20,-405537848),z=m(z,q,x,j,w[9],5,568446438),j=m(j,z,q,x,w[14],9,-1019803690),x=m(x,j,z,q,w[3],14,-187363961),q=m(q,x,j,z,w[8],20,1163531501),z=m(z,q,x,j,w[13],5,-1444681467),j=m(j,z,q,x,w[2],9,-51403784),x=m(x,j,z,q,w[7],14,1735328473),q=m(q,x,j,z,w[12],20,-1926607734),z=Q(z,q,x,j,w[5],4,-378558),j=Q(j,z,q,x,w[8],11,-2022574463),x=Q(x,j,z,q,w[11],16,1839030562),q=Q(q,x,j,z,w[14],23,-35309556),z=Q(z,q,x,j,w[1],4,-1530992060),j=Q(j,z,q,x,w[4],11,1272893353),x=Q(x,j,z,q,w[7],16,-155497632),q=Q(q,x,j,z,w[10],23,-1094730640),z=Q(z,q,x,j,w[13],4,681279174),j=Q(j,z,q,x,w[0],11,-358537222),x=Q(x,j,z,q,w[3],16,-722521979),q=Q(q,x,j,z,w[6],23,76029189),z=Q(z,q,x,j,w[9],4,-640364487),j=Q(j,z,q,x,w[12],11,-421815835),x=Q(x,j,z,q,w[15],16,530742520),q=Q(q,x,j,z,w[2],23,-995338651),z=u(z,q,x,j,w[0],6,-198630844),j=u(j,z,q,x,w[7],10,1126891415),x=u(x,j,z,q,w[14],15,-1416354905),q=u(q,x,j,z,w[5],21,-57434055),z=u(z,q,x,j,w[12],6,1700485571),j=u(j,z,q,x,w[3],10,-1894986606),x=u(x,j,z,q,w[10],15,-1051523),q=u(q,x,j,z,w[1],21,-2054922799),z=u(z,q,x,j,w[8],6,1873313359),j=u(j,z,q,x,w[15],10,-30611744),x=u(x,j,z,q,w[6],15,-1560198380),q=u(q,x,j,z,w[13],21,1309151649),z=u(z,q,x,j,w[4],6,-145523070),j=u(j,z,q,x,w[11],10,-1120210379),x=u(x,j,z,q,w[2],15,718787259),q=u(q,x,j,z,w[9],21,-343485551),k[0]=r(z,k[0]),k[1]=r(q,k[1]),k[2]=r(x,k[2]),k[3]=r(j,k[3])}function p(k){var q,j=[];for(q=0;64>q;q+=4){j[q>>2]=k.charCodeAt(q)+(k.charCodeAt(q+1)<<8)+(k.charCodeAt(q+2)<<16)+(k.charCodeAt(q+3)<<24)}return j}function R(k){var q,j=[];for(q=0;64>q;q+=4){j[q>>2]=k[q]+(k[q+1]<<8)+(k[q+2]<<16)+(k[q+3]<<24)}return j}function i(C){var x,q,z,w,k,A,B=C.length,j=[1732584193,-271733879,-1732584194,271733878];for(x=64;B>=x;x+=64){g(j,p(C.substring(x-64,x)))}for(C=C.substring(x-64),q=C.length,z=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],x=0;q>x;x+=1){z[x>>2]|=C.charCodeAt(x)<<(x%4<<3)}if(z[x>>2]|=128<<(x%4<<3),x>55){for(g(j,z),x=0;16>x;x+=1){z[x]=0}}return w=8*B,w=w.toString(16).match(/(.*?)(.{0,8})$/),k=parseInt(w[2],16),A=parseInt(w[1],16)||0,z[14]=k,z[15]=A,g(j,z),j}function o(C){var A,q,z,w,k,x,B=C.length,j=[1732584193,-271733879,-1732584194,271733878];for(A=64;B>=A;A+=64){g(j,R(C.subarray(A-64,A)))}for(C=B>A-64?C.subarray(A-64):new Uint8Array(0),q=C.length,z=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],A=0;q>A;A+=1){z[A>>2]|=C[A]<<(A%4<<3)}if(z[A>>2]|=128<<(A%4<<3),A>55){for(g(j,z),A=0;16>A;A+=1){z[A]=0}}return w=8*B,w=w.toString(16).match(/(.*?)(.{0,8})$/),k=parseInt(w[2],16),x=parseInt(w[1],16)||0,z[14]=k,z[15]=x,g(j,z),j}function v(k){var q,j="";for(q=0;4>q;q+=1){j+=h[k>>8*q+4&15]+h[k>>8*q&15]}return j}function l(j){var k;for(k=0;k<j.length;k+=1){j[k]=v(j[k])}return j.join("")}function t(j){return/[\u0080-\uFFFF]/.test(j)&&(j=unescape(encodeURIComponent(j))),j}function S(k,w){var z,q=k.length,j=new ArrayBuffer(q),x=new Uint8Array(j);for(z=0;q>z;z+=1){x[z]=k.charCodeAt(z)}return w?x:j}function T(j){return String.fromCharCode.apply(null,new Uint8Array(j))}function U(k,w,j){var q=new Uint8Array(k.byteLength+w.byteLength);return q.set(new Uint8Array(k)),q.set(new Uint8Array(w),k.byteLength),j?q:q.buffer}function e(k){var w,j=[],q=k.length;for(w=0;q-1>w;w+=2){j.push(parseInt(k.substr(w,2),16))}return String.fromCharCode.apply(String,j)}function y(){this.reset()}var r=function(j,k){return j+k&4294967295},h=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return"5d41402abc4b2a76b9719d911017c592"!==l(i("hello"))&&(r=function(k,w){var j=(65535&k)+(65535&w),q=(k>>16)+(w>>16)+(j>>16);return q<<16|65535&j}),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||!function(){function j(k,q){return k=0|k||0,0>k?Math.max(k+q,0):Math.min(k,q)}ArrayBuffer.prototype.slice=function(w,A){var x,q,C,z,B=this.byteLength,D=j(w,B),k=B;return A!==n&&(k=j(A,B)),D>k?new ArrayBuffer(0):(x=k-D,q=new ArrayBuffer(x),C=new Uint8Array(q),z=new Uint8Array(this,D,x),C.set(z),q)}}(),y.prototype.append=function(j){return this.appendBinary(t(j)),this},y.prototype.appendBinary=function(k){this._buff+=k,this._length+=k.length;var q,j=this._buff.length;for(q=64;j>=q;q+=64){g(this._hash,p(this._buff.substring(q-64,q)))}return this._buff=this._buff.substring(q-64),this},y.prototype.end=function(k){var w,z,q=this._buff,j=q.length,x=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(w=0;j>w;w+=1){x[w>>2]|=q.charCodeAt(w)<<(w%4<<3)}return this._finish(x,j),z=l(this._hash),k&&(z=e(z)),this.reset(),z},y.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},y.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},y.prototype.setState=function(j){return this._buff=j.buff,this._length=j.length,this._hash=j.hash,this},y.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},y.prototype._finish=function(k,w){var z,q,j,x=w;if(k[x>>2]|=128<<(x%4<<3),x>55){for(g(this._hash,k),x=0;16>x;x+=1){k[x]=0}}z=8*this._length,z=z.toString(16).match(/(.*?)(.{0,8})$/),q=parseInt(z[2],16),j=parseInt(z[1],16)||0,k[14]=q,k[15]=j,g(this._hash,k)},y.hash=function(j,k){return y.hashBinary(t(j),k)},y.hashBinary=function(k,w){var j=i(k),q=l(j);return w?e(q):q},y.ArrayBuffer=function(){this.reset()},y.ArrayBuffer.prototype.append=function(k){var w,j=U(this._buff.buffer,k,!0),q=j.length;for(this._length+=k.byteLength,w=64;q>=w;w+=64){g(this._hash,R(j.subarray(w-64,w)))}return this._buff=q>w-64?new Uint8Array(j.buffer.slice(w-64)):new Uint8Array(0),this},y.ArrayBuffer.prototype.end=function(k){var w,z,q=this._buff,j=q.length,x=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(w=0;j>w;w+=1){x[w>>2]|=q[w]<<(w%4<<3)}return this._finish(x,j),z=l(this._hash),k&&(z=e(z)),this.reset(),z},y.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},y.ArrayBuffer.prototype.getState=function(){var j=y.prototype.getState.call(this);return j.buff=T(j.buff),j},y.ArrayBuffer.prototype.setState=function(j){return j.buff=S(j.buff,!0),y.prototype.setState.call(this,j)},y.ArrayBuffer.prototype.destroy=y.prototype.destroy,y.ArrayBuffer.prototype._finish=y.prototype._finish,y.ArrayBuffer.hash=function(k,w){var j=o(new Uint8Array(k)),q=l(j);return w?e(q):q},y})},{}],17:[function(b,h,a){function e(f,i,r){var g=r[r.length-1];f===g.element&&(r.pop(),g=r[r.length-1]);var s=g.element,n=g.index;if(Array.isArray(s)){s.push(f)}else{if(n===i.length-2){var o=i.pop();s[o]=f}else{i.push(f)}}}a.stringify=function(F){var g=[];g.push({obj:F});for(var r,t,s,i,o,f,n,u,G,l,E,H="";r=g.pop();){if(t=r.obj,s=r.prefix||"",i=r.val||"",H+=s,i){H+=i}else{if("object"!=typeof t){H+="undefined"==typeof t?null:JSON.stringify(t)}else{if(null===t){H+="null"}else{if(Array.isArray(t)){for(g.push({val:"]"}),o=t.length-1;o>=0;o--){f=0===o?"":",",g.push({obj:t[o],prefix:f})}g.push({val:"["})}else{n=[];for(u in t){t.hasOwnProperty(u)&&n.push(u)}for(g.push({val:"}"}),o=n.length-1;o>=0;o--){G=n[o],l=t[G],E=o>0?",":"",E+=JSON.stringify(G)+":",g.push({obj:l,prefix:E})}g.push({val:"{"})}}}}}return H},a.parse=function(F){for(var n,s,t,l,C,i,u,D,f,o=[],E=[],g=0;;){if(n=F[g++],"}"!==n&&"]"!==n&&"undefined"!=typeof n){switch(n){case" ":case"	":case"\n":case":":case",":break;case"n":g+=3,e(null,o,E);break;case"t":g+=3,e(!0,o,E);break;case"f":g+=4,e(!1,o,E);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(s="",g--;;){if(t=F[g++],!/[\d\.\-e\+]/.test(t)){g--;break}s+=t}e(parseFloat(s),o,E);break;case'"':for(l="",C=void 0,i=0;;){if(u=F[g++],'"'===u&&("\\"!==C||i%2!==1)){break}l+=u,C=u,"\\"===C?i++:i=0}e(JSON.parse('"'+l+'"'),o,E);break;case"[":D={element:[],index:o.length},o.push(D.element),E.push(D);break;case"{":f={element:{},index:o.length},o.push(f.element),E.push(f);break;default:throw new Error("unexpectedly reached end of input: "+n)}}else{if(1===o.length){return o.pop()}e(o.pop(),o,E)}}}},{}]},{},[3])(3)});