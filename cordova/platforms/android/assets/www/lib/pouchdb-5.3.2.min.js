!function(b){if("object"==typeof exports&&"undefined"!=typeof module){module.exports=b()}else{if("function"==typeof define&&define.amd){define([],b)}else{var a;a="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,a.PouchDB=b()}}}(function(){var b;return function a(c,f,h){function j(k,m){if(!f[k]){if(!c[k]){var l="function"==typeof require&&require;if(!m&&l){return l(k,!0)}if(g){return g(k,!0)}var i=new Error("Cannot find module '"+k+"'");throw i.code="MODULE_NOT_FOUND",i}var e=f[k]={exports:{}};c[k][0].call(e.exports,function(o){var n=c[k][1][o];return j(n?n:o)},e,e.exports,a,c,f,h)}return f[k].exports}for(var g="function"==typeof require&&require,d=0;d<h.length;d++){j(h[d])}return j}({1:[function(c,f,d){function g(e){return function(){var h=arguments.length;if(h){for(var j=[],i=-1;++i<h;){j[i]=arguments[i]}return e.call(this,j)}return e.call(this,[])}}f.exports=g},{}],2:[function(h,l,f){function c(){return"WebkitAppearance" in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function d(){var e=arguments,n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+f.humanize(this.diff),!n){return e}var i="color: "+this.color;e=[e[0],i,"color: inherit"].concat(Array.prototype.slice.call(e,1));var o=0,p=0;return e[0].replace(/%[a-z%]/g,function(q){"%%"!==q&&(o++,"%c"===q&&(p=o))}),e.splice(p,0,i),e}function g(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function j(e){try{null==e?f.storage.removeItem("debug"):f.storage.debug=e}catch(i){}}function m(){var e;try{e=f.storage.debug}catch(i){}return e}function k(){try{return window.localStorage}catch(e){}}f=l.exports=h(3),f.log=g,f.formatArgs=d,f.save=j,f.load=m,f.useColors=c,f.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:k(),f.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],f.formatters.j=function(e){return JSON.stringify(e)},f.enable(m())},{3:3}],3:[function(g,l,v){function p(){return v.colors[d++%v.colors.length]}function q(e){function i(){}function n(){var s=n,u=+new Date,t=u-(h||u);s.diff=t,s.prev=h,s.curr=u,h=u,null==s.useColors&&(s.useColors=v.useColors()),null==s.color&&s.useColors&&(s.color=p());var o=Array.prototype.slice.call(arguments);o[0]=v.coerce(o[0]),"string"!=typeof o[0]&&(o=["%o"].concat(o));var x=0;o[0]=o[0].replace(/%([a-z%])/g,function(D,B){if("%%"===D){return D}x++;var w=v.formatters[B];if("function"==typeof w){var C=o[x];D=w.call(s,C),o.splice(x,1),x--}return D}),"function"==typeof v.formatArgs&&(o=v.formatArgs.apply(s,o));var r=n.log||v.log||console.log.bind(console);r.apply(s,o)}i.enabled=!1,n.enabled=!0;var f=v.enabled(e)?n:i;return f.namespace=e,f}function c(n){v.save(n);for(var e=(n||"").split(/[\s,]+/),i=e.length,f=0;i>f;f++){e[f]&&(n=e[f].replace(/\*/g,".*?"),"-"===n[0]?v.skips.push(new RegExp("^"+n.substr(1)+"$")):v.names.push(new RegExp("^"+n+"$")))}}function j(){v.enable("")}function m(i){var e,f;for(e=0,f=v.skips.length;f>e;e++){if(v.skips[e].test(i)){return !1}}for(e=0,f=v.names.length;f>e;e++){if(v.names[e].test(i)){return !0}}return !1}function k(e){return e instanceof Error?e.stack||e.message:e}v=l.exports=q,v.coerce=k,v.disable=j,v.enable=c,v.enabled=m,v.humanize=g(9),v.names=[],v.skips=[],v.formatters={};var h,d=0},{9:9}],4:[function(j,l,f){function k(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function d(e){return"function"==typeof e}function g(e){return"number"==typeof e}function h(e){return"object"==typeof e&&null!==e}function c(e){return void 0===e}l.exports=k,k.EventEmitter=k,k.prototype._events=void 0,k.prototype._maxListeners=void 0,k.defaultMaxListeners=10,k.prototype.setMaxListeners=function(e){if(!g(e)||0>e||isNaN(e)){throw TypeError("n must be a positive number")}return this._maxListeners=e,this},k.prototype.emit=function(i){var p,q,n,m,o,e;if(this._events||(this._events={}),"error"===i&&(!this._events.error||h(this._events.error)&&!this._events.error.length)){if(p=arguments[1],p instanceof Error){throw p}throw TypeError('Uncaught, unspecified "error" event.')}if(q=this._events[i],c(q)){return !1}if(d(q)){switch(arguments.length){case 1:q.call(this);break;case 2:q.call(this,arguments[1]);break;case 3:q.call(this,arguments[1],arguments[2]);break;default:m=Array.prototype.slice.call(arguments,1),q.apply(this,m)}}else{if(h(q)){for(m=Array.prototype.slice.call(arguments,1),e=q.slice(),n=e.length,o=0;n>o;o++){e[o].apply(this,m)}}}return !0},k.prototype.addListener=function(m,i){var e;if(!d(i)){throw TypeError("listener must be a function")}return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",m,d(i.listener)?i.listener:i),this._events[m]?h(this._events[m])?this._events[m].push(i):this._events[m]=[this._events[m],i]:this._events[m]=i,h(this._events[m])&&!this._events[m].warned&&(e=c(this._maxListeners)?k.defaultMaxListeners:this._maxListeners,e&&e>0&&this._events[m].length>e&&(this._events[m].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[m].length),"function"==typeof console.trace&&console.trace())),this},k.prototype.on=k.prototype.addListener,k.prototype.once=function(e,m){function i(){this.removeListener(e,i),n||(n=!0,m.apply(this,arguments))}if(!d(m)){throw TypeError("listener must be a function")}var n=!1;return i.listener=m,this.on(e,i),this},k.prototype.removeListener=function(m,p){var o,n,e,i;if(!d(p)){throw TypeError("listener must be a function")}if(!this._events||!this._events[m]){return this}if(o=this._events[m],e=o.length,n=-1,o===p||d(o.listener)&&o.listener===p){delete this._events[m],this._events.removeListener&&this.emit("removeListener",m,p)}else{if(h(o)){for(i=e;i-->0;){if(o[i]===p||o[i].listener&&o[i].listener===p){n=i;break}}if(0>n){return this}1===o.length?(o.length=0,delete this._events[m]):o.splice(n,1),this._events.removeListener&&this.emit("removeListener",m,p)}}return this},k.prototype.removeAllListeners=function(m){var i,e;if(!this._events){return this}if(!this._events.removeListener){return 0===arguments.length?this._events={}:this._events[m]&&delete this._events[m],this}if(0===arguments.length){for(i in this._events){"removeListener"!==i&&this.removeAllListeners(i)}return this.removeAllListeners("removeListener"),this._events={},this}if(e=this._events[m],d(e)){this.removeListener(m,e)}else{if(e){for(;e.length;){this.removeListener(m,e[e.length-1])}}}return delete this._events[m],this},k.prototype.listeners=function(i){var e;return e=this._events&&this._events[i]?d(this._events[i])?[this._events[i]]:this._events[i].slice():[]},k.prototype.listenerCount=function(i){if(this._events){var e=this._events[i];if(d(e)){return 1}if(e){return e.length}}return 0},k.listenerCount=function(i,e){return i.listenerCount(e)}},{}],5:[function(c,f,d){(function(k){function e(){j=!0;for(var n,l,i=g.length;i;){for(l=g,g=[],n=-1;++n<i;){l[n]()}i=g.length}j=!1}function t(i){1!==g.push(i)||j||v()}var v,h=k.MutationObserver||k.WebKitMutationObserver;if(h){var m=0,q=new h(e),p=k.document.createTextNode("");q.observe(p,{characterData:!0}),v=function(){p.data=m=++m%2}}else{if(k.setImmediate||"undefined"==typeof k.MessageChannel){v="document" in k&&"onreadystatechange" in k.document.createElement("script")?function(){var i=k.document.createElement("script");i.onreadystatechange=function(){e(),i.onreadystatechange=null,i.parentNode.removeChild(i),i=null},k.document.documentElement.appendChild(i)}:function(){setTimeout(e,0)}}else{var w=new k.MessageChannel;w.port1.onmessage=e,v=function(){w.port2.postMessage(0)}}}var j,g=[];f.exports=t}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],6:[function(c,f,d){"function"==typeof Object.create?f.exports=function(g,e){g.super_=e,g.prototype=Object.create(e.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}})}:f.exports=function(g,e){g.super_=e;var h=function(){};h.prototype=e.prototype,g.prototype=new h,g.prototype.constructor=g}},{}],7:[function(c,f,d){(function(e){e("object"==typeof d?d:this)}).call(this,function(h){var e=Array.prototype.slice,i=Array.prototype.forEach,g=function(j){if("object"!=typeof j){throw j+" is not an object"}var k=e.call(arguments,1);return i.call(k,function(l){if(l){for(var m in l){"object"==typeof l[m]&&j[m]?g.call(j,j[m],l[m]):j[m]=l[m]}}}),j};h.extend=g})},{}],8:[function(E,k,x){function D(){}function j(e){if("function"!=typeof e){throw new TypeError("resolver must be a function")}this.state=H,this.queue=[],this.outcome=void 0,e!==D&&g(this,e)}function z(f,e,h){this.promise=f,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof h&&(this.onRejected=h,this.callRejected=this.otherCallRejected)}function I(f,e,h){G(function(){var i;try{i=e(h)}catch(l){return d.reject(f,l)}i===f?d.reject(f,new TypeError("Cannot resolve promise with itself")):d.resolve(f,i)})}function C(f){var e=f&&f.then;return f&&"object"==typeof f&&"function"==typeof e?function(){e.apply(f,arguments)}:void 0}function g(i,m){function f(o){e||(e=!0,d.reject(i,o))}function h(o){e||(e=!0,d.resolve(i,o))}function l(){m(h,f)}var e=!1,n=w(l);"error"===n.status&&f(n.value)}function w(f,i){var h={};try{h.value=f(i),h.status="success"}catch(e){h.status="error",h.value=e}return h}function A(e){return e instanceof this?e:d.resolve(new this(D),e)}function q(f){var e=new this(D);return d.reject(e,f)}function F(n){function i(r,s){function t(u){e[s]=u,++o!==l||f||(f=!0,d.resolve(p,e))}m.resolve(r).then(t,function(u){f||(f=!0,d.reject(p,u))})}var m=this;if("[object Array]"!==Object.prototype.toString.call(n)){return this.reject(new TypeError("must be an array"))}var l=n.length,f=!1;if(!l){return this.resolve([])}for(var e=new Array(l),o=0,h=-1,p=new this(D);++h<l;){i(n[h],h)}return p}function B(i){function m(o){f.resolve(o).then(function(p){e||(e=!0,d.resolve(h,p))},function(p){e||(e=!0,d.reject(h,p))})}var f=this;if("[object Array]"!==Object.prototype.toString.call(i)){return this.reject(new TypeError("must be an array"))}var l=i.length,e=!1;if(!l){return this.resolve([])}for(var n=-1,h=new this(D);++n<l;){m(i[n])}return h}var G=E(5),d={},c=["REJECTED"],J=["FULFILLED"],H=["PENDING"];k.exports=x=j,j.prototype["catch"]=function(e){return this.then(null,e)},j.prototype.then=function(e,i){if("function"!=typeof e&&this.state===J||"function"!=typeof i&&this.state===c){return this}var h=new this.constructor(D);if(this.state!==H){var f=this.state===J?e:i;I(h,f,this.outcome)}else{this.queue.push(new z(h,e,i))}return h},z.prototype.callFulfilled=function(e){d.resolve(this.promise,e)},z.prototype.otherCallFulfilled=function(e){I(this.promise,this.onFulfilled,e)},z.prototype.callRejected=function(e){d.reject(this.promise,e)},z.prototype.otherCallRejected=function(e){I(this.promise,this.onRejected,e)},d.resolve=function(h,f){var l=w(C,f);if("error"===l.status){return d.reject(h,l.value)}var m=l.value;if(m){g(h,m)}else{h.state=J,h.outcome=f;for(var i=-1,e=h.queue.length;++i<e;){h.queue[i].callFulfilled(f)}}return h},d.reject=function(f,i){f.state=c,f.outcome=i;for(var h=-1,e=f.queue.length;++h<e;){f.queue[h].callRejected(i)}return f},x.resolve=A,x.reject=q,x.all=F,x.race=B},{5:5}],9:[function(p,x,h){function d(i){if(i=""+i,!(i.length>10000)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(i);if(e){var l=parseFloat(e[1]),f=(e[2]||"ms").toLowerCase();switch(f){case"years":case"year":case"yrs":case"yr":case"y":return l*j;case"days":case"day":case"d":return l*m;case"hours":case"hour":case"hrs":case"hr":case"h":return l*q;case"minutes":case"minute":case"mins":case"min":case"m":return l*w;case"seconds":case"second":case"secs":case"sec":case"s":return l*c;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return l}}}}function g(e){return e>=m?Math.round(e/m)+"d":e>=q?Math.round(e/q)+"h":e>=w?Math.round(e/w)+"m":e>=c?Math.round(e/c)+"s":e+"ms"}function k(e){return v(e,m,"day")||v(e,q,"hour")||v(e,w,"minute")||v(e,c,"second")||e+" ms"}function v(f,e,i){return e>f?void 0:1.5*e>f?Math.floor(f/e)+" "+i:Math.ceil(f/e)+" "+i+"s"}var c=1000,w=60*c,q=60*w,m=24*q,j=365.25*m;x.exports=function(f,e){return e=e||{},"string"==typeof f?d(f):e["long"]?k(f):g(f)}},{}],10:[function(d,c,j){function C(f){if(null!==f){switch(typeof f){case"boolean":return f?1:0;case"number":return q(f);case"string":return f.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var i=Array.isArray(f),n=i?f:Object.keys(f),e=-1,o=n.length,l="";if(i){for(;++e<o;){l+=j.toIndexableString(n[e])}}else{for(;++e<o;){var h=n[e];l+=j.toIndexableString(h)+j.toIndexableString(f[h])}}return l}}return""}function v(o,e){var l,h=e,i="1"===o[e];if(i){l=0,e++}else{var n="0"===o[e];e++;var r="",f=o.substring(e,e+z),s=parseInt(f,10)+x;for(n&&(s=-s),e+=z;;){var p=o[e];if("\x00"===p){break}r+=p,e++}r=r.split("."),l=1===r.length?parseInt(r,10):parseFloat(r[0]+"."+r[1]),n&&(l-=10),0!==s&&(l=parseFloat(l+"e"+s))}return{num:l,length:e-h}}function m(n,e){var i=n.pop();if(e.length){var l=e[e.length-1];i===l.element&&(e.pop(),l=e[e.length-1]);var o=l.element,f=l.index;if(Array.isArray(o)){o.push(i)}else{if(f===n.length-2){var h=n.pop();o[h]=i}else{n.push(i)}}}}function y(e,i){for(var l=Math.min(e.length,i.length),f=0;l>f;f++){var h=j.collate(e[f],i[f]);if(0!==h){return h}}return e.length===i.length?0:e.length>i.length?1:-1}function B(f,e){return f===e?0:f>e?1:-1}function w(f,i){for(var n=Object.keys(f),e=Object.keys(i),o=Math.min(n.length,e.length),l=0;o>l;l++){var h=j.collate(n[l],e[l]);if(0!==h){return h}if(h=j.collate(f[n[l]],i[e[l]]),0!==h){return h}}return n.length===e.length?0:n.length>e.length?1:-1}function k(f){var e=["boolean","number","string","object"],h=e.indexOf(typeof f);return ~h?null===f?1:Array.isArray(f)?5:3>h?h+2:h+3:Array.isArray(f)?5:void 0}function q(e){if(0===e){return"1"}var i=e.toExponential().split(/e\+?/),p=parseInt(i[1],10),n=0>e,o=n?"0":"2",r=(n?-p:p)-x,f=g.padLeft(r.toString(),"0",z);o+=A+f;var l=Math.abs(parseFloat(i[0]));n&&(l=10-l);var h=l.toFixed(20);return h=h.replace(/\.?0+$/,""),o+=A+h}var x=-324,z=3,A="",g=d(11);j.collate=function(h,e){if(h===e){return 0}h=j.normalizeKey(h),e=j.normalizeKey(e);var f=k(h),i=k(e);if(f-i!==0){return f-i}if(null===h){return 0}switch(typeof h){case"number":return h-e;case"boolean":return h===e?0:e>h?-1:1;case"string":return B(h,e)}return Array.isArray(h)?y(h,e):w(h,e)},j.normalizeKey=function(l){switch(typeof l){case"undefined":return null;case"number":return l===1/0||l===-(1/0)||isNaN(l)?null:l;case"object":var h=l;if(Array.isArray(l)){var i=l.length;l=new Array(i);for(var f=0;i>f;f++){l[f]=j.normalizeKey(h[f])}}else{if(l instanceof Date){return l.toJSON()}if(null!==l){l={};for(var e in h){if(h.hasOwnProperty(e)){var n=h[e];"undefined"!=typeof n&&(l[e]=j.normalizeKey(n))}}}}}return l},j.toIndexableString=function(f){var e="\x00";return f=j.normalizeKey(f),k(f)+A+C(f)+e},j.parseIndexableString=function(o){for(var e=[],i=[],h=0;;){var r=o[h++];if("\x00"!==r){switch(r){case"1":e.push(null);break;case"2":e.push("1"===o[h]),h++;break;case"3":var f=v(o,h);e.push(f.num),h+=f.length;break;case"4":for(var s="";;){var p=o[h];if("\x00"===p){break}s+=p,h++}s=s.replace(/\u0001\u0001/g,"\x00").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),e.push(s);break;case"5":var n={element:[],index:e.length};e.push(n.element),i.push(n);break;case"6":var l={element:{},index:e.length};e.push(l.element),i.push(l);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+r)}}else{if(1===e.length){return e.pop()}m(e,i)}}}},{11:11}],11:[function(c,f,d){function g(j,h,e){for(var i="",k=e-j.length;i.length<k;){i+=h}return i}d.padLeft=function(h,e,j){var i=g(h,e,j);return i+h},d.padRight=function(h,e,j){var i=g(h,e,j);return h+i},d.stringLexCompare=function(p,j){var l,h=p.length,m=j.length;for(l=0;h>l;l++){if(l===m){return 1}var k=p.charAt(l),e=j.charAt(l);if(k!==e){return e>k?-1:1}}return m>h?-1:0},d.intToDecimalForm=function(i){var e=0>i,j="";do{var h=e?-Math.ceil(i%10):Math.floor(i%10);j=h+j,i=e?Math.ceil(i/10):Math.floor(i/10)}while(i);return e&&"0"!==j&&(j="-"+j),j}},{}],12:[function(g,d,c){function f(){this.store={}}function h(i){if(this.store=new f,i&&Array.isArray(i)){for(var e=0,j=i.length;j>e;e++){this.add(i[e])}}}c.Map=f,c.Set=h,f.prototype.mangle=function(e){if("string"!=typeof e){throw new TypeError("key must be a string but Got "+e)}return"$"+e},f.prototype.unmangle=function(e){return e.substring(1)},f.prototype.get=function(i){var e=this.mangle(i);return e in this.store?this.store[e]:void 0},f.prototype.set=function(i,e){var j=this.mangle(i);return this.store[j]=e,!0},f.prototype.has=function(i){var e=this.mangle(i);return e in this.store},f.prototype["delete"]=function(i){var e=this.mangle(i);return e in this.store?(delete this.store[e],!0):!1},f.prototype.forEach=function(k){for(var e=Object.keys(this.store),l=0,j=e.length;j>l;l++){var i=e[l],m=this.store[i];i=this.unmangle(i),k(m,i)}},h.prototype.add=function(e){return this.store.set(e,!0)},h.prototype.has=function(e){return this.store.has(e)},h.prototype["delete"]=function(e){return this.store["delete"](e)}},{}],13:[function(p,x,h){function d(){m=!1,c.length?q=c.concat(q):j=-1,q.length&&g()}function g(){if(!m){var f=setTimeout(d);m=!0;for(var e=q.length;e;){for(c=q,q=[];++j<e;){c&&c[j].run()}j=-1,e=q.length}c=null,m=!1,clearTimeout(f)}}function k(f,e){this.fun=f,this.array=e}function v(){}var c,w=x.exports={},q=[],m=!1,j=-1;w.nextTick=function(f){var e=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){e[i-1]=arguments[i]}}q.push(new k(f,e)),1!==q.length||m||setTimeout(g,0)},k.prototype.run=function(){this.fun.apply(null,this.array)},w.title="browser",w.browser=!0,w.env={},w.argv=[],w.version="",w.versions={},w.on=v,w.addListener=v,w.once=v,w.off=v,w.removeListener=v,w.removeAllListeners=v,w.emit=v,w.binding=function(e){throw new Error("process.binding is not supported")},w.cwd=function(){return"/"},w.chdir=function(e){throw new Error("process.chdir is not supported")},w.umask=function(){return 0}},{}],14:[function(c,f,d){(function(){var e={}.hasOwnProperty,g=[].slice;f.exports=function(i,m){var l,k,j,h;k=[],h=[];for(l in m){e.call(m,l)&&(j=m[l],"this"!==l&&(k.push(l),h.push(j)))}return Function.apply(null,g.call(k).concat([i])).apply(m["this"],h)}}).call(this)},{}],15:[function(e,d,c){!function(g){if("object"==typeof c){d.exports=g()}else{if("function"==typeof b&&b.amd){b(g)}else{var h;try{h=window}catch(f){h=self}h.SparkMD5=g()}}}(function(H){function E(i,h,n,m,l,g){return h=K(K(h,i),K(m,g)),K(h<<l|h>>>32-l,n)}function q(m,n,l,h,i,o,g){return E(n&l|~n&h,m,n,i,o,g)}function I(m,n,l,h,i,o,g){return E(n&h|l&~h,m,n,i,o,g)}function G(m,n,l,h,i,o,g){return E(n^l^h,m,n,i,o,g)}function A(m,n,l,h,i,o,g){return E(l^(n|~h),m,n,i,o,g)}function M(i,h){var n=i[0],m=i[1],g=i[2],l=i[3];n=q(n,m,g,l,h[0],7,-680876936),l=q(l,n,m,g,h[1],12,-389564586),g=q(g,l,n,m,h[2],17,606105819),m=q(m,g,l,n,h[3],22,-1044525330),n=q(n,m,g,l,h[4],7,-176418897),l=q(l,n,m,g,h[5],12,1200080426),g=q(g,l,n,m,h[6],17,-1473231341),m=q(m,g,l,n,h[7],22,-45705983),n=q(n,m,g,l,h[8],7,1770035416),l=q(l,n,m,g,h[9],12,-1958414417),g=q(g,l,n,m,h[10],17,-42063),m=q(m,g,l,n,h[11],22,-1990404162),n=q(n,m,g,l,h[12],7,1804603682),l=q(l,n,m,g,h[13],12,-40341101),g=q(g,l,n,m,h[14],17,-1502002290),m=q(m,g,l,n,h[15],22,1236535329),n=I(n,m,g,l,h[1],5,-165796510),l=I(l,n,m,g,h[6],9,-1069501632),g=I(g,l,n,m,h[11],14,643717713),m=I(m,g,l,n,h[0],20,-373897302),n=I(n,m,g,l,h[5],5,-701558691),l=I(l,n,m,g,h[10],9,38016083),g=I(g,l,n,m,h[15],14,-660478335),m=I(m,g,l,n,h[4],20,-405537848),n=I(n,m,g,l,h[9],5,568446438),l=I(l,n,m,g,h[14],9,-1019803690),g=I(g,l,n,m,h[3],14,-187363961),m=I(m,g,l,n,h[8],20,1163531501),n=I(n,m,g,l,h[13],5,-1444681467),l=I(l,n,m,g,h[2],9,-51403784),g=I(g,l,n,m,h[7],14,1735328473),m=I(m,g,l,n,h[12],20,-1926607734),n=G(n,m,g,l,h[5],4,-378558),l=G(l,n,m,g,h[8],11,-2022574463),g=G(g,l,n,m,h[11],16,1839030562),m=G(m,g,l,n,h[14],23,-35309556),n=G(n,m,g,l,h[1],4,-1530992060),l=G(l,n,m,g,h[4],11,1272893353),g=G(g,l,n,m,h[7],16,-155497632),m=G(m,g,l,n,h[10],23,-1094730640),n=G(n,m,g,l,h[13],4,681279174),l=G(l,n,m,g,h[0],11,-358537222),g=G(g,l,n,m,h[3],16,-722521979),m=G(m,g,l,n,h[6],23,76029189),n=G(n,m,g,l,h[9],4,-640364487),l=G(l,n,m,g,h[12],11,-421815835),g=G(g,l,n,m,h[15],16,530742520),m=G(m,g,l,n,h[2],23,-995338651),n=A(n,m,g,l,h[0],6,-198630844),l=A(l,n,m,g,h[7],10,1126891415),g=A(g,l,n,m,h[14],15,-1416354905),m=A(m,g,l,n,h[5],21,-57434055),n=A(n,m,g,l,h[12],6,1700485571),l=A(l,n,m,g,h[3],10,-1894986606),g=A(g,l,n,m,h[10],15,-1051523),m=A(m,g,l,n,h[1],21,-2054922799),n=A(n,m,g,l,h[8],6,1873313359),l=A(l,n,m,g,h[15],10,-30611744),g=A(g,l,n,m,h[6],15,-1560198380),m=A(m,g,l,n,h[13],21,1309151649),n=A(n,m,g,l,h[4],6,-145523070),l=A(l,n,m,g,h[11],10,-1120210379),g=A(g,l,n,m,h[2],15,718787259),m=A(m,g,l,n,h[9],21,-343485551),i[0]=K(n,i[0]),i[1]=K(m,i[1]),i[2]=K(g,i[2]),i[3]=K(l,i[3])}function F(g){var i,h=[];for(i=0;64>i;i+=4){h[i>>2]=g.charCodeAt(i)+(g.charCodeAt(i+1)<<8)+(g.charCodeAt(i+2)<<16)+(g.charCodeAt(i+3)<<24)}return h}function x(g){var i,h=[];for(i=0;64>i;i+=4){h[i>>2]=g[i]+(g[i+1]<<8)+(g[i+2]<<16)+(g[i+3]<<24)}return h}function D(g){var p,h,o,r,m,l,i=g.length,n=[1732584193,-271733879,-1732584194,271733878];for(p=64;i>=p;p+=64){M(n,F(g.substring(p-64,p)))}for(g=g.substring(p-64),h=g.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],p=0;h>p;p+=1){o[p>>2]|=g.charCodeAt(p)<<(p%4<<3)}if(o[p>>2]|=128<<(p%4<<3),p>55){for(M(n,o),p=0;16>p;p+=1){o[p]=0}}return r=8*i,r=r.toString(16).match(/(.*?)(.{0,8})$/),m=parseInt(r[2],16),l=parseInt(r[1],16)||0,o[14]=m,o[15]=l,M(n,o),n}function w(g){var l,h,o,r,m,p,i=g.length,n=[1732584193,-271733879,-1732584194,271733878];for(l=64;i>=l;l+=64){M(n,x(g.subarray(l-64,l)))}for(g=i>l-64?g.subarray(l-64):new Uint8Array(0),h=g.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],l=0;h>l;l+=1){o[l>>2]|=g[l]<<(l%4<<3)}if(o[l>>2]|=128<<(l%4<<3),l>55){for(M(n,o),l=0;16>l;l+=1){o[l]=0}}return r=8*i,r=r.toString(16).match(/(.*?)(.{0,8})$/),m=parseInt(r[2],16),p=parseInt(r[1],16)||0,o[14]=m,o[15]=p,M(n,o),n}function B(g){var i,h="";for(i=0;4>i;i+=1){h+=L[g>>8*i+4&15]+L[g>>8*i&15]}return h}function J(h){var g;for(g=0;g<h.length;g+=1){h[g]=B(h[g])}return h.join("")}function C(g){return/[\u0080-\uFFFF]/.test(g)&&(g=unescape(encodeURIComponent(g))),g}function k(i,h){var n,m=i.length,l=new ArrayBuffer(m),g=new Uint8Array(l);for(n=0;m>n;n+=1){g[n]=i.charCodeAt(n)}return h?g:l}function j(g){return String.fromCharCode.apply(null,new Uint8Array(g))}function f(h,g,i){var l=new Uint8Array(h.byteLength+g.byteLength);return l.set(new Uint8Array(h)),l.set(new Uint8Array(g),h.byteLength),i?l:l.buffer}function N(h){var g,i=[],l=h.length;for(g=0;l-1>g;g+=2){i.push(parseInt(h.substr(g,2),16))}return String.fromCharCode.apply(String,i)}function z(){this.reset()}var K=function(h,g){return h+g&4294967295},L=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return"5d41402abc4b2a76b9719d911017c592"!==J(D("hello"))&&(K=function(h,g){var i=(65535&h)+(65535&g),l=(h>>16)+(g>>16)+(i>>16);return l<<16|65535&i}),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||!function(){function g(h,i){return h=0|h||0,0>h?Math.max(h+i,0):Math.min(h,i)}ArrayBuffer.prototype.slice=function(m,s){var h,l,o,r,n=this.byteLength,p=g(m,n),i=n;return s!==H&&(i=g(s,n)),p>i?new ArrayBuffer(0):(h=i-p,l=new ArrayBuffer(h),o=new Uint8Array(l),r=new Uint8Array(this,p,h),o.set(r),l)}}(),z.prototype.append=function(g){return this.appendBinary(C(g)),this},z.prototype.appendBinary=function(g){this._buff+=g,this._length+=g.length;var i,h=this._buff.length;for(i=64;h>=i;i+=64){M(this._hash,F(this._buff.substring(i-64,i)))}return this._buff=this._buff.substring(i-64),this},z.prototype.end=function(i){var h,n,m=this._buff,l=m.length,g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(h=0;l>h;h+=1){g[h>>2]|=m.charCodeAt(h)<<(h%4<<3)}return this._finish(g,l),n=J(this._hash),i&&(n=N(n)),this.reset(),n},z.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},z.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},z.prototype.setState=function(g){return this._buff=g.buff,this._length=g.length,this._hash=g.hash,this},z.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},z.prototype._finish=function(i,h){var n,m,l,g=h;if(i[g>>2]|=128<<(g%4<<3),g>55){for(M(this._hash,i),g=0;16>g;g+=1){i[g]=0}}n=8*this._length,n=n.toString(16).match(/(.*?)(.{0,8})$/),m=parseInt(n[2],16),l=parseInt(n[1],16)||0,i[14]=m,i[15]=l,M(this._hash,i)},z.hash=function(h,g){return z.hashBinary(C(h),g)},z.hashBinary=function(h,g){var i=D(h),l=J(i);return g?N(l):l},z.ArrayBuffer=function(){this.reset()},z.ArrayBuffer.prototype.append=function(h){var g,i=f(this._buff.buffer,h,!0),l=i.length;for(this._length+=h.byteLength,g=64;l>=g;g+=64){M(this._hash,x(i.subarray(g-64,g)))}return this._buff=l>g-64?new Uint8Array(i.buffer.slice(g-64)):new Uint8Array(0),this},z.ArrayBuffer.prototype.end=function(i){var h,n,m=this._buff,l=m.length,g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(h=0;l>h;h+=1){g[h>>2]|=m[h]<<(h%4<<3)}return this._finish(g,l),n=J(this._hash),i&&(n=N(n)),this.reset(),n},z.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},z.ArrayBuffer.prototype.getState=function(){var g=z.prototype.getState.call(this);return g.buff=j(g.buff),g},z.ArrayBuffer.prototype.setState=function(g){return g.buff=k(g.buff,!0),z.prototype.setState.call(this,g)},z.ArrayBuffer.prototype.destroy=z.prototype.destroy,z.ArrayBuffer.prototype._finish=z.prototype._finish,z.ArrayBuffer.hash=function(h,g){var i=w(new Uint8Array(h)),l=J(i);return g?N(l):l},z})},{}],16:[function(c,f,d){function g(p,j,l){var h=l[l.length-1];p===h.element&&(l.pop(),h=l[l.length-1]);var m=h.element,k=h.index;if(Array.isArray(m)){m.push(p)}else{if(k===j.length-2){var e=j.pop();m[e]=p}else{j.push(p)}}}d.stringify=function(q){var B=[];B.push({obj:q});for(var A,v,z,m,p,w,x,j,h,k,y,e="";A=B.pop();){if(v=A.obj,z=A.prefix||"",m=A.val||"",e+=z,m){e+=m}else{if("object"!=typeof v){e+="undefined"==typeof v?null:JSON.stringify(v)}else{if(null===v){e+="null"}else{if(Array.isArray(v)){for(B.push({val:"]"}),p=v.length-1;p>=0;p--){w=0===p?"":",",B.push({obj:v[p],prefix:w})}B.push({val:"["})}else{x=[];for(j in v){v.hasOwnProperty(j)&&x.push(j)}for(B.push({val:"}"}),p=x.length-1;p>=0;p--){h=x[p],k=v[h],y=p>0?",":"",y+=JSON.stringify(h)+":",B.push({obj:k,prefix:y})}B.push({val:"{"})}}}}}return e},d.parse=function(j){for(var h,q,m,v,e,z,y,r,p,x=[],w=[],k=0;;){if(h=j[k++],"}"!==h&&"]"!==h&&"undefined"!=typeof h){switch(h){case" ":case"	":case"\n":case":":case",":break;case"n":k+=3,g(null,x,w);break;case"t":k+=3,g(!0,x,w);break;case"f":k+=4,g(!1,x,w);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(q="",k--;;){if(m=j[k++],!/[\d\.\-e\+]/.test(m)){k--;break}q+=m}g(parseFloat(q),x,w);break;case'"':for(v="",e=void 0,z=0;;){if(y=j[k++],'"'===y&&("\\"!==e||z%2!==1)){break}v+=y,e=y,"\\"===e?z++:z=0}g(JSON.parse('"'+v+'"'),x,w);break;case"[":r={element:[],index:x.length},x.push(r.element),w.push(r);break;case"{":p={element:{},index:x.length},x.push(p.element),w.push(p);break;default:throw new Error("unexpectedly reached end of input: "+h)}}else{if(1===x.length){return x.pop()}g(x.pop(),x,w)}}}},{}],17:[function(c,f,d){(function(bf,bK){function cD(g){return g&&"object"==typeof g&&"default" in g?g["default"]:g}function em(h,k){for(var j={},l=0,i=k.length;i>l;l++){var g=k[l];g in h&&(j[g]=h[g])}return j}function ag(g){return g instanceof ArrayBuffer||"undefined"!=typeof Blob&&g instanceof Blob}function eD(j){if("function"==typeof j.slice){return j.slice(0)}var h=new ArrayBuffer(j.byteLength),g=new Uint8Array(h),i=new Uint8Array(j);return g.set(i),h}function c5(i){if(i instanceof ArrayBuffer){return eD(i)}var h=i.size,g=i.type;return"function"==typeof i.slice?i.slice(0,h,g):i.webkitSlice(0,h,g)}function cl(g){var j,i,k;if(!g||"object"!=typeof g){return g}if(Array.isArray(g)){for(j=[],i=0,k=g.length;k>i;i++){j[i]=cl(g[i])}return j}if(g instanceof Date){return g.toISOString()}if(ag(g)){return c5(g)}j={};for(i in g){if(Object.prototype.hasOwnProperty.call(g,i)){var h=cl(g[i]);"undefined"!=typeof h&&(j[i]=h)}}return j}function cv(g){var h=!1;return c2(function(i){if(h){throw new Error("once called more than once")}h=!0,g.apply(this,i)})}function aw(g){return c2(function(j){j=cl(j);var k,l=this,i="function"==typeof j[j.length-1]?j.pop():!1;i&&(k=function(m,n){bf.nextTick(function(){i(m,n)})});var h=new dS(function(p,o){var m;try{var q=cv(function(r,s){r?o(r):p(s)});j.push(q),m=g.apply(l,j),m&&"function"==typeof m.then&&p(m)}catch(n){o(n)}});return k&&h.then(function(m){k(null,m)},k),h})}function dL(i,h){function g(n,l,j){if(b6.enabled){for(var m=[n._db_name,l],o=0;o<j.length-1;o++){m.push(j[o])}b6.apply(null,m);var k=j[j.length-1];j[j.length-1]=function(r,p){var q=[n._db_name,l];q=q.concat(r?["error",r]:["success",p]),b6.apply(null,q),k(r,p)}}}return aw(c2(function(j){if(this._closed){return dS.reject(new Error("database is closed"))}if(this._destroyed){return dS.reject(new Error("database is destroyed"))}var k=this;return g(k,i,j),this.taskqueue.isReady?h.apply(this,j):new dS(function(l,m){k.taskqueue.addTask(function(n){n?m(n):l(k[i].apply(k,j))})})}))}function cU(i,h,g){return new dS(function(j,k){i.get(h,function(o,m){if(o){if(404!==o.status){return k(o)}m={}}var l=m._rev,n=g(m);return n?(n._id=h,n._rev=l,void j(kd(i,n,g))):j({updated:!1,rev:l})})})}function kd(i,h,g){return i.put(h).then(function(j){return{updated:!0,rev:j.rev}},function(j){if(409!==j.status){throw j}return cU(i,h._id,g)})}function ds(r){for(var l,o,m,n,q=r.rev_tree.slice();n=q.pop();){var j=n.ids,s=j[2],k=n.pos;if(s.length){for(var i=0,g=s.length;g>i;i++){q.push({pos:k+1,ids:s[i]})}}else{var p=!!j[1].deleted,h=j[0];l&&!(m!==p?m:o!==k?k>o:h>l)||(l=h,o=k,m=p)}}return o+"-"+l}function bx(g){return g.ids}function bg(g,j){j||(j=ds(g));for(var i,k=j.substring(j.indexOf("-")+1),h=g.rev_tree.map(bx);i=h.pop();){if(i[0]===k){return !!i[1].deleted}h=h.concat(i[2])}}function dx(g){return f6("return "+g+";",{})}function e2(g){return new Function("doc",["var emitted = false;","var emit = function (a, b) {","  emitted = true;","};","var view = "+g+";","view(doc);","if (emitted) {","  return true;","}"].join("\n"))}function kb(g){if(!g){return null}var h=g.split("/");return 2===h.length?h:1===h.length?[g,g]:null}function aj(g){var h=kb(g);return h?h.join("/"):null}function ax(j,l){for(var h,o=j.slice();h=o.pop();){for(var g=h.pos,i=h.ids,k=i[2],m=l(0===k.length,g,i[0],h.ctx,i[1]),n=0,p=k.length;p>n;n++){o.push({pos:g+1,ids:k[n],ctx:m})}}}function b5(g,h){return g.pos-h.pos}function bJ(j){var h=[];ax(j,function(k,m,o,l,n){k&&h.push({rev:m+"-"+o,pos:m,opts:n})}),h.sort(b5).reverse();for(var g=0,i=h.length;i>g;g++){delete h[g].pos}return h}function f1(j){for(var m=ds(j),g=bJ(j.rev_tree),i=[],k=0,l=g.length;l>k;k++){var h=g[k];h.rev===m||h.opts.deleted||i.push(h.rev)}return i}function aK(g){Error.call(this,g.reason),this.status=g.status,this.name=g.error,this.message=g.reason,this.error=!0}function aL(j,h,g){function i(k){for(var l in j){"function"!=typeof j[l]&&(this[l]=j[l])}void 0!==g&&(this.name=g),void 0!==k&&(this.reason=k)}return i.prototype=aK.prototype,new i(h)}function eL(h){var k,j,l,i,g;return j=h.error===!0&&"string"==typeof h.name?h.name:h.error,g=h.reason,l=d6("name",j,g),h.missing||"missing"===g||"deleted"===g||"not_found"===j?l=f8:"doc_validation"===j?(l=bB,i=g):"bad_request"===j&&l.message!==g&&(l=e1),l||(l=d6("status",h.status,g)||ad),k=aL(l,g,j),i&&(k.message=i),h.id&&(k.id=h.id),h.status&&(k.status=h.status),h.missing&&(k.missing=h.missing),k}function kf(j,m,g){function i(){k.cancel()}aM.EventEmitter.call(this);var k=this;this.db=j,m=m?cl(m):{};var l=m.complete=cv(function(n,o){n?k.emit("error",n):k.emit("complete",o),k.removeAllListeners(),j.removeListener("destroyed",i)});g&&(k.on("complete",function(n){g(null,n)}),k.on("error",g)),j.once("destroyed",i),m.onChange=function(n){m.isCancelled||(k.emit("change",n),k.startSeq&&k.startSeq<=n.seq&&(k.startSeq=!1))};var h=new dS(function(n,o){m.complete=function(p,q){p?o(p):n(q)}});k.once("cancel",function(){j.removeListener("destroyed",i),m.complete(null,{status:"cancelled"})}),this.then=h.then.bind(h),this["catch"]=h["catch"].bind(h),this.then(function(n){l(null,n)},l),j.taskqueue.isReady?k.doChanges(m):j.taskqueue.addTask(function(){k.isCancelled?k.emit("cancel"):k.doChanges(m)})}function eJ(g,j,i){var k=[{rev:g._rev}];"all_docs"===i.style&&(k=bJ(j.rev_tree).map(function(l){return{rev:l.rev}}));var h={id:j.id,changes:k,doc:g};return bg(j,g._rev)&&(h.deleted=!0),i.conflicts&&(h.doc._conflicts=f1(j),h.doc._conflicts.length||delete h.doc._conflicts),h}function e0(h,l,g){function n(){var r=[];q.forEach(function(s){s.docs.forEach(function(u){r.push({id:s.id,docs:[u]})})}),g(null,{results:r})}function p(){++o===j&&n()}function i(r,u,s){q[r]={id:u,docs:s},p()}var m=Array.isArray(l)?l:l.docs,k={};m.forEach(function(r){r.id in k?k[r.id].push(r):k[r.id]=[r]});var j=Object.keys(k).length,o=0,q=new Array(j);Object.keys(k).forEach(function(v,s){var w=k[v],u=em(w[0],["atts_since","attachments"]);u.open_revs=w.map(function(x){return x.rev}),u.open_revs=u.open_revs.filter(function(x){return x});var r=function(x){return x};0===u.open_revs.length&&(delete u.open_revs,r=function(x){return[{ok:x}]}),["revs","attachments","binary","ajax"].forEach(function(x){x in l&&(u[x]=l[x])}),h.get(v,u,function(y,x){i(s,v,y?[{error:y}]:r(x))})})}function d5(g){return/^_local/.test(g)}function dW(r){for(var l,o=[],m=r.slice();l=m.pop();){var n=l.pos,q=l.ids,j=q[0],s=q[1],k=q[2],i=0===k.length,g=l.history?l.history.slice():[];g.push({id:j,opts:s}),i&&o.push({pos:n+1-g.length,ids:g});for(var p=0,h=k.length;h>p;p++){m.push({pos:n+1,ids:k[p],history:g})}}return o.reverse()}function aN(g){return 0|Math.random()*g}function cQ(j,h){h=h||jN.length;var g="",i=-1;if(j){for(;++i<j;){g+=jN[aN(h)]}return g}for(;++i<36;){switch(i){case 8:case 13:case 18:case 23:g+="-";break;case 19:g+=jN[3&aN(16)|8];break;default:g+=jN[aN(16)]}}return g}function dG(g){return g.reduce(function(i,h){return i[h]=!0,i},{})}function dg(g){var h;if(g?"string"!=typeof g?h=aL(bI):/^_/.test(g)&&!/^_(design|local)/.test(g)&&(h=aL(cf)):h=aL(dE),h){throw h}}function bH(j){if(!/^\d+\-./.test(j)){return aL(kg)}var h=j.indexOf("-"),g=j.substring(0,h),i=j.substring(h+1);return{prefix:parseInt(g,10),id:i}}function cw(j,m){for(var g=j.start-j.ids.length+1,i=j.ids,k=[i[0],m,[]],l=1,h=i.length;h>l;l++){k=[i[l],{status:"missing"},[k]]}return[{pos:g,ids:k}]}function jP(j,l){var h,o,g,i={status:"available"};if(j._deleted&&(i.deleted=!0),l){if(j._id||(j._id=cQ()),o=cQ(32,16).toLowerCase(),j._rev){if(g=bH(j._rev),g.error){return g}j._rev_tree=[{pos:g.prefix,ids:[g.id,{status:"missing"},[[o,i,[]]]]}],h=g.prefix+1}else{j._rev_tree=[{pos:1,ids:[o,i,[]]}],h=1}}else{if(j._revisions&&(j._rev_tree=cw(j._revisions,i),h=j._revisions.start,o=j._revisions.ids[0]),!j._rev_tree){if(g=bH(j._rev),g.error){return g}h=g.prefix,o=g.id,j._rev_tree=[{pos:h,ids:[o,i,[]]}]}}dg(j._id),j._rev=h+"-"+o;var k={metadata:{},data:{}};for(var m in j){if(Object.prototype.hasOwnProperty.call(j,m)){var n="_"===m[0];if(n&&!bC[m]){var p=aL(bB,m);throw p.message=bB.message+": "+m,p}n&&!dM[m]?k.metadata[m.slice(1)]=j[m]:k.data[m]=j[m]}}return k}function dK(g,h){return h>g?-1:g>h?1:0}function cp(i,h){for(var g=0;g<i.length;g++){if(h(i[g],g)===!0){return i[g]}}}function d1(g){return function(h,i){h||i[0]&&i[0].error?g(h||i[0]):g(null,i.length?i[0]:i)}}function eW(h){for(var k=0;k<h.length;k++){var j=h[k];if(j._deleted){delete j._attachments}else{if(j._attachments){for(var l=Object.keys(j._attachments),i=0;i<l.length;i++){var g=l[i];j._attachments[g]=em(j._attachments[g],["data","digest","content_type","length","revpos","stub"])}}}}}function cM(g,j){var i=dK(g._id,j._id);if(0!==i){return i}var k=g._revisions?g._revisions.start:0,h=j._revisions?j._revisions.start:0;return dK(k,h)}function dR(i){var h={},g=[];return ax(i,function(k,j,l,n){var m=j+"-"+l;return k&&(h[m]=0),void 0!==n&&g.push({from:n,to:m}),m}),g.reverse(),g.forEach(function(j){void 0===h[j.from]?h[j.from]=1+h[j.to]:h[j.from]=Math.min(h[j.from],1+h[j.to])}),h}function jH(g,j,i){var k="limit" in j?j.keys.slice(j.skip,j.limit+j.skip):j.skip>0?j.keys.slice(j.skip):j.keys;if(j.descending&&k.reverse(),!k.length){return g._allDocs({limit:0},i)}var h={offset:j.skip};return dS.all(k.map(function(m){var l=bk.extend({key:m,deleted:"ok"},j);return["limit","skip","keys"].forEach(function(n){delete l[n]}),new dS(function(n,o){g._allDocs(l,function(q,p){return q?o(q):(h.total_rows=p.total_rows,void n(p.rows[0]||{key:m,error:"not_found"}))})})})).then(function(l){return h.rows=l,h})}function d2(j){var h=j._compactionQueue[0],i=h.opts,g=h.callback;j.get("_local/compaction")["catch"](function(){return !1}).then(function(k){k&&k.last_seq&&(i.last_seq=k.last_seq),j._compact(i,function(l,m){l?g(l):g(null,m),bf.nextTick(function(){j._compactionQueue.shift(),j._compactionQueue.length&&d2(j)})})})}function ek(g){return"_"===g.charAt(0)?g+"is not a valid attachment name, attachment names cannot start with '_'":!1}function fN(g,j,i,k){j.seq=j.seq||0;var h={doc_ids:["_design/"+i],limit:1,since:j.seq};g.changes(h).then(function(l){var m=l.results&&l.results.length&&l.results[0].seq;m&&m>j.seq&&(j.seq=m,delete j.promise),k()})["catch"](k)}function a8(j,h,g){j._ddocCache=j._ddocCache||{},j._ddocCache[h]=j._ddocCache[h]||{};var i=j._ddocCache[h];fN(j,i,h,function(k){return k?g(k):(i.promise||(i.promise=new dS(function(m,l){j._get("_design/"+h,{},function(p,o){if(p){return l(p)}var n={};["views","filters"].forEach(function(q){n[q]=o.doc[q]}),m(n)})})),void i.promise.then(function(l){g(null,l)})["catch"](g))})}function cV(g,j,i,k,h){a8(g,j,function(l,n){if(l){return h(l)}var m=n[i]&&n[i][k];return m?void h(null,m):h(aL(f8))})}function bd(){aM.EventEmitter.call(this)}function b7(){this.isReady=!1,this.failed=!1,this.queue=[]}function bX(g){g&&bK.debug&&console.error(g)}function eB(j,m){function g(){l.emit("destroyed",k)}function i(){j.removeListener("destroyed",g),j.emit("destroyed",j)}var k=m.originalName,l=j.constructor,h=l._destructionListeners;j.once("destroyed",g),h.has(k)||h.set(k,[]),h.get(k).push(i)}function dp(h,k,j){if(!(this instanceof dp)){return new dp(h,k,j)}var l=this;"function"!=typeof k&&"undefined"!=typeof k||(j=k,k={}),h&&"object"==typeof h&&(k=h,h=void 0),"undefined"==typeof j&&(j=bX),h=h||k.name,k=cl(k),delete k.name,this.__opts=k;var i=j;l.auto_compaction=k.auto_compaction,l.prefix=dp.prefix,bd.call(l),l.taskqueue=new b7;var g=new dS(function(p,n){j=function(r,s){return r?n(r):(delete s.then,void p(s))},k=cl(k);var q,o,m=k.name||h;return function(){try{if("string"!=typeof m){throw o=new Error("Missing/invalid DB name"),o.code=400,o}if(q=dp.parseAdapter(m,k),k.originalName=m,k.name=q.name,k.prefix&&"http"!==q.adapter&&"https"!==q.adapter&&(k.name=k.prefix+k.name),k.adapter=k.adapter||q.adapter,l._adapter=k.adapter,ay("pouchdb:adapter")("Picked adapter: "+k.adapter),l._db_name=m,!dp.adapters[k.adapter]){throw o=new Error("Adapter is missing"),o.code=404,o}if(!dp.adapters[k.adapter].valid()){throw o=new Error("Invalid Adapter"),o.code=404,o}}catch(r){l.taskqueue.fail(r)}}(),o?n(o):(l.adapter=k.adapter,l.replicate={},l.replicate.from=function(r,u,s){return l.constructor.replicate(r,l,u,s)},l.replicate.to=function(r,u,s){return l.constructor.replicate(l,r,u,s)},l.sync=function(r,u,s){return l.constructor.sync(l,r,u,s)},l.replicate.sync=l.sync,void dp.adapters[k.adapter].call(l,k,function(r){return r?(l.taskqueue.fail(r),void j(r)):(eB(l,k),l.emit("created",l),dp.emit("created",k.originalName),l.taskqueue.ready(l),void j(null,l))}))});g.then(function(m){i(null,m)},i),l.then=g.then.bind(g),l["catch"]=g["catch"].bind(g)}function e5(){return"undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage&&"undefined"!=typeof chrome.storage.local}function bO(){return aI}function aH(g){Object.keys(aM.EventEmitter.prototype).forEach(function(i){"function"==typeof aM.EventEmitter.prototype[i]&&(g[i]=a9[i].bind(a9))});var h=g._destructionListeners=new ec.Map;g.on("destroyed",function(i){h.has(i)&&(h.get(i).forEach(function(j){j()}),h["delete"](i))})}function bU(h,k){h=h||[],k=k||{};try{return new Blob(h,k)}catch(j){if("TypeError"!==j.name){throw j}for(var l="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder,i=new l,g=0;g<h.length;g+=1){i.append(h[g])}return i.getBlob(k.type)}}function c3(i,h){if("undefined"==typeof FileReader){return h((new FileReaderSync).readAsArrayBuffer(i))}var g=new FileReader;g.onloadend=function(j){var k=j.target.result||new ArrayBuffer(0);h(k)},g.readAsArrayBuffer(i)}function cx(){for(var j={},h=new dS(function(k,l){j.resolve=k,j.reject=l}),g=new Array(arguments.length),i=0;i<g.length;i++){g[i]=arguments[i]}return j.promise=h,dS.resolve().then(function(){return fetch.apply(null,g)}).then(function(k){j.resolve(k)})["catch"](function(k){j.reject(k)}),j}function eE(j,m){var g,i,k,l=new Headers,h={method:j.method,credentials:"include",headers:l};return j.json&&(l.set("Accept","application/json"),l.set("Content-Type",j.headers["Content-Type"]||"application/json")),j.body&&j.body instanceof Blob?c3(j.body,function(n){h.body=n}):j.body&&j.processData&&"string"!=typeof j.body?h.body=JSON.stringify(j.body):"body" in j?h.body=j.body:h.body=null,Object.keys(j.headers).forEach(function(n){j.headers.hasOwnProperty(n)&&l.set(n,j.headers[n])}),g=cx(j.url,h),j.timeout>0&&(i=setTimeout(function(){g.reject(new Error("Load timeout for resource: "+j.url))},j.timeout)),g.promise.then(function(n){return k={statusCode:n.status},j.timeout>0&&clearTimeout(i),k.statusCode>=200&&k.statusCode<300?j.binary?n.blob():n.text():n.json()}).then(function(n){k.statusCode>=200&&k.statusCode<300?m(null,k,n):m(n,k)})["catch"](function(n){m(n,k)}),{abort:g.reject}}function b0(g,i){var o,l,n=!1,h=function(){o.abort()},j=function(){n=!0,o.abort()};o=g.xhr?new g.xhr:new XMLHttpRequest;try{o.open(g.method,g.url)}catch(k){i(k,{statusCode:413})}o.withCredentials="withCredentials" in g?g.withCredentials:!0,"GET"===g.method?delete g.headers["Content-Type"]:g.json&&(g.headers.Accept="application/json",g.headers["Content-Type"]=g.headers["Content-Type"]||"application/json",g.body&&g.processData&&"string"!=typeof g.body&&(g.body=JSON.stringify(g.body))),g.binary&&(o.responseType="arraybuffer"),"body" in g||(g.body=null);for(var m in g.headers){g.headers.hasOwnProperty(m)&&o.setRequestHeader(m,g.headers[m])}return g.timeout>0&&(l=setTimeout(j,g.timeout),o.onprogress=function(){clearTimeout(l),4!==o.readyState&&(l=setTimeout(j,g.timeout))},"undefined"!=typeof o.upload&&(o.upload.onprogress=o.onprogress)),o.onreadystatechange=function(){if(4===o.readyState){var s={statusCode:o.status};if(o.status>=200&&o.status<300){var q;q=g.binary?bU([o.response||""],{type:o.getResponseHeader("Content-Type")}):o.responseText,i(null,s,q)}else{var p={};if(n){p=new Error("ETIMEDOUT"),s.statusCode=400}else{try{p=JSON.parse(o.response)}catch(r){}}i(p,s)}}},g.body&&g.body instanceof Blob?c3(g.body,function(p){o.send(p)}):o.send(g.body),{abort:h}}function j7(){try{return new XMLHttpRequest,!0}catch(g){return !1}}function dw(g,h){return aE||g.xhr?b0(g,h):eE(g,h)}function aT(){return""}function av(g,j){function i(m,l,n){if(!g.binary&&g.json&&"string"==typeof m){try{m=JSON.parse(m)}catch(o){return n(o)}}Array.isArray(m)&&(m=m.map(function(p){return p.error||p.missing?eL(p):p})),g.binary&&bu(m,l),n(null,m,l)}function k(p,n){var l,o;if(p.code&&p.status){var q=new Error(p.message||p.code);return q.status=p.status,n(q)}if(p.message&&"ETIMEDOUT"===p.message){return n(p)}try{l=JSON.parse(p.responseText),o=eL(l)}catch(m){o=eL(p)}n(o)}g=cl(g);var h={method:"GET",headers:{},json:!0,processData:!0,timeout:10000,cache:!1};return g=bk.extend(h,g),g.json&&(g.binary||(g.headers.Accept="application/json"),g.headers["Content-Type"]=g.headers["Content-Type"]||"application/json"),g.binary&&(g.encoding=null,g.json=!1),g.processData||(g.json=!1),dw(g,function(p,m,r){if(p){return p.status=m?m.statusCode:400,k(p,j)}var n,l=m.headers&&m.headers["content-type"],q=r||aT();if(!g.binary&&(g.json||!g.processData)&&"object"!=typeof q&&(/json/.test(l)||/^[\s]*\{/.test(q)&&/\}[\s]*$/.test(q))){try{q=JSON.parse(q.toString())}catch(o){}}m.statusCode>=200&&m.statusCode<300?i(q,m,j):(n=eL(q),n.status=m.statusCode,j(n))})}function eg(j,l){var h=navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",o=-1!==h.indexOf("safari")&&-1===h.indexOf("chrome"),g=-1!==h.indexOf("msie"),i=-1!==h.indexOf("edge"),k=o||(g||i)&&"GET"===j.method,m="cache" in j?j.cache:!0,n=/^blob:/.test(j.url);if(!n&&(k||!m)){var p=-1!==j.url.indexOf("?");j.url+=(p?"&":"?")+"_nonce="+Date.now()}return av(j,l)}function fJ(j){for(var m=aC.exec(j),g={},i=14;i--;){var k=eU[i],l=m[i]||"",h=-1!==["user","password"].indexOf(k);g[k]=h?decodeURIComponent(l):l}return g[eM]={},g[eU[12]].replace(aV,function(p,n,o){n&&(g[eM][n]=o)}),g}function af(g){for(var j=g.length,i=new ArrayBuffer(j),k=new Uint8Array(i),h=0;j>h;h++){k[h]=g.charCodeAt(h)}return i}function cH(g,h){return bU([af(g)],{type:h})}function dD(g,j,i){try{return !g(j,i)}catch(k){var h="Filter function threw: "+k.toString();return aL(e1,h)}}function el(i){var h={},g=i.filter&&"function"==typeof i.filter;return h.query=i.query_params,function(k){k.doc||(k.doc={});var l=g&&dD(i.filter,k.doc,h);if("object"==typeof l){return l}if(l){return !1}if(i.include_docs){if(!i.attachments){for(var j in k.doc._attachments){k.doc._attachments.hasOwnProperty(j)&&(k.doc._attachments[j].stub=!0)}}}else{delete k.doc}return !0}}function bl(g,h){"console" in bK&&"info" in console&&console.info("The above "+g+" is totally normal. "+h)}function cg(g,j,i,k,h){return g.get(j)["catch"](function(l){if(404===l.status){return"http"===g.type()&&bl(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:k,_id:j,history:[],replicator:b8,version:c7}}throw l}).then(function(l){return h.cancelled?void 0:(l.history=(l.history||[]).filter(function(m){return m.session_id!==k}),l.history.unshift({last_seq:i,session_id:k}),l.history=l.history.slice(0,bc),l.version=c7,l.replicator=b8,l.session_id=k,l.last_seq=i,g.put(l)["catch"](function(m){if(409===m.status){return cg(g,j,i,k,h)}throw m}))})}function d7(j,h,g,i){this.src=j,this.target=h,this.id=g,this.returnValue=i}function dX(j,h){if(j.session_id===h.session_id){return{last_seq:j.last_seq,history:j.history||[]}}var g=j.history||[],i=h.history||[];return fP(g,i)}function fP(h,i){var j=h[0],k=h.slice(1),m=i[0],n=i.slice(1);if(!j||0===i.length){return{last_seq:bM,history:[]}}var l=j.session_id;if(bh(l,i)){return{last_seq:j.last_seq,history:h}}var g=m.session_id;return bh(g,k)?{last_seq:m.last_seq,history:n}:fP(k,n)}function bh(j,h){var g=h[0],i=h.slice(1);return j&&0!==h.length?j===g.session_id?!0:bh(j,i):!1}function fF(g){return"number"==typeof g.status&&4===Math.floor(g.status/100)}function j1(j,h){j=parseInt(j,10)||0,h=parseInt(h,10),h!==h||j>=h?h=(j||1)<<1:h+=1;var g=Math.random(),i=h-j;return ~~(i*g+j)}function cY(g){var h=0;return g||(h=2000),j1(g,h)}function aX(j,h,g,i){return j.retry===!1?(h.emit("error",g),void h.removeAllListeners()):("function"!=typeof j.back_off_function&&(j.back_off_function=cY),h.emit("requestError",g),"active"!==h.state&&"pending"!==h.state||(h.emit("paused",g),h.state="stopped",h.once("active",function(){j.current_back_off=j9})),j.current_back_off=j.current_back_off||j9,j.current_back_off=j.back_off_function(j.current_back_off),void setTimeout(i,j.current_back_off))}function bP(g){return bq(g)}function aY(j,h,g,i){(g>0||i<h.byteLength)&&(h=new Uint8Array(h,g,Math.min(i,h.byteLength)-g)),j.append(h)}function fC(j,h,g,i){(g>0||i<h.length)&&(h=h.substring(g,i)),j.appendBinary(h)}function cX(g){return Object.keys(g).sort(eh.collate).reduce(function(h,i){return h[i]=g[i],h},{})}function j6(j,m,g){var i=g.doc_ids?g.doc_ids.sort(eh.collate):"",k=g.filter?g.filter.toString():"",l="",h="";return g.filter&&g.query_params&&(l=JSON.stringify(cX(g.query_params))),g.filter&&"_view"===g.filter&&(h=g.view.toString()),dS.all([j.id(),m.id()]).then(function(o){var n=o[0]+o[1]+k+h+l+i;return cy(n)}).then(function(n){return n=n.replace(/\//g,".").replace(/\+/g,"_"),"_local/"+n})}function jZ(g){return/^1-/.test(g)}function jG(g){var h=[];return Object.keys(g).forEach(function(j){var i=g[j].missing;i.forEach(function(k){h.push({id:j,rev:k})})}),{docs:h,revs:!0,attachments:!0,binary:!0}}function dz(g,l,h){function o(){var q=jG(l);if(q.docs.length){return g.bulkGet(q).then(function(r){if(h.cancelled){throw new Error("cancelled")}r.results.forEach(function(s){s.docs.forEach(function(u){u.ok?j.push(u.ok):void 0!==u.error&&(n=!1)})})})}}function m(q){return q._attachments&&Object.keys(q._attachments).length>0}function p(q){return g.allDocs({keys:q,include_docs:!0}).then(function(r){if(h.cancelled){throw new Error("cancelled")}r.rows.forEach(function(s){!s.deleted&&s.doc&&jZ(s.value.rev)&&!m(s.doc)&&(j.push(s.doc),delete l[s.id])})})}function i(){var q=Object.keys(l).filter(function(r){var s=l[r].missing;return 1===s.length&&jZ(s[0])});return q.length>0?p(q):void 0}function k(){return{ok:n,docs:j}}l=cl(l);var j=[],n=!0;return dS.resolve().then(i).then(o).then(k)}function dj(q,z,M,H,L){function g(){return j?dS.resolve():j6(q,z,M).then(function(T){C=T,j=new d7(q,z,C,H)})}function G(){if(E=[],0!==o.docs.length){var T=o.docs;return z.bulkDocs({docs:T,new_edits:!1}).then(function(V){if(H.cancelled){throw K(),new Error("cancelled")}var X=[],U={};V.forEach(function(Z){Z.error&&(L.doc_write_failures++,X.push(Z),U[Z.id]=Z)}),p=p.concat(X),L.docs_written+=o.docs.length-X.length;var Y=X.filter(function(Z){return"unauthorized"!==Z.name&&"forbidden"!==Z.name});if(T.forEach(function(Z){var ae=U[Z._id];ae?H.emit("denied",cl(ae)):E.push(Z)}),Y.length>0){var W=new Error("bulkDocs error");throw W.other_errors=X,h("target.bulkDocs failed to write docs",W),new Error("bulkWrite partial failure")}},function(U){throw L.doc_write_failures+=T.length,U})}}function A(){if(o.error){throw new Error("There was a problem getting docs.")}L.last_seq=n=o.seq;var T=cl(L);return E.length&&(T.docs=E,H.emit("change",T)),k=!0,j.writeCheckpoint(o.seq,r).then(function(){if(k=!1,H.cancelled){throw K(),new Error("cancelled")}o=void 0,O()})["catch"](function(U){throw k=!1,h("writeCheckpoint completed with error",U),U})}function u(){var T={};return o.changes.forEach(function(U){"_user/"!==U.id&&(T[U.id]=U.changes.map(function(V){return V.rev}))}),z.revsDiff(T).then(function(U){if(H.cancelled){throw K(),new Error("cancelled")}o.diffs=U})}function l(){return dz(q,o.diffs,H).then(function(T){o.error=!T.ok,T.docs.forEach(function(U){delete o.diffs[U._id],L.docs_read++,o.docs.push(U)})})}function P(){if(!H.cancelled&&!o){if(0===Q.length){return void v(!0)}o=Q.shift(),u().then(l).then(G).then(A).then(P)["catch"](function(T){h("batch processing terminated with error",T)})}}function v(T){return 0===J.changes.length?void (0!==Q.length||o||((R&&B.live||F)&&(H.state="pending",H.emit("paused")),F&&K())):void ((T||F||J.changes.length>=D)&&(Q.push(J),J={seq:0,changes:[],docs:[]},"pending"!==H.state&&"stopped"!==H.state||(H.state="active",H.emit("active")),P()))}function h(T,U){N||(U.message||(U.message=T),L.ok=!1,L.status="aborting",L.errors.push(U),p=p.concat(U),Q=[],J={seq:0,changes:[],docs:[]},K())}function K(){if(!(N||H.cancelled&&(L.status="cancelled",k))){L.status=L.status||"complete",L.end_time=new Date,L.last_seq=n,N=!0;var T=p.filter(function(V){return"unauthorized"!==V.name&&"forbidden"!==V.name});if(T.length>0){var U=p.pop();p.length>0&&(U.other_errors=p),U.result=L,aX(M,H,U,function(){dj(q,z,M,H)})}else{L.errors=p,H.emit("complete",L),H.removeAllListeners()}}}function s(T){if(H.cancelled){return K()}var U=el(M)(T);U&&(J.seq=T.seq,J.changes.push(T),v(B.live))}function S(T){return w=!1,H.cancelled?K():(T.results.length>0?(B.since=T.last_seq,O()):R?(B.live=!0,O()):F=!0,void v(!0))}function I(T){return w=!1,H.cancelled?K():void h("changes rejected",T)}function O(){function V(){U.cancel()}function T(){H.removeListener("cancel",V)}if(!w&&!F&&Q.length<x){w=!0,H._changes&&(H.removeListener("cancel",H._abortChanges),H._changes.cancel()),H.once("cancel",V);var U=q.changes(B).on("change",s);U.then(T,T),U.then(S)["catch"](I),M.retry&&(H._changes=U,H._abortChanges=V)}}function i(){g().then(function(){return H.cancelled?void K():j.getCheckpoint().then(function(T){n=T,B={since:n,limit:D,batch_size:D,style:"all_docs",doc_ids:m,return_docs:!0},M.filter&&("string"!=typeof M.filter?B.include_docs=!0:B.filter=M.filter),"heartbeat" in M&&(B.heartbeat=M.heartbeat),"timeout" in M&&(B.timeout=M.timeout),M.query_params&&(B.query_params=M.query_params),M.view&&(B.view=M.view),O()})})["catch"](function(T){h("getCheckpoint rejected with ",T)})}function y(T){throw k=!1,h("writeCheckpoint completed with error",T),T}var o,C,j,Q=[],J={seq:0,changes:[],docs:[]},k=!1,F=!1,N=!1,n=0,R=M.continuous||M.live||!1,D=M.batch_size||100,x=M.batches_limit||10,w=!1,m=M.doc_ids,p=[],E=[],r=cQ();L=L||{ok:!0,start_time:new Date,docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var B={};return H.ready(q,z),H.cancelled?void K():(H._addedListeners||(H.once("cancel",K),"function"==typeof M.complete&&(H.once("error",M.complete),H.once("complete",function(T){M.complete(null,T)})),H._addedListeners=!0),void ("undefined"==typeof M.since?i():g().then(function(){return k=!0,j.writeCheckpoint(M.since,r)}).then(function(){return k=!1,H.cancelled?void K():(n=M.since,void i())})["catch"](y)))}function bZ(){aM.EventEmitter.call(this),this.cancelled=!1,this.state="pending";var g=this,h=new dS(function(i,j){g.once("complete",i),g.once("error",j)});g.then=function(i,j){return h.then(i,j)},g["catch"]=function(i){return h["catch"](i)},g["catch"](function(){})}function dv(i,h){var g=h.PouchConstructor;return"string"==typeof i?new g(i,h):i}function ah(j,m,g,i){if("function"==typeof g&&(i=g,g={}),"undefined"==typeof g&&(g={}),g.doc_ids&&!Array.isArray(g.doc_ids)){throw aL(e1,"`doc_ids` filter parameter is not a list.")}g.complete=i,g=cl(g),g.continuous=g.continuous||g.live,g.retry="retry" in g?g.retry:!1,g.PouchConstructor=g.PouchConstructor||this;var k=new bZ(g),l=dv(j,g),h=dv(m,g);return dj(l,h,g,k),k}function ca(j,h,g,i){return"function"==typeof g&&(i=g,g={}),"undefined"==typeof g&&(g={}),g=cl(g),g.PouchConstructor=g.PouchConstructor||this,j=c6.toPouch(j,g),h=c6.toPouch(h,g),new dJ(j,h,g,i)}function dJ(p,x,y,r){function w(z){n.emit("change",{direction:"pull",change:z})}function m(z){n.emit("change",{direction:"push",change:z})}function v(z){n.emit("denied",{direction:"push",doc:z})}function k(z){n.emit("denied",{direction:"pull",doc:z})}function i(){n.pushPaused=!0,n.pullPaused&&n.emit("paused")}function s(){n.pullPaused=!0,n.pushPaused&&n.emit("paused")}function o(){n.pushPaused=!1,n.pullPaused&&n.emit("active",{direction:"push"})}function l(){n.pullPaused=!1,n.pushPaused&&n.emit("active",{direction:"pull"})}function q(z){return function(D,A){var B="change"===D&&(A===w||A===m),F="denied"===D&&(A===k||A===v),C="paused"===D&&(A===s||A===i),E="active"===D&&(A===l||A===o);(B||F||C||E)&&(D in g||(g[D]={}),g[D][z]=!0,2===Object.keys(g[D]).length&&n.removeAllListeners(D))}}var n=this;this.canceled=!1;var u=y.push?bk.extend({},y,y.push):y,h=y.pull?bk.extend({},y,y.pull):y;this.push=d4(p,x,u),this.pull=d4(x,p,h),this.pushPaused=!0,this.pullPaused=!0;var g={};y.live&&(this.push.on("complete",n.pull.cancel.bind(n.pull)),this.pull.on("complete",n.push.cancel.bind(n.push))),this.on("newListener",function(z){"change"===z?(n.pull.on("change",w),n.push.on("change",m)):"denied"===z?(n.pull.on("denied",k),n.push.on("denied",v)):"active"===z?(n.pull.on("active",l),n.push.on("active",o)):"paused"===z&&(n.pull.on("paused",s),n.push.on("paused",i))}),this.on("removeListener",function(z){"change"===z?(n.pull.removeListener("change",w),n.push.removeListener("change",m)):"denied"===z?(n.pull.removeListener("denied",k),n.push.removeListener("denied",v)):"active"===z?(n.pull.removeListener("active",l),n.push.removeListener("active",o)):"paused"===z&&(n.pull.removeListener("paused",s),n.push.removeListener("paused",i))}),this.pull.on("removeListener",q("pull")),this.push.on("removeListener",q("push"));var j=dS.all([this.push,this.pull]).then(function(A){var z={push:A[0],pull:A[1]};return n.emit("complete",z),r&&r(null,z),n.removeAllListeners(),z},function(z){if(n.cancel(),r?r(z):n.emit("error",z),n.removeAllListeners(),r){throw z}});this.then=function(A,z){return j.then(A,z)},this["catch"]=function(z){return j["catch"](z)}}function bN(g,h){return cH(j3(g),h)}function f4(g){for(var j="",i=new Uint8Array(g),k=i.byteLength,h=0;k>h;h++){j+=String.fromCharCode(i[h])}return j}function dC(j,h){if("undefined"==typeof FileReader){return h(f4((new FileReaderSync).readAsArrayBuffer(j)))}var g=new FileReader,i="function"==typeof g.readAsBinaryString;g.onloadend=function(k){var l=k.target.result||"";return i?h(l):void h(f4(l))},i?g.readAsBinaryString(j):g.readAsArrayBuffer(j)}function kh(g){return new dS(function(h){dC(g,function(i){h(bq(i))})})}function jL(j){for(var h=[],g=0,i=j.length;i>g;g++){h=h.concat(j[g])}return h}function fR(g){var h=g.doc&&g.doc._attachments;h&&Object.keys(h).forEach(function(i){var j=h[i];j.data=bN(j.data,j.content_type)})}function kk(g){return/^_design/.test(g)?"_design/"+encodeURIComponent(g.slice(8)):/^_local/.test(g)?"_local/"+encodeURIComponent(g.slice(7)):encodeURIComponent(g)}function az(g){return g._attachments&&Object.keys(g._attachments)?dS.all(Object.keys(g._attachments).map(function(h){var i=g._attachments[h];return i.data&&"string"!=typeof i.data?kh(i.data).then(function(j){i.data=j}):void 0})):dS.resolve()}function dl(i){var h=fJ(i);(h.user||h.password)&&(h.auth={username:h.user,password:h.password});var g=h.path.replace(/(^\/|\/$)/g,"").split("/");return h.db=g.pop(),-1===h.db.indexOf("%")&&(h.db=encodeURIComponent(h.db)),h.path=g.join("/"),h}function aU(g,h){return jE(g,g.db+"/"+h)}function jE(i,h){var g=i.path?"/":"";return i.protocol+"://"+i.host+(i.port?":"+i.port:"")+"/"+i.path+g+h}function dP(g){return"?"+Object.keys(g).map(function(h){return h+"="+encodeURIComponent(g[h])}).join("&")}function cC(o,h){function j(A,y,B){var z=A.ajax||{},x=bk.extend(cl(p),z,y);return fL(x.method+" "+x.url),jY.ajax(x,B)}function i(y,x){return new dS(function(A,z){j(y,x,function(C,B){return C?z(C):void A(B)})})}function q(y,x){return dL(y,c2(function(z){w().then(function(){return x.apply(this,z)})["catch"](function(B){var A=z.pop();A(B)})}))}function w(){if(o.skipSetup||o.skip_setup){return dS.resolve()}if(g){return g}var x={method:"GET",url:s};return g=i({},x)["catch"](function(y){return y&&y.status&&404===y.status?(bl(404,"PouchDB is just detecting if the remote exists."),i({},{method:"PUT",url:s})):dS.reject(y)})["catch"](function(y){return y&&y.status&&412===y.status?!0:dS.reject(y)}),g["catch"](function(){g=null}),g}function k(x){return x.split("/").map(encodeURIComponent).join("/")}var v=this,u=dl;o.getHost&&(u=o.getHost);var l=u(o.name,o),s=aU(l,"");o=cl(o);var p=o.ajax||{};if(v.getUrl=function(){return s},v.getHeaders=function(){return p.headers||{}},o.auth||l.auth){var r=o.auth||l.auth,n=r.username+":"+r.password,m=bq(unescape(encodeURIComponent(n)));p.headers=p.headers||{},p.headers.Authorization="Basic "+m}var g;setTimeout(function(){h(null,v)}),v.type=function(){return"http"},v.id=q("id",function(x){j({},{method:"GET",url:jE(l,"")},function(z,y){var A=y&&y.uuid?y.uuid+l.db:aU(l,"");x(null,A)})}),v.request=q("request",function(y,x){y.url=aU(l,y.url),j({},y,x)}),v.compact=q("compact",function(y,x){"function"==typeof y&&(x=y,y={}),y=cl(y),j(y,{url:aU(l,"_compact"),method:"POST"},function(){function z(){v.info(function(B,A){A&&!A.compact_running?x(null,{ok:!0}):setTimeout(z,y.interval||200)})}z()})}),v.bulkGet=dL("bulkGet",function(C,y){function B(E){var F={};C.revs&&(F.revs=!0),C.attachments&&(F.attachments=!0),j({},{url:aU(l,"_bulk_get"+dP(F)),method:"POST",body:{docs:C.docs}},E)}function A(){function I(L){return function(N,M){J[L]=M.results,++K===G&&y(null,{results:jL(J)})}}for(var E=cN,G=Math.ceil(C.docs.length/E),K=0,J=new Array(G),H=0;G>H;H++){var F=em(C,["revs","attachments"]);F.ajax=p,F.docs=C.docs.slice(H*E,Math.min(C.docs.length,(H+1)*E)),e0(x,F,I(H))}}var x=this,z=jE(l,""),D=ck[z];"boolean"!=typeof D?B(function(F,G){if(F){var E=Math.floor(F.status/100);4===E||5===E?(ck[z]=!1,bl(F.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),A()):y(F)}else{ck[z]=!0,y(null,G)}}):D?B(y):A()}),v._info=function(x){w().then(function(){j({},{method:"GET",url:aU(l,"")},function(y,z){return y?x(y):(z.host=aU(l,""),void x(null,z))})})["catch"](x)},v.get=q("get",function(C,y,A){function B(F){var G=F._attachments,E=G&&Object.keys(G);return G&&E.length?dS.all(E.map(function(I){var H=G[I],J=kk(F._id)+"/"+k(I)+"?rev="+F._rev;return i(y,{method:"GET",url:aU(l,J),binary:!0}).then(function(K){return y.binary?K:kh(K)}).then(function(K){delete H.stub,delete H.length,H.data=K})})):void 0}function z(E){return Array.isArray(E)?dS.all(E.map(function(F){return F.ok?B(F.ok):void 0})):B(E)}"function"==typeof y&&(A=y,y={}),y=cl(y);var x={};y.revs&&(x.revs=!0),y.revs_info&&(x.revs_info=!0),y.open_revs&&("all"!==y.open_revs&&(y.open_revs=JSON.stringify(y.open_revs)),x.open_revs=y.open_revs),y.rev&&(x.rev=y.rev),y.conflicts&&(x.conflicts=y.conflicts),C=kk(C);var D={method:"GET",url:aU(l,C+dP(x))};i(y,D).then(function(E){return dS.resolve().then(function(){return y.attachments?z(E):void 0}).then(function(){A(null,E)})})["catch"](A)}),v.remove=q("remove",function(B,z,x,C){var A;"string"==typeof z?(A={_id:B,_rev:z},"function"==typeof x&&(C=x,x={})):(A=B,"function"==typeof z?(C=z,x={}):(C=x,x=z));var y=A._rev||x.rev;j(x,{method:"DELETE",url:aU(l,kk(A._id))+"?rev="+y},C)}),v.getAttachment=q("getAttachment",function(B,z,x,C){"function"==typeof x&&(C=x,x={});var A=x.rev?"?rev="+x.rev:"",y=aU(l,kk(B))+"/"+k(z)+A;j(x,{method:"GET",url:y,binary:!0},C)}),v.removeAttachment=q("removeAttachment",function(A,z,y,x){var B=aU(l,kk(A)+"/"+k(z))+"?rev="+y;j({},{method:"DELETE",url:B},x)}),v.putAttachment=q("putAttachment",function(G,A,B,C,D,x){"function"==typeof D&&(x=D,D=C,C=B,B=null);var y=kk(G)+"/"+k(A),H=aU(l,y);if(B&&(H+="?rev="+B),"string"==typeof C){var F;try{F=j3(C)}catch(z){return x(aL(eI,"Attachment is not a valid base64 string"))}C=F?cH(F,D):""}var E={headers:{"Content-Type":D},method:"PUT",url:H,processData:!1,body:C,timeout:p.timeout||60000};j({},E,x)}),v._bulkDocs=function(z,x,y){z.new_edits=x.new_edits,w().then(function(){return dS.all(z.docs.map(az))}).then(function(){j(x,{method:"POST",url:aU(l,"_bulk_docs"),body:z},function(A,B){return A?y(A):(B.forEach(function(C){C.ok=!0}),void y(null,B))})})["catch"](y)},v.allDocs=q("allDocs",function(C,y){"function"==typeof C&&(y=C,C={}),C=cl(C);var B,A={},z="GET";C.conflicts&&(A.conflicts=!0),C.descending&&(A.descending=!0),C.include_docs&&(A.include_docs=!0),C.attachments&&(A.attachments=!0),C.key&&(A.key=JSON.stringify(C.key)),C.start_key&&(C.startkey=C.start_key),C.startkey&&(A.startkey=JSON.stringify(C.startkey)),C.end_key&&(C.endkey=C.end_key),C.endkey&&(A.endkey=JSON.stringify(C.endkey)),"undefined"!=typeof C.inclusive_end&&(A.inclusive_end=!!C.inclusive_end),"undefined"!=typeof C.limit&&(A.limit=C.limit),"undefined"!=typeof C.skip&&(A.skip=C.skip);var D=dP(A);if("undefined"!=typeof C.keys){var x="keys="+encodeURIComponent(JSON.stringify(C.keys));x.length+D.length+1<=dZ?D+="&"+x:(z="POST",B={keys:C.keys})}i(C,{method:z,url:aU(l,"_all_docs"+D),body:B}).then(function(E){C.include_docs&&C.attachments&&C.binary&&E.rows.forEach(fR),y(null,E)})["catch"](y)}),v._changes=function(D){var y="batch_size" in D?D.batch_size:c8;D=cl(D),D.timeout="timeout" in D?D.timeout:"timeout" in p?p.timeout:30000;var L,A=D.timeout?{timeout:D.timeout-5000}:{},F="undefined"!=typeof D.limit?D.limit:!1;L="return_docs" in D?D.return_docs:"returnDocs" in D?D.returnDocs:!0;var J=F;if(D.style&&(A.style=D.style),(D.include_docs||D.filter&&"function"==typeof D.filter)&&(A.include_docs=!0),D.attachments&&(A.attachments=!0),D.continuous&&(A.feed="longpoll"),D.conflicts&&(A.conflicts=!0),D.descending&&(A.descending=!0),"heartbeat" in D?D.heartbeat&&(A.heartbeat=D.heartbeat):A.heartbeat=10000,D.filter&&"string"==typeof D.filter&&(A.filter=D.filter,"_view"===D.filter&&D.view&&"string"==typeof D.view&&(A.view=D.view)),D.query_params&&"object"==typeof D.query_params){for(var H in D.query_params){D.query_params.hasOwnProperty(H)&&(A[H]=D.query_params[H])}}var B,x="GET";if(D.doc_ids){A.filter="_doc_ids";var I=JSON.stringify(D.doc_ids);I.length<dZ?A.doc_ids=I:(x="POST",B={doc_ids:D.doc_ids})}var G,E,C=function(O,N){if(!D.aborted){A.since=O,"object"==typeof A.since&&(A.since=JSON.stringify(A.since)),D.descending?F&&(A.limit=J):A.limit=!F||J>y?y:J;var M={method:x,url:aU(l,"_changes"+dP(A)),timeout:D.timeout,body:B};E=O,D.aborted||w().then(function(){G=j(D,M,N)})["catch"](N)}},z={results:[]},K=function(P,M){if(!D.aborted){var N=0;if(M&&M.results){N=M.results.length,z.last_seq=M.last_seq;var Q={};Q.query=D.query_params,M.results=M.results.filter(function(R){J--;var S=el(D)(R);return S&&(D.include_docs&&D.attachments&&D.binary&&fR(R),L&&z.results.push(R),D.onChange(R)),S})}else{if(P){return D.aborted=!0,void D.complete(P)}}M&&M.last_seq&&(E=M.last_seq);var O=F&&0>=J||M&&y>N||D.descending;(!D.continuous||F&&0>=J)&&O?D.complete(null,z):setTimeout(function(){C(E,K)},0)}};return C(D.since||0,K),{cancel:function(){D.aborted=!0,G&&G.abort()}}},v.revsDiff=q("revsDiff",function(z,x,y){"function"==typeof x&&(y=x,x={}),j(x,{method:"POST",url:aU(l,"_revs_diff"),body:z},y)}),v._close=function(x){x()},v._destroy=function(x,y){j(x,{url:aU(l,""),method:"DELETE"},function(A,z){return A&&A.status&&404!==A.status?y(A):(v.emit("destroyed"),v.constructor.emit("destroyed",o.name),void y(null,z))})}}function ed(){this.promise=new dS(function(g){g()})}function f9(g){return f3.hash(g)}function cP(h){var i=h.db,j=h.viewName,k=h.map,m=h.reduce,n=h.temporary,l=k.toString()+(m&&m.toString())+"undefined";if(!n&&i._cachedViews){var g=i._cachedViews[l];if(g){return dS.resolve(g)}}return i.info().then(function(p){function o(u){u.views=u.views||{};var r=j;-1===r.indexOf("/")&&(r=j+"/"+j);var s=u.views[r]=u.views[r]||{};if(!s[q]){return s[q]=!0,u}}var q=p.db_name+"-mrview-"+(n?"temp":f9(l));return cU(i,"_local/mrviews",o).then(function(){return i.registerDependentDatabase(q).then(function(s){var u=s.db;u.auto_compaction=!0;var r={name:q,db:u,sourceDB:i,adapter:i.adapter,mapFun:k,reduceFun:m};return r.db.get("_local/lastSeq")["catch"](function(v){if(404!==v.status){throw v}}).then(function(v){return r.seq=v?v.seq:0,n||(i._cachedViews=i._cachedViews||{},i._cachedViews[l]=r,r.db.once("destroyed",function(){delete i._cachedViews[l]})),r})})})})}function eZ(h,k,j,l,i,g){return f6("return ("+h.replace(/;\s*$/,"")+");",{emit:k,sum:j,log:l,isArray:i,toJSON:g})}function f7(g){return -1===g.indexOf("/")?[g,g]:g.split("/")}function ep(g){return 1===g.length&&/^1-/.test(g[0].rev)}function eO(i,h){try{i.emit("error",h)}catch(g){console.error("The user's map/reduce function threw an uncaught error.\nYou can debug this error by doing:\nmyDatabase.on('error', function (err) { debugger; });\nPlease double-check your map/reduce function."),console.error(h)}}function jX(j,h,g){try{return{output:h.apply(null,g)}}catch(i){return eO(j,i),{error:i}}}function ki(i,h){var g=cA(i.key,h.key);return 0!==g?g:cA(i.value,h.value)}function bG(i,h,g){return g=g||0,"number"==typeof h?i.slice(g,h+g):g>0?i.slice(g):i}function ej(i){var h=i.value,g=h&&"object"==typeof h&&h._id||i.id;return g}function bR(g){g.rows.forEach(function(i){var h=i.doc&&i.doc._attachments;h&&Object.keys(h).forEach(function(j){var k=h[j];h[j].data=bN(k.data,k.content_type)})})}function f0(g){return function(h){return g.include_docs&&g.attachments&&g.binary&&bR(h),h}}function fE(g){var h="builtin "+g+" function requires map values to be numbers or number arrays";return new eX(h)}function ka(h){for(var i=0,j=0,k=h.length;k>j;j++){var m=h[j];if("number"!=typeof m){if(!Array.isArray(m)){throw fE("_sum")}i="number"==typeof i?[i]:i;for(var n=0,l=m.length;l>n;n++){var g=m[n];if("number"!=typeof g){throw fE("_sum")}"undefined"==typeof i[n]?i.push(g):i[n]+=g}}else{"number"==typeof i?i+=m:i[0]+=m}}return i}function db(g,j,i,k){var h=j[g];"undefined"!=typeof h&&(k&&(h=encodeURIComponent(JSON.stringify(h))),i.push(g+"="+h))}function eN(g){if("undefined"!=typeof g){var h=Number(g);return isNaN(h)||h!==parseInt(g,10)?g:h}}function bA(g){return g.group_level=eN(g.group_level),g.limit=eN(g.limit),g.skip=eN(g.skip),g}function cK(g){if(g){if("number"!=typeof g){return new fK('Invalid value for integer: "'+g+'"')}if(0>g){return new fK('Invalid value for positive integer: "'+g+'"')}}}function e9(j,h){var g=j.descending?"endkey":"startkey",i=j.descending?"startkey":"endkey";if("undefined"!=typeof j[g]&&"undefined"!=typeof j[i]&&cA(j[g],j[i])>0){throw new fK("No rows can match your key range, reverse your start_key and end_key or set {descending : true}")}if(h.reduce&&j.reduce!==!1){if(j.include_docs){throw new fK("{include_docs:true} is invalid for reduce")}if(j.keys&&j.keys.length>1&&!j.group&&!j.group_level){throw new fK("Multi-key fetches for reduce views must use {group: true}")}}["group_level","limit","skip"].forEach(function(k){var l=cK(j[k]);if(l){throw l}})}function eS(g,i,o){var l,n=[],h="GET";if(db("reduce",o,n),db("include_docs",o,n),db("attachments",o,n),db("limit",o,n),db("descending",o,n),db("group",o,n),db("group_level",o,n),db("skip",o,n),db("stale",o,n),db("conflicts",o,n),db("startkey",o,n,!0),db("start_key",o,n,!0),db("endkey",o,n,!0),db("end_key",o,n,!0),db("inclusive_end",o,n),db("key",o,n,!0),n=n.join("&"),n=""===n?"":"?"+n,"undefined"!=typeof o.keys){var j=2000,k="keys="+encodeURIComponent(JSON.stringify(o.keys));k.length+n.length+1<=j?n+=("?"===n[0]?"&":"?")+k:(h="POST","string"==typeof i?l={keys:o.keys}:i.keys=o.keys)}if("string"==typeof i){var m=f7(i);return g.request({method:h,url:"_design/"+m[0]+"/_view/"+m[1]+n,body:l}).then(f0(o))}return l=l||{},Object.keys(i).forEach(function(p){Array.isArray(i[p])?l[p]=i[p]:l[p]=i[p].toString()}),g.request({method:"POST",url:"_temp_view"+n,body:l}).then(f0(o))}function cG(i,h,g){return new dS(function(j,k){i._query(h,g,function(m,l){return m?k(m):void j(l)})})}function eF(g){return new dS(function(h,i){g._viewCleanup(function(k,j){return k?i(k):void h(j)})})}function dF(g){return function(h){if(404===h.status){return g}throw h}}function j4(h,l,g){function n(){return ep(o)?dS.resolve(k):l.db.get(i)["catch"](dF(k))}function m(r){return r.keys.length?l.db.allDocs({keys:r.keys,include_docs:!0}):dS.resolve({rows:[]})}function p(B,s){for(var x=[],u={},w=0,z=s.rows.length;z>w;w++){var A=s.rows[w],v=A.doc;if(v&&(x.push(v),u[v._id]=!0,v._deleted=!j[v._id],!v._deleted)){var r=j[v._id];"value" in r&&(v.value=r.value)}}var y=Object.keys(j);return y.forEach(function(C){if(!u[C]){var E={_id:C},D=j[C];"value" in D&&(E.value=D.value),x.push(E)}}),B.keys=jK(y.concat(B.keys)),x.push(B),x}var i="_local/doc_"+h,k={_id:i,keys:[]},q=g[h],j=q.indexableKeysToKeyValues,o=q.changes;return n().then(function(r){return m(r).then(function(s){return p(r,s)})})}function jD(j,h,g){var i="_local/lastSeq";return j.db.get(i)["catch"](dF({_id:i,seq:0})).then(function(k){var l=Object.keys(h);return dS.all(l.map(function(m){return j4(m,j,h)})).then(function(n){var m=jL(n);return k.seq=g,m.push(k),j.db.bulkDocs({docs:m})})})}function cZ(i){var h="string"==typeof i?i:i.name,g=e8[h];return g||(g=e8[h]=new ed),g}function fI(g){return cJ(cZ(g),function(){return jJ(g)})()}function jJ(g){function i(p,r){var q={id:n._id,key:eR(p)};"undefined"!=typeof r&&null!==r&&(q.value=eR(r)),l.push(q)}function o(q,p){return function(){return jD(g,q,p)}}var l,n,h;if("function"==typeof g.mapFun&&2===g.mapFun.length){var j=g.mapFun;h=function(p){return j(p,i)}}else{h=eZ(g.mapFun.toString(),i,ka,aZ,Array.isArray,JSON.parse)}var k=g.seq||0,m=new ed;return new dS(function(p,s){function r(){m.finish().then(function(){g.seq=k,p()})}function q(){function u(v){s(v)}g.sourceDB.changes({conflicts:!0,include_docs:!0,style:"all_docs",since:k,limit:cu}).on("complete",function(v){var C=v.results;if(!C.length){return r()}for(var E={},A=0,x=C.length;x>A;A++){var F=C[A];if("_"!==F.doc._id[0]){l=[],n=F.doc,n._deleted||jX(g.sourceDB,h,[n]),l.sort(ki);for(var D,H={},z=0,w=l.length;w>z;z++){var y=l[z],B=[y.key,y.id];0===cA(y.key,D)&&B.push(z);var G=ea(B);H[G]=y,D=y.key}E[F.doc._id]={indexableKeysToKeyValues:H,changes:F.changes}}k=F.seq}return m.add(o(E,k)),C.length<cu?r():q()}).on("error",u)}q()})}function d0(h,l,g){0===g.group_level&&delete g.group_level;var n,m=g.group||g.group_level;n=cO[h.reduceFun]?cO[h.reduceFun]:eZ(h.reduceFun.toString(),null,ka,aZ,Array.isArray,JSON.parse);var p=[],i=isNaN(g.group_level)?Number.POSITIVE_INFINITY:g.group_level;l.forEach(function(r){var u=p[p.length-1],s=m?r.key:null;return m&&Array.isArray(s)&&(s=s.slice(0,i)),u&&0===cA(u.groupKey,s)?(u.keys.push([r.key,r.id]),void u.values.push(r.value)):void p.push({keys:[[r.key,r.id]],values:[r.value],groupKey:s})}),l=[];for(var k=0,q=p.length;q>k;k++){var j=p[k],o=jX(h.sourceDB,n,[j.keys,j.values,!1]);if(o.error&&o.error instanceof eX){throw o.error}l.push({value:o.error?null:o.output,key:j.groupKey})}return{rows:bG(l,g.limit,g.skip)}}function eT(g,h){return cJ(cZ(g),function(){return jO(g,h)})()}function jO(r,l){function o(u){return u.include_docs=!0,r.db.allDocs(u).then(function(v){return n=v.total_rows,v.rows.map(function(z){if("value" in z.doc&&"object"==typeof z.doc.value&&null!==z.doc.value){var x=Object.keys(z.doc.value).sort(),w=["id","key","value"];if(!(w>x||x>w)){return z.doc.value}}var y=jF(z.doc._id);return{key:y[0],id:y[1],value:"value" in z.doc?z.doc.value:null}})})}function m(v){var u;if(u=q?d0(r,v,l):{total_rows:n,offset:j,rows:v},l.include_docs){var w=jK(v.map(ej));return r.sourceDB.allDocs({keys:w,include_docs:!0,conflicts:l.conflicts,attachments:l.attachments,binary:l.binary}).then(function(y){var x={};return y.rows.forEach(function(z){z.doc&&(x["$"+z.id]=z.doc)}),v.forEach(function(A){var B=ej(A),z=x["$"+B];z&&(A.doc=z)}),u})}return u}var n,q=r.reduceFun&&l.reduce!==!1,j=l.skip||0;if("undefined"==typeof l.keys||l.keys.length||(l.limit=0,delete l.keys),"undefined"!=typeof l.keys){var s=l.keys,k=s.map(function(u){var v={startkey:ea([u]),endkey:ea([u,{}])};return o(v)});return dS.all(k).then(jL).then(m)}var i={descending:l.descending};if(l.start_key&&(l.startkey=l.start_key),l.end_key&&(l.endkey=l.end_key),"undefined"!=typeof l.startkey&&(i.startkey=ea(l.descending?[l.startkey,{}]:[l.startkey])),"undefined"!=typeof l.endkey){var g=l.inclusive_end!==!1;l.descending&&(g=!g),i.endkey=ea(g?[l.endkey,{}]:[l.endkey])}if("undefined"!=typeof l.key){var p=ea([l.key]),h=ea([l.key,{}]);i.descending?(i.endkey=p,i.startkey=h):(i.startkey=p,i.endkey=h)}return q||("number"==typeof l.limit&&(i.limit=l.limit),i.skip=j),o(i).then(m)}function jM(g){return g.request({method:"POST",url:"_view_cleanup"})}function aa(g){return g.get("_local/mrviews").then(function(h){var j={};Object.keys(h.views).forEach(function(n){var l=f7(n),m="_design/"+l[0],k=l[1];j[m]=j[m]||{},j[m][k]=!0});var i={keys:Object.keys(j),include_docs:!0};return g.allDocs(i).then(function(n){var k={};n.rows.forEach(function(p){var o=p.key.substring(8);Object.keys(j[p.key]).forEach(function(u){var r=o+"/"+u;h.views[r]||(r=u);var q=Object.keys(h.views[r]),s=p.doc&&p.doc.views&&p.doc.views[u];q.forEach(function(v){k[v]=k[v]||s})})});var m=Object.keys(k).filter(function(o){return !k[o]}),l=m.map(function(o){return cJ(cZ(o),function(){return new g.constructor(o,g.__opts).destroy()})()});return dS.all(l).then(function(){return{ok:!0}})})},dF({ok:!0}))}function j2(m,g,h){if("http"===m.type()){return eS(m,g,h)}if("function"==typeof m._query){return cG(m,g,h)}if("string"!=typeof g){e9(h,g);var j={db:m,viewName:"temp_view/temp_view",map:g.map,reduce:g.reduce,temporary:!0};return bT.add(function(){return cP(j).then(function(o){function p(){return o.db.destroy()}return eQ(fI(o).then(function(){return eT(o,h)}),p)})}),bT.finish()}var i=g,l=f7(i),k=l[0],n=l[1];return m.getView(k,n).then(function(p){e9(h,p);var o={db:m,viewName:i,map:p.map,reduce:p.reduce};return cP(o).then(function(q){return"ok"===h.stale||"update_after"===h.stale?("update_after"===h.stale&&bf.nextTick(function(){fI(q)}),eT(q,h)):fI(q).then(function(){return eT(q,h)})})})}function fK(g){this.status=400,this.name="query_parse_error",this.message=g,this.error=!0;try{Error.captureStackTrace(this,fK)}catch(h){}}function eX(g){this.status=500,this.name="invalid_value",this.message=g,this.error=!0;try{Error.captureStackTrace(this,eX)}catch(h){}}function j8(g){return bq(f4(g))}function eC(h,i,j){function k(o){try{return j3(o)}catch(q){var p=aL(eI,"Attachment is not a valid base64 string");return{error:p}}}function m(q,p){if(q.stub){return p()}if("string"==typeof q.data){var o=k(q.data);if(o.error){return p(o.error)}q.length=o.length,"blob"===i?q.data=cH(o,q.content_type):"base64"===i?q.data=bq(o):q.data=o,cy(o).then(function(r){q.digest="md5-"+r,p()})}else{c3(q.data,function(r){"binary"===i?q.data=f4(r):"base64"===i&&(q.data=j8(r)),cy(r).then(function(s){q.digest="md5-"+s,q.length=r.byteLength,p()})})}}function n(){g++,h.length===g&&(l?j(l):j())}if(!h.length){return j()}var l,g=0;h.forEach(function(r){function p(u){l=u,q++,q===s.length&&n()}var s=r.data&&r.data._attachments?Object.keys(r.data._attachments):[],q=0;if(!s.length){return n()}for(var o in r.data._attachments){r.data._attachments.hasOwnProperty(o)&&m(r.data._attachments[o],p)}})}function bW(g,h){return g.pos-h.pos}function b3(h,k,j){for(var l,i=0,g=h.length;g>i;){l=i+g>>>1,j(h[l],k)<0?i=l+1:g=l}return i}function dH(j,h,g){var i=b3(j,h,g);j.splice(i,0,h)}function dQ(h,i){for(var j,k,m=i,n=h.length;n>m;m++){var l=h[m],g=[l.id,l.opts,[]];k?(k[2].push(g),k=g):j=k=g}return j}function dh(g,h){return g[0]<h[0]?-1:1}function c4(j,l){for(var h=[{tree1:j,tree2:l}],o=!1;h.length>0;){var g=h.pop(),i=g.tree1,k=g.tree2;(i[1].status||k[1].status)&&(i[1].status="available"===i[1].status||"available"===k[1].status?"available":"missing");for(var m=0;m<k[2].length;m++){if(i[2][0]){for(var n=!1,p=0;p<i[2].length;p++){i[2][p][0]===k[2][m][0]&&(h.push({tree1:i[2][p],tree2:k[2][m]}),n=!0)}n||(o="new_branch",dH(i[2],k[2][m],dh))}else{o="new_leaf",i[2][0]=k[2][m]}}}return{conflicts:o,tree:j}}function bY(q,w,p){var n,k=[],v=!1,u=!1;if(!q.length){return{tree:[w],conflicts:"new_leaf"}}for(var y=0,j=q.length;j>y;y++){var o=q[y];if(o.pos===w.pos&&o.ids[0]===w.ids[0]){n=c4(o.ids,w.ids),k.push({pos:o.pos,ids:n.tree}),v=v||n.conflicts,u=!0}else{if(p!==!0){var m=o.pos<w.pos?o:w,s=o.pos<w.pos?w:o,r=s.pos-m.pos,x=[],i=[];for(i.push({ids:m.ids,diff:r,parent:null,parentIdx:null});i.length>0;){var h=i.pop();if(0!==h.diff){for(var g=h.ids[2],z=0,A=g.length;A>z;z++){i.push({ids:g[z],diff:h.diff-1,parent:h.ids,parentIdx:z})}}else{h.ids[0]===s.ids[0]&&x.push(h)}}var l=x[0];l?(n=c4(l.ids,s.ids),l.parent[2][l.parentIdx]=n.tree,k.push({pos:m.pos,ids:m.ids}),v=v||n.conflicts,u=!0):k.push(o)}else{k.push(o)}}}return u||k.push(w),k.sort(bW),{tree:k,conflicts:v||"internal_node"}}function f5(r,l){for(var o,m=dW(r),n={},q=0,j=m.length;j>q;q++){for(var s=m[q],k=s.ids,i=Math.max(0,k.length-l),g={pos:s.pos+i,ids:dQ(k,i)},p=0;i>p;p++){var h=s.pos+p+"-"+k[p].id;n[h]=!0}o=o?bY(o,g,!0).tree:[g]}return ax(o,function(u,w,v){delete n[w+"-"+v]}),{tree:o,revs:Object.keys(n)}}function cB(g,j,i){var k=bY(g,j),h=f5(k.tree,i);return{tree:h.tree,stemmedRevs:h.revs,conflicts:k.conflicts}}function fD(j,l){for(var h,o=j.slice(),g=l.split("-"),i=parseInt(g[0],10),k=g[1];h=o.pop();){if(h.pos===i&&h.ids[0]===k){return !0}for(var m=h.ids[2],n=0,p=m.length;p>n;n++){o.push({pos:h.pos+1,ids:m[n]})}}return !1}function da(r,w,m,g,j,x,k,z){if(fD(w.rev_tree,m.metadata.rev)){return g[j]=m,x()}var h=w.winningRev||ds(w),s="deleted" in w?w.deleted:bg(w,h),B="deleted" in m.metadata?m.metadata.deleted:bg(m.metadata),q=/^1-/.test(m.metadata.rev);if(s&&!B&&z&&q){var l=m.data;l._rev=h,l._id=m.metadata.id,m=jP(l,z)}var y=cB(w.rev_tree,m.metadata.rev_tree[0],r),i=z&&(s&&B||!s&&"new_leaf"!==y.conflicts||s&&!B&&"new_branch"===y.conflicts);if(i){var p=aL(cc);return g[j]=p,x()}var n=m.metadata.rev;m.metadata.rev_tree=y.tree,m.stemmedRevs=y.stemmedRevs||[],w.rev_map&&(m.metadata.rev_map=w.rev_map);var A,u=ds(m.metadata),o=bg(m.metadata,u),v=s===o?0:o>s?-1:1;A=n===u?o:bg(m.metadata,n),k(m,u,o,A,!0,v,j,x)}function aS(g){return"missing"===g.metadata.rev_tree[0].ids[1].status}function aJ(o,j,i,q,u,n,g,k,s){function v(B,x,C){var D=ds(B.metadata),z=bg(B.metadata,D);if("was_delete" in k&&z){return n[x]=aL(f8,"deleted"),C()}var A=l&&aS(B);if(A){var w=aL(cc);return n[x]=w,C()}var y=z?0:1;g(B,D,z,z,!1,y,x,C)}function m(){++h===p&&s&&s()}o=o||1000;var l=k.new_edits,r=new ec.Map,h=0,p=j.length;j.forEach(function(w,y){if(w._id&&d5(w._id)){var z=w._deleted?"_removeLocal":"_putLocal";return void i[z](w,{ctx:u},function(B,A){n[y]=B||A,m()})}var x=w.metadata.id;r.has(x)?(p--,r.get(x).push([w,y])):r.set(x,[[w,y]])}),r.forEach(function(z,x){function w(){++y<z.length?A():m()}function A(){var C=z[y],E=C[0],D=C[1];if(q.has(x)){da(o,q.get(x),E,n,D,w,g,l)}else{var B=cB([],E.metadata.rev_tree[0],o);E.metadata.rev_tree=B.tree,E.stemmedRevs=B.stemmedRevs||[],v(E,D,w)}}var y=0;A()})}function jU(g){var h=[];return ax(g.rev_tree,function(l,i,k,m,j){"available"!==j.status||l||(h.push(i+"-"+k),j.status="missing")}),h}function e(g){try{return JSON.parse(g)}catch(h){return ba.parse(g)}}function bm(g){return g.length<50000?JSON.parse(g):e(g)}function aW(g){try{return JSON.stringify(g)}catch(h){return ba.stringify(g)}}function d8(g,j,i,k){try{g.apply(j,i)}catch(h){k.emit("error",h)}}function aB(g){if(!d9.running&&d9.queue.length){d9.running=!0;var h=d9.queue.shift();h.action(function(i,j){d8(h.callback,this,[i,j],g),d9.running=!1,bf.nextTick(function(){aB(g)})})}}function jT(g){return function(h){var i="unknown_error";h.target&&h.target.error&&(i=h.target.error.name||h.target.error.message),g(aL(aQ,i,h.type))}}function aR(i,h,g){return{data:aW(i),winningRev:h,deletedOrLocal:g?"1":"0",seq:i.seq,id:i.id}}function jR(g){if(!g){return null}var h=bm(g.data);return h.winningRev=g.winningRev,h.deleted="1"===g.deletedOrLocal,h.seq=g.seq,h}function e6(g){if(!g){return g}var h=g._doc_id_rev.lastIndexOf(":");return g._id=g._doc_id_rev.substring(0,h-1),g._rev=g._doc_id_rev.substring(h+1),delete g._doc_id_rev,g}function fM(j,h,g,i){g?i(j?"string"!=typeof j?j:bN(j,h):bU([""],{type:h})):j?"string"!=typeof j?dC(j,function(k){i(bq(k))}):i(j):i("")}function e7(h,i,j,k){function m(){++g===l.length&&k&&k()}function n(s,q){var r=s._attachments[q],p=r.digest,o=j.objectStore(c1).get(p);o.onsuccess=function(u){r.body=u.target.result.body,m()}}var l=Object.keys(h._attachments||{});if(!l.length){return k&&k()}var g=0;l.forEach(function(o){i.attachments&&i.include_docs?n(h,o):(h._attachments[o].stub=!0,m())})}function aO(g,h){return dS.all(g.map(function(i){if(i.doc&&i.doc._attachments){var j=Object.keys(i.doc._attachments);return dS.all(j.map(function(k){var m=i.doc._attachments[k];if("body" in m){var n=m.body,l=m.content_type;return new dS(function(o){fM(n,l,h,function(p){i.doc._attachments[k]=bk.extend(em(m,["digest","content_type"]),{data:p}),o()})})}}))}}))}function dq(j,l,h){function o(){p--,p||g()}function g(){i.length&&i.forEach(function(q){var r=n.index("digestSeq").count(IDBKeyRange.bound(q+"::",q+"::￿",!1,!1));r.onsuccess=function(s){var u=s.target.result;u||m["delete"](q)}})}var i=[],k=h.objectStore(j5),m=h.objectStore(c1),n=h.objectStore(bF),p=j.length;j.forEach(function(s){var r=k.index("_doc_id_rev"),q=l+"::"+s;r.getKey(q).onsuccess=function(w){var v=w.target.result;if("number"!=typeof v){return o()}k["delete"](v);var u=n.index("seq").openCursor(IDBKeyRange.only(v));u.onsuccess=function(y){var x=y.target.result;if(x){var z=x.value.digestSeq.split("::")[0];i.push(z),n["delete"](x.primaryKey),x["continue"]()}else{o()}}}})}function dk(j,h,g){try{return{txn:j.transaction(h,g)}}catch(i){return{error:i}}}function fG(h,K,A,O,G,M,w){function I(){var Q=[dV,j5,c1,eb,bF],P=dk(G,Q,"readwrite");return P.error?w(P.error):(s=P.txn,s.onabort=jT(w),s.ontimeout=jT(w),s.oncomplete=g,m=s.objectStore(dV),F=s.objectStore(j5),o=s.objectStore(c1),H=s.objectStore(bF),void i(function(R){return R?(j=!0,w(R)):void B()}))}function L(){aJ(h.revs_limit,v,O,k,s,l,N,A)}function B(){function P(){++R===v.length&&L()}function U(X){var W=jR(X.target.result);W&&k.set(W.id,W),P()}if(v.length){for(var R=0,V=0,Q=v.length;Q>V;V++){var T=v[V];if(T._id&&d5(T._id)){P()}else{var S=m.get(T.metadata.id);S.onsuccess=U}}}}function g(){j||(M.notify(O._meta.name),O._meta.docCount+=C,w(null,l))}function q(Q,P){var R=o.get(Q);R.onsuccess=function(T){if(T.target.result){P()}else{var S=aL(bp,"unknown stub attachment with digest "+Q);S.status=412,P(S)}}}function i(R){function P(){++S===T.length&&R(Q)}var T=[];if(v.forEach(function(U){U.data&&U.data._attachments&&Object.keys(U.data._attachments).forEach(function(W){var V=U.data._attachments[W];V.stub&&T.push(V.digest)})}),!T.length){return R()}var Q,S=0;T.forEach(function(U){q(U,function(V){V&&!Q&&(Q=V),P()})})}function N(V,P,T,R,S,U,X,Q){C+=U,V.metadata.winningRev=P,V.metadata.deleted=T;var Y=V.data;Y._id=V.metadata.id,Y._rev=V.metadata.rev,R&&(Y._deleted=!0);var W=Y._attachments&&Object.keys(Y._attachments).length;return W?z(V,P,T,S,X,Q):void E(V,P,T,S,X,Q)}function x(Q){var P=jU(Q.metadata);dq(P,Q.metadata.id,s)}function E(Y,R,U,T,W,P){function S(ai){T&&O.auto_compaction?x(Y):Y.stemmedRevs.length&&dq(Y.stemmedRevs,Y.metadata.id,s),V.seq=ai.target.result,delete V.rev;var ao=aR(V,R,U),an=m.put(ao);an.onsuccess=ae}function Q(ao){ao.preventDefault(),ao.stopPropagation();var an=F.index("_doc_id_rev"),ai=an.getKey(X._doc_id_rev);ai.onsuccess=function(at){var ar=F.put(X,at.target.result);ar.onsuccess=S}}function ae(){l[W]={ok:!0,id:V.id,rev:R},k.set(Y.metadata.id,Y.metadata),p(Y,V.seq,P)}var X=Y.data,V=Y.metadata;X._doc_id_rev=V.id+"::"+V.rev,delete X._id,delete X._rev;var Z=F.put(X);Z.onsuccess=S,Z.onerror=Q}function z(X,Q,U,S,T,V){function Z(){Y===W.length&&E(X,Q,U,S,T,V)}function R(){Y++,Z()}var P=X.data,Y=0,W=Object.keys(P._attachments);W.forEach(function(an){var ae=X.data._attachments[an];if(ae.stub){Y++,Z()}else{var ai=ae.data;delete ae.data,ae.revpos=parseInt(Q,10);var ao=ae.digest;y(ao,ai,R)}})}function p(P,U,R){function W(){++T===S.length&&R()}function Q(Z){var Y=P.data._attachments[Z].digest,X=H.put({seq:U,digestSeq:Y+"::"+U});X.onsuccess=W,X.onerror=function(ae){ae.preventDefault(),ae.stopPropagation(),W()}}var T=0,S=Object.keys(P.data._attachments||{});if(!S.length){return R()}for(var V=0;V<S.length;V++){Q(S[V])}}function y(R,P,S){var Q=o.count(R);Q.onsuccess=function(T){var U=T.target.result;if(U){return S()}var W={digest:R,body:P},V=o.put(W);V.onsuccess=S}}for(var s,m,F,o,H,D,v=K.docs,C=0,n=0,J=v.length;J>n;n++){var r=v[n];r._id&&d5(r._id)||(r=v[n]=jP(r,A.new_edits),r.error&&!D&&(D=r))}if(D){return w(D)}var l=new Array(v.length),k=new ec.Map,j=!1,u=O._meta.blobSupport?"blob":"base64";eC(v,u,function(P){return P?w(P):void I()})}function aq(h,k,j,l,i){try{if(h&&k){return i?IDBKeyRange.bound(k,h,!j,!1):IDBKeyRange.bound(h,k,!1,!j)}if(h){return i?IDBKeyRange.upperBound(h):IDBKeyRange.lowerBound(h)}if(k){return i?IDBKeyRange.lowerBound(k,!j):IDBKeyRange.upperBound(k,!j)}if(l){return IDBKeyRange.only(l)}}catch(g){return{error:g}}return null}function jW(j,h,g,i){return"DataError"===g.name&&0===g.code?i(null,{total_rows:j._meta.docCount,offset:h.skip,rows:[]}):void i(aL(aQ,g.name,g.message))}function cW(h,k,j,l){function i(H,F){function J(N,O,L){var M=N.id+"::"+L;w.get(M).onsuccess=function(P){O.doc=e6(P.target.result),H.conflicts&&(O.doc._conflicts=f1(N)),e7(O.doc,H,z)}}function v(L,N,M){var P={id:M.id,key:M.id,value:{rev:N}},O=M.deleted;if("ok"===H.deleted){K.push(P),O?(P.value.deleted=!0,P.doc=null):H.include_docs&&J(M,P,N)}else{if(!O&&C--<=0&&(K.push(P),H.include_docs&&J(M,P,N),0===--B)){return}}L["continue"]()}function A(L){D=k._meta.docCount;var O=L.target.result;if(O){var N=jR(O.value),M=N.winningRev;v(O,M,N)}}function E(){F(null,{total_rows:D,offset:H.skip,rows:K})}function r(){H.attachments?aO(K,H.binary).then(E):E()}var I="startkey" in H?H.startkey:!1,G="endkey" in H?H.endkey:!1,y="key" in H?H.key:!1,C=H.skip||0,B="number"==typeof H.limit?H.limit:-1,s=H.inclusive_end!==!1,u="descending" in H&&H.descending?"prev":null,x=aq(I,G,s,y,u);if(x&&x.error){return jW(k,H,x.error,F)}var o=[dV,j5];H.attachments&&o.push(c1);var q=dk(j,o,"readonly");if(q.error){return F(q.error)}var z=q.txn,n=z.objectStore(dV),m=z.objectStore(j5),p=u?n.openCursor(x,u):n.openCursor(x),w=m.index("_doc_id_rev"),K=[],D=0;z.oncomplete=r,p.onsuccess=A}function g(n,m){return 0===n.limit?m(null,{total_rows:k._meta.docCount,offset:n.skip,rows:[]}):void i(n,m)}g(h,l)}function cd(g){return new dS(function(h){var i=bU([""]);g.objectStore(cj).put(i,"key"),g.onabort=function(j){j.preventDefault(),j.stopPropagation(),h(!1)},g.oncomplete=function(){var j=navigator.userAgent.match(/Chrome\/(\d+)/),k=navigator.userAgent.match(/Edge\//);h(k||!j||parseInt(j[1],10)>=43)}})["catch"](function(){return !1})}function bw(g){e5()?chrome.storage.onChanged.addListener(function(h){null!=h.db_name&&g.emit(h.dbName.newValue)}):bO()&&("undefined"!=typeof addEventListener?addEventListener("storage",function(h){g.emit(h.key)}):window.attachEvent("storage",function(h){g.emit(h.key)}))}function bj(){aM.EventEmitter.call(this),this._listeners={},bw(this)}function dA(i,h){var g=this;d9.queue.push({action:function(j){ap(g,i,j)},callback:h}),aB(g.constructor)}function ap(u,p,i){function k(w){var v=w.createObjectStore(dV,{keyPath:"id"});w.createObjectStore(j5,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),w.createObjectStore(c1,{keyPath:"digest"}),w.createObjectStore(dO,{keyPath:"id",autoIncrement:!1}),w.createObjectStore(cj),v.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),w.createObjectStore(eb,{keyPath:"_id"});var x=w.createObjectStore(bF,{autoIncrement:!0});x.createIndex("seq","seq"),x.createIndex("digestSeq","digestSeq",{unique:!0})}function m(w,v){var x=w.objectStore(dV);x.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),x.openCursor().onsuccess=function(B){var z=B.target.result;if(z){var A=z.value,y=bg(A);A.deletedOrLocal=y?"1":"0",x.put(A),z["continue"]()}else{v()}}}function n(v){v.createObjectStore(eb,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}function o(w,z){var x=w.objectStore(eb),v=w.objectStore(dV),y=w.objectStore(j5),A=v.openCursor();A.onsuccess=function(C){var L=C.target.result;if(L){var G=L.value,I=G.id,H=d5(I),E=ds(G);if(H){var B=I+"::"+E,K=I+"::",D=I+"::~",M=y.index("_doc_id_rev"),J=IDBKeyRange.bound(K,D,!1,!1),F=M.openCursor(J);F.onsuccess=function(N){if(F=N.target.result){var O=F.value;O._doc_id_rev===B&&x.put(O),y["delete"](F.primaryKey),F["continue"]()}else{v["delete"](L.primaryKey),L["continue"]()}}}else{L["continue"]()}}else{z&&z()}}}function l(w){var v=w.createObjectStore(bF,{autoIncrement:!0});v.createIndex("seq","seq"),v.createIndex("digestSeq","digestSeq",{unique:!0})}function s(w,z){var x=w.objectStore(j5),v=w.objectStore(c1),y=w.objectStore(bF),A=v.count();A.onsuccess=function(B){var C=B.target.result;return C?void (x.openCursor().onsuccess=function(K){var G=K.target.result;if(!G){return z()}for(var F=G.value,I=G.primaryKey,M=Object.keys(F._attachments||{}),E={},D=0;D<M.length;D++){var L=F._attachments[M[D]];E[L.digest]=!0}var J=Object.keys(E);for(D=0;D<J.length;D++){var H=J[D];y.put({seq:I,digestSeq:H+"::"+I})}G["continue"]()}):z()}}function g(y){function v(A){return A.data?jR(A):(A.deleted="1"===A.deletedOrLocal,A)}var w=y.objectStore(j5),x=y.objectStore(dV),z=x.openCursor();z.onsuccess=function(C){function D(){var H=A.id+"::",F=A.id+"::￿",G=w.index("_doc_id_rev").openCursor(IDBKeyRange.bound(H,F)),I=0;G.onsuccess=function(K){var J=K.target.result;if(!J){return A.seq=I,B()}var L=J.primaryKey;L>I&&(I=L),J["continue"]()}}function B(){var G=aR(A,A.winningRev,A.deleted),F=x.put(G);F.onsuccess=function(){E["continue"]()}}var E=C.target.result;if(E){var A=v(E.value);return A.winningRev=A.winningRev||ds(A),A.seq?B():void D()}}}var q=p.name,j=null;u._meta=null,u.type=function(){return"idb"},u._id=aw(function(v){v(null,u._meta.instanceId)}),u._bulkDocs=function(x,v,w){fG(p,x,v,u,j,f2,w)},u._get=function(C,w,B){function z(){B(D,{doc:A,metadata:y,ctx:x})}var A,y,D,x=w.ctx;if(!x){var v=dk(j,[dV,j5,c1],"readonly");if(v.error){return B(v.error)}x=v.txn}x.objectStore(dV).get(C).onsuccess=function(E){if(y=jR(E.target.result),!y){return D=aL(f8,"missing"),z()}if(bg(y)&&!w.rev){return D=aL(f8,"deleted"),z()}var G=x.objectStore(j5),H=w.rev||y.winningRev,F=y.id+"::"+H;G.index("_doc_id_rev").get(F).onsuccess=function(I){return A=I.target.result,A&&(A=e6(A)),A?void z():(D=aL(f8,"missing"),z())}}},u._getAttachment=function(A,y,w){var v;if(y.ctx){v=y.ctx}else{var x=dk(j,[dV,j5,c1],"readonly");if(x.error){return w(x.error)}v=x.txn}var B=A.digest,z=A.content_type;v.objectStore(c1).get(B).onsuccess=function(C){var D=C.target.result.body;fM(D,z,y.binary,function(E){w(null,E)})}},u._info=function(y){if(null===j||!cR.has(q)){var A=new Error("db isn't open");return A.id="idbNull",y(A)}var v,w,B=dk(j,[j5],"readonly");if(B.error){return y(B.error)}var z=B.txn,x=z.objectStore(j5).openCursor(null,"prev");x.onsuccess=function(D){var C=D.target.result;v=C?C.key:0,w=u._meta.docCount},z.oncomplete=function(){y(null,{doc_count:w,update_seq:v,idb_attachment_format:u._meta.blobSupport?"binary":"base64"})}},u._allDocs=function(v,w){cW(v,u,j,w)},u._changes=function(w){function L(N){function S(){return R.seq!==T?N["continue"]():(M=T,R.winningRev===O._rev?Q(O):void P())}function P(){var U=O._id+"::"+R.winningRev,V=x.get(U);V.onsuccess=function(W){Q(e6(W.target.result))}}function Q(V){var W=w.processChange(V,R,w);W.seq=R.seq;var U=I(W);return"object"==typeof U?w.complete(U):(U&&(E++,C&&G.push(W),w.attachments&&w.include_docs?e7(V,w,z,function(){aO([W],w.binary).then(function(){w.onChange(W)})}):w.onChange(W)),void (E!==F&&N["continue"]()))}var O=e6(N.value),T=N.key;if(B&&!B.has(O._id)){return N["continue"]()}var R;return(R=y.get(O._id))?S():void (H.get(O._id).onsuccess=function(U){R=jR(U.target.result),y.set(O._id,R),S()})}function K(O){var N=O.target.result;N&&L(N)}function D(){var O=[dV,j5];w.attachments&&O.push(c1);var N=dk(j,O,"readonly");if(N.error){return w.complete(N.error)}z=N.txn,z.onabort=jT(w.complete),z.oncomplete=A,J=z.objectStore(j5),H=z.objectStore(dV),x=J.index("_doc_id_rev");var P;P=w.descending?J.openCursor(null,"prev"):J.openCursor(IDBKeyRange.lowerBound(w.since,!0)),P.onsuccess=K}function A(){function N(){w.complete(null,{results:G,last_seq:M})}!w.continuous&&w.attachments?aO(G).then(N):N()}if(w=cl(w),w.continuous){var v=q+":"+cQ();return f2.addListener(q,v,u,w),f2.notify(q),{cancel:function(){f2.removeListener(q,v)}}}var B=w.doc_ids&&new ec.Set(w.doc_ids);w.since=w.since||0;var M=w.since,F="limit" in w?w.limit:-1;0===F&&(F=1);var C;C="return_docs" in w?w.return_docs:"returnDocs" in w?w.returnDocs:!0;var z,J,H,x,G=[],E=0,I=el(w),y=new ec.Map;D()},u._close=function(v){return null===j?v(aL(ef)):(j.close(),cR["delete"](q),j=null,void v())},u._getRevisionTree=function(y,v){var w=dk(j,[dV],"readonly");if(w.error){return v(w.error)}var x=w.txn,z=x.objectStore(dV).get(y);z.onsuccess=function(B){var A=jR(B.target.result);A?v(null,A.rev_tree):v(aL(f8))}},u._doCompaction=function(A,y,w){var v=[dV,j5,c1,bF],x=dk(j,v,"readwrite");if(x.error){return w(x.error)}var B=x.txn,z=B.objectStore(dV);z.get(A).onsuccess=function(E){var C=jR(E.target.result);ax(C.rev_tree,function(I,K,H,J,G){var L=K+"-"+H;-1!==y.indexOf(L)&&(G.status="missing")}),dq(y,A,B);var D=C.winningRev,F=C.deleted;B.objectStore(dV).put(aR(C,D,F))},B.onabort=jT(w),B.oncomplete=function(){w()}},u._getLocal=function(y,v){var w=dk(j,[eb],"readonly");if(w.error){return v(w.error)}var x=w.txn,z=x.objectStore(eb).get(y);z.onerror=jT(v),z.onsuccess=function(B){var A=B.target.result;A?(delete A._doc_id_rev,v(null,A)):v(aL(f8))}},u._putLocal=function(z,D,y){"function"==typeof D&&(y=D,D={}),delete z._revisions;var w=z._rev,x=z._id;w?z._rev="0-"+(parseInt(w.split("-")[1],10)+1):z._rev="0-1";var v,B=D.ctx;if(!B){var E=dk(j,[eb],"readwrite");if(E.error){return y(E.error)}B=E.txn,B.onerror=jT(y),B.oncomplete=function(){v&&y(null,v)}}var C,A=B.objectStore(eb);w?(C=A.get(x),C.onsuccess=function(H){var G=H.target.result;if(G&&G._rev===w){var F=A.put(z);F.onsuccess=function(){v={ok:!0,id:z._id,rev:z._rev},D.ctx&&y(null,v)}}else{y(aL(cc))}}):(C=A.add(z),C.onerror=function(F){y(aL(cc)),F.preventDefault(),F.stopPropagation()},C.onsuccess=function(){v={ok:!0,id:z._id,rev:z._rev},D.ctx&&y(null,v)})},u._removeLocal=function(C,w,B){"function"==typeof w&&(B=w,w={});var z=w.ctx;if(!z){var A=dk(j,[eb],"readwrite");if(A.error){return B(A.error)}z=A.txn,z.oncomplete=function(){y&&B(null,y)}}var y,D=C._id,x=z.objectStore(eb),v=x.get(D);v.onerror=jT(B),v.onsuccess=function(F){var E=F.target.result;E&&E._rev===C._rev?(x["delete"](D),y={ok:!0,id:D,rev:"0-0"},w.ctx&&B(null,y)):B(aL(f8))}},u._destroy=function(y,w){f2.removeAllListeners(q);var v=am.get(q);v&&v.result&&(v.result.close(),cR["delete"](q));var x=indexedDB.deleteDatabase(q);x.onsuccess=function(){am["delete"](q),bO()&&q in localStorage&&delete localStorage[q],w(null,{ok:!0})},x.onerror=jT(w)};var h=cR.get(q);if(h){return j=h.idb,u._meta=h.global,void bf.nextTick(function(){i(null,u)})}var r;r=p.storage?aG(q,p.storage):indexedDB.open(q,fQ),am.set(q,r),r.onupgradeneeded=function(z){function y(){var B=v[A-1];A++,B&&B(x,y)}var w=z.target.result;if(z.oldVersion<1){return k(w)}var x=z.currentTarget.transaction;z.oldVersion<3&&n(w),z.oldVersion<4&&l(w);var v=[m,o,s,g],A=z.oldVersion;y()},r.onsuccess=function(v){j=v.target.result,j.onversionchange=function(){j.close(),cR["delete"](q)},j.onabort=function(B){console.error("Database has a global failure",B.target.error),j.close(),cR["delete"](q)};var z=j.transaction([dO,cj,dV],"readwrite"),y=z.objectStore(dO).get(dO),w=null,x=null,A=null;y.onsuccess=function(D){var B=function(){null!==w&&null!==x&&null!==A&&(u._meta={name:q,instanceId:A,blobSupport:w,docCount:x},cR.set(q,{idb:j,global:u._meta}),i(null,u))},E=D.target.result||{id:dO};q+"_id" in E?(A=E[q+"_id"],B()):(A=cQ(),E[q+"_id"]=A,z.objectStore(dO).put(E).onsuccess=function(){B()}),cb||(cb=cd(z)),cb.then(function(F){w=F,B()});var C=z.objectStore(dV).index("deletedOrLocal");C.count(IDBKeyRange.only("0")).onsuccess=function(F){x=F.target.result,B()}}},r.onerror=function(){var v="Failed to open indexedDB, are you in private browsing mode?";console.error(v),i(aL(aQ,v))}}function aG(i,h){try{return indexedDB.open(i,{version:fQ,storage:h})}catch(g){return indexedDB.open(i,fQ)}}function cE(g){return decodeURIComponent(window.escape(g))}function bD(g){return 65>g?g-48:g-55}function ab(j,h,g){for(var i="";g>h;){i+=String.fromCharCode(bD(j.charCodeAt(h++))<<4|bD(j.charCodeAt(h++)))}return i}function aA(j,h,g){for(var i="";g>h;){i+=String.fromCharCode(bD(j.charCodeAt(h+2))<<12|bD(j.charCodeAt(h+3))<<8|bD(j.charCodeAt(h))<<4|bD(j.charCodeAt(h+1))),h+=4}return i}function cq(g,h){return"UTF-8"===h?cE(ab(g,0,g.length)):aA(g,0,g.length)}function ke(g){return"'"+g+"'"}function df(){return"undefined"!=typeof sqlitePlugin?sqlitePlugin.openDatabase.bind(sqlitePlugin):"undefined"!=typeof openDatabase?function(g){return openDatabase(g.name,g.version,g.description,g.size)}:void 0}function dc(){return"undefined"!=typeof openDatabase||"undefined"!=typeof SQLitePlugin}function cT(g){return g.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"")}function e3(g){return g.replace(/\u0001\u0001/g,"\x00").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,"")}function c0(g){return delete g._id,delete g._rev,JSON.stringify(g)}function dy(i,h,g){return i=JSON.parse(i),i._id=h,i._rev=g,i}function bs(g){for(var h="(";g--;){h+="?",g&&(h+=",")}return h+")"}function bL(g,j,i,k,h){return"SELECT "+g+" FROM "+("string"==typeof j?j:j.join(" JOIN "))+(i?" ON "+i:"")+(k?" WHERE "+("string"==typeof k?k:k.join(" AND ")):"")+(h?" ORDER BY "+h:"")}function bS(j,m,g){function i(){++l===j.length&&k()}function k(){if(h.length){var n="SELECT DISTINCT digest AS digest FROM "+kc+" WHERE seq IN "+bs(h.length);g.executeSql(n,h,function(q,o){for(var s=[],p=0;p<o.rows.length;p++){s.push(o.rows.item(p).digest)}if(s.length){var r="DELETE FROM "+kc+" WHERE seq IN ("+h.map(function(){return"?"}).join(",")+")";q.executeSql(r,h,function(u){var v="SELECT digest FROM "+kc+" WHERE digest IN ("+s.map(function(){return"?"}).join(",")+")";u.executeSql(v,s,function(x,y){for(var w=new ec.Set,z=0;z<y.rows.length;z++){w.add(y.rows.item(z).digest)}s.forEach(function(A){w.has(A)||(x.executeSql("DELETE FROM "+kc+" WHERE digest=?",[A]),x.executeSql("DELETE FROM "+cz+" WHERE digest=?",[A]))})})})}})}}if(j.length){var l=0,h=[];j.forEach(function(n){var o="SELECT seq FROM "+ak+" WHERE doc_id=? AND rev=?";g.executeSql(o,[m,n],function(q,p){if(!p.rows.length){return i()}var r=p.rows.item(0).seq;h.push(r),q.executeSql("DELETE FROM "+ak+" WHERE seq=?",[r],i)})})}}function fA(g){return function(h){console.error("WebSQL threw an error",h);var k=h&&h.constructor.toString().match(/function ([^\(]+)/),i=k&&k[1]||h.type,j=h.target||h.message;g(aL(dY,j,i))}}function eK(g){if("size" in g){return 1000000*g.size}var h="undefined"!=typeof navigator&&/Android/.test(navigator.userAgent);return h?5000000:1}function dB(i,h){try{return{db:i(h)}}catch(g){return{error:g}}}function eA(i){var h=dU.get(i.name);if(!h){var g=df();h=dB(g,i),dU.set(i.name,h),h.db&&(h.db._sqlitePlugin="undefined"!=typeof sqlitePlugin)}return h}function fB(y,u,i,n,g,C,B){function m(){return w?B(w):(C.notify(n._name),n._docCount=-1,void B(null,r))}function s(E,D){var F="SELECT count(*) as cnt FROM "+cz+" WHERE digest=?";p.executeSql(F,[E],function(G,H){if(0===H.rows.item(0).cnt){var I=aL(bp,"unknown stub attachment with digest "+E);D(I)}else{D()}})}function z(F){function D(){++G===H.length&&F(E)}var H=[];if(o.forEach(function(I){I.data&&I.data._attachments&&Object.keys(I.data._attachments).forEach(function(J){var K=I.data._attachments[J];K.stub&&H.push(K.digest)})}),!H.length){return F()}var E,G=0;H.forEach(function(I){s(I,function(J){J&&!E&&(E=J),D()})})}function x(K,D,N,I,G,P,F,R){function M(){function V(ar,a0){function at(){return ++ao===an.length&&a0(),!1}function ai(a2){var a3="INSERT INTO "+kc+" (digest, seq) VALUES (?,?)",a1=[U._attachments[a2].digest,ar];p.executeSql(a3,a1,at,at)}var ao=0,an=Object.keys(U._attachments||{});if(!an.length){return a0()}for(var ae=0;ae<an.length;ae++){ai(an[ae])}}var U=K.data,X=I?1:0,S=U._id,W=U._rev,Y=c0(U),Z="INSERT INTO "+ak+" (doc_id, rev, json, deleted) VALUES (?, ?, ?, ?);",T=[S,W,Y,X];p.executeSql(Z,T,function(ai,ae){var an=ae.insertId;V(an,function(){L(ai,an)})},function(){var ae=bL("seq",ak,null,"doc_id=? AND rev=?");return p.executeSql(ae,[S,W],function(ar,ai){var an=ai.rows.item(0).seq,ao="UPDATE "+ak+" SET json=?, deleted=? WHERE doc_id=? AND rev=?;",at=[Y,X,S,W];ar.executeSql(ao,at,function(a0){V(an,function(){L(a0,an)})})}),!1})}function J(S){H||(S?(H=S,R(H)):Q===O.length&&M())}function E(S){Q++,J(S)}function L(U,S){var V=K.metadata.id;G&&n.auto_compaction?bS(jU(K.metadata),V,U):K.stemmedRevs.length&&bS(K.stemmedRevs,V,U),K.metadata.seq=S,delete K.metadata.rev;var T=G?"UPDATE "+bV+" SET json=?, max_seq=?, winningseq=(SELECT seq FROM "+ak+" WHERE doc_id="+bV+".id AND rev=?) WHERE id=?":"INSERT INTO "+bV+" (id, winningseq, max_seq, json) VALUES (?,?,?,?);",W=aW(K.metadata),X=G?[W,S,D,V]:[V,S,S,W];U.executeSql(T,X,function(){r[F]={ok:!0,id:K.metadata.id,rev:D},A.set(V,K.metadata),R()})}var H=null,Q=0;K.data._id=K.metadata.id,K.data._rev=K.metadata.rev;var O=Object.keys(K.data._attachments||{});I&&(K.data._deleted=!0),O.forEach(function(S){var U=K.data._attachments[S];if(U.stub){Q++,J()}else{var V=U.data;delete U.data,U.revpos=parseInt(D,10);var T=U.digest;v(T,V,E)}}),O.length||M()}function q(){aJ(y.revs_limit,o,n,A,p,r,x,i)}function k(E){function D(){++F===o.length&&E()}if(!o.length){return E()}var F=0;o.forEach(function(G){if(G._id&&d5(G._id)){return D()}var H=G.metadata.id;p.executeSql("SELECT json FROM "+bV+" WHERE id = ?",[H],function(K,J){if(J.rows.length){var I=bm(J.rows.item(0).json);A.set(H,I)}D()})})}function v(F,D,G){var E="SELECT digest FROM "+cz+" WHERE digest=?";p.executeSql(E,[F],function(H,I){return I.rows.length?G():(E="INSERT INTO "+cz+" (digest, body, escaped) VALUES (?,?,1)",void H.executeSql(E,[F,cT(D)],function(){G()},function(){return G(),!1}))})}var l=i.new_edits,j=u.docs,o=j.map(function(E){if(E._id&&d5(E._id)){return E}var D=jP(E,l);return D}),h=o.filter(function(D){return D.error});if(h.length){return B(h[0])}var p,w,r=new Array(o.length),A=new ec.Map;eC(o,"binary",function(D){return D?B(D):void g.transaction(function(E){p=E,z(function(F){F?w=F:k(q)})},fA(B),m)})}function eY(g,j,n,m,l){function i(){++o===h.length&&l&&l()}function k(r,s){var q=r._attachments[s],p={binary:j.binary,ctx:m};n._getAttachment(q,p,function(v,u){r._attachments[s]=bk.extend(em(q,["digest","content_type"]),{data:u}),i()})}var h=Object.keys(g._attachments||{});if(!h.length){return l&&l()}var o=0;h.forEach(function(p){j.attachments&&j.include_docs?k(g,p):(g._attachments[p].stub=!0,i())})}function bQ(B,o){function C(){bO()&&(window.localStorage["_pouch__websqldb_"+k._name]=!0),o(null,k)}function h(F,E){F.executeSql(cs),F.executeSql("ALTER TABLE "+ak+" ADD COLUMN deleted TINYINT(1) DEFAULT 0",[],function(){F.executeSql(cI),F.executeSql("ALTER TABLE "+bV+" ADD COLUMN local TINYINT(1) DEFAULT 0",[],function(){F.executeSql("CREATE INDEX IF NOT EXISTS 'doc-store-local-idx' ON "+bV+" (local, id)");var G="SELECT "+bV+".winningseq AS seq, "+bV+".json AS metadata FROM "+ak+" JOIN "+bV+" ON "+ak+".seq = "+bV+".winningseq";F.executeSql(G,[],function(L,H){for(var K=[],N=[],O=0;O<H.rows.length;O++){var I=H.rows.item(O),J=I.seq,M=JSON.parse(I.metadata);bg(M)&&K.push(J),d5(M.id)&&N.push(M.id)}L.executeSql("UPDATE "+bV+"SET local = 1 WHERE id IN "+bs(N.length),N,function(){L.executeSql("UPDATE "+ak+" SET deleted = 1 WHERE seq IN "+bs(K.length),K,E)})})})})}function r(F,E){var G="CREATE TABLE IF NOT EXISTS "+bv+" (id UNIQUE, rev, json)";F.executeSql(G,[],function(){var H="SELECT "+bV+".id AS id, "+ak+".json AS data FROM "+ak+" JOIN "+bV+" ON "+ak+".seq = "+bV+".winningseq WHERE local = 1";F.executeSql(H,[],function(J,L){function I(){if(!K.length){return E(J)}var O=K.shift(),N=JSON.parse(O.data)._rev;J.executeSql("INSERT INTO "+bv+" (id, rev, json) VALUES (?,?,?)",[O.id,N,O.data],function(P){P.executeSql("DELETE FROM "+bV+" WHERE id=?",[O.id],function(Q){Q.executeSql("DELETE FROM "+ak+" WHERE seq=?",[O.seq],function(){I()})})})}for(var K=[],M=0;M<L.rows.length;M++){K.push(L.rows.item(M))}I()})})}function x(G,E){function H(J){function I(){if(!J.length){return E(G)}var O=J.shift(),M=cq(O.hex,s),K=M.lastIndexOf("::"),N=M.substring(0,K),L=M.substring(K+2),P="UPDATE "+ak+" SET doc_id=?, rev=? WHERE doc_id_rev=?";G.executeSql(P,[N,L,M],function(){I()})}I()}var F="ALTER TABLE "+ak+" ADD COLUMN doc_id";G.executeSql(F,[],function(J){var I="ALTER TABLE "+ak+" ADD COLUMN rev";J.executeSql(I,[],function(K){K.executeSql(jQ,[],function(M){var L="SELECT hex(doc_id_rev) as hex FROM "+ak;M.executeSql(L,[],function(P,N){for(var O=[],Q=0;Q<N.rows.length;Q++){O.push(N.rows.item(Q))}H(O)})})})})}function v(G,E){function H(I){var J="SELECT COUNT(*) AS cnt FROM "+cz;I.executeSql(J,[],function(N,P){function M(){var Q=bL(kj+", "+bV+".id AS id",[bV,ak],c9,null,bV+".id ");Q+=" LIMIT "+K+" OFFSET "+L,L+=K,N.executeSql(Q,[],function(ai,X){function R(at,ar){var ao=an[at]=an[at]||[];-1===ao.indexOf(ar)&&ao.push(ar)}if(!X.rows.length){return E(ai)}for(var an={},U=0;U<X.rows.length;U++){for(var W=X.rows.item(U),V=dy(W.data,W.id,W.rev),S=Object.keys(V._attachments||{}),T=0;T<S.length;T++){var Z=V._attachments[S[T]];R(Z.digest,W.seq)}}var Y=[];if(Object.keys(an).forEach(function(ar){var ao=an[ar];ao.forEach(function(at){Y.push([ar,at])})}),!Y.length){return M()}var ae=0;Y.forEach(function(ao){var ar="INSERT INTO "+kc+" (digest, seq) VALUES (?,?)";ai.executeSql(ar,ao,function(){++ae===Y.length&&M()})})})}var O=P.rows.item(0).cnt;if(!O){return E(N)}var L=0,K=10;M()})}var F="CREATE TABLE IF NOT EXISTS "+kc+" (digest, seq INTEGER)";G.executeSql(F,[],function(I){I.executeSql(bb,[],function(J){J.executeSql(aD,[],H)})})}function g(F,E){var G="ALTER TABLE "+cz+" ADD COLUMN escaped TINYINT(1) DEFAULT 0";F.executeSql(G,[],E)}function w(F,E){var G="ALTER TABLE "+bV+" ADD COLUMN max_seq INTEGER";F.executeSql(G,[],function(H){var I="UPDATE "+bV+" SET max_seq=(SELECT MAX(seq) FROM "+ak+" WHERE doc_id=id)";H.executeSql(I,[],function(J){var K="CREATE UNIQUE INDEX IF NOT EXISTS 'doc-max-seq-idx' ON "+bV+" (max_seq)";J.executeSql(K,[],E)})})}function A(F,E){F.executeSql('SELECT HEX("a") AS hex',[],function(H,I){var G=I.rows.item(0).hex;s=2===G.length?"UTF-8":"UTF-16",E()})}function l(){for(;j.length>0;){var E=j.pop();E(null,D)}}function y(M,I){if(0===I){var E="CREATE TABLE IF NOT EXISTS "+bi+" (dbid, db_version INTEGER)",N="CREATE TABLE IF NOT EXISTS "+cz+" (digest UNIQUE, escaped TINYINT(1), body BLOB)",L="CREATE TABLE IF NOT EXISTS "+kc+" (digest, seq INTEGER)",J="CREATE TABLE IF NOT EXISTS "+bV+" (id unique, json, winningseq, max_seq INTEGER UNIQUE)",K="CREATE TABLE IF NOT EXISTS "+ak+" (seq INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, json, deleted TINYINT(1), doc_id, rev)",P="CREATE TABLE IF NOT EXISTS "+bv+" (id UNIQUE, rev, json)";M.executeSql(N),M.executeSql(P),M.executeSql(L,[],function(){M.executeSql(aD),M.executeSql(bb)}),M.executeSql(J,[],function(){M.executeSql(cs),M.executeSql(K,[],function(){M.executeSql(cI),M.executeSql(jQ),M.executeSql(E,[],function(){var Q="INSERT INTO "+bi+" (db_version, dbid) VALUES (?,?)";D=cQ();var R=[b9,D];M.executeSql(Q,R,function(){l()})})})})}else{var G=function(){var R=b9>I;R&&M.executeSql("UPDATE "+bi+" SET db_version = "+b9);var Q="SELECT dbid FROM "+bi;M.executeSql(Q,[],function(T,S){D=S.rows.item(0).dbid,l()})},O=[h,r,x,v,g,w,G],F=I,H=function(Q){O[F-1](Q,H),F++};H(M)}}function p(){u.transaction(function(E){A(E,function(){n(E)})},fA(o),C)}function n(F){var E="SELECT sql FROM sqlite_master WHERE tbl_name = "+bi;F.executeSql(E,[],function(H,G){G.rows.length?/db_version/.test(G.rows.item(0).sql)?H.executeSql("SELECT db_version FROM "+bi,[],function(J,I){var K=I.rows.item(0).db_version;y(J,K)}):H.executeSql("ALTER TABLE "+bi+" ADD COLUMN db_version INTEGER",[],function(){y(H,1)}):y(H,0)})}function m(F,E){if(-1!==k._docCount){return E(k._docCount)}var G=bL("COUNT("+bV+".id) AS 'num'",[bV,ak],c9,ak+".deleted=0");F.executeSql(G,[],function(H,I){k._docCount=I.rows.item(0).num,E(k._docCount)})}var s,k=this,D=null,z=eK(B),j=[];k._docCount=-1,k._name=B.name;var q=bk.extend({},B,{size:z,version:cF}),i=eA(q);if(i.error){return fA(o)(i.error)}var u=i.db;"function"!=typeof u.readTransaction&&(u.readTransaction=u.transaction),p(),k.type=function(){return"websql"},k._id=aw(function(E){E(null,D)}),k._info=function(E){u.readTransaction(function(F){m(F,function(H){var G="SELECT MAX(seq) AS seq FROM "+ak;F.executeSql(G,[],function(I,J){var K=J.rows.item(0).seq||0;E(null,{doc_count:H,update_seq:K,sqlite_plugin:u._sqlitePlugin,websql_encoding:s})})})},fA(E))},k._bulkDocs=function(E,G,F){fB(B,E,G,k,u,aF,F)},k._get=function(E,I,M){function J(){M(G,{doc:K,metadata:N,ctx:L})}var K,N,G,L=I.ctx;if(!L){return u.readTransaction(function(O){k._get(E,bk.extend({ctx:O},I),M)})}var H,F;I.rev?(H=bL(kj,[bV,ak],bV+".id="+ak+".doc_id",[ak+".doc_id=?",ak+".rev=?"]),F=[E,I.rev]):(H=bL(kj,[bV,ak],c9,bV+".id=?"),F=[E]),L.executeSql(H,F,function(O,P){if(!P.rows.length){return G=aL(f8,"missing"),J()}var Q=P.rows.item(0);return N=bm(Q.metadata),Q.deleted&&!I.rev?(G=aL(f8,"deleted"),J()):(K=dy(Q.data,N.id,Q.rev),void J())})},k._allDocs=function(O,I){var F,P=[],R="startkey" in O?O.startkey:!1,L="endkey" in O?O.endkey:!1,G="key" in O?O.key:!1,J="descending" in O?O.descending:!1,H="limit" in O?O.limit:-1,E="skip" in O?O.skip:0,N=O.inclusive_end!==!1,K=[],Q=[];if(G!==!1){Q.push(bV+".id = ?"),K.push(G)}else{if(R!==!1||L!==!1){if(R!==!1&&(Q.push(bV+".id "+(J?"<=":">=")+" ?"),K.push(R)),L!==!1){var M=J?">":"<";N&&(M+="="),Q.push(bV+".id "+M+" ?"),K.push(L)}G!==!1&&(Q.push(bV+".id = ?"),K.push(G))}}"ok"!==O.deleted&&Q.push(ak+".deleted = 0"),u.readTransaction(function(S){m(S,function(T){if(F=T,0!==H){var U=bL(kj,[bV,ak],c9,Q,bV+".id "+(J?"DESC":"ASC"));U+=" LIMIT "+H+" OFFSET "+E,S.executeSql(U,K,function(ai,ar){for(var ao=0,X=ar.rows.length;X>ao;ao++){var Z=ar.rows.item(ao),an=bm(Z.metadata),W=an.id,Y=dy(Z.data,W,Z.rev),V=Y._rev,ae={id:W,key:W,value:{rev:V}};if(O.include_docs&&(ae.doc=Y,ae.doc._rev=V,O.conflicts&&(ae.doc._conflicts=f1(an)),eY(ae.doc,O,k,ai)),Z.deleted){if("ok"!==O.deleted){continue}ae.value.deleted=!0,ae.doc=null}P.push(ae)}})}})},fA(I),function(){I(null,{total_rows:F,offset:O.skip,rows:P})})},k._changes=function(I){function J(){var S=bV+".json AS metadata, "+bV+".max_seq AS maxSeq, "+ak+".json AS winningDoc, "+ak+".rev AS winningRev ",T=bV+" JOIN "+ak,R=bV+".id="+ak+".doc_id AND "+bV+".winningseq="+ak+".seq",Q=["maxSeq > ?"],N=[I.since];I.doc_ids&&(Q.push(bV+".id IN "+bs(I.doc_ids.length)),N=N.concat(I.doc_ids));var U="maxSeq "+(F?"DESC":"ASC"),O=bL(S,T,R,Q,U),M=el(I);I.view||I.filter||(O+=" LIMIT "+K);var P=I.since||0;u.readTransaction(function(V){V.executeSql(O,N,function(an,ao){function ai(a0){return function(){I.onChange(a0)}}for(var X=0,at=ao.rows.length;at>X;X++){var ar=ao.rows.item(X),W=bm(ar.metadata);P=ar.maxSeq;var ae=dy(ar.winningDoc,W.id,ar.winningRev),Z=I.processChange(ae,W,I);Z.seq=ar.maxSeq;var Y=M(Z);if("object"==typeof Y){return I.complete(Y)}if(Y&&(E++,H&&G.push(Z),I.attachments&&I.include_docs?eY(ae,I,k,an,ai(Z)):ai(Z)()),E===K){break}}})},fA(I.complete),function(){I.continuous||I.complete(null,{results:G,last_seq:P})})}if(I=cl(I),I.continuous){var L=k._name+":"+cQ();return aF.addListener(k._name,L,k,I),aF.notify(k._name),{cancel:function(){aF.removeListener(k._name,L)}}}var F=I.descending;I.since=I.since&&!F?I.since:0;var K="limit" in I?I.limit:-1;0===K&&(K=1);var H;H="return_docs" in I?I.return_docs:"returnDocs" in I?I.returnDocs:!0;var G=[],E=0;J()},k._close=function(E){E()},k._getAttachment=function(I,J,L){var F,K=J.ctx,H=I.digest,G=I.content_type,E="SELECT escaped, CASE WHEN escaped = 1 THEN body ELSE HEX(body) END AS body FROM "+cz+" WHERE digest=?";K.executeSql(E,[H],function(P,M){var N=M.rows.item(0),O=N.escaped?e3(N.body):cq(N.body,s);F=J.binary?cH(O,G):bq(O),L(null,F)})},k._getRevisionTree=function(F,E){u.readTransaction(function(H){var G="SELECT json AS metadata FROM "+bV+" WHERE id = ?";H.executeSql(G,[F],function(J,K){if(K.rows.length){var I=bm(K.rows.item(0).metadata);E(null,I.rev_tree)}else{E(aL(f8))}})})},k._doCompaction=function(F,E,G){return E.length?void u.transaction(function(I){var H="SELECT json AS metadata FROM "+bV+" WHERE id = ?";I.executeSql(H,[F],function(M,K){var L=bm(K.rows.item(0).metadata);ax(L.rev_tree,function(O,Q,N,P,S){var R=Q+"-"+N;-1!==E.indexOf(R)&&(S.status="missing")});var J="UPDATE "+bV+" SET json = ? WHERE id = ?";M.executeSql(J,[aW(L),F])}),bS(E,F,I)},fA(G),function(){G()}):G()},k._getLocal=function(F,E){u.readTransaction(function(H){var G="SELECT json, rev FROM "+bv+" WHERE id=?";H.executeSql(G,[F],function(L,J){if(J.rows.length){var K=J.rows.item(0),I=dy(K.json,F,K.rev);E(null,I)}else{E(aL(f8))}})})},k._putLocal=function(E,H,L){function J(N){var P,O;M?(P="UPDATE "+bv+" SET rev=?, json=? WHERE id=? AND rev=?",O=[K,G,F,M]):(P="INSERT INTO "+bv+" (id, rev, json) VALUES (?,?,?)",O=[F,K,G]),N.executeSql(P,O,function(R,Q){Q.rowsAffected?(I={ok:!0,id:F,rev:K},H.ctx&&L(null,I)):L(aL(cc))},function(){return L(aL(cc)),!1})}"function"==typeof H&&(L=H,H={}),delete E._revisions;var K,M=E._rev,F=E._id;K=M?E._rev="0-"+(parseInt(M.split("-")[1],10)+1):E._rev="0-1";var I,G=c0(E);H.ctx?J(H.ctx):u.transaction(J,fA(L),function(){I&&L(null,I)})},k._removeLocal=function(G,E,I){function F(L){var K="DELETE FROM "+bv+" WHERE id=? AND rev=?",J=[G._id,G._rev];L.executeSql(K,J,function(N,M){return M.rowsAffected?(H={ok:!0,id:G._id,rev:"0-0"},void (E.ctx&&I(null,H))):I(aL(f8))})}"function"==typeof E&&(I=E,E={});var H;E.ctx?F(E.ctx):u.transaction(F,fA(I),function(){H&&I(null,H)})},k._destroy=function(F,E){aF.removeAllListeners(k._name),u.transaction(function(H){var G=[bV,ak,cz,bi,bv,kc];G.forEach(function(I){H.executeSql("DROP TABLE IF EXISTS "+I,[])})},fA(E),function(){bO()&&(delete window.localStorage["_pouch__websqldb_"+k._name],delete window.localStorage[k._name]),E(null,{ok:!0})})}}var bk=c(7),e4=cD(bk),ay=cD(c(2)),au=cD(c(6)),eH=cD(c(8)),ec=c(12),c2=cD(c(1)),aM=c(4),f6=cD(c(14)),eh=c(10),d3=cD(eh),f3=cD(c(15)),ba=cD(c(16)),dS="function"==typeof Promise?Promise:eH,b6=ay("pouchdb:api");au(aK,Error),aK.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};var dm=new aK({status:401,error:"unauthorized",reason:"Name or password is incorrect."}),al=new aK({status:400,error:"bad_request",reason:"Missing JSON list of 'docs'"}),f8=new aK({status:404,error:"not_found",reason:"missing"}),cc=new aK({status:409,error:"conflict",reason:"Document update conflict"}),bI=new aK({status:400,error:"invalid_id",reason:"_id field must contain a string"}),dE=new aK({status:412,error:"missing_id",reason:"_id is required for puts"}),cf=new aK({status:400,error:"bad_request",reason:"Only reserved document ids may start with underscore."}),ef=new aK({status:412,error:"precondition_failed",reason:"Database not open"}),ad=new aK({status:500,error:"unknown_error",reason:"Database encountered an unknown error"}),eI=new aK({status:500,error:"badarg",reason:"Some query argument is invalid"}),du=new aK({status:400,error:"invalid_request",reason:"Request was invalid"}),b4=new aK({status:400,error:"query_parse_error",reason:"Some query parameter is invalid"}),bB=new aK({status:500,error:"doc_validation",reason:"Bad special document member"}),e1=new aK({status:400,error:"bad_request",reason:"Something wrong with the request"}),jS=new aK({status:400,error:"bad_request",reason:"Document must be a JSON object"}),bE=new aK({status:404,error:"not_found",reason:"Database not found"}),aQ=new aK({status:500,error:"indexed_db_went_bad",reason:"unknown"}),dY=new aK({status:500,error:"web_sql_went_bad",reason:"unknown"}),fH=new aK({status:500,error:"levelDB_went_went_bad",reason:"unknown"}),fO=new aK({status:403,error:"forbidden",reason:"Forbidden by design doc validate_doc_update function"}),kg=new aK({status:400,error:"bad_request",reason:"Invalid rev format"}),eG=new aK({status:412,error:"file_exists",reason:"The database could not be created, the file already exists."}),bp=new aK({status:412,error:"missing_stub"}),eP=new aK({status:413,error:"invalid_url",reason:"Provided URL is invalid"}),ch={UNAUTHORIZED:dm,MISSING_BULK_DOCS:al,MISSING_DOC:f8,REV_CONFLICT:cc,INVALID_ID:bI,MISSING_ID:dE,RESERVED_ID:cf,NOT_OPEN:ef,UNKNOWN_ERROR:ad,BAD_ARG:eI,INVALID_REQUEST:du,QUERY_PARSE_ERROR:b4,DOC_VALIDATION:bB,BAD_REQUEST:e1,NOT_AN_OBJECT:jS,DB_MISSING:bE,WSQ_ERROR:dY,LDB_ERROR:fH,FORBIDDEN:fO,INVALID_REV:kg,FILE_EXISTS:eG,MISSING_STUB:bp,IDB_ERROR:aQ,INVALID_URL:eP},d6=function(g,j,i){var k=Object.keys(ch).filter(function(m){var l=ch[m];return"function"!=typeof l&&l[g]===j}),h=i&&k.filter(function(m){var l=ch[m];return l.message===i})[0]||k[0];return h?ch[h]:null};au(kf,aM.EventEmitter),kf.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")},kf.prototype.doChanges=function(g){var j=this,i=g.complete;if(g=cl(g),"live" in g&&!("continuous" in g)&&(g.continuous=g.live),g.processChange=eJ,"latest"===g.since&&(g.since="now"),g.since||(g.since=0),"now"===g.since){return void this.db.info().then(function(l){return j.isCancelled?void i(null,{status:"cancelled"}):(g.since=l.update_seq,void j.doChanges(g))},i)}if(g.continuous&&"now"!==g.since&&this.db.info().then(function(l){j.startSeq=l.update_seq},function(l){if("idbNull"!==l.id){throw l}}),g.filter&&"string"==typeof g.filter&&("_view"===g.filter?g.view=aj(g.view):g.filter=aj(g.filter),"http"!==this.db.type()&&!g.doc_ids)){return this.filterChanges(g)}"descending" in g||(g.descending=!1),g.limit=0===g.limit?1:g.limit,g.complete=i;var k=this.db._changes(g);if(k&&"function"==typeof k.cancel){var h=j.cancel;j.cancel=c2(function(l){k.cancel(),h.apply(this,l)})}},kf.prototype.filterChanges=function(h){var k=this,j=h.complete;if("_view"===h.filter){if(!h.view||"string"!=typeof h.view){var l=aL(e1,"`view` filter parameter not found or invalid.");return j(l)}var i=kb(h.view);this.db.getView(i[0],i[1],function(n,m){return k.isCancelled?j(null,{status:"cancelled"}):n?j(eL(n)):m.map?(h.filter=e2(m.map),void k.doChanges(h)):j(aL(f8))})}else{var g=kb(h.filter);if(!g){return k.doChanges(h)}this.db.getFilter(g[0],g[1],function(n,m){return k.isCancelled?j(null,{status:"cancelled"}):n?j(eL(n)):(h.filter=dx(m),void k.doChanges(h))})}};var jN="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),bC=dG(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),dM=dG(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);au(bd,aM.EventEmitter),bd.prototype.post=dL("post",function(i,h,g){return"function"==typeof h&&(g=h,h={}),"object"!=typeof i||Array.isArray(i)?g(aL(jS)):void this.bulkDocs({docs:[i]},h,d1(g))}),bd.prototype.put=dL("put",c2(function(j){var m,g,i,k,l=j.shift(),h="_id" in l;if("object"!=typeof l||Array.isArray(l)){return(k=j.pop())(aL(jS))}for(;;){if(m=j.shift(),g=typeof m,"string"!==g||h?"string"!==g||!h||"_rev" in l?"object"===g?i=m:"function"===g&&(k=m):l._rev=m:(l._id=m,h=!0),!j.length){break}}return i=i||{},dg(l._id),d5(l._id)&&"function"==typeof this._putLocal?l._deleted?this._removeLocal(l,k):this._putLocal(l,k):void this.bulkDocs({docs:[l]},i,d1(k))})),bd.prototype.putAttachment=dL("putAttachment",function(j,m,g,i,k){function l(n){var o="_rev" in n?parseInt(n._rev,10):0;return n._attachments=n._attachments||{},n._attachments[m]={content_type:k,data:i,revpos:++o},h.put(n)}var h=this;return"function"==typeof k&&(k=i,i=g,g=null),"undefined"==typeof k&&(k=i,i=g,g=null),h.get(j).then(function(n){if(n._rev!==g){throw aL(cc)}return l(n)},function(n){if(n.reason===f8.message){return l({_id:j})}throw n})}),bd.prototype.removeAttachment=dL("removeAttachment",function(g,j,i,k){var h=this;h.get(g,function(m,l){return m?void k(m):l._rev!==i?void k(aL(cc)):l._attachments?(delete l._attachments[j],0===Object.keys(l._attachments).length&&delete l._attachments,void h.put(l,k)):k()})}),bd.prototype.remove=dL("remove",function(h,k,j,l){var i;"string"==typeof k?(i={_id:h,_rev:k},"function"==typeof j&&(l=j,j={})):(i=h,"function"==typeof k?(l=k,j={}):(l=j,j=k)),j=j||{},j.was_delete=!0;var g={_id:i._id,_rev:i._rev||j.rev};return g._deleted=!0,d5(g._id)&&"function"==typeof this._removeLocal?this._removeLocal(i,l):void this.bulkDocs({docs:[g]},j,d1(l))}),bd.prototype.revsDiff=dL("revsDiff",function(h,i,j){function k(o,p){g.has(o)||g.set(o,{missing:[]}),g.get(o).missing.push(p)}function m(q,p){var o=h[q].slice(0);ax(p,function(w,v,s,x,r){var u=v+"-"+s,y=o.indexOf(u);-1!==y&&(o.splice(y,1),"available"!==r.status&&k(q,u))}),o.forEach(function(r){k(q,r)})}"function"==typeof i&&(j=i,i={});var n=Object.keys(h);if(!n.length){return j(null,{})}var l=0,g=new ec.Map;n.map(function(o){this._getRevisionTree(o,function(q,p){if(q&&404===q.status&&"missing"===q.message){g.set(o,{missing:h[o]})}else{if(q){return j(q)}m(o,p)}if(++l===n.length){var r={};return g.forEach(function(u,s){r[s]=u}),j(null,r)}})},this)}),bd.prototype.bulkGet=dL("bulkGet",function(g,h){e0(this,g,h)}),bd.prototype.compactDocument=dL("compactDocument",function(j,h,g){var i=this;this._getRevisionTree(j,function(m,k){if(m){return g(m)}var n=dR(k),l=[],o=[];Object.keys(n).forEach(function(p){n[p]>h&&l.push(p)}),ax(k,function(r,p,u,q,s){var v=p+"-"+u;"available"===s.status&&-1!==l.indexOf(v)&&o.push(v)}),i._doCompaction(j,o,g)})}),bd.prototype.compact=dL("compact",function(i,h){"function"==typeof i&&(h=i,i={});var g=this;i=i||{},g._compactionQueue=g._compactionQueue||[],g._compactionQueue.push({opts:i,callback:h}),1===g._compactionQueue.length&&d2(g)}),bd.prototype._compact=function(j,m){function g(n){h.push(k.compactDocument(n.id,0))}function i(n){var o=n.last_seq;dS.all(h).then(function(){return cU(k,"_local/compaction",function(p){return !p.last_seq||p.last_seq<o?(p.last_seq=o,p):!1})}).then(function(){m(null,{ok:!0})})["catch"](m)}var k=this,l={return_docs:!1,last_seq:j.last_seq||0},h=[];k.changes(l).on("change",g).on("complete",i).on("error",m)},bd.prototype.get=dL("get",function(h,i,j){function k(){var o=[],p=m.length;return p?void m.forEach(function(q){n.get(h,{rev:q,revs:i.revs,attachments:i.attachments},function(s,r){s?o.push({missing:q}):o.push({ok:r}),p--,p||j(null,o)})}):j(null,o)}if("function"==typeof i&&(j=i,i={}),"string"!=typeof h){return j(aL(bI))}if(d5(h)&&"function"==typeof this._getLocal){return this._getLocal(h,j)}var m=[],n=this;if(!i.open_revs){return this._get(h,i,function(v,x){if(v){return j(v)}var o=x.doc,y=x.metadata,B=x.ctx;if(i.conflicts){var C=f1(y);C.length&&(o._conflicts=C)}if(bg(y,o._rev)&&(o._deleted=!0),i.revs||i.revs_info){var A=dW(y.rev_tree),r=cp(A,function(D){return -1!==D.ids.map(function(E){return E.id}).indexOf(o._rev.split("-")[1])}),p=r.ids.map(function(D){return D.id}).indexOf(o._rev.split("-")[1])+1,w=r.ids.length-p;if(r.ids.splice(p,w),r.ids.reverse(),i.revs&&(o._revisions={start:r.pos+r.ids.length-1,ids:r.ids.map(function(D){return D.id})}),i.revs_info){var s=r.pos+r.ids.length;o._revs_info=r.ids.map(function(D){return s--,{rev:s+"-"+D.id,status:D.opts.status}})}}if(i.attachments&&o._attachments){var z=o._attachments,u=Object.keys(z).length;if(0===u){return j(null,o)}Object.keys(z).forEach(function(D){this._getAttachment(z[D],{binary:i.binary,ctx:B},function(F,G){var E=o._attachments[D];E.data=G,delete E.stub,delete E.length,--u||j(null,o)})},n)}else{if(o._attachments){for(var q in o._attachments){o._attachments.hasOwnProperty(q)&&(o._attachments[q].stub=!0)}}j(null,o)}})}if("all"===i.open_revs){this._getRevisionTree(h,function(o,p){return o?j(o):(m=bJ(p).map(function(q){return q.rev}),void k())})}else{if(!Array.isArray(i.open_revs)){return j(aL(ad,"function_clause"))}m=i.open_revs;for(var l=0;l<m.length;l++){var g=m[l];if("string"!=typeof g||!/^\d+-/.test(g)){return j(aL(kg))}}k()}}),bd.prototype.getView=dL("getView",function(i,h,g){cV(this,i,"views",h,g)}),bd.prototype.getFilter=dL("getFilter",function(i,h,g){cV(this,i,"filters",h,g)}),bd.prototype.getAttachment=dL("getAttachment",function(g,j,i,k){var h=this;i instanceof Function&&(k=i,i={}),this._get(g,i,function(m,l){return m?k(m):l.doc._attachments&&l.doc._attachments[j]?(i.ctx=l.ctx,i.binary=!0,h._getAttachment(l.doc._attachments[j],i,k),void 0):k(aL(f8))})}),bd.prototype.allDocs=dL("allDocs",function(i,h){if("function"==typeof i&&(h=i,i={}),i.skip="undefined"!=typeof i.skip?i.skip:0,i.start_key&&(i.startkey=i.start_key),i.end_key&&(i.endkey=i.end_key),"keys" in i){if(!Array.isArray(i.keys)){return h(new TypeError("options.keys must be an array"))}var g=["startkey","endkey","key"].filter(function(j){return j in i})[0];if(g){return void h(aL(b4,"Query parameter `"+g+"` is not compatible with multi-get"))}if("http"!==this.type()){return jH(this,i,h)}}return this._allDocs(i,h)}),bd.prototype.changes=function(g,h){return"function"==typeof g&&(h=g,g={}),new kf(this,g,h)},bd.prototype.close=dL("close",function(g){return this._closed=!0,this._close(g)}),bd.prototype.info=dL("info",function(g){var h=this;this._info(function(j,i){return j?g(j):(i.db_name=i.db_name||h._db_name,i.auto_compaction=!(!h.auto_compaction||"http"===h.type()),i.adapter=h.type(),void g(null,i))})}),bd.prototype.id=dL("id",function(g){return this._id(g)}),bd.prototype.type=function(){return"function"==typeof this._type?this._type():this.adapter},bd.prototype.bulkDocs=dL("bulkDocs",function(g,j,i){if("function"==typeof j&&(i=j,j={}),j=j||{},Array.isArray(g)&&(g={docs:g}),!g||!g.docs||!Array.isArray(g.docs)){return i(aL(al))}for(var k=0;k<g.docs.length;++k){if("object"!=typeof g.docs[k]||Array.isArray(g.docs[k])){return i(aL(jS))}}var h;return g.docs.forEach(function(l){l._attachments&&Object.keys(l._attachments).forEach(function(m){h=h||ek(m)})}),h?i(aL(e1,h)):("new_edits" in j||("new_edits" in g?j.new_edits=g.new_edits:j.new_edits=!0),j.new_edits||"http"===this.type()||g.docs.sort(cM),eW(g.docs),this._bulkDocs(g,j,function(m,l){return m?i(m):(j.new_edits||(l=l.filter(function(n){return n.error})),void i(null,l))}))}),bd.prototype.registerDependentDatabase=dL("registerDependentDatabase",function(j,h){function g(k){return k.dependentDbs=k.dependentDbs||{},k.dependentDbs[j]?!1:(k.dependentDbs[j]=!0,k)}var i=new this.constructor(j,this.__opts);cU(this,"_local/_pouch_dependentDbs",g).then(function(){h(null,{db:i})})["catch"](h)}),bd.prototype.destroy=dL("destroy",function(g,j){function i(){k._destroy(g,function(l,m){return l?j(l):(k._destroyed=!0,k.emit("destroyed"),void j(null,m||{ok:!0}))})}"function"==typeof g&&(j=g,g={});var k=this,h="use_prefix" in k?k.use_prefix:!0;return"http"===k.type()?i():void k.get("_local/_pouch_dependentDbs",function(n,l){if(n){return 404!==n.status?j(n):i()}var o=l.dependentDbs,m=k.constructor,p=Object.keys(o).map(function(r){var q=h?r.replace(new RegExp("^"+m.prefix),""):r;return new m(q,k.__opts).destroy()});dS.all(p).then(i,j)})}),b7.prototype.execute=function(){var g;if(this.failed){for(;g=this.queue.shift();){g(this.failed)}}else{for(;g=this.queue.shift();){g()}}},b7.prototype.fail=function(g){this.failed=g,this.execute()},b7.prototype.ready=function(g){this.isReady=!0,this.db=g,this.execute()},b7.prototype.addTask=function(g){this.queue.push(g),this.failed&&this.execute()},au(dp,bd),dp.debug=ay;var aI;if(e5()){aI=!1}else{try{localStorage.setItem("_pouch_check_localstorage",1),aI=!!localStorage.getItem("_pouch_check_localstorage")}catch(cm){aI=!1}}dp.adapters={},dp.preferredAdapters=[],dp.prefix="_pouch_";var a9=new aM.EventEmitter;aH(dp),dp.parseAdapter=function(h,i){var j,k,m=h.match(/([a-z\-]*):\/\/(.*)/);if(m){if(h=/http(s?)/.test(m[1])?m[1]+"://"+m[2]:m[2],j=m[1],!dp.adapters[j].valid()){throw"Invalid adapter"}return{name:h,adapter:m[1]}}var n="idb" in dp.adapters&&"websql" in dp.adapters&&bO()&&localStorage["_pouch__websqldb_"+dp.prefix+h];if(i.adapter){k=i.adapter}else{if("undefined"!=typeof i&&i.db){k="leveldb"}else{for(var l=0;l<dp.preferredAdapters.length;++l){if(k=dp.preferredAdapters[l],k in dp.adapters){if(n&&"idb"===k){console.log('PouchDB is downgrading "'+h+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.');continue}break}}}}j=dp.adapters[k];var g=j&&"use_prefix" in j?j.use_prefix:!0;return{name:g?dp.prefix+h:h,adapter:k}},dp.adapter=function(i,h,g){h.valid()&&(dp.adapters[i]=h,g&&dp.preferredAdapters.push(i))},dp.plugin=function(g){return Object.keys(g).forEach(function(h){dp.prototype[h]=g[h]}),dp},dp.defaults=function(g){function h(k,i,j){return this instanceof h?("function"!=typeof i&&"undefined"!=typeof i||(j=i,i={}),k&&"object"==typeof k&&(i=k,k=void 0),i=bk.extend({},g,i),void dp.call(this,k,i,j)):new h(k,i,j)}return au(h,dp),aH(h),h.preferredAdapters=dp.preferredAdapters.slice(),Object.keys(dp).forEach(function(i){i in h||(h[i]=dp[i])}),h};var aE=j7(),bu=function(){},eU=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],eM="queryKey",aV=/(?:^|&)([^&=]*)=?([^&]*)/g,aC=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,j3=function(g){return atob(g)},bq=function(g){return btoa(g)},jV=e4.extend,jY={ajax:eg,parseUri:fJ,uuid:cQ,Promise:dS,atob:j3,btoa:bq,binaryStringToBlobOrBuffer:cH,clone:cl,extend:jV,createError:aL},aP=d3.collate,c7=1,b8="pouchdb",bc=5,bM=0;d7.prototype.writeCheckpoint=function(i,h){var g=this;return this.updateTarget(i,h).then(function(){return g.updateSource(i,h)})},d7.prototype.updateTarget=function(g,h){return cg(this.target,this.id,g,h,this.returnValue)},d7.prototype.updateSource=function(i,h){var g=this;return this.readOnlySource?dS.resolve(!0):cg(this.src,this.id,i,h,this.returnValue)["catch"](function(j){if(fF(j)){return g.readOnlySource=!0,!0}throw j})};var eV={undefined:function(g,h){return 0===aP(g.last_seq,h.last_seq)?h.last_seq:0},1:function(g,h){return dX(h,g).last_seq}};d7.prototype.getCheckpoint=function(){var g=this;return g.target.get(g.id).then(function(h){return g.readOnlySource?dS.resolve(h.last_seq):g.src.get(g.id).then(function(i){if(h.version!==i.version){return bM}var j;return j=h.version?h.version.toString():"undefined",j in eV?eV[j](h,i):bM},function(i){if(404===i.status&&h.last_seq){return g.src.put({_id:g.id,last_seq:bM}).then(function(){return bM},function(j){return fF(j)?(g.readOnlySource=!0,h.last_seq):bM})}throw i})})["catch"](function(h){if(404!==h.status){throw h}return bM})};var j9=0,dN=bK.setImmediate||bK.setTimeout,dT=32768,cy=aw(function(j,l){function h(){var q=m*i,u=q+i;if(m++,k>m){p(n,j,q,u),dN(h)}else{p(n,j,q,u);var r=n.end(!0),s=bP(r);l(null,s),n.destroy()}}var o="string"==typeof j,g=o?j.length:j.byteLength,i=Math.min(dT,g),k=Math.ceil(g/i),m=0,n=o?new f3:new f3.ArrayBuffer,p=o?fC:aY;h()});au(bZ,aM.EventEmitter),bZ.prototype.cancel=function(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")},bZ.prototype.ready=function(g,j){function i(){h.cancel()}function k(){g.removeListener("destroyed",i),j.removeListener("destroyed",i)}var h=this;h._readyCalled||(h._readyCalled=!0,g.once("destroyed",i),j.once("destroyed",i),h.once("complete",k))};var c6={replicate:ah,toPouch:dv},d4=c6.replicate;au(dJ,aM.EventEmitter),dJ.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())};var c8=25,cN=50,ck={},dZ=1800,fL=ay("pouchdb:http");cC.valid=function(){return !0},ed.prototype.add=function(g){return this.promise=this.promise["catch"](function(){}).then(function(){return g()}),this.promise},ed.prototype.finish=function(){return this.promise};var aZ,by=function(g,h){return h&&g.then(function(i){bf.nextTick(function(){h(null,i)})},function(i){bf.nextTick(function(){h(i)})}),g},jI=function(g){return c2(function(h){var j=h.pop(),i=g.apply(this,h);return"function"==typeof j&&by(i,j),i})},ac=function(g,h){return g.then(function(i){return h().then(function(){return i})},function(i){return h().then(function(){throw i})})},cS=function(g,h){return function(){var j=arguments,i=this;return g.add(function(){return h.apply(i,j)})}},bz=function(h){for(var k={},j=0,l=h.length;l>j;j++){k["$"+h[j]]=!0}var i=Object.keys(k),g=new Array(i.length);for(j=0,l=i.length;l>j;j++){g[j]=i[j].substring(1)}return g},t={uniq:bz,sequentialize:cS,fin:ac,callbackify:jI,promisedCallback:by},cA=d3.collate,ea=d3.toIndexableString,eR=d3.normalizeKey,jF=d3.parseIndexableString;aZ="undefined"!=typeof console&&"function"==typeof console.log?Function.prototype.bind.call(console.log,console):function(){};var j0=t.callbackify,cJ=t.sequentialize,jK=t.uniq,eQ=t.fin,dd=t.promisedCallback,e8={},bT=new ed,cu=50,cO={_sum:function(g,h){return ka(h)},_count:function(g,h){return h.length},_stats:function(i,h){function g(j){for(var m=0,l=0,n=j.length;n>l;l++){var k=j[l];m+=k*k}return m}return{sum:ka(h),min:Math.min.apply(null,h),max:Math.max.apply(null,h),count:h.length,sumsqr:g(h)}}},dI=j0(function(){var g=this;return g._ddocCache&&delete g._ddocCache,"http"===g.type()?jM(g):"function"==typeof g._viewCleanup?eF(g):aa(g)}),cL=function(g,j,i){"function"==typeof j&&(i=j,j={}),j=j?bA(j):{},"function"==typeof g&&(g={map:g});var k=this,h=dS.resolve().then(function(){return j2(k,g,j)});return dd(h,i),h};au(fK,Error),au(eX,Error);var b2={query:cL,viewCleanup:dI},fQ=5,dV="document-store",j5="by-sequence",c1="attach-store",bF="attach-seq-store",dO="meta-store",eb="local-store",cj="detect-blob-support",d9={running:!1,queue:[]};au(bj,aM.EventEmitter),bj.prototype.addListener=function(i,h,k,m){function j(){function n(){l=!1}if(g._listeners[h]){if(l){return void (l="waiting")}l=!0;var o=em(m,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary"]);k.changes(o).on("change",function(p){p.seq>m.since&&!m.cancelled&&(m.since=p.seq,m.onChange(p))}).on("complete",function(){"waiting"===l&&setTimeout(function(){j()},0),l=!1}).on("error",n)}}if(!this._listeners[h]){var g=this,l=!1;this._listeners[h]=j,this.on(i,j)}},bj.prototype.removeListener=function(g,h){h in this._listeners&&aM.EventEmitter.prototype.removeListener.call(this,g,this._listeners[h])},bj.prototype.notifyLocalWindows=function(g){e5()?chrome.storage.local.set({dbName:g}):bO()&&(localStorage[g]="a"===localStorage[g]?"b":"a")},bj.prototype.notify=function(g){this.emit(g),this.notifyLocalWindows(g)};var cb,cR=new ec.Map,f2=new bj,am=new ec.Map;dA.valid=function(){var g="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform);return !g&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange};var b9=7,bV=ke("document-store"),ak=ke("by-sequence"),cz=ke("attach-store"),bv=ke("local-store"),bi=ke("metadata-store"),kc=ke("attach-seq-store"),dU=new ec.Map,aF=new bj,cF=1,cI="CREATE INDEX IF NOT EXISTS 'by-seq-deleted-idx' ON "+ak+" (seq, deleted)",jQ="CREATE UNIQUE INDEX IF NOT EXISTS 'by-seq-doc-id-rev' ON "+ak+" (doc_id, rev)",cs="CREATE INDEX IF NOT EXISTS 'doc-winningseq-idx' ON "+bV+" (winningseq)",aD="CREATE INDEX IF NOT EXISTS 'attach-seq-seq-idx' ON "+kc+" (seq)",bb="CREATE UNIQUE INDEX IF NOT EXISTS 'attach-seq-digest-idx' ON "+kc+" (digest, seq)",c9=ak+".seq = "+bV+".winningseq",kj=ak+".seq AS seq, "+ak+".deleted AS deleted, "+ak+".json AS data, "+ak+".rev AS rev, "+bV+".json AS metadata";bQ.use_prefix=!("undefined"!=typeof bf&&!bf.browser),bQ.valid=dc;var b1={idb:dA,websql:bQ};dp.ajax=eg,dp.utils=jY,dp.Errors=ch,dp.replicate=c6.replicate,dp.sync=ca,dp.version="5.3.2",dp.adapter("http",cC),dp.adapter("https",cC),dp.plugin(b2),Object.keys(b1).forEach(function(g){dp.adapter(g,b1[g],!0)}),f.exports=dp}).call(this,c(13),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{1:1,10:10,12:12,13:13,14:14,15:15,16:16,2:2,4:4,6:6,7:7,8:8}]},{},[17])(17)});