!function(b){if("object"==typeof exports&&"undefined"!=typeof module){module.exports=b()}else{if("function"==typeof define&&define.amd){define([],b)}else{var a;a="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,a.PouchDB=b()}}}(function(){var b;return function a(c,f,h){function j(m,i){if(!f[m]){if(!c[m]){var e="function"==typeof require&&require;if(!i&&e){return e(m,!0)}if(g){return g(m,!0)}var l=new Error("Cannot find module '"+m+"'");throw l.code="MODULE_NOT_FOUND",l}var k=f[m]={exports:{}};c[m][0].call(k.exports,function(n){var o=c[m][1][n];return j(o?o:n)},k,k.exports,a,c,f,h)}return f[m].exports}for(var g="function"==typeof require&&require,d=0;d<h.length;d++){j(h[d])}return j}({1:[function(f,c,g){function d(e){return function(){var h=arguments.length;if(h){for(var j=[],i=-1;++i<h;){j[i]=arguments[i]}return e.call(this,j)}return e.call(this,[])}}c.exports=d},{}],2:[function(h,l,f){function c(){return"WebkitAppearance" in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function d(){var n=arguments,e=this.useColors;if(n[0]=(e?"%c":"")+this.namespace+(e?" %c":" ")+n[0]+(e?"%c ":" ")+"+"+f.humanize(this.diff),!e){return n}var i="color: "+this.color;n=[n[0],i,"color: inherit"].concat(Array.prototype.slice.call(n,1));var o=0,p=0;return n[0].replace(/%[a-z%]/g,function(q){"%%"!==q&&(o++,"%c"===q&&(p=o))}),n.splice(p,0,i),n}function g(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function j(e){try{null==e?f.storage.removeItem("debug"):f.storage.debug=e}catch(i){}}function m(){var e;try{e=f.storage.debug}catch(i){}return e}function k(){try{return window.localStorage}catch(e){}}f=l.exports=h(3),f.log=g,f.formatArgs=d,f.save=j,f.load=m,f.useColors=c,f.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:k(),f.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],f.formatters.j=function(e){return JSON.stringify(e)},f.enable(m())},{3:3}],3:[function(m,c,j){function g(){return j.colors[l++%j.colors.length]}function h(n){function f(){}function i(){var s=i,u=+new Date,t=u-(p||u);s.diff=t,s.prev=p,s.curr=u,p=u,null==s.useColors&&(s.useColors=j.useColors()),null==s.color&&s.useColors&&(s.color=g());var o=Array.prototype.slice.call(arguments);o[0]=j.coerce(o[0]),"string"!=typeof o[0]&&(o=["%o"].concat(o));var x=0;o[0]=o[0].replace(/%([a-z%])/g,function(D,B){if("%%"===D){return D}x++;var w=j.formatters[B];if("function"==typeof w){var C=o[x];D=w.call(s,C),o.splice(x,1),x--}return D}),"function"==typeof j.formatArgs&&(o=j.formatArgs.apply(s,o));var r=i.log||j.log||console.log.bind(console);r.apply(s,o)}f.enabled=!1,i.enabled=!0;var e=j.enabled(n)?i:f;return e.namespace=n,e}function k(i){j.save(i);for(var n=(i||"").split(/[\s,]+/),f=n.length,e=0;f>e;e++){n[e]&&(i=n[e].replace(/\*/g,".*?"),"-"===i[0]?j.skips.push(new RegExp("^"+i.substr(1)+"$")):j.names.push(new RegExp("^"+i+"$")))}}function q(){j.enable("")}function d(i){var e,f;for(e=0,f=j.skips.length;f>e;e++){if(j.skips[e].test(i)){return !1}}for(e=0,f=j.names.length;f>e;e++){if(j.names[e].test(i)){return !0}}return !1}function v(e){return e instanceof Error?e.stack||e.message:e}j=c.exports=h,j.coerce=v,j.disable=q,j.enable=k,j.enabled=d,j.humanize=m(9),j.names=[],j.skips=[],j.formatters={};var p,l=0},{9:9}],4:[function(j,f,l){function d(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function k(e){return"function"==typeof e}function g(e){return"number"==typeof e}function h(e){return"object"==typeof e&&null!==e}function c(e){return void 0===e}f.exports=d,d.EventEmitter=d,d.prototype._events=void 0,d.prototype._maxListeners=void 0,d.defaultMaxListeners=10,d.prototype.setMaxListeners=function(e){if(!g(e)||0>e||isNaN(e)){throw TypeError("n must be a positive number")}return this._maxListeners=e,this},d.prototype.emit=function(p){var i,e,m,o,q,n;if(this._events||(this._events={}),"error"===p&&(!this._events.error||h(this._events.error)&&!this._events.error.length)){if(i=arguments[1],i instanceof Error){throw i}throw TypeError('Uncaught, unspecified "error" event.')}if(e=this._events[p],c(e)){return !1}if(k(e)){switch(arguments.length){case 1:e.call(this);break;case 2:e.call(this,arguments[1]);break;case 3:e.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),e.apply(this,o)}}else{if(h(e)){for(o=Array.prototype.slice.call(arguments,1),n=e.slice(),m=n.length,q=0;m>q;q++){n[q].apply(this,o)}}}return !0},d.prototype.addListener=function(m,i){var e;if(!k(i)){throw TypeError("listener must be a function")}return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",m,k(i.listener)?i.listener:i),this._events[m]?h(this._events[m])?this._events[m].push(i):this._events[m]=[this._events[m],i]:this._events[m]=i,h(this._events[m])&&!this._events[m].warned&&(e=c(this._maxListeners)?d.defaultMaxListeners:this._maxListeners,e&&e>0&&this._events[m].length>e&&(this._events[m].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[m].length),"function"==typeof console.trace&&console.trace())),this},d.prototype.on=d.prototype.addListener,d.prototype.once=function(n,i){function e(){this.removeListener(n,e),m||(m=!0,i.apply(this,arguments))}if(!k(i)){throw TypeError("listener must be a function")}var m=!1;return e.listener=i,this.on(n,e),this},d.prototype.removeListener=function(p,m){var i,e,n,o;if(!k(m)){throw TypeError("listener must be a function")}if(!this._events||!this._events[p]){return this}if(i=this._events[p],n=i.length,e=-1,i===m||k(i.listener)&&i.listener===m){delete this._events[p],this._events.removeListener&&this.emit("removeListener",p,m)}else{if(h(i)){for(o=n;o-->0;){if(i[o]===m||i[o].listener&&i[o].listener===m){e=o;break}}if(0>e){return this}1===i.length?(i.length=0,delete this._events[p]):i.splice(e,1),this._events.removeListener&&this.emit("removeListener",p,m)}}return this},d.prototype.removeAllListeners=function(m){var i,e;if(!this._events){return this}if(!this._events.removeListener){return 0===arguments.length?this._events={}:this._events[m]&&delete this._events[m],this}if(0===arguments.length){for(i in this._events){"removeListener"!==i&&this.removeAllListeners(i)}return this.removeAllListeners("removeListener"),this._events={},this}if(e=this._events[m],k(e)){this.removeListener(m,e)}else{if(e){for(;e.length;){this.removeListener(m,e[e.length-1])}}}return delete this._events[m],this},d.prototype.listeners=function(i){var e;return e=this._events&&this._events[i]?k(this._events[i])?[this._events[i]]:this._events[i].slice():[]},d.prototype.listenerCount=function(i){if(this._events){var e=this._events[i];if(k(e)){return 1}if(e){return e.length}}return 0},d.listenerCount=function(i,e){return i.listenerCount(e)}},{}],5:[function(c,f,d){(function(v){function m(){t=!0;for(var n,l,i=p.length;i;){for(l=p,p=[],n=-1;++n<i;){l[n]()}i=p.length}t=!1}function h(i){1!==p.push(i)||t||j()}var j,q=v.MutationObserver||v.WebKitMutationObserver;if(q){var w=0,g=new q(m),e=v.document.createTextNode("");g.observe(e,{characterData:!0}),j=function(){e.data=w=++w%2}}else{if(v.setImmediate||"undefined"==typeof v.MessageChannel){j="document" in v&&"onreadystatechange" in v.document.createElement("script")?function(){var i=v.document.createElement("script");i.onreadystatechange=function(){m(),i.onreadystatechange=null,i.parentNode.removeChild(i),i=null},v.document.documentElement.appendChild(i)}:function(){setTimeout(m,0)}}else{var k=new v.MessageChannel;k.port1.onmessage=m,j=function(){k.port2.postMessage(0)}}}var t,p=[];f.exports=h}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],6:[function(c,f,d){"function"==typeof Object.create?f.exports=function(g,e){g.super_=e,g.prototype=Object.create(e.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}})}:f.exports=function(g,e){g.super_=e;var h=function(){};h.prototype=e.prototype,g.prototype=new h,g.prototype.constructor=g}},{}],7:[function(c,f,d){(function(e){e("object"==typeof d?d:this)}).call(this,function(h){var e=Array.prototype.slice,i=Array.prototype.forEach,g=function(j){if("object"!=typeof j){throw j+" is not an object"}var k=e.call(arguments,1);return i.call(k,function(m){if(m){for(var l in m){"object"==typeof m[l]&&j[l]?g.call(j,j[l],m[l]):j[l]=m[l]}}}),j};h.extend=g})},{}],8:[function(G,k,A){function w(){}function j(e){if("function"!=typeof e){throw new TypeError("resolver must be a function")}this.state=z,this.queue=[],this.outcome=void 0,e!==w&&g(this,e)}function H(f,e,h){this.promise=f,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof h&&(this.onRejected=h,this.callRejected=this.otherCallRejected)}function C(f,e,h){q(function(){var i;try{i=e(h)}catch(l){return d.reject(f,l)}i===f?d.reject(f,new TypeError("Cannot resolve promise with itself")):d.resolve(f,i)})}function I(f){var e=f&&f.then;return f&&"object"==typeof f&&"function"==typeof e?function(){e.apply(f,arguments)}:void 0}function g(l,h){function f(o){e||(e=!0,d.reject(l,o))}function i(o){e||(e=!0,d.resolve(l,o))}function m(){h(i,f)}var e=!1,n=x(m);"error"===n.status&&f(n.value)}function x(h,e){var i={};try{i.value=h(e),i.status="success"}catch(f){i.status="error",i.value=f}return i}function E(e){return e instanceof this?e:d.resolve(new this(w),e)}function B(f){var e=new this(w);return d.reject(e,f)}function J(l){function p(r,s){function t(u){n[s]=u,++m!==e||i||(i=!0,d.resolve(f,n))}h.resolve(r).then(t,function(u){i||(i=!0,d.reject(f,u))})}var h=this;if("[object Array]"!==Object.prototype.toString.call(l)){return this.reject(new TypeError("must be an array"))}var e=l.length,i=!1;if(!e){return this.resolve([])}for(var n=new Array(e),m=0,o=-1,f=new this(w);++o<e;){p(l[o],o)}return f}function D(l){function h(o){f.resolve(o).then(function(p){e||(e=!0,d.resolve(i,p))},function(p){e||(e=!0,d.reject(i,p))})}var f=this;if("[object Array]"!==Object.prototype.toString.call(l)){return this.reject(new TypeError("must be an array"))}var m=l.length,e=!1;if(!m){return this.resolve([])}for(var n=-1,i=new this(w);++n<m;){h(l[n])}return i}var q=G(5),d={},c=["REJECTED"],F=["FULFILLED"],z=["PENDING"];k.exports=A=j,j.prototype["catch"]=function(e){return this.then(null,e)},j.prototype.then=function(f,e){if("function"!=typeof f&&this.state===F||"function"!=typeof e&&this.state===c){return this}var i=new this.constructor(w);if(this.state!==z){var h=this.state===F?f:e;C(i,h,this.outcome)}else{this.queue.push(new H(i,f,e))}return i},H.prototype.callFulfilled=function(e){d.resolve(this.promise,e)},H.prototype.otherCallFulfilled=function(e){C(this.promise,this.onFulfilled,e)},H.prototype.callRejected=function(e){d.reject(this.promise,e)},H.prototype.otherCallRejected=function(e){C(this.promise,this.onRejected,e)},d.resolve=function(i,f){var m=x(I,f);if("error"===m.status){return d.reject(i,m.value)}var h=m.value;if(h){g(i,h)}else{i.state=F,i.outcome=f;for(var l=-1,e=i.queue.length;++l<e;){i.queue[l].callFulfilled(f)}}return i},d.reject=function(h,e){h.state=c,h.outcome=e;for(var i=-1,f=h.queue.length;++i<f;){h.queue[i].callRejected(e)}return h},A.resolve=E,A.reject=B,A.all=J,A.race=D},{5:5}],9:[function(p,x,h){function d(i){if(i=""+i,!(i.length>10000)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(i);if(e){var l=parseFloat(e[1]),f=(e[2]||"ms").toLowerCase();switch(f){case"years":case"year":case"yrs":case"yr":case"y":return l*j;case"days":case"day":case"d":return l*m;case"hours":case"hour":case"hrs":case"hr":case"h":return l*q;case"minutes":case"minute":case"mins":case"min":case"m":return l*w;case"seconds":case"second":case"secs":case"sec":case"s":return l*c;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return l}}}}function g(e){return e>=m?Math.round(e/m)+"d":e>=q?Math.round(e/q)+"h":e>=w?Math.round(e/w)+"m":e>=c?Math.round(e/c)+"s":e+"ms"}function k(e){return v(e,m,"day")||v(e,q,"hour")||v(e,w,"minute")||v(e,c,"second")||e+" ms"}function v(f,e,i){return e>f?void 0:1.5*e>f?Math.floor(f/e)+" "+i:Math.ceil(f/e)+" "+i+"s"}var c=1000,w=60*c,q=60*w,m=24*q,j=365.25*m;x.exports=function(f,e){return e=e||{},"string"==typeof f?d(f):e["long"]?k(f):g(f)}},{}],10:[function(v,m,c){function y(i){if(null!==i){switch(typeof i){case"boolean":return i?1:0;case"number":return k(i);case"string":return i.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var f=Array.isArray(i),o=f?i:Object.keys(i),l=-1,n=o.length,e="";if(f){for(;++l<n;){e+=c.toIndexableString(o[l])}}else{for(;++l<n;){var h=o[l];e+=c.toIndexableString(h)+c.toIndexableString(i[h])}}return e}}return""}function j(l,r){var h,e=r,f="1"===l[r];if(f){h=0,r++}else{var i="0"===l[r];r++;var o="",s=l.substring(r,r+q),p=parseInt(s,10)+B;for(i&&(p=-p),r+=q;;){var n=l[r];if("\x00"===n){break}o+=n,r++}o=o.split("."),h=1===o.length?parseInt(o,10):parseFloat(o[0]+"."+o[1]),i&&(h-=10),0!==p&&(h=parseFloat(h+"e"+p))}return{num:h,length:r-e}}function d(o,l){var f=o.pop();if(l.length){var e=l[l.length-1];f===e.element&&(l.pop(),e=l[l.length-1]);var n=e.element,i=e.index;if(Array.isArray(n)){n.push(f)}else{if(i===o.length-2){var h=o.pop();n[h]=f}else{o.push(f)}}}}function C(h,e){for(var f=Math.min(h.length,e.length),i=0;f>i;i++){var l=c.collate(h[i],e[i]);if(0!==l){return l}}return h.length===e.length?0:h.length>e.length?1:-1}function x(f,e){return f===e?0:f>e?1:-1}function A(i,f){for(var o=Object.keys(i),l=Object.keys(f),n=Math.min(o.length,l.length),e=0;n>e;e++){var h=c.collate(o[e],l[e]);if(0!==h){return h}if(h=c.collate(i[o[e]],f[l[e]]),0!==h){return h}}return o.length===l.length?0:o.length>l.length?1:-1}function g(f){var e=["boolean","number","string","object"],h=e.indexOf(typeof f);return ~h?null===f?1:Array.isArray(f)?5:3>h?h+2:h+3:Array.isArray(f)?5:void 0}function k(o){if(0===o){return"1"}var e=o.toExponential().split(/e\+?/),l=parseInt(e[1],10),h=0>o,i=h?"0":"2",n=(h?-l:l)-B,p=z.padLeft(n.toString(),"0",q);i+=w+p;var f=Math.abs(parseFloat(e[0]));h&&(f=10-f);var r=f.toFixed(20);return r=r.replace(/\.?0+$/,""),i+=w+r}var B=-324,q=3,w="",z=v(11);c.collate=function(h,e){if(h===e){return 0}h=c.normalizeKey(h),e=c.normalizeKey(e);var f=g(h),i=g(e);if(f-i!==0){return f-i}if(null===h){return 0}switch(typeof h){case"number":return h-e;case"boolean":return h===e?0:e>h?-1:1;case"string":return x(h,e)}return Array.isArray(h)?C(h,e):A(h,e)},c.normalizeKey=function(l){switch(typeof l){case"undefined":return null;case"number":return l===1/0||l===-(1/0)||isNaN(l)?null:l;case"object":var h=l;if(Array.isArray(l)){var i=l.length;l=new Array(i);for(var f=0;i>f;f++){l[f]=c.normalizeKey(h[f])}}else{if(l instanceof Date){return l.toJSON()}if(null!==l){l={};for(var e in h){if(h.hasOwnProperty(e)){var n=h[e];"undefined"!=typeof n&&(l[e]=c.normalizeKey(n))}}}}}return l},c.toIndexableString=function(f){var e="\x00";return f=c.normalizeKey(f),g(f)+w+y(f)+e},c.parseIndexableString=function(l){for(var r=[],f=[],e=0;;){var o=l[e++];if("\x00"!==o){switch(o){case"1":r.push(null);break;case"2":r.push("1"===l[e]),e++;break;case"3":var s=j(l,e);r.push(s.num),e+=s.length;break;case"4":for(var p="";;){var n=l[e];if("\x00"===n){break}p+=n,e++}p=p.replace(/\u0001\u0001/g,"\x00").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),r.push(p);break;case"5":var i={element:[],index:r.length};r.push(i.element),f.push(i);break;case"6":var h={element:{},index:r.length};r.push(h.element),f.push(h);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+o)}}else{if(1===r.length){return r.pop()}d(r,f)}}}},{11:11}],11:[function(f,c,g){function d(e,j,i){for(var k="",h=i-e.length;k.length<h;){k+=j}return k}g.padLeft=function(h,e,j){var i=d(h,e,j);return i+h},g.padRight=function(h,e,j){var i=d(h,e,j);return h+i},g.stringLexCompare=function(j,p){var l,h=j.length,m=p.length;for(l=0;h>l;l++){if(l===m){return 1}var e=j.charAt(l),k=p.charAt(l);if(e!==k){return k>e?-1:1}}return m>h?-1:0},g.intToDecimalForm=function(i){var e=0>i,j="";do{var h=e?-Math.ceil(i%10):Math.floor(i%10);j=h+j,i=e?Math.ceil(i/10):Math.floor(i/10)}while(i);return e&&"0"!==j&&(j="-"+j),j}},{}],12:[function(h,f,d){function g(){this.store={}}function c(i){if(this.store=new g,i&&Array.isArray(i)){for(var e=0,j=i.length;j>e;e++){this.add(i[e])}}}d.Map=g,d.Set=c,g.prototype.mangle=function(e){if("string"!=typeof e){throw new TypeError("key must be a string but Got "+e)}return"$"+e},g.prototype.unmangle=function(e){return e.substring(1)},g.prototype.get=function(i){var e=this.mangle(i);return e in this.store?this.store[e]:void 0},g.prototype.set=function(i,e){var j=this.mangle(i);return this.store[j]=e,!0},g.prototype.has=function(i){var e=this.mangle(i);return e in this.store},g.prototype["delete"]=function(i){var e=this.mangle(i);return e in this.store?(delete this.store[e],!0):!1},g.prototype.forEach=function(e){for(var k=Object.keys(this.store),i=0,m=k.length;m>i;i++){var l=k[i],j=this.store[l];l=this.unmangle(l),e(j,l)}},c.prototype.add=function(e){return this.store.set(e,!0)},c.prototype.has=function(e){return this.store.has(e)},c.prototype["delete"]=function(e){return this.store["delete"](e)}},{}],13:[function(p,x,h){function d(){m=!1,c.length?q=c.concat(q):j=-1,q.length&&g()}function g(){if(!m){var f=setTimeout(d);m=!0;for(var e=q.length;e;){for(c=q,q=[];++j<e;){c&&c[j].run()}j=-1,e=q.length}c=null,m=!1,clearTimeout(f)}}function k(f,e){this.fun=f,this.array=e}function v(){}var c,w=x.exports={},q=[],m=!1,j=-1;w.nextTick=function(f){var e=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){e[i-1]=arguments[i]}}q.push(new k(f,e)),1!==q.length||m||setTimeout(g,0)},k.prototype.run=function(){this.fun.apply(null,this.array)},w.title="browser",w.browser=!0,w.env={},w.argv=[],w.version="",w.versions={},w.on=v,w.addListener=v,w.once=v,w.off=v,w.removeListener=v,w.removeAllListeners=v,w.emit=v,w.binding=function(e){throw new Error("process.binding is not supported")},w.cwd=function(){return"/"},w.chdir=function(e){throw new Error("process.chdir is not supported")},w.umask=function(){return 0}},{}],14:[function(c,f,d){(function(){var e={}.hasOwnProperty,g=[].slice;f.exports=function(l,k){var j,i,m,h;i=[],h=[];for(j in k){e.call(k,j)&&(m=k[j],"this"!==j&&(i.push(j),h.push(m)))}return Function.apply(null,g.call(i).concat([l])).apply(k["this"],h)}}).call(this)},{}],15:[function(e,d,c){!function(g){if("object"==typeof c){d.exports=g()}else{if("function"==typeof b&&b.amd){b(g)}else{var h;try{h=window}catch(f){h=self}h.SparkMD5=g()}}}(function(z){function G(i,h,n,m,l,g){return h=K(K(h,i),K(m,g)),K(h<<l|h>>>32-l,n)}function B(m,n,l,h,i,o,g){return G(n&l|~n&h,m,n,i,o,g)}function C(m,n,l,h,i,o,g){return G(n&h|l&~h,m,n,i,o,g)}function q(m,n,l,h,i,o,g){return G(n^l^h,m,n,i,o,g)}function E(m,n,l,h,i,o,g){return G(l^(n|~h),m,n,i,o,g)}function M(i,h){var n=i[0],m=i[1],g=i[2],l=i[3];n=B(n,m,g,l,h[0],7,-680876936),l=B(l,n,m,g,h[1],12,-389564586),g=B(g,l,n,m,h[2],17,606105819),m=B(m,g,l,n,h[3],22,-1044525330),n=B(n,m,g,l,h[4],7,-176418897),l=B(l,n,m,g,h[5],12,1200080426),g=B(g,l,n,m,h[6],17,-1473231341),m=B(m,g,l,n,h[7],22,-45705983),n=B(n,m,g,l,h[8],7,1770035416),l=B(l,n,m,g,h[9],12,-1958414417),g=B(g,l,n,m,h[10],17,-42063),m=B(m,g,l,n,h[11],22,-1990404162),n=B(n,m,g,l,h[12],7,1804603682),l=B(l,n,m,g,h[13],12,-40341101),g=B(g,l,n,m,h[14],17,-1502002290),m=B(m,g,l,n,h[15],22,1236535329),n=C(n,m,g,l,h[1],5,-165796510),l=C(l,n,m,g,h[6],9,-1069501632),g=C(g,l,n,m,h[11],14,643717713),m=C(m,g,l,n,h[0],20,-373897302),n=C(n,m,g,l,h[5],5,-701558691),l=C(l,n,m,g,h[10],9,38016083),g=C(g,l,n,m,h[15],14,-660478335),m=C(m,g,l,n,h[4],20,-405537848),n=C(n,m,g,l,h[9],5,568446438),l=C(l,n,m,g,h[14],9,-1019803690),g=C(g,l,n,m,h[3],14,-187363961),m=C(m,g,l,n,h[8],20,1163531501),n=C(n,m,g,l,h[13],5,-1444681467),l=C(l,n,m,g,h[2],9,-51403784),g=C(g,l,n,m,h[7],14,1735328473),m=C(m,g,l,n,h[12],20,-1926607734),n=q(n,m,g,l,h[5],4,-378558),l=q(l,n,m,g,h[8],11,-2022574463),g=q(g,l,n,m,h[11],16,1839030562),m=q(m,g,l,n,h[14],23,-35309556),n=q(n,m,g,l,h[1],4,-1530992060),l=q(l,n,m,g,h[4],11,1272893353),g=q(g,l,n,m,h[7],16,-155497632),m=q(m,g,l,n,h[10],23,-1094730640),n=q(n,m,g,l,h[13],4,681279174),l=q(l,n,m,g,h[0],11,-358537222),g=q(g,l,n,m,h[3],16,-722521979),m=q(m,g,l,n,h[6],23,76029189),n=q(n,m,g,l,h[9],4,-640364487),l=q(l,n,m,g,h[12],11,-421815835),g=q(g,l,n,m,h[15],16,530742520),m=q(m,g,l,n,h[2],23,-995338651),n=E(n,m,g,l,h[0],6,-198630844),l=E(l,n,m,g,h[7],10,1126891415),g=E(g,l,n,m,h[14],15,-1416354905),m=E(m,g,l,n,h[5],21,-57434055),n=E(n,m,g,l,h[12],6,1700485571),l=E(l,n,m,g,h[3],10,-1894986606),g=E(g,l,n,m,h[10],15,-1051523),m=E(m,g,l,n,h[1],21,-2054922799),n=E(n,m,g,l,h[8],6,1873313359),l=E(l,n,m,g,h[15],10,-30611744),g=E(g,l,n,m,h[6],15,-1560198380),m=E(m,g,l,n,h[13],21,1309151649),n=E(n,m,g,l,h[4],6,-145523070),l=E(l,n,m,g,h[11],10,-1120210379),g=E(g,l,n,m,h[2],15,718787259),m=E(m,g,l,n,h[9],21,-343485551),i[0]=K(n,i[0]),i[1]=K(m,i[1]),i[2]=K(g,i[2]),i[3]=K(l,i[3])}function J(g){var i,h=[];for(i=0;64>i;i+=4){h[i>>2]=g.charCodeAt(i)+(g.charCodeAt(i+1)<<8)+(g.charCodeAt(i+2)<<16)+(g.charCodeAt(i+3)<<24)}return h}function A(g){var i,h=[];for(i=0;64>i;i+=4){h[i>>2]=g[i]+(g[i+1]<<8)+(g[i+2]<<16)+(g[i+3]<<24)}return h}function w(g){var m,o,l,n,p,i,h=g.length,r=[1732584193,-271733879,-1732584194,271733878];for(m=64;h>=m;m+=64){M(r,J(g.substring(m-64,m)))}for(g=g.substring(m-64),o=g.length,l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],m=0;o>m;m+=1){l[m>>2]|=g.charCodeAt(m)<<(m%4<<3)}if(l[m>>2]|=128<<(m%4<<3),m>55){for(M(r,l),m=0;16>m;m+=1){l[m]=0}}return n=8*h,n=n.toString(16).match(/(.*?)(.{0,8})$/),p=parseInt(n[2],16),i=parseInt(n[1],16)||0,l[14]=p,l[15]=i,M(r,l),r}function x(g){var i,o,l,n,p,m,h=g.length,r=[1732584193,-271733879,-1732584194,271733878];for(i=64;h>=i;i+=64){M(r,A(g.subarray(i-64,i)))}for(g=h>i-64?g.subarray(i-64):new Uint8Array(0),o=g.length,l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i=0;o>i;i+=1){l[i>>2]|=g[i]<<(i%4<<3)}if(l[i>>2]|=128<<(i%4<<3),i>55){for(M(r,l),i=0;16>i;i+=1){l[i]=0}}return n=8*h,n=n.toString(16).match(/(.*?)(.{0,8})$/),p=parseInt(n[2],16),m=parseInt(n[1],16)||0,l[14]=p,l[15]=m,M(r,l),r}function D(g){var i,h="";for(i=0;4>i;i+=1){h+=L[g>>8*i+4&15]+L[g>>8*i&15]}return h}function F(h){var g;for(g=0;g<h.length;g+=1){h[g]=D(h[g])}return h.join("")}function I(g){return/[\u0080-\uFFFF]/.test(g)&&(g=unescape(encodeURIComponent(g))),g}function k(i,h){var n,m=i.length,l=new ArrayBuffer(m),g=new Uint8Array(l);for(n=0;m>n;n+=1){g[n]=i.charCodeAt(n)}return h?g:l}function j(g){return String.fromCharCode.apply(null,new Uint8Array(g))}function f(h,g,i){var l=new Uint8Array(h.byteLength+g.byteLength);return l.set(new Uint8Array(h)),l.set(new Uint8Array(g),h.byteLength),i?l:l.buffer}function N(h){var g,i=[],l=h.length;for(g=0;l-1>g;g+=2){i.push(parseInt(h.substr(g,2),16))}return String.fromCharCode.apply(String,i)}function H(){this.reset()}var K=function(h,g){return h+g&4294967295},L=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return"5d41402abc4b2a76b9719d911017c592"!==F(w("hello"))&&(K=function(h,g){var i=(65535&h)+(65535&g),l=(h>>16)+(g>>16)+(i>>16);return l<<16|65535&i}),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||!function(){function g(i,h){return i=0|i||0,0>i?Math.max(i+h,0):Math.min(i,h)}ArrayBuffer.prototype.slice=function(n,m){var p,o,l,h,s=this.byteLength,r=g(n,s),i=s;return m!==z&&(i=g(m,s)),r>i?new ArrayBuffer(0):(p=i-r,o=new ArrayBuffer(p),l=new Uint8Array(o),h=new Uint8Array(this,r,p),l.set(h),o)}}(),H.prototype.append=function(g){return this.appendBinary(I(g)),this},H.prototype.appendBinary=function(g){this._buff+=g,this._length+=g.length;var i,h=this._buff.length;for(i=64;h>=i;i+=64){M(this._hash,J(this._buff.substring(i-64,i)))}return this._buff=this._buff.substring(i-64),this},H.prototype.end=function(i){var h,n,m=this._buff,l=m.length,g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(h=0;l>h;h+=1){g[h>>2]|=m.charCodeAt(h)<<(h%4<<3)}return this._finish(g,l),n=F(this._hash),i&&(n=N(n)),this.reset(),n},H.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},H.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},H.prototype.setState=function(g){return this._buff=g.buff,this._length=g.length,this._hash=g.hash,this},H.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},H.prototype._finish=function(i,h){var n,m,l,g=h;if(i[g>>2]|=128<<(g%4<<3),g>55){for(M(this._hash,i),g=0;16>g;g+=1){i[g]=0}}n=8*this._length,n=n.toString(16).match(/(.*?)(.{0,8})$/),m=parseInt(n[2],16),l=parseInt(n[1],16)||0,i[14]=m,i[15]=l,M(this._hash,i)},H.hash=function(h,g){return H.hashBinary(I(h),g)},H.hashBinary=function(h,g){var i=w(h),l=F(i);return g?N(l):l},H.ArrayBuffer=function(){this.reset()},H.ArrayBuffer.prototype.append=function(h){var g,i=f(this._buff.buffer,h,!0),l=i.length;for(this._length+=h.byteLength,g=64;l>=g;g+=64){M(this._hash,A(i.subarray(g-64,g)))}return this._buff=l>g-64?new Uint8Array(i.buffer.slice(g-64)):new Uint8Array(0),this},H.ArrayBuffer.prototype.end=function(i){var h,n,m=this._buff,l=m.length,g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(h=0;l>h;h+=1){g[h>>2]|=m[h]<<(h%4<<3)}return this._finish(g,l),n=F(this._hash),i&&(n=N(n)),this.reset(),n},H.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},H.ArrayBuffer.prototype.getState=function(){var g=H.prototype.getState.call(this);return g.buff=j(g.buff),g},H.ArrayBuffer.prototype.setState=function(g){return g.buff=k(g.buff,!0),H.prototype.setState.call(this,g)},H.ArrayBuffer.prototype.destroy=H.prototype.destroy,H.ArrayBuffer.prototype._finish=H.prototype._finish,H.ArrayBuffer.hash=function(h,g){var i=x(new Uint8Array(h)),l=F(i);return g?N(l):l},H})},{}],16:[function(f,c,g){function d(j,p,l){var h=l[l.length-1];j===h.element&&(l.pop(),h=l[l.length-1]);var m=h.element,e=h.index;if(Array.isArray(m)){m.push(j)}else{if(e===p.length-2){var k=p.pop();m[k]=j}else{p.push(j)}}}g.stringify=function(q){var x=[];x.push({obj:q});for(var w,h,B,m,A,z,p,j,v,k,y,e="";w=x.pop();){if(h=w.obj,B=w.prefix||"",m=w.val||"",e+=B,m){e+=m}else{if("object"!=typeof h){e+="undefined"==typeof h?null:JSON.stringify(h)}else{if(null===h){e+="null"}else{if(Array.isArray(h)){for(x.push({val:"]"}),A=h.length-1;A>=0;A--){z=0===A?"":",",x.push({obj:h[A],prefix:z})}x.push({val:"["})}else{p=[];for(j in h){h.hasOwnProperty(j)&&p.push(j)}for(x.push({val:"}"}),A=p.length-1;A>=0;A--){v=p[A],k=h[v],y=A>0?",":"",y+=JSON.stringify(v)+":",x.push({obj:k,prefix:y})}x.push({val:"{"})}}}}}return e},g.parse=function(r){for(var j,y,e,m,q,k,v,z,h,p=[],x=[],w=0;;){if(j=r[w++],"}"!==j&&"]"!==j&&"undefined"!=typeof j){switch(j){case" ":case"	":case"\n":case":":case",":break;case"n":w+=3,d(null,p,x);break;case"t":w+=3,d(!0,p,x);break;case"f":w+=4,d(!1,p,x);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(y="",w--;;){if(e=r[w++],!/[\d\.\-e\+]/.test(e)){w--;break}y+=e}d(parseFloat(y),p,x);break;case'"':for(m="",q=void 0,k=0;;){if(v=r[w++],'"'===v&&("\\"!==q||k%2!==1)){break}m+=v,q=v,"\\"===q?k++:k=0}d(JSON.parse('"'+m+'"'),p,x);break;case"[":z={element:[],index:p.length},p.push(z.element),x.push(z);break;case"{":h={element:{},index:p.length},p.push(h.element),x.push(h);break;default:throw new Error("unexpectedly reached end of input: "+j)}}else{if(1===p.length){return p.pop()}d(p.pop(),p,x)}}}},{}],17:[function(c,f,d){(function(by,ch){function ds(k,i){k=k||[],i=i||{};try{return new Blob(k,i)}catch(h){if("TypeError"!==h.name){throw h}for(var j="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder,l=new j,g=0;g<k.length;g+=1){l.append(k[g])}return l.getBlob(i.type)}}function eU(i,h){if("undefined"==typeof FileReader){return h((new FileReaderSync).readAsArrayBuffer(i))}var g=new FileReader;g.onloadend=function(j){var k=j.target.result||new ArrayBuffer(0);h(k)},g.readAsArrayBuffer(i)}function bl(){for(var i={},g=new dW(function(k,l){i.resolve=k,i.reject=l}),j=new Array(arguments.length),h=0;h<j.length;h++){j[h]=arguments[h]}return i.promise=g,dW.resolve().then(function(){return fetch.apply(null,j)}).then(function(k){i.resolve(k)})["catch"](function(k){i.reject(k)}),i}function b0(l,h){var i,k,m,j=new Headers,g={method:l.method,credentials:"include",headers:j};return l.json&&(j.set("Accept","application/json"),j.set("Content-Type",l.headers["Content-Type"]||"application/json")),l.body&&l.body instanceof Blob?eU(l.body,function(n){g.body=n}):l.body&&l.processData&&"string"!=typeof l.body?g.body=JSON.stringify(l.body):"body" in l?g.body=l.body:g.body=null,Object.keys(l.headers).forEach(function(n){l.headers.hasOwnProperty(n)&&j.set(n,l.headers[n])}),i=bl(l.url,g),l.timeout>0&&(k=setTimeout(function(){i.reject(new Error("Load timeout for resource: "+l.url))},l.timeout)),i.promise.then(function(n){return m={statusCode:n.status},l.timeout>0&&clearTimeout(k),m.statusCode>=200&&m.statusCode<300?l.binary?n.blob():n.text():n.json()}).then(function(n){m.statusCode>=200&&m.statusCode<300?h(null,m,n):h(n,m)})["catch"](function(n){h(n,m)}),{abort:i.reject}}function b4(m,j){var i,l,g=function(){i.abort()};i=m.xhr?new m.xhr:new XMLHttpRequest;try{i.open(m.method,m.url)}catch(k){j(k,{statusCode:413})}i.withCredentials="withCredentials" in m?m.withCredentials:!0,"GET"===m.method?delete m.headers["Content-Type"]:m.json&&(m.headers.Accept="application/json",m.headers["Content-Type"]=m.headers["Content-Type"]||"application/json",m.body&&m.processData&&"string"!=typeof m.body&&(m.body=JSON.stringify(m.body))),m.binary&&(i.responseType="arraybuffer"),"body" in m||(m.body=null);for(var h in m.headers){m.headers.hasOwnProperty(h)&&i.setRequestHeader(h,m.headers[h])}return m.timeout>0&&(l=setTimeout(g,m.timeout),i.onprogress=function(){clearTimeout(l),l=setTimeout(g,m.timeout)},"undefined"!=typeof i.upload&&(i.upload.onprogress=i.onprogress)),i.onreadystatechange=function(){if(4===i.readyState){var q={statusCode:i.status};if(i.status>=200&&i.status<300){var o;o=m.binary?ds([i.response||""],{type:i.getResponseHeader("Content-Type")}):i.responseText,j(null,q,o)}else{var n={};try{n=JSON.parse(i.response)}catch(p){}j(n,q)}}},m.body&&m.body instanceof Blob?eU(m.body,function(n){i.send(n)}):i.send(m.body),{abort:g}}function jz(){try{return new XMLHttpRequest,!0}catch(g){return !1}}function jP(h,g){return ca||h.xhr?b4(h,g):b0(h,g)}function cW(g){Error.call(this,g.reason),this.status=g.status,this.name=g.error,this.message=g.reason,this.error=!0}function bw(i,g,j){function h(k){for(var l in i){"function"!=typeof i[l]&&(this[l]=i[l])}void 0!==j&&(this.name=j),void 0!==k&&(this.reason=k)}return h.prototype=cW.prototype,new h(g)}function eY(k){var i,h,j,l,g;return h=k.error===!0&&"string"==typeof k.name?k.name:k.error,g=k.reason,j=ac("name",h,g),k.missing||"missing"===g||"deleted"===g||"not_found"===h?j=c3:"doc_validation"===h?(j=aQ,l=g):"bad_request"===h&&j.message!==g&&(j=bZ),j||(j=ac("status",k.status,g)||bm),i=bw(j,g,h),l&&(i.message=l),k.id&&(i.id=k.id),k.status&&(i.status=k.status),k.missing&&(i.missing=k.missing),i}function d0(g){return g instanceof ArrayBuffer||"undefined"!=typeof Blob&&g instanceof Blob}function cI(i){if("function"==typeof i.slice){return i.slice(0)}var g=new ArrayBuffer(i.byteLength),j=new Uint8Array(g),h=new Uint8Array(i);return j.set(h),g}function aa(i){if(i instanceof ArrayBuffer){return cI(i)}var h=i.size,g=i.type;return"function"==typeof i.slice?i.slice(0,h,g):i.webkitSlice(0,h,g)}function d4(j){var h,g,i;if(!j||"object"!=typeof j){return j}if(Array.isArray(j)){for(h=[],g=0,i=j.length;i>g;g++){h[g]=d4(j[g])}return h}if(j instanceof Date){return j.toISOString()}if(d0(j)){return aa(j)}h={};for(g in j){if(Object.prototype.hasOwnProperty.call(j,g)){var k=d4(j[g]);"undefined"!=typeof k&&(h[g]=k)}}return h}function aX(){return""}function cB(j,h){function g(l,o,m){if(!j.binary&&j.json&&"string"==typeof l){try{l=JSON.parse(l)}catch(n){return m(n)}}Array.isArray(l)&&(l=l.map(function(p){return p.error||p.missing?eY(p):p})),j.binary&&jq(l,o),m(null,l,o)}function i(m,q){var o,l;if(m.code&&m.status){var n=new Error(m.message||m.code);return n.status=m.status,q(n)}try{o=JSON.parse(m.responseText),l=eY(o)}catch(p){l=eY(m)}q(l)}j=d4(j);var k={method:"GET",headers:{},json:!0,processData:!0,timeout:10000,cache:!1};return j=eZ.extend(k,j),j.json&&(j.binary||(j.headers.Accept="application/json"),j.headers["Content-Type"]=j.headers["Content-Type"]||"application/json"),j.binary&&(j.encoding=null,j.json=!1),j.processData||(j.json=!1),jP(j,function(l,p,n){if(l){return l.status=p?p.statusCode:400,i(l,h)}var q,o=p.headers&&p.headers["content-type"],m=n||aX();if(!j.binary&&(j.json||!j.processData)&&"object"!=typeof m&&(/json/.test(o)||/^[\s]*\{/.test(m)&&/\}[\s]*$/.test(m))){try{m=JSON.parse(m.toString())}catch(r){}}p.statusCode>=200&&p.statusCode<300?g(m,p,h):(q=eY(m),q.status=p.statusCode,h(q))})}function bP(m,j){var g=navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",l=-1!==g.indexOf("safari")&&-1===g.indexOf("chrome"),n=-1!==g.indexOf("msie"),i=l&&"POST"===m.method||n&&"GET"===m.method,h="cache" in m?m.cache:!0;if(i||!h){var k=-1!==m.url.indexOf("?");m.url+=(k?"&":"?")+"_nonce="+Date.now()}return cB(m,j)}function jr(h){var g=!1;return fO(function(i){if(g){throw new Error("once called more than once")}g=!0,h.apply(this,i)})}function jY(g){return fO(function(j){j=d4(j);var k,l=this,i="function"==typeof j[j.length-1]?j.pop():!1;i&&(k=function(n,m){by.nextTick(function(){i(n,m)})});var h=new dW(function(n,m){var p;try{var o=jr(function(r,s){r?m(r):n(s)});j.push(o),p=g.apply(l,j),p&&"function"==typeof p.then&&n(p)}catch(q){m(q)}});return k&&h.then(function(m){k(null,m)},k),h})}function jQ(i,h){function g(k,o,m){if(fD.enabled){for(var j=[k._db_name,o],l=0;l<m.length-1;l++){j.push(m[l])}fD.apply(null,j);var n=m[m.length-1];m[m.length-1]=function(r,p){var q=[k._db_name,o];q=q.concat(r?["error",r]:["success",p]),fD.apply(null,q),n(r,p)}}}return jY(fO(function(j){if(this._closed){return dW.reject(new Error("database is closed"))}var k=this;return g(k,i,j),this.taskqueue.isReady?h.apply(this,j):new dW(function(l,m){k.taskqueue.addTask(function(n){n?m(n):l(k[i].apply(k,j))})})}))}function fN(k,i){for(var h={},j=0,l=i.length;l>j;j++){var g=i[j];g in k&&(h[g]=k[g])}return h}function cs(i,h,g){return new dW(function(j,k){i.get(h,function(n,l){if(n){if(404!==n.status){return k(n)}l={}}var o=l._rev,m=g(l);return m?(m._id=h,m._rev=o,void j(jG(i,m,g))):j({updated:!1,rev:o})})})}function jG(i,h,g){return i.put(h).then(function(j){return{updated:!0,rev:j.rev}},function(j){if(409!==j.status){throw j}return cs(i,h._id,g)})}function jo(r){for(var s,i,g,h,k=r.rev_tree.slice();h=k.pop();){var p=h.ids,l=p[2],q=h.pos;if(l.length){for(var o=0,m=l.length;m>o;o++){k.push({pos:q+1,ids:l[o]})}}else{var j=!!p[1].deleted,n=p[0];(!s||(g!==j?g:i!==q?q>i:n>s))&&(s=n,i=q,g=j)}}return i+"-"+s}function cG(g){return g.ids}function dA(j,h){h||(h=jo(j));for(var g,i=h.substring(h.indexOf("-")+1),k=j.rev_tree.map(cG);g=k.pop();){if(g[0]===i){return !!g[1].deleted}k=k.concat(g[2])}}function eJ(g){return aZ("return "+g+";",{})}function b6(g){return new Function("doc",["var emitted = false;","var emit = function (a, b) {","  emitted = true;","};","var view = "+g+";","view(doc);","if (emitted) {","  return true;","}"].join("\n"))}function e(h){if(!h){return null}var g=h.split("/");return 2===g.length?g:1===g.length?[h,h]:null}function jR(h){var g=e(h);return g?g.join("/"):null}function fH(m,g){for(var k,i=m.slice();k=i.pop();){for(var j=k.pos,l=k.ids,o=l[2],h=g(0===o.length,j,l[0],k.ctx,l[1]),p=0,n=o.length;n>p;p++){i.push({pos:j+1,ids:o[p],ctx:h})}}}function jB(h,g){return h.pos-g.pos}function c0(i){var g=[];fH(i,function(n,k,m,o,l){n&&g.push({rev:k+"-"+m,pos:k,opts:l})}),g.sort(jB).reverse();for(var j=0,h=g.length;h>j;j++){delete g[j].pos}return g}function jn(m){for(var k=jo(m),g=c0(m.rev_tree),l=[],i=0,j=g.length;j>i;i++){var h=g[i];h.rev===k||h.opts.deleted||l.push(h.rev)}return l}function jW(m,k,g){function l(){i.cancel()}ax.EventEmitter.call(this);var i=this;this.db=m,k=k?d4(k):{};var j=k.complete=jr(function(o,n){o?i.emit("error",o):i.emit("complete",n),i.removeAllListeners(),m.removeListener("destroyed",l)});g&&(i.on("complete",function(n){g(null,n)}),i.on("error",g)),m.once("destroyed",l),k.onChange=function(n){k.isCancelled||(i.emit("change",n),i.startSeq&&i.startSeq<=n.seq&&(i.startSeq=!1))};var h=new dW(function(o,n){k.complete=function(p,q){p?n(p):o(q)}});i.once("cancel",function(){m.removeListener("destroyed",l),k.complete(null,{status:"cancelled"})}),this.then=h.then.bind(h),this["catch"]=h["catch"].bind(h),this.then(function(n){j(null,n)},j),m.taskqueue.isReady?i.doChanges(k):m.taskqueue.addTask(function(){i.isCancelled?i.emit("cancel"):i.doChanges(k)})}function bW(j,h,g){var i=[{rev:j._rev}];"all_docs"===g.style&&(i=c0(h.rev_tree).map(function(l){return{rev:l.rev}}));var k={id:h.id,changes:i,doc:j};return dA(h,j._rev)&&(k.deleted=!0),g.conflicts&&(k.doc._conflicts=jn(h),k.doc._conflicts.length||delete k.doc._conflicts),k}function c4(k,p,j){function h(){var r=[];q.forEach(function(s){s.docs.forEach(function(u){r.push({id:s.id,docs:[u]})})}),j(null,{results:r})}function g(){++m===o&&h()}function i(r,u,s){q[r]={id:u,docs:s},g()}var l=Array.isArray(p)?p:p.docs,n={};l.forEach(function(r){r.id in n?n[r.id].push(r):n[r.id]=[r]});var o=Object.keys(n).length,m=0,q=new Array(o);Object.keys(n).forEach(function(u,v){var w=n[u],s=fN(w[0],["atts_since","attachments"]);s.open_revs=w.map(function(x){return x.rev}),s.open_revs=s.open_revs.filter(function(x){return x});var r=function(x){return x};0===s.open_revs.length&&(delete s.open_revs,r=function(x){return[{ok:x}]}),["revs","attachments","binary"].forEach(function(x){x in p&&(s[x]=p[x])}),k.get(u,s,function(x,y){i(v,u,x?[{error:x}]:r(y))})})}function dK(g){return/^_local/.test(g)}function jS(r){for(var s,i=[],g=r.slice();s=g.pop();){var h=s.pos,k=s.ids,p=k[0],l=k[1],q=k[2],o=0===q.length,m=s.history?s.history.slice():[];m.push({id:p,opts:l}),o&&i.push({pos:h+1-m.length,ids:m});for(var j=0,n=q.length;n>j;j++){g.push({pos:h+1,ids:q[j],history:m})}}return i.reverse()}function jE(g){return 0|Math.random()*g}function ad(i,g){g=g||aS.length;var j="",h=-1;if(i){for(;++h<i;){j+=aS[jE(g)]}return j}for(;++h<36;){switch(h){case 8:case 13:case 18:case 23:j+="-";break;case 19:j+=aS[3&jE(16)|8];break;default:j+=aS[jE(16)]}}return j}function jm(g){return g.reduce(function(i,h){return i[h]=!0,i},{})}function jU(h){var g;if(h?"string"!=typeof h?g=bw(fA):/^_/.test(h)&&!/^_(design|local)/.test(h)&&(g=bw(af)):g=bw(aI),g){throw g}}function ba(i){if(!/^\d+\-./.test(i)){return bw(fL)}var g=i.indexOf("-"),j=i.substring(0,g),h=i.substring(g+1);return{prefix:parseInt(j,10),id:h}}function jH(m,k){for(var g=m.start-m.ids.length+1,l=m.ids,i=[l[0],k,[]],j=1,h=l.length;h>j;j++){i=[l[j],{status:"missing"},[i]]}return[{pos:g,ids:i}]}function dj(m,g){var k,i,j,l={status:"available"};if(m._deleted&&(l.deleted=!0),g){if(m._id||(m._id=ad()),i=ad(32,16).toLowerCase(),m._rev){if(j=ba(m._rev),j.error){return j}m._rev_tree=[{pos:j.prefix,ids:[j.id,{status:"missing"},[[i,l,[]]]]}],k=j.prefix+1}else{m._rev_tree=[{pos:1,ids:[i,l,[]]}],k=1}}else{if(m._revisions&&(m._rev_tree=jH(m._revisions,l),k=m._revisions.start,i=m._revisions.ids[0]),!m._rev_tree){if(j=ba(m._rev),j.error){return j}k=j.prefix,i=j.id,m._rev_tree=[{pos:k,ids:[i,l,[]]}]}}jU(m._id),m._rev=k+"-"+i;var o={metadata:{},data:{}};for(var h in m){if(Object.prototype.hasOwnProperty.call(m,h)){var p="_"===h[0];if(p&&!jX[h]){var n=bw(aQ,h);throw n.message=aQ.message+": "+h,n}p&&!bM[h]?o.metadata[h.slice(1)]=m[h]:o.data[h]=m[h]}}return o}function ah(h,g){return g>h?-1:h>g?1:0}function d9(i,h){for(var g=0;g<i.length;g++){if(h(i[g],g)===!0){return i[g]}}}function cT(g){return function(h,i){h||i[0]&&i[0].error?g(h||i[0]):g(null,i.length?i[0]:i)}}function bj(k){for(var i=0;i<k.length;i++){var h=k[i];if(h._deleted){delete h._attachments}else{if(h._attachments){for(var j=Object.keys(h._attachments),l=0;l<j.length;l++){var g=j[l];h._attachments[g]=fN(h._attachments[g],["data","digest","content_type","length","revpos","stub"])}}}}}function aR(j,h){var g=ah(j._id,h._id);if(0!==g){return g}var i=j._revisions?j._revisions.start:0,k=h._revisions?h._revisions.start:0;return ah(i,k)}function eP(i){var h={},g=[];return fH(i,function(n,m,j,l){var k=m+"-"+j;return n&&(h[k]=0),void 0!==l&&g.push({from:l,to:k}),k}),g.reverse(),g.forEach(function(j){void 0===h[j.from]?h[j.from]=1+h[j.to]:h[j.from]=Math.min(h[j.from],1+h[j.to])}),h}function dS(j,h,g){var i="limit" in h?h.keys.slice(h.skip,h.limit+h.skip):h.skip>0?h.keys.slice(h.skip):h.keys;if(h.descending&&i.reverse(),!i.length){return j._allDocs({limit:0},g)}var k={offset:h.skip};return dW.all(i.map(function(m){var l=eZ.extend({key:m,deleted:"ok"},h);return["limit","skip","keys"].forEach(function(n){delete l[n]}),new dW(function(o,n){j._allDocs(l,function(q,p){return q?n(q):(k.total_rows=p.total_rows,void o(p.rows[0]||{key:m,error:"not_found"}))})})})).then(function(l){return k.rows=l,k})}function c6(i){var g=i._compactionQueue[0],h=g.opts,j=g.callback;i.get("_local/compaction")["catch"](function(){return !1}).then(function(k){k&&k.last_seq&&(h.last_seq=k.last_seq),i._compact(h,function(l,m){l?j(l):j(null,m),by.nextTick(function(){i._compactionQueue.shift(),i._compactionQueue.length&&c6(i)})})})}function dy(g){return"_"===g.charAt(0)?g+"is not a valid attachment name, attachment names cannot start with '_'":!1}function e8(){ax.EventEmitter.call(this)}function jN(){this.isReady=!1,this.failed=!1,this.queue=[]}function bb(g){g&&ch.debug&&console.error(g)}function bH(m,k){function g(){j.emit("destroyed",i),j.emit(i,"destroyed")}function l(){m.removeListener("destroyed",g),m.emit("destroyed",m)}var i=k.originalName,j=m.constructor,h=j._destructionListeners;m.once("destroyed",g),h.has(i)||h.set(i,[]),h.get(i).push(l)}function cE(k,i,h){if(!(this instanceof cE)){return new cE(k,i,h)}var j=this;("function"==typeof i||"undefined"==typeof i)&&(h=i,i={}),k&&"object"==typeof k&&(i=k,k=void 0),"undefined"==typeof h&&(h=bb),k=k||i.name,i=d4(i),delete i.name,this.__opts=i;var l=h;j.auto_compaction=i.auto_compaction,j.prefix=cE.prefix,e8.call(j),j.taskqueue=new jN;var g=new dW(function(n,q){h=function(r,s){return r?q(r):(delete s.then,void n(s))},i=d4(i);var o,m,p=i.name||k;return function(){try{if("string"!=typeof p){throw m=new Error("Missing/invalid DB name"),m.code=400,m}if(o=cE.parseAdapter(p,i),i.originalName=p,i.name=o.name,i.prefix&&"http"!==o.adapter&&"https"!==o.adapter&&(i.name=i.prefix+i.name),i.adapter=i.adapter||o.adapter,j._adapter=i.adapter,bG("pouchdb:adapter")("Picked adapter: "+i.adapter),j._db_name=p,!cE.adapters[i.adapter]){throw m=new Error("Adapter is missing"),m.code=404,m}if(!cE.adapters[i.adapter].valid()){throw m=new Error("Invalid Adapter"),m.code=404,m}}catch(r){j.taskqueue.fail(r)}}(),m?q(m):(j.adapter=i.adapter,j.replicate={},j.replicate.from=function(r,u,s){return j.constructor.replicate(r,j,u,s)},j.replicate.to=function(r,u,s){return j.constructor.replicate(j,r,u,s)},j.sync=function(r,u,s){return j.constructor.sync(j,r,u,s)},j.replicate.sync=j.sync,void cE.adapters[i.adapter].call(j,i,function(r){return r?(j.taskqueue.fail(r),void h(r)):(bH(j,i),j.emit("created",j),cE.emit("created",i.originalName),j.taskqueue.ready(j),void h(null,j))}))});g.then(function(m){l(null,m)},l),j.then=g.then.bind(g),j["catch"]=g["catch"].bind(g)}function jy(){return"undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage&&"undefined"!=typeof chrome.storage.local}function aB(){return cC}function ea(h){Object.keys(ax.EventEmitter.prototype).forEach(function(i){"function"==typeof ax.EventEmitter.prototype[i]&&(h[i]=aV[i].bind(aV))});var g=h._destructionListeners=new ay.Map;h.on("destroyed",function(i){g.has(i)&&(g.get(i).forEach(function(j){j()}),g["delete"](i))})}function e6(j){for(var h=j.length,g=new ArrayBuffer(h),i=new Uint8Array(g),k=0;h>k;k++){i[k]=j.charCodeAt(k)}return g}function jw(h,g){return ds([e6(h)],{type:g})}function eS(m){for(var k=fJ.exec(m),g={},l=14;l--;){var i=az[l],j=k[l]||"",h=-1!==["user","password"].indexOf(i);g[i]=h?decodeURIComponent(j):j}return g[d2]={},g[az[12]].replace(bQ,function(p,n,o){n&&(g[d2][n]=o)}),g}function a8(j,h,g){try{return !j(h,g)}catch(i){var k="Filter function threw: "+i.toString();return bw(bZ,k)}}function jO(i){var h={},g=i.filter&&"function"==typeof i.filter;return h.query=i.query_params,function(k){k.doc||(k.doc={});var l=g&&a8(i.filter,k.doc,h);if("object"==typeof l){return l}if(l){return !1}if(i.include_docs){if(!i.attachments){for(var j in k.doc._attachments){k.doc._attachments.hasOwnProperty(j)&&(k.doc._attachments[j].stub=!0)}}}else{delete k.doc}return !0}}function aq(h,g){"console" in ch&&"info" in console&&console.info("The above "+h+" is totally normal. "+g)}function d6(j,h,g,i,k){return j.get(h)["catch"](function(l){if(404===l.status){return"http"===j.type()&&aq(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:i,_id:h,history:[],replicator:cx,version:em}}throw l}).then(function(l){return k.cancelled?void 0:(l.history=(l.history||[]).filter(function(m){return m.session_id!==i}),l.history.unshift({last_seq:g,session_id:i}),l.history=l.history.slice(0,eK),l.version=em,l.replicator=cx,l.session_id=i,l.last_seq=g,j.put(l)["catch"](function(m){if(409===m.status){return d6(j,h,g,i,k)}throw m}))})}function jV(i,g,j,h){this.src=i,this.target=g,this.id=j,this.returnValue=h}function eh(i,g){if(i.session_id===g.session_id){return{last_seq:i.last_seq,history:i.history||[]}}var j=i.history||[],h=g.history||[];return cj(j,h)}function cj(m,j){var g=m[0],l=m.slice(1),n=j[0],i=j.slice(1);if(!g||0===j.length){return{last_seq:dg,history:[]}}var h=g.session_id;if(eg(h,j)){return{last_seq:g.last_seq,history:m}}var k=n.session_id;return eg(k,l)?{last_seq:n.last_seq,history:i}:cj(l,i)}function eg(i,g){var j=g[0],h=g.slice(1);return i&&0!==g.length?i===j.session_id?!0:eg(i,h):!1}function jD(i,g){i=parseInt(i,10)||0,g=parseInt(g,10),g!==g||i>=g?g=(i||1)<<1:g+=1;var j=Math.random(),h=g-i;return ~~(h*j+i)}function c5(h){var g=0;return h||(g=2000),jD(h,g)}function al(i,g,j,h){return i.retry===!1?(g.emit("error",j),void g.removeAllListeners()):("function"!=typeof i.back_off_function&&(i.back_off_function=c5),g.emit("requestError",j),("active"===g.state||"pending"===g.state)&&(g.emit("paused",j),g.state="stopped",g.once("active",function(){i.current_back_off=dU})),i.current_back_off=i.current_back_off||dU,i.current_back_off=i.back_off_function(i.current_back_off),void setTimeout(h,i.current_back_off))}function bO(g){return b1(g)}function cc(i,g,j,h){(j>0||h<g.byteLength)&&(g=new Uint8Array(g,j,Math.min(h,g.byteLength)-j)),i.append(g)}function dc(i,g,j,h){(j>0||h<g.length)&&(g=g.substring(j,h)),i.appendBinary(g)}function dq(g){return Object.keys(g).sort(cV.collate).reduce(function(h,i){return h[i]=g[i],h},{})}function aL(m,k,g){var l=g.doc_ids?g.doc_ids.sort(cV.collate):"",i=g.filter?g.filter.toString():"",j="",h="";return g.filter&&g.query_params&&(j=JSON.stringify(dq(g.query_params))),g.filter&&"_view"===g.filter&&(h=g.view.toString()),dW.all([m.id(),k.id()]).then(function(n){var o=n[0]+n[1]+i+h+j+l;return bq(o)}).then(function(n){return n=n.replace(/\//g,".").replace(/\+/g,"_"),"_local/"+n})}function aC(g){return/^1-/.test(g)}function bX(h){var g=[];return Object.keys(h).forEach(function(j){var i=h[j].missing;i.forEach(function(k){g.push({id:j,rev:k})})}),{docs:g,revs:!0,attachments:!0,binary:!0}}function cS(j,l,h){function n(){var p=bX(l);if(p.docs.length){return j.bulkGet(p).then(function(q){if(h.cancelled){throw new Error("cancelled")}q.results.forEach(function(r){r.docs.forEach(function(s){s.ok&&o.push(s.ok)})})})}}function i(p){return p._attachments&&Object.keys(p._attachments).length>0}function k(p){return j.allDocs({keys:p,include_docs:!0}).then(function(q){if(h.cancelled){throw new Error("cancelled")}q.rows.forEach(function(r){!r.deleted&&r.doc&&aC(r.value.rev)&&!i(r.doc)&&(o.push(r.doc),delete l[r.id])})})}function m(){var p=Object.keys(l).filter(function(q){var r=l[q].missing;return 1===r.length&&aC(r[0])});return p.length>0?k(p):void 0}function g(){return o}l=d4(l);var o=[];return dW.resolve().then(m).then(n).then(g)}function ef(R,g,x,p,w){function D(){return G?dW.resolve():aL(R,g,x).then(function(T){j=T,G=new jV(R,g,j,p)})}function s(){if(L=[],0!==I.docs.length){var T=I.docs;return g.bulkDocs({docs:T,new_edits:!1}).then(function(W){if(p.cancelled){throw E(),new Error("cancelled")}var Y=[],V={};W.forEach(function(Z){Z.error&&(w.doc_write_failures++,Y.push(Z),V[Z.id]=Z)}),k=k.concat(Y),w.docs_written+=I.docs.length-Y.length;var U=Y.filter(function(Z){return"unauthorized"!==Z.name&&"forbidden"!==Z.name});if(T.forEach(function(Z){var ae=V[Z._id];ae?p.emit("denied",d4(ae)):L.push(Z)}),U.length>0){var X=new Error("bulkDocs error");throw X.other_errors=Y,o("target.bulkDocs failed to write docs",X),new Error("bulkWrite partial failure")}},function(U){throw w.doc_write_failures+=T.length,U})}}function i(){w.last_seq=J=I.seq;var T=d4(w);return L.length&&(T.docs=L,p.emit("change",T)),F=!0,G.writeCheckpoint(I.seq,m).then(function(){if(F=!1,p.cancelled){throw E(),new Error("cancelled")}I=void 0,z()})["catch"](function(U){throw F=!1,o("writeCheckpoint completed with error",U),U})}function O(){var T={};return I.changes.forEach(function(U){"_user/"!==U.id&&(T[U.id]=U.changes.map(function(V){return V.rev}))}),g.revsDiff(T).then(function(U){if(p.cancelled){throw E(),new Error("cancelled")}I.diffs=U})}function q(){return cS(R,I.diffs,p).then(function(T){T.forEach(function(U){delete I.diffs[U._id],w.docs_read++,I.docs.push(U)})})}function P(){if(!p.cancelled&&!I){if(0===B.length){return void A(!0)}I=B.shift(),O().then(q).then(s).then(i).then(P)["catch"](function(T){o("batch processing terminated with error",T)})}}function A(T){return 0===u.changes.length?void (0!==B.length||I||((C&&h.live||n)&&(p.state="pending",p.emit("paused")),n&&E())):void ((T||n||u.changes.length>=l)&&(B.push(u),u={seq:0,changes:[],docs:[]},("pending"===p.state||"stopped"===p.state)&&(p.state="active",p.emit("active")),P()))}function o(U,T){y||(T.message||(T.message=U),w.ok=!1,w.status="aborting",w.errors.push(T),k=k.concat(T),B=[],u={seq:0,changes:[],docs:[]},E())}function E(){if(!(y||p.cancelled&&(w.status="cancelled",F))){w.status=w.status||"complete",w.end_time=new Date,w.last_seq=J,y=!0;var U=k.filter(function(V){return"unauthorized"!==V.name&&"forbidden"!==V.name});if(U.length>0){var T=k.pop();k.length>0&&(T.other_errors=k),T.result=w,al(x,p,T,function(){ef(R,g,x,p)})}else{w.errors=k,p.emit("complete",w),p.removeAllListeners()}}}function v(U){if(p.cancelled){return E()}var T=jO(x)(U);T&&(u.seq=U.seq,u.changes.push(U),A(0===B.length))}function N(T){return Q=!1,p.cancelled?E():(T.results.length>0?(h.since=T.last_seq,z()):C?(h.live=!0,z()):n=!0,void A(!0))}function S(T){return Q=!1,p.cancelled?E():void o("changes rejected",T)}function z(){function V(){U.cancel()}function T(){p.removeListener("cancel",V)}if(!Q&&!n&&B.length<M){Q=!0,p._changes&&(p.removeListener("cancel",p._abortChanges),p._changes.cancel()),p.once("cancel",V);var U=R.changes(h).on("change",v);U.then(T,T),U.then(N)["catch"](S),x.retry&&(p._changes=U,p._abortChanges=V)}}function K(){D().then(function(){return p.cancelled?void E():G.getCheckpoint().then(function(T){J=T,h={since:J,limit:l,batch_size:l,style:"all_docs",doc_ids:H,return_docs:!0},x.filter&&("string"!=typeof x.filter?h.include_docs=!0:h.filter=x.filter),"heartbeat" in x&&(h.heartbeat=x.heartbeat),"timeout" in x&&(h.timeout=x.timeout),x.query_params&&(h.query_params=x.query_params),x.view&&(h.view=x.view),z()})})["catch"](function(T){o("getCheckpoint rejected with ",T)})}function r(T){throw F=!1,o("writeCheckpoint completed with error",T),T}var I,j,G,B=[],u={seq:0,changes:[],docs:[]},F=!1,n=!1,y=!1,J=0,C=x.continuous||x.live||!1,l=x.batch_size||100,M=x.batches_limit||10,Q=!1,H=x.doc_ids,k=[],L=[],m=ad();w=w||{ok:!0,start_time:new Date,docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var h={};return p.ready(R,g),p.cancelled?void E():(p._addedListeners||(p.once("cancel",E),"function"==typeof x.complete&&(p.once("error",x.complete),p.once("complete",function(T){x.complete(null,T)})),p._addedListeners=!0),void ("undefined"==typeof x.since?K():D().then(function(){return F=!0,G.writeCheckpoint(x.since,m)}).then(function(){return F=!1,p.cancelled?void E():(J=x.since,void K())})["catch"](r)))}function aO(){ax.EventEmitter.call(this),this.cancelled=!1,this.state="pending";var h=this,g=new dW(function(i,j){h.once("complete",i),h.once("error",j)});h.then=function(i,j){return g.then(i,j)},h["catch"]=function(i){return g["catch"](i)},h["catch"](function(){})}function di(i,h){var g=h.PouchConstructor;return"string"==typeof i?new g(i,h):i}function bf(m,k,g,l){if("function"==typeof g&&(l=g,g={}),"undefined"==typeof g&&(g={}),g.doc_ids&&!Array.isArray(g.doc_ids)){throw bw(bZ,"`doc_ids` filter parameter is not a list.")}g.complete=l,g=d4(g),g.continuous=g.continuous||g.live,g.retry="retry" in g?g.retry:!1,g.PouchConstructor=g.PouchConstructor||this;var i=new aO(g),j=di(m,g),h=di(k,g);return ef(j,h,g,i),i}function cP(i,g,j,h){return"function"==typeof j&&(h=j,j={}),"undefined"==typeof j&&(j={}),j=d4(j),j.PouchConstructor=j.PouchConstructor||this,i=eB.toPouch(i,j),g=eB.toPouch(g,j),new am(i,g,j,h)}function am(s,l,m,v){function k(z){q.emit("change",{direction:"pull",change:z})}function p(z){q.emit("change",{direction:"push",change:z})}function y(z){q.emit("denied",{direction:"push",doc:z})}function n(z){q.emit("denied",{direction:"pull",doc:z})}function i(){q.pushPaused=!0,q.pullPaused&&q.emit("paused")}function w(){q.pullPaused=!0,q.pushPaused&&q.emit("paused")}function r(){q.pushPaused=!1,q.pullPaused&&q.emit("active",{direction:"push"})}function o(){q.pullPaused=!1,q.pushPaused&&q.emit("active",{direction:"pull"})}function u(z){return function(D,A){var B="change"===D&&(A===k||A===p),F="denied"===D&&(A===n||A===y),C="paused"===D&&(A===w||A===i),E="active"===D&&(A===o||A===r);(B||F||C||E)&&(D in g||(g[D]={}),g[D][z]=!0,2===Object.keys(g[D]).length&&q.removeAllListeners(D))}}var q=this;this.canceled=!1;var x=m.push?eZ.extend({},m,m.push):m,h=m.pull?eZ.extend({},m,m.pull):m;this.push=cZ(s,l,x),this.pull=cZ(l,s,h),this.pushPaused=!0,this.pullPaused=!0;var g={};m.live&&(this.push.on("complete",q.pull.cancel.bind(q.pull)),this.pull.on("complete",q.push.cancel.bind(q.push))),this.on("newListener",function(z){"change"===z?(q.pull.on("change",k),q.push.on("change",p)):"denied"===z?(q.pull.on("denied",n),q.push.on("denied",y)):"active"===z?(q.pull.on("active",o),q.push.on("active",r)):"paused"===z&&(q.pull.on("paused",w),q.push.on("paused",i))}),this.on("removeListener",function(z){"change"===z?(q.pull.removeListener("change",k),q.push.removeListener("change",p)):"denied"===z?(q.pull.removeListener("denied",n),q.push.removeListener("denied",y)):"active"===z?(q.pull.removeListener("active",o),q.push.removeListener("active",r)):"paused"===z&&(q.pull.removeListener("paused",w),q.push.removeListener("paused",i))}),this.pull.on("removeListener",u("pull")),this.push.on("removeListener",u("push"));var j=dW.all([this.push,this.pull]).then(function(A){var z={push:A[0],pull:A[1]};return q.emit("complete",z),v&&v(null,z),q.removeAllListeners(),z},function(z){if(q.cancel(),v?v(z):q.emit("error",z),q.removeAllListeners(),v){throw z}});this.then=function(A,z){return j.then(A,z)},this["catch"]=function(z){return j["catch"](z)}}function dF(h,g){return jw(cz(h),g)}function aP(j){for(var h="",g=new Uint8Array(j),i=g.byteLength,k=0;i>k;k++){h+=String.fromCharCode(g[k])}return h}function e1(i,g){if("undefined"==typeof FileReader){return g(aP((new FileReaderSync).readAsArrayBuffer(i)))}var j=new FileReader,h="function"==typeof j.readAsBinaryString;j.onloadend=function(k){var l=k.target.result||"";return h?g(l):void g(aP(l))},h?j.readAsBinaryString(i):j.readAsArrayBuffer(i)}function d5(g){return new dW(function(h){e1(g,function(i){h(b1(i))})})}function fE(i){for(var g=[],j=0,h=i.length;h>j;j++){g=g.concat(i[j])}return g}function dP(h){var g=h.doc&&h.doc._attachments;g&&Object.keys(g).forEach(function(i){var j=g[i];j.data=dF(j.data,j.content_type)})}function dL(g){return/^_design/.test(g)?"_design/"+encodeURIComponent(g.slice(8)):/^_local/.test(g)?"_local/"+encodeURIComponent(g.slice(7)):encodeURIComponent(g)}function bR(g){return g._attachments&&Object.keys(g._attachments)?dW.all(Object.keys(g._attachments).map(function(h){var i=g._attachments[h];return i.data&&"string"!=typeof i.data?d5(i.data).then(function(j){i.data=j}):void 0})):dW.resolve()}function dH(i){var h=eS(i);(h.user||h.password)&&(h.auth={username:h.user,password:h.password});var g=h.path.replace(/(^\/|\/$)/g,"").split("/");return h.db=g.pop(),-1===h.db.indexOf("%")&&(h.db=encodeURIComponent(h.db)),h.path=g.join("/"),h}function fK(h,g){return b3(h,h.db+"/"+g)}function b3(i,h){var g=i.path?"/":"";return i.protocol+"://"+i.host+(i.port?":"+i.port:"")+"/"+i.path+g+h}function bC(g){return"?"+Object.keys(g).map(function(h){return h+"="+encodeURIComponent(g[h])}).join("&")}function dk(m,i){function g(z,x,w){var A=z.ajax||{},y=eZ.extend(d4(p),A,x);return bE(y.method+" "+y.url),e2.ajax(y,w)}function o(x,w){return new dW(function(z,y){g(x,w,function(A,B){return A?y(A):void z(B)})})}function q(x,w){return jQ(x,fO(function(y){k().then(function(z){return w.apply(this,y)})["catch"](function(z){var A=y.pop();A(z)})}))}function k(){if(m.skipSetup||m.skip_setup){return dW.resolve()}if(v){return v}var w={method:"GET",url:h};return v=o({},w)["catch"](function(x){return x&&x.status&&404===x.status?(aq(404,"PouchDB is just detecting if the remote exists."),o({},{method:"PUT",url:h})):dW.reject(x)})["catch"](function(x){return x&&x.status&&412===x.status?!0:dW.reject(x)}),v["catch"](function(){v=null}),v}function u(w){return w.split("/").map(encodeURIComponent).join("/")}var l=this,s=dH;m.getHost&&(s=m.getHost);var r=s(m.name,m),h=fK(r,"");m=d4(m);var p=m.ajax||{};if(l.getUrl=function(){return h},l.getHeaders=function(){return p.headers||{}},m.auth||r.auth){var j=m.auth||r.auth,n=b1(j.username+":"+j.password);p.headers=p.headers||{},p.headers.Authorization="Basic "+n}var v;setTimeout(function(){i(null,l)}),l.type=function(){return"http"},l.id=q("id",function(w){g({},{method:"GET",url:b3(r,"")},function(y,x){var z=x&&x.uuid?x.uuid+r.db:fK(r,"");w(null,z)})}),l.request=q("request",function(x,w){x.url=fK(r,x.url),g({},x,w)}),l.compact=q("compact",function(x,w){"function"==typeof x&&(w=x,x={}),x=d4(x),g(x,{url:fK(r,"_compact"),method:"POST"},function(){function y(){l.info(function(z,A){A&&!A.compact_running?w(null,{ok:!0}):setTimeout(y,x.interval||200)})}y()})}),l.bulkGet=jQ("bulkGet",function(y,A){function B(E){var D={};y.revs&&(D.revs=!0),y.attachments&&(D.attachments=!0),g({},{url:fK(r,"_bulk_get"+bC(D)),method:"POST",body:{docs:y.docs}},E)}function z(){function I(K){return function(M,L){E[K]=L.results,++J===G&&A(null,{results:fE(E)})}}for(var F=bU,G=Math.ceil(y.docs.length/F),J=0,E=new Array(G),D=0;G>D;D++){var H=fN(y,["revs","attachments"]);H.docs=y.docs.slice(D*F,Math.min(y.docs.length,(D+1)*F)),c4(w,H,I(D))}}var w=this,C=b3(r,""),x=cA[C];"boolean"!=typeof x?B(function(D,E){if(D){var F=Math.floor(D.status/100);4===F||5===F?(cA[C]=!1,aq(D.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),z()):A(D)}else{cA[C]=!0,A(null,E)}}):x?B(A):z()}),l._info=function(w){k().then(function(){g({},{method:"GET",url:fK(r,"")},function(y,x){return y?w(y):(x.host=fK(r,""),void w(null,x))})})["catch"](w)},l.get=q("get",function(y,A,B){function z(E){var F=E._attachments,D=F&&Object.keys(F);return F&&D.length?dW.all(D.map(function(I){var G=F[I],H=dL(E._id)+"/"+u(I)+"?rev="+E._rev;return o(A,{method:"GET",url:fK(r,H),binary:!0}).then(function(J){return A.binary?J:d5(J)}).then(function(J){delete G.stub,delete G.length,G.data=J})})):void 0}function w(D){return Array.isArray(D)?dW.all(D.map(function(E){return E.ok?z(E.ok):void 0})):z(D)}"function"==typeof A&&(B=A,A={}),A=d4(A);var x={};A.revs&&(x.revs=!0),A.revs_info&&(x.revs_info=!0),A.open_revs&&("all"!==A.open_revs&&(A.open_revs=JSON.stringify(A.open_revs)),x.open_revs=A.open_revs),A.rev&&(x.rev=A.rev),A.conflicts&&(x.conflicts=A.conflicts),y=dL(y);var C={method:"GET",url:fK(r,y+bC(x))};o(A,C).then(function(D){return dW.resolve().then(function(){return A.attachments?w(D):void 0}).then(function(){B(null,D)})})["catch"](B)}),l.remove=q("remove",function(A,z,B,x){var y;"string"==typeof z?(y={_id:A,_rev:z},"function"==typeof B&&(x=B,B={})):(y=A,"function"==typeof z?(x=z,B={}):(x=B,B=z));var w=y._rev||B.rev;g(B,{method:"DELETE",url:fK(r,dL(y._id))+"?rev="+w},x)}),l.getAttachment=q("getAttachment",function(A,B,x,z){"function"==typeof x&&(z=x,x={});var y=x.rev?"?rev="+x.rev:"",w=fK(r,dL(A))+"/"+u(B)+y;g(x,{method:"GET",url:w,binary:!0},z)}),l.removeAttachment=q("removeAttachment",function(z,x,y,w){var A=fK(r,dL(z)+"/"+u(x))+"?rev="+y;g({},{method:"DELETE",url:A},w)}),l.putAttachment=q("putAttachment",function(F,x,z,B,C,y){"function"==typeof C&&(y=C,C=B,B=z,z=null);var w=dL(F)+"/"+u(x),E=fK(r,w);if(z&&(E+="?rev="+z),"string"==typeof B){var D;try{D=cz(B)}catch(A){return y(bw(dd,"Attachment is not a valid base64 string"))}B=D?jw(D,C):""}var G={headers:{"Content-Type":C},method:"PUT",url:E,processData:!1,body:B,timeout:p.timeout||60000};g({},G,y)}),l._bulkDocs=function(y,w,x){y.new_edits=w.new_edits,k().then(function(){return dW.all(y.docs.map(bR))}).then(function(){g(w,{method:"POST",url:fK(r,"_bulk_docs"),body:y},function(A,z){return A?x(A):(z.forEach(function(B){B.ok=!0}),void x(null,z))})})["catch"](x)},l.allDocs=q("allDocs",function(y,B){"function"==typeof y&&(B=y,y={}),y=d4(y);var A,z={},w="GET";y.conflicts&&(z.conflicts=!0),y.descending&&(z.descending=!0),y.include_docs&&(z.include_docs=!0),y.attachments&&(z.attachments=!0),y.key&&(z.key=JSON.stringify(y.key)),y.start_key&&(y.startkey=y.start_key),y.startkey&&(z.startkey=JSON.stringify(y.startkey)),y.end_key&&(y.endkey=y.end_key),y.endkey&&(z.endkey=JSON.stringify(y.endkey)),"undefined"!=typeof y.inclusive_end&&(z.inclusive_end=!!y.inclusive_end),"undefined"!=typeof y.limit&&(z.limit=y.limit),"undefined"!=typeof y.skip&&(z.skip=y.skip);var C=bC(z);if("undefined"!=typeof y.keys){var x="keys="+encodeURIComponent(JSON.stringify(y.keys));x.length+C.length+1<=jZ?C+="&"+x:(w="POST",A={keys:y.keys})}o(y,{method:w,url:fK(r,"_all_docs"+C),body:A}).then(function(D){y.include_docs&&y.attachments&&y.binary&&D.rows.forEach(dP),B(null,D)})["catch"](B)}),l._changes=function(J){var H="batch_size" in J?J.batch_size:aG;J=d4(J),J.timeout="timeout" in J?J.timeout:"timeout" in p?p.timeout:30000;var y,B=J.timeout?{timeout:J.timeout-5000}:{},F="undefined"!=typeof J.limit?J.limit:!1;y="return_docs" in J?J.return_docs:"returnDocs" in J?J.returnDocs:!0;var x=F;if(J.style&&(B.style=J.style),(J.include_docs||J.filter&&"function"==typeof J.filter)&&(B.include_docs=!0),J.attachments&&(B.attachments=!0),J.continuous&&(B.feed="longpoll"),J.conflicts&&(B.conflicts=!0),J.descending&&(B.descending=!0),"heartbeat" in J?J.heartbeat&&(B.heartbeat=J.heartbeat):B.heartbeat=10000,J.filter&&"string"==typeof J.filter&&(B.filter=J.filter,"_view"===J.filter&&J.view&&"string"==typeof J.view&&(B.view=J.view)),J.query_params&&"object"==typeof J.query_params){for(var z in J.query_params){J.query_params.hasOwnProperty(z)&&(B[z]=J.query_params[z])}}var G,C="GET";if(J.doc_ids){B.filter="_doc_ids";var K=JSON.stringify(J.doc_ids);K.length<jZ?B.doc_ids=K:(C="POST",G={doc_ids:J.doc_ids})}var I,A,w=function(M,L){if(!J.aborted){B.since=M,"object"==typeof B.since&&(B.since=JSON.stringify(B.since)),J.descending?F&&(B.limit=x):B.limit=!F||x>H?H:x;var N={method:C,url:fK(r,"_changes"+bC(B)),timeout:J.timeout,body:G};A=M,J.aborted||k().then(function(){I=g(J,N,L)})["catch"](L)}},D={results:[]},E=function(P,M){if(!J.aborted){var L=0;if(M&&M.results){L=M.results.length,D.last_seq=M.last_seq;var N={};N.query=J.query_params,M.results=M.results.filter(function(Q){x--;var R=jO(J)(Q);return R&&(J.include_docs&&J.attachments&&J.binary&&dP(Q),y&&D.results.push(Q),J.onChange(Q)),R})}else{if(P){return J.aborted=!0,void J.complete(P)}}M&&M.last_seq&&(A=M.last_seq);var O=F&&0>=x||M&&H>L||J.descending;(!J.continuous||F&&0>=x)&&O?J.complete(null,D):setTimeout(function(){w(A,E)},0)}};return w(J.since||0,E),{cancel:function(){J.aborted=!0,I&&I.abort()}}},l.revsDiff=q("revsDiff",function(y,w,x){"function"==typeof w&&(x=w,w={}),g(w,{method:"POST",url:fK(r,"_revs_diff"),body:y},x)}),l._close=function(w){w()},l._destroy=function(w,x){g(w,{url:fK(r,""),method:"DELETE"},function(z,y){return z&&z.status&&404!==z.status?x(z):(l.emit("destroyed"),l.constructor.emit("destroyed",m.name),void x(null,y))})}}function aY(){this.promise=new dW(function(g){g()})}function dO(g){return bL.hash(g)}function cg(m){var j=m.db,g=m.viewName,l=m.map,n=m.reduce,i=m.temporary,h=l.toString()+(n&&n.toString())+"undefined";if(!i&&j._cachedViews){var k=j._cachedViews[h];if(k){return dW.resolve(k)}}return j.info().then(function(p){function o(u){u.views=u.views||{};var r=g;-1===r.indexOf("/")&&(r=g+"/"+g);var s=u.views[r]=u.views[r]||{};if(!s[q]){return s[q]=!0,u}}var q=p.db_name+"-mrview-"+(i?"temp":dO(h));return cs(j,"_local/mrviews",o).then(function(){return j.registerDependentDatabase(q).then(function(s){var u=s.db;u.auto_compaction=!0;var r={name:q,db:u,sourceDB:j,adapter:j.adapter,mapFun:l,reduceFun:n};return r.db.get("_local/lastSeq")["catch"](function(v){if(404!==v.status){throw v}}).then(function(v){return r.seq=v?v.seq:0,i||(j._cachedViews=j._cachedViews||{},j._cachedViews[h]=r,r.db.once("destroyed",function(){delete j._cachedViews[h]})),r})})})})}function dY(k,i,h,j,l,g){return aZ("return ("+k.replace(/;\s*$/,"")+");",{emit:i,sum:h,log:j,isArray:l,toJSON:g})}function cK(g){return -1===g.indexOf("/")?[g,g]:g.split("/")}function ed(g){return 1===g.length&&/^1-/.test(g[0].rev)}function b5(i,h){try{i.emit("error",h)}catch(g){console.error("The user's map/reduce function threw an uncaught error.\nYou can debug this error by doing:\nmyDatabase.on('error', function (err) { debugger; });\nPlease double-check your map/reduce function."),console.error(h)}}function aM(i,g,j){try{return{output:g.apply(null,j)}}catch(h){return b5(i,h),{error:h}}}function cU(i,h){var g=e5(i.key,h.key);return 0!==g?g:e5(i.value,h.value)}function dR(i,h,g){return g=g||0,"number"==typeof h?i.slice(g,h+g):g>0?i.slice(g):i}function dZ(i){var h=i.value,g=h&&"object"==typeof h&&h._id||i.id;return g}function jx(g){g.rows.forEach(function(i){var h=i.doc&&i.doc._attachments;h&&Object.keys(h).forEach(function(j){var k=h[j];h[j].data=dF(k.data,k.content_type)})})}function dT(g){return function(h){return g.include_docs&&g.attachments&&g.binary&&jx(h),h}}function bB(h){var g="builtin "+h+" function requires map values to be numbers or number arrays";return new aE(g)}function bJ(m){for(var j=0,g=0,l=m.length;l>g;g++){var n=m[g];if("number"!=typeof n){if(!Array.isArray(n)){throw bB("_sum")}j="number"==typeof j?[j]:j;for(var i=0,h=n.length;h>i;i++){var k=n[i];if("number"!=typeof k){throw bB("_sum")}"undefined"==typeof j[i]?j.push(k):j[i]+=k}}else{"number"==typeof j?j+=n:j[0]+=n}}return j}function cY(j,h,g,i){var k=h[j];"undefined"!=typeof k&&(i&&(k=encodeURIComponent(JSON.stringify(k))),g.push(j+"="+k))}function ci(h){if("undefined"!=typeof h){var g=Number(h);return isNaN(g)||g!==parseInt(h,10)?h:g}}function bc(g){return g.group_level=ci(g.group_level),g.limit=ci(g.limit),g.skip=ci(g.skip),g}function ek(g){if(g){if("number"!=typeof g){return new bz('Invalid value for integer: "'+g+'"')}if(0>g){return new bz('Invalid value for positive integer: "'+g+'"')}}}function eL(i,g){var j=i.descending?"endkey":"startkey",h=i.descending?"startkey":"endkey";if("undefined"!=typeof i[j]&&"undefined"!=typeof i[h]&&e5(i[j],i[h])>0){throw new bz("No rows can match your key range, reverse your start_key and end_key or set {descending : true}")}if(g.reduce&&i.reduce!==!1){if(i.include_docs){throw new bz("{include_docs:true} is invalid for reduce")}if(i.keys&&i.keys.length>1&&!i.group&&!i.group_level){throw new bz("Multi-key fetches for reduce views must use {group: true}")}}["group_level","limit","skip"].forEach(function(k){var l=ek(i[k]);if(l){throw l}})}function eW(j,l,h){var n,i=[],k="GET";if(cY("reduce",h,i),cY("include_docs",h,i),cY("attachments",h,i),cY("limit",h,i),cY("descending",h,i),cY("group",h,i),cY("group_level",h,i),cY("skip",h,i),cY("stale",h,i),cY("conflicts",h,i),cY("startkey",h,i,!0),cY("start_key",h,i,!0),cY("endkey",h,i,!0),cY("end_key",h,i,!0),cY("inclusive_end",h,i),cY("key",h,i,!0),i=i.join("&"),i=""===i?"":"?"+i,"undefined"!=typeof h.keys){var m=2000,g="keys="+encodeURIComponent(JSON.stringify(h.keys));g.length+i.length+1<=m?i+=("?"===i[0]?"&":"?")+g:(k="POST","string"==typeof l?n={keys:h.keys}:l.keys=h.keys)}if("string"==typeof l){var o=cK(l);return j.request({method:k,url:"_design/"+o[0]+"/_view/"+o[1]+i,body:n}).then(dT(h))}return n=n||{},Object.keys(l).forEach(function(p){Array.isArray(l[p])?n[p]=l[p]:n[p]=l[p].toString()}),j.request({method:"POST",url:"_temp_view"+i,body:n}).then(dT(h))}function bV(i,h,g){return new dW(function(j,k){i._query(h,g,function(m,l){return m?k(m):void j(l)})})}function dN(g){return new dW(function(h,i){g._viewCleanup(function(k,j){return k?i(k):void h(j)})})}function b9(g){return function(h){if(404===h.status){return g}throw h}}function c8(k,p,j){function h(){return ed(q)?dW.resolve(n):p.db.get(l)["catch"](b9(n))}function g(r){return r.keys.length?p.db.allDocs({keys:r.keys,include_docs:!0}):dW.resolve({rows:[]})}function i(y,A){for(var u=[],r={},v=0,x=A.rows.length;x>v;v++){var z=A.rows[v],s=z.doc;if(s&&(u.push(s),r[s._id]=!0,s._deleted=!m[s._id],!s._deleted)){var B=m[s._id];"value" in B&&(s.value=B.value)}}var w=Object.keys(m);return w.forEach(function(C){if(!r[C]){var E={_id:C},D=m[C];"value" in D&&(E.value=D.value),u.push(E)}}),y.keys=bx(w.concat(y.keys)),u.push(y),u}var l="_local/doc_"+k,n={_id:l,keys:[]},o=j[k],m=o.indexableKeysToKeyValues,q=o.changes;return h().then(function(r){return g(r).then(function(s){return i(r,s)})})}function e0(i,g,j){var h="_local/lastSeq";return i.db.get(h)["catch"](b9({_id:h,seq:0})).then(function(k){var l=Object.keys(g);return dW.all(l.map(function(m){return c8(m,i,g)})).then(function(m){var n=fE(m);return k.seq=j,n.push(k),i.db.bulkDocs({docs:n})})})}function cl(i){var h="string"==typeof i?i:i.name,g=e4[h];return g||(g=e4[h]=new aY),g}function aF(g){return aN(cl(g),function(){return cq(g)})()}function cq(j){function l(p,r){var q={id:i._id,key:cf(p)};"undefined"!=typeof r&&null!==r&&(q.value=cf(r)),n.push(q)}function h(q,p){return function(){return e0(j,q,p)}}var n,i,k;if("function"==typeof j.mapFun&&2===j.mapFun.length){var m=j.mapFun;k=function(p){return m(p,l)}}else{k=dY(j.mapFun.toString(),l,bJ,cR,Array.isArray,JSON.parse)}var g=j.seq||0,o=new aY;return new dW(function(p,s){function r(){o.finish().then(function(){j.seq=g,p()})}function q(){function u(v){s(v)}j.sourceDB.changes({conflicts:!0,include_docs:!0,style:"all_docs",since:g,limit:dD}).on("complete",function(F){var A=F.results;if(!A.length){return r()}for(var D={},x=0,v=A.length;v>x;x++){var C=A[x];if("_"!==C.doc._id[0]){n=[],i=C.doc,i._deleted||aM(j.sourceDB,k,[i]),n.sort(cU);for(var B,H={},z=0,G=n.length;G>z;z++){var w=n[z],y=[w.key,w.id];0===e5(w.key,B)&&y.push(z);var E=av(y);H[E]=w,B=w.key}D[C.doc._id]={indexableKeysToKeyValues:H,changes:C.changes}}g=C.seq}return o.add(h(D,g)),A.length<dD?r():q()}).on("error",u)}q()})}function au(k,p,j){0===j.group_level&&delete j.group_level;var h,g=j.group||j.group_level;h=eG[k.reduceFun]?eG[k.reduceFun]:dY(k.reduceFun.toString(),null,bJ,cR,Array.isArray,JSON.parse);var i=[],l=j.group_level;p.forEach(function(r){var u=i[i.length-1],s=g?r.key:null;return g&&Array.isArray(s)&&"number"==typeof l&&(s=s.length>l?s.slice(0,l):s),u&&0===e5(u.key[0][0],s)?(u.key.push([s,r.id]),void u.value.push(r.value)):void i.push({key:[[s,r.id]],value:[r.value]})});for(var n=0,o=i.length;o>n;n++){var m=i[n],q=aM(k.sourceDB,h,[m.key,m.value,!1]);if(q.error&&q.error instanceof aE){throw q.error}m.value=q.error?null:q.output,m.key=m.key[0][0]}return{rows:dR(i,j.limit,j.skip)}}function cv(h,g){return aN(cl(h),function(){return db(h,g)})()}function db(r,s){function i(u){return u.include_docs=!0,r.db.allDocs(u).then(function(v){return h=v.total_rows,v.rows.map(function(x){if("value" in x.doc&&"object"==typeof x.doc.value&&null!==x.doc.value){var z=Object.keys(x.doc.value).sort(),y=["id","key","value"];if(!(y>z||z>y)){return x.doc.value}}var w=bv(x.doc._id);return{key:w[0],id:w[1],value:"value" in x.doc?x.doc.value:null}})})}function g(v){var u;if(u=k?au(r,v,s):{total_rows:h,offset:p,rows:v},s.include_docs){var w=bx(v.map(dZ));return r.sourceDB.allDocs({keys:w,include_docs:!0,conflicts:s.conflicts,attachments:s.attachments,binary:s.binary}).then(function(x){var y={};return x.rows.forEach(function(z){z.doc&&(y["$"+z.id]=z.doc)}),v.forEach(function(A){var B=dZ(A),z=y["$"+B];z&&(A.doc=z)}),u})}return u}var h,k=r.reduceFun&&s.reduce!==!1,p=s.skip||0;if("undefined"==typeof s.keys||s.keys.length||(s.limit=0,delete s.keys),"undefined"!=typeof s.keys){var l=s.keys,q=l.map(function(v){var u={startkey:av([v]),endkey:av([v,{}])};return i(u)});return dW.all(q).then(fE).then(g)}var o={descending:s.descending};if(s.start_key&&(s.startkey=s.start_key),s.end_key&&(s.endkey=s.end_key),"undefined"!=typeof s.startkey&&(o.startkey=av(s.descending?[s.startkey,{}]:[s.startkey])),"undefined"!=typeof s.endkey){var m=s.inclusive_end!==!1;s.descending&&(m=!m),o.endkey=av(m?[s.endkey,{}]:[s.endkey])}if("undefined"!=typeof s.key){var j=av([s.key]),n=av([s.key,{}]);o.descending?(o.endkey=j,o.startkey=n):(o.startkey=j,o.endkey=n)}return k||("number"==typeof s.limit&&(o.limit=s.limit),o.skip=p),i(o).then(g)}function ag(g){return g.request({method:"POST",url:"_view_cleanup"})}function b8(g){return g.get("_local/mrviews").then(function(h){var j={};Object.keys(h.views).forEach(function(m){var k=cK(m),l="_design/"+k[0],n=k[1];j[l]=j[l]||{},j[l][n]=!0});var i={keys:Object.keys(j),include_docs:!0};return g.allDocs(i).then(function(m){var n={};m.rows.forEach(function(p){var o=p.key.substring(8);Object.keys(j[p.key]).forEach(function(u){var r=o+"/"+u;h.views[r]||(r=u);var q=Object.keys(h.views[r]),s=p.doc&&p.doc.views&&p.doc.views[u];q.forEach(function(v){n[v]=n[v]||s})})});var l=Object.keys(n).filter(function(o){return !n[o]}),k=l.map(function(o){return aN(cl(o),function(){return new g.constructor(o,g.__opts).destroy()})()});return dW.all(k).then(function(){return{ok:!0}})})},b9({ok:!0}))}function dE(n,k,m){if("http"===n.type()){return eW(n,k,m)}if("function"==typeof n._query){return bV(n,k,m)}if("string"!=typeof k){eL(m,k);var g={db:n,viewName:"temp_view/temp_view",map:k.map,reduce:k.reduce,temporary:!0};return fC.add(function(){return cg(g).then(function(o){function p(){return o.db.destroy()}return dG(aF(o).then(function(){return cv(o,m)}),p)})}),fC.finish()}var j=k,h=cK(j),l=h[0],i=h[1];return n.get("_design/"+l).then(function(o){var p=o.views&&o.views[i];if(!p||"string"!=typeof p.map){throw new aw("ddoc "+l+" has no view named "+i)}eL(m,p);var q={db:n,viewName:j,map:p.map,reduce:p.reduce};return cg(q).then(function(r){return"ok"===m.stale||"update_after"===m.stale?("update_after"===m.stale&&by.nextTick(function(){aF(r)}),cv(r,m)):aF(r).then(function(){return cv(r,m)})})})}function bz(h){this.status=400,this.name="query_parse_error",this.message=h,this.error=!0;try{Error.captureStackTrace(this,bz)}catch(g){}}function aw(h){this.status=404,this.name="not_found",this.message=h,this.error=!0;try{Error.captureStackTrace(this,aw)}catch(g){}}function aE(h){this.status=500,this.name="invalid_value",this.message=h,this.error=!0;try{Error.captureStackTrace(this,aE)}catch(g){}}function eM(g){return"'"+g+"'"}function bI(g){return g.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"")}function dM(g){return g.replace(/\u0001\u0001/g,"\x00").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,"")}function jL(g){return delete g._id,delete g._rev,JSON.stringify(g)}function bA(i,h,g){return i=JSON.parse(i),i._id=h,i._rev=g,i}function cX(h){for(var g="(";h--;){g+="?",h&&(g+=",")}return g+")"}function cL(j,h,g,i,k){return"SELECT "+j+" FROM "+("string"==typeof h?h:h.join(" JOIN "))+(g?" ON "+g:"")+(i?" WHERE "+("string"==typeof i?i:i.join(" AND ")):"")+(k?" ORDER BY "+k:"")}function bk(m,k,g){function l(){++j===m.length&&i()}function i(){if(h.length){var n="SELECT DISTINCT digest AS digest FROM "+dJ+" WHERE seq IN "+cX(h.length);g.executeSql(n,h,function(q,o){for(var s=[],p=0;p<o.rows.length;p++){s.push(o.rows.item(p).digest)}if(s.length){var r="DELETE FROM "+dJ+" WHERE seq IN ("+h.map(function(){return"?"}).join(",")+")";q.executeSql(r,h,function(v){var u="SELECT digest FROM "+dJ+" WHERE digest IN ("+s.map(function(){return"?"}).join(",")+")";v.executeSql(u,s,function(z,w){for(var y=new ay.Set,x=0;x<w.rows.length;x++){y.add(w.rows.item(x).digest)}s.forEach(function(A){y.has(A)||(z.executeSql("DELETE FROM "+dJ+" WHERE digest=?",[A]),z.executeSql("DELETE FROM "+j2+" WHERE digest=?",[A]))})})})}})}}if(m.length){var j=0,h=[];m.forEach(function(o){var n="SELECT seq FROM "+jF+" WHERE doc_id=? AND rev=?";g.executeSql(n,[k,o],function(q,p){if(!p.rows.length){return l()}var r=p.rows.item(0).seq;h.push(r),q.executeSql("DELETE FROM "+jF+" WHERE seq=?",[r],l)})})}}function t(g){return function(h){console.error("WebSQL threw an error",h);var k=h&&h.constructor.toString().match(/function ([^\(]+)/),i=k&&k[1]||h.type,j=h.target||h.message;g(bw(cp,j,i))}}function b7(h){if("size" in h){return 1000000*h.size}var g=/Android/.test(window.navigator.userAgent);return g?5000000:1}function j1(){return"undefined"!=typeof sqlitePlugin?sqlitePlugin.openDatabase.bind(sqlitePlugin):"undefined"!=typeof openDatabase?function(g){return openDatabase(g.name,g.version,g.description,g.size)}:void 0}function bF(i,h){try{return{db:i(h)}}catch(g){return{error:g}}}function d1(i){var h=cO[i.name];if(!h){var g=j1();h=cO[i.name]=bF(g,i),h.db&&(h.db._sqlitePlugin="undefined"!=typeof sqlitePlugin)}return h}function cM(){return"undefined"!=typeof openDatabase||"undefined"!=typeof SQLitePlugin}function jK(g){jy()?chrome.storage.onChanged.addListener(function(h){null!=h.db_name&&g.emit(h.dbName.newValue)}):aB()&&("undefined"!=typeof addEventListener?addEventListener("storage",function(h){g.emit(h.key)}):window.attachEvent("storage",function(h){g.emit(h.key)}))}function bs(){ax.EventEmitter.call(this),this._listeners={},jK(this)}function jv(g){return decodeURIComponent(window.escape(g))}function fI(g){return 65>g?g-48:g-55}function jM(i,g,j){for(var h="";j>g;){h+=String.fromCharCode(fI(i.charCodeAt(g++))<<4|fI(i.charCodeAt(g++)))}return h}function aW(i,g,j){for(var h="";j>g;){h+=String.fromCharCode(fI(i.charCodeAt(g+2))<<12|fI(i.charCodeAt(g+3))<<8|fI(i.charCodeAt(g))<<4|fI(i.charCodeAt(g+1))),g+=4}return h}function dl(h,g){return"UTF-8"===g?jv(jM(h,0,h.length)):aW(h,0,h.length)}function bh(h){try{return JSON.parse(h)}catch(g){return cQ.parse(h)}}function fQ(h){try{return JSON.stringify(h)}catch(g){return cQ.stringify(h)}}function bT(l,i,n){function k(p){try{return cz(p)}catch(o){var q=bw(dd,"Attachment is not a valid base64 string");return{error:q}}}function m(o,q){if(o.stub){return q()}if("string"==typeof o.data){var p=k(o.data);if(p.error){return q(p.error)}o.length=p.length,"blob"===i?o.data=jw(p,o.content_type):"base64"===i?o.data=b1(p):o.data=p,bq(p).then(function(r){o.digest="md5-"+r,q()})}else{eU(o.data,function(r){"binary"===i?o.data=aP(r):"base64"===i&&(o.data=b1(aP(r))),bq(r).then(function(s){o.digest="md5-"+s,o.length=r.byteLength,q()})})}}function g(){h++,l.length===h&&(j?n(j):n())}if(!l.length){return n()}var j,h=0;l.forEach(function(r){function p(u){j=u,q++,q===s.length&&g()}var s=r.data&&r.data._attachments?Object.keys(r.data._attachments):[],q=0;if(!s.length){return g()}for(var o in r.data._attachments){r.data._attachments.hasOwnProperty(o)&&m(r.data._attachments[o],p)}})}function eb(h,g){return h.pos-g.pos}function el(k,i,h){for(var j,l=0,g=k.length;g>l;){j=l+g>>>1,h(k[j],i)<0?l=j+1:g=j}return l}function aD(i,g,j){var h=el(i,g,j);i.splice(h,0,g)}function bg(m,j){for(var g,l,n=j,i=m.length;i>n;n++){var h=m[n],k=[h.id,h.opts,[]];l?(l[2].push(k),l=k):g=l=k}return g}function eQ(h,g){return h[0]<g[0]?-1:1}function cm(m,g){for(var k=[{tree1:m,tree2:g}],i=!1;k.length>0;){var j=k.pop(),l=j.tree1,o=j.tree2;(l[1].status||o[1].status)&&(l[1].status="available"===l[1].status||"available"===o[1].status?"available":"missing");for(var h=0;h<o[2].length;h++){if(l[2][0]){for(var p=!1,n=0;n<l[2].length;n++){l[2][n][0]===o[2][h][0]&&(k.push({tree1:l[2][n],tree2:o[2][h]}),p=!0)}p||(i="new_branch",aD(l[2],o[2][h],eQ))}else{i="new_leaf",l[2][0]=o[2][h]}}}return{conflicts:i,tree:m}}function jp(x,r,v){var q,k=[],m=!1,A=!1;if(!x.length){return{tree:[r],conflicts:"new_leaf"}}for(var u=0,j=x.length;j>u;u++){var s=x[u];if(s.pos===r.pos&&s.ids[0]===r.ids[0]){q=cm(s.ids,r.ids),k.push({pos:s.pos,ids:q.tree}),m=m||q.conflicts,A=!0}else{if(v!==!0){var p=s.pos<r.pos?s:r,z=s.pos<r.pos?r:s,y=z.pos-p.pos,n=[],i=[];for(i.push({ids:p.ids,diff:y,parent:null,parentIdx:null});i.length>0;){var h=i.pop();if(0!==h.diff){for(var g=h.ids[2],o=0,w=g.length;w>o;o++){i.push({ids:g[o],diff:h.diff-1,parent:h.ids,parentIdx:o})}}else{h.ids[0]===z.ids[0]&&n.push(h)}}var l=n[0];l?(q=cm(l.ids,z.ids),l.parent[2][l.parentIdx]=q.tree,k.push({pos:p.pos,ids:p.ids}),m=m||q.conflicts,A=!0):k.push(s)}else{k.push(s)}}}return A||k.push(r),k.sort(eb),{tree:k,conflicts:m||"internal_node"}}function bY(m,g){for(var k,i=jS(m),j=0,l=i.length;l>j;j++){var o=i[j],h=o.ids,p=Math.max(0,h.length-g),n={pos:o.pos+p,ids:bg(h,p)};k=k?jp(k,n,!0).tree:[n]}return k}function dz(i,g,j){var h=jp(i,g);return{tree:bY(h.tree,j),conflicts:h.conflicts}}function ap(m,g){for(var k,i=m.slice(),j=g.split("-"),l=parseInt(j[0],10),o=j[1];k=i.pop();){if(k.pos===l&&k.ids[0]===o){return !0}for(var h=k.ids[2],p=0,n=h.length;n>p;p++){i.push({pos:k.pos+1,ids:h[p]})}}return !1}function cF(B,j,n,p,m,v,u,s){if(ap(j.rev_tree,n.metadata.rev)){return p[m]=n,v()}var k=j.winningRev||jo(j),i="deleted" in j?j.deleted:dA(j,k),w="deleted" in n.metadata?n.metadata.deleted:dA(n.metadata),l=/^1-/.test(n.metadata.rev);if(i&&!w&&s&&l){var x=n.data;x._rev=k,x._id=n.metadata.id,n=dj(x,s)}var g=dz(j.rev_tree,n.metadata.rev_tree[0],B),q=s&&(i&&w||!i&&"new_leaf"!==g.conflicts||i&&!w&&"new_branch"===g.conflicts);if(q){var z=bw(dB);return p[m]=z,v()}var h=n.metadata.rev;n.metadata.rev_tree=g.tree,j.rev_map&&(n.metadata.rev_map=j.rev_map);var A,y=jo(n.metadata),r=dA(n.metadata,y),o=i===r?0:r>i?-1:1;A=h===y?r:dA(n.metadata,h),u(n,y,r,A,!0,o,m,v)}function ak(g){return"missing"===g.metadata.rev_tree[0].ids[1].status}function eV(m,i,g,o,q,k,u,l,s){function r(C,B,x){var w=jo(C.metadata),D=dA(C.metadata,w);if("was_delete" in l&&D){return k[B]=bw(c3,"deleted"),x()}var A=p&&ak(C);if(A){var z=bw(dB);return k[B]=z,x()}var y=D?0:1;u(C,w,D,D,!1,y,B,x)}function h(){++n===v&&s&&s()}m=m||1000;var p=l.new_edits,j=new ay.Map,n=0,v=i.length;i.forEach(function(y,w){if(y._id&&dK(y._id)){var x=y._deleted?"_removeLocal":"_putLocal";return void g[x](y,{ctx:q},function(B,A){k[w]=B||A,h()})}var z=y.metadata.id;j.has(z)?(v--,j.get(z).push([y,w])):j.set(z,[[y,w]])}),j.forEach(function(x,z){function y(){++w<x.length?A():h()}function A(){var C=x[w],D=C[0],E=C[1];if(o.has(z)){cF(m,o.get(z),D,k,E,y,u,p)}else{var B=dz([],D.metadata.rev_tree[0],m);D.metadata.rev_tree=B.tree,r(D,E,y)}}var w=0;A()})}function cd(h){var g=[];return fH(h.rev_tree,function(l,i,k,m,j){"available"!==j.status||l||(g.push(i+"-"+k),j.status="missing")}),g}function aA(j,g,o,q,m,B,y){function i(){return r?y(r):(B.notify(q._name),q._docCount=-1,void y(null,A))}function z(E,D){var F="SELECT count(*) as cnt FROM "+j2+" WHERE digest=?";p.executeSql(F,[E],function(G,H){if(0===H.rows.item(0).cnt){var I=bw(eE,"unknown stub attachment with digest "+E);D(I)}else{D()}})}function x(F){function D(){++G===H.length&&F(E)}var H=[];if(h.forEach(function(I){I.data&&I.data._attachments&&Object.keys(I.data._attachments).forEach(function(J){var K=I.data._attachments[J];K.stub&&H.push(K.digest)})}),!H.length){return F()}var E,G=0;H.forEach(function(I){z(I,function(J){J&&!E&&(E=J),D()})})}function v(J,F,M,I,D,O,H,S){function L(){function U(a0,ao){function ai(){return ++at===a1.length&&ao(),!1}function an(a4){var a2="INSERT INTO "+dJ+" (digest, seq) VALUES (?,?)",a3=[V._attachments[a4].digest,a0];p.executeSql(a2,a3,ai,ai)}var at=0,a1=Object.keys(V._attachments||{});if(!a1.length){return ao()}for(var ar=0;ar<a1.length;ar++){an(a1[ar])}}var V=J.data,Z=I?1:0,Y=V._id,ae=V._rev,X=jL(V),W="INSERT INTO "+jF+" (doc_id, rev, json, deleted) VALUES (?, ?, ?, ?);",T=[Y,ae,X,Z];p.executeSql(W,T,function(ai,ao){var an=ao.insertId;U(an,function(){G(ai,an)})},function(){var ai=cL("seq",jF,null,"doc_id=? AND rev=?");return p.executeSql(ai,[Y,ae],function(ar,ao){var at=ao.rows.item(0).seq,a0="UPDATE "+jF+" SET json=?, deleted=? WHERE doc_id=? AND rev=?;",an=[X,Z,Y,ae];ar.executeSql(a0,an,function(a1){U(at,function(){G(a1,at)})})}),!1})}function E(T){R||(T?(R=T,S(R)):N===P.length&&L())}function Q(T){N++,E(T)}function K(){if(D&&q.auto_compaction){var T=J.metadata.id,U=cd(J.metadata);bk(U,T,p)}}function G(V,T){K(),J.metadata.seq=T,delete J.metadata.rev;var X=D?"UPDATE "+bN+" SET json=?, max_seq=?, winningseq=(SELECT seq FROM "+jF+" WHERE doc_id="+bN+".id AND rev=?) WHERE id=?":"INSERT INTO "+bN+" (id, winningseq, max_seq, json) VALUES (?,?,?,?);",Y=fQ(J.metadata),U=J.metadata.id,W=D?[Y,T,F,U]:[U,T,T,Y];V.executeSql(X,W,function(){A[H]={ok:!0,id:J.metadata.id,rev:F},w.set(U,J.metadata),S()})}var R=null,N=0;J.data._id=J.metadata.id,J.data._rev=J.metadata.rev;var P=Object.keys(J.data._attachments||{});I&&(J.data._deleted=!0),P.forEach(function(T){var U=J.data._attachments[T];if(U.stub){N++,E()}else{var V=U.data;delete U.data;var W=U.digest;k(W,V,Q)}}),P.length||L()}function u(){eV(j.revs_limit,h,q,w,p,A,v,o)}function l(E){function D(){++F===h.length&&E()}if(!h.length){return E()}var F=0;h.forEach(function(G){if(G._id&&dK(G._id)){return D()}var H=G.metadata.id;p.executeSql("SELECT json FROM "+bN+" WHERE id = ?",[H],function(K,J){if(J.rows.length){var I=bh(J.rows.item(0).json);w.set(H,I)}D()})})}function k(F,D,G){var E="SELECT digest FROM "+j2+" WHERE digest=?";p.executeSql(E,[F],function(H,I){return I.rows.length?G():(E="INSERT INTO "+j2+" (digest, body, escaped) VALUES (?,?,1)",void H.executeSql(E,[F,bI(D)],function(){G()},function(){return G(),!1}))})}var s=o.new_edits,n=g.docs,h=n.map(function(E){if(E._id&&dK(E._id)){return E}var D=dj(E,s);return D}),C=h.filter(function(D){return D.error});if(C.length){return y(C[0])}var p,r,A=new Array(h.length),w=new ay.Map;bT(h,"binary",function(D){return D?y(D):void m.transaction(function(E){p=E,x(function(F){F?r=F:l(u)})},t(y),i)})}function cw(j,l,h,n,i){function k(){++o===g.length&&i&&i()}function m(q,s){var r=q._attachments[s],p={binary:l.binary,ctx:n};h._getAttachment(r,p,function(u,v){q._attachments[s]=eZ.extend(fN(r,["digest","content_type"]),{data:v}),k()})}var g=Object.keys(j._attachments||{});if(!g.length){return i&&i()}var o=0;g.forEach(function(p){l.attachments&&l.include_docs?m(j,p):(j._attachments[p].stub=!0,k())})}function bi(z,s){function o(){aB()&&(window.localStorage["_pouch__websqldb_"+B._name]=!0),s(null,B)}function q(E,D){E.executeSql(fG),E.executeSql("ALTER TABLE "+jF+" ADD COLUMN deleted TINYINT(1) DEFAULT 0",[],function(){E.executeSql(eO),E.executeSql("ALTER TABLE "+bN+" ADD COLUMN local TINYINT(1) DEFAULT 0",[],function(){E.executeSql("CREATE INDEX IF NOT EXISTS 'doc-store-local-idx' ON "+bN+" (local, id)");var F="SELECT "+bN+".winningseq AS seq, "+bN+".json AS metadata FROM "+jF+" JOIN "+bN+" ON "+jF+".seq = "+bN+".winningseq";E.executeSql(F,[],function(J,G){for(var H=[],M=[],L=0;L<G.rows.length;L++){var I=G.rows.item(L),N=I.seq,K=JSON.parse(I.metadata);dA(K)&&H.push(N),dK(K.id)&&M.push(K.id)}J.executeSql("UPDATE "+bN+"SET local = 1 WHERE id IN "+cX(M.length),M,function(){J.executeSql("UPDATE "+jF+" SET deleted = 1 WHERE seq IN "+cX(H.length),H,D)})})})})}function m(E,D){var F="CREATE TABLE IF NOT EXISTS "+d3+" (id UNIQUE, rev, json)";E.executeSql(F,[],function(){var G="SELECT "+bN+".id AS id, "+jF+".json AS data FROM "+jF+" JOIN "+bN+" ON "+jF+".seq = "+bN+".winningseq WHERE local = 1";E.executeSql(G,[],function(J,L){function I(){if(!K.length){return D(J)}var N=K.shift(),M=JSON.parse(N.data)._rev;J.executeSql("INSERT INTO "+d3+" (id, rev, json) VALUES (?,?,?)",[N.id,M,N.data],function(O){O.executeSql("DELETE FROM "+bN+" WHERE id=?",[N.id],function(P){P.executeSql("DELETE FROM "+jF+" WHERE seq=?",[N.seq],function(){I()})})})}for(var K=[],H=0;H<L.rows.length;H++){K.push(L.rows.item(H))}I()})})}function u(F,D){function G(I){function H(){if(!I.length){return D(F)}var L=I.shift(),J=dl(L.hex,g),M=J.lastIndexOf("::"),K=J.substring(0,M),O=J.substring(M+2),N="UPDATE "+jF+" SET doc_id=?, rev=? WHERE doc_id_rev=?";F.executeSql(N,[K,O,J],function(){H()})}H()}var E="ALTER TABLE "+jF+" ADD COLUMN doc_id";F.executeSql(E,[],function(I){var H="ALTER TABLE "+jF+" ADD COLUMN rev";I.executeSql(H,[],function(J){J.executeSql(fM,[],function(L){var K="SELECT hex(doc_id_rev) as hex FROM "+jF;L.executeSql(K,[],function(O,M){for(var N=[],P=0;P<M.rows.length;P++){N.push(M.rows.item(P))}G(N)})})})})}function h(F,D){function G(H){var I="SELECT COUNT(*) AS cnt FROM "+j2;H.executeSql(I,[],function(K,M){function J(){var P=cL(dh+", "+bN+".id AS id",[bN,jF],cb,null,bN+".id ");P+=" LIMIT "+N+" OFFSET "+O,O+=N,K.executeSql(P,[],function(S,X){function U(ao,an){var ar=ai[ao]=ai[ao]||[];-1===ar.indexOf(an)&&ar.push(an)}if(!X.rows.length){return D(S)}for(var ai={},T=0;T<X.rows.length;T++){for(var W=X.rows.item(T),V=bA(W.data,W.id,W.rev),Q=Object.keys(V._attachments||{}),R=0;R<Q.length;R++){var Z=V._attachments[Q[R]];U(Z.digest,W.seq)}}var ae=[];if(Object.keys(ai).forEach(function(ao){var an=ai[ao];an.forEach(function(ar){ae.push([ao,ar])})}),!ae.length){return J()}var Y=0;ae.forEach(function(an){var ao="INSERT INTO "+dJ+" (digest, seq) VALUES (?,?)";S.executeSql(ao,an,function(){++Y===ae.length&&J()})})})}var L=M.rows.item(0).cnt;if(!L){return D(K)}var O=0,N=10;J()})}var E="CREATE TABLE IF NOT EXISTS "+dJ+" (digest, seq INTEGER)";F.executeSql(E,[],function(H){H.executeSql(ep,[],function(I){I.executeSql(aj,[],G)})})}function i(E,D){var F="ALTER TABLE "+j2+" ADD COLUMN escaped TINYINT(1) DEFAULT 0";E.executeSql(F,[],D)}function x(E,D){var F="ALTER TABLE "+bN+" ADD COLUMN max_seq INTEGER";E.executeSql(F,[],function(G){var H="UPDATE "+bN+" SET max_seq=(SELECT MAX(seq) FROM "+jF+" WHERE doc_id=id)";G.executeSql(H,[],function(J){var I="CREATE UNIQUE INDEX IF NOT EXISTS 'doc-max-seq-idx' ON "+bN+" (max_seq)";J.executeSql(I,[],D)})})}function C(E,D){E.executeSql('SELECT HEX("a") AS hex',[],function(G,H){var F=H.rows.item(0).hex;g=2===F.length?"UTF-8":"UTF-16",D()})}function n(){for(;A.length>0;){var D=A.pop();D(null,v)}}function l(I,F){if(0===F){var M="CREATE TABLE IF NOT EXISTS "+aH+" (dbid, db_version INTEGER)",K="CREATE TABLE IF NOT EXISTS "+j2+" (digest UNIQUE, escaped TINYINT(1), body BLOB)",G="CREATE TABLE IF NOT EXISTS "+dJ+" (digest, seq INTEGER)",J="CREATE TABLE IF NOT EXISTS "+bN+" (id unique, json, winningseq, max_seq INTEGER UNIQUE)",H="CREATE TABLE IF NOT EXISTS "+jF+" (seq INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, json, deleted TINYINT(1), doc_id, rev)",L="CREATE TABLE IF NOT EXISTS "+d3+" (id UNIQUE, rev, json)";I.executeSql(K),I.executeSql(L),I.executeSql(G,[],function(){I.executeSql(aj),I.executeSql(ep)}),I.executeSql(J,[],function(){I.executeSql(fG),I.executeSql(H,[],function(){I.executeSql(eO),I.executeSql(fM),I.executeSql(M,[],function(){var P="INSERT INTO "+aH+" (db_version, dbid) VALUES (?,?)";v=ad();var Q=[dV,v];I.executeSql(P,Q,function(){n()})})})})}else{var E=function(){var Q=dV>F;Q&&I.executeSql("UPDATE "+aH+" SET db_version = "+dV);var P="SELECT dbid FROM "+aH;I.executeSql(P,[],function(R,S){v=S.rows.item(0).dbid,n()})},N=[q,m,u,h,i,x,E],O=F,D=function(P){N[O-1](P,D),O++};D(I)}}function y(){w.transaction(function(D){C(D,function(){k(D)})},t(s),o)}function k(E){var D="SELECT sql FROM sqlite_master WHERE tbl_name = "+aH;E.executeSql(D,[],function(G,F){F.rows.length?/db_version/.test(F.rows.item(0).sql)?G.executeSql("SELECT db_version FROM "+aH,[],function(I,H){var J=H.rows.item(0).db_version;l(I,J)}):G.executeSql("ALTER TABLE "+aH+" ADD COLUMN db_version INTEGER",[],function(){l(G,1)}):l(G,0)})}function j(E,D){if(-1!==B._docCount){return D(B._docCount)}var F=cL("COUNT("+bN+".id) AS 'num'",[bN,jF],cb,jF+".deleted=0");E.executeSql(F,[],function(G,H){B._docCount=H.rows.item(0).num,D(B._docCount)})}var g,B=this,v=null,p=b7(z),A=[];B._docCount=-1,B._name=z.name;var r=d1({name:B._name,version:dp,description:B._name,size:p,location:z.location,createFromLocation:z.createFromLocation,androidDatabaseImplementation:z.androidDatabaseImplementation});if(r.error){return t(s)(r.error)}var w=r.db;"function"!=typeof w.readTransaction&&(w.readTransaction=w.transaction),y(),B.type=function(){return"websql"},B._id=jY(function(D){D(null,v)}),B._info=function(D){w.readTransaction(function(E){j(E,function(G){var F="SELECT MAX(seq) AS seq FROM "+jF;E.executeSql(F,[],function(H,I){var J=I.rows.item(0).seq||0;D(null,{doc_count:G,update_seq:J,sqlite_plugin:w._sqlitePlugin,websql_encoding:g})})})},t(D))},B._bulkDocs=function(D,F,E){aA(z,D,F,B,w,bi.Changes,E)},B._get=function(E,I,M){function J(){M(G,{doc:K,metadata:D,ctx:L})}var K,D,G,L=I.ctx;if(!L){return w.readTransaction(function(N){B._get(E,eZ.extend({ctx:N},I),M)})}var H,F;I.rev?(H=cL(dh,[bN,jF],bN+".id="+jF+".doc_id",[jF+".doc_id=?",jF+".rev=?"]),F=[E,I.rev]):(H=cL(dh,[bN,jF],cb,bN+".id=?"),F=[E]),L.executeSql(H,F,function(N,O){if(!O.rows.length){return G=bw(c3,"missing"),J()}var P=O.rows.item(0);return D=bh(P.metadata),P.deleted&&!I.rev?(G=bw(c3,"deleted"),J()):(K=bA(P.data,D.id,P.rev),void J())})},B._allDocs=function(I,P){var M,H=[],J="startkey" in I?I.startkey:!1,E="endkey" in I?I.endkey:!1,N="key" in I?I.key:!1,Q="descending" in I?I.descending:!1,O="limit" in I?I.limit:-1,L="skip" in I?I.skip:0,G=I.inclusive_end!==!1,D=[],K=[];if(N!==!1){K.push(bN+".id = ?"),D.push(N)}else{if(J!==!1||E!==!1){if(J!==!1&&(K.push(bN+".id "+(Q?"<=":">=")+" ?"),D.push(J)),E!==!1){var F=Q?">":"<";G&&(F+="="),K.push(bN+".id "+F+" ?"),D.push(E)}N!==!1&&(K.push(bN+".id = ?"),D.push(N))}}"ok"!==I.deleted&&K.push(jF+".deleted = 0"),w.readTransaction(function(R){j(R,function(S){if(M=S,0!==O){var T=cL(dh,[bN,jF],cb,K,bN+".id "+(Q?"DESC":"ASC"));T+=" LIMIT "+O+" OFFSET "+L,R.executeSql(T,D,function(Z,W){for(var X=0,Y=W.rows.length;Y>X;X++){var ao=W.rows.item(X),V=bh(ao.metadata),U=V.id,an=bA(ao.data,U,ao.rev),ai=an._rev,ae={id:U,key:U,value:{rev:ai}};if(I.include_docs&&(ae.doc=an,ae.doc._rev=ai,I.conflicts&&(ae.doc._conflicts=jn(V)),cw(ae.doc,I,B,Z)),ao.deleted){if("ok"!==I.deleted){continue}ae.value.deleted=!0,ae.doc=null}H.push(ae)}})}})},t(P),function(){P(null,{total_rows:M,offset:I.skip,rows:H})})},B._changes=function(D){function H(){var R=bN+".json AS metadata, "+bN+".max_seq AS maxSeq, "+jF+".json AS winningDoc, "+jF+".rev AS winningRev ",S=bN+" JOIN "+jF,Q=bN+".id="+jF+".doc_id AND "+bN+".winningseq="+jF+".seq",P=["maxSeq > ?"],M=[D.since];D.doc_ids&&(P.push(bN+".id IN "+cX(D.doc_ids.length)),M=M.concat(D.doc_ids));var T="maxSeq "+(K?"DESC":"ASC"),N=cL(R,S,Q,P,T),L=jO(D);D.view||D.filter||(N+=" LIMIT "+G);var O=D.since||0;w.readTransaction(function(U){U.executeSql(N,M,function(ai,ao){function an(at){return function(){D.onChange(at)}}for(var Z=0,X=ao.rows.length;X>Z;Z++){var V=ao.rows.item(Z),ar=bh(V.metadata);O=V.maxSeq;var W=bA(V.winningDoc,ar.id,V.winningRev),Y=D.processChange(W,ar,D);Y.seq=V.maxSeq;var ae=L(Y);if("object"==typeof ae){return D.complete(ae)}if(ae&&(J++,F&&E.push(Y),D.attachments&&D.include_docs?cw(W,D,B,ai,an(Y)):an(Y)()),J===G){break}}})},t(D.complete),function(){D.continuous||D.complete(null,{results:E,last_seq:O})})}if(D=d4(D),D.continuous){var I=B._name+":"+ad();return bi.Changes.addListener(B._name,I,B,D),bi.Changes.notify(B._name),{cancel:function(){bi.Changes.removeListener(B._name,I)}}}var K=D.descending;D.since=D.since&&!K?D.since:0;var G="limit" in D?D.limit:-1;0===G&&(G=1);var F;F="return_docs" in D?D.return_docs:"returnDocs" in D?D.returnDocs:!0;var E=[],J=0;H()},B._close=function(D){D()},B._getAttachment=function(D,H,I){var K,G=H.ctx,F=D.digest,E=D.content_type,J="SELECT escaped, CASE WHEN escaped = 1 THEN body ELSE HEX(body) END AS body FROM "+j2+" WHERE digest=?";G.executeSql(J,[F],function(L,M){var N=M.rows.item(0),O=N.escaped?dM(N.body):dl(N.body,g);K=H.binary?jw(O,E):b1(O),I(null,K)})},B._getRevisionTree=function(E,D){w.readTransaction(function(G){var F="SELECT json AS metadata FROM "+bN+" WHERE id = ?";G.executeSql(F,[E],function(I,J){if(J.rows.length){var H=bh(J.rows.item(0).metadata);D(null,H.rev_tree)}else{D(bw(c3))}})})},B._doCompaction=function(E,D,F){return D.length?void w.transaction(function(H){var G="SELECT json AS metadata FROM "+bN+" WHERE id = ?";H.executeSql(G,[E],function(K,I){var J=bh(I.rows.item(0).metadata);fH(J.rev_tree,function(N,P,M,O,R){var Q=P+"-"+M;-1!==D.indexOf(Q)&&(R.status="missing")});var L="UPDATE "+bN+" SET json = ? WHERE id = ?";K.executeSql(L,[fQ(J),E])}),bk(D,E,H)},t(F),function(){F()}):F()},B._getLocal=function(E,D){w.readTransaction(function(G){var F="SELECT json, rev FROM "+d3+" WHERE id=?";G.executeSql(F,[E],function(I,K){if(K.rows.length){var H=K.rows.item(0),J=bA(H.json,E,H.rev);D(null,J)}else{D(bw(c3))}})})},B._putLocal=function(G,J,E){function L(M){var O,N;F?(O="UPDATE "+d3+" SET rev=?, json=? WHERE id=? AND rev=?",N=[D,I,H,F]):(O="INSERT INTO "+d3+" (id, rev, json) VALUES (?,?,?)",N=[H,D,I]),M.executeSql(O,N,function(Q,P){P.rowsAffected?(K={ok:!0,id:H,rev:D},J.ctx&&E(null,K)):E(bw(dB))},function(){return E(bw(dB)),!1})}"function"==typeof J&&(E=J,J={}),delete G._revisions;var D,F=G._rev,H=G._id;D=F?G._rev="0-"+(parseInt(F.split("-")[1],10)+1):G._rev="0-1";var K,I=jL(G);J.ctx?L(J.ctx):w.transaction(L,t(E),function(){K&&E(null,K)})},B._removeLocal=function(F,D,H){function E(K){var J="DELETE FROM "+d3+" WHERE id=? AND rev=?",I=[F._id,F._rev];K.executeSql(J,I,function(L,M){return M.rowsAffected?(G={ok:!0,id:F._id,rev:"0-0"},void (D.ctx&&H(null,G))):H(bw(c3))})}"function"==typeof D&&(H=D,D={});var G;D.ctx?E(D.ctx):w.transaction(E,t(H),function(){G&&H(null,G)})},B._destroy=function(E,D){bi.Changes.removeAllListeners(B._name),w.transaction(function(G){var F=[bN,jF,j2,aH,d3,dJ];F.forEach(function(H){G.executeSql("DROP TABLE IF EXISTS "+H,[])})},t(D),function(){aB()&&(delete window.localStorage["_pouch__websqldb_"+B._name],delete window.localStorage[B._name]),D(null,{ok:!0})})}}function fF(i,g,j){try{i.apply(g,j)}catch(h){"undefined"!=typeof PouchDB&&PouchDB.emit("error",h)}}function c2(){if(!dx.running&&dx.queue.length){dx.running=!0;var g=dx.queue.shift();g.action(function(h,i){fF(g.callback,this,[h,i]),dx.running=!1,by.nextTick(c2)})}}function bd(g){return function(h){var i="unknown_error";h.target&&h.target.error&&(i=h.target.error.name||h.target.error.message),g(bw(bu,i,h.type))}}function e7(i,h,g){return{data:fQ(i),winningRev:h,deletedOrLocal:g?"1":"0",seq:i.seq,id:i.id}}function cy(h){if(!h){return null}var g=bh(h.data);return g.winningRev=h.winningRev,g.deleted="1"===h.deletedOrLocal,g.seq=h.seq,g}function c1(h){if(!h){return h}var g=h._doc_id_rev.lastIndexOf(":");return h._id=h._doc_id_rev.substring(0,g-1),h._rev=h._doc_id_rev.substring(g+1),delete h._doc_id_rev,h}function jJ(i,g,j,h){j?h(i?"string"!=typeof i?i:dF(i,g):ds([""],{type:g})):i?"string"!=typeof i?e1(i,function(k){h(b1(k))}):h(i):h("")}function jT(m,j,g,l){function n(){++k===h.length&&l&&l()}function i(s,q){var r=s._attachments[q],p=r.digest,o=g.objectStore(ju).get(p);o.onsuccess=function(u){r.body=u.target.result.body,n()}}var h=Object.keys(m._attachments||{});if(!h.length){return l&&l()}var k=0;h.forEach(function(o){j.attachments&&j.include_docs?i(m,o):(m._attachments[o].stub=!0,n())})}function aU(h,g){return dW.all(h.map(function(i){if(i.doc&&i.doc._attachments){var j=Object.keys(i.doc._attachments);return dW.all(j.map(function(n){var l=i.doc._attachments[n];if("body" in l){var m=l.body,k=l.content_type;return new dW(function(o){jJ(m,k,g,function(p){i.doc._attachments[n]=eZ.extend(fN(l,["digest","content_type"]),{data:p}),o()})})}}))}}))}function dQ(m,g,k){function i(){n--,n||j()}function j(){l.length&&l.forEach(function(q){var r=p.index("digestSeq").count(IDBKeyRange.bound(q+"::",q+"::￿",!1,!1));r.onsuccess=function(s){var u=s.target.result;u||h["delete"](q)}})}var l=[],o=k.objectStore(j0),h=k.objectStore(ju),p=k.objectStore(du),n=m.length;m.forEach(function(s){var r=o.index("_doc_id_rev"),q=g+"::"+s;r.getKey(q).onsuccess=function(w){var v=w.target.result;if("number"!=typeof v){return i()}o["delete"](v);var u=p.index("seq").openCursor(IDBKeyRange.only(v));u.onsuccess=function(y){var x=y.target.result;if(x){var z=x.value.digestSeq.split("::")[0];l.push(z),p["delete"](x.primaryKey),x["continue"]()}else{i()}}}})}function cH(i,g,j){try{return{txn:i.transaction(g,j)}}catch(h){return{error:h}}}function jI(x,E,L,B,A,M,z){function w(){var Q=[js,j0,ju,da,eC,du],P=cH(A,Q,"readwrite");return P.error?z(P.error):(F=P.txn,F.onabort=bd(z),F.ontimeout=bd(z),F.oncomplete=i,p=F.objectStore(js),m=F.objectStore(j0),v=F.objectStore(ju),y=F.objectStore(du),void g(function(R){return R?(j=!0,z(R)):void I()}))}function N(){eV(x.revs_limit,D,B,k,F,r,H,L)}function I(){function Q(){++S===D.length&&N()}function V(W){var X=cy(W.target.result);X&&k.set(X.id,X),Q()}if(D.length){for(var S=0,P=0,R=D.length;R>P;P++){var U=D[P];if(U._id&&dK(U._id)){Q()}else{var T=p.get(U.metadata.id);T.onsuccess=V}}}}function i(){j||(M.notify(B._meta.name),B._meta.docCount+=C,z(null,r))}function q(Q,P){var R=v.get(Q);R.onsuccess=function(T){if(T.target.result){P()}else{var S=bw(eE,"unknown stub attachment with digest "+Q);S.status=412,P(S)}}}function g(R){function P(){++S===T.length&&R(Q)}var T=[];if(D.forEach(function(U){U.data&&U.data._attachments&&Object.keys(U.data._attachments).forEach(function(W){var V=U.data._attachments[W];V.stub&&T.push(V.digest)})}),!T.length){return R()}var Q,S=0;T.forEach(function(U){q(U,function(V){V&&!Q&&(Q=V),P()})})}function H(V,P,T,R,S,U,X,Q){C+=U,V.metadata.winningRev=P,V.metadata.deleted=T;var Y=V.data;Y._id=V.metadata.id,Y._rev=V.metadata.rev,R&&(Y._deleted=!0);var W=Y._attachments&&Object.keys(Y._attachments).length;return W?K(V,P,T,S,X,Q):void G(V,P,T,S,X,Q)}function O(Q){var P=cd(Q.metadata);dQ(P,Q.metadata.id,F)}function G(P,U,X,W,Z,S){function V(ai){W&&B.auto_compaction&&O(P),Y.seq=ai.target.result,delete Y.rev;var ao=e7(Y,U,X),an=p.put(ao);an.onsuccess=R}function T(ao){ao.preventDefault(),ao.stopPropagation();var an=m.index("_doc_id_rev"),ai=an.getKey(ae._doc_id_rev);ai.onsuccess=function(at){var ar=m.put(ae,at.target.result);ar.onsuccess=V}}function R(){r[Z]={ok:!0,id:Y.id,rev:U},k.set(P.metadata.id,P.metadata),s(P,Y.seq,S)}var ae=P.data,Y=P.metadata;ae._doc_id_rev=Y.id+"::"+Y.rev,delete ae._id,delete ae._rev;var Q=m.put(ae);Q.onsuccess=V,Q.onerror=T}function K(X,Q,U,S,T,V){function Z(){Y===W.length&&G(X,Q,U,S,T,V)}function R(){Y++,Z()}var P=X.data,Y=0,W=Object.keys(P._attachments);W.forEach(function(ae){var an=X.data._attachments[ae];if(an.stub){Y++,Z()}else{var ao=an.data;delete an.data;var ai=an.digest;h(ai,ao,R)}})}function s(W,T,Q){function V(){++S===R.length&&Q()}function P(Z){var Y=W.data._attachments[Z].digest,X=y.put({seq:T,digestSeq:Y+"::"+T});X.onsuccess=V,X.onerror=function(ae){ae.preventDefault(),ae.stopPropagation(),V()}}var S=0,R=Object.keys(W.data._attachments||{});if(!R.length){return Q()}for(var U=0;U<R.length;U++){P(R[U])}}function h(R,P,S){var Q=v.count(R);Q.onsuccess=function(W){var T=W.target.result;if(T){return S()}var V={digest:R,body:P},U=v.put(V);U.onsuccess=S}}for(var F,p,m,v,y,o,D=E.docs,C=0,n=0,J=D.length;J>n;n++){var l=D[n];l._id&&dK(l._id)||(l=D[n]=dj(l,L.new_edits),l.error&&!o&&(o=l))}if(o){return z(o)}var r=new Array(D.length),k=new ay.Map,j=!1,u=B._meta.blobSupport?"blob":"base64";bT(D,u,function(P){return P?z(P):void w()})}function eN(k,i,h,j,l){try{if(k&&i){return l?IDBKeyRange.bound(i,k,!h,!1):IDBKeyRange.bound(k,i,!1,!h)}if(k){return l?IDBKeyRange.upperBound(k):IDBKeyRange.lowerBound(k)}if(i){return l?IDBKeyRange.lowerBound(i,!h):IDBKeyRange.upperBound(i,!h)}if(j){return IDBKeyRange.only(j)}}catch(g){return{error:g}}return null}function eT(i,g,j,h){return"DataError"===j.name&&0===j.code?h(null,{total_rows:i._meta.docCount,offset:g.skip,rows:[]}):void h(bw(bu,j.name,j.message))}function jt(k,i,h,j){function l(u,y){function s(L,O,M){var N=L.id+"::"+M;n.get(N).onsuccess=function(P){O.doc=c1(P.target.result),u.conflicts&&(O.doc._conflicts=jn(L)),jT(O.doc,u,x)}}function v(N,P,O){var M={id:O.id,key:O.id,value:{rev:P}},L=O.deleted;if("ok"===u.deleted){p.push(M),L?(M.value.deleted=!0,M.doc=null):u.include_docs&&s(O,M,P)}else{if(!L&&J--<=0&&(p.push(M),u.include_docs&&s(O,M,P),0===--I)){return}}N["continue"]()}function B(M){K=i._meta.docCount;var O=M.target.result;if(O){var L=cy(O.value),N=L.winningRev;v(O,N,L)}}function r(){y(null,{total_rows:K,offset:u.skip,rows:p})}function H(){u.attachments?aU(p,u.binary).then(r):r()}var F="startkey" in u?u.startkey:!1,o="endkey" in u?u.endkey:!1,G="key" in u?u.key:!1,J=u.skip||0,I="number"==typeof u.limit?u.limit:-1,A=u.inclusive_end!==!1,q="descending" in u&&u.descending?"prev":null,E=eN(F,o,A,G,q);if(E&&E.error){return eT(i,u,E.error,y)}var z=[js,j0];u.attachments&&z.push(ju);var C=cH(h,z,"readonly");if(C.error){return y(C.error)}var x=C.txn,w=x.objectStore(js),m=x.objectStore(j0),D=q?w.openCursor(E,q):w.openCursor(E),n=m.index("_doc_id_rev"),p=[],K=0;x.oncomplete=H,D.onsuccess=B}function g(m,n){return 0===m.limit?n(null,{total_rows:i._meta.docCount,offset:m.skip,rows:[]}):void l(m,n)}g(k,j)}function cu(g){return new dW(function(h){var i=ds([""]);g.objectStore(eR).put(i,"key"),g.onabort=function(j){j.preventDefault(),j.stopPropagation(),h(!1)},g.oncomplete=function(){var j=navigator.userAgent.match(/Chrome\/(\d+)/),k=navigator.userAgent.match(/Edge\//);h(k||!j||parseInt(j[1],10)>=43)}})["catch"](function(){return !1})}function bp(i,h){var g=this;dx.queue.push({action:function(j){e3(g,i,j)},callback:h}),c2()}function e3(o,l,s){function g(w){var v=w.createObjectStore(js,{keyPath:"id"});w.createObjectStore(j0,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),w.createObjectStore(ju,{keyPath:"digest"}),w.createObjectStore(da,{keyPath:"id",autoIncrement:!1}),w.createObjectStore(eR),v.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),w.createObjectStore(eC,{keyPath:"_id"});var x=w.createObjectStore(du,{autoIncrement:!0});x.createIndex("seq","seq"),x.createIndex("digestSeq","digestSeq",{unique:!0})}function i(w,v){var x=w.objectStore(js);x.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),x.openCursor().onsuccess=function(z){var B=z.target.result;if(B){var y=B.value,A=dA(y);y.deletedOrLocal=A?"1":"0",x.put(y),B["continue"]()}else{v()}}}function q(v){v.createObjectStore(eC,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}function k(w,x){var z=w.objectStore(eC),v=w.objectStore(js),y=w.objectStore(j0),A=v.openCursor();A.onsuccess=function(L){var I=L.target.result;if(I){var C=I.value,F=C.id,E=dK(F),B=jo(C);if(E){var K=F+"::"+B,H=F+"::",M=F+"::~",J=y.index("_doc_id_rev"),G=IDBKeyRange.bound(H,M,!1,!1),D=J.openCursor(G);D.onsuccess=function(N){if(D=N.target.result){var O=D.value;O._doc_id_rev===K&&z.put(O),y["delete"](D.primaryKey),D["continue"]()}else{v["delete"](I.primaryKey),I["continue"]()}}}else{I["continue"]()}}else{x&&x()}}}function h(w){var v=w.createObjectStore(du,{autoIncrement:!0});v.createIndex("seq","seq"),v.createIndex("digestSeq","digestSeq",{unique:!0})}function p(w,x){var z=w.objectStore(j0),v=w.objectStore(ju),y=w.objectStore(du),A=v.count();A.onsuccess=function(B){var C=B.target.result;return C?void (z.openCursor().onsuccess=function(L){var H=L.target.result;if(!H){return x()}for(var G=H.value,J=H.primaryKey,D=Object.keys(G._attachments||{}),F={},E=0;E<D.length;E++){var M=G._attachments[D[E]];F[M.digest]=!0}var K=Object.keys(F);for(E=0;E<K.length;E++){var I=K[E];y.put({seq:J,digestSeq:I+"::"+J})}H["continue"]()}):x()}}function n(z){function w(A){return A.data?cy(A):(A.deleted="1"===A.deletedOrLocal,A)}var x=z.objectStore(j0),y=z.objectStore(js),v=y.openCursor();v.onsuccess=function(C){function B(){var H=A.id+"::",F=A.id+"::￿",G=x.index("_doc_id_rev").openCursor(IDBKeyRange.bound(H,F)),I=0;G.onsuccess=function(K){var J=K.target.result;if(!J){return A.seq=I,E()}var L=J.primaryKey;L>I&&(I=L),J["continue"]()}}function E(){var G=e7(A,A.winningRev,A.deleted),F=y.put(G);F.onsuccess=function(){D["continue"]()}}var D=C.target.result;if(D){var A=w(D.value);return A.winningRev=A.winningRev||jo(A),A.seq?E():void B()}}}var u=l.name,m=null;o._meta=null,o.type=function(){return"idb"},o._id=jY(function(v){v(null,o._meta.instanceId)}),o._bulkDocs=function(x,v,w){jI(l,x,v,o,m,bp.Changes,w)},o._get=function(w,A,v){function C(){v(x,{doc:D,metadata:z,ctx:B})}var D,z,x,B=A.ctx;if(!B){var y=cH(m,[js,j0,ju],"readonly");if(y.error){return v(y.error)}B=y.txn}B.objectStore(js).get(w).onsuccess=function(E){if(z=cy(E.target.result),!z){return x=bw(c3,"missing"),C()}if(dA(z)&&!A.rev){return x=bw(c3,"deleted"),C()}var G=B.objectStore(j0),H=A.rev||z.winningRev,F=z.id+"::"+H;G.index("_doc_id_rev").get(F).onsuccess=function(I){return D=I.target.result,D&&(D=c1(D)),D?void C():(x=bw(c3,"missing"),C())}}},o._getAttachment=function(w,y,A){var z;if(y.ctx){z=y.ctx}else{var v=cH(m,[js,j0,ju],"readonly");if(v.error){return A(v.error)}z=v.txn}var B=w.digest,x=w.content_type;z.objectStore(ju).get(B).onsuccess=function(C){var D=C.target.result.body;jJ(D,x,y.binary,function(E){A(null,E)})}},o._info=function(y){if(null===m||!eI[u]){var z=new Error("db isn't open");return z.id="idbNull",y(z)}var A,v,B=cH(m,[j0],"readonly");if(B.error){return y(B.error)}var x=B.txn,w=x.objectStore(j0).openCursor(null,"prev");w.onsuccess=function(D){var C=D.target.result;A=C?C.key:0,v=o._meta.docCount},x.oncomplete=function(){y(null,{doc_count:v,update_seq:A,idb_attachment_format:o._meta.blobSupport?"binary":"base64"})}},o._allDocs=function(v,w){jt(v,o,m,w)},o._changes=function(L){function H(Q){function T(){return N.seq!==O?Q["continue"]():(D=O,N.winningRev===P._rev?S(P):void R())}function R(){var U=P._id+"::"+N.winningRev,V=A.get(U);V.onsuccess=function(W){S(c1(W.target.result))}}function S(V){var W=L.processChange(V,N,L);W.seq=N.seq;var U=M(W);return"object"==typeof U?L.complete(U):(U&&(B++,z&&w.push(W),L.attachments&&L.include_docs?jT(V,L,J,function(){aU([W],L.binary).then(function(){L.onChange(W)})}):L.onChange(W)),void (B!==K&&Q["continue"]()))}var P=c1(Q.value),O=Q.key;if(x&&!x.has(P._id)){return Q["continue"]()}var N;return(N=y.get(P._id))?T():void (F.get(P._id).onsuccess=function(U){N=cy(U.target.result),y.set(P._id,N),T()})}function v(N){var O=N.target.result;O&&H(O)}function C(){var P=[js,j0];L.attachments&&P.push(ju);var O=cH(m,P,"readonly");if(O.error){return L.complete(O.error)}J=O.txn,J.onabort=bd(L.complete),J.oncomplete=I,G=J.objectStore(j0),F=J.objectStore(js),A=G.index("_doc_id_rev");var N;N=L.descending?G.openCursor(null,"prev"):G.openCursor(IDBKeyRange.lowerBound(L.since,!0)),N.onsuccess=v}function I(){function N(){L.complete(null,{results:w,last_seq:D})}!L.continuous&&L.attachments?aU(w).then(N):N()}if(L=d4(L),L.continuous){var E=u+":"+ad();return bp.Changes.addListener(u,E,o,L),bp.Changes.notify(u),{cancel:function(){bp.Changes.removeListener(u,E)}}}var x=L.doc_ids&&new ay.Set(L.doc_ids);L.since=L.since||0;var D=L.since,K="limit" in L?L.limit:-1;0===K&&(K=1);var z;z="return_docs" in L?L.return_docs:"returnDocs" in L?L.returnDocs:!0;var J,G,F,A,w=[],B=0,M=jO(L),y=new ay.Map;C()},o._close=function(v){return null===m?v(bw(c9)):(m.close(),delete eI[u],m=null,void v())},o._getRevisionTree=function(z,w){var x=cH(m,[js],"readonly");if(x.error){return w(x.error)}var y=x.txn,v=y.objectStore(js).get(z);v.onsuccess=function(B){var A=cy(B.target.result);A?w(null,A.rev_tree):w(bw(c3))}},o._doCompaction=function(w,y,A){var z=[js,j0,ju,du],v=cH(m,z,"readwrite");if(v.error){return A(v.error)}var B=v.txn,x=B.objectStore(js);x.get(w).onsuccess=function(E){var C=cy(E.target.result);fH(C.rev_tree,function(L,H,K,G,J){var I=H+"-"+K;-1!==y.indexOf(I)&&(J.status="missing")}),dQ(y,w,B);var D=C.winningRev,F=C.deleted;B.objectStore(js).put(e7(C,D,F))},B.onabort=bd(A),B.oncomplete=function(){A()}},o._getLocal=function(z,w){var x=cH(m,[eC],"readonly");if(x.error){return w(x.error)}var y=x.txn,v=y.objectStore(eC).get(z);v.onerror=bd(w),v.onsuccess=function(B){var A=B.target.result;A?(delete A._doc_id_rev,w(null,A)):w(bw(c3))}},o._putLocal=function(E,z,D){"function"==typeof z&&(D=z,z={}),delete E._revisions;var B=E._rev,C=E._id;B?E._rev="0-"+(parseInt(B.split("-")[1],10)+1):E._rev="0-1";var x,w=z.ctx;if(!w){var A=cH(m,[eC],"readwrite");if(A.error){return D(A.error)}w=A.txn,w.onerror=bd(D),w.oncomplete=function(){x&&D(null,x)}}var y,v=w.objectStore(eC);B?(y=v.get(C),y.onsuccess=function(H){var G=H.target.result;if(G&&G._rev===B){var F=v.put(E);F.onsuccess=function(){x={ok:!0,id:E._id,rev:E._rev},z.ctx&&D(null,x)}}else{D(bw(dB))}}):(y=v.add(E),y.onerror=function(F){D(bw(dB)),F.preventDefault(),F.stopPropagation()},y.onsuccess=function(){x={ok:!0,id:E._id,rev:E._rev},z.ctx&&D(null,x)})},o._removeLocal=function(w,A,v){"function"==typeof A&&(v=A,A={});var C=A.ctx;if(!C){var D=cH(m,[eC],"readwrite");if(D.error){return v(D.error)}C=D.txn,C.oncomplete=function(){z&&v(null,z)}}var z,x=w._id,B=C.objectStore(eC),y=B.get(x);y.onerror=bd(v),y.onsuccess=function(F){var E=F.target.result;E&&E._rev===w._rev?(B["delete"](x),z={ok:!0,id:x,rev:"0-0"},A.ctx&&v(null,z)):v(bw(c3))}},o._destroy=function(w,v){bp.Changes.removeAllListeners(u),bp.openReqList[u]&&bp.openReqList[u].result&&(bp.openReqList[u].result.close(),delete eI[u]);var x=indexedDB.deleteDatabase(u);x.onsuccess=function(){bp.openReqList[u]&&(bp.openReqList[u]=null),aB()&&u in localStorage&&delete localStorage[u],v(null,{ok:!0})},x.onerror=bd(v)};var j=eI[u];if(j){return m=j.idb,o._meta=j.global,void by.nextTick(function(){s(null,o)})}var r;r=l.storage?ec(u,l.storage):indexedDB.open(u,d7),"openReqList" in bp||(bp.openReqList={}),bp.openReqList[u]=r,r.onupgradeneeded=function(w){function z(){var B=y[A-1];A++,B&&B(v,z)}var x=w.target.result;if(w.oldVersion<1){return g(x)}var v=w.currentTarget.transaction;w.oldVersion<3&&q(x),w.oldVersion<4&&h(x);var y=[i,k,p,n],A=w.oldVersion;z()},r.onsuccess=function(v){m=v.target.result,m.onversionchange=function(){m.close(),delete eI[u]},m.onabort=function(B){console.error("Database has a global failure",B.target.error),m.close(),delete eI[u]};var z=m.transaction([da,eR,js],"readwrite"),y=z.objectStore(da).get(da),x=null,w=null,A=null;y.onsuccess=function(D){var B=function(){null!==x&&null!==w&&null!==A&&(o._meta={name:u,instanceId:A,blobSupport:x,docCount:w},eI[u]={idb:m,global:o._meta},s(null,o))},E=D.target.result||{id:da};u+"_id" in E?(A=E[u+"_id"],B()):(A=ad(),E[u+"_id"]=A,z.objectStore(da).put(E).onsuccess=function(){B()}),fP||(fP=cu(z)),fP.then(function(F){x=F,B()});var C=z.objectStore(js).index("deletedOrLocal");C.count(IDBKeyRange.only("0")).onsuccess=function(F){w=F.target.result,B()}}},r.onerror=function(w){var v="Failed to open indexedDB, are you in private browsing mode?";console.error(v),s(bw(bu,v))}}function ec(i,h){try{return indexedDB.open(i,{version:d7,storage:h})}catch(g){return indexedDB.open(i,d7)}}var eZ=c(7),eD="default" in eZ?eZ["default"]:eZ,jA=c(6);jA="default" in jA?jA["default"]:jA;var ay=c(12);ay="default" in ay?ay["default"]:ay;var ax=c(4),fO=c(1);fO="default" in fO?fO["default"]:fO;var bG=c(2);bG="default" in bG?bG["default"]:bG;var cV=c(10),aJ="default" in cV?cV["default"]:cV,eA=c(8);eA="default" in eA?eA["default"]:eA;var aZ=c(14);aZ="default" in aZ?aZ["default"]:aZ;var bL=c(15);bL="default" in bL?bL["default"]:bL;var cQ=c(16);cQ="default" in cQ?cQ["default"]:cQ;var dW="function"==typeof Promise?Promise:eA,ca=jz();jA(cW,Error),cW.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};var bS=new cW({status:401,error:"unauthorized",reason:"Name or password is incorrect."}),ab=new cW({status:400,error:"bad_request",reason:"Missing JSON list of 'docs'"}),c3=new cW({status:404,error:"not_found",reason:"missing"}),dB=new cW({status:409,error:"conflict",reason:"Document update conflict"}),fA=new cW({status:400,error:"invalid_id",reason:"_id field must contain a string"}),aI=new cW({status:412,error:"missing_id",reason:"_id is required for puts"}),af=new cW({status:400,error:"bad_request",reason:"Only reserved document ids may start with underscore."}),c9=new cW({status:412,error:"precondition_failed",reason:"Database not open"}),bm=new cW({status:500,error:"unknown_error",reason:"Database encountered an unknown error"}),dd=new cW({status:500,error:"badarg",reason:"Some query argument is invalid"}),bD=new cW({status:400,error:"invalid_request",reason:"Request was invalid"}),ck=new cW({status:400,error:"query_parse_error",reason:"Some query parameter is invalid"}),aQ=new cW({status:500,error:"doc_validation",reason:"Bad special document member"}),bZ=new cW({status:400,error:"bad_request",reason:"Something wrong with the request"}),fB=new cW({status:400,error:"bad_request",reason:"Document must be a JSON object"}),c7=new cW({status:404,error:"not_found",reason:"Database not found"}),bu=new cW({status:500,error:"indexed_db_went_bad",reason:"unknown"}),cp=new cW({status:500,error:"web_sql_went_bad",reason:"unknown"}),eX=new cW({status:500,error:"levelDB_went_went_bad",reason:"unknown"}),df=new cW({status:403,error:"forbidden",reason:"Forbidden by design doc validate_doc_update function"}),fL=new cW({status:400,error:"bad_request",reason:"Invalid rev format"}),aT=new cW({status:412,error:"file_exists",reason:"The database could not be created, the file already exists."}),eE=new cW({status:412,error:"missing_stub"}),cJ=new cW({status:413,error:"invalid_url",reason:"Provided URL is invalid"}),ej={UNAUTHORIZED:bS,MISSING_BULK_DOCS:ab,MISSING_DOC:c3,REV_CONFLICT:dB,INVALID_ID:fA,MISSING_ID:aI,RESERVED_ID:af,NOT_OPEN:c9,UNKNOWN_ERROR:bm,BAD_ARG:dd,INVALID_REQUEST:bD,QUERY_PARSE_ERROR:ck,DOC_VALIDATION:aQ,BAD_REQUEST:bZ,NOT_AN_OBJECT:fB,DB_MISSING:c7,WSQ_ERROR:cp,LDB_ERROR:eX,FORBIDDEN:df,INVALID_REV:fL,FILE_EXISTS:aT,MISSING_STUB:eE,IDB_ERROR:bu,INVALID_URL:cJ},ac=function(j,h,g){var i=Object.keys(ej).filter(function(m){var l=ej[m];return"function"!=typeof l&&l[j]===h}),k=g&&i.filter(function(m){var l=ej[m];return l.message===g})[0]||i[0];return k?ej[k]:null},jq=function(){},fD=bG("pouchdb:api");jA(jW,ax.EventEmitter),jW.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")},jW.prototype.doChanges=function(j){var h=this,g=j.complete;if(j=d4(j),"live" in j&&!("continuous" in j)&&(j.continuous=j.live),j.processChange=bW,"latest"===j.since&&(j.since="now"),j.since||(j.since=0),"now"===j.since){return void this.db.info().then(function(l){return h.isCancelled?void g(null,{status:"cancelled"}):(j.since=l.update_seq,void h.doChanges(j))},g)}if(j.continuous&&"now"!==j.since&&this.db.info().then(function(l){h.startSeq=l.update_seq},function(l){if("idbNull"!==l.id){throw l}}),j.filter&&"string"==typeof j.filter&&("_view"===j.filter?j.view=jR(j.view):j.filter=jR(j.filter),"http"!==this.db.type()&&!j.doc_ids)){return this.filterChanges(j)}"descending" in j||(j.descending=!1),j.limit=0===j.limit?1:j.limit,j.complete=g;var i=this.db._changes(j);if(i&&"function"==typeof i.cancel){var k=h.cancel;h.cancel=fO(function(l){i.cancel(),k.apply(this,l)})}},jW.prototype.filterChanges=function(k){var i=this,h=k.complete;if("_view"===k.filter){if(!k.view||"string"!=typeof k.view){var j=bw(bZ,"`view` filter parameter not found or invalid.");return h(j)}var l=e(k.view);this.db.get("_design/"+l[0],function(n,m){if(i.isCancelled){return h(null,{status:"cancelled"})}if(n){return h(eY(n))}var o=m&&m.views&&m.views[l[1]]&&m.views[l[1]].map;return o?(k.filter=b6(o),void i.doChanges(k)):h(bw(c3,m.views?"missing json key: "+l[1]:"missing json key: views"))})}else{var g=e(k.filter);if(!g){return i.doChanges(k)}this.db.get("_design/"+g[0],function(o,m){if(i.isCancelled){return h(null,{status:"cancelled"})}if(o){return h(eY(o))}var n=m&&m.filters&&m.filters[g[1]];return n?(k.filter=eJ(n),void i.doChanges(k)):h(bw(c3,m&&m.filters?"missing json key: "+g[1]:"missing json key: filters"))})}};var aS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),jX=jm(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),bM=jm(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);jA(e8,ax.EventEmitter),e8.prototype.post=jQ("post",function(i,h,g){return"function"==typeof h&&(g=h,h={}),"object"!=typeof i||Array.isArray(i)?g(bw(fB)):void this.bulkDocs({docs:[i]},h,cT(g))}),e8.prototype.put=jQ("put",fO(function(m){var k,g,l,i,j=m.shift(),h="_id" in j;if("object"!=typeof j||Array.isArray(j)){return(i=m.pop())(bw(fB))}for(;;){if(k=m.shift(),g=typeof k,"string"!==g||h?"string"!==g||!h||"_rev" in j?"object"===g?l=k:"function"===g&&(i=k):j._rev=k:(j._id=k,h=!0),!m.length){break}}return l=l||{},jU(j._id),dK(j._id)&&"function"==typeof this._putLocal?j._deleted?this._removeLocal(j,i):this._putLocal(j,i):void this.bulkDocs({docs:[j]},l,cT(i))})),e8.prototype.putAttachment=jQ("putAttachment",function(m,j,g,l,n,i){function h(o){return o._attachments=o._attachments||{},o._attachments[j]={content_type:n,data:l},k.put(o)}var k=this;return"function"==typeof n&&(i=n,n=l,l=g,g=null),"undefined"==typeof n&&(n=l,l=g,g=null),k.get(m).then(function(o){if(o._rev!==g){throw bw(dB)}return h(o)},function(o){if(o.reason===c3.message){return h({_id:m})}throw o})}),e8.prototype.removeAttachment=jQ("removeAttachment",function(j,h,g,i){var k=this;k.get(j,function(m,l){return m?void i(m):l._rev!==g?void i(bw(dB)):l._attachments?(delete l._attachments[h],0===Object.keys(l._attachments).length&&delete l._attachments,void k.put(l,i)):i()})}),e8.prototype.remove=jQ("remove",function(k,i,h,j){var l;"string"==typeof i?(l={_id:k,_rev:i},"function"==typeof h&&(j=h,h={})):(l=k,"function"==typeof i?(j=i,h={}):(j=h,h=i)),h=h||{},h.was_delete=!0;var g={_id:l._id,_rev:l._rev||h.rev};return g._deleted=!0,dK(g._id)&&"function"==typeof this._removeLocal?this._removeLocal(l,j):void this.bulkDocs({docs:[g]},h,cT(j))}),e8.prototype.revsDiff=jQ("revsDiff",function(m,j,g){function l(o,p){k.has(o)||k.set(o,{missing:[]}),k.get(o).missing.push(p)}function n(q,p){var o=m[q].slice(0);fH(p,function(v,s,r,w,x){var y=s+"-"+r,u=o.indexOf(y);-1!==u&&(o.splice(u,1),"available"!==x.status&&l(q,y))}),o.forEach(function(r){l(q,r)})}"function"==typeof j&&(g=j,j={});var i=Object.keys(m);if(!i.length){return g(null,{})}var h=0,k=new ay.Map;i.map(function(o){this._getRevisionTree(o,function(q,p){if(q&&404===q.status&&"missing"===q.message){k.set(o,{missing:m[o]})}else{if(q){return g(q)}n(o,p)}if(++h===i.length){var r={};return k.forEach(function(u,s){r[s]=u}),g(null,r)}})},this)}),e8.prototype.bulkGet=jQ("bulkGet",function(h,g){c4(this,h,g)}),e8.prototype.compactDocument=jQ("compactDocument",function(i,g,j){var h=this;this._getRevisionTree(i,function(k,n){if(k){return j(k)}var l=eP(n),o=[],m=[];Object.keys(l).forEach(function(p){l[p]>g&&o.push(p)}),fH(n,function(v,s,q,u,p){var r=s+"-"+q;"available"===p.status&&-1!==o.indexOf(r)&&m.push(r)}),h._doCompaction(i,m,j)})}),e8.prototype.compact=jQ("compact",function(i,h){"function"==typeof i&&(h=i,i={});var g=this;i=i||{},g._compactionQueue=g._compactionQueue||[],g._compactionQueue.push({opts:i,callback:h}),1===g._compactionQueue.length&&c6(g)}),e8.prototype._compact=function(m,k){function g(n){h.push(i.compactDocument(n.id,0))}function l(o){var n=o.last_seq;dW.all(h).then(function(){return cs(i,"_local/compaction",function(p){return !p.last_seq||p.last_seq<n?(p.last_seq=n,p):!1})}).then(function(){k(null,{ok:!0})})["catch"](k)}var i=this,j={return_docs:!1,last_seq:m.last_seq||0},h=[];i.changes(j).on("change",g).on("complete",l).on("error",k)},e8.prototype.get=jQ("get",function(m,j,g){function l(){var o=[],p=n.length;return p?void n.forEach(function(q){i.get(m,{rev:q,revs:j.revs,attachments:j.attachments},function(s,r){s?o.push({missing:q}):o.push({ok:r}),p--,p||g(null,o)})}):g(null,o)}if("function"==typeof j&&(g=j,j={}),"string"!=typeof m){return g(bw(fA))}if(dK(m)&&"function"==typeof this._getLocal){return this._getLocal(m,g)}var n=[],i=this;if(!j.open_revs){return this._get(m,j,function(o,u){if(o){return g(o)}var w=u.doc,B=u.metadata,x=u.ctx;if(j.conflicts){var v=jn(B);v.length&&(w._conflicts=v)}if(dA(B,w._rev)&&(w._deleted=!0),j.revs||j.revs_info){var r=jS(B.rev_tree),A=d9(r,function(D){return -1!==D.ids.map(function(E){return E.id}).indexOf(w._rev.split("-")[1])}),s=A.ids.map(function(D){return D.id}).indexOf(w._rev.split("-")[1])+1,p=A.ids.length-s;if(A.ids.splice(s,p),A.ids.reverse(),j.revs&&(w._revisions={start:A.pos+A.ids.length-1,ids:A.ids.map(function(D){return D.id})}),j.revs_info){var C=A.pos+A.ids.length;w._revs_info=A.ids.map(function(D){return C--,{rev:C+"-"+D.id,status:D.opts.status}})}}if(j.attachments&&w._attachments){var q=w._attachments,y=Object.keys(q).length;if(0===y){return g(null,w)}Object.keys(q).forEach(function(D){this._getAttachment(q[D],{binary:j.binary,ctx:x},function(F,G){var E=w._attachments[D];E.data=G,delete E.stub,delete E.length,--y||g(null,w)})},i)}else{if(w._attachments){for(var z in w._attachments){w._attachments.hasOwnProperty(z)&&(w._attachments[z].stub=!0)}}g(null,w)}})}if("all"===j.open_revs){this._getRevisionTree(m,function(o,p){return o?g(o):(n=c0(p).map(function(q){return q.rev}),void l())})}else{if(!Array.isArray(j.open_revs)){return g(bw(bm,"function_clause"))}n=j.open_revs;for(var h=0;h<n.length;h++){var k=n[h];if("string"!=typeof k||!/^\d+-/.test(k)){return g(bw(fL))}}l()}}),e8.prototype.getAttachment=jQ("getAttachment",function(j,h,g,i){var k=this;g instanceof Function&&(i=g,g={}),this._get(j,g,function(m,l){return m?i(m):l.doc._attachments&&l.doc._attachments[h]?(g.ctx=l.ctx,g.binary=!0,k._getAttachment(l.doc._attachments[h],g,i),void 0):i(bw(c3))})}),e8.prototype.allDocs=jQ("allDocs",function(i,h){if("function"==typeof i&&(h=i,i={}),i.skip="undefined"!=typeof i.skip?i.skip:0,i.start_key&&(i.startkey=i.start_key),i.end_key&&(i.endkey=i.end_key),"keys" in i){if(!Array.isArray(i.keys)){return h(new TypeError("options.keys must be an array"))}var g=["startkey","endkey","key"].filter(function(j){return j in i})[0];if(g){return void h(bw(ck,"Query parameter `"+g+"` is not compatible with multi-get"))}if("http"!==this.type()){return dS(this,i,h)}}return this._allDocs(i,h)}),e8.prototype.changes=function(h,g){return"function"==typeof h&&(g=h,h={}),new jW(this,h,g)},e8.prototype.close=jQ("close",function(g){return this._closed=!0,this._close(g)}),e8.prototype.info=jQ("info",function(h){var g=this;this._info(function(j,i){return j?h(j):(i.db_name=i.db_name||g._db_name,i.auto_compaction=!(!g.auto_compaction||"http"===g.type()),i.adapter=g.type(),void h(null,i))})}),e8.prototype.id=jQ("id",function(g){return this._id(g)}),e8.prototype.bulkDocs=jQ("bulkDocs",function(j,h,g){if("function"==typeof h&&(g=h,h={}),h=h||{},Array.isArray(j)&&(j={docs:j}),!j||!j.docs||!Array.isArray(j.docs)){return g(bw(ab))}for(var i=0;i<j.docs.length;++i){if("object"!=typeof j.docs[i]||Array.isArray(j.docs[i])){return g(bw(fB))}}var k;return j.docs.forEach(function(l){l._attachments&&Object.keys(l._attachments).forEach(function(m){k=k||dy(m)})}),k?g(bw(bZ,k)):("new_edits" in h||("new_edits" in j?h.new_edits=j.new_edits:h.new_edits=!0),h.new_edits||"http"===this.type()||j.docs.sort(aR),bj(j.docs),this._bulkDocs(j,h,function(m,l){return m?g(m):(h.new_edits||(l=l.filter(function(n){return n.error})),void g(null,l))}))}),e8.prototype.registerDependentDatabase=jQ("registerDependentDatabase",function(i,g){function j(k){return k.dependentDbs=k.dependentDbs||{},k.dependentDbs[i]?!1:(k.dependentDbs[i]=!0,k)}var h=new this.constructor(i,this.__opts);cs(this,"_local/_pouch_dependentDbs",j).then(function(){g(null,{db:h})})["catch"](g)}),e8.prototype.destroy=jQ("destroy",function(j,h){function g(){i._destroy(j,function(l,m){return l?h(l):(i.emit("destroyed"),void h(null,m||{ok:!0}))})}"function"==typeof j&&(h=j,j={});var i=this,k="use_prefix" in i?i.use_prefix:!0;return"http"===i.type()?g():void i.get("_local/_pouch_dependentDbs",function(l,o){if(l){return 404!==l.status?h(l):g()}var m=o.dependentDbs,p=i.constructor,n=Object.keys(m).map(function(r){var q=k?r.replace(new RegExp("^"+p.prefix),""):r;return new p(q,i.__opts).destroy()});dW.all(n).then(g,h)})}),jN.prototype.execute=function(){var g;if(this.failed){for(;g=this.queue.shift();){g(this.failed)}}else{for(;g=this.queue.shift();){g()}}},jN.prototype.fail=function(g){this.failed=g,this.execute()},jN.prototype.ready=function(g){this.isReady=!0,this.db=g,this.execute()},jN.prototype.addTask=function(g){this.queue.push(g),this.failed&&this.execute()},jA(cE,e8),cE.debug=bG;var cC;if(jy()){cC=!1}else{try{localStorage.setItem("_pouch_check_localstorage",1),cC=!!localStorage.getItem("_pouch_check_localstorage")}catch(dv){cC=!1}}cE.adapters={},cE.preferredAdapters=[],cE.prefix="_pouch_";var aV=new ax.EventEmitter;ea(cE),cE.parseAdapter=function(m,j){var g,l,n=m.match(/([a-z\-]*):\/\/(.*)/);if(n){if(m=/http(s?)/.test(n[1])?n[1]+"://"+n[2]:n[2],g=n[1],!cE.adapters[g].valid()){throw"Invalid adapter"}return{name:m,adapter:n[1]}}var i="idb" in cE.adapters&&"websql" in cE.adapters&&aB()&&localStorage["_pouch__websqldb_"+cE.prefix+m];if(j.adapter){l=j.adapter}else{if("undefined"!=typeof j&&j.db){l="leveldb"}else{for(var h=0;h<cE.preferredAdapters.length;++h){if(l=cE.preferredAdapters[h],l in cE.adapters){if(i&&"idb"===l){console.log('PouchDB is downgrading "'+m+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.');continue}break}}}}g=cE.adapters[l];var k=g&&"use_prefix" in g?g.use_prefix:!0;return{name:k?cE.prefix+m:m,adapter:l}},cE.adapter=function(i,h,g){h.valid()&&(cE.adapters[i]=h,g&&cE.preferredAdapters.push(i))},cE.plugin=function(g){return Object.keys(g).forEach(function(h){cE.prototype[h]=g[h]}),cE},cE.defaults=function(h){function g(k,i,j){return this instanceof g?(("function"==typeof i||"undefined"==typeof i)&&(j=i,i={}),k&&"object"==typeof k&&(i=k,k=void 0),i=eZ.extend({},h,i),void cE.call(this,k,i,j)):new g(k,i,j)}return jA(g,cE),ea(g),g.preferredAdapters=cE.preferredAdapters.slice(),Object.keys(cE).forEach(function(i){i in g||(g[i]=cE[i])}),g};var cz=function(g){return atob(g)},b1=function(g){return btoa(g)},az=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],d2="queryKey",bQ=/(?:^|&)([^&=]*)=?([^&]*)/g,fJ=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,e9=eD.extend,e2={ajax:bP,parseUri:eS,uuid:ad,Promise:dW,atob:cz,btoa:b1,binaryStringToBlobOrBuffer:jw,clone:d4,extend:e9,createError:bw},a9=aJ.collate,em=1,cx="pouchdb",eK=5,dg=0;jV.prototype.writeCheckpoint=function(i,h){var g=this;return this.updateTarget(i,h).then(function(){return g.updateSource(i,h)})},jV.prototype.updateTarget=function(h,g){return d6(this.target,this.id,h,g,this.returnValue)},jV.prototype.updateSource=function(i,h){var g=this;return this.readOnlySource?dW.resolve(!0):d6(this.src,this.id,i,h,this.returnValue)["catch"](function(k){var j="number"==typeof k.status&&4===Math.floor(k.status/100);if(j){return g.readOnlySource=!0,!0}throw k})};var bK={undefined:function(h,g){return 0===a9(h.last_seq,g.last_seq)?g.last_seq:0},1:function(h,g){return eh(g,h).last_seq}};jV.prototype.getCheckpoint=function(){var g=this;return g.target.get(g.id).then(function(h){return g.src.get(g.id).then(function(i){if(h.version!==i.version){return dg}var j;return j=h.version?h.version.toString():"undefined",j in bK?bK[j](h,i):dg},function(i){if(404===i.status&&h.last_seq){return g.src.put({_id:g.id,last_seq:dg}).then(function(){return dg},function(j){return 401===j.status?(g.readOnlySource=!0,h.last_seq):dg})}throw i})})["catch"](function(h){if(404!==h.status){throw h}return dg})};var dU=0,aK=ch.setImmediate||ch.setTimeout,dw=32768,bq=jY(function(m,g){function k(){var q=h*l,u=q+l;if(h++,o>h){n(p,m,q,u),aK(k)}else{n(p,m,q,u);var r=p.end(!0),s=bO(r);g(null,s),p.destroy()}}var i="string"==typeof m,j=i?m.length:m.byteLength,l=Math.min(dw,j),o=Math.ceil(j/l),h=0,p=i?new bL:new bL.ArrayBuffer,n=i?dc:cc;k()});jA(aO,ax.EventEmitter),aO.prototype.cancel=function(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")},aO.prototype.ready=function(j,h){function g(){k.cancel()}function i(){j.removeListener("destroyed",g),h.removeListener("destroyed",g)}var k=this;k._readyCalled||(k._readyCalled=!0,j.once("destroyed",g),h.once("destroyed",g),k.once("complete",i))};var eB={replicate:bf,toPouch:di},cZ=eB.replicate;jA(am,ax.EventEmitter),am.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())};var aG=25,bU=50,cA={},jZ=1800,bE=bG("pouchdb:http");dk.valid=function(){return !0};var b2=function(h,g){return g&&h.then(function(i){by.nextTick(function(){g(null,i)})},function(i){by.nextTick(function(){g(i)})}),h},dm=function(g){return fO(function(h){var j=h.pop(),i=g.apply(this,h);return"function"==typeof j&&b2(i,j),i})},cN=function(h,g){return h.then(function(i){return g().then(function(){return i})},function(i){return g().then(function(){throw i})})},dC=function(h,g){return function(){var j=arguments,i=this;return h.add(function(){return g.apply(i,j)})}},cD=function(k){for(var i={},h=0,j=k.length;j>h;h++){i["$"+k[h]]=!0}var l=Object.keys(i),g=new Array(l.length);for(h=0,j=l.length;j>h;h++){g[h]=l[h].substring(1)}return g},dI={uniq:cD,sequentialize:dC,fin:cN,callbackify:dm,promisedCallback:b2};aY.prototype.add=function(g){return this.promise=this.promise["catch"](function(){}).then(function(){return g()}),this.promise},aY.prototype.finish=function(){return this.promise};var cR,e5=aJ.collate,av=aJ.toIndexableString,cf=aJ.normalizeKey,bv=aJ.parseIndexableString;cR="undefined"!=typeof console&&"function"==typeof console.log?Function.prototype.bind.call(console.log,console):function(){};var dX=dI.callbackify,aN=dI.sequentialize,bx=dI.uniq,dG=dI.fin,eH=dI.promisedCallback,e4={},fC=new aY,dD=50,eG={_sum:function(h,g){return bJ(g)},_count:function(h,g){return g.length},_stats:function(i,h){function g(m){for(var k=0,j=0,l=m.length;l>j;j++){var n=m[j];k+=n*n}return k}return{sum:bJ(h),min:Math.min.apply(null,h),max:Math.max.apply(null,h),count:h.length,sumsqr:g(h)}}},jC=dX(function(){var g=this;return"http"===g.type()?ag(g):"function"==typeof g._viewCleanup?dN(g):b8(g)}),jl=function(j,h,g){"function"==typeof h&&(g=h,h={}),h=h?bc(h):{},"function"==typeof j&&(j={map:j});var i=this,k=dW.resolve().then(function(){return dE(i,j,h)});return eH(k,g),k};jA(bz,Error),jA(aw,Error),jA(aE,Error);var d8={query:jl,viewCleanup:jC},dV=7,bN=eM("document-store"),jF=eM("by-sequence"),j2=eM("attach-store"),d3=eM("local-store"),aH=eM("metadata-store"),dJ=eM("attach-seq-store"),cO={};jA(bs,ax.EventEmitter),bs.prototype.addListener=function(m,k,g,l){function i(){function n(){h=!1}if(j._listeners[k]){if(h){return void (h="waiting")}h=!0;var o=fN(l,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary"]);g.changes(o).on("change",function(p){p.seq>l.since&&!l.cancelled&&(l.since=p.seq,l.onChange(p))}).on("complete",function(){"waiting"===h&&setTimeout(function(){i()},0),h=!1}).on("error",n)}}if(!this._listeners[k]){var j=this,h=!1;this._listeners[k]=i,this.on(m,i)}},bs.prototype.removeListener=function(h,g){g in this._listeners&&ax.EventEmitter.prototype.removeListener.call(this,h,this._listeners[g])},bs.prototype.notifyLocalWindows=function(g){jy()?chrome.storage.local.set({dbName:g}):aB()&&(localStorage[g]="a"===localStorage[g]?"b":"a")},bs.prototype.notify=function(g){this.emit(g),this.notifyLocalWindows(g)};var dp=1,eO="CREATE INDEX IF NOT EXISTS 'by-seq-deleted-idx' ON "+jF+" (seq, deleted)",fM="CREATE UNIQUE INDEX IF NOT EXISTS 'by-seq-doc-id-rev' ON "+jF+" (doc_id, rev)",fG="CREATE INDEX IF NOT EXISTS 'doc-winningseq-idx' ON "+bN+" (winningseq)",aj="CREATE INDEX IF NOT EXISTS 'attach-seq-seq-idx' ON "+dJ+" (seq)",ep="CREATE UNIQUE INDEX IF NOT EXISTS 'attach-seq-digest-idx' ON "+dJ+" (digest, seq)",cb=jF+".seq = "+bN+".winningseq",dh=jF+".seq AS seq, "+jF+".deleted AS deleted, "+jF+".json AS data, "+jF+".rev AS rev, "+bN+".json AS metadata";bi.valid=cM,bi.Changes=new bs;var fP,d7=5,js="document-store",j0="by-sequence",ju="attach-store",du="attach-seq-store",da="meta-store",eC="local-store",eR="detect-blob-support",dx={running:!1,queue:[]},eI={};bp.valid=function(){var g="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform);return !g&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange},bp.Changes=new bs;var eF={idb:bp,websql:bi};cE.ajax=bP,cE.utils=e2,cE.Errors=ej,cE.replicate=eB.replicate,cE.sync=cP,cE.version="5.2.0",cE.adapter("http",dk),cE.adapter("https",dk),cE.plugin(d8),Object.keys(eF).forEach(function(g){cE.adapter(g,eF[g],!0)}),f.exports=cE}).call(this,c(13),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{1:1,10:10,12:12,13:13,14:14,15:15,16:16,2:2,4:4,6:6,7:7,8:8}]},{},[17])(17)});