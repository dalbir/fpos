!function(b){if("object"==typeof exports&&"undefined"!=typeof module){module.exports=b()}else{if("function"==typeof define&&define.amd){define([],b)}else{var a;a="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,a.PouchDB=b()}}}(function(){var b;return function a(f,h,c){function d(k,m){if(!h[k]){if(!f[k]){var l="function"==typeof require&&require;if(!m&&l){return l(k,!0)}if(j){return j(k,!0)}var i=new Error("Cannot find module '"+k+"'");throw i.code="MODULE_NOT_FOUND",i}var e=h[k]={exports:{}};f[k][0].call(e.exports,function(n){var o=f[k][1][n];return d(o?o:n)},e,e.exports,a,f,h,c)}return h[k].exports}for(var j="function"==typeof require&&require,g=0;g<c.length;g++){d(c[g])}return d}({1:[function(j,f,l){function d(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function k(e){return"function"==typeof e}function c(e){return"number"==typeof e}function g(e){return"object"==typeof e&&null!==e}function h(e){return void 0===e}f.exports=d,d.EventEmitter=d,d.prototype._events=void 0,d.prototype._maxListeners=void 0,d.defaultMaxListeners=10,d.prototype.setMaxListeners=function(e){if(!c(e)||0>e||isNaN(e)){throw TypeError("n must be a positive number")}return this._maxListeners=e,this},d.prototype.emit=function(p){var i,q,n,m,o,e;if(this._events||(this._events={}),"error"===p&&(!this._events.error||g(this._events.error)&&!this._events.error.length)){if(i=arguments[1],i instanceof Error){throw i}throw TypeError('Uncaught, unspecified "error" event.')}if(q=this._events[p],h(q)){return !1}if(k(q)){switch(arguments.length){case 1:q.call(this);break;case 2:q.call(this,arguments[1]);break;case 3:q.call(this,arguments[1],arguments[2]);break;default:m=Array.prototype.slice.call(arguments,1),q.apply(this,m)}}else{if(g(q)){for(m=Array.prototype.slice.call(arguments,1),e=q.slice(),n=e.length,o=0;n>o;o++){e[o].apply(this,m)}}}return !0},d.prototype.addListener=function(m,i){var e;if(!k(i)){throw TypeError("listener must be a function")}return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",m,k(i.listener)?i.listener:i),this._events[m]?g(this._events[m])?this._events[m].push(i):this._events[m]=[this._events[m],i]:this._events[m]=i,g(this._events[m])&&!this._events[m].warned&&(e=h(this._maxListeners)?d.defaultMaxListeners:this._maxListeners,e&&e>0&&this._events[m].length>e&&(this._events[m].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[m].length),"function"==typeof console.trace&&console.trace())),this},d.prototype.on=d.prototype.addListener,d.prototype.once=function(n,i){function e(){this.removeListener(n,e),m||(m=!0,i.apply(this,arguments))}if(!k(i)){throw TypeError("listener must be a function")}var m=!1;return e.listener=i,this.on(n,e),this},d.prototype.removeListener=function(p,m){var i,e,n,o;if(!k(m)){throw TypeError("listener must be a function")}if(!this._events||!this._events[p]){return this}if(i=this._events[p],n=i.length,e=-1,i===m||k(i.listener)&&i.listener===m){delete this._events[p],this._events.removeListener&&this.emit("removeListener",p,m)}else{if(g(i)){for(o=n;o-->0;){if(i[o]===m||i[o].listener&&i[o].listener===m){e=o;break}}if(0>e){return this}1===i.length?(i.length=0,delete this._events[p]):i.splice(e,1),this._events.removeListener&&this.emit("removeListener",p,m)}}return this},d.prototype.removeAllListeners=function(m){var i,e;if(!this._events){return this}if(!this._events.removeListener){return 0===arguments.length?this._events={}:this._events[m]&&delete this._events[m],this}if(0===arguments.length){for(i in this._events){"removeListener"!==i&&this.removeAllListeners(i)}return this.removeAllListeners("removeListener"),this._events={},this}if(e=this._events[m],k(e)){this.removeListener(m,e)}else{if(e){for(;e.length;){this.removeListener(m,e[e.length-1])}}}return delete this._events[m],this},d.prototype.listeners=function(i){var e;return e=this._events&&this._events[i]?k(this._events[i])?[this._events[i]]:this._events[i].slice():[]},d.prototype.listenerCount=function(i){if(this._events){var e=this._events[i];if(k(e)){return 1}if(e){return e.length}}return 0},d.listenerCount=function(i,e){return i.listenerCount(e)}},{}],2:[function(x,c,j){function d(){v&&y&&(v=!1,y.length?w=y.concat(w):A=-1,w.length&&k())}function k(){if(!v){var f=q(d);v=!0;for(var e=w.length;e;){for(y=w,w=[];++A<e;){y&&y[A].run()}A=-1,e=w.length}y=null,v=!1,m(f)}}function p(f,e){this.fun=f,this.array=e}function g(){}var q,m,z=c.exports={};!function(){try{q=setTimeout}catch(e){q=function(){throw new Error("setTimeout is not defined")}}try{m=clearTimeout}catch(e){m=function(){throw new Error("clearTimeout is not defined")}}}();var y,w=[],v=!1,A=-1;z.nextTick=function(f){var e=new Array(arguments.length-1);if(arguments.length>1){for(var h=1;h<arguments.length;h++){e[h-1]=arguments[h]}}w.push(new p(f,e)),1!==w.length||v||q(k,0)},p.prototype.run=function(){this.fun.apply(null,this.array)},z.title="browser",z.browser=!0,z.env={},z.argv=[],z.version="",z.versions={},z.on=g,z.addListener=g,z.once=g,z.off=g,z.removeListener=g,z.removeAllListeners=g,z.emit=g,z.binding=function(e){throw new Error("process.binding is not supported")},z.cwd=function(){return"/"},z.chdir=function(e){throw new Error("process.chdir is not supported")},z.umask=function(){return 0}},{}],3:[function(f,d,c){(function(eB,eC){function bQ(g){return g&&"object"==typeof g&&"default" in g?g["default"]:g}function dy(g){return g instanceof ArrayBuffer||"undefined"!=typeof Blob&&g instanceof Blob}function bP(i){if("function"==typeof i.slice){return i.slice(0)}var g=new ArrayBuffer(i.byteLength),j=new Uint8Array(g),h=new Uint8Array(i);return j.set(h),g}function dC(g){if(g instanceof ArrayBuffer){return bP(g)}var i=g.size,h=g.type;return"function"==typeof g.slice?g.slice(0,i,h):g.webkitSlice(0,i,h)}function dT(g){var i=Object.getPrototypeOf(g);if(null===i){return !0}var h=i.constructor;return"function"==typeof h&&h instanceof h&&fI.call(h)==bz}function dY(g){var j,i,k;if(!g||"object"!=typeof g){return g}if(Array.isArray(g)){for(j=[],i=0,k=g.length;k>i;i++){j[i]=dY(g[i])}return j}if(g instanceof Date){return g.toISOString()}if(dy(g)){return dC(g)}if(!dT(g)){return g}j={};for(i in g){if(Object.prototype.hasOwnProperty.call(g,i)){var h=dY(g[i]);"undefined"!=typeof h&&(j[i]=h)}}return j}function bK(h){var g=!1;return bW(function(i){if(g){throw new Error("once called more than once")}g=!0,h.apply(this,i)})}function fD(g){return bW(function(j){j=dY(j);var k,l=this,i="function"==typeof j[j.length-1]?j.pop():!1;i&&(k=function(n,m){eB.nextTick(function(){i(n,m)})});var h=new bb(function(p,o){var m;try{var q=bK(function(r,s){r?o(r):p(s)});j.push(q),m=g.apply(l,j),m&&"function"==typeof m.then&&p(m)}catch(n){o(n)}});return k&&h.then(function(m){k(null,m)},k),h})}function bS(g,i){function h(o,m,k){if(dc.enabled){for(var n=[o._db_name,m],j=0;j<k.length-1;j++){n.push(k[j])}dc.apply(null,n);var l=k[k.length-1];k[k.length-1]=function(r,p){var q=[o._db_name,m];q=q.concat(r?["error",r]:["success",p]),dc.apply(null,q),l(r,p)}}}return fD(bW(function(j){if(this._closed){return bb.reject(new Error("database is closed"))}if(this._destroyed){return bb.reject(new Error("database is destroyed"))}var k=this;return h(k,g,j),this.taskqueue.isReady?i.apply(this,j):new bb(function(l,m){k.taskqueue.addTask(function(n){n?m(n):l(k[g].apply(k,j))})})}))}function f8(h,k){for(var j={},l=0,i=k.length;i>l;l++){var g=k[l];g in h&&(j[g]=h[g])}return j}function eR(g){return g}function eO(g){return[{ok:g}]}function dg(q,g,k){function i(){var w=[];s.forEach(function(x){x.docs.forEach(function(y){w.push({id:x.id,docs:[y]})})}),k(null,{results:w})}function l(){++n===r&&i()}function m(w,y,x){s[w]={id:y,docs:x},l()}function j(){if(!(p>=v.length)){var x=Math.min(p+j9,v.length),w=v.slice(p,x);u(w,p),p+=w.length}}function u(x,w){x.forEach(function(B,z){var D=w+z,C=h[B],y=f8(C[0],["atts_since","attachments"]);y.open_revs=C.map(function(E){return E.rev}),y.open_revs=y.open_revs.filter(eR);var A=eR;0===y.open_revs.length&&(delete y.open_revs,A=eO),["revs","attachments","binary","ajax"].forEach(function(E){E in g&&(y[E]=g[E])}),q.get(B,y,function(G,E){var F;F=G?[{error:G}]:A(E),m(D,B,F),j()})})}var o=g.docs,h={};o.forEach(function(w){w.id in h?h[w.id].push(w):h[w.id]=[w]});var r=Object.keys(h).length,n=0,s=new Array(r),v=Object.keys(h),p=0;j()}function jF(){return"undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage&&"undefined"!=typeof chrome.storage.local}function f5(){return kb}function bc(g){jF()?chrome.storage.onChanged.addListener(function(h){null!=h.db_name&&g.emit(h.dbName.newValue)}):f5()&&("undefined"!=typeof addEventListener?addEventListener("storage",function(h){g.emit(h.key)}):window.attachEvent("storage",function(h){g.emit(h.key)}))}function el(){aI.EventEmitter.call(this),this._listeners={},bc(this)}function eA(h){if("undefined"!==console&&h in console){var g=Array.prototype.slice.call(arguments,1);console[h].apply(console,g)}}function fB(g,j){var i=600000;g=parseInt(g,10)||0,j=parseInt(j,10),j!==j||g>=j?j=(g||1)<<1:j+=1,j>i&&(g=i>>1,j=i);var k=Math.random(),h=j-g;return ~~(h*k+g)}function bR(h){var g=0;return h||(g=2000),fB(h,g)}function aM(h,g){eA("info","The above "+h+" is totally normal. "+g)}function ed(g){Error.call(this,g.reason),this.status=g.status,this.name=g.error,this.message=g.reason,this.error=!0}function av(i,g,j){function h(k){for(var l in i){"function"!=typeof i[l]&&(this[l]=i[l])}void 0!==j&&(this.name=j),void 0!==k&&(this.reason=k)}return h.prototype=ed.prototype,new h(g)}function bJ(h){var k,j,l,i,g;return j=h.error===!0&&"string"==typeof h.name?h.name:h.error,g=h.reason,l=cz("name",j,g),h.missing||"missing"===g||"deleted"===g||"not_found"===j?l=eQ:"doc_validation"===j?(l=fC,i=g):"bad_request"===j&&l.message!==g&&(l=cM),l||(l=cz("status",h.status,g)||bA),k=av(l,g,j),i&&(k.message=i),h.id&&(k.id=h.id),h.status&&(k.status=h.status),h.missing&&(k.missing=h.missing),k}function aV(g,j,i){try{return !g(j,i)}catch(k){var h="Filter function threw: "+k.toString();return av(cM,h)}}function fE(g){var i={},h=g.filter&&"function"==typeof g.filter;return i.query=g.query_params,function(k){k.doc||(k.doc={});var l=h&&aV(g.filter,k.doc,i);if("object"==typeof l){return l}if(l){return !1}if(g.include_docs){if(!g.attachments){for(var j in k.doc._attachments){k.doc._attachments.hasOwnProperty(j)&&(k.doc._attachments[j].stub=!0)}}}else{delete k.doc}return !0}}function aJ(i){for(var g=[],j=0,h=i.length;h>j;j++){g=g.concat(i[j])}return g}function cO(h){var g;if(h?"string"!=typeof h?g=av(dO):/^_/.test(h)&&!/^_(design|local)/.test(h)&&(g=av(eZ)):g=av(df),g){throw g}}function eK(h,g){return"listenerCount" in h?h.listenerCount(g):aI.EventEmitter.listenerCount(h,g)}function jY(h){if(!h){return null}var g=h.split("/");return 2===g.length?g:1===g.length?[h,h]:null}function kk(h){var g=jY(h);return g?g.join("/"):null}function e3(j){for(var m=ka.exec(j),g={},i=14;i--;){var k=b2[i],l=m[i]||"",h=-1!==["user","password"].indexOf(k);g[k]=h?decodeURIComponent(l):l}return g[cA]={},g[b2[12]].replace(eJ,function(n,o,p){o&&(g[cA][o]=p)}),g}function b4(g,i,h){return new bb(function(j,k){g.get(i,function(n,l){if(n){if(404!==n.status){return k(n)}l={}}var o=l._rev,m=h(l);return m?(m._id=i,m._rev=o,void j(bB(g,m,h))):j({updated:!1,rev:o})})})}function bB(g,i,h){return g.put(i).then(function(j){return{updated:!0,rev:j.rev}},function(j){if(409!==j.status){throw j}return b4(g,i._id,h)})}function dE(g){return 0|Math.random()*g}function e0(i,g){g=g||bE.length;var j="",h=-1;if(i){for(;++h<i;){j+=bE[dE(g)]}return j}for(;++h<36;){switch(h){case 8:case 13:case 18:case 23:j+="-";break;case 19:j+=bE[3&dE(16)|8];break;default:j+=bE[dE(16)]}}return j}function d8(r){for(var n,q,o,p,g=r.rev_tree.slice();p=g.pop();){var l=p.ids,h=l[2],m=p.pos;if(h.length){for(var k=0,i=h.length;i>k;k++){g.push({pos:m+1,ids:h[k]})}}else{var s=!!l[1].deleted,j=l[0];n&&!(o!==s?o:q!==m?m>q:j>n)||(n=j,q=m,o=s)}}return q+"-"+n}function b1(m,g){for(var k,i=m.slice();k=i.pop();){for(var j=k.pos,l=k.ids,o=l[2],h=g(0===o.length,j,l[0],k.ctx,l[1]),p=0,n=o.length;n>p;p++){i.push({pos:j+1,ids:o[p],ctx:h})}}}function a8(h,g){return h.pos-g.pos}function aB(i){var g=[];b1(i,function(k,m,o,l,n){k&&g.push({rev:m+"-"+o,pos:m,opts:n})}),g.sort(a8).reverse();for(var j=0,h=g.length;h>j;j++){delete g[j].pos}return g}function dA(j){for(var m=d8(j),g=aB(j.rev_tree),i=[],k=0,l=g.length;l>k;k++){var h=g[k];h.rev===m||h.opts.deleted||i.push(h.rev)}return i}function cV(h){var g=[];return b1(h.rev_tree,function(l,i,k,m,j){"available"!==j.status||l||(g.push(i+"-"+k),j.status="missing")}),g}function f9(r){for(var n,q=[],o=r.slice();n=o.pop();){var p=n.pos,g=n.ids,l=g[0],h=g[1],m=g[2],k=0===m.length,i=n.history?n.history.slice():[];i.push({id:l,opts:h}),k&&q.push({pos:p+1-i.length,ids:i});for(var s=0,j=m.length;j>s;s++){o.push({pos:p+1,ids:m[s],history:i})}}return q.reverse()}function eb(h,g){return h.pos-g.pos}function c3(h,k,j){for(var l,i=0,g=h.length;g>i;){l=i+g>>>1,j(h[l],k)<0?i=l+1:g=l}return i}function dv(i,g,j){var h=c3(i,g,j);i.splice(h,0,g)}function eX(m,j){for(var g,l,n=j,i=m.length;i>n;n++){var h=m[n],k=[h.id,h.opts,[]];l?(l[2].push(k),l=k):g=l=k}return g}function e4(h,g){return h[0]<g[0]?-1:1}function aY(m,g){for(var k=[{tree1:m,tree2:g}],i=!1;k.length>0;){var j=k.pop(),l=j.tree1,o=j.tree2;(l[1].status||o[1].status)&&(l[1].status="available"===l[1].status||"available"===o[1].status?"available":"missing");for(var h=0;h<o[2].length;h++){if(l[2][0]){for(var p=!1,n=0;n<l[2].length;n++){l[2][n][0]===o[2][h][0]&&(k.push({tree1:l[2][n],tree2:o[2][h]}),p=!0)}p||(i="new_branch",dv(l[2],o[2][h],e4))}else{i="new_leaf",l[2][0]=o[2][h]}}}return{conflicts:i,tree:m}}function dd(z,w,x){var s,k=[],n=!1,u=!1;if(!z.length){return{tree:[w],conflicts:"new_leaf"}}for(var y=0,j=z.length;j>y;y++){var v=z[y];if(v.pos===w.pos&&v.ids[0]===w.ids[0]){s=aY(v.ids,w.ids),k.push({pos:v.pos,ids:s.tree}),n=n||s.conflicts,u=!0}else{if(x!==!0){var q=v.pos<w.pos?v:w,m=v.pos<w.pos?w:v,r=m.pos-q.pos,o=[],i=[];for(i.push({ids:q.ids,diff:r,parent:null,parentIdx:null});i.length>0;){var h=i.pop();if(0!==h.diff){for(var g=h.ids[2],p=0,A=g.length;A>p;p++){i.push({ids:g[p],diff:h.diff-1,parent:h.ids,parentIdx:p})}}else{h.ids[0]===m.ids[0]&&o.push(h)}}var l=o[0];l?(s=aY(l.ids,m.ids),l.parent[2][l.parentIdx]=s.tree,k.push({pos:q.pos,ids:q.ids}),n=n||s.conflicts,u=!0):k.push(v)}else{k.push(v)}}}return u||k.push(w),k.sort(eb),{tree:k,conflicts:n||"internal_node"}}function eY(r,n){for(var q,o=f9(r),p={},g=0,l=o.length;l>g;g++){for(var h=o[g],m=h.ids,k=Math.max(0,m.length-n),i={pos:h.pos+k,ids:eX(m,k)},s=0;k>s;s++){var j=h.pos+s+"-"+m[s].id;p[j]=!0}q=q?dd(q,i,!0).tree:[i]}return b1(q,function(v,u,w){delete p[u+"-"+w]}),{tree:q,revs:Object.keys(p)}}function cp(g,j,i){var k=dd(g,j),h=eY(k.tree,i);return{tree:h.tree,stemmedRevs:h.revs,conflicts:k.conflicts}}function cj(m,g){for(var k,i=m.slice(),j=g.split("-"),l=parseInt(j[0],10),o=j[1];k=i.pop();){if(k.pos===l&&k.ids[0]===o){return !0}for(var h=k.ids[2],p=0,n=h.length;n>p;p++){i.push({pos:k.pos+1,ids:h[p]})}}return !1}function ds(g){return g.ids}function bI(g,j){j||(j=d8(g));for(var i,k=j.substring(j.indexOf("-")+1),h=g.rev_tree.map(ds);i=h.pop();){if(i[0]===k){return !!i[1].deleted}h=h.concat(i[2])}}function ep(g){return/^_local/.test(g)}function cd(g){return eF("return "+g+";",{})}function bU(g){return new Function("doc",["var emitted = false;","var emit = function (a, b) {","  emitted = true;","};","var view = "+g+";","view(doc);","if (emitted) {","  return true;","}"].join("\n"))}function e8(g,i){try{g.emit("change",i)}catch(h){eA("error",'Error in .on("change", function):',h)}}function aU(j,m,g){function i(){k.cancel()}aI.EventEmitter.call(this);var k=this;this.db=j,m=m?dY(m):{};var l=m.complete=bK(function(o,n){o?eK(k,"error")>0&&k.emit("error",o):k.emit("complete",n),k.removeAllListeners(),j.removeListener("destroyed",i)});g&&(k.on("complete",function(n){g(null,n)}),k.on("error",g)),j.once("destroyed",i),m.onChange=function(n){m.isCancelled||(e8(k,n),k.startSeq&&k.startSeq<=n.seq&&(k.startSeq=!1))};var h=new bb(function(o,n){m.complete=function(p,q){p?n(p):o(q)}});k.once("cancel",function(){j.removeListener("destroyed",i),m.complete(null,{status:"cancelled"})}),this.then=h.then.bind(h),this["catch"]=h["catch"].bind(h),this.then(function(n){l(null,n)},l),j.taskqueue.isReady?k.doChanges(m):j.taskqueue.addTask(function(){k.isCancelled?k.emit("cancel"):k.doChanges(m)})}function bC(g,j,i){var k=[{rev:g._rev}];"all_docs"===i.style&&(k=aB(j.rev_tree).map(function(l){return{rev:l.rev}}));var h={id:j.id,changes:k,doc:g};return bI(j,g._rev)&&(h.deleted=!0),i.conflicts&&(h.doc._conflicts=dA(j),h.doc._conflicts.length||delete h.doc._conflicts),h}function fP(h,g){return g>h?-1:h>g?1:0}function ek(g,i){for(var h=0;h<g.length;h++){if(i(g[h],h)===!0){return g[h]}}}function du(g){return function(h,i){h||i[0]&&i[0].error?g(h||i[0]):g(null,i.length?i[0]:i)}}function aA(h){for(var k=0;k<h.length;k++){var j=h[k];if(j._deleted){delete j._attachments}else{if(j._attachments){for(var l=Object.keys(j._attachments),i=0;i<l.length;i++){var g=l[i];j._attachments[g]=f8(j._attachments[g],["data","digest","content_type","length","revpos","stub"])}}}}}function ad(g,j){var i=fP(g._id,j._id);if(0!==i){return i}var k=g._revisions?g._revisions.start:0,h=j._revisions?j._revisions.start:0;return fP(k,h)}function cP(g){var i={},h=[];return b1(g,function(k,j,l,n){var m=j+"-"+l;return k&&(i[m]=0),void 0!==n&&h.push({from:n,to:m}),m}),h.reverse(),h.forEach(function(j){void 0===i[j.from]?i[j.from]=1+i[j.to]:i[j.from]=Math.min(i[j.from],1+i[j.to])}),i}function dZ(g,j,i){var k="limit" in j?j.keys.slice(j.skip,j.limit+j.skip):j.skip>0?j.keys.slice(j.skip):j.keys;if(j.descending&&k.reverse(),!k.length){return g._allDocs({limit:0},i)}var h={offset:j.skip};return bb.all(k.map(function(m){var l=b9.extend({key:m,deleted:"ok"},j);return["limit","skip","keys"].forEach(function(n){delete l[n]}),new bb(function(o,n){g._allDocs(l,function(q,p){return q?n(q):(h.total_rows=p.total_rows,void o(p.rows[0]||{key:m,error:"not_found"}))})})})).then(function(l){return h.rows=l,h})}function cq(i){var g=i._compactionQueue[0],h=g.opts,j=g.callback;i.get("_local/compaction")["catch"](function(){return !1}).then(function(k){k&&k.last_seq&&(h.last_seq=k.last_seq),i._compact(h,function(l,m){l?j(l):j(null,m),eB.nextTick(function(){i._compactionQueue.shift(),i._compactionQueue.length&&cq(i)})})})}function c1(g){return"_"===g.charAt(0)?g+"is not a valid attachment name, attachment names cannot start with '_'":!1}function af(){aI.EventEmitter.call(this)}function aG(){this.isReady=!1,this.failed=!1,this.queue=[]}function ag(g){g&&eC.debug&&eA("error",g)}function d3(j,m){function g(){l.emit("destroyed",k)}function i(){j.removeListener("destroyed",g),j.emit("destroyed",j)}var k=m.originalName,l=j.constructor,h=l._destructionListeners;j.once("destroyed",g),h.has(k)||h.set(k,[]),h.get(k).push(i)}function jM(j,m,g){if(!(this instanceof jM)){return new jM(j,m,g)}var i=this;if("function"!=typeof m&&"undefined"!=typeof m||(g=m,m={}),j&&"object"==typeof j&&(m=j,j=void 0),"undefined"==typeof g){g=ag}else{var k=g;g=function(){return eA("warn","Using a callback for new PouchDB()is deprecated."),k.apply(null,arguments)}}j=j||m.name,m=dY(m),delete m.name,this.__opts=m;var l=g;i.auto_compaction=m.auto_compaction,i.prefix=jM.prefix,af.call(i),i.taskqueue=new aG;var h=new bb(function(q,o){g=function(r,s){return r?o(r):(delete s.then,void q(s))},m=dY(m);var n,p;return function(){try{if("string"!=typeof j){throw p=new Error("Missing/invalid DB name"),p.code=400,p}var r=(m.prefix||"")+j;if(n=jM.parseAdapter(r,m),m.originalName=j,m.name=n.name,m.adapter=m.adapter||n.adapter,i._adapter=m.adapter,bm("pouchdb:adapter")("Picked adapter: "+m.adapter),i._db_name=j,!jM.adapters[m.adapter]){throw p=new Error("Adapter is missing"),p.code=404,p}if(!jM.adapters[m.adapter].valid()){throw p=new Error("Invalid Adapter"),p.code=404,p}}catch(s){i.taskqueue.fail(s)}}(),p?o(p):(i.adapter=m.adapter,i.replicate={},i.replicate.from=function(r,u,s){return i.constructor.replicate(r,i,u,s)},i.replicate.to=function(r,u,s){return i.constructor.replicate(i,r,u,s)},i.sync=function(r,u,s){return i.constructor.sync(i,r,u,s)},i.replicate.sync=i.sync,void jM.adapters[m.adapter].call(i,m,function(r){return r?(i.taskqueue.fail(r),void g(r)):(d3(i,m),i.emit("created",i),jM.emit("created",m.originalName),i.taskqueue.ready(i),void g(null,i))}))});h.then(function(n){l(null,n)},l),i.then=h.then.bind(h),i["catch"]=h["catch"].bind(h)}function eG(h){Object.keys(aI.EventEmitter.prototype).forEach(function(i){"function"==typeof aI.EventEmitter.prototype[i]&&(h[i]=ea[i].bind(ea))});var g=h._destructionListeners=new d4.Map;h.on("destroyed",function(i){g.get(i).forEach(function(j){j()}),g["delete"](i)})}function f0(g){return g.reduce(function(i,h){return i[h]=!0,i},{})}function ch(i){if(!/^\d+\-./.test(i)){return av(cD)}var g=i.indexOf("-"),j=i.substring(0,g),h=i.substring(g+1);return{prefix:parseInt(j,10),id:h}}function aO(j,m){for(var g=j.start-j.ids.length+1,i=j.ids,k=[i[0],m,[]],l=1,h=i.length;h>l;l++){k=[i[l],{status:"missing"},[k]]}return[{pos:g,ids:k}]}function cm(m,g){var k,i,j,l={status:"available"};if(m._deleted&&(l.deleted=!0),g){if(m._id||(m._id=e0()),i=e0(32,16).toLowerCase(),m._rev){if(j=ch(m._rev),j.error){return j}m._rev_tree=[{pos:j.prefix,ids:[j.id,{status:"missing"},[[i,l,[]]]]}],k=j.prefix+1}else{m._rev_tree=[{pos:1,ids:[i,l,[]]}],k=1}}else{if(m._revisions&&(m._rev_tree=aO(m._revisions,l),k=m._revisions.start,i=m._revisions.ids[0]),!m._rev_tree){if(j=ch(m._rev),j.error){return j}k=j.prefix,i=j.id,m._rev_tree=[{pos:k,ids:[i,l,[]]}]}}cO(m._id),m._rev=k+"-"+i;var o={metadata:{},data:{}};for(var h in m){if(Object.prototype.hasOwnProperty.call(m,h)){var p="_"===h[0];if(p&&!f1[h]){var n=av(fC,h);throw n.message=fC.message+": "+h,n}p&&!e7[h]?o.metadata[h.slice(1)]=m[h]:o.data[h]=m[h]}}return o}function eU(g){for(var j="",i=new Uint8Array(g),k=i.byteLength,h=0;k>h;h++){j+=String.fromCharCode(i[h])}return j}function d2(g){return c8(eU(g))}function bY(h,k){h=h||[],k=k||{};try{return new Blob(h,k)}catch(j){if("TypeError"!==j.name){throw j}for(var l="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder,i=new l,g=0;g<h.length;g+=1){i.append(h[g])}return i.getBlob(k.type)}}function eh(g){for(var j=g.length,i=new ArrayBuffer(j),k=new Uint8Array(i),h=0;j>h;h++){k[h]=g.charCodeAt(h)}return i}function cH(h,g){return bY([eh(h)],{type:g})}function bM(h,g){return cH(d6(h),g)}function aQ(i,g){if("undefined"==typeof FileReader){return g(eU((new FileReaderSync).readAsArrayBuffer(i)))}var j=new FileReader,h="function"==typeof j.readAsBinaryString;j.onloadend=function(k){var l=k.target.result||"";return h?g(l):void g(eU(l))},h?j.readAsBinaryString(i):j.readAsArrayBuffer(i)}function c9(h,g){aQ(h,function(i){g(c8(i))})}function j1(g,i){if("undefined"==typeof FileReader){return i((new FileReaderSync).readAsArrayBuffer(g))}var h=new FileReader;h.onloadend=function(j){var k=j.target.result||new ArrayBuffer(0);i(k)},h.readAsArrayBuffer(g)}function b5(g){return c8(g)}function dz(i,g,j,h){(j>0||h<g.byteLength)&&(g=new Uint8Array(g,j,Math.min(h,g.byteLength)-j)),i.append(g)}function dk(i,g,j,h){(j>0||h<g.length)&&(g=g.substring(j,h)),i.appendBinary(g)}function db(m,g){function k(){var q=h*l,u=q+l;if(h++,o>h){n(p,m,q,u),bG(k)}else{n(p,m,q,u);var r=p.end(!0),s=b5(r);g(s),p.destroy()}}var i="string"==typeof m,j=i?m.length:m.byteLength,l=Math.min(jR,j),o=Math.ceil(j/l),h=0,p=i?new aX:new aX.ArrayBuffer,n=i?dk:dz;k()}function bk(g){return aX.hash(g)}function eg(m,j,g){function l(o){try{return d6(o)}catch(q){var p=av(dP,"Attachment is not a valid base64 string");return{error:p}}}function n(q,p){if(q.stub){return p()}if("string"==typeof q.data){var o=l(q.data);if(o.error){return p(o.error)}q.length=o.length,"blob"===j?q.data=cH(o,q.content_type):"base64"===j?q.data=c8(o):q.data=o,db(o,function(r){q.digest="md5-"+r,p()})}else{j1(q.data,function(r){"binary"===j?q.data=eU(r):"base64"===j&&(q.data=d2(r)),db(r,function(s){q.digest="md5-"+s,q.length=r.byteLength,p()})})}}function i(){k++,m.length===k&&(h?g(h):g())}if(!m.length){return g()}var h,k=0;m.forEach(function(r){function p(u){h=u,q++,q===s.length&&i()}var s=r.data&&r.data._attachments?Object.keys(r.data._attachments):[],q=0;if(!s.length){return i()}for(var o in r.data._attachments){r.data._attachments.hasOwnProperty(o)&&n(r.data._attachments[o],p)}})}function aw(g,r,q,x,s,j,B,u){if(cj(r.rev_tree,q.metadata.rev)){return x[s]=q,j()}var w=r.winningRev||d8(r),m="deleted" in r?r.deleted:bI(r,w),v="deleted" in q.metadata?q.metadata.deleted:bI(q.metadata),n=/^1-/.test(q.metadata.rev);if(m&&!v&&u&&n){var y=q.data;y._rev=w,y._id=q.metadata.id,q=cm(y,u)}var i=cp(r.rev_tree,q.metadata.rev_tree[0],g),z=u&&(m&&v||!m&&"new_leaf"!==i.conflicts||m&&!v&&"new_branch"===i.conflicts);if(z){var l=av(eW);return x[s]=l,j()}var k=q.metadata.rev;q.metadata.rev_tree=i.tree,q.stemmedRevs=i.stemmedRevs||[],r.rev_map&&(q.metadata.rev_map=r.rev_map);var p,o=d8(q.metadata),h=bI(q.metadata,o),A=m===h?0:h>m?-1:1;p=k===o?h:bI(q.metadata,k),B(q,o,h,p,!0,A,s,j)}function t(g){return"missing"===g.metadata.rev_tree[0].ids[1].status}function bl(i,s,q,k,m,h,r,u,p){function o(x,C,B){var A=d8(x.metadata),D=bI(x.metadata,A);if("was_delete" in u&&D){return h[C]=av(eQ,"deleted"),B()}var w=g&&t(x);if(w){var z=av(eW);return h[C]=z,B()}var y=D?0:1;r(x,A,D,D,!1,y,C,B)}function j(){++v===n&&p&&p()}i=i||1000;var g=u.new_edits,l=new d4.Map,v=0,n=s.length;s.forEach(function(y,w){if(y._id&&ep(y._id)){var x=y._deleted?"_removeLocal":"_putLocal";return void q[x](y,{ctx:m},function(B,A){h[w]=B||A,j()})}var z=y.metadata.id;l.has(z)?(n--,l.get(z).push([y,w])):l.set(z,[[y,w]])}),l.forEach(function(x,z){function y(){++w<x.length?A():j()}function A(){var C=x[w],E=C[0],D=C[1];if(k.has(z)){aw(i,k.get(z),E,h,D,y,r,g)}else{var B=cp([],E.metadata.rev_tree[0],i);E.metadata.rev_tree=B.tree,E.stemmedRevs=B.stemmedRevs||[],o(E,D,y)}}var w=0;A()})}function jQ(h){try{return JSON.parse(h)}catch(g){return c2.parse(h)}}function dM(g){return g.length<50000?JSON.parse(g):jQ(g)}function fK(h){try{return JSON.stringify(h)}catch(g){return c2.stringify(h)}}function f3(g,j,i,k){try{g.apply(j,i)}catch(h){k.emit("error",h)}}function aN(h){if(!bf.running&&bf.queue.length){bf.running=!0;var g=bf.queue.shift();g.action(function(i,j){f3(g.callback,this,[i,j],h),bf.running=!1,eB.nextTick(function(){aN(h)})})}}function bL(g){return function(h){var i="unknown_error";h.target&&h.target.error&&(i=h.target.error.name||h.target.error.message),g(av(ba,i,h.type))}}function dj(g,i,h){return{data:fK(g),winningRev:i,deletedOrLocal:h?"1":"0",seq:g.seq,id:g.id}}function bs(h){if(!h){return null}var g=dM(h.data);return g.winningRev=h.winningRev,g.deleted="1"===h.deletedOrLocal,g.seq=h.seq,g}function fJ(h){if(!h){return h}var g=h._doc_id_rev.lastIndexOf(":");return h._id=h._doc_id_rev.substring(0,g-1),h._rev=h._doc_id_rev.substring(g+1),delete h._doc_id_rev,h}function bh(i,g,j,h){j?h(i?"string"!=typeof i?i:bM(i,g):bY([""],{type:g})):i?"string"!=typeof i?aQ(i,function(k){h(c8(k))}):h(i):h("")}function jG(m,j,g,l){function n(){++k===h.length&&l&&l()}function i(s,q){var r=s._attachments[q],p=r.digest,o=g.objectStore(aF).get(p);o.onsuccess=function(u){r.body=u.target.result.body,n()}}var h=Object.keys(m._attachments||{});if(!h.length){return l&&l()}var k=0;h.forEach(function(o){j.attachments&&j.include_docs?i(m,o):(m._attachments[o].stub=!0,n())})}function cZ(h,g){return bb.all(h.map(function(i){if(i.doc&&i.doc._attachments){var j=Object.keys(i.doc._attachments);return bb.all(j.map(function(n){var l=i.doc._attachments[n];if("body" in l){var m=l.body,k=l.content_type;return new bb(function(o){bh(m,k,g,function(p){i.doc._attachments[n]=b9.extend(f8(l,["digest","content_type"]),{data:p}),o()})})}}))}}))}function al(m,g,k){function i(){n--,n||j()}function j(){l.length&&l.forEach(function(q){var r=p.index("digestSeq").count(IDBKeyRange.bound(q+"::",q+"::￿",!1,!1));r.onsuccess=function(s){var u=s.target.result;u||h["delete"](q)}})}var l=[],o=k.objectStore(dJ),h=k.objectStore(aF),p=k.objectStore(dx),n=m.length;m.forEach(function(s){var r=o.index("_doc_id_rev"),q=g+"::"+s;r.getKey(q).onsuccess=function(u){var w=u.target.result;if("number"!=typeof w){return i()}o["delete"](w);var v=p.index("seq").openCursor(IDBKeyRange.only(w));v.onsuccess=function(x){var z=x.target.result;if(z){var y=z.value.digestSeq.split("::")[0];l.push(y),p["delete"](z.primaryKey),z["continue"]()}else{i()}}}})}function jW(i,g,j){try{return{txn:i.transaction(g,j)}}catch(h){return{error:h}}}function aq(v,x,r,m,C,j,k){function D(){var P=[jO,dJ,aF,jL,dx],O=jW(C,P,"readwrite");return O.error?k(O.error):(y=O.txn,y.onabort=bL(k),y.ontimeout=bL(k),y.oncomplete=G,q=y.objectStore(jO),A=y.objectStore(dJ),L=y.objectStore(aF),z=y.objectStore(dx),void g(function(Q){return Q?(F=!0,k(Q)):void h()}))}function I(){bl(v.revs_limit,N,m,w,y,s,l,r)}function h(){function S(){++U===N.length&&I()}function Q(W){var V=bs(W.target.result);V&&w.set(V.id,V),S()}if(N.length){for(var U=0,R=0,T=N.length;T>R;R++){var P=N[R];if(P._id&&ep(P._id)){S()}else{var O=q.get(P.metadata.id);O.onsuccess=Q}}}}function G(){F||(j.notify(m._meta.name),m._meta.docCount+=B,k(null,s))}function p(P,O){var Q=L.get(P);Q.onsuccess=function(S){if(S.target.result){O()}else{var R=av(e6,"unknown stub attachment with digest "+P);R.status=412,O(R)}}}function g(Q){function O(){++R===S.length&&Q(P)}var S=[];if(N.forEach(function(T){T.data&&T.data._attachments&&Object.keys(T.data._attachments).forEach(function(V){var U=T.data._attachments[V];U.stub&&S.push(U.digest)})}),!S.length){return Q()}var P,R=0;S.forEach(function(T){p(T,function(U){U&&!P&&(P=U),O()})})}function l(U,O,S,Q,R,T,W,P){B+=T,U.metadata.winningRev=O,U.metadata.deleted=S;var X=U.data;X._id=U.metadata.id,X._rev=U.metadata.rev,Q&&(X._deleted=!0);var V=X._attachments&&Object.keys(X._attachments).length;return V?n(U,O,S,R,W,P):void K(U,O,S,R,W,P)}function K(X,Q,S,R,U,O){function W(ao){var ai=X.stemmedRevs||[];R&&m.auto_compaction&&(ai=ai.concat(cV(X.metadata))),ai&&ai.length&&al(ai,X.metadata.id,y),T.seq=ao.target.result,delete T.rev;var ae=dj(T,Q,S),an=q.put(ae);an.onsuccess=Z}function P(an){an.preventDefault(),an.stopPropagation();var ai=A.index("_doc_id_rev"),ae=ai.getKey(V._doc_id_rev);ae.onsuccess=function(ar){var ao=A.put(V,ar.target.result);ao.onsuccess=W}}function Z(){s[U]={ok:!0,id:T.id,rev:Q},w.set(X.metadata.id,X.metadata),u(X,T.seq,O)}var V=X.data,T=X.metadata;V._doc_id_rev=T.id+"::"+T.rev,delete V._id,delete V._rev;var Y=A.put(V);Y.onsuccess=W,Y.onerror=P}function n(W,P,T,R,S,U){function Y(){X===V.length&&K(W,P,T,R,S,U)}function Q(){X++,Y()}var O=W.data,X=0,V=Object.keys(O._attachments);V.forEach(function(ae){var ai=W.data._attachments[ae];if(ai.stub){X++,Y()}else{var Z=ai.data;delete ai.data,ai.revpos=parseInt(P,10);var an=ai.digest;E(an,Z,Q)}})}function u(V,S,P){function U(){++R===Q.length&&P()}function O(X){var W=V.data._attachments[X].digest,Y=z.put({seq:S,digestSeq:W+"::"+S});Y.onsuccess=U,Y.onerror=function(Z){Z.preventDefault(),Z.stopPropagation(),U()}}var R=0,Q=Object.keys(V.data._attachments||{});if(!Q.length){return P()}for(var T=0;T<Q.length;T++){O(Q[T])}}function E(Q,O,R){var P=L.count(Q);P.onsuccess=function(V){var S=V.target.result;if(S){return R()}var U={digest:Q,body:O},T=L.put(U);T.onsuccess=R}}for(var y,q,A,L,z,H,N=x.docs,B=0,M=0,J=N.length;J>M;M++){var o=N[M];o._id&&ep(o._id)||(o=N[M]=cm(o,r.new_edits),o.error&&!H&&(H=o))}if(H){return k(H)}var s=new Array(N.length),w=new d4.Map,F=!1,i=m._meta.blobSupport?"blob":"base64";eg(N,i,function(O){return O?k(O):void D()})}function cR(h,k,j,l,i){try{if(h&&k){return i?IDBKeyRange.bound(k,h,!j,!1):IDBKeyRange.bound(h,k,!1,!j)}if(h){return i?IDBKeyRange.upperBound(h):IDBKeyRange.lowerBound(h)}if(k){return i?IDBKeyRange.lowerBound(k,!j):IDBKeyRange.upperBound(k,!j)}if(l){return IDBKeyRange.only(l)}}catch(g){return{error:g}}return null}function aE(i,g,j,h){return"DataError"===j.name&&0===j.code?h(null,{total_rows:i._meta.docCount,offset:g.skip,rows:[]}):void h(av(ba,j.name,j.message))}function c5(h,k,j,l){function i(A,F){function y(L,O,M){var N=L.id+"::"+M;w.get(N).onsuccess=function(P){O.doc=fJ(P.target.result),A.conflicts&&(O.doc._conflicts=dA(L)),jG(O.doc,A,m)}}function v(L,N,M){var P={id:M.id,key:M.id,value:{rev:N}},O=M.deleted;if("ok"===A.deleted){D.push(P),O?(P.value.deleted=!0,P.doc=null):A.include_docs&&y(M,P,N)}else{if(!O&&p--<=0&&(D.push(P),A.include_docs&&y(M,P,N),0===--u)){return}}L["continue"]()}function o(M){K=k._meta.docCount;var O=M.target.result;if(O){var L=bs(O.value),N=L.winningRev;v(O,N,L)}}function J(){F(null,{total_rows:K,offset:A.skip,rows:D})}function s(){A.attachments?cZ(D,A.binary).then(J):J()}var H="startkey" in A?A.startkey:!1,C="endkey" in A?A.endkey:!1,q="key" in A?A.key:!1,p=A.skip||0,u="number"==typeof A.limit?A.limit:-1,z=A.inclusive_end!==!1,I="descending" in A&&A.descending?"prev":null,B=cR(H,C,z,q,I);if(B&&B.error){return aE(k,A,B.error,F)}var r=[jO,dJ];A.attachments&&r.push(aF);var E=jW(j,r,"readonly");if(E.error){return F(E.error)}var m=E.txn,n=m.objectStore(jO),G=m.objectStore(dJ),x=I?n.openCursor(B,I):n.openCursor(B),w=G.index("_doc_id_rev"),D=[],K=0;m.oncomplete=s,x.onsuccess=o}function g(m,n){return 0===m.limit?n(null,{total_rows:k._meta.docCount,offset:m.skip,rows:[]}):void i(m,n)}g(h,l)}function cw(g){return new bb(function(h){var i=bY([""]);g.objectStore(aS).put(i,"key"),g.onabort=function(j){j.preventDefault(),j.stopPropagation(),h(!1)},g.oncomplete=function(){var j=navigator.userAgent.match(/Chrome\/(\d+)/),k=navigator.userAgent.match(/Edge\//);h(k||!j||parseInt(j[1],10)>=43)}})["catch"](function(){return !1})}function jV(g,i){var h=this;bf.queue.push({action:function(j){aH(h,g,j)},callback:i}),aN(h.constructor)}function aH(n,o,u){function h(x){var w=x.createObjectStore(jO,{keyPath:"id"});x.createObjectStore(dJ,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),x.createObjectStore(aF,{keyPath:"digest"}),x.createObjectStore(j7,{keyPath:"id",autoIncrement:!1}),x.createObjectStore(aS),w.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),x.createObjectStore(jL,{keyPath:"_id"});var v=x.createObjectStore(dx,{autoIncrement:!0});v.createIndex("seq","seq"),v.createIndex("digestSeq","digestSeq",{unique:!0})}function i(x,w){var v=x.objectStore(jO);v.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),v.openCursor().onsuccess=function(z){var B=z.target.result;if(B){var y=B.value,A=bI(y);y.deletedOrLocal=A?"1":"0",v.put(y),B["continue"]()}else{w()}}}function s(v){v.createObjectStore(jL,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}function m(y,v){var z=y.objectStore(jL),w=y.objectStore(jO),x=y.objectStore(dJ),A=w.openCursor();A.onsuccess=function(D){var M=D.target.result;if(M){var G=M.value,J=G.id,I=ep(J),F=d8(G);if(I){var C=J+"::"+F,L=J+"::",E=J+"::~",B=x.index("_doc_id_rev"),K=IDBKeyRange.bound(L,E,!1,!1),H=B.openCursor(K);H.onsuccess=function(N){if(H=N.target.result){var O=H.value;O._doc_id_rev===C&&z.put(O),x["delete"](H.primaryKey),H["continue"]()}else{w["delete"](M.primaryKey),M["continue"]()}}}else{M["continue"]()}}else{v&&v()}}}function j(w){var v=w.createObjectStore(dx,{autoIncrement:!0});v.createIndex("seq","seq"),v.createIndex("digestSeq","digestSeq",{unique:!0})}function k(y,v){var z=y.objectStore(dJ),w=y.objectStore(aF),x=y.objectStore(dx),A=w.count();A.onsuccess=function(B){var C=B.target.result;return C?void (z.openCursor().onsuccess=function(F){var L=F.target.result;if(!L){return v()}for(var K=L.value,D=L.primaryKey,H=Object.keys(K._attachments||{}),J={},I=0;I<H.length;I++){var G=K._attachments[H[I]];J[G.digest]=!0}var E=Object.keys(J);for(I=0;I<E.length;I++){var M=E[I];x.put({seq:D,digestSeq:M+"::"+D})}L["continue"]()}):v()}}function p(z){function v(A){return A.data?bs(A):(A.deleted="1"===A.deletedOrLocal,A)}var y=z.objectStore(dJ),x=z.objectStore(jO),w=x.openCursor();w.onsuccess=function(C){function D(){var H=B.id+"::",F=B.id+"::￿",G=y.index("_doc_id_rev").openCursor(IDBKeyRange.bound(H,F)),I=0;G.onsuccess=function(K){var J=K.target.result;if(!J){return B.seq=I,A()}var L=J.primaryKey;L>I&&(I=L),J["continue"]()}}function A(){var G=dj(B,B.winningRev,B.deleted),F=x.put(G);F.onsuccess=function(){E["continue"]()}}var E=C.target.result;if(E){var B=v(E.value);return B.winningRev=B.winningRev||d8(B),B.seq?A():void D()}}}var g=o.name,q=null;n._meta=null,n.type=function(){return"idb"},n._id=fD(function(v){v(null,n._meta.instanceId)}),n._bulkDocs=function(v,w,x){aq(o,v,w,n,q,ej,x)},n._get=function(A,v,D){function y(){D(B,{doc:z,metadata:x,ctx:w})}var z,x,B,w=v.ctx;if(!w){var C=jW(q,[jO,dJ,aF],"readonly");if(C.error){return D(C.error)}w=C.txn}w.objectStore(jO).get(A).onsuccess=function(E){if(x=bs(E.target.result),!x){return B=av(eQ,"missing"),y()}if(bI(x)&&!v.rev){return B=av(eQ,"deleted"),y()}var G=w.objectStore(dJ),H=v.rev||x.winningRev,F=x.id+"::"+H;G.index("_doc_id_rev").get(F).onsuccess=function(I){return z=I.target.result,z&&(z=fJ(z)),z?void y():(B=av(eQ,"missing"),y())}}},n._getAttachment=function(A,v,D,y,z){var x;if(y.ctx){x=y.ctx}else{var B=jW(q,[jO,dJ,aF],"readonly");if(B.error){return z(B.error)}x=B.txn}var w=D.digest,C=D.content_type;x.objectStore(aF).get(w).onsuccess=function(E){var F=E.target.result.body;bh(F,C,y.binary,function(G){z(null,G)})}},n._info=function(A){if(null===q||!fA.has(g)){var y=new Error("db isn't open");return y.id="idbNull",A(y)}var B,z,x=jW(q,[dJ],"readonly");if(x.error){return A(x.error)}var w=x.txn,v=w.objectStore(dJ).openCursor(null,"prev");v.onsuccess=function(D){var C=D.target.result;B=C?C.key:0,z=n._meta.docCount},w.oncomplete=function(){A(null,{doc_count:z,update_seq:B,idb_attachment_format:n._meta.blobSupport?"binary":"base64"})}},n._allDocs=function(v,w){c5(v,n,q,w)},n._changes=function(F){function z(N){function T(){return S.seq!==O?N["continue"]():(D=O,S.winningRev===P._rev?R(P):void Q())}function Q(){var U=P._id+"::"+S.winningRev,V=C.get(U);V.onsuccess=function(W){R(fJ(W.target.result))}}function R(V){var W=F.processChange(V,S,F);W.seq=S.seq;var U=K(W);return"object"==typeof U?F.complete(U):(U&&(w++,J&&H.push(W),F.attachments&&F.include_docs?jG(V,F,x,function(){cZ([W],F.binary).then(function(){F.onChange(W)})}):F.onChange(W)),void (w!==B&&N["continue"]()))}var P=fJ(N.value),O=N.key;if(L&&!L.has(P._id)){return N["continue"]()}var S;return(S=y.get(P._id))?T():void (A.get(P._id).onsuccess=function(U){S=bs(U.target.result),y.set(P._id,S),T()})}function v(N){var O=N.target.result;O&&z(O)}function G(){var P=[jO,dJ];F.attachments&&P.push(aF);var O=jW(q,P,"readonly");if(O.error){return F.complete(O.error)}x=O.txn,x.onabort=bL(F.complete),x.oncomplete=I,E=x.objectStore(dJ),A=x.objectStore(jO),C=E.index("_doc_id_rev");var N;N=F.descending?E.openCursor(null,"prev"):E.openCursor(IDBKeyRange.lowerBound(F.since,!0)),N.onsuccess=v}function I(){function N(){F.complete(null,{results:H,last_seq:D})}!F.continuous&&F.attachments?cZ(H).then(N):N()}if(F=dY(F),F.continuous){var M=g+":"+e0();return ej.addListener(g,M,n,F),ej.notify(g),{cancel:function(){ej.removeListener(g,M)}}}var L=F.doc_ids&&new d4.Set(F.doc_ids);F.since=F.since||0;var D=F.since,B="limit" in F?F.limit:-1;0===B&&(B=1);var J;J="return_docs" in F?F.return_docs:"returnDocs" in F?F.returnDocs:!0;var x,E,A,C,H=[],w=0,K=fE(F),y=new d4.Map;G()},n._close=function(v){return null===q?v(av(cu)):(q.close(),fA["delete"](g),q=null,void v())},n._getRevisionTree=function(z,v){var y=jW(q,[jO],"readonly");if(y.error){return v(y.error)}var x=y.txn,w=x.objectStore(jO).get(z);w.onsuccess=function(B){var A=bs(B.target.result);A?v(null,A.rev_tree):v(av(eQ))}},n._doCompaction=function(y,A,z){var v=[jO,dJ,aF,dx],B=jW(q,v,"readwrite");if(B.error){return z(B.error)}var x=B.txn,w=x.objectStore(jO);w.get(y).onsuccess=function(E){var C=bs(E.target.result);b1(C.rev_tree,function(L,H,K,G,J){var I=H+"-"+K;-1!==A.indexOf(I)&&(J.status="missing")}),al(A,y,x);var D=C.winningRev,F=C.deleted;x.objectStore(jO).put(dj(C,D,F))},x.onabort=bL(z),x.oncomplete=function(){z()}},n._getLocal=function(z,v){var y=jW(q,[jL],"readonly");if(y.error){return v(y.error)}var x=y.txn,w=x.objectStore(jL).get(z);w.onerror=bL(v),w.onsuccess=function(B){var A=B.target.result;A?(delete A._doc_id_rev,v(null,A)):v(av(eQ))}},n._putLocal=function(E,z,x){"function"==typeof z&&(x=z,z={}),delete E._revisions;var C=E._rev,D=E._id;C?E._rev="0-"+(parseInt(C.split("-")[1],10)+1):E._rev="0-1";var B,w=z.ctx;if(!w){var A=jW(q,[jL],"readwrite");if(A.error){return x(A.error)}w=A.txn,w.onerror=bL(x),w.oncomplete=function(){B&&x(null,B)}}var y,v=w.objectStore(jL);C?(y=v.get(D),y.onsuccess=function(H){var G=H.target.result;if(G&&G._rev===C){var F=v.put(E);F.onsuccess=function(){B={ok:!0,id:E._id,rev:E._rev},z.ctx&&x(null,B)}}else{x(av(eW))}}):(y=v.add(E),y.onerror=function(F){x(av(eW)),F.preventDefault(),F.stopPropagation()},y.onsuccess=function(){B={ok:!0,id:E._id,rev:E._rev},z.ctx&&x(null,B)})},n._removeLocal=function(A,v,D){"function"==typeof v&&(D=v,v={});var y=v.ctx;if(!y){var z=jW(q,[jL],"readwrite");if(z.error){return D(z.error)}y=z.txn,y.oncomplete=function(){x&&D(null,x)}}var x,B=A._id,w=y.objectStore(jL),C=w.get(B);C.onerror=bL(D),C.onsuccess=function(F){var E=F.target.result;E&&E._rev===A._rev?(w["delete"](B),x={ok:!0,id:B,rev:"0-0"},v.ctx&&D(null,x)):D(av(eQ))}},n._destroy=function(y,w){ej.removeAllListeners(g);var v=jS.get(g);v&&v.result&&(v.result.close(),fA["delete"](g));var x=indexedDB.deleteDatabase(g);x.onsuccess=function(){jS["delete"](g),f5()&&g in localStorage&&delete localStorage[g],w(null,{ok:!0})},x.onerror=bL(w)};var l=fA.get(g);if(l){return q=l.idb,n._meta=l.global,void eB.nextTick(function(){u(null,n)})}var r;r=o.storage?aR(g,o.storage):indexedDB.open(g,dG),jS.set(g,r),r.onupgradeneeded=function(v){function y(){var B=x[A-1];A++,B&&B(z,y)}var w=v.target.result;if(v.oldVersion<1){return h(w)}var z=v.currentTarget.transaction;v.oldVersion<3&&s(w),v.oldVersion<4&&j(w);var x=[i,m,k,p],A=v.oldVersion;y()},r.onsuccess=function(w){q=w.target.result,q.onversionchange=function(){q.close(),fA["delete"](g)},q.onabort=function(B){eA("error","Database has a global failure",B.target.error),q.close(),fA["delete"](g)};var z=q.transaction([j7,aS,jO],"readwrite"),x=z.objectStore(j7).get(j7),v=null,y=null,A=null;x.onsuccess=function(D){var B=function(){null!==v&&null!==y&&null!==A&&(n._meta={name:g,instanceId:A,blobSupport:v,docCount:y},fA.set(g,{idb:q,global:n._meta}),u(null,n))},E=D.target.result||{id:j7};g+"_id" in E?(A=E[g+"_id"],B()):(A=e0(),E[g+"_id"]=A,z.objectStore(j7).put(E).onsuccess=function(){B()}),ck||(ck=cw(z)),ck.then(function(F){v=F,B()});var C=z.objectStore(jO).index("deletedOrLocal");C.count(IDBKeyRange.only("0")).onsuccess=function(F){y=F.target.result,B()}}},r.onerror=function(){var v="Failed to open indexedDB, are you in private browsing mode?";eA("error",v),u(av(ba,v))}}function aR(g,i){try{return indexedDB.open(g,{version:dG,storage:i})}catch(h){return indexedDB.open(g,dG)}}function jN(g){g.adapter("idb",jV,!0)}function bH(g){return decodeURIComponent(escape(g))}function cy(g){return 65>g?g-48:g-55}function bd(i,g,j){for(var h="";j>g;){h+=String.fromCharCode(cy(i.charCodeAt(g++))<<4|cy(i.charCodeAt(g++)))}return h}function cv(i,g,j){for(var h="";j>g;){h+=String.fromCharCode(cy(i.charCodeAt(g+2))<<12|cy(i.charCodeAt(g+3))<<8|cy(i.charCodeAt(g))<<4|cy(i.charCodeAt(g+1))),g+=4}return h}function cU(h,g){return"UTF-8"===g?bH(bd(h,0,h.length)):cv(h,0,h.length)}function jT(g){return"'"+g+"'"}function j8(g){return g.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"")}function b7(g){return g.replace(/\u0001\u0001/g,"\x00").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,"")}function am(g){return delete g._id,delete g._rev,JSON.stringify(g)}function cQ(g,i,h){return g=JSON.parse(g),g._id=i,g._rev=h,g}function dX(h){for(var g="(";h--;){g+="?",h&&(g+=",")}return g+")"}function cX(g,j,i,k,h){return"SELECT "+g+" FROM "+("string"==typeof j?j:j.join(" JOIN "))+(i?" ON "+i:"")+(k?" WHERE "+("string"==typeof k?k:k.join(" AND ")):"")+(h?" ORDER BY "+h:"")}function aa(j,m,g){function i(){++l===j.length&&k()}function k(){if(h.length){var n="SELECT DISTINCT digest AS digest FROM "+ak+" WHERE seq IN "+dX(h.length);g.executeSql(n,h,function(q,o){for(var s=[],p=0;p<o.rows.length;p++){s.push(o.rows.item(p).digest)}if(s.length){var r="DELETE FROM "+ak+" WHERE seq IN ("+h.map(function(){return"?"}).join(",")+")";q.executeSql(r,h,function(v){var u="SELECT digest FROM "+ak+" WHERE digest IN ("+s.map(function(){return"?"}).join(",")+")";v.executeSql(u,s,function(z,w){for(var y=new d4.Set,x=0;x<w.rows.length;x++){y.add(w.rows.item(x).digest)}s.forEach(function(A){y.has(A)||(z.executeSql("DELETE FROM "+ak+" WHERE digest=?",[A]),z.executeSql("DELETE FROM "+kc+" WHERE digest=?",[A]))})})})}})}}if(j.length){var l=0,h=[];j.forEach(function(o){var n="SELECT seq FROM "+j4+" WHERE doc_id=? AND rev=?";g.executeSql(n,[m,o],function(q,p){if(!p.rows.length){return i()}var r=p.rows.item(0).seq;h.push(r),q.executeSql("DELETE FROM "+j4+" WHERE seq=?",[r],i)})})}}function fF(g){return function(h){eA("error","WebSQL threw an error",h);var k=h&&h.constructor.toString().match(/function ([^\(]+)/),i=k&&k[1]||h.type,j=h.target||h.message;g(av(fG,j,i))}}function cK(h){if("size" in h){return 1000000*h.size}var g="undefined"!=typeof navigator&&/Android/.test(navigator.userAgent);return g?5000000:1}function cB(q,h,i,n,g,s,j){function m(){return p?j(p):(s.notify(n._name),n._docCount=-1,void j(null,w))}function z(E,D){var F="SELECT count(*) as cnt FROM "+kc+" WHERE digest=?";A.executeSql(F,[E],function(G,H){if(0===H.rows.item(0).cnt){var I=av(e6,"unknown stub attachment with digest "+E);D(I)}else{D()}})}function B(F){function D(){++G===H.length&&F(E)}var H=[];if(o.forEach(function(I){I.data&&I.data._attachments&&Object.keys(I.data._attachments).forEach(function(J){var K=I.data._attachments[J];K.stub&&H.push(K.digest)})}),!H.length){return F()}var E,G=0;H.forEach(function(I){z(I,function(J){J&&!E&&(E=J),D()})})}function l(F,N,I,D,Q,K,P,M){function H(){function U(ar,at){function a0(){return ++an===ae.length&&at(),!1}function ai(a3){var a1="INSERT INTO "+ak+" (digest, seq) VALUES (?,?)",a2=[T._attachments[a3].digest,ar];A.executeSql(a1,a2,a0,a0)}var an=0,ae=Object.keys(T._attachments||{});if(!ae.length){return at()}for(var ao=0;ao<ae.length;ao++){ai(ae[ao])}}var T=F.data,W=D?1:0,Z=T._id,V=T._rev,X=am(T),Y="INSERT INTO "+j4+" (doc_id, rev, json, deleted) VALUES (?, ?, ?, ?);",S=[Z,V,X,W];A.executeSql(Y,S,function(ae,an){var ai=an.insertId;U(ai,function(){G(ae,ai)})},function(){var ae=cX("seq",j4,null,"doc_id=? AND rev=?");return A.executeSql(ae,[Z,V],function(ai,an){var ao=an.rows.item(0).seq,ar="UPDATE "+j4+" SET json=?, deleted=? WHERE doc_id=? AND rev=?;",at=[X,W,Z,V];ai.executeSql(ar,at,function(a0){U(ao,function(){G(a0,ao)})})}),!1})}function E(S){R||(S?(R=S,M(R)):L===J.length&&H())}function O(S){L++,E(S)}function G(T,S){var V=F.metadata.id,U=F.stemmedRevs||[];Q&&n.auto_compaction&&(U=cV(F.metadata).concat(U)),U.length&&aa(U,V,T),F.metadata.seq=S,delete F.metadata.rev;var W=Q?"UPDATE "+dL+" SET json=?, max_seq=?, winningseq=(SELECT seq FROM "+j4+" WHERE doc_id="+dL+".id AND rev=?) WHERE id=?":"INSERT INTO "+dL+" (id, winningseq, max_seq, json) VALUES (?,?,?,?);",X=fK(F.metadata),Y=Q?[X,S,N,V]:[V,S,S,X];T.executeSql(W,Y,function(){w[P]={ok:!0,id:F.metadata.id,rev:N},r.set(V,F.metadata),M()})}var R=null,L=0;F.data._id=F.metadata.id,F.data._rev=F.metadata.rev;var J=Object.keys(F.data._attachments||{});D&&(F.data._deleted=!0),J.forEach(function(U){var S=F.data._attachments[U];if(S.stub){L++,E()}else{var T=S.data;delete S.data,S.revpos=parseInt(N,10);var V=S.digest;x(V,T,O)}}),J.length||H()}function v(){bl(q.revs_limit,o,n,r,A,w,l,i)}function k(E){function D(){++F===o.length&&E()}if(!o.length){return E()}var F=0;o.forEach(function(G){if(G._id&&ep(G._id)){return D()}var H=G.metadata.id;A.executeSql("SELECT json FROM "+dL+" WHERE id = ?",[H],function(I,K){if(K.rows.length){var J=dM(K.rows.item(0).json);r.set(H,J)}D()})})}function x(F,D,G){var E="SELECT digest FROM "+kc+" WHERE digest=?";A.executeSql(E,[F],function(H,I){return I.rows.length?G():(E="INSERT INTO "+kc+" (digest, body, escaped) VALUES (?,?,1)",void H.executeSql(E,[F,j8(D)],function(){G()},function(){return G(),!1}))})}var u=i.new_edits,y=h.docs,o=y.map(function(E){if(E._id&&ep(E._id)){return E}var D=cm(E,u);return D}),C=o.filter(function(D){return D.error});if(C.length){return j(C[0])}var A,p,w=new Array(o.length),r=new d4.Map;eg(o,"binary",function(D){return D?j(D):void g.transaction(function(E){A=E,B(function(F){F?p=F:k(v)})},fF(j),m)})}function dB(g){return g.websql(g.name,g.version,g.description,g.size)}function d7(h){try{return{db:dB(h)}}catch(g){return{error:g}}}function cT(h){var g=bX.get(h.name);return g||(g=d7(h),bX.set(h.name,g),g.db&&(g.db._sqlitePlugin="undefined"!=typeof sqlitePlugin)),g}function dW(k,m,i,g,h){function j(){++o===n.length&&h&&h()}function l(q,s){var r=q._attachments[s],p={binary:m.binary,ctx:g};i._getAttachment(q._id,s,r,p,function(u,v){q._attachments[s]=b9.extend(f8(r,["digest","content_type"]),{data:v}),j()})}var n=Object.keys(k._attachments||{});if(!n.length){return h&&h()}var o=0;n.forEach(function(p){m.attachments&&m.include_docs?l(k,p):(k._attachments[p].stub=!0,j())})}function bv(r,h){function s(){f5()&&(window.localStorage["_pouch__websqldb_"+y._name]=!0),h(null,y)}function j(F,E){F.executeSql(aj),F.executeSql("ALTER TABLE "+j4+" ADD COLUMN deleted TINYINT(1) DEFAULT 0",[],function(){F.executeSql(jZ),F.executeSql("ALTER TABLE "+dL+" ADD COLUMN local TINYINT(1) DEFAULT 0",[],function(){F.executeSql("CREATE INDEX IF NOT EXISTS 'doc-store-local-idx' ON "+dL+" (local, id)");var G="SELECT "+dL+".winningseq AS seq, "+dL+".json AS metadata FROM "+j4+" JOIN "+dL+" ON "+j4+".seq = "+dL+".winningseq";F.executeSql(G,[],function(M,I){for(var L=[],O=[],H=0;H<I.rows.length;H++){var J=I.rows.item(H),K=J.seq,N=JSON.parse(J.metadata);bI(N)&&L.push(K),ep(N.id)&&O.push(N.id)}M.executeSql("UPDATE "+dL+"SET local = 1 WHERE id IN "+dX(O.length),O,function(){M.executeSql("UPDATE "+j4+" SET deleted = 1 WHERE seq IN "+dX(L.length),L,E)})})})})}function p(F,E){var G="CREATE TABLE IF NOT EXISTS "+bu+" (id UNIQUE, rev, json)";F.executeSql(G,[],function(){var H="SELECT "+dL+".id AS id, "+j4+".json AS data FROM "+j4+" JOIN "+dL+" ON "+j4+".seq = "+dL+".winningseq WHERE local = 1";F.executeSql(H,[],function(K,M){function J(){if(!L.length){return E(K)}var O=L.shift(),N=JSON.parse(O.data)._rev;K.executeSql("INSERT INTO "+bu+" (id, rev, json) VALUES (?,?,?)",[O.id,N,O.data],function(P){P.executeSql("DELETE FROM "+dL+" WHERE id=?",[O.id],function(Q){Q.executeSql("DELETE FROM "+j4+" WHERE seq=?",[O.seq],function(){J()})})})}for(var L=[],I=0;I<M.rows.length;I++){L.push(M.rows.item(I))}J()})})}function n(G,E){function H(J){function I(){if(!J.length){return E(G)}var N=J.shift(),L=cU(N.hex,C),O=L.lastIndexOf("::"),M=L.substring(0,O),K=L.substring(O+2),P="UPDATE "+j4+" SET doc_id=?, rev=? WHERE doc_id_rev=?";G.executeSql(P,[M,K,L],function(){I()})}I()}var F="ALTER TABLE "+j4+" ADD COLUMN doc_id";G.executeSql(F,[],function(J){var I="ALTER TABLE "+j4+" ADD COLUMN rev";J.executeSql(I,[],function(K){K.executeSql(bD,[],function(L){var M="SELECT hex(doc_id_rev) as hex FROM "+j4;L.executeSql(M,[],function(P,N){for(var O=[],Q=0;Q<N.rows.length;Q++){O.push(N.rows.item(Q))}H(O)})})})})}function D(G,E){function H(I){var J="SELECT COUNT(*) AS cnt FROM "+kc;I.executeSql(J,[],function(M,O){function L(){var Q=cX(bg+", "+dL+".id AS id",[dL,j4],bZ,null,dL+".id ");Q+=" LIMIT "+P+" OFFSET "+K,K+=P,M.executeSql(Q,[],function(ai,S){function W(at,ar){var ao=U[at]=U[at]||[];-1===ao.indexOf(ar)&&ao.push(ar)}if(!S.rows.length){return E(ai)}for(var U={},Z=0;Z<S.rows.length;Z++){for(var R=S.rows.item(Z),an=cQ(R.data,R.id,R.rev),V=Object.keys(an._attachments||{}),ae=0;ae<V.length;ae++){var T=an._attachments[V[ae]];W(T.digest,R.seq)}}var X=[];if(Object.keys(U).forEach(function(ar){var ao=U[ar];ao.forEach(function(at){X.push([ar,at])})}),!X.length){return L()}var Y=0;X.forEach(function(ao){var ar="INSERT INTO "+ak+" (digest, seq) VALUES (?,?)";ai.executeSql(ar,ao,function(){++Y===X.length&&L()})})})}var N=O.rows.item(0).cnt;if(!N){return E(M)}var K=0,P=10;L()})}var F="CREATE TABLE IF NOT EXISTS "+ak+" (digest, seq INTEGER)";G.executeSql(F,[],function(I){I.executeSql(dl,[],function(J){J.executeSql(ab,[],H)})})}function w(F,E){var G="ALTER TABLE "+kc+" ADD COLUMN escaped TINYINT(1) DEFAULT 0";F.executeSql(G,[],E)}function A(F,E){var G="ALTER TABLE "+dL+" ADD COLUMN max_seq INTEGER";F.executeSql(G,[],function(I){var H="UPDATE "+dL+" SET max_seq=(SELECT MAX(seq) FROM "+j4+" WHERE doc_id=id)";I.executeSql(H,[],function(J){var K="CREATE UNIQUE INDEX IF NOT EXISTS 'doc-max-seq-idx' ON "+dL+" (max_seq)";J.executeSql(K,[],E)})})}function x(F,E){F.executeSql('SELECT HEX("a") AS hex',[],function(I,G){var H=G.rows.item(0).hex;C=2===H.length?"UTF-8":"UTF-16",E()})}function B(){for(;q.length>0;){var E=q.pop();E(null,g)}}function i(M,I){if(0===I){var F="CREATE TABLE IF NOT EXISTS "+j6+" (dbid, db_version INTEGER)",O="CREATE TABLE IF NOT EXISTS "+kc+" (digest UNIQUE, escaped TINYINT(1), body BLOB)",L="CREATE TABLE IF NOT EXISTS "+ak+" (digest, seq INTEGER)",J="CREATE TABLE IF NOT EXISTS "+dL+" (id unique, json, winningseq, max_seq INTEGER UNIQUE)",K="CREATE TABLE IF NOT EXISTS "+j4+" (seq INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, json, deleted TINYINT(1), doc_id, rev)",E="CREATE TABLE IF NOT EXISTS "+bu+" (id UNIQUE, rev, json)";M.executeSql(O),M.executeSql(E),M.executeSql(L,[],function(){M.executeSql(ab),M.executeSql(dl)}),M.executeSql(J,[],function(){M.executeSql(aj),M.executeSql(K,[],function(){M.executeSql(jZ),M.executeSql(bD),M.executeSql(F,[],function(){var R="INSERT INTO "+j6+" (db_version, dbid) VALUES (?,?)";g=e0();var Q=[bN,g];M.executeSql(R,Q,function(){B()})})})})}else{var G=function(){var Q=bN>I;Q&&M.executeSql("UPDATE "+j6+" SET db_version = "+bN);var R="SELECT dbid FROM "+j6;M.executeSql(R,[],function(T,S){g=S.rows.item(0).dbid,B()})},P=[j,p,n,D,w,A,G],N=I,H=function(Q){P[N-1](Q,H),N++};H(M)}}function m(){z.transaction(function(E){x(E,function(){v(E)})},fF(h),s)}function v(F){var E="SELECT sql FROM sqlite_master WHERE tbl_name = "+j6;F.executeSql(E,[],function(H,G){G.rows.length?/db_version/.test(G.rows.item(0).sql)?H.executeSql("SELECT db_version FROM "+j6,[],function(I,K){var J=K.rows.item(0).db_version;i(I,J)}):H.executeSql("ALTER TABLE "+j6+" ADD COLUMN db_version INTEGER",[],function(){i(H,1)}):i(H,0)})}function o(F,E){if(-1!==y._docCount){return E(y._docCount)}var G=cX("COUNT("+dL+".id) AS 'num'",[dL,j4],bZ,j4+".deleted=0");F.executeSql(G,[],function(I,H){y._docCount=H.rows.item(0).num,E(y._docCount)})}var C,y=this,g=null,k=cK(r),q=[];y._docCount=-1,y._name=r.name;var u=b9.extend({},r,{version:b0,description:r.name,size:k}),l=cT(u);if(l.error){return fF(h)(l.error)}var z=l.db;"function"!=typeof z.readTransaction&&(z.readTransaction=z.transaction),m(),y.type=function(){return"websql"},y._id=fD(function(E){E(null,g)}),y._info=function(E){z.readTransaction(function(F){o(F,function(H){var G="SELECT MAX(seq) AS seq FROM "+j4;F.executeSql(G,[],function(K,I){var J=I.rows.item(0).seq||0;E(null,{doc_count:H,update_seq:J,sqlite_plugin:z._sqlitePlugin,websql_encoding:C})})})},fF(E))},y._bulkDocs=function(E,G,F){cB(r,E,G,y,z,c7,F)},y._get=function(J,K,H){function E(){H(M,{doc:F,metadata:I,ctx:G})}var F,I,M,G=K.ctx;if(!G){return z.readTransaction(function(O){y._get(J,b9.extend({ctx:O},K),H)})}var N,L;K.rev?(N=cX(bg,[dL,j4],dL+".id="+j4+".doc_id",[j4+".doc_id=?",j4+".rev=?"]),L=[J,K.rev]):(N=cX(bg,[dL,j4],bZ,dL+".id=?"),L=[J]),G.executeSql(N,L,function(O,P){if(!P.rows.length){return M=av(eQ,"missing"),E()}var Q=P.rows.item(0);return I=dM(Q.metadata),Q.deleted&&!K.rev?(M=av(eQ,"deleted"),E()):(F=cQ(Q.data,I.id,Q.rev),void E())})},y._allDocs=function(E,O){var P,I=[],K="startkey" in E?E.startkey:!1,F="endkey" in E?E.endkey:!1,M="key" in E?E.key:!1,Q="descending" in E?E.descending:!1,N="limit" in E?E.limit:-1,L="skip" in E?E.skip:0,H=E.inclusive_end!==!1,R=[],J=[];if(M!==!1){J.push(dL+".id = ?"),R.push(M)}else{if(K!==!1||F!==!1){if(K!==!1&&(J.push(dL+".id "+(Q?"<=":">=")+" ?"),R.push(K)),F!==!1){var G=Q?">":"<";H&&(G+="="),J.push(dL+".id "+G+" ?"),R.push(F)}M!==!1&&(J.push(dL+".id = ?"),R.push(M))}}"ok"!==E.deleted&&J.push(j4+".deleted = 0"),z.readTransaction(function(S){o(S,function(U){if(P=U,0!==N){var T=cX(bg,[dL,j4],bZ,J,dL+".id "+(Q?"DESC":"ASC"));T+=" LIMIT "+N+" OFFSET "+L,S.executeSql(T,R,function(V,Y){for(var X=0,an=Y.rows.length;an>X;X++){var ar=Y.rows.item(X),W=dM(ar.metadata),ai=W.id,ao=cQ(ar.data,ai,ar.rev),ae=ao._rev,Z={id:ai,key:ai,value:{rev:ae}};if(E.include_docs&&(Z.doc=ao,Z.doc._rev=ae,E.conflicts&&(Z.doc._conflicts=dA(W)),dW(Z.doc,E,y,V)),ar.deleted){if("ok"!==E.deleted){continue}Z.value.deleted=!0,Z.doc=null}I.push(Z)}})}})},fF(O),function(){O(null,{total_rows:P,offset:E.skip,rows:I})})},y._changes=function(I){function J(){var S=dL+".json AS metadata, "+dL+".max_seq AS maxSeq, "+j4+".json AS winningDoc, "+j4+".rev AS winningRev ",T=dL+" JOIN "+j4,R=dL+".id="+j4+".doc_id AND "+dL+".winningseq="+j4+".seq",Q=["maxSeq > ?"],O=[I.since];I.doc_ids&&(Q.push(dL+".id IN "+dX(I.doc_ids.length)),O=O.concat(I.doc_ids));var U="maxSeq "+(F?"DESC":"ASC"),N=cX(S,T,R,Q,U),M=fE(I);I.view||I.filter||(N+=" LIMIT "+K);var P=I.since||0;z.readTransaction(function(V){V.executeSql(N,O,function(at,X){function ar(a0){return function(){I.onChange(a0)}}for(var ai=0,Z=X.rows.length;Z>ai;ai++){var Y=X.rows.item(ai),W=dM(Y.metadata);P=Y.maxSeq;var ae=cQ(Y.winningDoc,W.id,Y.winningRev),ao=I.processChange(ae,W,I);ao.seq=Y.maxSeq;var an=M(ao);if("object"==typeof an){return I.complete(an)}if(an&&(E++,H&&G.push(ao),I.attachments&&I.include_docs?dW(ae,I,y,at,ar(ao)):ar(ao)()),E===K){break}}})},fF(I.complete),function(){I.continuous||I.complete(null,{results:G,last_seq:P})})}if(I=dY(I),I.continuous){var L=y._name+":"+e0();return c7.addListener(y._name,L,y,I),c7.notify(y._name),{cancel:function(){c7.removeListener(y._name,L)}}}var F=I.descending;I.since=I.since&&!F?I.since:0;var K="limit" in I?I.limit:-1;0===K&&(K=1);var H;H="return_docs" in I?I.return_docs:"returnDocs" in I?I.returnDocs:!0;var G=[],E=0;J()},y._close=function(E){E()},y._getAttachment=function(J,K,H,E,F){var I,M=E.ctx,G=H.digest,N=H.content_type,L="SELECT escaped, CASE WHEN escaped = 1 THEN body ELSE HEX(body) END AS body FROM "+kc+" WHERE digest=?";M.executeSql(L,[G],function(P,O){var Q=O.rows.item(0),R=Q.escaped?b7(Q.body):cU(Q.body,C);I=E.binary?cH(R,N):c8(R),F(null,I)})},y._getRevisionTree=function(F,E){z.readTransaction(function(H){var G="SELECT json AS metadata FROM "+dL+" WHERE id = ?";H.executeSql(G,[F],function(I,J){if(J.rows.length){var K=dM(J.rows.item(0).metadata);E(null,K.rev_tree)}else{E(av(eQ))}})})},y._doCompaction=function(F,E,G){return E.length?void z.transaction(function(H){var I="SELECT json AS metadata FROM "+dL+" WHERE id = ?";H.executeSql(I,[F],function(L,J){var K=dM(J.rows.item(0).metadata);b1(K.rev_tree,function(O,Q,N,P,S){var R=Q+"-"+N;-1!==E.indexOf(R)&&(S.status="missing")});var M="UPDATE "+dL+" SET json = ? WHERE id = ?";L.executeSql(M,[fK(K),F])}),aa(E,F,H)},fF(G),function(){G()}):G()},y._getLocal=function(F,E){z.readTransaction(function(H){var G="SELECT json, rev FROM "+bu+" WHERE id=?";H.executeSql(G,[F],function(L,J){if(J.rows.length){var K=J.rows.item(0),I=cQ(K.json,F,K.rev);E(null,I)}else{E(av(eQ))}})})},y._putLocal=function(F,J,M){function K(N){var P,O;E?(P="UPDATE "+bu+" SET rev=?, json=? WHERE id=? AND rev=?",O=[L,I,H,E]):(P="INSERT INTO "+bu+" (id, rev, json) VALUES (?,?,?)",O=[H,L,I]),N.executeSql(P,O,function(R,Q){Q.rowsAffected?(G={ok:!0,id:H,rev:L},J.ctx&&M(null,G)):M(av(eW))},function(){return M(av(eW)),!1})}"function"==typeof J&&(M=J,J={}),delete F._revisions;var L,E=F._rev,H=F._id;L=E?F._rev="0-"+(parseInt(E.split("-")[1],10)+1):F._rev="0-1";var G,I=am(F);J.ctx?K(J.ctx):z.transaction(K,fF(M),function(){G&&M(null,G)})},y._removeLocal=function(H,F,E){function G(L){var K="DELETE FROM "+bu+" WHERE id=? AND rev=?",J=[H._id,H._rev];L.executeSql(K,J,function(N,M){return M.rowsAffected?(I={ok:!0,id:H._id,rev:"0-0"},void (F.ctx&&E(null,I))):E(av(eQ))})}"function"==typeof F&&(E=F,F={});var I;F.ctx?G(F.ctx):z.transaction(G,fF(E),function(){I&&E(null,I)})},y._destroy=function(F,E){c7.removeAllListeners(y._name),z.transaction(function(H){var G=[dL,j4,kc,j6,bu,ak];G.forEach(function(I){H.executeSql("DROP TABLE IF EXISTS "+I,[])})},fF(E),function(){f5()&&(delete window.localStorage["_pouch__websqldb_"+y._name],delete window.localStorage[y._name]),E(null,{ok:!0})})}}function aZ(){try{return openDatabase("_pouch_validate_websql",1,"",1),!0}catch(g){return !1}}function kh(){if("undefined"==typeof indexedDB||null===indexedDB||!/iP(hone|od|ad)/.test(navigator.userAgent)){return !0}var g=f5(),i="_pouch__websqldb_valid_"+navigator.userAgent;if(g&&localStorage[i]){return"1"===localStorage[i]}var h=aZ();return g&&(localStorage[i]=h?"1":"0"),h}function jI(){return"undefined"!=typeof SQLitePlugin?!0:"undefined"==typeof openDatabase?!1:kh()}function eE(g){return function(i,l,j,k){if("undefined"!=typeof sqlitePlugin){var h=b9.extend({},g,{name:i,version:l,description:j,size:k});return sqlitePlugin.openDatabase(h)}return openDatabase(i,l,j,k)}}function ac(i,g){var j=eE(i),h=b9.extend({websql:j},i);bv.call(this,h,g)}function bi(g){g.adapter("websql",ac,!0)}function f7(){for(var i={},g=new bb(function(k,l){i.resolve=k,i.reject=l}),j=new Array(arguments.length),h=0;h<j.length;h++){j[h]=arguments[h]}return i.promise=g,bb.resolve().then(function(){return fetch.apply(null,j)}).then(function(k){i.resolve(k)})["catch"](function(k){i.reject(k)}),i}function cI(j,m){var g,i,k,l=new Headers,h={method:j.method,credentials:"include",headers:l};return j.json&&(l.set("Accept","application/json"),l.set("Content-Type",j.headers["Content-Type"]||"application/json")),j.body&&j.body instanceof Blob?j1(j.body,function(n){h.body=n}):j.body&&j.processData&&"string"!=typeof j.body?h.body=JSON.stringify(j.body):"body" in j?h.body=j.body:h.body=null,Object.keys(j.headers).forEach(function(n){j.headers.hasOwnProperty(n)&&l.set(n,j.headers[n])}),g=f7(j.url,h),j.timeout>0&&(i=setTimeout(function(){g.reject(new Error("Load timeout for resource: "+j.url))},j.timeout)),g.promise.then(function(n){return k={statusCode:n.status},j.timeout>0&&clearTimeout(i),k.statusCode>=200&&k.statusCode<300?j.binary?n.blob():n.text():n.json()}).then(function(n){k.statusCode>=200&&k.statusCode<300?m(null,k,n):m(n,k)})["catch"](function(n){m(n,k)}),{abort:g.reject}}function eV(k,m){var i,g,h=!1,j=function(){i.abort()},l=function(){h=!0,i.abort()};i=k.xhr?new k.xhr:new XMLHttpRequest;try{i.open(k.method,k.url)}catch(n){m(n,{statusCode:413})}i.withCredentials="withCredentials" in k?k.withCredentials:!0,"GET"===k.method?delete k.headers["Content-Type"]:k.json&&(k.headers.Accept="application/json",k.headers["Content-Type"]=k.headers["Content-Type"]||"application/json",k.body&&k.processData&&"string"!=typeof k.body&&(k.body=JSON.stringify(k.body))),k.binary&&(i.responseType="arraybuffer"),"body" in k||(k.body=null);for(var o in k.headers){k.headers.hasOwnProperty(o)&&i.setRequestHeader(o,k.headers[o])}return k.timeout>0&&(g=setTimeout(l,k.timeout),i.onprogress=function(){clearTimeout(g),4!==i.readyState&&(g=setTimeout(l,k.timeout))},"undefined"!=typeof i.upload&&(i.upload.onprogress=i.onprogress)),i.onreadystatechange=function(){if(4===i.readyState){var s={statusCode:i.status};if(i.status>=200&&i.status<300){var q;q=k.binary?bY([i.response||""],{type:i.getResponseHeader("Content-Type")}):i.responseText,m(null,s,q)}else{var p={};if(h){p=new Error("ETIMEDOUT"),s.statusCode=400}else{try{p=JSON.parse(i.response)}catch(r){}}m(p,s)}}},k.body&&k.body instanceof Blob?j1(k.body,function(p){i.send(p)}):i.send(k.body),{abort:j}}function cJ(){try{return new XMLHttpRequest,!0}catch(g){return !1}}function dH(h,g){return ay||h.xhr?eV(h,g):cI(h,g)}function c4(){return""}function ki(g,j){function i(l,o,m){if(!g.binary&&g.json&&"string"==typeof l){try{l=JSON.parse(l)}catch(n){return m(n)}}Array.isArray(l)&&(l=l.map(function(p){return p.error||p.missing?bJ(p):p})),g.binary&&aW(l,o),m(null,l,o)}function k(q,o){var m,p;if(q.code&&q.status){var l=new Error(q.message||q.code);return l.status=q.status,o(l)}if(q.message&&"ETIMEDOUT"===q.message){return o(q)}try{m=JSON.parse(q.responseText),p=bJ(m)}catch(n){p=bJ(q)}o(p)}g=dY(g);var h={method:"GET",headers:{},json:!0,processData:!0,timeout:10000,cache:!1};return g=b9.extend(h,g),g.json&&(g.binary||(g.headers.Accept="application/json"),g.headers["Content-Type"]=g.headers["Content-Type"]||"application/json"),g.binary&&(g.encoding=null,g.json=!1),g.processData||(g.json=!1),dH(g,function(r,o,m){if(r){return r.status=o?o.statusCode:400,k(r,j)}var p,n=o.headers&&o.headers["content-type"],l=m||c4();if(!g.binary&&(g.json||!g.processData)&&"object"!=typeof l&&(/json/.test(n)||/^[\s]*\{/.test(l)&&/\}[\s]*$/.test(l))){try{l=JSON.parse(l.toString())}catch(q){}}o.statusCode>=200&&o.statusCode<300?i(l,o,j):(p=bJ(l),p.status=o.statusCode,j(p))})}function eI(m,g){var k=navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",i=-1!==k.indexOf("safari")&&-1===k.indexOf("chrome"),j=-1!==k.indexOf("msie"),l=-1!==k.indexOf("edge"),o=i||(j||l)&&"GET"===m.method,h="cache" in m?m.cache:!0,p=/^blob:/.test(m.url);if(!p&&(o||!h)){var n=-1!==m.url.indexOf("?");m.url+=(n?"&":"?")+"_nonce="+Date.now()}return ki(m,g)}function dD(h){var g=h.doc&&h.doc._attachments;g&&Object.keys(g).forEach(function(i){var j=g[i];j.data=bM(j.data,j.content_type)})}function fH(g){return/^_design/.test(g)?"_design/"+encodeURIComponent(g.slice(8)):/^_local/.test(g)?"_local/"+encodeURIComponent(g.slice(7)):encodeURIComponent(g)}function aD(g){return g._attachments&&Object.keys(g._attachments)?bb.all(Object.keys(g._attachments).map(function(h){var i=g._attachments[h];return i.data&&"string"!=typeof i.data?new bb(function(j){c9(i.data,j)}).then(function(j){i.data=j}):void 0})):bb.resolve()}function c6(g){var i=e3(g);(i.user||i.password)&&(i.auth={username:i.user,password:i.password});var h=i.path.replace(/(^\/|\/$)/g,"").split("/");return i.db=h.pop(),-1===i.db.indexOf("%")&&(i.db=encodeURIComponent(i.db)),i.path=h.join("/"),i}function cb(h,g){return ec(h,h.db+"/"+g)}function ec(g,i){var h=g.path?"/":"";return g.protocol+"://"+g.host+(g.port?":"+g.port:"")+"/"+g.path+h+i}function e5(g){return"?"+Object.keys(g).map(function(h){return h+"="+encodeURIComponent(g[h])}).join("&")}function aT(j,n){function k(A,y,B){var z=A.ajax||{},x=b9.extend(dY(g),z,y);return az(x.method+" "+x.url),p._ajax(x,B)}function w(x,y){return new bb(function(z,A){k(x,y,function(C,B){return C?A(C):void z(B)})})}function v(x,y){return bS(x,bW(function(z){o().then(function(){return y.apply(this,z)})["catch"](function(A){var B=z.pop();B(A)})}))}function o(){if(j.skipSetup||j.skip_setup){return bb.resolve()}if(r){return r}var x={method:"GET",url:m};return r=w({},x)["catch"](function(y){return y&&y.status&&404===y.status?(aM(404,"PouchDB is just detecting if the remote exists."),w({},{method:"PUT",url:m})):bb.reject(y)})["catch"](function(y){return y&&y.status&&412===y.status?!0:bb.reject(y)}),r["catch"](function(){r=null}),r}function l(x){return x.split("/").map(encodeURIComponent).join("/")}var p=this,i=c6;j.getHost&&(i=j.getHost);var s=i(j.name,j),m=cb(s,"");j=dY(j);var g=j.ajax||{};if(p.getUrl=function(){return m},p.getHeaders=function(){return g.headers||{}},j.auth||s.auth){var h=j.auth||s.auth,u=h.username+":"+h.password,q=c8(unescape(encodeURIComponent(u)));g.headers=g.headers||{},g.headers.Authorization="Basic "+q}p._ajax=eI;var r;setTimeout(function(){n(null,p)}),p.type=function(){return"http"},p.id=v("id",function(x){k({},{method:"GET",url:ec(s,"")},function(y,A){var z=A&&A.uuid?A.uuid+s.db:cb(s,"");x(null,z)})}),p.request=v("request",function(x,y){x.url=cb(s,x.url),k({},x,y)}),p.compact=v("compact",function(x,y){"function"==typeof x&&(y=x,x={}),x=dY(x),k(x,{url:cb(s,"_compact"),method:"POST"},function(){function z(){p.info(function(A,B){B&&!B.compact_running?y(null,{ok:!0}):setTimeout(z,x.interval||200)})}z()})}),p.bulkGet=bS("bulkGet",function(y,C){function A(F){var E={};y.revs&&(E.revs=!0),y.attachments&&(E.attachments=!0),k({},{url:cb(s,"_bulk_get"+e5(E)),method:"POST",body:{docs:y.docs}},F)}function B(){function K(L){return function(M,N){G[L]=N.results,++E===I&&C(null,{results:aJ(G)})}}for(var H=bV,I=Math.ceil(y.docs.length/H),E=0,G=new Array(I),F=0;I>F;F++){var J=f8(y,["revs","attachments"]);J.ajax=g,J.docs=y.docs.slice(F*H,Math.min(y.docs.length,(F+1)*H)),dg(x,J,K(F))}}var x=this,z=ec(s,""),D=f4[z];"boolean"!=typeof D?A(function(E,F){if(E){var G=Math.floor(E.status/100);4===G||5===G?(f4[z]=!1,aM(E.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),B()):C(E)}else{f4[z]=!0,C(null,F)}}):D?A(C):B()}),p._info=function(x){o().then(function(){k({},{method:"GET",url:cb(s,"")},function(y,z){return y?x(y):(z.host=cb(s,""),void x(null,z))})})["catch"](x)},p.get=v("get",function(C,y,A){function B(F){var G=F._attachments,E=G&&Object.keys(G);return G&&E.length?bb.all(E.map(function(H){var I=G[H],J=fH(F._id)+"/"+l(H)+"?rev="+F._rev;return w(y,{method:"GET",url:cb(s,J),binary:!0}).then(function(K){return y.binary?K:new bb(function(L){c9(K,L)})}).then(function(K){delete I.stub,delete I.length,I.data=K})})):void 0}function x(E){return Array.isArray(E)?bb.all(E.map(function(F){return F.ok?B(F.ok):void 0})):B(E)}"function"==typeof y&&(A=y,y={}),y=dY(y);var D={};y.revs&&(D.revs=!0),y.revs_info&&(D.revs_info=!0),y.open_revs&&("all"!==y.open_revs&&(y.open_revs=JSON.stringify(y.open_revs)),D.open_revs=y.open_revs),y.rev&&(D.rev=y.rev),y.conflicts&&(D.conflicts=y.conflicts),C=fH(C);var z={method:"GET",url:cb(s,C+e5(D))};w(y,z).then(function(E){return bb.resolve().then(function(){return y.attachments?x(E):void 0}).then(function(){A(null,E)})})["catch"](A)}),p.remove=v("remove",function(z,x,B,y){var A;"string"==typeof x?(A={_id:z,_rev:x},"function"==typeof B&&(y=B,B={})):(A=z,"function"==typeof x?(y=x,B={}):(y=B,B=x));var C=A._rev||B.rev;k(B,{method:"DELETE",url:cb(s,fH(A._id))+"?rev="+C},y)}),p.getAttachment=v("getAttachment",function(z,B,x,A){"function"==typeof x&&(A=x,x={});var C=x.rev?"?rev="+x.rev:"",y=cb(s,fH(z))+"/"+l(B)+C;k(x,{method:"GET",url:y,binary:!0},A)}),p.removeAttachment=v("removeAttachment",function(A,y,z,B){var x=cb(s,fH(A)+"/"+l(y))+"?rev="+z;k({},{method:"DELETE",url:x},B)}),p.putAttachment=v("putAttachment",function(y,C,E,F,H,D){"function"==typeof H&&(D=H,H=F,F=E,E=null);var B=fH(y)+"/"+l(C),A=cb(s,B);if(E&&(A+="?rev="+E),"string"==typeof F){var G;try{G=d6(F)}catch(z){return D(av(dP,"Attachment is not a valid base64 string"))}F=G?cH(G,H):""}var x={headers:{"Content-Type":H},method:"PUT",url:A,processData:!1,body:F,timeout:g.timeout||60000};k({},x,D)}),p._bulkDocs=function(y,z,x){y.new_edits=z.new_edits,o().then(function(){return bb.all(y.docs.map(aD))}).then(function(){k(z,{method:"POST",url:cb(s,"_bulk_docs"),body:y},function(B,A){return B?x(B):(A.forEach(function(C){C.ok=!0}),void x(null,A))})})["catch"](x)},p.allDocs=v("allDocs",function(C,y){"function"==typeof C&&(y=C,C={}),C=dY(C);var A,B={},x="GET";C.conflicts&&(B.conflicts=!0),C.descending&&(B.descending=!0),C.include_docs&&(B.include_docs=!0),C.attachments&&(B.attachments=!0),C.key&&(B.key=JSON.stringify(C.key)),C.start_key&&(C.startkey=C.start_key),C.startkey&&(B.startkey=JSON.stringify(C.startkey)),C.end_key&&(C.endkey=C.end_key),C.endkey&&(B.endkey=JSON.stringify(C.endkey)),"undefined"!=typeof C.inclusive_end&&(B.inclusive_end=!!C.inclusive_end),"undefined"!=typeof C.limit&&(B.limit=C.limit),"undefined"!=typeof C.skip&&(B.skip=C.skip);var z=e5(B);if("undefined"!=typeof C.keys){var D="keys="+encodeURIComponent(JSON.stringify(C.keys));D.length+z.length+1<=cg?z+="&"+D:(x="POST",A={keys:C.keys})}w(C,{method:x,url:cb(s,"_all_docs"+z),body:A}).then(function(E){C.include_docs&&C.attachments&&C.binary&&E.rows.forEach(dD),y(null,E)})["catch"](y)}),p._changes=function(L){var D="batch_size" in L?L.batch_size:bT;L=dY(L),L.timeout="timeout" in L?L.timeout:"timeout" in g?g.timeout:30000;var B,y=L.timeout?{timeout:L.timeout-5000}:{},A="undefined"!=typeof L.limit?L.limit:!1;B="return_docs" in L?L.return_docs:"returnDocs" in L?L.returnDocs:!0;var H=A;if(L.style&&(y.style=L.style),(L.include_docs||L.filter&&"function"==typeof L.filter)&&(y.include_docs=!0),L.attachments&&(y.attachments=!0),L.continuous&&(y.feed="longpoll"),L.conflicts&&(y.conflicts=!0),L.descending&&(y.descending=!0),"heartbeat" in L?L.heartbeat&&(y.heartbeat=L.heartbeat):y.heartbeat=10000,L.filter&&"string"==typeof L.filter&&(y.filter=L.filter),L.view&&"string"==typeof L.view&&(y.filter="_view",y.view=L.view),L.query_params&&"object"==typeof L.query_params){for(var F in L.query_params){L.query_params.hasOwnProperty(F)&&(y[F]=L.query_params[F])}}var K,J="GET";if(L.doc_ids){y.filter="_doc_ids";var x=JSON.stringify(L.doc_ids);x.length<cg?y.doc_ids=x:(J="POST",K={doc_ids:L.doc_ids})}var I,G,E=function(N,M){if(!L.aborted){y.since=N,"object"==typeof y.since&&(y.since=JSON.stringify(y.since)),L.descending?A&&(y.limit=H):y.limit=!A||H>D?D:H;var O={method:J,url:cb(s,"_changes"+e5(y)),timeout:L.timeout,body:K};G=N,L.aborted||o().then(function(){I=k(L,O,M)})["catch"](M)}},C={results:[]},z=function(O,Q){if(!L.aborted){var P=0;if(Q&&Q.results){P=Q.results.length,C.last_seq=Q.last_seq;var M={};M.query=L.query_params,Q.results=Q.results.filter(function(R){H--;var S=fE(L)(R);return S&&(L.include_docs&&L.attachments&&L.binary&&dD(R),B&&C.results.push(R),L.onChange(R)),S})}else{if(O){return L.aborted=!0,void L.complete(O)}}Q&&Q.last_seq&&(G=Q.last_seq);var N=A&&0>=H||Q&&D>P||L.descending;(!L.continuous||A&&0>=H)&&N?L.complete(null,C):setTimeout(function(){E(G,z)},0)}};return E(L.since||0,z),{cancel:function(){L.aborted=!0,I&&I.abort()}}},p.revsDiff=v("revsDiff",function(y,z,x){"function"==typeof z&&(x=z,z={}),k(z,{method:"POST",url:cb(s,"_revs_diff"),body:y},x)}),p._close=function(x){x()},p._destroy=function(x,y){k(x,{url:cb(s,""),method:"DELETE"},function(z,A){return z&&z.status&&404!==z.status?y(z):void y(null,A)})}}function fR(g){g.adapter("http",aT,!1),g.adapter("https",aT,!1)}function bq(){this.promise=new bb(function(g){g()})}function kj(m){var j=m.db,g=m.viewName,l=m.map,n=m.reduce,i=m.temporary,h=l.toString()+(n&&n.toString())+"undefined";if(!i&&j._cachedViews){var k=j._cachedViews[h];if(k){return bb.resolve(k)}}return j.info().then(function(p){function o(u){u.views=u.views||{};var r=g;-1===r.indexOf("/")&&(r=g+"/"+g);var s=u.views[r]=u.views[r]||{};if(!s[q]){return s[q]=!0,u}}var q=p.db_name+"-mrview-"+(i?"temp":bk(h));return b4(j,"_local/mrviews",o).then(function(){return j.registerDependentDatabase(q).then(function(s){var u=s.db;u.auto_compaction=!0;var r={name:q,db:u,sourceDB:j,adapter:j.adapter,mapFun:l,reduceFun:n};return r.db.get("_local/lastSeq")["catch"](function(v){if(404!==v.status){throw v}}).then(function(v){return r.seq=v?v.seq:0,i||(j._cachedViews=j._cachedViews||{},j._cachedViews[h]=r,r.db.once("destroyed",function(){delete j._cachedViews[h]})),r})})})})}function km(h,k,j,l,i,g){return eF("return ("+h.replace(/;\s*$/,"")+");",{emit:k,sum:j,log:l,isArray:i,toJSON:g})}function j0(g){return -1===g.indexOf("/")?[g,g]:g.split("/")}function au(g){return 1===g.length&&/^1-/.test(g[0].rev)}function dw(g,i){try{g.emit("error",i)}catch(h){eA("error","The user's map/reduce function threw an uncaught error.\nYou can debug this error by doing:\nmyDatabase.on('error', function (err) { debugger; });\nPlease double-check your map/reduce function."),eA("error",i)}}function eS(i,g,j){try{return{output:g.apply(null,j)}}catch(h){return dw(i,h),{error:h}}}function c0(g,i){var h=eq.collate(g.key,i.key);return 0!==h?h:eq.collate(g.value,i.value)}function eD(g,i,h){return h=h||0,"number"==typeof i?g.slice(h,i+h):h>0?g.slice(h):g}function dq(g){var i=g.value,h=i&&"object"==typeof i&&i._id||g.id;return h}function cE(g){g.rows.forEach(function(i){var h=i.doc&&i.doc._attachments;h&&Object.keys(h).forEach(function(j){var k=h[j];h[j].data=bM(k.data,k.content_type)})})}function cS(g){return function(h){return g.include_docs&&g.attachments&&g.binary&&cE(h),h}}function aL(h){var g="builtin "+h+" function requires map values to be numbers or number arrays";return new fL(g)}function ef(m){for(var j=0,g=0,l=m.length;l>g;g++){var n=m[g];if("number"!=typeof n){if(!Array.isArray(n)){throw aL("_sum")}j="number"==typeof j?[j]:j;for(var i=0,h=n.length;h>i;i++){var k=n[i];if("number"!=typeof k){throw aL("_sum")}"undefined"==typeof j[i]?j.push(k):j[i]+=k}}else{"number"==typeof j?j+=n:j[0]+=n}}return j}function eT(g,j,i,k){var h=j[g];"undefined"!=typeof h&&(k&&(h=encodeURIComponent(JSON.stringify(h))),i.push(g+"="+h))}function fM(h){if("undefined"!=typeof h){var g=Number(h);return isNaN(g)||g!==parseInt(h,10)?h:g}}function b8(g){return g.group_level=fM(g.group_level),g.limit=fM(g.limit),g.skip=fM(g.skip),g}function e1(g){if(g){if("number"!=typeof g){return new cC('Invalid value for integer: "'+g+'"')}if(0>g){return new cC('Invalid value for positive integer: "'+g+'"')}}}function dI(i,g){var j=i.descending?"endkey":"startkey",h=i.descending?"startkey":"endkey";if("undefined"!=typeof i[j]&&"undefined"!=typeof i[h]&&eq.collate(i[j],i[h])>0){throw new cC("No rows can match your key range, reverse your start_key and end_key or set {descending : true}")}if(g.reduce&&i.reduce!==!1){if(i.include_docs){throw new cC("{include_docs:true} is invalid for reduce")}if(i.keys&&i.keys.length>1&&!i.group&&!i.group_level){throw new cC("Multi-key fetches for reduce views must use {group: true}")}}["group_level","limit","skip"].forEach(function(k){var l=e1(i[k]);if(l){throw l}})}function cc(k,m,i){var g,h=[],j="GET";if(eT("reduce",i,h),eT("include_docs",i,h),eT("attachments",i,h),eT("limit",i,h),eT("descending",i,h),eT("group",i,h),eT("group_level",i,h),eT("skip",i,h),eT("stale",i,h),eT("conflicts",i,h),eT("startkey",i,h,!0),eT("start_key",i,h,!0),eT("endkey",i,h,!0),eT("end_key",i,h,!0),eT("inclusive_end",i,h),eT("key",i,h,!0),h=h.join("&"),h=""===h?"":"?"+h,"undefined"!=typeof i.keys){var l=2000,n="keys="+encodeURIComponent(JSON.stringify(i.keys));n.length+h.length+1<=l?h+=("?"===h[0]?"&":"?")+n:(j="POST","string"==typeof m?g={keys:i.keys}:m.keys=i.keys)}if("string"==typeof m){var o=j0(m);return k.request({method:j,url:"_design/"+o[0]+"/_view/"+o[1]+h,body:g}).then(cS(i))}return g=g||{},Object.keys(m).forEach(function(p){Array.isArray(m[p])?g[p]=m[p]:g[p]=m[p].toString()}),k.request({method:"POST",url:"_temp_view"+h,body:g}).then(cS(i))}function aK(g,i,h){return new bb(function(j,k){g._query(i,h,function(m,l){return m?k(m):void j(l)})})}function e(g){return new bb(function(h,i){g._viewCleanup(function(k,j){return k?i(k):void h(j)})})}function f6(g){return function(h){if(404===h.status){return g}throw h}}function eM(l,g,k){function i(){return au(q)?bb.resolve(p):g.db.get(m)["catch"](f6(p))}function h(r){return r.keys.length?g.db.allDocs({keys:r.keys,include_docs:!0}):bb.resolve({rows:[]})}function j(A,r){for(var w=[],v={},x=0,y=r.rows.length;y>x;x++){var B=r.rows[x],u=B.doc;if(u&&(w.push(u),v[u._id]=!0,u._deleted=!n[u._id],!u._deleted)){var s=n[u._id];"value" in s&&(u.value=s.value)}}var z=Object.keys(n);return z.forEach(function(C){if(!v[C]){var E={_id:C},D=n[C];"value" in D&&(E.value=D.value),w.push(E)}}),A.keys=kf(z.concat(A.keys)),w.push(A),w}var m="_local/doc_"+l,p={_id:m,keys:[]},o=k[l],n=o.indexableKeysToKeyValues,q=o.changes;return i().then(function(r){return h(r).then(function(s){return j(r,s)})})}function ap(i,g,j){var h="_local/lastSeq";return i.db.get(h)["catch"](f6({_id:h,seq:0})).then(function(k){var l=Object.keys(g);return bb.all(l.map(function(m){return eM(m,i,g)})).then(function(m){var n=aJ(m);return k.seq=j,n.push(k),i.db.bulkDocs({docs:n})})})}function bO(g){var i="string"==typeof g?g:g.name,h=cW[i];return h||(h=cW[i]=new bq),h}function aP(g){return jJ(bO(g),function(){return kg(g)})()}function kg(k){function m(p,r){var q={id:h._id,key:eq.normalizeKey(p)};"undefined"!=typeof r&&null!==r&&(q.value=eq.normalizeKey(r)),g.push(q)}function i(q,p){return function(){return ap(k,q,p)}}var g,h,j;if("function"==typeof k.mapFun&&2===k.mapFun.length){var l=k.mapFun;j=function(p){return l(p,m)}}else{j=km(k.mapFun.toString(),m,ef,ax,Array.isArray,JSON.parse)}var n=k.seq||0,o=new bq;return new bb(function(p,s){function r(){o.finish().then(function(){k.seq=n,p()})}function q(){function u(v){s(v)}k.sourceDB.changes({conflicts:!0,include_docs:!0,style:"all_docs",since:n,limit:fN}).on("complete",function(v){var C=v.results;if(!C.length){return r()}for(var D={},A=0,x=C.length;x>A;A++){var F=C[A];if("_"!==F.doc._id[0]){g=[],h=F.doc,h._deleted||eS(k.sourceDB,j,[h]),g.sort(c0);for(var z,E={},H=0,w=g.length;w>H;H++){var y=g[H],B=[y.key,y.id];0===eq.collate(y.key,z)&&B.push(H);var G=eq.toIndexableString(B);E[G]=y,z=y.key}D[F.doc._id]={indexableKeysToKeyValues:E,changes:F.changes}}n=F.seq}return o.add(i(D,n)),C.length<fN?r():q()}).on("error",u)}q()})}function cx(l,g,k){0===k.group_level&&delete k.group_level;var i,h=k.group||k.group_level;i=jK[l.reduceFun]?jK[l.reduceFun]:km(l.reduceFun.toString(),null,ef,ax,Array.isArray,JSON.parse);var j=[],m=isNaN(k.group_level)?Number.POSITIVE_INFINITY:k.group_level;g.forEach(function(r){var u=j[j.length-1],s=h?r.key:null;return h&&Array.isArray(s)&&(s=s.slice(0,m)),u&&0===eq.collate(u.groupKey,s)?(u.keys.push([r.key,r.id]),void u.values.push(r.value)):void j.push({keys:[[r.key,r.id]],values:[r.value],groupKey:s})}),g=[];for(var p=0,o=j.length;o>p;p++){var n=j[p],q=eS(l.sourceDB,i,[n.keys,n.values,!1]);if(q.error&&q.error instanceof fL){throw q.error}g.push({value:q.error?null:q.output,key:n.groupKey})}return{rows:eD(g,k.limit,k.skip)}}function cl(h,g){return jJ(bO(h),function(){return dh(h,g)})()}function dh(r,n){function q(u){return u.include_docs=!0,r.db.allDocs(u).then(function(v){return p=v.total_rows,v.rows.map(function(x){if("value" in x.doc&&"object"==typeof x.doc.value&&null!==x.doc.value){var z=Object.keys(x.doc.value).sort(),y=["id","key","value"];if(!(y>z||z>y)){return x.doc.value}}var w=eq.parseIndexableString(x.doc._id);return{key:w[0],id:w[1],value:"value" in x.doc?x.doc.value:null}})})}function o(w){var v;if(v=g?cx(r,w,n):{total_rows:p,offset:l,rows:w},n.include_docs){var u=kf(w.map(dq));return r.sourceDB.allDocs({keys:u,include_docs:!0,conflicts:n.conflicts,attachments:n.attachments,binary:n.binary}).then(function(x){var y={};return x.rows.forEach(function(z){z.doc&&(y["$"+z.id]=z.doc)}),w.forEach(function(A){var B=dq(A),z=y["$"+B];z&&(A.doc=z)}),v})}return v}var p,g=r.reduceFun&&n.reduce!==!1,l=n.skip||0;if("undefined"==typeof n.keys||n.keys.length||(n.limit=0,delete n.keys),"undefined"!=typeof n.keys){var h=n.keys,m=h.map(function(v){var u={startkey:eq.toIndexableString([v]),endkey:eq.toIndexableString([v,{}])};return q(u)});return bb.all(m).then(aJ).then(o)}var k={descending:n.descending};if(n.start_key&&(n.startkey=n.start_key),n.end_key&&(n.endkey=n.end_key),"undefined"!=typeof n.startkey&&(k.startkey=n.descending?eq.toIndexableString([n.startkey,{}]):eq.toIndexableString([n.startkey])),"undefined"!=typeof n.endkey){var i=n.inclusive_end!==!1;n.descending&&(i=!i),k.endkey=eq.toIndexableString(i?[n.endkey,{}]:[n.endkey])}if("undefined"!=typeof n.key){var s=eq.toIndexableString([n.key]),j=eq.toIndexableString([n.key,{}]);k.descending?(k.endkey=s,k.startkey=j):(k.startkey=s,k.endkey=j)}return g||("number"==typeof n.limit&&(k.limit=n.limit),k.skip=l),q(k).then(o)}function eN(g){return g.request({method:"POST",url:"_view_cleanup"})}function cF(g){return g.get("_local/mrviews").then(function(h){var j={};Object.keys(h.views).forEach(function(m){var k=j0(m),l="_design/"+k[0],n=k[1];j[l]=j[l]||{},j[l][n]=!0});var i={keys:Object.keys(j),include_docs:!0};return g.allDocs(i).then(function(m){var n={};m.rows.forEach(function(p){var o=p.key.substring(8);Object.keys(j[p.key]).forEach(function(u){var r=o+"/"+u;h.views[r]||(r=u);var q=Object.keys(h.views[r]),s=p.doc&&p.doc.views&&p.doc.views[u];q.forEach(function(v){n[v]=n[v]||s})})});var l=Object.keys(n).filter(function(o){return !n[o]}),k=l.map(function(o){return jJ(bO(o),function(){return new g.constructor(o,g.__opts).destroy()})()});return bb.all(k).then(function(){return{ok:!0}})})},f6({ok:!0}))}function fQ(n,k,m){if("http"===n.type()){return cc(n,k,m)}if("function"==typeof n._query){return aK(n,k,m)}if("string"!=typeof k){dI(m,k);var g={db:n,viewName:"temp_view/temp_view",map:k.map,reduce:k.reduce,temporary:!0};return dp.add(function(){return kj(g).then(function(o){function p(){return o.db.destroy()}return bj(aP(o).then(function(){return cl(o,m)}),p)})}),dp.finish()}var j=k,h=j0(j),l=h[0],i=h[1];return n.get("_design/"+l).then(function(o){var p=o.views&&o.views[i];if(!p||"string"!=typeof p.map){throw new cL("ddoc "+l+" has no view named "+i)}dI(m,p);var q={db:n,viewName:j,map:p.map,reduce:p.reduce};return kj(q).then(function(r){return"ok"===m.stale||"update_after"===m.stale?("update_after"===m.stale&&eB.nextTick(function(){aP(r)}),cl(r,m)):aP(r).then(function(){return cl(r,m)})})})}function cC(h){this.status=400,this.name="query_parse_error",this.message=h,this.error=!0;try{Error.captureStackTrace(this,cC)}catch(g){}}function cL(h){this.status=404,this.name="not_found",this.message=h,this.error=!0;try{Error.captureStackTrace(this,cL)}catch(g){}}function fL(h){this.status=500,this.name="invalid_value",this.message=h,this.error=!0;try{Error.captureStackTrace(this,fL)}catch(g){}}function d0(g){return/^1-/.test(g)}function cY(g,i,h){return !g._attachments||!g._attachments[h]||g._attachments[h].digest!==i._attachments[h].digest}function kl(g,i){var h=Object.keys(i._attachments);return bb.all(h.map(function(j){return g.getAttachment(i._id,j,{rev:i._rev})}))}function dR(g,j,i){var k="http"===j.type()&&"http"!==g.type(),h=Object.keys(i._attachments);return k?g.get(i._id).then(function(l){return bb.all(h.map(function(m){return cY(l,i,m)?j.getAttachment(i._id,m):g.getAttachment(l._id,m)}))})["catch"](function(l){if(404!==l.status){throw l}return kl(j,i)}):kl(j,i)}function dF(h){var g=[];return Object.keys(h).forEach(function(j){var i=h[j].missing;i.forEach(function(k){g.push({id:j,rev:k})})}),{docs:g,revs:!0}}function e2(m,p,j,h){function k(){var r=dF(j);if(r.docs.length){return m.bulkGet(r).then(function(s){if(h.cancelled){throw new Error("cancelled")}return bb.all(s.results.map(function(u){return bb.all(u.docs.map(function(w){var v=w.ok;return w.error&&(q=!1),v&&v._attachments?dR(p,m,v).then(function(x){var y=Object.keys(v._attachments);return x.forEach(function(z,B){var A=v._attachments[y[B]];delete A.stub,delete A.length,A.data=z}),v}):v}))})).then(function(u){n=n.concat(aJ(u).filter(Boolean))})})}}function l(r){return r._attachments&&Object.keys(r._attachments).length>0}function o(r){return m.allDocs({keys:r,include_docs:!0}).then(function(s){if(h.cancelled){throw new Error("cancelled")}s.rows.forEach(function(u){!u.deleted&&u.doc&&d0(u.value.rev)&&!l(u.doc)&&(n.push(u.doc),delete j[u.id])})})}function i(){var r=Object.keys(j).filter(function(s){var u=j[s].missing;return 1===u.length&&d0(u[0])});return r.length>0?o(r):void 0}function g(){return{ok:q,docs:n}}j=dY(j);var n=[],q=!0;return bb.resolve().then(i).then(k).then(g)}function jH(g,j,i,k,h){return g.get(j)["catch"](function(l){if(404===l.status){return"http"===g.type()&&aM(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:k,_id:j,history:[],replicator:dK,version:ke}}throw l}).then(function(l){return h.cancelled?void 0:(l.history=(l.history||[]).filter(function(m){return m.session_id!==k}),l.history.unshift({last_seq:i,session_id:k}),l.history=l.history.slice(0,b3),l.version=ke,l.replicator=dK,l.session_id=k,l.last_seq=i,g.put(l)["catch"](function(m){if(409===m.status){return jH(g,j,i,k,h)}throw m}))})}function em(i,g,j,h){this.src=i,this.target=g,this.id=j,this.returnValue=h}function cf(h,g){return h.session_id===g.session_id?{last_seq:h.last_seq,history:h.history}:aC(h.history,g.history)}function aC(m,j){var g=m[0],l=m.slice(1),n=j[0],i=j.slice(1);if(!g||0===j.length){return{last_seq:j5,history:[]}}var h=g.session_id;if(d5(h,j)){return{last_seq:g.last_seq,history:m}}var k=n.session_id;return d5(k,l)?{last_seq:n.last_seq,history:i}:aC(l,i)}function d5(i,g){var j=g[0],h=g.slice(1);return i&&0!==g.length?i===j.session_id?!0:d5(i,h):!1}function j3(g){return"number"==typeof g.status&&4===Math.floor(g.status/100)}function eL(i,g,j,h){return i.retry===!1?(g.emit("error",j),void g.removeAllListeners()):("function"!=typeof i.back_off_function&&(i.back_off_function=bR),g.emit("requestError",j),"active"!==g.state&&"pending"!==g.state||(g.emit("paused",j),g.state="stopped",g.once("active",function(){i.current_back_off=cN})),i.current_back_off=i.current_back_off||cN,i.current_back_off=i.back_off_function(i.current_back_off),void setTimeout(h,i.current_back_off))}function jU(g){return Object.keys(g).sort(eq.collate).reduce(function(h,i){return h[i]=g[i],h},{})}function dS(j,m,g){var i=g.doc_ids?g.doc_ids.sort(eq.collate):"",k=g.filter?g.filter.toString():"",l="",h="";return g.filter&&g.query_params&&(l=JSON.stringify(jU(g.query_params))),g.filter&&"_view"===g.filter&&(h=g.view.toString()),bb.all([j.id(),m.id()]).then(function(n){var o=n[0]+n[1]+k+h+l+i;return new bb(function(p){db(o,p)})}).then(function(n){return n=n.replace(/\//g,".").replace(/\+/g,"_"),"_local/"+n})}function b6(H,Q,q,l,p){function x(){return D?bb.resolve():dS(H,Q,q).then(function(T){O=T,D=new em(H,Q,O,l)})}function k(){if(i=[],0!==F.docs.length){var T=F.docs;return Q.bulkDocs({docs:T,new_edits:!1}).then(function(V){if(l.cancelled){throw o(),new Error("cancelled")}var X=[],U={};V.forEach(function(Z){Z.error&&(p.doc_write_failures++,X.push(Z),U[Z.id]=Z)}),G=G.concat(X),p.docs_written+=F.docs.length-X.length;var Y=X.filter(function(Z){return"unauthorized"!==Z.name&&"forbidden"!==Z.name});if(T.forEach(function(Z){var ae=U[Z._id];ae?l.emit("denied",dY(ae)):i.push(Z)}),Y.length>0){var W=new Error("bulkDocs error");throw W.other_errors=X,y("target.bulkDocs failed to write docs",W),new Error("bulkWrite partial failure")}},function(U){throw p.doc_write_failures+=T.length,U})}}function R(){if(F.error){throw new Error("There was a problem getting docs.")}p.last_seq=w=F.seq;var T=dY(p);return i.length&&(T.docs=i,l.emit("change",T)),A=!0,D.writeCheckpoint(F.seq,I).then(function(){if(A=!1,l.cancelled){throw o(),new Error("cancelled")}F=void 0,s()})["catch"](P)}function K(){var T={};return F.changes.forEach(function(U){"_user/"!==U.id&&(T[U.id]=U.changes.map(function(V){return V.rev}))}),Q.revsDiff(T).then(function(U){if(l.cancelled){throw o(),new Error("cancelled")}F.diffs=U})}function C(){return e2(H,Q,F.diffs,l).then(function(T){F.error=!T.ok,T.docs.forEach(function(U){delete F.diffs[U._id],p.docs_read++,F.docs.push(U)})})}function u(){if(!l.cancelled&&!F){if(0===v.length){return void M(!0)}F=v.shift(),K().then(C).then(k).then(R).then(u)["catch"](function(T){y("batch processing terminated with error",T)})}}function M(T){return 0===n.changes.length?void (0!==v.length||F||((h&&r.live||j)&&(l.state="pending",l.emit("paused")),j&&o())):void ((T||j||n.changes.length>=L)&&(v.push(n),n={seq:0,changes:[],docs:[]},"pending"!==l.state&&"stopped"!==l.state||(l.state="active",l.emit("active")),u()))}function y(U,T){B||(T.message||(T.message=U),p.ok=!1,p.status="aborting",p.errors.push(T),G=G.concat(T),v=[],n={seq:0,changes:[],docs:[]},o())}function o(){if(!(B||l.cancelled&&(p.status="cancelled",A))){p.status=p.status||"complete",p.end_time=new Date,p.last_seq=w,B=!0;var U=G.filter(function(V){return"unauthorized"!==V.name&&"forbidden"!==V.name});if(U.length>0){var T=G.pop();G.length>0&&(T.other_errors=G),T.result=p,eL(q,l,T,function(){b6(H,Q,q,l)})}else{p.errors=G,l.emit("complete",p),l.removeAllListeners()}}}function J(U){if(l.cancelled){return o()}var T=fE(q)(U);T&&(n.seq=U.seq,n.changes.push(U),M(0===v.length&&r.live))}function S(U){if(g=!1,l.cancelled){return o()}if(U.results.length>0){r.since=U.last_seq,s(),M(!0)}else{var T=function(){h?(r.live=!0,s()):j=!0,M(!0)};F||0!==U.results.length?T():(A=!0,D.writeCheckpoint(U.last_seq,I).then(function(){A=!1,p.last_seq=w=U.last_seq,T()})["catch"](P))}}function m(T){return g=!1,l.cancelled?o():void y("changes rejected",T)}function s(){function T(){V.cancel()}function U(){l.removeListener("cancel",T)}if(!g&&!j&&v.length<N){g=!0,l._changes&&(l.removeListener("cancel",l._abortChanges),l._changes.cancel()),l.once("cancel",T);var V=H.changes(r).on("change",J);V.then(U,U),V.then(S)["catch"](m),q.retry&&(l._changes=V,l._abortChanges=T)}}function z(){x().then(function(){return l.cancelled?void o():D.getCheckpoint().then(function(T){w=T,r={since:w,limit:L,batch_size:L,style:"all_docs",doc_ids:E,return_docs:!0},q.filter&&("string"!=typeof q.filter?r.include_docs=!0:r.filter=q.filter),"heartbeat" in q&&(r.heartbeat=q.heartbeat),"timeout" in q&&(r.timeout=q.timeout),q.query_params&&(r.query_params=q.query_params),q.view&&(r.view=q.view),s()})})["catch"](function(T){y("getCheckpoint rejected with ",T)})}function P(T){throw A=!1,y("writeCheckpoint completed with error",T),T}var F,O,D,v=[],n={seq:0,changes:[],docs:[]},A=!1,j=!1,B=!1,w=0,h=q.continuous||q.live||!1,L=q.batch_size||100,N=q.batches_limit||10,g=!1,E=q.doc_ids,G=[],i=[],I=e0();p=p||{ok:!0,start_time:new Date,docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var r={};return l.ready(H,Q),l.cancelled?void o():(l._addedListeners||(l.once("cancel",o),"function"==typeof q.complete&&(l.once("error",q.complete),l.once("complete",function(T){q.complete(null,T)})),l._addedListeners=!0),void ("undefined"==typeof q.since?z():x().then(function(){return A=!0,D.writeCheckpoint(q.since,I)}).then(function(){return A=!1,l.cancelled?void o():(w=q.since,void z())})["catch"](P)))}function by(){aI.EventEmitter.call(this),this.cancelled=!1,this.state="pending";var h=this,g=new bb(function(i,j){h.once("complete",i),h.once("error",j)});h.then=function(i,j){return g.then(i,j)},h["catch"]=function(i){return g["catch"](i)},h["catch"](function(){})}function dN(g,i){var h=i.PouchConstructor;return"string"==typeof g?new h(g,i):g}function kd(j,m,g,i){if("function"==typeof g&&(i=g,g={}),"undefined"==typeof g&&(g={}),g.doc_ids&&!Array.isArray(g.doc_ids)){throw av(cM,"`doc_ids` filter parameter is not a list.")}g.complete=i,g=dY(g),g.continuous=g.continuous||g.live,g.retry="retry" in g?g.retry:!1,g.PouchConstructor=g.PouchConstructor||this;var k=new by(g),l=dN(j,g),h=dN(m,g);return b6(l,h,g,k),k}function bw(i,g,j,h){return"function"==typeof j&&(h=j,j={}),"undefined"==typeof j&&(j={}),j=dY(j),j.PouchConstructor=j.PouchConstructor||this,i=dN(i,j),g=dN(g,j),new dU(i,g,j,h)}function dU(k,r,s,m){function q(z){x.emit("change",{direction:"pull",change:z})}function w(z){x.emit("change",{direction:"push",change:z})}function p(z){x.emit("denied",{direction:"push",doc:z})}function u(z){x.emit("denied",{direction:"pull",doc:z})}function i(){x.pushPaused=!0,x.pullPaused&&x.emit("paused")}function n(){x.pullPaused=!0,x.pushPaused&&x.emit("paused")}function y(){x.pushPaused=!1,x.pullPaused&&x.emit("active",{direction:"push"})}function v(){x.pullPaused=!1,x.pushPaused&&x.emit("active",{direction:"pull"})}function l(z){return function(D,C){var A="change"===D&&(C===q||C===w),F="denied"===D&&(C===u||C===p),B="paused"===D&&(C===n||C===i),E="active"===D&&(C===v||C===y);(A||F||B||E)&&(D in g||(g[D]={}),g[D][z]=!0,2===Object.keys(g[D]).length&&x.removeAllListeners(D))}}var x=this;this.canceled=!1;var o=s.push?b9.extend({},s,s.push):s,h=s.pull?b9.extend({},s,s.pull):s;this.push=kd(k,r,o),this.pull=kd(r,k,h),this.pushPaused=!0,this.pullPaused=!0;var g={};s.live&&(this.push.on("complete",x.pull.cancel.bind(x.pull)),this.pull.on("complete",x.push.cancel.bind(x.push))),this.on("newListener",function(z){"change"===z?(x.pull.on("change",q),x.push.on("change",w)):"denied"===z?(x.pull.on("denied",u),x.push.on("denied",p)):"active"===z?(x.pull.on("active",v),x.push.on("active",y)):"paused"===z&&(x.pull.on("paused",n),x.push.on("paused",i))}),this.on("removeListener",function(z){"change"===z?(x.pull.removeListener("change",q),x.push.removeListener("change",w)):"denied"===z?(x.pull.removeListener("denied",u),x.push.removeListener("denied",p)):"active"===z?(x.pull.removeListener("active",v),x.push.removeListener("active",y)):"paused"===z&&(x.pull.removeListener("paused",n),x.push.removeListener("paused",i))}),this.pull.on("removeListener",l("pull")),this.push.on("removeListener",l("push"));var j=bb.all([this.push,this.pull]).then(function(A){var z={push:A[0],pull:A[1]};return x.emit("complete",z),m&&m(null,z),x.removeAllListeners(),z},function(z){if(x.cancel(),m?m(z):x.emit("error",z),x.removeAllListeners(),m){throw z}});this.then=function(A,z){return j.then(A,z)},this["catch"]=function(z){return j["catch"](z)}}function dm(g){g.replicate=kd,g.sync=bw}var kb,b9=f(9),bm=bQ(f(5)),eP=bQ(f(8)),eH=bQ(f(10)),d4=f(14),bW=bQ(f(4)),aI=f(1),eF=bQ(f(15)),aX=bQ(f(16)),c2=bQ(f(17)),eq=f(12),bb="function"==typeof Promise?Promise:eH,fI=Function.prototype.toString,bz=fI.call(Object),dc=bm("pouchdb:api"),j9=6;if(jF()){kb=!1}else{try{localStorage.setItem("_pouch_check_localstorage",1),kb=!!localStorage.getItem("_pouch_check_localstorage")}catch(cs){kb=!1}}eP(el,aI.EventEmitter),el.prototype.addListener=function(j,m,g,i){function k(){function n(){h=!1}if(l._listeners[m]){if(h){return void (h="waiting")}h=!0;var o=f8(i,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary"]);g.changes(o).on("change",function(p){p.seq>i.since&&!i.cancelled&&(i.since=p.seq,i.onChange(p))}).on("complete",function(){"waiting"===h&&setTimeout(function(){k()},0),h=!1}).on("error",n)}}if(!this._listeners[m]){var l=this,h=!1;this._listeners[m]=k,this.on(j,k)}},el.prototype.removeListener=function(h,g){g in this._listeners&&aI.EventEmitter.prototype.removeListener.call(this,h,this._listeners[g])},el.prototype.notifyLocalWindows=function(g){jF()?chrome.storage.local.set({dbName:g}):f5()&&(localStorage[g]="a"===localStorage[g]?"b":"a")},el.prototype.notify=function(g){this.emit(g),this.notifyLocalWindows(g)},eP(ed,Error),ed.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};var da=new ed({status:401,error:"unauthorized",reason:"Name or password is incorrect."}),ca=new ed({status:400,error:"bad_request",reason:"Missing JSON list of 'docs'"}),eQ=new ed({status:404,error:"not_found",reason:"missing"}),eW=new ed({status:409,error:"conflict",reason:"Document update conflict"}),dO=new ed({status:400,error:"invalid_id",reason:"_id field must contain a string"}),df=new ed({status:412,error:"missing_id",reason:"_id is required for puts"}),eZ=new ed({status:400,error:"bad_request",reason:"Only reserved document ids may start with underscore."}),cu=new ed({status:412,error:"precondition_failed",reason:"Database not open"}),bA=new ed({status:500,error:"unknown_error",reason:"Database encountered an unknown error"}),dP=new ed({status:500,error:"badarg",reason:"Some query argument is invalid"}),dV=new ed({status:400,error:"invalid_request",reason:"Request was invalid"}),ah=new ed({status:400,error:"query_parse_error",reason:"Some query parameter is invalid"}),fC=new ed({status:500,error:"doc_validation",reason:"Bad special document member"}),cM=new ed({status:400,error:"bad_request",reason:"Something wrong with the request"}),cG=new ed({status:400,error:"bad_request",reason:"Document must be a JSON object"}),e9=new ed({status:404,error:"not_found",reason:"Database not found"}),ba=new ed({status:500,error:"indexed_db_went_bad",reason:"unknown"}),fG=new ed({status:500,error:"web_sql_went_bad",reason:"unknown"}),bF=new ed({status:500,error:"levelDB_went_went_bad",reason:"unknown"}),jP=new ed({status:403,error:"forbidden",reason:"Forbidden by design doc validate_doc_update function"}),cD=new ed({status:400,error:"bad_request",reason:"Invalid rev format"}),d1=new ed({status:412,error:"file_exists",reason:"The database could not be created, the file already exists."}),e6=new ed({status:412,error:"missing_stub"}),jX=new ed({status:413,error:"invalid_url",reason:"Provided URL is invalid"}),j2=[da,ca,eQ,eW,dO,df,eZ,cu,bA,dP,dV,ah,fC,cM,cG,e9,fG,bF,jP,cD,d1,e6,ba,jX],cz=function(i,g,j){var h=j2.filter(function(k){return k[i]===g});return j&&h.filter(function(k){return k.message===j})[0]||h[0]},b2=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],cA="queryKey",eJ=/(?:^|&)([^&=]*)=?([^&]*)/g,ka=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,bE="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");eP(aU,aI.EventEmitter),aU.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")},aU.prototype.doChanges=function(g){var j=this,i=g.complete;if(g=dY(g),"live" in g&&!("continuous" in g)&&(g.continuous=g.live),g.processChange=bC,"latest"===g.since&&(g.since="now"),g.since||(g.since=0),"now"===g.since){return void this.db.info().then(function(l){return j.isCancelled?void i(null,{status:"cancelled"}):(g.since=l.update_seq,void j.doChanges(g))},i)}if(g.continuous&&"now"!==g.since&&this.db.info().then(function(l){j.startSeq=l.update_seq},function(l){if("idbNull"!==l.id){throw l}}),g.view&&!g.filter&&(g.filter="_view"),g.filter&&"string"==typeof g.filter&&("_view"===g.filter?g.view=kk(g.view):g.filter=kk(g.filter),"http"!==this.db.type()&&!g.doc_ids)){return this.filterChanges(g)}"descending" in g||(g.descending=!1),g.limit=0===g.limit?1:g.limit,g.complete=i;var k=this.db._changes(g);if(k&&"function"==typeof k.cancel){var h=j.cancel;j.cancel=bW(function(l){k.cancel(),h.apply(this,l)})}},aU.prototype.filterChanges=function(h){var k=this,j=h.complete;if("_view"===h.filter){if(!h.view||"string"!=typeof h.view){var l=av(cM,"`view` filter parameter not found or invalid.");return j(l)}var i=jY(h.view);this.db.get("_design/"+i[0],function(o,n){if(k.isCancelled){return j(null,{status:"cancelled"})}if(o){return j(bJ(o))}var m=n&&n.views&&n.views[i[1]]&&n.views[i[1]].map;return m?(h.filter=bU(m),void k.doChanges(h)):j(av(eQ,n.views?"missing json key: "+i[1]:"missing json key: views"))})}else{var g=jY(h.filter);if(!g){return k.doChanges(h)}this.db.get("_design/"+g[0],function(m,n){if(k.isCancelled){return j(null,{status:"cancelled"})}if(m){return j(bJ(m))}var o=n&&n.filters&&n.filters[g[1]];return o?(h.filter=cd(o),void k.doChanges(h)):j(av(eQ,n&&n.filters?"missing json key: "+g[1]:"missing json key: filters"))})}},eP(af,aI.EventEmitter),af.prototype.post=bS("post",function(g,i,h){return"function"==typeof i&&(h=i,i={}),"object"!=typeof g||Array.isArray(g)?h(av(cG)):void this.bulkDocs({docs:[g]},i,du(h))}),af.prototype.put=bS("put",bW(function(k){function m(){l||(eA("warn","db.put(doc, id, rev) has been deprecated and will be removed in a future release, please use db.put({_id: id, _rev: rev}) instead"),l=!0)}var i,g,h,j,l=!1,n=k.shift(),o="_id" in n;if("object"!=typeof n||Array.isArray(n)){return(j=k.pop())(av(cG))}for(;;){if(i=k.shift(),g=typeof i,"string"!==g||o?"string"!==g||!o||"_rev" in n?"object"===g?h=i:"function"===g&&(j=i):(m(),n._rev=i):(m(),n._id=i,o=!0),!k.length){break}}return h=h||{},cO(n._id),ep(n._id)&&"function"==typeof this._putLocal?n._deleted?this._removeLocal(n,j):this._putLocal(n,j):void this.bulkDocs({docs:[n]},h,du(j))})),af.prototype.putAttachment=bS("putAttachment",function(j,m,g,i,k){function l(o){var n="_rev" in o?parseInt(o._rev,10):0;return o._attachments=o._attachments||{},o._attachments[m]={content_type:k,data:i,revpos:++n},h.put(o)}var h=this;return"function"==typeof k&&(k=i,i=g,g=null),"undefined"==typeof k&&(k=i,i=g,g=null),h.get(j).then(function(n){if(n._rev!==g){throw av(eW)}return l(n)},function(n){if(n.reason===eQ.message){return l({_id:j})}throw n})}),af.prototype.removeAttachment=bS("removeAttachment",function(g,j,i,k){var h=this;h.get(g,function(m,l){return m?void k(m):l._rev!==i?void k(av(eW)):l._attachments?(delete l._attachments[j],0===Object.keys(l._attachments).length&&delete l._attachments,void h.put(l,k)):k()})}),af.prototype.remove=bS("remove",function(h,k,j,l){var i;"string"==typeof k?(i={_id:h,_rev:k},"function"==typeof j&&(l=j,j={})):(i=h,"function"==typeof k?(l=k,j={}):(l=j,j=k)),j=j||{},j.was_delete=!0;var g={_id:i._id,_rev:i._rev||j.rev};return g._deleted=!0,ep(g._id)&&"function"==typeof this._removeLocal?this._removeLocal(i,l):void this.bulkDocs({docs:[g]},j,du(l))}),af.prototype.revsDiff=bS("revsDiff",function(m,j,g){function l(o,p){k.has(o)||k.set(o,{missing:[]}),k.get(o).missing.push(p)}function n(q,p){var o=m[q].slice(0);b1(p,function(w,v,s,x,r){var y=v+"-"+s,u=o.indexOf(y);-1!==u&&(o.splice(u,1),"available"!==r.status&&l(q,y))}),o.forEach(function(r){l(q,r)})}"function"==typeof j&&(g=j,j={});var i=Object.keys(m);if(!i.length){return g(null,{})}var h=0,k=new d4.Map;i.map(function(o){this._getRevisionTree(o,function(q,p){if(q&&404===q.status&&"missing"===q.message){k.set(o,{missing:m[o]})}else{if(q){return g(q)}n(o,p)}if(++h===i.length){var r={};return k.forEach(function(u,s){r[s]=u}),g(null,r)}})},this)}),af.prototype.bulkGet=bS("bulkGet",function(h,g){dg(this,h,g)}),af.prototype.compactDocument=bS("compactDocument",function(i,g,j){var h=this;this._getRevisionTree(i,function(m,k){if(m){return j(m)}var n=cP(k),l=[],o=[];Object.keys(n).forEach(function(p){n[p]>g&&l.push(p)}),b1(k,function(q,v,s,p,r){var u=v+"-"+s;"available"===r.status&&-1!==l.indexOf(u)&&o.push(u)}),h._doCompaction(i,o,j)})}),af.prototype.compact=bS("compact",function(g,i){"function"==typeof g&&(i=g,g={});var h=this;g=g||{},h._compactionQueue=h._compactionQueue||[],h._compactionQueue.push({opts:g,callback:i}),1===h._compactionQueue.length&&cq(h)}),af.prototype._compact=function(j,m){function g(n){h.push(k.compactDocument(n.id,0))}function i(o){var n=o.last_seq;bb.all(h).then(function(){return b4(k,"_local/compaction",function(p){return !p.last_seq||p.last_seq<n?(p.last_seq=n,p):!1})}).then(function(){m(null,{ok:!0})})["catch"](m)}var k=this,l={return_docs:!1,last_seq:j.last_seq||0},h=[];k.changes(l).on("change",g).on("complete",i).on("error",m)},af.prototype.get=bS("get",function(m,j,g){function l(){var o=[],p=n.length;return p?void n.forEach(function(q){i.get(m,{rev:q,revs:j.revs,attachments:j.attachments},function(s,r){s?o.push({missing:q}):o.push({ok:r}),p--,p||g(null,o)})}):g(null,o)}if("function"==typeof j&&(g=j,j={}),"string"!=typeof m){return g(av(dO))}if(ep(m)&&"function"==typeof this._getLocal){return this._getLocal(m,g)}var n=[],i=this;if(!j.open_revs){return this._get(m,j,function(u,B){if(u){return g(u)}var v=B.doc,o=B.metadata,w=B.ctx;if(j.conflicts){var x=dA(o);x.length&&(v._conflicts=x)}if(bI(o,v._rev)&&(v._deleted=!0),j.revs||j.revs_info){var r=f9(o.rev_tree),A=ek(r,function(D){return -1!==D.ids.map(function(E){return E.id}).indexOf(v._rev.split("-")[1])}),s=A.ids.map(function(D){return D.id}).indexOf(v._rev.split("-")[1])+1,p=A.ids.length-s;if(A.ids.splice(s,p),A.ids.reverse(),j.revs&&(v._revisions={start:A.pos+A.ids.length-1,ids:A.ids.map(function(D){return D.id})}),j.revs_info){var q=A.pos+A.ids.length;v._revs_info=A.ids.map(function(D){return q--,{rev:q+"-"+D.id,status:D.opts.status}})}}if(j.attachments&&v._attachments){var C=v._attachments,y=Object.keys(C).length;if(0===y){return g(null,v)}Object.keys(C).forEach(function(D){this._getAttachment(v._id,D,C[D],{rev:v._rev,binary:j.binary,ctx:w},function(F,G){var E=v._attachments[D];E.data=G,delete E.stub,delete E.length,--y||g(null,v)})},i)}else{if(v._attachments){for(var z in v._attachments){v._attachments.hasOwnProperty(z)&&(v._attachments[z].stub=!0)}}g(null,v)}})}if("all"===j.open_revs){this._getRevisionTree(m,function(o,p){return o?g(o):(n=aB(p).map(function(q){return q.rev}),void l())})}else{if(!Array.isArray(j.open_revs)){return g(av(bA,"function_clause"))}n=j.open_revs;for(var h=0;h<n.length;h++){var k=n[h];if("string"!=typeof k||!/^\d+-/.test(k)){return g(av(cD))}}l()}}),af.prototype.getAttachment=bS("getAttachment",function(g,j,i,k){var h=this;i instanceof Function&&(k=i,i={}),this._get(g,i,function(m,l){return m?k(m):l.doc._attachments&&l.doc._attachments[j]?(i.ctx=l.ctx,i.binary=!0,h._getAttachment(g,j,l.doc._attachments[j],i,k),void 0):k(av(eQ))})}),af.prototype.allDocs=bS("allDocs",function(g,i){if("function"==typeof g&&(i=g,g={}),g.skip="undefined"!=typeof g.skip?g.skip:0,g.start_key&&(g.startkey=g.start_key),g.end_key&&(g.endkey=g.end_key),"keys" in g){if(!Array.isArray(g.keys)){return i(new TypeError("options.keys must be an array"))}var h=["startkey","endkey","key"].filter(function(j){return j in g})[0];if(h){return void i(av(ah,"Query parameter `"+h+"` is not compatible with multi-get"))}if("http"!==this.type()){return dZ(this,g,i)}}return this._allDocs(g,i)}),af.prototype.changes=function(h,g){return"function"==typeof h&&(g=h,h={}),new aU(this,h,g)},af.prototype.close=bS("close",function(g){return this._closed=!0,this._close(g)}),af.prototype.info=bS("info",function(h){var g=this;this._info(function(j,i){return j?h(j):(i.db_name=i.db_name||g._db_name,i.auto_compaction=!(!g.auto_compaction||"http"===g.type()),i.adapter=g.type(),void h(null,i))})}),af.prototype.id=bS("id",function(g){return this._id(g)}),af.prototype.type=function(){return"function"==typeof this._type?this._type():this.adapter},af.prototype.bulkDocs=bS("bulkDocs",function(g,j,i){if("function"==typeof j&&(i=j,j={}),j=j||{},Array.isArray(g)&&(g={docs:g}),!g||!g.docs||!Array.isArray(g.docs)){return i(av(ca))}for(var k=0;k<g.docs.length;++k){if("object"!=typeof g.docs[k]||Array.isArray(g.docs[k])){return i(av(cG))}}var h;return g.docs.forEach(function(l){l._attachments&&Object.keys(l._attachments).forEach(function(m){h=h||c1(m)})}),h?i(av(cM,h)):("new_edits" in j||("new_edits" in g?j.new_edits=g.new_edits:j.new_edits=!0),j.new_edits||"http"===this.type()||g.docs.sort(ad),aA(g.docs),this._bulkDocs(g,j,function(m,l){return m?i(m):(j.new_edits||(l=l.filter(function(n){return n.error})),void i(null,l))}))}),af.prototype.registerDependentDatabase=bS("registerDependentDatabase",function(i,g){function j(k){return k.dependentDbs=k.dependentDbs||{},k.dependentDbs[i]?!1:(k.dependentDbs[i]=!0,k)}var h=new this.constructor(i,this.__opts);b4(this,"_local/_pouch_dependentDbs",j).then(function(){g(null,{db:h})})["catch"](g)}),af.prototype.destroy=bS("destroy",function(g,j){function i(){k._destroy(g,function(l,m){return l?j(l):(k._destroyed=!0,k.emit("destroyed"),void j(null,m||{ok:!0}))})}"function"==typeof g&&(j=g,g={});var k=this,h="use_prefix" in k?k.use_prefix:!0;return"http"===k.type()?i():void k.get("_local/_pouch_dependentDbs",function(n,l){if(n){return 404!==n.status?j(n):i()}var o=l.dependentDbs,m=k.constructor,p=Object.keys(o).map(function(r){var q=h?r.replace(new RegExp("^"+m.prefix),""):r;return new m(q,k.__opts).destroy()});bb.all(p).then(i,j)})}),aG.prototype.execute=function(){var g;if(this.failed){for(;g=this.queue.shift();){g(this.failed)}}else{for(;g=this.queue.shift();){g()}}},aG.prototype.fail=function(g){this.failed=g,this.execute()},aG.prototype.ready=function(g){this.isReady=!0,this.db=g,this.execute()},aG.prototype.addTask=function(g){this.queue.push(g),this.failed&&this.execute()},eP(jM,af),jM.debug=bm,jM.adapters={},jM.preferredAdapters=[],jM.prefix="_pouch_";var ea=new aI.EventEmitter;eG(jM),jM.parseAdapter=function(m,j){var g,l,n=m.match(/([a-z\-]*):\/\/(.*)/);if(n){if(m=/http(s?)/.test(n[1])?n[1]+"://"+n[2]:n[2],g=n[1],!jM.adapters[g].valid()){throw"Invalid adapter"}return{name:m,adapter:n[1]}}var i="idb" in jM.adapters&&"websql" in jM.adapters&&f5()&&localStorage["_pouch__websqldb_"+jM.prefix+m];if(j.adapter){l=j.adapter}else{if("undefined"!=typeof j&&j.db){l="leveldb"}else{for(var h=0;h<jM.preferredAdapters.length;++h){if(l=jM.preferredAdapters[h],l in jM.adapters){if(i&&"idb"===l){eA("log",'PouchDB is downgrading "'+m+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.');continue}break}}}}g=jM.adapters[l];var k=g&&"use_prefix" in g?g.use_prefix:!0;return{name:k?jM.prefix+m:m,adapter:l}},jM.adapter=function(g,i,h){i.valid()&&(jM.adapters[g]=i,h&&jM.preferredAdapters.push(g))},jM.plugin=function(g){return"function"==typeof g?g(jM):Object.keys(g).forEach(function(h){jM.prototype[h]=g[h]}),jM},jM.defaults=function(h){function g(k,i,j){return this instanceof g?("function"!=typeof i&&"undefined"!=typeof i||(j=i,i={}),k&&"object"==typeof k&&(i=k,k=void 0),i=b9.extend({},h,i),void jM.call(this,k,i,j)):new g(k,i,j)}return eP(g,jM),g.preferredAdapters=jM.preferredAdapters.slice(),Object.keys(jM).forEach(function(i){i in g||(g[i]=jM[i])}),g};var fO="5.4.4";jM.version=fO;var ck,f1=f0(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),e7=f0(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]),d6=function(g){return atob(g)},c8=function(g){return btoa(g)},bG=eC.setImmediate||eC.setTimeout,jR=32768,dG=5,jO="document-store",dJ="by-sequence",aF="attach-store",dx="attach-seq-store",j7="meta-store",jL="local-store",aS="detect-blob-support",bf={running:!1,queue:[]},fA=new d4.Map,ej=new el,jS=new d4.Map;jV.valid=function(){var g="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform);return !g&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange};var bN=7,dL=jT("document-store"),j4=jT("by-sequence"),kc=jT("attach-store"),bu=jT("local-store"),j6=jT("metadata-store"),ak=jT("attach-seq-store"),bX=new d4.Map,c7=new el,b0=1,jZ="CREATE INDEX IF NOT EXISTS 'by-seq-deleted-idx' ON "+j4+" (seq, deleted)",bD="CREATE UNIQUE INDEX IF NOT EXISTS 'by-seq-doc-id-rev' ON "+j4+" (doc_id, rev)",aj="CREATE INDEX IF NOT EXISTS 'doc-winningseq-idx' ON "+dL+" (winningseq)",ab="CREATE INDEX IF NOT EXISTS 'attach-seq-seq-idx' ON "+ak+" (seq)",dl="CREATE UNIQUE INDEX IF NOT EXISTS 'attach-seq-digest-idx' ON "+ak+" (digest, seq)",bZ=j4+".seq = "+dL+".winningseq",bg=j4+".seq AS seq, "+j4+".deleted AS deleted, "+j4+".json AS data, "+j4+".rev AS rev, "+dL+".json AS metadata";ac.valid=jI,ac.use_prefix=!0;var ay=cJ(),aW=function(){},bT=25,bV=50,f4={},cg=1800,az=bm("pouchdb:http");aT.valid=function(){return !0},bq.prototype.add=function(g){return this.promise=this.promise["catch"](function(){}).then(function(){return g()}),this.promise},bq.prototype.finish=function(){return this.promise};var bx=function(h,g){return g&&h.then(function(i){eB.nextTick(function(){g(null,i)})},function(i){eB.nextTick(function(){g(i)})}),h},dQ=function(g){return bW(function(h){var j=h.pop(),i=g.apply(this,h);return"function"==typeof j&&bx(i,j),i})},bj=function(h,g){return h.then(function(i){return g().then(function(){return i})},function(i){return g().then(function(){throw i})})},jJ=function(h,g){return function(){var j=arguments,i=this;return h.add(function(){return g.apply(i,j)})}},kf=function(h){for(var k={},j=0,l=h.length;l>j;j++){k["$"+h[j]]=!0}var i=Object.keys(k),g=new Array(i.length);for(j=0,l=i.length;l>j;j++){g[j]=i[j].substring(1)}return g},cW={},dp=new bq,fN=50,ax=eA.bind(null,"log"),jK={_sum:function(h,g){return ef(g)},_count:function(h,g){return g.length},_stats:function(g,i){function h(j){for(var m=0,l=0,n=j.length;n>l;l++){var k=j[l];m+=k*k}return m}return{sum:ef(i),min:Math.min.apply(null,i),max:Math.max.apply(null,i),count:i.length,sumsqr:h(i)}}},f2=dQ(function(){var g=this;return"http"===g.type()?eN(g):"function"==typeof g._viewCleanup?e(g):cF(g)}),bp=function(g,j,i){"function"==typeof j&&(i=j,j={}),j=j?b8(j):{},"function"==typeof g&&(g={map:g});var k=this,h=bb.resolve().then(function(){return fQ(k,g,j)});return bx(h,i),h};eP(cC,Error),eP(cL,Error),eP(fL,Error);var a9={query:bp,viewCleanup:f2},ke=1,dK="pouchdb",b3=5,j5=0;em.prototype.writeCheckpoint=function(g,i){var h=this;return this.updateTarget(g,i).then(function(){return h.updateSource(g,i)})},em.prototype.updateTarget=function(h,g){return jH(this.target,this.id,h,g,this.returnValue)},em.prototype.updateSource=function(g,i){var h=this;return this.readOnlySource?bb.resolve(!0):jH(this.src,this.id,g,i,this.returnValue)["catch"](function(j){if(j3(j)){return h.readOnlySource=!0,!0}throw j})};var d9={undefined:function(h,g){return 0===eq.collate(h.last_seq,g.last_seq)?g.last_seq:0},1:function(h,g){return cf(g,h).last_seq}};em.prototype.getCheckpoint=function(){var g=this;return g.target.get(g.id).then(function(h){return g.readOnlySource?bb.resolve(h.last_seq):g.src.get(g.id).then(function(i){if(h.version!==i.version){return j5}var j;return j=h.version?h.version.toString():"undefined",j in d9?d9[j](h,i):j5},function(i){if(404===i.status&&h.last_seq){return g.src.put({_id:g.id,last_seq:j5}).then(function(){return j5},function(j){return j3(j)?(g.readOnlySource=!0,h.last_seq):j5})}throw i})})["catch"](function(h){if(404!==h.status){throw h}return j5})};var cN=0;eP(by,aI.EventEmitter),by.prototype.cancel=function(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")},by.prototype.ready=function(g,j){function i(){h.cancel()}function k(){g.removeListener("destroyed",i),j.removeListener("destroyed",i)}var h=this;h._readyCalled||(h._readyCalled=!0,g.once("destroyed",i),j.once("destroyed",i),h.once("complete",k))},eP(dU,aI.EventEmitter),dU.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())},jM.plugin(jN).plugin(bi).plugin(fR).plugin(a9).plugin(dm),d.exports=jM}).call(this,f(2),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{1:1,10:10,12:12,14:14,15:15,16:16,17:17,2:2,4:4,5:5,8:8,9:9}],4:[function(f,c,g){function d(e){return function(){var h=arguments.length;if(h){for(var j=[],i=-1;++i<h;){j[i]=arguments[i]}return e.call(this,j)}return e.call(this,[])}}c.exports=d},{}],5:[function(h,l,f){function c(){return"WebkitAppearance" in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function d(){var n=arguments,e=this.useColors;if(n[0]=(e?"%c":"")+this.namespace+(e?" %c":" ")+n[0]+(e?"%c ":" ")+"+"+f.humanize(this.diff),!e){return n}var p="color: "+this.color;n=[n[0],p,"color: inherit"].concat(Array.prototype.slice.call(n,1));var i=0,o=0;return n[0].replace(/%[a-z%]/g,function(q){"%%"!==q&&(i++,"%c"===q&&(o=i))}),n.splice(o,0,p),n}function g(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function j(e){try{null==e?f.storage.removeItem("debug"):f.storage.debug=e}catch(i){}}function m(){var e;try{e=f.storage.debug}catch(i){}return e}function k(){try{return window.localStorage}catch(e){}}f=l.exports=h(6),f.log=g,f.formatArgs=d,f.save=j,f.load=m,f.useColors=c,f.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:k(),f.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],f.formatters.j=function(e){return JSON.stringify(e)},f.enable(m())},{6:6}],6:[function(d,k,q){function m(){return q.colors[c++%q.colors.length]}function p(n){function f(){}function i(){var u=i,o=+new Date,x=o-(g||o);u.diff=x,u.prev=g,u.curr=o,g=o,null==u.useColors&&(u.useColors=q.useColors()),null==u.color&&u.useColors&&(u.color=m());var s=Array.prototype.slice.call(arguments);s[0]=q.coerce(s[0]),"string"!=typeof s[0]&&(s=["%o"].concat(s));var r=0;s[0]=s[0].replace(/%([a-z%])/g,function(D,B){if("%%"===D){return D}r++;var w=q.formatters[B];if("function"==typeof w){var C=s[r];D=w.call(u,C),s.splice(r,1),r--}return D}),"function"==typeof q.formatArgs&&(s=q.formatArgs.apply(u,s));var t=i.log||q.log||console.log.bind(console);t.apply(u,s)}f.enabled=!1,i.enabled=!0;var e=q.enabled(n)?i:f;return e.namespace=n,e}function v(i){q.save(i);for(var n=(i||"").split(/[\s,]+/),f=n.length,e=0;f>e;e++){n[e]&&(i=n[e].replace(/\*/g,".*?"),"-"===i[0]?q.skips.push(new RegExp("^"+i.substr(1)+"$")):q.names.push(new RegExp("^"+i+"$")))}}function h(){q.enable("")}function l(i){var e,f;for(e=0,f=q.skips.length;f>e;e++){if(q.skips[e].test(i)){return !1}}for(e=0,f=q.names.length;f>e;e++){if(q.names[e].test(i)){return !0}}return !1}function j(e){return e instanceof Error?e.stack||e.message:e}q=k.exports=p,q.coerce=j,q.disable=h,q.enable=v,q.enabled=l,q.humanize=d(11),q.names=[],q.skips=[],q.formatters={};var g,c=0},{11:11}],7:[function(f,d,c){(function(j){function w(){h=!0;for(var i,n,l=e.length;l;){for(n=e,e=[],i=-1;++i<l;){n[i]()}l=e.length}h=!1}function q(i){1!==e.push(i)||h||t()}var t,g=j.MutationObserver||j.WebKitMutationObserver;if(g){var k=0,p=new g(w),m=j.document.createTextNode("");p.observe(m,{characterData:!0}),t=function(){m.data=k=++k%2}}else{if(j.setImmediate||"undefined"==typeof j.MessageChannel){t="document" in j&&"onreadystatechange" in j.document.createElement("script")?function(){var i=j.document.createElement("script");i.onreadystatechange=function(){w(),i.onreadystatechange=null,i.parentNode.removeChild(i),i=null},j.document.documentElement.appendChild(i)}:function(){setTimeout(w,0)}}else{var v=new j.MessageChannel;v.port1.onmessage=w,t=function(){v.port2.postMessage(0)}}}var h,e=[];d.exports=q}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],8:[function(f,d,c){"function"==typeof Object.create?d.exports=function(g,e){g.super_=e,g.prototype=Object.create(e.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}})}:d.exports=function(g,e){g.super_=e;var h=function(){};h.prototype=e.prototype,g.prototype=new h,g.prototype.constructor=g}},{}],9:[function(f,d,c){(function(){var g=Array.prototype.slice,e=Array.prototype.forEach,h=function(i){if("object"!=typeof i){throw i+" is not an object"}var j=g.call(arguments,1);return e.call(j,function(k){if(k){for(var l in k){"object"==typeof k[l]&&i[l]?h.call(i,i[l],k[l]):i[l]=k[l]}}}),i};this.extend=h}).call(this)},{}],10:[function(G,k,A){function w(){}function j(e){if("function"!=typeof e){throw new TypeError("resolver must be a function")}this.state=F,this.queue=[],this.outcome=void 0,e!==w&&g(this,e)}function J(f,e,h){this.promise=f,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof h&&(this.onRejected=h,this.callRejected=this.otherCallRejected)}function H(f,e,h){q(function(){var i;try{i=e(h)}catch(l){return d.reject(f,l)}i===f?d.reject(f,new TypeError("Cannot resolve promise with itself")):d.resolve(f,i)})}function z(f){var e=f&&f.then;return f&&"object"==typeof f&&"function"==typeof e?function(){e.apply(f,arguments)}:void 0}function g(l,h){function f(o){e||(e=!0,d.reject(l,o))}function i(o){e||(e=!0,d.resolve(l,o))}function m(){h(i,f)}var e=!1,n=x(m);"error"===n.status&&f(n.value)}function x(h,e){var i={};try{i.value=h(e),i.status="success"}catch(f){i.status="error",i.value=f}return i}function E(e){return e instanceof this?e:d.resolve(new this(w),e)}function B(f){var e=new this(w);return d.reject(e,f)}function C(p){function m(r,s){function t(u){i[s]=u,++e!==f||o||(o=!0,d.resolve(h,i))}n.resolve(r).then(t,function(u){o||(o=!0,d.reject(h,u))})}var n=this;if("[object Array]"!==Object.prototype.toString.call(p)){return this.reject(new TypeError("must be an array"))}var f=p.length,o=!1;if(!f){return this.resolve([])}for(var i=new Array(f),e=0,l=-1,h=new this(w);++l<f;){m(p[l],l)}return h}function D(l){function h(o){f.resolve(o).then(function(p){e||(e=!0,d.resolve(i,p))},function(p){e||(e=!0,d.reject(i,p))})}var f=this;if("[object Array]"!==Object.prototype.toString.call(l)){return this.reject(new TypeError("must be an array"))}var m=l.length,e=!1;if(!m){return this.resolve([])}for(var n=-1,i=new this(w);++n<m;){h(l[n])}return i}var q=G(7),d={},c=["REJECTED"],I=["FULFILLED"],F=["PENDING"];k.exports=j,j.prototype["catch"]=function(e){return this.then(null,e)},j.prototype.then=function(f,e){if("function"!=typeof f&&this.state===I||"function"!=typeof e&&this.state===c){return this}var i=new this.constructor(w);if(this.state!==F){var h=this.state===I?f:e;H(i,h,this.outcome)}else{this.queue.push(new J(i,f,e))}return i},J.prototype.callFulfilled=function(e){d.resolve(this.promise,e)},J.prototype.otherCallFulfilled=function(e){H(this.promise,this.onFulfilled,e)},J.prototype.callRejected=function(e){d.reject(this.promise,e)},J.prototype.otherCallRejected=function(e){H(this.promise,this.onRejected,e)},d.resolve=function(i,f){var m=x(z,f);if("error"===m.status){return d.reject(i,m.value)}var h=m.value;if(h){g(i,h)}else{i.state=I,i.outcome=f;for(var l=-1,e=i.queue.length;++l<e;){i.queue[l].callFulfilled(f)}}return i},d.reject=function(h,e){h.state=c,h.outcome=e;for(var i=-1,f=h.queue.length;++i<f;){h.queue[i].callRejected(e)}return h},j.resolve=E,j.reject=B,j.all=C,j.race=D},{7:7}],11:[function(p,x,h){function d(i){if(i=""+i,!(i.length>10000)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(i);if(e){var l=parseFloat(e[1]),f=(e[2]||"ms").toLowerCase();switch(f){case"years":case"year":case"yrs":case"yr":case"y":return l*j;case"days":case"day":case"d":return l*m;case"hours":case"hour":case"hrs":case"hr":case"h":return l*q;case"minutes":case"minute":case"mins":case"min":case"m":return l*w;case"seconds":case"second":case"secs":case"sec":case"s":return l*c;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return l}}}}function g(e){return e>=m?Math.round(e/m)+"d":e>=q?Math.round(e/q)+"h":e>=w?Math.round(e/w)+"m":e>=c?Math.round(e/c)+"s":e+"ms"}function k(e){return v(e,m,"day")||v(e,q,"hour")||v(e,w,"minute")||v(e,c,"second")||e+" ms"}function v(f,e,i){return e>f?void 0:1.5*e>f?Math.floor(f/e)+" "+i:Math.ceil(f/e)+" "+i+"s"}var c=1000,w=60*c,q=60*w,m=24*q,j=365.25*m;x.exports=function(f,e){return e=e||{},"string"==typeof f?d(f):e["long"]?k(f):g(f)}},{}],12:[function(d,c,C){function y(e){if(null!==e){switch(typeof e){case"boolean":return e?1:0;case"number":return k(e);case"string":return e.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var l=Array.isArray(e),f=l?e:Object.keys(e),o=-1,i=f.length,n="";if(l){for(;++o<i;){n+=C.toIndexableString(f[o])}}else{for(;++o<i;){var h=f[o];n+=C.toIndexableString(h)+C.toIndexableString(e[h])}}return n}}return""}function m(o,e){var l,h=e,i="1"===o[e];if(i){l=0,e++}else{var n="0"===o[e];e++;var r="",f=o.substring(e,e+q),s=parseInt(f,10)+B;for(n&&(s=-s),e+=q;;){var p=o[e];if("\x00"===p){break}r+=p,e++}r=r.split("."),l=1===r.length?parseInt(r,10):parseFloat(r[0]+"."+r[1]),n&&(l-=10),0!==s&&(l=parseFloat(l+"e"+s))}return{num:l,length:e-h}}function j(f,o){var l=f.pop();if(o.length){var n=o[o.length-1];l===n.element&&(o.pop(),n=o[o.length-1]);var i=n.element,e=n.index;if(Array.isArray(i)){i.push(l)}else{if(e===f.length-2){var h=f.pop();i[h]=l}else{f.push(l)}}}}function g(e,i){for(var l=Math.min(e.length,i.length),f=0;l>f;f++){var h=C.collate(e[f],i[f]);if(0!==h){return h}}return e.length===i.length?0:e.length>i.length?1:-1}function x(f,e){return f===e?0:f>e?1:-1}function A(e,l){for(var f=Object.keys(e),o=Object.keys(l),i=Math.min(f.length,o.length),n=0;i>n;n++){var h=C.collate(f[n],o[n]);if(0!==h){return h}if(h=C.collate(e[f[n]],l[o[n]]),0!==h){return h}}return f.length===o.length?0:f.length>o.length?1:-1}function v(f){var e=["boolean","number","string","object"],h=e.indexOf(typeof f);return ~h?null===f?1:Array.isArray(f)?5:3>h?h+2:h+3:Array.isArray(f)?5:void 0}function k(h){if(0===h){return"1"}var n=h.toExponential().split(/e\+?/),e=parseInt(n[1],10),p=0>h,r=p?"0":"2",f=(p?-e:e)-B,i=z.padLeft(f.toString(),"0",q);r+=w+i;var o=Math.abs(parseFloat(n[0]));p&&(o=10-o);var l=o.toFixed(20);return l=l.replace(/\.?0+$/,""),r+=w+l}var B=-324,q=3,w="",z=d(13);C.collate=function(h,e){if(h===e){return 0}h=C.normalizeKey(h),e=C.normalizeKey(e);var f=v(h),i=v(e);if(f-i!==0){return f-i}if(null===h){return 0}switch(typeof h){case"number":return h-e;case"boolean":return h===e?0:e>h?-1:1;case"string":return x(h,e)}return Array.isArray(h)?g(h,e):A(h,e)},C.normalizeKey=function(l){switch(typeof l){case"undefined":return null;case"number":return l===1/0||l===-(1/0)||isNaN(l)?null:l;case"object":var h=l;if(Array.isArray(l)){var i=l.length;l=new Array(i);for(var e=0;i>e;e++){l[e]=C.normalizeKey(h[e])}}else{if(l instanceof Date){return l.toJSON()}if(null!==l){l={};for(var n in h){if(h.hasOwnProperty(n)){var f=h[n];"undefined"!=typeof f&&(l[n]=C.normalizeKey(f))}}}}}return l},C.toIndexableString=function(f){var e="\x00";return f=C.normalizeKey(f),v(f)+w+y(f)+e},C.parseIndexableString=function(o){for(var e=[],i=[],h=0;;){var r=o[h++];if("\x00"!==r){switch(r){case"1":e.push(null);break;case"2":e.push("1"===o[h]),h++;break;case"3":var f=m(o,h);e.push(f.num),h+=f.length;break;case"4":for(var s="";;){var p=o[h];if("\x00"===p){break}s+=p,h++}s=s.replace(/\u0001\u0001/g,"\x00").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),e.push(s);break;case"5":var n={element:[],index:e.length};e.push(n.element),i.push(n);break;case"6":var l={element:{},index:e.length};e.push(l.element),i.push(l);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+r)}}else{if(1===e.length){return e.pop()}j(e,i)}}}},{13:13}],13:[function(f,c,g){function d(j,h,e){for(var i="",k=e-j.length;i.length<k;){i+=h}return i}g.padLeft=function(h,e,j){var i=d(h,e,j);return i+h},g.padRight=function(h,e,j){var i=d(h,e,j);return h+i},g.stringLexCompare=function(j,p){var h,m=j.length,l=p.length;for(h=0;m>h;h++){if(h===l){return 1}var e=j.charAt(h),k=p.charAt(h);if(e!==k){return k>e?-1:1}}return l>m?-1:0},g.intToDecimalForm=function(i){var e=0>i,j="";do{var h=e?-Math.ceil(i%10):Math.floor(i%10);j=h+j,i=e?Math.ceil(i/10):Math.floor(i/10)}while(i);return e&&"0"!==j&&(j="-"+j),j}},{}],14:[function(g,d,c){function f(){this.store={}}function h(i){if(this.store=new f,i&&Array.isArray(i)){for(var e=0,j=i.length;j>e;e++){this.add(i[e])}}}c.Map=f,c.Set=h,f.prototype.mangle=function(e){if("string"!=typeof e){throw new TypeError("key must be a string but Got "+e)}return"$"+e},f.prototype.unmangle=function(e){return e.substring(1)},f.prototype.get=function(i){var e=this.mangle(i);return e in this.store?this.store[e]:void 0},f.prototype.set=function(i,e){var j=this.mangle(i);return this.store[j]=e,!0},f.prototype.has=function(i){var e=this.mangle(i);return e in this.store},f.prototype["delete"]=function(i){var e=this.mangle(i);return e in this.store?(delete this.store[e],!0):!1},f.prototype.forEach=function(e){for(var k=Object.keys(this.store),i=0,m=k.length;m>i;i++){var l=k[i],j=this.store[l];l=this.unmangle(l),e(j,l)}},h.prototype.add=function(e){return this.store.set(e,!0)},h.prototype.has=function(e){return this.store.has(e)},h.prototype["delete"]=function(e){return this.store["delete"](e)}},{}],15:[function(f,d,c){(function(){var e={}.hasOwnProperty,g=[].slice;d.exports=function(i,m){var l,k,j,h;k=[],h=[];for(l in m){e.call(m,l)&&(j=m[l],"this"!==l&&(k.push(l),h.push(j)))}return Function.apply(null,g.call(k).concat([i])).apply(m["this"],h)}}).call(this)},{}],16:[function(d,c,e){!function(g){if("object"==typeof e){c.exports=g()}else{if("function"==typeof b&&b.amd){b(g)}else{var h;try{h=window}catch(f){h=self}h.SparkMD5=g()}}}(function(F){function G(m,h,n,l,i,g){return h=K(K(h,m),K(l,g)),K(h<<i|h>>>32-i,n)}function B(m,h,l,i,n,o,g){return G(h&l|~h&i,m,h,n,o,g)}function H(m,h,l,i,n,o,g){return G(h&i|l&~i,m,h,n,o,g)}function q(m,h,l,i,n,o,g){return G(h^l^i,m,h,n,o,g)}function E(m,h,l,i,n,o,g){return G(l^(h|~i),m,h,n,o,g)}function M(m,h){var n=m[0],l=m[1],g=m[2],i=m[3];n=B(n,l,g,i,h[0],7,-680876936),i=B(i,n,l,g,h[1],12,-389564586),g=B(g,i,n,l,h[2],17,606105819),l=B(l,g,i,n,h[3],22,-1044525330),n=B(n,l,g,i,h[4],7,-176418897),i=B(i,n,l,g,h[5],12,1200080426),g=B(g,i,n,l,h[6],17,-1473231341),l=B(l,g,i,n,h[7],22,-45705983),n=B(n,l,g,i,h[8],7,1770035416),i=B(i,n,l,g,h[9],12,-1958414417),g=B(g,i,n,l,h[10],17,-42063),l=B(l,g,i,n,h[11],22,-1990404162),n=B(n,l,g,i,h[12],7,1804603682),i=B(i,n,l,g,h[13],12,-40341101),g=B(g,i,n,l,h[14],17,-1502002290),l=B(l,g,i,n,h[15],22,1236535329),n=H(n,l,g,i,h[1],5,-165796510),i=H(i,n,l,g,h[6],9,-1069501632),g=H(g,i,n,l,h[11],14,643717713),l=H(l,g,i,n,h[0],20,-373897302),n=H(n,l,g,i,h[5],5,-701558691),i=H(i,n,l,g,h[10],9,38016083),g=H(g,i,n,l,h[15],14,-660478335),l=H(l,g,i,n,h[4],20,-405537848),n=H(n,l,g,i,h[9],5,568446438),i=H(i,n,l,g,h[14],9,-1019803690),g=H(g,i,n,l,h[3],14,-187363961),l=H(l,g,i,n,h[8],20,1163531501),n=H(n,l,g,i,h[13],5,-1444681467),i=H(i,n,l,g,h[2],9,-51403784),g=H(g,i,n,l,h[7],14,1735328473),l=H(l,g,i,n,h[12],20,-1926607734),n=q(n,l,g,i,h[5],4,-378558),i=q(i,n,l,g,h[8],11,-2022574463),g=q(g,i,n,l,h[11],16,1839030562),l=q(l,g,i,n,h[14],23,-35309556),n=q(n,l,g,i,h[1],4,-1530992060),i=q(i,n,l,g,h[4],11,1272893353),g=q(g,i,n,l,h[7],16,-155497632),l=q(l,g,i,n,h[10],23,-1094730640),n=q(n,l,g,i,h[13],4,681279174),i=q(i,n,l,g,h[0],11,-358537222),g=q(g,i,n,l,h[3],16,-722521979),l=q(l,g,i,n,h[6],23,76029189),n=q(n,l,g,i,h[9],4,-640364487),i=q(i,n,l,g,h[12],11,-421815835),g=q(g,i,n,l,h[15],16,530742520),l=q(l,g,i,n,h[2],23,-995338651),n=E(n,l,g,i,h[0],6,-198630844),i=E(i,n,l,g,h[7],10,1126891415),g=E(g,i,n,l,h[14],15,-1416354905),l=E(l,g,i,n,h[5],21,-57434055),n=E(n,l,g,i,h[12],6,1700485571),i=E(i,n,l,g,h[3],10,-1894986606),g=E(g,i,n,l,h[10],15,-1051523),l=E(l,g,i,n,h[1],21,-2054922799),n=E(n,l,g,i,h[8],6,1873313359),i=E(i,n,l,g,h[15],10,-30611744),g=E(g,i,n,l,h[6],15,-1560198380),l=E(l,g,i,n,h[13],21,1309151649),n=E(n,l,g,i,h[4],6,-145523070),i=E(i,n,l,g,h[11],10,-1120210379),g=E(g,i,n,l,h[2],15,718787259),l=E(l,g,i,n,h[9],21,-343485551),m[0]=K(n,m[0]),m[1]=K(l,m[1]),m[2]=K(g,m[2]),m[3]=K(i,m[3])}function C(i){var h,g=[];for(h=0;64>h;h+=4){g[h>>2]=i.charCodeAt(h)+(i.charCodeAt(h+1)<<8)+(i.charCodeAt(h+2)<<16)+(i.charCodeAt(h+3)<<24)}return g}function A(i){var h,g=[];for(h=0;64>h;h+=4){g[h>>2]=i[h]+(i[h+1]<<8)+(i[h+2]<<16)+(i[h+3]<<24)}return g}function w(g){var m,o,l,n,p,i,h=g.length,r=[1732584193,-271733879,-1732584194,271733878];for(m=64;h>=m;m+=64){M(r,C(g.substring(m-64,m)))}for(g=g.substring(m-64),o=g.length,l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],m=0;o>m;m+=1){l[m>>2]|=g.charCodeAt(m)<<(m%4<<3)}if(l[m>>2]|=128<<(m%4<<3),m>55){for(M(r,l),m=0;16>m;m+=1){l[m]=0}}return n=8*h,n=n.toString(16).match(/(.*?)(.{0,8})$/),p=parseInt(n[2],16),i=parseInt(n[1],16)||0,l[14]=p,l[15]=i,M(r,l),r}function x(g){var i,o,l,n,p,m,h=g.length,r=[1732584193,-271733879,-1732584194,271733878];for(i=64;h>=i;i+=64){M(r,A(g.subarray(i-64,i)))}for(g=h>i-64?g.subarray(i-64):new Uint8Array(0),o=g.length,l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i=0;o>i;i+=1){l[i>>2]|=g[i]<<(i%4<<3)}if(l[i>>2]|=128<<(i%4<<3),i>55){for(M(r,l),i=0;16>i;i+=1){l[i]=0}}return n=8*h,n=n.toString(16).match(/(.*?)(.{0,8})$/),p=parseInt(n[2],16),m=parseInt(n[1],16)||0,l[14]=p,l[15]=m,M(r,l),r}function D(i){var h,g="";for(h=0;4>h;h+=1){g+=L[i>>8*h+4&15]+L[i>>8*h&15]}return g}function I(h){var g;for(g=0;g<h.length;g+=1){h[g]=D(h[g])}return h.join("")}function z(g){return/[\u0080-\uFFFF]/.test(g)&&(g=unescape(encodeURIComponent(g))),g}function k(m,h){var n,l=m.length,i=new ArrayBuffer(l),g=new Uint8Array(i);for(n=0;l>n;n+=1){g[n]=m.charCodeAt(n)}return h?g:i}function j(g){return String.fromCharCode.apply(null,new Uint8Array(g))}function f(l,g,h){var i=new Uint8Array(l.byteLength+g.byteLength);return i.set(new Uint8Array(l)),i.set(new Uint8Array(g),l.byteLength),h?i:i.buffer}function N(l){var g,h=[],i=l.length;for(g=0;i-1>g;g+=2){h.push(parseInt(l.substr(g,2),16))}return String.fromCharCode.apply(String,h)}function J(){this.reset()}var K=function(h,g){return h+g&4294967295},L=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return"5d41402abc4b2a76b9719d911017c592"!==I(w("hello"))&&(K=function(l,g){var h=(65535&l)+(65535&g),i=(l>>16)+(g>>16)+(h>>16);return i<<16|65535&h}),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||!function(){function g(i,h){return i=0|i||0,0>i?Math.max(i+h,0):Math.min(i,h)}ArrayBuffer.prototype.slice=function(r,p){var l,n,s,i,h=this.byteLength,o=g(r,h),m=h;return p!==F&&(m=g(p,h)),o>m?new ArrayBuffer(0):(l=m-o,n=new ArrayBuffer(l),s=new Uint8Array(n),i=new Uint8Array(this,o,l),s.set(i),n)}}(),J.prototype.append=function(g){return this.appendBinary(z(g)),this},J.prototype.appendBinary=function(i){this._buff+=i,this._length+=i.length;var h,g=this._buff.length;for(h=64;g>=h;h+=64){M(this._hash,C(this._buff.substring(h-64,h)))}return this._buff=this._buff.substring(h-64),this},J.prototype.end=function(m){var h,n,l=this._buff,i=l.length,g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(h=0;i>h;h+=1){g[h>>2]|=l.charCodeAt(h)<<(h%4<<3)}return this._finish(g,i),n=I(this._hash),m&&(n=N(n)),this.reset(),n},J.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},J.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},J.prototype.setState=function(g){return this._buff=g.buff,this._length=g.length,this._hash=g.hash,this},J.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},J.prototype._finish=function(m,h){var n,l,i,g=h;if(m[g>>2]|=128<<(g%4<<3),g>55){for(M(this._hash,m),g=0;16>g;g+=1){m[g]=0}}n=8*this._length,n=n.toString(16).match(/(.*?)(.{0,8})$/),l=parseInt(n[2],16),i=parseInt(n[1],16)||0,m[14]=l,m[15]=i,M(this._hash,m)},J.hash=function(h,g){return J.hashBinary(z(h),g)},J.hashBinary=function(l,g){var h=w(l),i=I(h);return g?N(i):i},J.ArrayBuffer=function(){this.reset()},J.ArrayBuffer.prototype.append=function(l){var g,h=f(this._buff.buffer,l,!0),i=h.length;for(this._length+=l.byteLength,g=64;i>=g;g+=64){M(this._hash,A(h.subarray(g-64,g)))}return this._buff=i>g-64?new Uint8Array(h.buffer.slice(g-64)):new Uint8Array(0),this},J.ArrayBuffer.prototype.end=function(m){var h,n,l=this._buff,i=l.length,g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(h=0;i>h;h+=1){g[h>>2]|=l[h]<<(h%4<<3)}return this._finish(g,i),n=I(this._hash),m&&(n=N(n)),this.reset(),n},J.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},J.ArrayBuffer.prototype.getState=function(){var g=J.prototype.getState.call(this);return g.buff=j(g.buff),g},J.ArrayBuffer.prototype.setState=function(g){return g.buff=k(g.buff,!0),J.prototype.setState.call(this,g)},J.ArrayBuffer.prototype.destroy=J.prototype.destroy,J.ArrayBuffer.prototype._finish=J.prototype._finish,J.ArrayBuffer.hash=function(l,g){var h=x(new Uint8Array(l)),i=I(h);return g?N(i):i},J})},{}],17:[function(f,c,g){function d(j,p,h){var m=h[h.length-1];j===m.element&&(h.pop(),m=h[h.length-1]);var l=m.element,e=m.index;if(Array.isArray(l)){l.push(j)}else{if(e===p.length-2){var k=p.pop();l[k]=j}else{p.push(j)}}}g.stringify=function(p){var B=[];B.push({obj:p});for(var x,v,z,m,w,q,h,e,A,k,j,y="";x=B.pop();){if(v=x.obj,z=x.prefix||"",m=x.val||"",y+=z,m){y+=m}else{if("object"!=typeof v){y+="undefined"==typeof v?null:JSON.stringify(v)}else{if(null===v){y+="null"}else{if(Array.isArray(v)){for(B.push({val:"]"}),w=v.length-1;w>=0;w--){q=0===w?"":",",B.push({obj:v[w],prefix:q})}B.push({val:"["})}else{h=[];for(e in v){v.hasOwnProperty(e)&&h.push(e)}for(B.push({val:"}"}),w=h.length-1;w>=0;w--){A=h[w],k=v[A],j=w>0?",":"",j+=JSON.stringify(A)+":",B.push({obj:k,prefix:j})}B.push({val:"{"})}}}}}return y},g.parse=function(r){for(var j,h,m,v,e,k,y,z,q,p=[],x=[],w=0;;){if(j=r[w++],"}"!==j&&"]"!==j&&"undefined"!=typeof j){switch(j){case" ":case"	":case"\n":case":":case",":break;case"n":w+=3,d(null,p,x);break;case"t":w+=3,d(!0,p,x);break;case"f":w+=4,d(!1,p,x);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(h="",w--;;){if(m=r[w++],!/[\d\.\-e\+]/.test(m)){w--;break}h+=m}d(parseFloat(h),p,x);break;case'"':for(v="",e=void 0,k=0;;){if(y=r[w++],'"'===y&&("\\"!==e||k%2!==1)){break}v+=y,e=y,"\\"===e?k++:k=0}d(JSON.parse('"'+v+'"'),p,x);break;case"[":z={element:[],index:p.length},p.push(z.element),x.push(z);break;case"{":q={element:{},index:p.length},p.push(q.element),x.push(q);break;default:throw new Error("unexpectedly reached end of input: "+j)}}else{if(1===p.length){return p.pop()}d(p.pop(),p,x)}}}},{}]},{},[3])(3)});