!function(b){if("object"==typeof exports&&"undefined"!=typeof module){module.exports=b()}else{if("function"==typeof define&&define.amd){define([],b)}else{var a;a="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,a.PouchDB=b()}}}(function(){var b;return function a(f,h,c){function d(e,k){if(!h[e]){if(!f[e]){var i="function"==typeof require&&require;if(!k&&i){return i(e,!0)}if(j){return j(e,!0)}var m=new Error("Cannot find module '"+e+"'");throw m.code="MODULE_NOT_FOUND",m}var l=h[e]={exports:{}};f[e][0].call(l.exports,function(n){var o=f[e][1][n];return d(o?o:n)},l,l.exports,a,f,h,c)}return h[e].exports}for(var j="function"==typeof require&&require,g=0;g<c.length;g++){d(c[g])}return d}({1:[function(j,f,l){function d(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function k(e){return"function"==typeof e}function c(e){return"number"==typeof e}function g(e){return"object"==typeof e&&null!==e}function h(e){return void 0===e}f.exports=d,d.EventEmitter=d,d.prototype._events=void 0,d.prototype._maxListeners=void 0,d.defaultMaxListeners=10,d.prototype.setMaxListeners=function(e){if(!c(e)||0>e||isNaN(e)){throw TypeError("n must be a positive number")}return this._maxListeners=e,this},d.prototype.emit=function(p){var i,o,e,n,m,q;if(this._events||(this._events={}),"error"===p&&(!this._events.error||g(this._events.error)&&!this._events.error.length)){if(i=arguments[1],i instanceof Error){throw i}throw TypeError('Uncaught, unspecified "error" event.')}if(o=this._events[p],h(o)){return !1}if(k(o)){switch(arguments.length){case 1:o.call(this);break;case 2:o.call(this,arguments[1]);break;case 3:o.call(this,arguments[1],arguments[2]);break;default:n=Array.prototype.slice.call(arguments,1),o.apply(this,n)}}else{if(g(o)){for(n=Array.prototype.slice.call(arguments,1),q=o.slice(),e=q.length,m=0;e>m;m++){q[m].apply(this,n)}}}return !0},d.prototype.addListener=function(m,i){var e;if(!k(i)){throw TypeError("listener must be a function")}return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",m,k(i.listener)?i.listener:i),this._events[m]?g(this._events[m])?this._events[m].push(i):this._events[m]=[this._events[m],i]:this._events[m]=i,g(this._events[m])&&!this._events[m].warned&&(e=h(this._maxListeners)?d.defaultMaxListeners:this._maxListeners,e&&e>0&&this._events[m].length>e&&(this._events[m].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[m].length),"function"==typeof console.trace&&console.trace())),this},d.prototype.on=d.prototype.addListener,d.prototype.once=function(n,i){function e(){this.removeListener(n,e),m||(m=!0,i.apply(this,arguments))}if(!k(i)){throw TypeError("listener must be a function")}var m=!1;return e.listener=i,this.on(n,e),this},d.prototype.removeListener=function(p,m){var i,e,n,o;if(!k(m)){throw TypeError("listener must be a function")}if(!this._events||!this._events[p]){return this}if(i=this._events[p],n=i.length,e=-1,i===m||k(i.listener)&&i.listener===m){delete this._events[p],this._events.removeListener&&this.emit("removeListener",p,m)}else{if(g(i)){for(o=n;o-->0;){if(i[o]===m||i[o].listener&&i[o].listener===m){e=o;break}}if(0>e){return this}1===i.length?(i.length=0,delete this._events[p]):i.splice(e,1),this._events.removeListener&&this.emit("removeListener",p,m)}}return this},d.prototype.removeAllListeners=function(m){var i,e;if(!this._events){return this}if(!this._events.removeListener){return 0===arguments.length?this._events={}:this._events[m]&&delete this._events[m],this}if(0===arguments.length){for(i in this._events){"removeListener"!==i&&this.removeAllListeners(i)}return this.removeAllListeners("removeListener"),this._events={},this}if(e=this._events[m],k(e)){this.removeListener(m,e)}else{if(e){for(;e.length;){this.removeListener(m,e[e.length-1])}}}return delete this._events[m],this},d.prototype.listeners=function(i){var e;return e=this._events&&this._events[i]?k(this._events[i])?[this._events[i]]:this._events[i].slice():[]},d.prototype.listenerCount=function(i){if(this._events){var e=this._events[i];if(k(e)){return 1}if(e){return e.length}}return 0},d.listenerCount=function(i,e){return i.listenerCount(e)}},{}],2:[function(m,q,v){function k(){A&&w&&(A=!1,w.length?p=w.concat(p):y=-1,p.length&&c())}function c(){if(!A){var f=d(k);A=!0;for(var e=p.length;e;){for(w=p,p=[];++y<e;){w&&w[y].run()}y=-1,e=p.length}w=null,A=!1,j(f)}}function g(f,e){this.fun=f,this.array=e}function z(){}var d,j,x=q.exports={};!function(){try{d=setTimeout}catch(e){d=function(){throw new Error("setTimeout is not defined")}}try{j=clearTimeout}catch(e){j=function(){throw new Error("clearTimeout is not defined")}}}();var w,p=[],A=!1,y=-1;x.nextTick=function(f){var e=new Array(arguments.length-1);if(arguments.length>1){for(var h=1;h<arguments.length;h++){e[h-1]=arguments[h]}}p.push(new g(f,e)),1!==p.length||A||d(c,0)},g.prototype.run=function(){this.fun.apply(null,this.array)},x.title="browser",x.browser=!0,x.env={},x.argv=[],x.version="",x.versions={},x.on=z,x.addListener=z,x.once=z,x.off=z,x.removeListener=z,x.removeAllListeners=z,x.emit=z,x.binding=function(e){throw new Error("process.binding is not supported")},x.cwd=function(){return"/"},x.chdir=function(e){throw new Error("process.chdir is not supported")},x.umask=function(){return 0}},{}],3:[function(f,d,c){(function(dH,eC){function ed(g){return g&&"object"==typeof g&&"default" in g?g["default"]:g}function fD(g){return g instanceof ArrayBuffer||"undefined"!=typeof Blob&&g instanceof Blob}function eh(i){if("function"==typeof i.slice){return i.slice(0)}var g=new ArrayBuffer(i.byteLength),j=new Uint8Array(g),h=new Uint8Array(i);return j.set(h),g}function bd(g){if(g instanceof ArrayBuffer){return eh(g)}var i=g.size,h=g.type;return"function"==typeof g.slice?g.slice(0,i,h):g.webkitSlice(0,i,h)}function f3(g){var i=Object.getPrototypeOf(g);if(null===i){return !0}var h=i.constructor;return"function"==typeof h&&h instanceof h&&kh.call(h)==cY}function bS(i){var g,k,h;if(!i||"object"!=typeof i){return i}if(Array.isArray(i)){for(g=[],k=0,h=i.length;h>k;k++){g[k]=bS(i[k])}return g}if(i instanceof Date){return i.toISOString()}if(fD(i)){return bd(i)}if(!f3(i)){return i}g={};for(k in i){if(Object.prototype.hasOwnProperty.call(i,k)){var j=bS(i[k]);"undefined"!=typeof j&&(g[k]=j)}}return g}function cP(h){var g=!1;return c8(function(i){if(g){throw new Error("once called more than once")}g=!0,h.apply(this,i)})}function eB(g){return c8(function(j){j=bS(j);var k,l=this,i="function"==typeof j[j.length-1]?j.pop():!1;i&&(k=function(n,m){dH.nextTick(function(){i(n,m)})});var h=new aZ(function(m,q){var o;try{var n=cP(function(r,s){r?q(r):m(s)});j.push(n),o=g.apply(l,j),o&&"function"==typeof o.then&&m(o)}catch(p){q(p)}});return k&&h.then(function(m){k(null,m)},k),h})}function dZ(g,i){function h(o,m,k){if(dJ.enabled){for(var n=[o._db_name,m],j=0;j<k.length-1;j++){n.push(k[j])}dJ.apply(null,n);var l=k[k.length-1];k[k.length-1]=function(r,p){var q=[o._db_name,m];q=q.concat(r?["error",r]:["success",p]),dJ.apply(null,q),l(r,p)}}}return eB(c8(function(j){if(this._closed){return aZ.reject(new Error("database is closed"))}if(this._destroyed){return aZ.reject(new Error("database is destroyed"))}var k=this;return h(k,g,j),this.taskqueue.isReady?i.apply(this,j):new aZ(function(l,m){k.taskqueue.addTask(function(n){n?m(n):l(k[g].apply(k,j))})})}))}function e4(j,h){for(var l={},i=0,k=h.length;k>i;i++){var g=h[i];g in j&&(l[g]=j[g])}return l}function eX(g){return g}function c9(g){return[{ok:g}]}function eK(h,i,q){function n(){var w=[];v.forEach(function(x){x.docs.forEach(function(y){w.push({id:x.id,docs:[y]})})}),q(null,{results:w})}function o(){++l===p&&n()}function u(w,y,x){v[w]={id:y,docs:x},o()}function m(){if(!(r>=s.length)){var x=Math.min(r+e9,s.length),w=s.slice(r,x);k(w,r),r+=w.length}}function k(x,w){x.forEach(function(B,z){var D=w+z,C=j[B],y=e4(C[0],["atts_since","attachments"]);y.open_revs=C.map(function(E){return E.rev}),y.open_revs=y.open_revs.filter(eX);var A=eX;0===y.open_revs.length&&(delete y.open_revs,A=c9),["revs","attachments","binary","ajax"].forEach(function(E){E in i&&(y[E]=i[E])}),h.get(B,y,function(G,E){var F;F=G?[{error:G}]:A(E),u(D,B,F),m()})})}var g=i.docs,j={};g.forEach(function(w){w.id in j?j[w.id].push(w):j[w.id]=[w]});var p=Object.keys(j).length,l=0,v=new Array(p),s=Object.keys(j),r=0;m()}function c1(){return"undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage&&"undefined"!=typeof chrome.storage.local}function ds(){return dw}function f5(g){c1()?chrome.storage.onChanged.addListener(function(h){null!=h.db_name&&g.emit(h.dbName.newValue)}):ds()&&("undefined"!=typeof addEventListener?addEventListener("storage",function(h){g.emit(h.key)}):window.attachEvent("storage",function(h){g.emit(h.key)}))}function eE(){bz.EventEmitter.call(this),this._listeners={},f5(this)}function bc(h){if("undefined"!==console&&h in console){var g=Array.prototype.slice.call(arguments,1);console[h].apply(console,g)}}function d3(i,g){var k=600000;i=parseInt(i,10)||0,g=parseInt(g,10),g!==g||i>=g?g=(i||1)<<1:g+=1,g>k&&(i=k>>1,g=k);var h=Math.random(),j=g-i;return ~~(j*h+i)}function aU(h){var g=0;return h||(g=2000),d3(h,g)}function dY(h,g){bc("info","The above "+h+" is totally normal. "+g)}function cO(g){Error.call(this,g.reason),this.status=g.status,this.name=g.error,this.message=g.reason,this.error=!0}function dg(i,g,j){function h(k){for(var l in i){"function"!=typeof i[l]&&(this[l]=i[l])}void 0!==j&&(this.name=j),void 0!==k&&(this.reason=k)}return h.prototype=cO.prototype,new h(g)}function eA(j){var h,l,i,k,g;return l=j.error===!0&&"string"==typeof j.name?j.name:j.error,g=j.reason,i=dV("name",l,g),j.missing||"missing"===g||"deleted"===g||"not_found"===l?i=e6:"doc_validation"===l?(i=fO,k=g):"bad_request"===l&&i.message!==g&&(i=d4),i||(i=dV("status",j.status,g)||dO),h=dg(i,g,l),k&&(h.message=k),j.id&&(h.id=j.id),j.status&&(h.status=j.status),j.missing&&(h.missing=j.missing),h}function av(i,g,k){try{return !i(g,k)}catch(h){var j="Filter function threw: "+h.toString();return dg(d4,j)}}function e0(g){var i={},h=g.filter&&"function"==typeof g.filter;return i.query=g.query_params,function(k){k.doc||(k.doc={});var l=h&&av(g.filter,k.doc,i);if("object"==typeof l){return l}if(l){return !1}if(g.include_docs){if(!g.attachments){for(var j in k.doc._attachments){k.doc._attachments.hasOwnProperty(j)&&(k.doc._attachments[j].stub=!0)}}}else{delete k.doc}return !0}}function j1(i){for(var g=[],j=0,h=i.length;h>j;j++){g=g.concat(i[j])}return g}function cU(h){var g;if(h?"string"!=typeof h?g=dg(cf):/^_/.test(h)&&!/^_(design|local)/.test(h)&&(g=dg(ka)):g=dg(eW),g){throw g}}function eU(h,g){return"listenerCount" in h?h.listenerCount(g):bz.EventEmitter.listenerCount(h,g)}function dE(h){if(!h){return null}var g=h.split("/");return 2===g.length?g:1===g.length?[h,h]:null}function dX(h){var g=dE(h);return g?g.join("/"):null}function bB(l){for(var j=f7.exec(l),g={},k=14;k--;){var m=kd[k],i=j[k]||"",h=-1!==["user","password"].indexOf(m);g[m]=h?decodeURIComponent(i):i}return g[eH]={},g[kd[12]].replace(fC,function(n,o,p){o&&(g[eH][o]=p)}),g}function aQ(g,i,h){return new aZ(function(j,k){g.get(i,function(n,l){if(n){if(404!==n.status){return k(n)}l={}}var o=l._rev,m=h(l);return m?(m._id=i,m._rev=o,void j(ap(g,m,h))):j({updated:!1,rev:o})})})}function ap(g,i,h){return g.put(i).then(function(j){return{updated:!0,rev:j.rev}},function(j){if(409!==j.status){throw j}return aQ(g,i._id,h)})}function eO(g){return 0|Math.random()*g}function dT(i,g){g=g||df.length;var j="",h=-1;if(i){for(;++h<i;){j+=df[eO(g)]}return j}for(;++h<36;){switch(h){case 8:case 13:case 18:case 23:j+="-";break;case 19:j+=df[3&eO(16)|8];break;default:j+=df[eO(16)]}}return j}function cm(r){for(var n,q,o,p,g=r.rev_tree.slice();p=g.pop();){var l=p.ids,h=l[2],m=p.pos;if(h.length){for(var k=0,i=h.length;i>k;k++){g.push({pos:m+1,ids:h[k]})}}else{var s=!!l[1].deleted,j=l[0];n&&!(o!==s?o:q!==m?m>q:j>n)||(n=j,q=m,o=s)}}return q+"-"+n}function dv(i,k){for(var g,m=i.slice();g=m.pop();){for(var o=g.pos,h=g.ids,j=h[2],l=k(0===j.length,o,h[0],g.ctx,h[1]),p=0,n=j.length;n>p;p++){m.push({pos:o+1,ids:j[p],ctx:l})}}}function e5(h,g){return h.pos-g.pos}function aA(i){var g=[];dv(i,function(m,o,l,n,k){m&&g.push({rev:o+"-"+l,pos:o,opts:k})}),g.sort(e5).reverse();for(var j=0,h=g.length;h>j;j++){delete g[j].pos}return g}function eY(l){for(var j=cm(l),g=aA(l.rev_tree),k=[],m=0,i=g.length;i>m;m++){var h=g[m];h.rev===j||h.opts.deleted||k.push(h.rev)}return k}function fM(h){var g=[];return dv(h.rev_tree,function(l,i,k,m,j){"available"!==j.status||l||(g.push(i+"-"+k),j.status="missing")}),g}function bi(r){for(var n,q=[],o=r.slice();n=o.pop();){var p=n.pos,g=n.ids,l=g[0],h=g[1],m=g[2],k=0===m.length,i=n.history?n.history.slice():[];i.push({id:l,opts:h}),k&&q.push({pos:p+1-i.length,ids:i});for(var s=0,j=m.length;j>s;s++){o.push({pos:p+1,ids:m[s],history:i})}}return q.reverse()}function jJ(h,g){return h.pos-g.pos}function jY(j,h,l){for(var i,k=0,g=j.length;g>k;){i=k+g>>>1,l(j[i],h)<0?k=i+1:g=i}return k}function kc(i,g,j){var h=jY(i,g,j);i.splice(h,0,g)}function bV(g,h){for(var m,i,k=h,l=g.length;l>k;k++){var j=g[k],n=[j.id,j.opts,[]];i?(i[2].push(n),i=n):m=i=n}return m}function dd(h,g){return h[0]<g[0]?-1:1}function e1(i,k){for(var g=[{tree1:i,tree2:k}],m=!1;g.length>0;){var o=g.pop(),h=o.tree1,j=o.tree2;(h[1].status||j[1].status)&&(h[1].status="available"===h[1].status||"available"===j[1].status?"available":"missing");for(var l=0;l<j[2].length;l++){if(h[2][0]){for(var p=!1,n=0;n<h[2].length;n++){h[2][n][0]===j[2][l][0]&&(g.push({tree1:h[2][n],tree2:j[2][l]}),p=!0)}p||(m="new_branch",kc(h[2],j[2][l],dd))}else{m="new_leaf",h[2][0]=j[2][l]}}}return{conflicts:m,tree:i}}function fB(o,A,n){var z,k=[],q=!1,y=!1;if(!o.length){return{tree:[A],conflicts:"new_leaf"}}for(var r=0,j=o.length;j>r;r++){var m=o[r];if(m.pos===A.pos&&m.ids[0]===A.ids[0]){z=e1(m.ids,A.ids),k.push({pos:m.pos,ids:z.tree}),q=q||z.conflicts,y=!0}else{if(n!==!0){var x=m.pos<A.pos?m:A,p=m.pos<A.pos?A:m,v=p.pos-x.pos,s=[],i=[];for(i.push({ids:x.ids,diff:v,parent:null,parentIdx:null});i.length>0;){var h=i.pop();if(0!==h.diff){for(var g=h.ids[2],w=0,u=g.length;u>w;w++){i.push({ids:g[w],diff:h.diff-1,parent:h.ids,parentIdx:w})}}else{h.ids[0]===p.ids[0]&&s.push(h)}}var l=s[0];l?(z=e1(l.ids,p.ids),l.parent[2][l.parentIdx]=z.tree,k.push({pos:x.pos,ids:x.ids}),q=q||z.conflicts,y=!0):k.push(m)}else{k.push(m)}}}return y||k.push(A),k.sort(jJ),{tree:k,conflicts:q||"internal_node"}}function a8(r,n){for(var q,o=bi(r),p={},g=0,l=o.length;l>g;g++){for(var h=o[g],m=h.ids,k=Math.max(0,m.length-n),i={pos:h.pos+k,ids:bV(m,k)},s=0;k>s;s++){var j=h.pos+s+"-"+m[s].id;p[j]=!0}q=q?fB(q,i,!0).tree:[i]}return dv(q,function(v,u,w){delete p[u+"-"+w]}),{tree:q,revs:Object.keys(p)}}function af(i,g,k){var h=fB(i,g),j=a8(h.tree,k);return{tree:j.tree,stemmedRevs:j.revs,conflicts:h.conflicts}}function cI(i,k){for(var g,m=i.slice(),o=k.split("-"),h=parseInt(o[0],10),j=o[1];g=m.pop();){if(g.pos===h&&g.ids[0]===j){return !0}for(var l=g.ids[2],p=0,n=l.length;n>p;p++){m.push({pos:g.pos+1,ids:l[p]})}}return !1}function dy(g){return g.ids}function aP(i,g){g||(g=cm(i));for(var k,h=g.substring(g.indexOf("-")+1),j=i.rev_tree.map(dy);k=j.pop();){if(k[0]===h){return !!k[1].deleted}j=j.concat(k[2])}}function f0(g){return/^_local/.test(g)}function bU(g){return by("return "+g+";",{})}function fH(g){return new Function("doc",["var emitted = false;","var emit = function (a, b) {","  emitted = true;","};","var view = "+g+";","view(doc);","if (emitted) {","  return true;","}"].join("\n"))}function cE(g,i){try{g.emit("change",i)}catch(h){bc("error",'Error in .on("change", function):',h)}}function du(l,j,g){function k(){m.cancel()}bz.EventEmitter.call(this);var m=this;this.db=l,j=j?bS(j):{};var i=j.complete=cP(function(o,n){o?eU(m,"error")>0&&m.emit("error",o):m.emit("complete",n),m.removeAllListeners(),l.removeListener("destroyed",k)});g&&(m.on("complete",function(n){g(null,n)}),m.on("error",g)),l.once("destroyed",k),j.onChange=function(n){j.isCancelled||(cE(m,n),m.startSeq&&m.startSeq<=n.seq&&(m.startSeq=!1))};var h=new aZ(function(o,n){j.complete=function(p,q){p?n(p):o(q)}});m.once("cancel",function(){l.removeListener("destroyed",k),j.complete(null,{status:"cancelled"})}),this.then=h.then.bind(h),this["catch"]=h["catch"].bind(h),this.then(function(n){i(null,n)},i),l.taskqueue.isReady?m.doChanges(j):l.taskqueue.addTask(function(){m.isCancelled?m.emit("cancel"):m.doChanges(j)})}function eM(i,g,k){var h=[{rev:i._rev}];"all_docs"===k.style&&(h=aA(g.rev_tree).map(function(l){return{rev:l.rev}}));var j={id:g.id,changes:h,doc:i};return aP(g,i._rev)&&(j.deleted=!0),k.conflicts&&(j.doc._conflicts=eY(g),j.doc._conflicts.length||delete j.doc._conflicts),j}function cp(h,g){return g>h?-1:h>g?1:0}function jZ(g,i){for(var h=0;h<g.length;h++){if(i(g[h],h)===!0){return g[h]}}}function e8(g){return function(h,i){h||i[0]&&i[0].error?g(h||i[0]):g(null,i.length?i[0]:i)}}function ek(j){for(var h=0;h<j.length;h++){var l=j[h];if(l._deleted){delete l._attachments}else{if(l._attachments){for(var i=Object.keys(l._attachments),k=0;k<i.length;k++){var g=i[k];l._attachments[g]=e4(l._attachments[g],["data","digest","content_type","length","revpos","stub"])}}}}}function fN(i,g){var k=cp(i._id,g._id);if(0!==k){return k}var h=i._revisions?i._revisions.start:0,j=g._revisions?g._revisions.start:0;return cp(h,j)}function bC(g){var i={},h=[];return dv(g,function(m,l,n,k){var j=l+"-"+n;return m&&(i[j]=0),void 0!==k&&h.push({from:k,to:j}),j}),h.reverse(),h.forEach(function(j){void 0===i[j.from]?i[j.from]=1+i[j.to]:i[j.from]=Math.min(i[j.from],1+i[j.to])}),i}function fP(i,g,k){var h="limit" in g?g.keys.slice(g.skip,g.limit+g.skip):g.skip>0?g.keys.slice(g.skip):g.keys;if(g.descending&&h.reverse(),!h.length){return i._allDocs({limit:0},k)}var j={offset:g.skip};return aZ.all(h.map(function(m){var l=jO.extend({key:m,deleted:"ok"},g);return["limit","skip","keys"].forEach(function(n){delete l[n]}),new aZ(function(o,n){i._allDocs(l,function(q,p){return q?n(q):(j.total_rows=p.total_rows,void o(p.rows[0]||{key:m,error:"not_found"}))})})})).then(function(l){return j.rows=l,j})}function aT(i){var g=i._compactionQueue[0],h=g.opts,j=g.callback;i.get("_local/compaction")["catch"](function(){return !1}).then(function(k){k&&k.last_seq&&(h.last_seq=k.last_seq),i._compact(h,function(l,m){l?j(l):j(null,m),dH.nextTick(function(){i._compactionQueue.shift(),i._compactionQueue.length&&aT(i)})})})}function e(g){return"_"===g.charAt(0)?g+"is not a valid attachment name, attachment names cannot start with '_'":!1}function aL(){bz.EventEmitter.call(this)}function aD(){this.isReady=!1,this.failed=!1,this.queue=[]}function e3(g){g&&eC.debug&&bc("error",g)}function dk(l,j){function g(){i.emit("destroyed",m)}function k(){l.removeListener("destroyed",g),l.emit("destroyed",l)}var m=j.originalName,i=l.constructor,h=i._destructionListeners;l.once("destroyed",g),h.has(m)||h.set(m,[]),h.get(m).push(k)}function d2(l,j,g){if(!(this instanceof d2)){return new d2(l,j,g)}var k=this;if("function"!=typeof j&&"undefined"!=typeof j||(g=j,j={}),l&&"object"==typeof l&&(j=l,l=void 0),"undefined"==typeof g){g=e3}else{var m=g;g=function(){return bc("warn","Using a callback for new PouchDB()is deprecated."),m.apply(null,arguments)}}l=l||j.name,j=bS(j),delete j.name,this.__opts=j;var i=g;k.auto_compaction=j.auto_compaction,k.prefix=d2.prefix,aL.call(k),k.taskqueue=new aD;var h=new aZ(function(q,o){g=function(r,s){return r?o(r):(delete s.then,void q(s))},j=bS(j);var n,p;return function(){try{if("string"!=typeof l){throw p=new Error("Missing/invalid DB name"),p.code=400,p}var r=(j.prefix||"")+l;if(n=d2.parseAdapter(r,j),j.originalName=l,j.name=n.name,j.adapter=j.adapter||n.adapter,k._adapter=j.adapter,cS("pouchdb:adapter")("Picked adapter: "+j.adapter),k._db_name=l,!d2.adapters[j.adapter]){throw p=new Error("Adapter is missing"),p.code=404,p}if(!d2.adapters[j.adapter].valid()){throw p=new Error("Invalid Adapter"),p.code=404,p}}catch(s){k.taskqueue.fail(s)}}(),p?o(p):(k.adapter=j.adapter,k.replicate={},k.replicate.from=function(r,u,s){return k.constructor.replicate(r,k,u,s)},k.replicate.to=function(r,u,s){return k.constructor.replicate(k,r,u,s)},k.sync=function(r,u,s){return k.constructor.sync(k,r,u,s)},k.replicate.sync=k.sync,void d2.adapters[j.adapter].call(k,j,function(r){return r?(k.taskqueue.fail(r),void g(r)):(dk(k,j),k.emit("created",k),d2.emit("created",j.originalName),k.taskqueue.ready(k),void g(null,k))}))});h.then(function(n){i(null,n)},i),k.then=h.then.bind(h),k["catch"]=h["catch"].bind(h)}function d8(h){Object.keys(bz.EventEmitter.prototype).forEach(function(i){"function"==typeof bz.EventEmitter.prototype[i]&&(h[i]=cM[i].bind(cM))});var g=h._destructionListeners=new b6.Map;h.on("destroyed",function(i){g.get(i).forEach(function(j){j()}),g["delete"](i)})}function ch(g){return g.reduce(function(i,h){return i[h]=!0,i},{})}function aE(i){if(!/^\d+\-./.test(i)){return dg(c2)}var g=i.indexOf("-"),j=i.substring(0,g),h=i.substring(g+1);return{prefix:parseInt(j,10),id:h}}function eR(l,j){for(var g=l.start-l.ids.length+1,k=l.ids,m=[k[0],j,[]],i=1,h=k.length;h>i;i++){m=[k[i],{status:"missing"},[m]]}return[{pos:g,ids:m}]}function t(i,k){var g,m,o,h={status:"available"};if(i._deleted&&(h.deleted=!0),k){if(i._id||(i._id=dT()),m=dT(32,16).toLowerCase(),i._rev){if(o=aE(i._rev),o.error){return o}i._rev_tree=[{pos:o.prefix,ids:[o.id,{status:"missing"},[[m,h,[]]]]}],g=o.prefix+1}else{i._rev_tree=[{pos:1,ids:[m,h,[]]}],g=1}}else{if(i._revisions&&(i._rev_tree=eR(i._revisions,h),g=i._revisions.start,m=i._revisions.ids[0]),!i._rev_tree){if(o=aE(i._rev),o.error){return o}g=o.prefix,m=o.id,i._rev_tree=[{pos:g,ids:[m,h,[]]}]}}cU(i._id),i._rev=g+"-"+m;var j={metadata:{},data:{}};for(var l in i){if(Object.prototype.hasOwnProperty.call(i,l)){var p="_"===l[0];if(p&&!ea[l]){var n=dg(fO,l);throw n.message=fO.message+": "+l,n}p&&!cG[l]?j.metadata[l.slice(1)]=i[l]:j.data[l]=i[l]}}return j}function fE(i){for(var g="",k=new Uint8Array(i),h=k.byteLength,j=0;h>j;j++){g+=String.fromCharCode(k[j])}return g}function aB(g){return e7(fE(g))}function bJ(j,h){j=j||[],h=h||{};try{return new Blob(j,h)}catch(l){if("TypeError"!==l.name){throw l}for(var i="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder,k=new i,g=0;g<j.length;g+=1){k.append(j[g])}return k.getBlob(h.type)}}function jN(i){for(var g=i.length,k=new ArrayBuffer(g),h=new Uint8Array(k),j=0;g>j;j++){h[j]=i.charCodeAt(j)}return k}function aR(h,g){return bJ([jN(h)],{type:g})}function bq(h,g){return aR(f1(h),g)}function fJ(i,g){if("undefined"==typeof FileReader){return g(fE((new FileReaderSync).readAsArrayBuffer(i)))}var j=new FileReader,h="function"==typeof j.readAsBinaryString;j.onloadend=function(k){var l=k.target.result||"";return h?g(l):void g(fE(l))},h?j.readAsBinaryString(i):j.readAsArrayBuffer(i)}function aa(h,g){fJ(h,function(i){g(e7(i))})}function cZ(g,i){if("undefined"==typeof FileReader){return i((new FileReaderSync).readAsArrayBuffer(g))}var h=new FileReader;h.onloadend=function(j){var k=j.target.result||new ArrayBuffer(0);i(k)},h.readAsArrayBuffer(g)}function jG(g){return e7(g)}function dz(i,g,j,h){(j>0||h<g.byteLength)&&(g=new Uint8Array(g,j,Math.min(h,g.byteLength)-j)),i.append(g)}function dC(i,g,j,h){(j>0||h<g.length)&&(g=g.substring(j,h)),i.appendBinary(g)}function db(i,k){function g(){var q=l*h,u=q+h;if(l++,j>l){n(p,i,q,u),ck(g)}else{n(p,i,q,u);var r=p.end(!0),s=jG(r);k(s),p.destroy()}}var m="string"==typeof i,o=m?i.length:i.byteLength,h=Math.min(bG,o),j=Math.ceil(o/h),l=0,p=m?new bw:new bw.ArrayBuffer,n=m?dC:dz;g()}function eG(g){return bw.hash(g)}function jV(g,h,m){function i(o){try{return f1(o)}catch(q){var p=dg(ba,"Attachment is not a valid base64 string");return{error:p}}}function k(q,p){if(q.stub){return p()}if("string"==typeof q.data){var o=i(q.data);if(o.error){return p(o.error)}q.length=o.length,"blob"===h?q.data=aR(o,q.content_type):"base64"===h?q.data=e7(o):q.data=o,db(o,function(r){q.digest="md5-"+r,p()})}else{cZ(q.data,function(r){"binary"===h?q.data=fE(r):"base64"===h&&(q.data=aB(r)),db(r,function(s){q.digest="md5-"+s,q.length=r.byteLength,p()})})}}function l(){n++,g.length===n&&(j?m(j):m())}if(!g.length){return m()}var j,n=0;g.forEach(function(r){function p(u){j=u,q++,q===s.length&&l()}var s=r.data&&r.data._attachments?Object.keys(r.data._attachments):[],q=0;if(!s.length){return l()}for(var o in r.data._attachments){r.data._attachments.hasOwnProperty(o)&&k(r.data._attachments[o],p)}})}function bu(p,x,s,B,w,i,v,g){if(cI(x.rev_tree,s.metadata.rev)){return B[w]=s,i()}var z=x.winningRev||cm(x),m="deleted" in x?x.deleted:aP(x,z),A="deleted" in s.metadata?s.metadata.deleted:aP(s.metadata),n=/^1-/.test(s.metadata.rev);if(m&&!A&&g&&n){var q=s.data;q._rev=z,q._id=s.metadata.id,s=t(q,g)}var h=af(x.rev_tree,s.metadata.rev_tree[0],p),l=g&&(m&&A||!m&&"new_leaf"!==h.conflicts||m&&!A&&"new_branch"===h.conflicts);if(l){var k=dg(cL);return B[w]=k,i()}var j=s.metadata.rev;s.metadata.rev_tree=h.tree,s.stemmedRevs=h.stemmedRevs||[],x.rev_map&&(s.metadata.rev_map=x.rev_map);var r,y=cm(s.metadata),o=aP(s.metadata,y),u=m===o?0:o>m?-1:1;r=j===y?o:aP(s.metadata,j),v(s,y,o,r,!0,u,w,i)}function jM(g){return"missing"===g.metadata.rev_tree[0].ids[1].status}function bl(o,g,i,q,u,k,v,j,r){function p(x,C,B){var A=cm(x.metadata),D=aP(x.metadata,A);if("was_delete" in j&&D){return k[C]=dg(e6,"deleted"),B()}var w=h&&jM(x);if(w){var z=dg(cL);return k[C]=z,B()}var y=D?0:1;v(x,A,D,D,!1,y,C,B)}function m(){++s===l&&r&&r()}o=o||1000;var h=j.new_edits,n=new b6.Map,s=0,l=g.length;g.forEach(function(y,w){if(y._id&&f0(y._id)){var x=y._deleted?"_removeLocal":"_putLocal";return void i[x](y,{ctx:u},function(B,A){k[w]=B||A,m()})}var z=y.metadata.id;n.has(z)?(l--,n.get(z).push([y,w])):n.set(z,[[y,w]])}),n.forEach(function(x,z){function y(){++w<x.length?A():m()}function A(){var C=x[w],E=C[0],D=C[1];if(q.has(z)){bu(o,q.get(z),E,k,D,y,v,h)}else{var B=af([],E.metadata.rev_tree[0],o);E.metadata.rev_tree=B.tree,E.stemmedRevs=B.stemmedRevs||[],p(E,D,y)}}var w=0;A()})}function aw(h){try{return JSON.parse(h)}catch(g){return au.parse(h)}}function ay(g){return g.length<50000?JSON.parse(g):aw(g)}function fK(h){try{return JSON.stringify(h)}catch(g){return au.stringify(h)}}function j7(i,g,k,h){try{i.apply(g,k)}catch(j){h.emit("error",j)}}function bH(h){if(!aW.running&&aW.queue.length){aW.running=!0;var g=aW.queue.shift();g.action(function(i,j){j7(g.callback,this,[i,j],h),aW.running=!1,dH.nextTick(function(){bH(h)})})}}function b1(g){return function(h){var i="unknown_error";h.target&&h.target.error&&(i=h.target.error.name||h.target.error.message),g(dg(cs,i,h.type))}}function dj(g,i,h){return{data:fK(g),winningRev:i,deletedOrLocal:h?"1":"0",seq:g.seq,id:g.id}}function b8(h){if(!h){return null}var g=ay(h.data);return g.winningRev=h.winningRev,g.deleted="1"===h.deletedOrLocal,g.seq=h.seq,g}function j0(h){if(!h){return h}var g=h._doc_id_rev.lastIndexOf(":");return h._id=h._doc_id_rev.substring(0,g-1),h._rev=h._doc_id_rev.substring(g+1),delete h._doc_id_rev,h}function bR(i,g,j,h){j?h(i?"string"!=typeof i?i:bq(i,g):bJ([""],{type:g})):i?"string"!=typeof i?fJ(i,function(k){h(e7(k))}):h(i):h("")}function bk(g,h,m,i){function k(){++n===j.length&&i&&i()}function l(s,q){var r=s._attachments[q],p=r.digest,o=m.objectStore(kf).get(p);o.onsuccess=function(u){r.body=u.target.result.body,k()}}var j=Object.keys(g._attachments||{});if(!j.length){return i&&i()}var n=0;j.forEach(function(o){h.attachments&&h.include_docs?l(g,o):(g._attachments[o].stub=!0,k())})}function bM(h,g){return aZ.all(h.map(function(i){if(i.doc&&i.doc._attachments){var j=Object.keys(i.doc._attachments);return aZ.all(j.map(function(n){var l=i.doc._attachments[n];if("body" in l){var m=l.body,k=l.content_type;return new aZ(function(o){bR(m,k,g,function(p){i.doc._attachments[n]=jO.extend(e4(l,["digest","content_type"]),{data:p}),o()})})}}))}}))}function c3(i,k,g){function m(){n--,n||o()}function o(){h.length&&h.forEach(function(q){var r=p.index("digestSeq").count(IDBKeyRange.bound(q+"::",q+"::￿",!1,!1));r.onsuccess=function(s){var u=s.target.result;u||l["delete"](q)}})}var h=[],j=g.objectStore(cA),l=g.objectStore(kf),p=g.objectStore(bg),n=i.length;i.forEach(function(s){var r=j.index("_doc_id_rev"),q=k+"::"+s;r.getKey(q).onsuccess=function(u){var w=u.target.result;if("number"!=typeof w){return m()}j["delete"](w);var v=p.index("seq").openCursor(IDBKeyRange.only(w));v.onsuccess=function(x){var z=x.target.result;if(z){var y=z.value.digestSeq.split("::")[0];h.push(y),p["delete"](z.primaryKey),z["continue"]()}else{m()}}}})}function jW(i,g,j){try{return{txn:i.transaction(g,j)}}catch(h){return{error:h}}}function al(u,I,m,k,p,r,C){function G(){var P=[dG,cA,kf,dW,bg],O=jW(p,P,"readwrite");return O.error?C(O.error):(y=O.txn,y.onabort=b1(C),y.ontimeout=b1(C),y.oncomplete=x,q=y.objectStore(dG),A=y.objectStore(cA),o=y.objectStore(kf),H=y.objectStore(bg),void g(function(Q){return Q?(N=!0,C(Q)):void h()}))}function v(){bl(u.revs_limit,F,k,M,y,z,j,m)}function h(){function U(){++P===F.length&&v()}function S(W){var V=b8(W.target.result);V&&M.set(V.id,V),U()}if(F.length){for(var P=0,T=0,O=F.length;O>T;T++){var R=F[T];if(R._id&&f0(R._id)){U()}else{var Q=q.get(R.metadata.id);Q.onsuccess=S}}}}function x(){N||(r.notify(k._meta.name),k._meta.docCount+=B,C(null,z))}function l(P,O){var Q=o.get(P);Q.onsuccess=function(S){if(S.target.result){O()}else{var R=dg(bA,"unknown stub attachment with digest "+P);R.status=412,O(R)}}}function g(Q){function O(){++R===S.length&&Q(P)}var S=[];if(F.forEach(function(T){T.data&&T.data._attachments&&Object.keys(T.data._attachments).forEach(function(V){var U=T.data._attachments[V];U.stub&&S.push(U.digest)})}),!S.length){return Q()}var P,R=0;S.forEach(function(T){l(T,function(U){U&&!P&&(P=U),O()})})}function j(U,O,S,Q,R,T,W,P){B+=T,U.metadata.winningRev=O,U.metadata.deleted=S;var X=U.data;X._id=U.metadata.id,X._rev=U.metadata.rev,Q&&(X._deleted=!0);var V=X._attachments&&Object.keys(X._attachments).length;return V?D(U,O,S,R,W,P):void K(U,O,S,R,W,P)}function K(X,Q,S,R,U,O){function W(ao){var ai=X.stemmedRevs||[];R&&k.auto_compaction&&(ai=ai.concat(fM(X.metadata))),ai&&ai.length&&c3(ai,X.metadata.id,y),T.seq=ao.target.result,delete T.rev;var ae=dj(T,Q,S),an=q.put(ae);an.onsuccess=Z}function P(an){an.preventDefault(),an.stopPropagation();var ai=A.index("_doc_id_rev"),ae=ai.getKey(V._doc_id_rev);ae.onsuccess=function(ar){var ao=A.put(V,ar.target.result);ao.onsuccess=W}}function Z(){z[U]={ok:!0,id:T.id,rev:Q},M.set(X.metadata.id,X.metadata),n(X,T.seq,O)}var V=X.data,T=X.metadata;V._doc_id_rev=T.id+"::"+T.rev,delete V._id,delete V._rev;var Y=A.put(V);Y.onsuccess=W,Y.onerror=P}function D(W,P,T,R,S,U){function Y(){X===V.length&&K(W,P,T,R,S,U)}function Q(){X++,Y()}var O=W.data,X=0,V=Object.keys(O._attachments);V.forEach(function(ae){var ai=W.data._attachments[ae];if(ai.stub){X++,Y()}else{var Z=ai.data;delete ai.data,ai.revpos=parseInt(P,10);var an=ai.digest;E(an,Z,Q)}})}function n(V,S,P){function U(){++R===Q.length&&P()}function O(X){var W=V.data._attachments[X].digest,Y=H.put({seq:S,digestSeq:W+"::"+S});Y.onsuccess=U,Y.onerror=function(Z){Z.preventDefault(),Z.stopPropagation(),U()}}var R=0,Q=Object.keys(V.data._attachments||{});if(!Q.length){return P()}for(var T=0;T<Q.length;T++){O(Q[T])}}function E(Q,O,R){var P=o.count(Q);P.onsuccess=function(V){var S=V.target.result;if(S){return R()}var U={digest:Q,body:O},T=o.put(U);T.onsuccess=R}}for(var y,q,A,o,H,s,F=I.docs,B=0,w=0,J=F.length;J>w;w++){var L=F[w];L._id&&f0(L._id)||(L=F[w]=t(L,m.new_edits),L.error&&!s&&(s=L))}if(s){return C(s)}var z=new Array(F.length),M=new b6.Map,N=!1,i=k._meta.blobSupport?"blob":"base64";jV(F,i,function(O){return O?C(O):void G()})}function cy(j,h,l,i,k){try{if(j&&h){return k?IDBKeyRange.bound(h,j,!l,!1):IDBKeyRange.bound(j,h,!1,!l)}if(j){return k?IDBKeyRange.upperBound(j):IDBKeyRange.lowerBound(j)}if(h){return k?IDBKeyRange.lowerBound(h,!l):IDBKeyRange.upperBound(h,!l)}if(i){return IDBKeyRange.only(i)}}catch(g){return{error:g}}return null}function cK(i,g,j,h){return"DataError"===j.name&&0===j.code?h(null,{total_rows:i._meta.docCount,offset:g.skip,rows:[]}):void h(dg(cs,j.name,j.message))}function bs(j,h,l,i){function k(C,z){function A(L,O,M){var N=L.id+"::"+M;m.get(N).onsuccess=function(P){O.doc=j0(P.target.result),C.conflicts&&(O.doc._conflicts=eY(L)),bk(O.doc,C,x)}}function v(O,L,P){var N={id:P.id,key:P.id,value:{rev:L}},M=P.deleted;if("ok"===C.deleted){n.push(N),M?(N.value.deleted=!0,N.doc=null):C.include_docs&&A(P,N,L)}else{if(!M&&F--<=0&&(n.push(N),C.include_docs&&A(P,N,L),0===--o)){return}}O["continue"]()}function G(M){K=h._meta.docCount;var O=M.target.result;if(O){var L=b8(O.value),N=L.winningRev;v(O,N,L)}}function y(){z(null,{total_rows:K,offset:C.skip,rows:n})}function J(){C.attachments?bM(n,C.binary).then(y):y()}var r="startkey" in C?C.startkey:!1,q="endkey" in C?C.endkey:!1,E="key" in C?C.key:!1,F=C.skip||0,o="number"==typeof C.limit?C.limit:-1,H=C.inclusive_end!==!1,B="descending" in C&&C.descending?"prev":null,u=cy(r,q,H,E,B);if(u&&u.error){return cK(h,C,u.error,z)}var s=[dG,cA];C.attachments&&s.push(kf);var I=jW(l,s,"readonly");if(I.error){return z(I.error)}var x=I.txn,p=x.objectStore(dG),D=x.objectStore(cA),w=B?p.openCursor(u,B):p.openCursor(u),m=D.index("_doc_id_rev"),n=[],K=0;x.oncomplete=J,w.onsuccess=G}function g(m,n){return 0===m.limit?n(null,{total_rows:h._meta.docCount,offset:m.skip,rows:[]}):void k(m,n)}g(j,i)}function b4(g){return new aZ(function(h){var i=bJ([""]);g.objectStore(aS).put(i,"key"),g.onabort=function(j){j.preventDefault(),j.stopPropagation(),h(!1)},g.oncomplete=function(){var j=navigator.userAgent.match(/Chrome\/(\d+)/),k=navigator.userAgent.match(/Edge\//);h(k||!j||parseInt(j[1],10)>=43)}})["catch"](function(){return !1})}function eg(g,i){var h=this;aW.queue.push({action:function(j){aG(h,g,j)},callback:i}),bH(h.constructor)}function aG(k,l,p){function s(x){var w=x.createObjectStore(dG,{keyPath:"id"});x.createObjectStore(cA,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),x.createObjectStore(kf,{keyPath:"digest"}),x.createObjectStore(j4,{keyPath:"id",autoIncrement:!1}),x.createObjectStore(aS),w.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),x.createObjectStore(dW,{keyPath:"_id"});var v=x.createObjectStore(bg,{autoIncrement:!0});v.createIndex("seq","seq"),v.createIndex("digestSeq","digestSeq",{unique:!0})}function u(x,w){var v=x.objectStore(dG);v.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),v.openCursor().onsuccess=function(z){var B=z.target.result;if(B){var y=B.value,A=aP(y);y.deletedOrLocal=A?"1":"0",v.put(y),B["continue"]()}else{w()}}}function o(v){v.createObjectStore(dW,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}function j(x,z){var y=x.objectStore(dW),v=x.objectStore(dG),w=x.objectStore(cA),A=v.openCursor();A.onsuccess=function(D){var M=D.target.result;if(M){var G=M.value,J=G.id,I=f0(J),F=cm(G);if(I){var C=J+"::"+F,L=J+"::",E=J+"::~",B=w.index("_doc_id_rev"),K=IDBKeyRange.bound(L,E,!1,!1),H=B.openCursor(K);H.onsuccess=function(N){if(H=N.target.result){var O=H.value;O._doc_id_rev===C&&y.put(O),w["delete"](H.primaryKey),H["continue"]()}else{v["delete"](M.primaryKey),M["continue"]()}}}else{M["continue"]()}}else{z&&z()}}}function g(w){var v=w.createObjectStore(bg,{autoIncrement:!0});v.createIndex("seq","seq"),v.createIndex("digestSeq","digestSeq",{unique:!0})}function h(x,z){var y=x.objectStore(cA),v=x.objectStore(kf),w=x.objectStore(bg),A=v.count();A.onsuccess=function(B){var C=B.target.result;return C?void (y.openCursor().onsuccess=function(J){var F=J.target.result;if(!F){return z()}for(var E=F.value,H=F.primaryKey,L=Object.keys(E._attachments||{}),D={},M=0;M<L.length;M++){var K=E._attachments[L[M]];D[K.digest]=!0}var I=Object.keys(D);for(M=0;M<I.length;M++){var G=I[M];w.put({seq:H,digestSeq:G+"::"+H})}F["continue"]()}):z()}}function m(y){function z(A){return A.data?b8(A):(A.deleted="1"===A.deletedOrLocal,A)}var x=y.objectStore(cA),w=y.objectStore(dG),v=w.openCursor();v.onsuccess=function(C){function D(){var H=B.id+"::",F=B.id+"::￿",G=x.index("_doc_id_rev").openCursor(IDBKeyRange.bound(H,F)),I=0;G.onsuccess=function(K){var J=K.target.result;if(!J){return B.seq=I,A()}var L=J.primaryKey;L>I&&(I=L),J["continue"]()}}function A(){var G=dj(B,B.winningRev,B.deleted),F=w.put(G);F.onsuccess=function(){E["continue"]()}}var E=C.target.result;if(E){var B=z(E.value);return B.winningRev=B.winningRev||cm(B),B.seq?A():void D()}}}var q=l.name,n=null;k._meta=null,k.type=function(){return"idb"},k._id=eB(function(v){v(null,k._meta.instanceId)}),k._bulkDocs=function(v,w,x){al(l,v,w,k,n,ab,x)},k._get=function(D,y,x){function B(){x(v,{doc:C,metadata:A,ctx:z})}var C,A,v,z=y.ctx;if(!z){var w=jW(n,[dG,cA,kf],"readonly");if(w.error){return x(w.error)}z=w.txn}z.objectStore(dG).get(D).onsuccess=function(E){if(A=b8(E.target.result),!A){return v=dg(e6,"missing"),B()}if(aP(A)&&!y.rev){return v=dg(e6,"deleted"),B()}var G=z.objectStore(cA),H=y.rev||A.winningRev,F=A.id+"::"+H;G.index("_doc_id_rev").get(F).onsuccess=function(I){return C=I.target.result,C&&(C=j0(C)),C?void B():(v=dg(e6,"missing"),B())}}},k._getAttachment=function(D,y,x,B,C){var A;if(B.ctx){A=B.ctx}else{var v=jW(n,[dG,cA,kf],"readonly");if(v.error){return C(v.error)}A=v.txn}var z=x.digest,w=x.content_type;A.objectStore(kf).get(z).onsuccess=function(E){var F=E.target.result.body;bR(F,w,B.binary,function(G){C(null,G)})}},k._info=function(A){if(null===n||!cB.has(q)){var y=new Error("db isn't open");return y.id="idbNull",A(y)}var B,z,x=jW(n,[cA],"readonly");if(x.error){return A(x.error)}var w=x.txn,v=w.objectStore(cA).openCursor(null,"prev");v.onsuccess=function(D){var C=D.target.result;B=C?C.key:0,z=k._meta.docCount},w.oncomplete=function(){A(null,{doc_count:z,update_seq:B,idb_attachment_format:k._meta.blobSupport?"binary":"base64"})}},k._allDocs=function(v,w){bs(v,k,n,w)},k._changes=function(z){function J(N){function T(){return S.seq!==O?N["continue"]():(I=O,S.winningRev===P._rev?R(P):void Q())}function Q(){var U=P._id+"::"+S.winningRev,V=w.get(U);V.onsuccess=function(W){R(j0(W.target.result))}}function R(V){var W=z.processChange(V,S,z);W.seq=S.seq;var U=G(W);return"object"==typeof U?z.complete(U):(U&&(L++,F&&v.push(W),z.attachments&&z.include_docs?bk(V,z,E,function(){bM([W],z.binary).then(function(){z.onChange(W)})}):z.onChange(W)),void (L!==x&&N["continue"]()))}var P=j0(N.value),O=N.key;if(C&&!C.has(P._id)){return N["continue"]()}var S;return(S=y.get(P._id))?T():void (M.get(P._id).onsuccess=function(U){S=b8(U.target.result),y.set(P._id,S),T()})}function H(N){var O=N.target.result;O&&J(O)}function K(){var P=[dG,cA];z.attachments&&P.push(kf);var O=jW(n,P,"readonly");if(O.error){return z.complete(O.error)}E=O.txn,E.onabort=b1(z.complete),E.oncomplete=D,B=E.objectStore(cA),M=E.objectStore(dG),w=B.index("_doc_id_rev");var N;N=z.descending?B.openCursor(null,"prev"):B.openCursor(IDBKeyRange.lowerBound(z.since,!0)),N.onsuccess=H}function D(){function N(){z.complete(null,{results:v,last_seq:I})}!z.continuous&&z.attachments?bM(v).then(N):N()}if(z=bS(z),z.continuous){var A=q+":"+dT();return ab.addListener(q,A,k,z),ab.notify(q),{cancel:function(){ab.removeListener(q,A)}}}var C=z.doc_ids&&new b6.Set(z.doc_ids);z.since=z.since||0;var I=z.since,x="limit" in z?z.limit:-1;0===x&&(x=1);var F;F="return_docs" in z?z.return_docs:"returnDocs" in z?z.returnDocs:!0;var E,B,M,w,v=[],L=0,G=e0(z),y=new b6.Map;K()},k._close=function(v){return null===n?v(dg(bF)):(n.close(),cB["delete"](q),n=null,void v())},k._getRevisionTree=function(y,z){var x=jW(n,[dG],"readonly");if(x.error){return z(x.error)}var w=x.txn,v=w.objectStore(dG).get(y);v.onsuccess=function(B){var A=b8(B.target.result);A?z(null,A.rev_tree):z(dg(e6))}},k._doCompaction=function(y,A,z){var v=[dG,cA,kf,bg],B=jW(n,v,"readwrite");if(B.error){return z(B.error)}var x=B.txn,w=x.objectStore(dG);w.get(y).onsuccess=function(E){var C=b8(E.target.result);dv(C.rev_tree,function(L,H,K,G,J){var I=H+"-"+K;-1!==A.indexOf(I)&&(J.status="missing")}),c3(A,y,x);var D=C.winningRev,F=C.deleted;x.objectStore(dG).put(dj(C,D,F))},x.onabort=b1(z),x.oncomplete=function(){z()}},k._getLocal=function(y,z){var x=jW(n,[dW],"readonly");if(x.error){return z(x.error)}var w=x.txn,v=w.objectStore(dW).get(y);v.onerror=b1(z),v.onsuccess=function(B){var A=B.target.result;A?(delete A._doc_id_rev,z(null,A)):z(dg(e6))}},k._putLocal=function(E,z,x){"function"==typeof z&&(x=z,z={}),delete E._revisions;var C=E._rev,D=E._id;C?E._rev="0-"+(parseInt(C.split("-")[1],10)+1):E._rev="0-1";var B,w=z.ctx;if(!w){var A=jW(n,[dW],"readwrite");if(A.error){return x(A.error)}w=A.txn,w.onerror=b1(x),w.oncomplete=function(){B&&x(null,B)}}var y,v=w.objectStore(dW);C?(y=v.get(D),y.onsuccess=function(H){var G=H.target.result;if(G&&G._rev===C){var F=v.put(E);F.onsuccess=function(){B={ok:!0,id:E._id,rev:E._rev},z.ctx&&x(null,B)}}else{x(dg(cL))}}):(y=v.add(E),y.onerror=function(F){x(dg(cL)),F.preventDefault(),F.stopPropagation()},y.onsuccess=function(){B={ok:!0,id:E._id,rev:E._rev},z.ctx&&x(null,B)})},k._removeLocal=function(D,y,x){"function"==typeof y&&(x=y,y={});var B=y.ctx;if(!B){var C=jW(n,[dW],"readwrite");if(C.error){return x(C.error)}B=C.txn,B.oncomplete=function(){A&&x(null,A)}}var A,v=D._id,z=B.objectStore(dW),w=z.get(v);w.onerror=b1(x),w.onsuccess=function(F){var E=F.target.result;E&&E._rev===D._rev?(z["delete"](v),A={ok:!0,id:v,rev:"0-0"},y.ctx&&x(null,A)):x(dg(e6))}},k._destroy=function(y,w){ab.removeAllListeners(q);var v=dQ.get(q);v&&v.result&&(v.result.close(),cB["delete"](q));var x=indexedDB.deleteDatabase(q);x.onsuccess=function(){dQ["delete"](q),ds()&&q in localStorage&&delete localStorage[q],w(null,{ok:!0})},x.onerror=b1(w)};var i=cB.get(q);if(i){return n=i.idb,k._meta=i.global,void dH.nextTick(function(){p(null,k)})}var r;r=l.storage?j8(q,l.storage):indexedDB.open(q,cD),dQ.set(q,r),r.onupgradeneeded=function(z){function x(){var B=w[A-1];A++,B&&B(y,x)}var v=z.target.result;if(z.oldVersion<1){return s(v)}var y=z.currentTarget.transaction;z.oldVersion<3&&o(v),z.oldVersion<4&&g(v);var w=[u,j,h,m],A=z.oldVersion;x()},r.onsuccess=function(v){n=v.target.result,n.onversionchange=function(){n.close(),cB["delete"](q)},n.onabort=function(B){bc("error","Database has a global failure",B.target.error),n.close(),cB["delete"](q)};var y=n.transaction([j4,aS,dG],"readwrite"),w=y.objectStore(j4).get(j4),z=null,x=null,A=null;w.onsuccess=function(D){var B=function(){null!==z&&null!==x&&null!==A&&(k._meta={name:q,instanceId:A,blobSupport:z,docCount:x},cB.set(q,{idb:n,global:k._meta}),p(null,k))},E=D.target.result||{id:j4};q+"_id" in E?(A=E[q+"_id"],B()):(A=dT(),E[q+"_id"]=A,y.objectStore(j4).put(E).onsuccess=function(){B()}),bE||(bE=b4(y)),bE.then(function(F){z=F,B()});var C=y.objectStore(dG).index("deletedOrLocal");C.count(IDBKeyRange.only("0")).onsuccess=function(F){x=F.target.result,B()}}},r.onerror=function(){var v="Failed to open indexedDB, are you in private browsing mode?";bc("error",v),p(dg(cs,v))}}function j8(g,i){try{return indexedDB.open(g,{version:cD,storage:i})}catch(h){return indexedDB.open(g,cD)}}function aH(g){g.adapter("idb",eg,!0)}function aJ(g){return decodeURIComponent(escape(g))}function c5(g){return 65>g?g-48:g-55}function cR(i,g,j){for(var h="";j>g;){h+=String.fromCharCode(c5(i.charCodeAt(g++))<<4|c5(i.charCodeAt(g++)))}return h}function aV(i,g,j){for(var h="";j>g;){h+=String.fromCharCode(c5(i.charCodeAt(g+2))<<12|c5(i.charCodeAt(g+3))<<8|c5(i.charCodeAt(g))<<4|c5(i.charCodeAt(g+1))),g+=4}return h}function cw(h,g){return"UTF-8"===g?aJ(cR(h,0,h.length)):aV(h,0,h.length)}function aM(g){return"'"+g+"'"}function aO(g){return g.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"")}function cX(g){return g.replace(/\u0001\u0001/g,"\x00").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,"")}function aq(g){return delete g._id,delete g._rev,JSON.stringify(g)}function cH(g,i,h){return g=JSON.parse(g),g._id=i,g._rev=h,g}function dM(h){for(var g="(";h--;){g+="?",h&&(g+=",")}return g+")"}function cN(i,g,k,h,j){return"SELECT "+i+" FROM "+("string"==typeof g?g:g.join(" JOIN "))+(k?" ON "+k:"")+(h?" WHERE "+("string"==typeof h?h:h.join(" AND ")):"")+(j?" ORDER BY "+j:"")}function am(l,j,g){function k(){++i===l.length&&m()}function m(){if(h.length){var n="SELECT DISTINCT digest AS digest FROM "+f4+" WHERE seq IN "+dM(h.length);g.executeSql(n,h,function(q,o){for(var s=[],p=0;p<o.rows.length;p++){s.push(o.rows.item(p).digest)}if(s.length){var r="DELETE FROM "+f4+" WHERE seq IN ("+h.map(function(){return"?"}).join(",")+")";q.executeSql(r,h,function(v){var u="SELECT digest FROM "+f4+" WHERE digest IN ("+s.map(function(){return"?"}).join(",")+")";v.executeSql(u,s,function(z,w){for(var y=new b6.Set,x=0;x<w.rows.length;x++){y.add(w.rows.item(x).digest)}s.forEach(function(A){y.has(A)||(z.executeSql("DELETE FROM "+f4+" WHERE digest=?",[A]),z.executeSql("DELETE FROM "+dB+" WHERE digest=?",[A]))})})})}})}}if(l.length){var i=0,h=[];l.forEach(function(o){var n="SELECT seq FROM "+dl+" WHERE doc_id=? AND rev=?";g.executeSql(n,[j,o],function(q,p){if(!p.rows.length){return k()}var r=p.rows.item(0).seq;h.push(r),q.executeSql("DELETE FROM "+dl+" WHERE seq=?",[r],k)})})}}function cg(g){return function(h){bc("error","WebSQL threw an error",h);var k=h&&h.constructor.toString().match(/function ([^\(]+)/),i=k&&k[1]||h.type,j=h.target||h.message;g(dg(dF,j,i))}}function bY(h){if("size" in h){return 1000000*h.size}var g="undefined"!=typeof navigator&&/Android/.test(navigator.userAgent);return g?5000000:1}function bf(q,h,n,k,m,s,j){function i(){return A?j(A):(s.notify(k._name),k._docCount=-1,void j(null,w))}function z(E,D){var F="SELECT count(*) as cnt FROM "+dB+" WHERE digest=?";p.executeSql(F,[E],function(G,H){if(0===H.rows.item(0).cnt){var I=dg(bA,"unknown stub attachment with digest "+E);D(I)}else{D()}})}function B(F){function D(){++G===H.length&&F(E)}var H=[];if(o.forEach(function(I){I.data&&I.data._attachments&&Object.keys(I.data._attachments).forEach(function(J){var K=I.data._attachments[J];K.stub&&H.push(K.digest)})}),!H.length){return F()}var E,G=0;H.forEach(function(I){z(I,function(J){J&&!E&&(E=J),D()})})}function C(O,H,R,M,K,E,J,G){function Q(){function Y(ar,at){function a0(){return ++an===ae.length&&at(),!1}function ai(a3){var a1="INSERT INTO "+f4+" (digest, seq) VALUES (?,?)",a2=[X._attachments[a3].digest,ar];p.executeSql(a1,a2,a0,a0)}var an=0,ae=Object.keys(X._attachments||{});if(!ae.length){return at()}for(var ao=0;ao<ae.length;ao++){ai(ae[ao])}}var X=O.data,S=M?1:0,V=X._id,Z=X._rev,T=aq(X),U="INSERT INTO "+dl+" (doc_id, rev, json, deleted) VALUES (?, ?, ?, ?);",W=[V,Z,T,S];p.executeSql(U,W,function(ae,an){var ai=an.insertId;Y(ai,function(){P(ae,ai)})},function(){var ae=cN("seq",dl,null,"doc_id=? AND rev=?");return p.executeSql(ae,[V,Z],function(ai,an){var ao=an.rows.item(0).seq,ar="UPDATE "+dl+" SET json=?, deleted=? WHERE doc_id=? AND rev=?;",at=[T,S,V,Z];ai.executeSql(ar,at,function(a0){Y(ao,function(){P(a0,ao)})})}),!1})}function N(S){L||(S?(L=S,G(L)):F===D.length&&Q())}function I(S){F++,N(S)}function P(S,Y){var U=O.metadata.id,T=O.stemmedRevs||[];K&&k.auto_compaction&&(T=fM(O.metadata).concat(T)),T.length&&am(T,U,S),O.metadata.seq=Y,delete O.metadata.rev;var V=K?"UPDATE "+b3+" SET json=?, max_seq=?, winningseq=(SELECT seq FROM "+dl+" WHERE doc_id="+b3+".id AND rev=?) WHERE id=?":"INSERT INTO "+b3+" (id, winningseq, max_seq, json) VALUES (?,?,?,?);",W=fK(O.metadata),X=K?[W,Y,H,U]:[U,Y,Y,W];S.executeSql(V,X,function(){w[J]={ok:!0,id:O.metadata.id,rev:H},r.set(U,O.metadata),G()})}var L=null,F=0;O.data._id=O.metadata.id,O.data._rev=O.metadata.rev;var D=Object.keys(O.data._attachments||{});M&&(O.data._deleted=!0),D.forEach(function(U){var S=O.data._attachments[U];if(S.stub){F++,N()}else{var T=S.data;delete S.data,S.revpos=parseInt(H,10);var V=S.digest;x(V,T,I)}}),D.length||Q()}function v(){bl(q.revs_limit,o,k,r,p,w,C,n)}function g(E){function D(){++F===o.length&&E()}if(!o.length){return E()}var F=0;o.forEach(function(G){if(G._id&&f0(G._id)){return D()}var H=G.metadata.id;p.executeSql("SELECT json FROM "+b3+" WHERE id = ?",[H],function(I,K){if(K.rows.length){var J=ay(K.rows.item(0).json);r.set(H,J)}D()})})}function x(F,D,G){var E="SELECT digest FROM "+dB+" WHERE digest=?";p.executeSql(E,[F],function(H,I){return I.rows.length?G():(E="INSERT INTO "+dB+" (digest, body, escaped) VALUES (?,?,1)",void H.executeSql(E,[F,aO(D)],function(){G()},function(){return G(),!1}))})}var u=n.new_edits,y=h.docs,o=y.map(function(E){if(E._id&&f0(E._id)){return E}var D=t(E,u);return D}),l=o.filter(function(D){return D.error});if(l.length){return j(l[0])}var p,A,w=new Array(o.length),r=new b6.Map;jV(o,"binary",function(D){return D?j(D):void m.transaction(function(E){p=E,B(function(F){F?A=F:g(v)})},cg(j),i)})}function bL(g){return g.websql(g.name,g.version,g.description,g.size)}function cv(h){try{return{db:bL(h)}}catch(g){return{error:g}}}function fF(h){var g=cQ.get(h.name);return g||(g=cv(h),cQ.set(h.name,g),g.db&&(g.db._sqlitePlugin="undefined"!=typeof sqlitePlugin)),g}function bh(g,i,l,j,m){function n(){++o===k.length&&m&&m()}function h(q,s){var r=q._attachments[s],p={binary:i.binary,ctx:j};l._getAttachment(q._id,s,r,p,function(u,v){q._attachments[s]=jO.extend(e4(r,["digest","content_type"]),{data:v}),n()})}var k=Object.keys(g._attachments||{});if(!k.length){return m&&m()}var o=0;k.forEach(function(p){i.attachments&&i.include_docs?h(g,p):(g._attachments[p].stub=!0,n())})}function eI(r,n){function s(){ds()&&(window.localStorage["_pouch__websqldb_"+B._name]=!0),n(null,B)}function o(F,E){F.executeSql(dL),F.executeSql("ALTER TABLE "+dl+" ADD COLUMN deleted TINYINT(1) DEFAULT 0",[],function(){F.executeSql(c7),F.executeSql("ALTER TABLE "+b3+" ADD COLUMN local TINYINT(1) DEFAULT 0",[],function(){F.executeSql("CREATE INDEX IF NOT EXISTS 'doc-store-local-idx' ON "+b3+" (local, id)");var G="SELECT "+b3+".winningseq AS seq, "+b3+".json AS metadata FROM "+dl+" JOIN "+b3+" ON "+dl+".seq = "+b3+".winningseq";F.executeSql(G,[],function(I,M){for(var H=[],K=[],L=0;L<M.rows.length;L++){var N=M.rows.item(L),O=N.seq,J=JSON.parse(N.metadata);aP(J)&&H.push(O),f0(J.id)&&K.push(J.id)}I.executeSql("UPDATE "+b3+"SET local = 1 WHERE id IN "+dM(K.length),K,function(){I.executeSql("UPDATE "+dl+" SET deleted = 1 WHERE seq IN "+dM(H.length),H,E)})})})})}function p(F,E){var G="CREATE TABLE IF NOT EXISTS "+bX+" (id UNIQUE, rev, json)";F.executeSql(G,[],function(){var H="SELECT "+b3+".id AS id, "+dl+".json AS data FROM "+dl+" JOIN "+b3+" ON "+dl+".seq = "+b3+".winningseq WHERE local = 1";F.executeSql(H,[],function(J,L){function I(){if(!K.length){return E(J)}var O=K.shift(),N=JSON.parse(O.data)._rev;J.executeSql("INSERT INTO "+bX+" (id, rev, json) VALUES (?,?,?)",[O.id,N,O.data],function(P){P.executeSql("DELETE FROM "+b3+" WHERE id=?",[O.id],function(Q){Q.executeSql("DELETE FROM "+dl+" WHERE seq=?",[O.seq],function(){I()})})})}for(var K=[],M=0;M<L.rows.length;M++){K.push(L.rows.item(M))}I()})})}function j(G,E){function H(J){function I(){if(!J.length){return E(G)}var N=J.shift(),L=cw(N.hex,D),O=L.lastIndexOf("::"),M=L.substring(0,O),K=L.substring(O+2),P="UPDATE "+dl+" SET doc_id=?, rev=? WHERE doc_id_rev=?";G.executeSql(P,[M,K,L],function(){I()})}I()}var F="ALTER TABLE "+dl+" ADD COLUMN doc_id";G.executeSql(F,[],function(J){var I="ALTER TABLE "+dl+" ADD COLUMN rev";J.executeSql(I,[],function(K){K.executeSql(cW,[],function(L){var M="SELECT hex(doc_id_rev) as hex FROM "+dl;L.executeSql(M,[],function(P,N){for(var O=[],Q=0;Q<N.rows.length;Q++){O.push(N.rows.item(Q))}H(O)})})})})}function u(G,E){function H(I){var J="SELECT COUNT(*) AS cnt FROM "+dB;I.executeSql(J,[],function(M,O){function L(){var Q=cN(a9+", "+b3+".id AS id",[b3,dl],b5,null,b3+".id ");Q+=" LIMIT "+P+" OFFSET "+K,K+=P,M.executeSql(Q,[],function(ai,V){function an(at,ar){var ao=X[at]=X[at]||[];-1===ao.indexOf(ar)&&ao.push(ar)}if(!V.rows.length){return E(ai)}for(var X={},S=0;S<V.rows.length;S++){for(var U=V.rows.item(S),T=cH(U.data,U.id,U.rev),Z=Object.keys(T._attachments||{}),R=0;R<Z.length;R++){var W=T._attachments[Z[R]];an(W.digest,U.seq)}}var ae=[];if(Object.keys(X).forEach(function(ar){var ao=X[ar];ao.forEach(function(at){ae.push([ar,at])})}),!ae.length){return L()}var Y=0;ae.forEach(function(ao){var ar="INSERT INTO "+f4+" (digest, seq) VALUES (?,?)";ai.executeSql(ar,ao,function(){++Y===ae.length&&L()})})})}var N=O.rows.item(0).cnt;if(!N){return E(M)}var K=0,P=10;L()})}var F="CREATE TABLE IF NOT EXISTS "+f4+" (digest, seq INTEGER)";G.executeSql(F,[],function(I){I.executeSql(jL,[],function(J){J.executeSql(f2,[],H)})})}function w(F,E){var G="ALTER TABLE "+dB+" ADD COLUMN escaped TINYINT(1) DEFAULT 0";F.executeSql(G,[],E)}function A(F,E){var G="ALTER TABLE "+b3+" ADD COLUMN max_seq INTEGER";F.executeSql(G,[],function(I){var H="UPDATE "+b3+" SET max_seq=(SELECT MAX(seq) FROM "+dl+" WHERE doc_id=id)";I.executeSql(H,[],function(J){var K="CREATE UNIQUE INDEX IF NOT EXISTS 'doc-max-seq-idx' ON "+b3+" (max_seq)";J.executeSql(K,[],E)})})}function y(F,E){F.executeSql('SELECT HEX("a") AS hex',[],function(I,G){var H=G.rows.item(0).hex;D=2===H.length?"UTF-8":"UTF-16",E()})}function C(){for(;z.length>0;){var E=z.pop();E(null,m)}}function x(M,I){if(0===I){var F="CREATE TABLE IF NOT EXISTS "+ej+" (dbid, db_version INTEGER)",O="CREATE TABLE IF NOT EXISTS "+dB+" (digest UNIQUE, escaped TINYINT(1), body BLOB)",L="CREATE TABLE IF NOT EXISTS "+f4+" (digest, seq INTEGER)",J="CREATE TABLE IF NOT EXISTS "+b3+" (id unique, json, winningseq, max_seq INTEGER UNIQUE)",K="CREATE TABLE IF NOT EXISTS "+dl+" (seq INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, json, deleted TINYINT(1), doc_id, rev)",E="CREATE TABLE IF NOT EXISTS "+bX+" (id UNIQUE, rev, json)";M.executeSql(O),M.executeSql(E),M.executeSql(L,[],function(){M.executeSql(f2),M.executeSql(jL)}),M.executeSql(J,[],function(){M.executeSql(dL),M.executeSql(K,[],function(){M.executeSql(c7),M.executeSql(cW),M.executeSql(F,[],function(){var R="INSERT INTO "+ej+" (db_version, dbid) VALUES (?,?)";m=dT();var Q=[az,m];M.executeSql(R,Q,function(){C()})})})})}else{var G=function(){var Q=az>I;Q&&M.executeSql("UPDATE "+ej+" SET db_version = "+az);var R="SELECT dbid FROM "+ej;M.executeSql(R,[],function(T,S){m=S.rows.item(0).dbid,C()})},P=[o,p,j,u,w,A,G],N=I,H=function(Q){P[N-1](Q,H),N++};H(M)}}function h(){i.transaction(function(E){y(E,function(){v(E)})},cg(n),s)}function v(F){var E="SELECT sql FROM sqlite_master WHERE tbl_name = "+ej;F.executeSql(E,[],function(H,G){G.rows.length?/db_version/.test(G.rows.item(0).sql)?H.executeSql("SELECT db_version FROM "+ej,[],function(I,K){var J=K.rows.item(0).db_version;x(I,J)}):H.executeSql("ALTER TABLE "+ej+" ADD COLUMN db_version INTEGER",[],function(){x(H,1)}):x(H,0)})}function k(F,E){if(-1!==B._docCount){return E(B._docCount)}var G=cN("COUNT("+b3+".id) AS 'num'",[b3,dl],b5,dl+".deleted=0");F.executeSql(G,[],function(I,H){B._docCount=H.rows.item(0).num,E(B._docCount)})}var D,B=this,m=null,g=bY(r),z=[];B._docCount=-1,B._name=r.name;var l=jO.extend({},r,{version:el,description:r.name,size:g}),q=fF(l);if(q.error){return cg(n)(q.error)}var i=q.db;"function"!=typeof i.readTransaction&&(i.readTransaction=i.transaction),h(),B.type=function(){return"websql"},B._id=eB(function(E){E(null,m)}),B._info=function(E){i.readTransaction(function(F){k(F,function(H){var G="SELECT MAX(seq) AS seq FROM "+dl;F.executeSql(G,[],function(K,I){var J=I.rows.item(0).seq||0;E(null,{doc_count:H,update_seq:J,sqlite_plugin:i._sqlitePlugin,websql_encoding:D})})})},cg(E))},B._bulkDocs=function(E,G,F){bf(r,E,G,B,i,j6,F)},B._get=function(N,E,L){function I(){L(G,{doc:J,metadata:M,ctx:K})}var J,M,G,K=E.ctx;if(!K){return i.readTransaction(function(O){B._get(N,jO.extend({ctx:O},E),L)})}var H,F;E.rev?(H=cN(a9,[b3,dl],b3+".id="+dl+".doc_id",[dl+".doc_id=?",dl+".rev=?"]),F=[N,E.rev]):(H=cN(a9,[b3,dl],b5,b3+".id=?"),F=[N]),K.executeSql(H,F,function(O,P){if(!P.rows.length){return G=dg(e6,"missing"),I()}var Q=P.rows.item(0);return M=ay(Q.metadata),Q.deleted&&!E.rev?(G=dg(e6,"deleted"),I()):(J=cH(Q.data,M.id,Q.rev),void I())})},B._allDocs=function(E,O){var P,I=[],K="startkey" in E?E.startkey:!1,F="endkey" in E?E.endkey:!1,M="key" in E?E.key:!1,Q="descending" in E?E.descending:!1,N="limit" in E?E.limit:-1,L="skip" in E?E.skip:0,H=E.inclusive_end!==!1,R=[],J=[];if(M!==!1){J.push(b3+".id = ?"),R.push(M)}else{if(K!==!1||F!==!1){if(K!==!1&&(J.push(b3+".id "+(Q?"<=":">=")+" ?"),R.push(K)),F!==!1){var G=Q?">":"<";H&&(G+="="),J.push(b3+".id "+G+" ?"),R.push(F)}M!==!1&&(J.push(b3+".id = ?"),R.push(M))}}"ok"!==E.deleted&&J.push(dl+".deleted = 0"),i.readTransaction(function(S){k(S,function(U){if(P=U,0!==N){var T=cN(a9,[b3,dl],b5,J,b3+".id "+(Q?"DESC":"ASC"));T+=" LIMIT "+N+" OFFSET "+L,S.executeSql(T,R,function(Y,an){for(var ai=0,V=an.rows.length;V>ai;ai++){var X=an.rows.item(ai),Z=ay(X.metadata),ar=Z.id,W=cH(X.data,ar,X.rev),ao=W._rev,ae={id:ar,key:ar,value:{rev:ao}};if(E.include_docs&&(ae.doc=W,ae.doc._rev=ao,E.conflicts&&(ae.doc._conflicts=eY(Z)),bh(ae.doc,E,B,Y)),X.deleted){if("ok"!==E.deleted){continue}ae.value.deleted=!0,ae.doc=null}I.push(ae)}})}})},cg(O),function(){O(null,{total_rows:P,offset:E.skip,rows:I})})},B._changes=function(E){function F(){var S=b3+".json AS metadata, "+b3+".max_seq AS maxSeq, "+dl+".json AS winningDoc, "+dl+".rev AS winningRev ",T=b3+" JOIN "+dl,R=b3+".id="+dl+".doc_id AND "+b3+".winningseq="+dl+".seq",Q=["maxSeq > ?"],O=[E.since];E.doc_ids&&(Q.push(b3+".id IN "+dM(E.doc_ids.length)),O=O.concat(E.doc_ids));var U="maxSeq "+(J?"DESC":"ASC"),N=cN(S,T,R,Q,U),M=e0(E);E.view||E.filter||(N+=" LIMIT "+G);var P=E.since||0;i.readTransaction(function(V){V.executeSql(N,O,function(ai,an){function Z(a0){return function(){E.onChange(a0)}}for(var at=0,ar=an.rows.length;ar>at;at++){var ao=an.rows.item(at),W=ay(ao.metadata);P=ao.maxSeq;var ae=cH(ao.winningDoc,W.id,ao.winningRev),Y=E.processChange(ae,W,E);Y.seq=ao.maxSeq;var X=M(Y);if("object"==typeof X){return E.complete(X)}if(X&&(I++,L&&K.push(Y),E.attachments&&E.include_docs?bh(ae,E,B,ai,Z(Y)):Z(Y)()),I===G){break}}})},cg(E.complete),function(){E.continuous||E.complete(null,{results:K,last_seq:P})})}if(E=bS(E),E.continuous){var H=B._name+":"+dT();return j6.addListener(B._name,H,B,E),j6.notify(B._name),{cancel:function(){j6.removeListener(B._name,H)}}}var J=E.descending;E.since=E.since&&!J?E.since:0;var G="limit" in E?E.limit:-1;0===G&&(G=1);var L;L="return_docs" in E?E.return_docs:"returnDocs" in E?E.returnDocs:!0;var K=[],I=0;F()},B._close=function(E){E()},B._getAttachment=function(N,E,L,I,J){var M,G=I.ctx,K=L.digest,H=L.content_type,F="SELECT escaped, CASE WHEN escaped = 1 THEN body ELSE HEX(body) END AS body FROM "+dB+" WHERE digest=?";G.executeSql(F,[K],function(P,O){var Q=O.rows.item(0),R=Q.escaped?cX(Q.body):cw(Q.body,D);M=I.binary?aR(R,H):e7(R),J(null,M)})},B._getRevisionTree=function(F,E){i.readTransaction(function(H){var G="SELECT json AS metadata FROM "+b3+" WHERE id = ?";H.executeSql(G,[F],function(I,J){if(J.rows.length){var K=ay(J.rows.item(0).metadata);E(null,K.rev_tree)}else{E(dg(e6))}})})},B._doCompaction=function(F,E,G){return E.length?void i.transaction(function(H){var I="SELECT json AS metadata FROM "+b3+" WHERE id = ?";H.executeSql(I,[F],function(L,J){var K=ay(J.rows.item(0).metadata);dv(K.rev_tree,function(O,Q,N,P,S){var R=Q+"-"+N;-1!==E.indexOf(R)&&(S.status="missing")});var M="UPDATE "+b3+" SET json = ? WHERE id = ?";L.executeSql(M,[fK(K),F])}),am(E,F,H)},cg(G),function(){G()}):G()},B._getLocal=function(F,E){i.readTransaction(function(H){var G="SELECT json, rev FROM "+bX+" WHERE id=?";H.executeSql(G,[F],function(L,J){if(J.rows.length){var K=J.rows.item(0),I=cH(K.json,F,K.rev);E(null,I)}else{E(dg(e6))}})})},B._putLocal=function(I,M,G){function E(N){var P,O;H?(P="UPDATE "+bX+" SET rev=?, json=? WHERE id=? AND rev=?",O=[F,L,K,H]):(P="INSERT INTO "+bX+" (id, rev, json) VALUES (?,?,?)",O=[K,F,L]),N.executeSql(P,O,function(R,Q){Q.rowsAffected?(J={ok:!0,id:K,rev:F},M.ctx&&G(null,J)):G(dg(cL))},function(){return G(dg(cL)),!1})}"function"==typeof M&&(G=M,M={}),delete I._revisions;var F,H=I._rev,K=I._id;F=H?I._rev="0-"+(parseInt(H.split("-")[1],10)+1):I._rev="0-1";var J,L=aq(I);M.ctx?E(M.ctx):i.transaction(E,cg(G),function(){J&&G(null,J)})},B._removeLocal=function(H,F,E){function G(L){var K="DELETE FROM "+bX+" WHERE id=? AND rev=?",J=[H._id,H._rev];L.executeSql(K,J,function(N,M){return M.rowsAffected?(I={ok:!0,id:H._id,rev:"0-0"},void (F.ctx&&E(null,I))):E(dg(e6))})}"function"==typeof F&&(E=F,F={});var I;F.ctx?G(F.ctx):i.transaction(G,cg(E),function(){I&&E(null,I)})},B._destroy=function(F,E){j6.removeAllListeners(B._name),i.transaction(function(H){var G=[b3,dl,dB,ej,bX,f4];G.forEach(function(I){H.executeSql("DROP TABLE IF EXISTS "+I,[])})},cg(E),function(){ds()&&(delete window.localStorage["_pouch__websqldb_"+B._name],delete window.localStorage[B._name]),E(null,{ok:!0})})}}function kk(){try{return openDatabase("_pouch_validate_websql",1,"",1),!0}catch(g){return !1}}function dA(){if("undefined"==typeof indexedDB||null===indexedDB||!/iP(hone|od|ad)/.test(navigator.userAgent)){return !0}var g=ds(),i="_pouch__websqldb_valid_"+navigator.userAgent;if(g&&localStorage[i]){return"1"===localStorage[i]}var h=kk();return g&&(localStorage[i]=h?"1":"0"),h}function eS(){return"undefined"!=typeof SQLitePlugin?!0:"undefined"==typeof openDatabase?!1:dA()}function bI(g){return function(i,l,j,k){if("undefined"!=typeof sqlitePlugin){var h=jO.extend({},g,{name:i,version:l,description:j,size:k});return sqlitePlugin.openDatabase(h)}return openDatabase(i,l,j,k)}}function f8(i,g){var j=bI(i),h=jO.extend({websql:j},i);eI.call(this,h,g)}function eF(g){g.adapter("websql",f8,!0)}function bP(){for(var i={},g=new aZ(function(k,l){i.resolve=k,i.reject=l}),j=new Array(arguments.length),h=0;h<j.length;h++){j[h]=arguments[h]}return i.promise=g,aZ.resolve().then(function(){return fetch.apply(null,j)}).then(function(k){i.resolve(k)})["catch"](function(k){i.reject(k)}),i}function cq(l,j){var g,k,m,i=new Headers,h={method:l.method,credentials:"include",headers:i};return l.json&&(i.set("Accept","application/json"),i.set("Content-Type",l.headers["Content-Type"]||"application/json")),l.body&&l.body instanceof Blob?cZ(l.body,function(n){h.body=n}):l.body&&l.processData&&"string"!=typeof l.body?h.body=JSON.stringify(l.body):"body" in l?h.body=l.body:h.body=null,Object.keys(l.headers).forEach(function(n){l.headers.hasOwnProperty(n)&&i.set(n,l.headers[n])}),g=bP(l.url,h),l.timeout>0&&(k=setTimeout(function(){g.reject(new Error("Load timeout for resource: "+l.url))},l.timeout)),g.promise.then(function(n){return m={statusCode:n.status},l.timeout>0&&clearTimeout(k),m.statusCode>=200&&m.statusCode<300?l.binary?n.blob():n.text():n.json()}).then(function(n){m.statusCode>=200&&m.statusCode<300?j(null,m,n):j(n,m)})["catch"](function(n){j(n,m)}),{abort:g.reject}}function cV(g,i){var l,j,m=!1,n=function(){l.abort()},h=function(){m=!0,l.abort()};l=g.xhr?new g.xhr:new XMLHttpRequest;try{l.open(g.method,g.url)}catch(k){i(k,{statusCode:413})}l.withCredentials="withCredentials" in g?g.withCredentials:!0,"GET"===g.method?delete g.headers["Content-Type"]:g.json&&(g.headers.Accept="application/json",g.headers["Content-Type"]=g.headers["Content-Type"]||"application/json",g.body&&g.processData&&"string"!=typeof g.body&&(g.body=JSON.stringify(g.body))),g.binary&&(l.responseType="arraybuffer"),"body" in g||(g.body=null);for(var o in g.headers){g.headers.hasOwnProperty(o)&&l.setRequestHeader(o,g.headers[o])}return g.timeout>0&&(j=setTimeout(h,g.timeout),l.onprogress=function(){clearTimeout(j),4!==l.readyState&&(j=setTimeout(h,g.timeout))},"undefined"!=typeof l.upload&&(l.upload.onprogress=l.onprogress)),l.onreadystatechange=function(){if(4===l.readyState){var s={statusCode:l.status};if(l.status>=200&&l.status<300){var q;q=g.binary?bJ([l.response||""],{type:l.getResponseHeader("Content-Type")}):l.responseText,i(null,s,q)}else{var p={};if(m){p=new Error("ETIMEDOUT"),s.statusCode=400}else{try{p=JSON.parse(l.response)}catch(r){}}i(p,s)}}},g.body&&g.body instanceof Blob?cZ(g.body,function(p){l.send(p)}):l.send(g.body),{abort:n}}function aI(){try{return new XMLHttpRequest,!0}catch(g){return !1}}function cF(h,g){return j5||h.xhr?cV(h,g):cq(h,g)}function ki(){return""}function jQ(i,g){function k(l,o,m){if(!i.binary&&i.json&&"string"==typeof l){try{l=JSON.parse(l)}catch(n){return m(n)}}Array.isArray(l)&&(l=l.map(function(p){return p.error||p.missing?eA(p):p})),i.binary&&b7(l,o),m(null,l,o)}function h(q,o){var m,p;if(q.code&&q.status){var l=new Error(q.message||q.code);return l.status=q.status,o(l)}if(q.message&&"ETIMEDOUT"===q.message){return o(q)}try{m=JSON.parse(q.responseText),p=eA(m)}catch(n){p=eA(q)}o(p)}i=bS(i);var j={method:"GET",headers:{},json:!0,processData:!0,timeout:10000,cache:!1};return i=jO.extend(j,i),i.json&&(i.binary||(i.headers.Accept="application/json"),i.headers["Content-Type"]=i.headers["Content-Type"]||"application/json"),i.binary&&(i.encoding=null,i.json=!1),i.processData||(i.json=!1),cF(i,function(p,m,r){if(p){return p.status=m?m.statusCode:400,h(p,g)}var n,l=m.headers&&m.headers["content-type"],q=r||ki();if(!i.binary&&(i.json||!i.processData)&&"object"!=typeof q&&(/json/.test(l)||/^[\s]*\{/.test(q)&&/\}[\s]*$/.test(q))){try{q=JSON.parse(q.toString())}catch(o){}}m.statusCode>=200&&m.statusCode<300?k(q,m,g):(n=eA(q),n.status=m.statusCode,g(n))})}function eV(i,k){var g=navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",m=-1!==g.indexOf("safari")&&-1===g.indexOf("chrome"),o=-1!==g.indexOf("msie"),h=-1!==g.indexOf("edge"),j=m||(o||h)&&"GET"===i.method,l="cache" in i?i.cache:!0,p=/^blob:/.test(i.url);if(!p&&(j||!l)){var n=-1!==i.url.indexOf("?");i.url+=(n?"&":"?")+"_nonce="+Date.now()}return jQ(i,k)}function dD(h){var g=h.doc&&h.doc._attachments;g&&Object.keys(g).forEach(function(i){var j=g[i];j.data=bq(j.data,j.content_type)})}function c4(g){return/^_design/.test(g)?"_design/"+encodeURIComponent(g.slice(8)):/^_local/.test(g)?"_local/"+encodeURIComponent(g.slice(7)):encodeURIComponent(g)}function cd(g){return g._attachments&&Object.keys(g._attachments)?aZ.all(Object.keys(g._attachments).map(function(h){var i=g._attachments[h];return i.data&&"string"!=typeof i.data?new aZ(function(j){aa(i.data,j)}).then(function(j){i.data=j}):void 0})):aZ.resolve()}function cj(g){var i=bB(g);(i.user||i.password)&&(i.auth={username:i.user,password:i.password});var h=i.path.replace(/(^\/|\/$)/g,"").split("/");return i.db=h.pop(),-1===i.db.indexOf("%")&&(i.db=encodeURIComponent(i.db)),i.path=h.join("/"),i}function cb(h,g){return aj(h,h.db+"/"+g)}function aj(g,i){var h=g.path?"/":"";return g.protocol+"://"+g.host+(g.port?":"+g.port:"")+"/"+g.path+h+i}function bK(g){return"?"+Object.keys(g).map(function(h){return h+"="+encodeURIComponent(g[h])}).join("&")}function jF(v,j){function k(A,y,B){var z=A.ajax||{},x=jO.extend(bS(g),z,y);return bN(x.method+" "+x.url),p._ajax(x,B)}function w(x,y){return new aZ(function(z,A){k(x,y,function(C,B){return C?A(C):void z(B)})})}function u(x,y){return dZ(x,c8(function(z){o().then(function(){return y.apply(this,z)})["catch"](function(A){var B=z.pop();B(A)})}))}function o(){if(v.skipSetup||v.skip_setup){return aZ.resolve()}if(h){return h}var x={method:"GET",url:s};return h=w({},x)["catch"](function(y){return y&&y.status&&404===y.status?(dY(404,"PouchDB is just detecting if the remote exists."),w({},{method:"PUT",url:s})):aZ.reject(y)})["catch"](function(y){return y&&y.status&&412===y.status?!0:aZ.reject(y)}),h["catch"](function(){h=null}),h}function l(x){return x.split("/").map(encodeURIComponent).join("/")}var p=this,r=cj;v.getHost&&(r=v.getHost);var i=r(v.name,v),s=cb(i,"");v=bS(v);var g=v.ajax||{};if(p.getUrl=function(){return s},p.getHeaders=function(){return g.headers||{}},v.auth||i.auth){var n=v.auth||i.auth,m=n.username+":"+n.password,q=e7(unescape(encodeURIComponent(m)));g.headers=g.headers||{},g.headers.Authorization="Basic "+q}p._ajax=eV;var h;setTimeout(function(){j(null,p)}),p.type=function(){return"http"},p.id=u("id",function(x){k({},{method:"GET",url:aj(i,"")},function(y,A){var z=A&&A.uuid?A.uuid+i.db:cb(i,"");x(null,z)})}),p.request=u("request",function(x,y){x.url=cb(i,x.url),k({},x,y)}),p.compact=u("compact",function(x,y){"function"==typeof x&&(y=x,x={}),x=bS(x),k(x,{url:cb(i,"_compact"),method:"POST"},function(){function z(){p.info(function(A,B){B&&!B.compact_running?y(null,{ok:!0}):setTimeout(z,x.interval||200)})}z()})}),p.bulkGet=dZ("bulkGet",function(y,C){function A(F){var E={};y.revs&&(E.revs=!0),y.attachments&&(E.attachments=!0),k({},{url:cb(i,"_bulk_get"+bK(E)),method:"POST",body:{docs:y.docs}},F)}function B(){function H(L){return function(M,N){K[L]=N.results,++I===F&&C(null,{results:j1(K)})}}for(var E=bj,F=Math.ceil(y.docs.length/E),I=0,K=new Array(F),J=0;F>J;J++){var G=e4(y,["revs","attachments"]);G.ajax=g,G.docs=y.docs.slice(J*E,Math.min(y.docs.length,(J+1)*E)),eK(x,G,H(J))}}var x=this,z=aj(i,""),D=bT[z];"boolean"!=typeof D?A(function(E,F){if(E){var G=Math.floor(E.status/100);4===G||5===G?(bT[z]=!1,dY(E.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),B()):C(E)}else{bT[z]=!0,C(null,F)}}):D?A(C):B()}),p._info=function(x){o().then(function(){k({},{method:"GET",url:cb(i,"")},function(y,z){return y?x(y):(z.host=cb(i,""),void x(null,z))})})["catch"](x)},p.get=u("get",function(C,y,A){function B(F){var G=F._attachments,E=G&&Object.keys(G);return G&&E.length?aZ.all(E.map(function(H){var I=G[H],J=c4(F._id)+"/"+l(H)+"?rev="+F._rev;return w(y,{method:"GET",url:cb(i,J),binary:!0}).then(function(K){return y.binary?K:new aZ(function(L){aa(K,L)})}).then(function(K){delete I.stub,delete I.length,I.data=K})})):void 0}function x(E){return Array.isArray(E)?aZ.all(E.map(function(F){return F.ok?B(F.ok):void 0})):B(E)}"function"==typeof y&&(A=y,y={}),y=bS(y);var D={};y.revs&&(D.revs=!0),y.revs_info&&(D.revs_info=!0),y.open_revs&&("all"!==y.open_revs&&(y.open_revs=JSON.stringify(y.open_revs)),D.open_revs=y.open_revs),y.rev&&(D.rev=y.rev),y.conflicts&&(D.conflicts=y.conflicts),C=c4(C);var z={method:"GET",url:cb(i,C+bK(D))};w(y,z).then(function(E){return aZ.resolve().then(function(){return y.attachments?x(E):void 0}).then(function(){A(null,E)})})["catch"](A)}),p.remove=u("remove",function(z,x,B,y){var A;"string"==typeof x?(A={_id:z,_rev:x},"function"==typeof B&&(y=B,B={})):(A=z,"function"==typeof x?(y=x,B={}):(y=B,B=x));var C=A._rev||B.rev;k(B,{method:"DELETE",url:cb(i,c4(A._id))+"?rev="+C},y)}),p.getAttachment=u("getAttachment",function(z,B,x,A){"function"==typeof x&&(A=x,x={});var C=x.rev?"?rev="+x.rev:"",y=cb(i,c4(z))+"/"+l(B)+C;k(x,{method:"GET",url:y,binary:!0},A)}),p.removeAttachment=u("removeAttachment",function(A,y,z,B){var x=cb(i,c4(A)+"/"+l(y))+"?rev="+z;k({},{method:"DELETE",url:x},B)}),p.putAttachment=u("putAttachment",function(E,x,z,A,C,y){"function"==typeof C&&(y=C,C=A,A=z,z=null);var H=c4(E)+"/"+l(x),G=cb(i,H);if(z&&(G+="?rev="+z),"string"==typeof A){var B;try{B=f1(A)}catch(F){return y(dg(ba,"Attachment is not a valid base64 string"))}A=B?aR(B,C):""}var D={headers:{"Content-Type":C},method:"PUT",url:G,processData:!1,body:A,timeout:g.timeout||60000};k({},D,y)}),p._bulkDocs=function(y,z,x){y.new_edits=z.new_edits,o().then(function(){return aZ.all(y.docs.map(cd))}).then(function(){k(z,{method:"POST",url:cb(i,"_bulk_docs"),body:y},function(B,A){return B?x(B):(A.forEach(function(C){C.ok=!0}),void x(null,A))})})["catch"](x)},p.allDocs=u("allDocs",function(C,y){"function"==typeof C&&(y=C,C={}),C=bS(C);var A,B={},x="GET";C.conflicts&&(B.conflicts=!0),C.descending&&(B.descending=!0),C.include_docs&&(B.include_docs=!0),C.attachments&&(B.attachments=!0),C.key&&(B.key=JSON.stringify(C.key)),C.start_key&&(C.startkey=C.start_key),C.startkey&&(B.startkey=JSON.stringify(C.startkey)),C.end_key&&(C.endkey=C.end_key),C.endkey&&(B.endkey=JSON.stringify(C.endkey)),"undefined"!=typeof C.inclusive_end&&(B.inclusive_end=!!C.inclusive_end),"undefined"!=typeof C.limit&&(B.limit=C.limit),"undefined"!=typeof C.skip&&(B.skip=C.skip);var z=bK(B);if("undefined"!=typeof C.keys){var D="keys="+encodeURIComponent(JSON.stringify(C.keys));D.length+z.length+1<=b0?z+="&"+D:(x="POST",A={keys:C.keys})}w(C,{method:x,url:cb(i,"_all_docs"+z),body:A}).then(function(E){C.include_docs&&C.attachments&&C.binary&&E.rows.forEach(dD),y(null,E)})["catch"](y)}),p._changes=function(L){var D="batch_size" in L?L.batch_size:ag;L=bS(L),L.timeout="timeout" in L?L.timeout:"timeout" in g?g.timeout:30000;var B,J=L.timeout?{timeout:L.timeout-5000}:{},A="undefined"!=typeof L.limit?L.limit:!1;B="return_docs" in L?L.return_docs:"returnDocs" in L?L.returnDocs:!0;var H=A;if(L.style&&(J.style=L.style),(L.include_docs||L.filter&&"function"==typeof L.filter)&&(J.include_docs=!0),L.attachments&&(J.attachments=!0),L.continuous&&(J.feed="longpoll"),L.conflicts&&(J.conflicts=!0),L.descending&&(J.descending=!0),"heartbeat" in L?L.heartbeat&&(J.heartbeat=L.heartbeat):J.heartbeat=10000,L.filter&&"string"==typeof L.filter&&(J.filter=L.filter),L.view&&"string"==typeof L.view&&(J.filter="_view",J.view=L.view),L.query_params&&"object"==typeof L.query_params){for(var F in L.query_params){L.query_params.hasOwnProperty(F)&&(J[F]=L.query_params[F])}}var y,x="GET";if(L.doc_ids){J.filter="_doc_ids";var I=JSON.stringify(L.doc_ids);I.length<b0?J.doc_ids=I:(x="POST",y={doc_ids:L.doc_ids})}var G,E,C=function(N,M){if(!L.aborted){J.since=N,"object"==typeof J.since&&(J.since=JSON.stringify(J.since)),L.descending?A&&(J.limit=H):J.limit=!A||H>D?D:H;var O={method:x,url:cb(i,"_changes"+bK(J)),timeout:L.timeout,body:y};E=N,L.aborted||o().then(function(){G=k(L,O,M)})["catch"](M)}},z={results:[]},K=function(O,Q){if(!L.aborted){var P=0;if(Q&&Q.results){P=Q.results.length,z.last_seq=Q.last_seq;var M={};M.query=L.query_params,Q.results=Q.results.filter(function(R){H--;var S=e0(L)(R);return S&&(L.include_docs&&L.attachments&&L.binary&&dD(R),B&&z.results.push(R),L.onChange(R)),S})}else{if(O){return L.aborted=!0,void L.complete(O)}}Q&&Q.last_seq&&(E=Q.last_seq);var N=A&&0>=H||Q&&D>P||L.descending;(!L.continuous||A&&0>=H)&&N?L.complete(null,z):setTimeout(function(){C(E,K)},0)}};return C(L.since||0,K),{cancel:function(){L.aborted=!0,G&&G.abort()}}},p.revsDiff=u("revsDiff",function(y,z,x){"function"==typeof z&&(x=z,z={}),k(z,{method:"POST",url:cb(i,"_revs_diff"),body:y},x)}),p._close=function(x){x()},p._destroy=function(x,y){k(x,{url:cb(i,""),method:"DELETE"},function(z,A){return z&&z.status&&404!==z.status?y(z):void y(null,A)})}}function kg(g){g.adapter("http",jF,!1),g.adapter("https",jF,!1)}function ep(){this.promise=new aZ(function(g){g()})}function eb(g){var h=g.db,m=g.viewName,i=g.map,k=g.reduce,l=g.temporary,j=i.toString()+(k&&k.toString())+"undefined";if(!l&&h._cachedViews){var n=h._cachedViews[j];if(n){return aZ.resolve(n)}}return h.info().then(function(p){function o(u){u.views=u.views||{};var r=m;-1===r.indexOf("/")&&(r=m+"/"+m);var s=u.views[r]=u.views[r]||{};if(!s[q]){return s[q]=!0,u}}var q=p.db_name+"-mrview-"+(l?"temp":eG(j));return aQ(h,"_local/mrviews",o).then(function(){return h.registerDependentDatabase(q).then(function(s){var u=s.db;u.auto_compaction=!0;var r={name:q,db:u,sourceDB:h,adapter:h.adapter,mapFun:i,reduceFun:k};return r.db.get("_local/lastSeq")["catch"](function(v){if(404!==v.status){throw v}}).then(function(v){return r.seq=v?v.seq:0,l||(h._cachedViews=h._cachedViews||{},h._cachedViews[j]=r,r.db.once("destroyed",function(){delete h._cachedViews[j]})),r})})})})}function f6(j,h,l,i,k,g){return by("return ("+j.replace(/;\s*$/,"")+");",{emit:h,sum:l,log:i,isArray:k,toJSON:g})}function jU(g){return -1===g.indexOf("/")?[g,g]:g.split("/")}function ad(g){return 1===g.length&&/^1-/.test(g[0].rev)}function fI(g,i){try{g.emit("error",i)}catch(h){bc("error","The user's map/reduce function threw an uncaught error.\nYou can debug this error by doing:\nmyDatabase.on('error', function (err) { debugger; });\nPlease double-check your map/reduce function."),bc("error",i)}}function eD(i,g,j){try{return{output:g.apply(null,j)}}catch(h){return fI(i,h),{error:h}}}function eL(g,i){var h=dU.collate(g.key,i.key);return 0!==h?h:dU.collate(g.value,i.value)}function e2(g,i,h){return h=h||0,"number"==typeof i?g.slice(h,i+h):h>0?g.slice(h):g}function aY(g){var i=g.value,h=i&&"object"==typeof i&&i._id||g.id;return h}function ec(g){g.rows.forEach(function(i){var h=i.doc&&i.doc._attachments;h&&Object.keys(h).forEach(function(j){var k=h[j];h[j].data=bq(k.data,k.content_type)})})}function c6(g){return function(h){return g.include_docs&&g.attachments&&g.binary&&ec(h),h}}function ah(h){var g="builtin "+h+" function requires map values to be numbers or number arrays";return new dN(g)}function dI(g){for(var h=0,m=0,i=g.length;i>m;m++){var k=g[m];if("number"!=typeof k){if(!Array.isArray(k)){throw ah("_sum")}h="number"==typeof h?[h]:h;for(var l=0,j=k.length;j>l;l++){var n=k[l];if("number"!=typeof n){throw ah("_sum")}"undefined"==typeof h[l]?h.push(n):h[l]+=n}}else{"number"==typeof h?h+=k:h[0]+=k}}return h}function cl(i,g,k,h){var j=g[i];"undefined"!=typeof j&&(h&&(j=encodeURIComponent(JSON.stringify(j))),k.push(i+"="+j))}function bO(h){if("undefined"!=typeof h){var g=Number(h);return isNaN(g)||g!==parseInt(h,10)?h:g}}function dh(g){return g.group_level=bO(g.group_level),g.limit=bO(g.limit),g.skip=bO(g.skip),g}function ef(g){if(g){if("number"!=typeof g){return new kj('Invalid value for integer: "'+g+'"')}if(0>g){return new kj('Invalid value for positive integer: "'+g+'"')}}}function eq(i,g){var j=i.descending?"endkey":"startkey",h=i.descending?"startkey":"endkey";if("undefined"!=typeof i[j]&&"undefined"!=typeof i[h]&&dU.collate(i[j],i[h])>0){throw new kj("No rows can match your key range, reverse your start_key and end_key or set {descending : true}")}if(g.reduce&&i.reduce!==!1){if(i.include_docs){throw new kj("{include_docs:true} is invalid for reduce")}if(i.keys&&i.keys.length>1&&!i.group&&!i.group_level){throw new kj("Multi-key fetches for reduce views must use {group: true}")}}["group_level","limit","skip"].forEach(function(k){var l=ef(i[k]);if(l){throw l}})}function em(g,i,l){var j,m=[],n="GET";if(cl("reduce",l,m),cl("include_docs",l,m),cl("attachments",l,m),cl("limit",l,m),cl("descending",l,m),cl("group",l,m),cl("group_level",l,m),cl("skip",l,m),cl("stale",l,m),cl("conflicts",l,m),cl("startkey",l,m,!0),cl("start_key",l,m,!0),cl("endkey",l,m,!0),cl("end_key",l,m,!0),cl("inclusive_end",l,m),cl("key",l,m,!0),m=m.join("&"),m=""===m?"":"?"+m,"undefined"!=typeof l.keys){var h=2000,k="keys="+encodeURIComponent(JSON.stringify(l.keys));k.length+m.length+1<=h?m+=("?"===m[0]?"&":"?")+k:(n="POST","string"==typeof i?j={keys:l.keys}:i.keys=l.keys)}if("string"==typeof i){var o=jU(i);return g.request({method:n,url:"_design/"+o[0]+"/_view/"+o[1]+m,body:j}).then(c6(l))}return j=j||{},Object.keys(i).forEach(function(p){Array.isArray(i[p])?j[p]=i[p]:j[p]=i[p].toString()}),g.request({method:"POST",url:"_temp_view"+m,body:j}).then(c6(l))}function dR(g,i,h){return new aZ(function(j,k){g._query(i,h,function(m,l){return m?k(m):void j(l)})})}function dq(g){return new aZ(function(h,i){g._viewCleanup(function(k,j){return k?i(k):void h(j)})})}function kb(g){return function(h){if(404===h.status){return g}throw h}}function j3(p,j,n){function l(){return ad(q)?aZ.resolve(i):j.db.get(g)["catch"](kb(i))}function k(r){return r.keys.length?j.db.allDocs({keys:r.keys,include_docs:!0}):aZ.resolve({rows:[]})}function m(r,v){for(var z=[],x={},y=0,A=v.rows.length;A>y;y++){var s=v.rows[y],w=s.doc;if(w&&(z.push(w),x[w._id]=!0,w._deleted=!o[w._id],!w._deleted)){var u=o[w._id];"value" in u&&(w.value=u.value)}}var B=Object.keys(o);return B.forEach(function(C){if(!x[C]){var E={_id:C},D=o[C];"value" in D&&(E.value=D.value),z.push(E)}}),r.keys=jK(B.concat(r.keys)),z.push(r),z}var g="_local/doc_"+p,i={_id:g,keys:[]},h=n[p],o=h.indexableKeysToKeyValues,q=h.changes;return l().then(function(r){return k(r).then(function(s){return m(r,s)})})}function j9(i,g,j){var h="_local/lastSeq";return i.db.get(h)["catch"](kb({_id:h,seq:0})).then(function(k){var l=Object.keys(g);return aZ.all(l.map(function(m){return j3(m,i,g)})).then(function(m){var n=j1(m);return k.seq=j,n.push(k),i.db.bulkDocs({docs:n})})})}function km(g){var i="string"==typeof g?g:g.name,h=d7[i];return h||(h=d7[i]=new ep),h}function d0(g){return ke(km(g),function(){return jI(g)})()}function jI(g){function i(p,r){var q={id:m._id,key:dU.normalizeKey(p)};"undefined"!=typeof r&&null!==r&&(q.value=dU.normalizeKey(r)),j.push(q)}function l(q,p){return function(){return j9(g,q,p)}}var j,m,n;if("function"==typeof g.mapFun&&2===g.mapFun.length){var h=g.mapFun;n=function(p){return h(p,i)}}else{n=f6(g.mapFun.toString(),i,dI,bZ,Array.isArray,JSON.parse)}var k=g.seq||0,o=new ep;return new aZ(function(p,s){function r(){o.finish().then(function(){g.seq=k,p()})}function q(){function u(v){s(v)}g.sourceDB.changes({conflicts:!0,include_docs:!0,style:"all_docs",since:k,limit:aN}).on("complete",function(x){var F=x.results;if(!F.length){return r()}for(var z={},C=0,A=F.length;A>C;C++){var v=F[C];if("_"!==v.doc._id[0]){j=[],m=v.doc,m._deleted||eD(g.sourceDB,n,[m]),j.sort(eL);for(var H,D={},G=0,y=j.length;y>G;G++){var B=j[G],E=[B.key,B.id];0===dU.collate(B.key,H)&&E.push(G);var w=dU.toIndexableString(E);D[w]=B,H=B.key}z[v.doc._id]={indexableKeysToKeyValues:D,changes:v.changes}}k=v.seq}return o.add(l(z,k)),F.length<aN?r():q()}).on("error",u)}q()})}function f9(p,j,n){0===n.group_level&&delete n.group_level;var l,k=n.group||n.group_level;l=bD[p.reduceFun]?bD[p.reduceFun]:f6(p.reduceFun.toString(),null,dI,bZ,Array.isArray,JSON.parse);var m=[],g=isNaN(n.group_level)?Number.POSITIVE_INFINITY:n.group_level;j.forEach(function(r){var u=m[m.length-1],s=k?r.key:null;return k&&Array.isArray(s)&&(s=s.slice(0,g)),u&&0===dU.collate(u.groupKey,s)?(u.keys.push([r.key,r.id]),void u.values.push(r.value)):void m.push({keys:[[r.key,r.id]],values:[r.value],groupKey:s})}),j=[];for(var i=0,h=m.length;h>i;i++){var o=m[i],q=eD(p.sourceDB,l,[o.keys,o.values,!1]);if(q.error&&q.error instanceof dN){throw q.error}j.push({value:q.error?null:q.output,key:o.groupKey})}return{rows:e2(j,n.limit,n.skip)}}function fQ(h,g){return ke(km(h),function(){return cc(h,g)})()}function cc(r,n){function q(u){return u.include_docs=!0,r.db.allDocs(u).then(function(v){return p=v.total_rows,v.rows.map(function(x){if("value" in x.doc&&"object"==typeof x.doc.value&&null!==x.doc.value){var z=Object.keys(x.doc.value).sort(),y=["id","key","value"];if(!(y>z||z>y)){return x.doc.value}}var w=dU.parseIndexableString(x.doc._id);return{key:w[0],id:w[1],value:"value" in x.doc?x.doc.value:null}})})}function o(w){var v;if(v=g?f9(r,w,n):{total_rows:p,offset:l,rows:w},n.include_docs){var u=jK(w.map(aY));return r.sourceDB.allDocs({keys:u,include_docs:!0,conflicts:n.conflicts,attachments:n.attachments,binary:n.binary}).then(function(x){var y={};return x.rows.forEach(function(z){z.doc&&(y["$"+z.id]=z.doc)}),w.forEach(function(A){var B=aY(A),z=y["$"+B];z&&(A.doc=z)}),v})}return v}var p,g=r.reduceFun&&n.reduce!==!1,l=n.skip||0;if("undefined"==typeof n.keys||n.keys.length||(n.limit=0,delete n.keys),"undefined"!=typeof n.keys){var h=n.keys,m=h.map(function(v){var u={startkey:dU.toIndexableString([v]),endkey:dU.toIndexableString([v,{}])};return q(u)});return aZ.all(m).then(j1).then(o)}var k={descending:n.descending};if(n.start_key&&(n.startkey=n.start_key),n.end_key&&(n.endkey=n.end_key),"undefined"!=typeof n.startkey&&(k.startkey=n.descending?dU.toIndexableString([n.startkey,{}]):dU.toIndexableString([n.startkey])),"undefined"!=typeof n.endkey){var i=n.inclusive_end!==!1;n.descending&&(i=!i),k.endkey=dU.toIndexableString(i?[n.endkey,{}]:[n.endkey])}if("undefined"!=typeof n.key){var s=dU.toIndexableString([n.key]),j=dU.toIndexableString([n.key,{}]);k.descending?(k.endkey=s,k.startkey=j):(k.startkey=s,k.endkey=j)}return g||("number"==typeof n.limit&&(k.limit=n.limit),k.skip=l),q(k).then(o)}function bQ(g){return g.request({method:"POST",url:"_view_cleanup"})}function eT(g){return g.get("_local/mrviews").then(function(h){var j={};Object.keys(h.views).forEach(function(m){var k=jU(m),l="_design/"+k[0],n=k[1];j[l]=j[l]||{},j[l][n]=!0});var i={keys:Object.keys(j),include_docs:!0};return g.allDocs(i).then(function(m){var n={};m.rows.forEach(function(p){var o=p.key.substring(8);Object.keys(j[p.key]).forEach(function(u){var r=o+"/"+u;h.views[r]||(r=u);var q=Object.keys(h.views[r]),s=p.doc&&p.doc.views&&p.doc.views[u];q.forEach(function(v){n[v]=n[v]||s})})});var l=Object.keys(n).filter(function(o){return !n[o]}),k=l.map(function(o){return ke(km(o),function(){return new g.constructor(o,g.__opts).destroy()})()});return aZ.all(k).then(function(){return{ok:!0}})})},kb({ok:!0}))}function eZ(k,n,g){if("http"===k.type()){return em(k,n,g)}if("function"==typeof k._query){return dR(k,n,g)}if("string"!=typeof n){eq(g,n);var m={db:k,viewName:"temp_view/temp_view",map:n.map,reduce:n.reduce,temporary:!0};return ak.add(function(){return eb(m).then(function(o){function p(){return o.db.destroy()}return fA(d0(o).then(function(){return fQ(o,g)}),p)})}),ak.finish()}var h=n,j=jU(h),i=j[0],l=j[1];return k.get("_design/"+i).then(function(o){var p=o.views&&o.views[l];if(!p||"string"!=typeof p.map){throw new fR("ddoc "+i+" has no view named "+l)}eq(g,p);var q={db:k,viewName:h,map:p.map,reduce:p.reduce};return eb(q).then(function(r){return"ok"===g.stale||"update_after"===g.stale?("update_after"===g.stale&&dH.nextTick(function(){d0(r)}),fQ(r,g)):d0(r).then(function(){return fQ(r,g)})})})}function kj(h){this.status=400,this.name="query_parse_error",this.message=h,this.error=!0;try{Error.captureStackTrace(this,kj)}catch(g){}}function fR(h){this.status=404,this.name="not_found",this.message=h,this.error=!0;try{Error.captureStackTrace(this,fR)}catch(g){}}function dN(h){this.status=500,this.name="invalid_value",this.message=h,this.error=!0;try{Error.captureStackTrace(this,dN)}catch(g){}}function jH(g){return/^1-/.test(g)}function dc(g,i,h){return !g._attachments||!g._attachments[h]||g._attachments[h].digest!==i._attachments[h].digest}function cx(g,i){var h=Object.keys(i._attachments);return aZ.all(h.map(function(j){return g.getAttachment(i._id,j,{rev:i._rev})}))}function b9(i,g,k){var h="http"===g.type()&&"http"!==i.type(),j=Object.keys(k._attachments);return h?i.get(k._id).then(function(l){return aZ.all(j.map(function(m){return dc(l,k,m)?g.getAttachment(k._id,m):i.getAttachment(l._id,m)}))})["catch"](function(l){if(404!==l.status){throw l}return cx(g,k)}):cx(g,k)}function cJ(h){var g=[];return Object.keys(h).forEach(function(j){var i=h[j].missing;i.forEach(function(k){g.push({id:j,rev:k})})}),{docs:g,revs:!0}}function kl(n,i,m,k){function l(){var r=cJ(m);if(r.docs.length){return n.bulkGet(r).then(function(s){if(k.cancelled){throw new Error("cancelled")}return aZ.all(s.results.map(function(u){return aZ.all(u.docs.map(function(w){var v=w.ok;return w.error&&(q=!1),v&&v._attachments?b9(i,n,v).then(function(x){var y=Object.keys(v._attachments);return x.forEach(function(z,B){var A=v._attachments[y[B]];delete A.stub,delete A.length,A.data=z}),v}):v}))})).then(function(u){o=o.concat(j1(u).filter(Boolean))})})}}function p(r){return r._attachments&&Object.keys(r._attachments).length>0}function g(r){return n.allDocs({keys:r,include_docs:!0}).then(function(s){if(k.cancelled){throw new Error("cancelled")}s.rows.forEach(function(u){!u.deleted&&u.doc&&jH(u.value.rev)&&!p(u.doc)&&(o.push(u.doc),delete m[u.id])})})}function j(){var r=Object.keys(m).filter(function(s){var u=m[s].missing;return 1===u.length&&jH(u[0])});return r.length>0?g(r):void 0}function h(){return{ok:q,docs:o}}m=bS(m);var o=[],q=!0;return aZ.resolve().then(j).then(l).then(h)}function c0(i,g,k,h,j){return i.get(g)["catch"](function(l){if(404===l.status){return"http"===i.type()&&dY(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:h,_id:g,history:[],replicator:dK,version:jS}}throw l}).then(function(l){return j.cancelled?void 0:(l.history=(l.history||[]).filter(function(m){return m.session_id!==h}),l.history.unshift({last_seq:k,session_id:h}),l.history=l.history.slice(0,bp),l.version=jS,l.replicator=dK,l.session_id=h,l.last_seq=k,i.put(l)["catch"](function(m){if(409===m.status){return c0(i,g,k,h,j)}throw m}))})}function fL(i,g,j,h){this.src=i,this.target=g,this.id=j,this.returnValue=h}function aC(h,g){return h.session_id===g.session_id?{last_seq:h.last_seq,history:h.history}:da(h.history,g.history)}function da(g,h){var m=g[0],i=g.slice(1),k=h[0],l=h.slice(1);if(!m||0===h.length){return{last_seq:bx,history:[]}}var j=m.session_id;if(jP(j,h)){return{last_seq:m.last_seq,history:g}}var n=k.session_id;return jP(n,i)?{last_seq:k.last_seq,history:l}:da(i,l)}function jP(i,g){var j=g[0],h=g.slice(1);return i&&0!==g.length?i===j.session_id?!0:jP(i,h):!1}function eN(g){return"number"==typeof g.status&&4===Math.floor(g.status/100)}function bv(i,g,j,h){return i.retry===!1?(g.emit("error",j),void g.removeAllListeners()):("function"!=typeof i.back_off_function&&(i.back_off_function=aU),g.emit("requestError",j),"active"!==g.state&&"pending"!==g.state||(g.emit("paused",j),g.state="stopped",g.once("active",function(){i.current_back_off=d9})),i.current_back_off=i.current_back_off||d9,i.current_back_off=i.back_off_function(i.current_back_off),void setTimeout(h,i.current_back_off))}function j2(g){return Object.keys(g).sort(dU.collate).reduce(function(h,i){return h[i]=g[i],h},{})}function ac(l,j,g){var k=g.doc_ids?g.doc_ids.sort(dU.collate):"",m=g.filter?g.filter.toString():"",i="",h="";return g.filter&&g.query_params&&(i=JSON.stringify(j2(g.query_params))),g.filter&&"_view"===g.filter&&(h=g.view.toString()),aZ.all([l.id(),j.id()]).then(function(n){var o=n[0]+n[1]+m+h+i+k;return new aZ(function(p){db(o,p)})}).then(function(n){return n=n.replace(/\//g,".").replace(/\+/g,"_"),"_local/"+n})}function cC(N,k,x,r,w){function D(){return J?aZ.resolve():ac(N,k,x).then(function(T){i=T,J=new fL(N,k,i,r)})}function q(){if(o=[],0!==L.docs.length){var T=L.docs;return k.bulkDocs({docs:T,new_edits:!1}).then(function(U){if(r.cancelled){throw v(),new Error("cancelled")}var W=[],Y={};U.forEach(function(Z){Z.error&&(w.doc_write_failures++,W.push(Z),Y[Z.id]=Z)}),M=M.concat(W),w.docs_written+=L.docs.length-W.length;var X=W.filter(function(Z){return"unauthorized"!==Z.name&&"forbidden"!==Z.name});if(T.forEach(function(Z){var ae=Y[Z._id];ae?r.emit("denied",bS(ae)):o.push(Z)}),X.length>0){var V=new Error("bulkDocs error");throw V.other_errors=W,E("target.bulkDocs failed to write docs",V),new Error("bulkWrite partial failure")}},function(U){throw w.doc_write_failures+=T.length,U})}}function l(){if(L.error){throw new Error("There was a problem getting docs.")}w.last_seq=C=L.seq;var T=bS(w);return o.length&&(T.docs=o,r.emit("change",T)),G=!0,J.writeCheckpoint(L.seq,O).then(function(){if(G=!1,r.cancelled){throw v(),new Error("cancelled")}L=void 0,z()})["catch"](j)}function Q(){var T={};return L.changes.forEach(function(U){"_user/"!==U.id&&(T[U.id]=U.changes.map(function(V){return V.rev}))}),k.revsDiff(T).then(function(U){if(r.cancelled){throw v(),new Error("cancelled")}L.diffs=U})}function I(){return kl(N,k,L.diffs,r).then(function(T){L.error=!T.ok,T.docs.forEach(function(U){delete L.diffs[U._id],w.docs_read++,L.docs.push(U)})})}function A(){if(!r.cancelled&&!L){if(0===B.length){return void g(!0)}L=B.shift(),Q().then(I).then(q).then(l).then(A)["catch"](function(T){E("batch processing terminated with error",T)})}}function g(T){return 0===u.changes.length?void (0!==B.length||L||((n&&y.live||p)&&(r.state="pending",r.emit("paused")),p&&v())):void ((T||p||u.changes.length>=R)&&(B.push(u),u={seq:0,changes:[],docs:[]},"pending"!==r.state&&"stopped"!==r.state||(r.state="active",r.emit("active")),A()))}function E(U,T){H||(T.message||(T.message=U),w.ok=!1,w.status="aborting",w.errors.push(T),M=M.concat(T),B=[],u={seq:0,changes:[],docs:[]},v())}function v(){if(!(H||r.cancelled&&(w.status="cancelled",G))){w.status=w.status||"complete",w.end_time=new Date,w.last_seq=C,H=!0;var U=M.filter(function(V){return"unauthorized"!==V.name&&"forbidden"!==V.name});if(U.length>0){var T=M.pop();M.length>0&&(T.other_errors=M),T.result=w,bv(x,r,T,function(){cC(N,k,x,r)})}else{w.errors=M,r.emit("complete",w),r.removeAllListeners()}}}function P(U){if(r.cancelled){return v()}var T=e0(x)(U);T&&(u.seq=U.seq,u.changes.push(U),g(0===B.length&&y.live))}function S(U){if(m=!1,r.cancelled){return v()}if(U.results.length>0){y.since=U.last_seq,z(),g(!0)}else{var T=function(){n?(y.live=!0,z()):p=!0,g(!0)};L||0!==U.results.length?T():(G=!0,J.writeCheckpoint(U.last_seq,O).then(function(){G=!1,w.last_seq=C=U.last_seq,T()})["catch"](j))}}function s(T){return m=!1,r.cancelled?v():void E("changes rejected",T)}function z(){function T(){V.cancel()}function U(){r.removeListener("cancel",T)}if(!m&&!p&&B.length<h){m=!0,r._changes&&(r.removeListener("cancel",r._abortChanges),r._changes.cancel()),r.once("cancel",T);var V=N.changes(y).on("change",P);V.then(U,U),V.then(S)["catch"](s),x.retry&&(r._changes=V,r._abortChanges=T)}}function F(){D().then(function(){return r.cancelled?void v():J.getCheckpoint().then(function(T){C=T,y={since:C,limit:R,batch_size:R,style:"all_docs",doc_ids:K,return_docs:!0},x.filter&&("string"!=typeof x.filter?y.include_docs=!0:y.filter=x.filter),"heartbeat" in x&&(y.heartbeat=x.heartbeat),"timeout" in x&&(y.timeout=x.timeout),x.query_params&&(y.query_params=x.query_params),x.view&&(y.view=x.view),z()})})["catch"](function(T){E("getCheckpoint rejected with ",T)})}function j(T){throw G=!1,E("writeCheckpoint completed with error",T),T}var L,i,J,B=[],u={seq:0,changes:[],docs:[]},G=!1,p=!1,H=!1,C=0,n=x.continuous||x.live||!1,R=x.batch_size||100,h=x.batches_limit||10,m=!1,K=x.doc_ids,M=[],o=[],O=dT();w=w||{ok:!0,start_time:new Date,docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var y={};return r.ready(N,k),r.cancelled?void v():(r._addedListeners||(r.once("cancel",v),"function"==typeof x.complete&&(r.once("error",x.complete),r.once("complete",function(T){x.complete(null,T)})),r._addedListeners=!0),void ("undefined"==typeof x.since?F():D().then(function(){return G=!0,J.writeCheckpoint(x.since,O)}).then(function(){return G=!1,r.cancelled?void v():(C=x.since,void F())})["catch"](j)))}function aX(){bz.EventEmitter.call(this),this.cancelled=!1,this.state="pending";var h=this,g=new aZ(function(i,j){h.once("complete",i),h.once("error",j)});h.then=function(i,j){return g.then(i,j)},h["catch"]=function(i){return g["catch"](i)},h["catch"](function(){})}function jX(g,i){var h=i.PouchConstructor;return"string"==typeof g?new h(g,i):g}function bb(l,j,g,k){if("function"==typeof g&&(k=g,g={}),"undefined"==typeof g&&(g={}),g.doc_ids&&!Array.isArray(g.doc_ids)){throw dg(d4,"`doc_ids` filter parameter is not a list.")}g.complete=k,g=bS(g),g.continuous=g.continuous||g.live,g.retry="retry" in g?g.retry:!1,g.PouchConstructor=g.PouchConstructor||this;var m=new aX(g),i=jX(l,g),h=jX(j,g);return cC(i,h,g,m),m}function dm(i,g,j,h){return"function"==typeof j&&(h=j,j={}),"undefined"==typeof j&&(j={}),j=bS(j),j.PouchConstructor=j.PouchConstructor||this,i=jX(i,j),g=jX(g,j),new dS(i,g,j,h)}function dS(x,p,q,k){function o(z){v.emit("change",{direction:"pull",change:z})}function u(z){v.emit("change",{direction:"push",change:z})}function n(z){v.emit("denied",{direction:"push",doc:z})}function r(z){v.emit("denied",{direction:"pull",doc:z})}function i(){v.pushPaused=!0,v.pullPaused&&v.emit("paused")}function l(){v.pullPaused=!0,v.pushPaused&&v.emit("paused")}function w(){v.pushPaused=!1,v.pullPaused&&v.emit("active",{direction:"push"})}function s(){v.pullPaused=!1,v.pushPaused&&v.emit("active",{direction:"pull"})}function y(z){return function(D,C){var A="change"===D&&(C===o||C===u),F="denied"===D&&(C===r||C===n),B="paused"===D&&(C===l||C===i),E="active"===D&&(C===s||C===w);(A||F||B||E)&&(D in g||(g[D]={}),g[D][z]=!0,2===Object.keys(g[D]).length&&v.removeAllListeners(D))}}var v=this;this.canceled=!1;var m=q.push?jO.extend({},q,q.push):q,h=q.pull?jO.extend({},q,q.pull):q;this.push=bb(x,p,m),this.pull=bb(p,x,h),this.pushPaused=!0,this.pullPaused=!0;var g={};q.live&&(this.push.on("complete",v.pull.cancel.bind(v.pull)),this.pull.on("complete",v.push.cancel.bind(v.push))),this.on("newListener",function(z){"change"===z?(v.pull.on("change",o),v.push.on("change",u)):"denied"===z?(v.pull.on("denied",r),v.push.on("denied",n)):"active"===z?(v.pull.on("active",s),v.push.on("active",w)):"paused"===z&&(v.pull.on("paused",l),v.push.on("paused",i))}),this.on("removeListener",function(z){"change"===z?(v.pull.removeListener("change",o),v.push.removeListener("change",u)):"denied"===z?(v.pull.removeListener("denied",r),v.push.removeListener("denied",n)):"active"===z?(v.pull.removeListener("active",s),v.push.removeListener("active",w)):"paused"===z&&(v.pull.removeListener("paused",l),v.push.removeListener("paused",i))}),this.pull.on("removeListener",y("pull")),this.push.on("removeListener",y("push"));var j=aZ.all([this.push,this.pull]).then(function(A){var z={push:A[0],pull:A[1]};return v.emit("complete",z),k&&k(null,z),v.removeAllListeners(),z},function(z){if(v.cancel(),k?k(z):v.emit("error",z),v.removeAllListeners(),k){throw z}});this.then=function(A,z){return j.then(A,z)},this["catch"]=function(z){return j["catch"](z)}}function d5(g){g.replicate=bb,g.sync=dm}var dw,jO=f(9),cS=ed(f(5)),bm=ed(f(8)),b2=ed(f(10)),b6=f(14),c8=ed(f(4)),bz=f(1),by=ed(f(15)),bw=ed(f(16)),au=ed(f(17)),dU=f(12),aZ="function"==typeof Promise?Promise:b2,kh=Function.prototype.toString,cY=kh.call(Object),dJ=cS("pouchdb:api"),e9=6;if(c1()){dw=!1}else{try{localStorage.setItem("_pouch_check_localstorage",1),dw=!!localStorage.getItem("_pouch_check_localstorage")}catch(cz){dw=!1}}bm(eE,bz.EventEmitter),eE.prototype.addListener=function(l,j,g,k){function m(){function n(){h=!1}if(i._listeners[j]){if(h){return void (h="waiting")}h=!0;var o=e4(k,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary"]);g.changes(o).on("change",function(p){p.seq>k.since&&!k.cancelled&&(k.since=p.seq,k.onChange(p))}).on("complete",function(){"waiting"===h&&setTimeout(function(){m()},0),h=!1}).on("error",n)}}if(!this._listeners[j]){var i=this,h=!1;this._listeners[j]=m,this.on(l,m)}},eE.prototype.removeListener=function(h,g){g in this._listeners&&bz.EventEmitter.prototype.removeListener.call(this,h,this._listeners[g])},eE.prototype.notifyLocalWindows=function(g){c1()?chrome.storage.local.set({dbName:g}):ds()&&(localStorage[g]="a"===localStorage[g]?"b":"a")},eE.prototype.notify=function(g){this.emit(g),this.notifyLocalWindows(g)},bm(cO,Error),cO.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};var aK=new cO({status:401,error:"unauthorized",reason:"Name or password is incorrect."}),ca=new cO({status:400,error:"bad_request",reason:"Missing JSON list of 'docs'"}),e6=new cO({status:404,error:"not_found",reason:"missing"}),cL=new cO({status:409,error:"conflict",reason:"Document update conflict"}),cf=new cO({status:400,error:"invalid_id",reason:"_id field must contain a string"}),eW=new cO({status:412,error:"missing_id",reason:"_id is required for puts"}),ka=new cO({status:400,error:"bad_request",reason:"Only reserved document ids may start with underscore."}),bF=new cO({status:412,error:"precondition_failed",reason:"Database not open"}),dO=new cO({status:500,error:"unknown_error",reason:"Database encountered an unknown error"}),ba=new cO({status:500,error:"badarg",reason:"Some query argument is invalid"}),bW=new cO({status:400,error:"invalid_request",reason:"Request was invalid"}),jR=new cO({status:400,error:"query_parse_error",reason:"Some query parameter is invalid"}),fO=new cO({status:500,error:"doc_validation",reason:"Bad special document member"}),d4=new cO({status:400,error:"bad_request",reason:"Something wrong with the request"}),dP=new cO({status:400,error:"bad_request",reason:"Document must be a JSON object"}),d6=new cO({status:404,error:"not_found",reason:"Database not found"}),cs=new cO({status:500,error:"indexed_db_went_bad",reason:"unknown"}),dF=new cO({status:500,error:"web_sql_went_bad",reason:"unknown"}),d1=new cO({status:500,error:"levelDB_went_went_bad",reason:"unknown"}),eP=new cO({status:403,error:"forbidden",reason:"Forbidden by design doc validate_doc_update function"}),c2=new cO({status:400,error:"bad_request",reason:"Invalid rev format"}),fG=new cO({status:412,error:"file_exists",reason:"The database could not be created, the file already exists."}),bA=new cO({status:412,error:"missing_stub"}),eQ=new cO({status:413,error:"invalid_url",reason:"Provided URL is invalid"}),cu=[aK,ca,e6,cL,cf,eW,ka,bF,dO,ba,bW,jR,fO,d4,dP,d6,dF,d1,eP,c2,fG,bA,cs,eQ],dV=function(i,g,j){var h=cu.filter(function(k){return k[i]===g});return j&&h.filter(function(k){return k.message===j})[0]||h[0]},kd=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],eH="queryKey",fC=/(?:^|&)([^&=]*)=?([^&]*)/g,f7=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,df="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");bm(du,bz.EventEmitter),du.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")},du.prototype.doChanges=function(i){var g=this,k=i.complete;if(i=bS(i),"live" in i&&!("continuous" in i)&&(i.continuous=i.live),i.processChange=eM,"latest"===i.since&&(i.since="now"),i.since||(i.since=0),"now"===i.since){return void this.db.info().then(function(l){return g.isCancelled?void k(null,{status:"cancelled"}):(i.since=l.update_seq,void g.doChanges(i))},k)}if(i.continuous&&"now"!==i.since&&this.db.info().then(function(l){g.startSeq=l.update_seq},function(l){if("idbNull"!==l.id){throw l}}),i.view&&!i.filter&&(i.filter="_view"),i.filter&&"string"==typeof i.filter&&("_view"===i.filter?i.view=dX(i.view):i.filter=dX(i.filter),"http"!==this.db.type()&&!i.doc_ids)){return this.filterChanges(i)}"descending" in i||(i.descending=!1),i.limit=0===i.limit?1:i.limit,i.complete=k;var h=this.db._changes(i);if(h&&"function"==typeof h.cancel){var j=g.cancel;g.cancel=c8(function(l){h.cancel(),j.apply(this,l)})}},du.prototype.filterChanges=function(j){var h=this,l=j.complete;if("_view"===j.filter){if(!j.view||"string"!=typeof j.view){var i=dg(d4,"`view` filter parameter not found or invalid.");return l(i)}var k=dE(j.view);this.db.get("_design/"+k[0],function(o,n){if(h.isCancelled){return l(null,{status:"cancelled"})}if(o){return l(eA(o))}var m=n&&n.views&&n.views[k[1]]&&n.views[k[1]].map;return m?(j.filter=fH(m),void h.doChanges(j)):l(dg(e6,n.views?"missing json key: "+k[1]:"missing json key: views"))})}else{var g=dE(j.filter);if(!g){return h.doChanges(j)}this.db.get("_design/"+g[0],function(m,n){if(h.isCancelled){return l(null,{status:"cancelled"})}if(m){return l(eA(m))}var o=n&&n.filters&&n.filters[g[1]];return o?(j.filter=bU(o),void h.doChanges(j)):l(dg(e6,n&&n.filters?"missing json key: "+g[1]:"missing json key: filters"))})}},bm(aL,bz.EventEmitter),aL.prototype.post=dZ("post",function(g,i,h){return"function"==typeof i&&(h=i,i={}),"object"!=typeof g||Array.isArray(g)?h(dg(dP)):void this.bulkDocs({docs:[g]},i,e8(h))}),aL.prototype.put=dZ("put",c8(function(g){function i(){h||(bc("warn","db.put(doc, id, rev) has been deprecated and will be removed in a future release, please use db.put({_id: id, _rev: rev}) instead"),h=!0)}var l,j,m,n,h=!1,k=g.shift(),o="_id" in k;if("object"!=typeof k||Array.isArray(k)){return(n=g.pop())(dg(dP))}for(;;){if(l=g.shift(),j=typeof l,"string"!==j||o?"string"!==j||!o||"_rev" in k?"object"===j?m=l:"function"===j&&(n=l):(i(),k._rev=l):(i(),k._id=l,o=!0),!g.length){break}}return m=m||{},cU(k._id),f0(k._id)&&"function"==typeof this._putLocal?k._deleted?this._removeLocal(k,n):this._putLocal(k,n):void this.bulkDocs({docs:[k]},m,e8(n))})),aL.prototype.putAttachment=dZ("putAttachment",function(l,j,g,k,m){function i(o){var n="_rev" in o?parseInt(o._rev,10):0;return o._attachments=o._attachments||{},o._attachments[j]={content_type:m,data:k,revpos:++n},h.put(o)}var h=this;return"function"==typeof m&&(m=k,k=g,g=null),"undefined"==typeof m&&(m=k,k=g,g=null),h.get(l).then(function(n){if(n._rev!==g){throw dg(cL)}return i(n)},function(n){if(n.reason===e6.message){return i({_id:l})}throw n})}),aL.prototype.removeAttachment=dZ("removeAttachment",function(i,g,k,h){var j=this;j.get(i,function(m,l){return m?void h(m):l._rev!==k?void h(dg(cL)):l._attachments?(delete l._attachments[g],0===Object.keys(l._attachments).length&&delete l._attachments,void j.put(l,h)):h()})}),aL.prototype.remove=dZ("remove",function(j,h,l,i){var k;"string"==typeof h?(k={_id:j,_rev:h},"function"==typeof l&&(i=l,l={})):(k=j,"function"==typeof h?(i=h,l={}):(i=l,l=h)),l=l||{},l.was_delete=!0;var g={_id:k._id,_rev:k._rev||l.rev};return g._deleted=!0,f0(g._id)&&"function"==typeof this._removeLocal?this._removeLocal(k,i):void this.bulkDocs({docs:[g]},l,e8(i))}),aL.prototype.revsDiff=dZ("revsDiff",function(g,h,m){function i(o,p){n.has(o)||n.set(o,{missing:[]}),n.get(o).missing.push(p)}function k(q,p){var o=g[q].slice(0);dv(p,function(x,w,v,r,s){var y=w+"-"+v,u=o.indexOf(y);-1!==u&&(o.splice(u,1),"available"!==s.status&&i(q,y))}),o.forEach(function(r){i(q,r)})}"function"==typeof h&&(m=h,h={});var l=Object.keys(g);if(!l.length){return m(null,{})}var j=0,n=new b6.Map;l.map(function(o){this._getRevisionTree(o,function(q,p){if(q&&404===q.status&&"missing"===q.message){n.set(o,{missing:g[o]})}else{if(q){return m(q)}k(o,p)}if(++j===l.length){var r={};return n.forEach(function(u,s){r[s]=u}),m(null,r)}})},this)}),aL.prototype.bulkGet=dZ("bulkGet",function(h,g){eK(this,h,g)}),aL.prototype.compactDocument=dZ("compactDocument",function(i,g,j){var h=this;this._getRevisionTree(i,function(o,m){if(o){return j(o)}var k=bC(m),n=[],l=[];Object.keys(k).forEach(function(p){k[p]>g&&n.push(p)}),dv(m,function(q,v,s,p,r){var u=v+"-"+s;"available"===r.status&&-1!==n.indexOf(u)&&l.push(u)}),h._doCompaction(i,l,j)})}),aL.prototype.compact=dZ("compact",function(g,i){"function"==typeof g&&(i=g,g={});var h=this;g=g||{},h._compactionQueue=h._compactionQueue||[],h._compactionQueue.push({opts:g,callback:i}),1===h._compactionQueue.length&&aT(h)}),aL.prototype._compact=function(l,j){function g(n){h.push(m.compactDocument(n.id,0))}function k(o){var n=o.last_seq;aZ.all(h).then(function(){return aQ(m,"_local/compaction",function(p){return !p.last_seq||p.last_seq<n?(p.last_seq=n,p):!1})}).then(function(){j(null,{ok:!0})})["catch"](j)}var m=this,i={return_docs:!1,last_seq:l.last_seq||0},h=[];m.changes(i).on("change",g).on("complete",k).on("error",j)},aL.prototype.get=dZ("get",function(g,h,m){function i(){var o=[],p=k.length;return p?void k.forEach(function(q){l.get(g,{rev:q,revs:h.revs,attachments:h.attachments},function(s,r){s?o.push({missing:q}):o.push({ok:r}),p--,p||m(null,o)})}):m(null,o)}if("function"==typeof h&&(m=h,h={}),"string"!=typeof g){return m(dg(cf))}if(f0(g)&&"function"==typeof this._getLocal){return this._getLocal(g,m)}var k=[],l=this;if(!h.open_revs){return this._get(g,h,function(C,p){if(C){return m(C)}var v=p.doc,B=p.metadata,w=p.ctx;if(h.conflicts){var x=eY(B);x.length&&(v._conflicts=x)}if(aP(B,v._rev)&&(v._deleted=!0),h.revs||h.revs_info){var r=bi(B.rev_tree),A=jZ(r,function(D){return -1!==D.ids.map(function(E){return E.id}).indexOf(v._rev.split("-")[1])}),y=A.ids.map(function(D){return D.id}).indexOf(v._rev.split("-")[1])+1,u=A.ids.length-y;if(A.ids.splice(y,u),A.ids.reverse(),h.revs&&(v._revisions={start:A.pos+A.ids.length-1,ids:A.ids.map(function(D){return D.id})}),h.revs_info){var o=A.pos+A.ids.length;v._revs_info=A.ids.map(function(D){return o--,{rev:o+"-"+D.id,status:D.opts.status}})}}if(h.attachments&&v._attachments){var q=v._attachments,s=Object.keys(q).length;if(0===s){return m(null,v)}Object.keys(q).forEach(function(D){this._getAttachment(v._id,D,q[D],{rev:v._rev,binary:h.binary,ctx:w},function(F,G){var E=v._attachments[D];E.data=G,delete E.stub,delete E.length,--s||m(null,v)})},l)}else{if(v._attachments){for(var z in v._attachments){v._attachments.hasOwnProperty(z)&&(v._attachments[z].stub=!0)}}m(null,v)}})}if("all"===h.open_revs){this._getRevisionTree(g,function(o,p){return o?m(o):(k=aA(p).map(function(q){return q.rev}),void i())})}else{if(!Array.isArray(h.open_revs)){return m(dg(dO,"function_clause"))}k=h.open_revs;for(var j=0;j<k.length;j++){var n=k[j];if("string"!=typeof n||!/^\d+-/.test(n)){return m(dg(c2))}}i()}}),aL.prototype.getAttachment=dZ("getAttachment",function(i,g,k,h){var j=this;k instanceof Function&&(h=k,k={}),this._get(i,k,function(m,l){return m?h(m):l.doc._attachments&&l.doc._attachments[g]?(k.ctx=l.ctx,k.binary=!0,j._getAttachment(i,g,l.doc._attachments[g],k,h),void 0):h(dg(e6))})}),aL.prototype.allDocs=dZ("allDocs",function(g,i){if("function"==typeof g&&(i=g,g={}),g.skip="undefined"!=typeof g.skip?g.skip:0,g.start_key&&(g.startkey=g.start_key),g.end_key&&(g.endkey=g.end_key),"keys" in g){if(!Array.isArray(g.keys)){return i(new TypeError("options.keys must be an array"))}var h=["startkey","endkey","key"].filter(function(j){return j in g})[0];if(h){return void i(dg(jR,"Query parameter `"+h+"` is not compatible with multi-get"))}if("http"!==this.type()){return fP(this,g,i)}}return this._allDocs(g,i)}),aL.prototype.changes=function(h,g){return"function"==typeof h&&(g=h,h={}),new du(this,h,g)},aL.prototype.close=dZ("close",function(g){return this._closed=!0,this._close(g)}),aL.prototype.info=dZ("info",function(h){var g=this;this._info(function(j,i){return j?h(j):(i.db_name=i.db_name||g._db_name,i.auto_compaction=!(!g.auto_compaction||"http"===g.type()),i.adapter=g.type(),void h(null,i))})}),aL.prototype.id=dZ("id",function(g){return this._id(g)}),aL.prototype.type=function(){return"function"==typeof this._type?this._type():this.adapter},aL.prototype.bulkDocs=dZ("bulkDocs",function(i,g,k){if("function"==typeof g&&(k=g,g={}),g=g||{},Array.isArray(i)&&(i={docs:i}),!i||!i.docs||!Array.isArray(i.docs)){return k(dg(ca))}for(var h=0;h<i.docs.length;++h){if("object"!=typeof i.docs[h]||Array.isArray(i.docs[h])){return k(dg(dP))}}var j;return i.docs.forEach(function(l){l._attachments&&Object.keys(l._attachments).forEach(function(m){j=j||e(m)})}),j?k(dg(d4,j)):("new_edits" in g||("new_edits" in i?g.new_edits=i.new_edits:g.new_edits=!0),g.new_edits||"http"===this.type()||i.docs.sort(fN),ek(i.docs),this._bulkDocs(i,g,function(m,l){return m?k(m):(g.new_edits||(l=l.filter(function(n){return n.error})),void k(null,l))}))}),aL.prototype.registerDependentDatabase=dZ("registerDependentDatabase",function(i,g){function j(k){return k.dependentDbs=k.dependentDbs||{},k.dependentDbs[i]?!1:(k.dependentDbs[i]=!0,k)}var h=new this.constructor(i,this.__opts);aQ(this,"_local/_pouch_dependentDbs",j).then(function(){g(null,{db:h})})["catch"](g)}),aL.prototype.destroy=dZ("destroy",function(i,g){function k(){h._destroy(i,function(l,m){return l?g(l):(h._destroyed=!0,h.emit("destroyed"),void g(null,m||{ok:!0}))})}"function"==typeof i&&(g=i,i={});var h=this,j="use_prefix" in h?h.use_prefix:!0;return"http"===h.type()?k():void h.get("_local/_pouch_dependentDbs",function(p,n){if(p){return 404!==p.status?g(p):k()}var l=n.dependentDbs,o=h.constructor,m=Object.keys(l).map(function(r){var q=j?r.replace(new RegExp("^"+o.prefix),""):r;return new o(q,h.__opts).destroy()});aZ.all(m).then(k,g)})}),aD.prototype.execute=function(){var g;if(this.failed){for(;g=this.queue.shift();){g(this.failed)}}else{for(;g=this.queue.shift();){g()}}},aD.prototype.fail=function(g){this.failed=g,this.execute()},aD.prototype.ready=function(g){this.isReady=!0,this.db=g,this.execute()},aD.prototype.addTask=function(g){this.queue.push(g),this.failed&&this.execute()},bm(d2,aL),d2.debug=cS,d2.adapters={},d2.preferredAdapters=[],d2.prefix="_pouch_";var cM=new bz.EventEmitter;d8(d2),d2.parseAdapter=function(g,h){var m,i,k=g.match(/([a-z\-]*):\/\/(.*)/);if(k){if(g=/http(s?)/.test(k[1])?k[1]+"://"+k[2]:k[2],m=k[1],!d2.adapters[m].valid()){throw"Invalid adapter"}return{name:g,adapter:k[1]}}var l="idb" in d2.adapters&&"websql" in d2.adapters&&ds()&&localStorage["_pouch__websqldb_"+d2.prefix+g];if(h.adapter){i=h.adapter}else{if("undefined"!=typeof h&&h.db){i="leveldb"}else{for(var j=0;j<d2.preferredAdapters.length;++j){if(i=d2.preferredAdapters[j],i in d2.adapters){if(l&&"idb"===i){bc("log",'PouchDB is downgrading "'+g+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.');continue}break}}}}m=d2.adapters[i];var n=m&&"use_prefix" in m?m.use_prefix:!0;return{name:n?d2.prefix+g:g,adapter:i}},d2.adapter=function(g,i,h){i.valid()&&(d2.adapters[g]=i,h&&d2.preferredAdapters.push(g))},d2.plugin=function(g){return"function"==typeof g?g(d2):Object.keys(g).forEach(function(h){d2.prototype[h]=g[h]}),d2},d2.defaults=function(h){function g(k,i,j){return this instanceof g?("function"!=typeof i&&"undefined"!=typeof i||(j=i,i={}),k&&"object"==typeof k&&(i=k,k=void 0),i=jO.extend({},h,i),void d2.call(this,k,i,j)):new g(k,i,j)}return bm(g,d2),g.preferredAdapters=d2.preferredAdapters.slice(),Object.keys(d2).forEach(function(i){i in g||(g[i]=d2[i])}),g};var eJ="5.4.4";d2.version=eJ;var bE,ea=ch(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),cG=ch(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]),f1=function(g){return atob(g)},e7=function(g){return btoa(g)},ck=eC.setImmediate||eC.setTimeout,bG=32768,cD=5,dG="document-store",cA="by-sequence",kf="attach-store",bg="attach-seq-store",j4="meta-store",dW="local-store",aS="detect-blob-support",aW={running:!1,queue:[]},cB=new b6.Map,ab=new eE,dQ=new b6.Map;eg.valid=function(){var g="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform);return !g&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange};var az=7,b3=aM("document-store"),dl=aM("by-sequence"),dB=aM("attach-store"),bX=aM("local-store"),ej=aM("metadata-store"),f4=aM("attach-seq-store"),cQ=new b6.Map,j6=new eE,el=1,c7="CREATE INDEX IF NOT EXISTS 'by-seq-deleted-idx' ON "+dl+" (seq, deleted)",cW="CREATE UNIQUE INDEX IF NOT EXISTS 'by-seq-doc-id-rev' ON "+dl+" (doc_id, rev)",dL="CREATE INDEX IF NOT EXISTS 'doc-winningseq-idx' ON "+b3+" (winningseq)",f2="CREATE INDEX IF NOT EXISTS 'attach-seq-seq-idx' ON "+f4+" (seq)",jL="CREATE UNIQUE INDEX IF NOT EXISTS 'attach-seq-digest-idx' ON "+f4+" (digest, seq)",b5=dl+".seq = "+b3+".winningseq",a9=dl+".seq AS seq, "+dl+".deleted AS deleted, "+dl+".json AS data, "+dl+".rev AS rev, "+b3+".json AS metadata";f8.valid=eS,f8.use_prefix=!0;var j5=aI(),b7=function(){},ag=25,bj=50,bT={},b0=1800,bN=cS("pouchdb:http");jF.valid=function(){return !0},ep.prototype.add=function(g){return this.promise=this.promise["catch"](function(){}).then(function(){return g()}),this.promise},ep.prototype.finish=function(){return this.promise};var dx=function(h,g){return g&&h.then(function(i){dH.nextTick(function(){g(null,i)})},function(i){dH.nextTick(function(){g(i)})}),h},jT=function(g){return c8(function(h){var j=h.pop(),i=g.apply(this,h);return"function"==typeof j&&dx(i,j),i})},fA=function(h,g){return h.then(function(i){return g().then(function(){return i})},function(i){return g().then(function(){throw i})})},ke=function(h,g){return function(){var j=arguments,i=this;return h.add(function(){return g.apply(i,j)})}},jK=function(j){for(var h={},l=0,i=j.length;i>l;l++){h["$"+j[l]]=!0}var k=Object.keys(h),g=new Array(k.length);for(l=0,i=k.length;i>l;l++){g[l]=k[l].substring(1)}return g},d7={},ak=new ep,aN=50,bZ=bc.bind(null,"log"),bD={_sum:function(h,g){return dI(g)},_count:function(h,g){return g.length},_stats:function(g,i){function h(l){for(var j=0,n=0,k=l.length;k>n;n++){var m=l[n];j+=m*m}return j}return{sum:dI(i),min:Math.min.apply(null,i),max:Math.max.apply(null,i),count:i.length,sumsqr:h(i)}}},dp=jT(function(){var g=this;return"http"===g.type()?bQ(g):"function"==typeof g._viewCleanup?dq(g):eT(g)}),aF=function(i,g,k){"function"==typeof g&&(k=g,g={}),g=g?dh(g):{},"function"==typeof i&&(i={map:i});var h=this,j=aZ.resolve().then(function(){return eZ(h,i,g)});return dx(j,k),j};bm(kj,Error),bm(fR,Error),bm(dN,Error);var cT={query:aF,viewCleanup:dp},jS=1,dK="pouchdb",bp=5,bx=0;fL.prototype.writeCheckpoint=function(g,i){var h=this;return this.updateTarget(g,i).then(function(){return h.updateSource(g,i)})},fL.prototype.updateTarget=function(h,g){return c0(this.target,this.id,h,g,this.returnValue)},fL.prototype.updateSource=function(g,i){var h=this;return this.readOnlySource?aZ.resolve(!0):c0(this.src,this.id,g,i,this.returnValue)["catch"](function(j){if(eN(j)){return h.readOnlySource=!0,!0}throw j})};var ax={undefined:function(h,g){return 0===dU.collate(h.last_seq,g.last_seq)?g.last_seq:0},1:function(h,g){return aC(g,h).last_seq}};fL.prototype.getCheckpoint=function(){var g=this;return g.target.get(g.id).then(function(h){return g.readOnlySource?aZ.resolve(h.last_seq):g.src.get(g.id).then(function(i){if(h.version!==i.version){return bx}var j;return j=h.version?h.version.toString():"undefined",j in ax?ax[j](h,i):bx},function(i){if(404===i.status&&h.last_seq){return g.src.put({_id:g.id,last_seq:bx}).then(function(){return bx},function(j){return eN(j)?(g.readOnlySource=!0,h.last_seq):bx})}throw i})})["catch"](function(h){if(404!==h.status){throw h}return bx})};var d9=0;bm(aX,bz.EventEmitter),aX.prototype.cancel=function(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")},aX.prototype.ready=function(i,g){function k(){j.cancel()}function h(){i.removeListener("destroyed",k),g.removeListener("destroyed",k)}var j=this;j._readyCalled||(j._readyCalled=!0,i.once("destroyed",k),g.once("destroyed",k),j.once("complete",h))},bm(dS,bz.EventEmitter),dS.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())},d2.plugin(aH).plugin(eF).plugin(kg).plugin(cT).plugin(d5),d.exports=d2}).call(this,f(2),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{1:1,10:10,12:12,14:14,15:15,16:16,17:17,2:2,4:4,5:5,8:8,9:9}],4:[function(f,c,g){function d(e){return function(){var h=arguments.length;if(h){for(var j=[],i=-1;++i<h;){j[i]=arguments[i]}return e.call(this,j)}return e.call(this,[])}}c.exports=d},{}],5:[function(h,l,f){function c(){return"WebkitAppearance" in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function d(){var n=arguments,e=this.useColors;if(n[0]=(e?"%c":"")+this.namespace+(e?" %c":" ")+n[0]+(e?"%c ":" ")+"+"+f.humanize(this.diff),!e){return n}var p="color: "+this.color;n=[n[0],p,"color: inherit"].concat(Array.prototype.slice.call(n,1));var i=0,o=0;return n[0].replace(/%[a-z%]/g,function(q){"%%"!==q&&(i++,"%c"===q&&(o=i))}),n.splice(o,0,p),n}function g(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function j(e){try{null==e?f.storage.removeItem("debug"):f.storage.debug=e}catch(i){}}function m(){var e;try{e=f.storage.debug}catch(i){}return e}function k(){try{return window.localStorage}catch(e){}}f=l.exports=h(6),f.log=g,f.formatArgs=d,f.save=j,f.load=m,f.useColors=c,f.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:k(),f.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],f.formatters.j=function(e){return JSON.stringify(e)},f.enable(m())},{6:6}],6:[function(v,h,m){function k(){return m.colors[q++%m.colors.length]}function l(n){function f(){}function i(){var u=i,o=+new Date,x=o-(c||o);u.diff=x,u.prev=c,u.curr=o,c=o,null==u.useColors&&(u.useColors=m.useColors()),null==u.color&&u.useColors&&(u.color=k());var s=Array.prototype.slice.call(arguments);s[0]=m.coerce(s[0]),"string"!=typeof s[0]&&(s=["%o"].concat(s));var r=0;s[0]=s[0].replace(/%([a-z%])/g,function(D,B){if("%%"===D){return D}r++;var w=m.formatters[B];if("function"==typeof w){var C=s[r];D=w.call(u,C),s.splice(r,1),r--}return D}),"function"==typeof m.formatArgs&&(s=m.formatArgs.apply(u,s));var t=i.log||m.log||console.log.bind(console);t.apply(u,s)}f.enabled=!1,i.enabled=!0;var e=m.enabled(n)?i:f;return e.namespace=n,e}function p(i){m.save(i);for(var n=(i||"").split(/[\s,]+/),f=n.length,e=0;f>e;e++){n[e]&&(i=n[e].replace(/\*/g,".*?"),"-"===i[0]?m.skips.push(new RegExp("^"+i.substr(1)+"$")):m.names.push(new RegExp("^"+i+"$")))}}function d(){m.enable("")}function j(i){var e,f;for(e=0,f=m.skips.length;f>e;e++){if(m.skips[e].test(i)){return !1}}for(e=0,f=m.names.length;f>e;e++){if(m.names[e].test(i)){return !0}}return !1}function g(e){return e instanceof Error?e.stack||e.message:e}m=h.exports=l,m.coerce=g,m.disable=d,m.enable=p,m.enabled=j,m.humanize=v(11),m.names=[],m.skips=[],m.formatters={};var c,q=0},{11:11}],7:[function(f,d,c){(function(g){function t(){e=!0;for(var i,n,l=v.length;l;){for(n=v,v=[],i=-1;++i<l;){n[i]()}l=v.length}e=!1}function m(i){1!==v.push(i)||e||p()}var p,w=g.MutationObserver||g.WebKitMutationObserver;if(w){var h=0,k=new w(t),j=g.document.createTextNode("");k.observe(j,{characterData:!0}),p=function(){j.data=h=++h%2}}else{if(g.setImmediate||"undefined"==typeof g.MessageChannel){p="document" in g&&"onreadystatechange" in g.document.createElement("script")?function(){var i=g.document.createElement("script");i.onreadystatechange=function(){t(),i.onreadystatechange=null,i.parentNode.removeChild(i),i=null},g.document.documentElement.appendChild(i)}:function(){setTimeout(t,0)}}else{var q=new g.MessageChannel;q.port1.onmessage=t,p=function(){q.port2.postMessage(0)}}}var e,v=[];d.exports=m}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],8:[function(f,d,c){"function"==typeof Object.create?d.exports=function(g,e){g.super_=e,g.prototype=Object.create(e.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}})}:d.exports=function(g,e){g.super_=e;var h=function(){};h.prototype=e.prototype,g.prototype=new h,g.prototype.constructor=g}},{}],9:[function(f,d,c){(function(){var g=Array.prototype.slice,e=Array.prototype.forEach,h=function(i){if("object"!=typeof i){throw i+" is not an object"}var j=g.call(arguments,1);return e.call(j,function(k){if(k){for(var l in k){"object"==typeof k[l]&&i[l]?h.call(i,i[l],k[l]):i[l]=k[l]}}}),i};this.extend=h}).call(this)},{}],10:[function(w,k,B){function G(){}function j(e){if("function"!=typeof e){throw new TypeError("resolver must be a function")}this.state=F,this.queue=[],this.outcome=void 0,e!==G&&g(this,e)}function J(f,e,h){this.promise=f,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof h&&(this.onRejected=h,this.callRejected=this.otherCallRejected)}function H(f,e,h){x(function(){var i;try{i=e(h)}catch(l){return d.reject(f,l)}i===f?d.reject(f,new TypeError("Cannot resolve promise with itself")):d.resolve(f,i)})}function z(f){var e=f&&f.then;return f&&"object"==typeof f&&"function"==typeof e?function(){e.apply(f,arguments)}:void 0}function g(l,h){function f(o){e||(e=!0,d.reject(l,o))}function i(o){e||(e=!0,d.resolve(l,o))}function m(){h(i,f)}var e=!1,n=q(m);"error"===n.status&&f(n.value)}function q(h,e){var i={};try{i.value=h(e),i.status="success"}catch(f){i.status="error",i.value=f}return i}function D(e){return e instanceof this?e:d.resolve(new this(G),e)}function A(f){var e=new this(G);return d.reject(e,f)}function C(f){function h(r,s){function t(u){p[s]=u,++n!==i||m||(m=!0,d.resolve(o,p))}l.resolve(r).then(t,function(u){m||(m=!0,d.reject(o,u))})}var l=this;if("[object Array]"!==Object.prototype.toString.call(f)){return this.reject(new TypeError("must be an array"))}var i=f.length,m=!1;if(!i){return this.resolve([])}for(var p=new Array(i),n=0,e=-1,o=new this(G);++e<i;){h(f[e],e)}return o}function E(l){function h(o){f.resolve(o).then(function(p){e||(e=!0,d.resolve(i,p))},function(p){e||(e=!0,d.reject(i,p))})}var f=this;if("[object Array]"!==Object.prototype.toString.call(l)){return this.reject(new TypeError("must be an array"))}var m=l.length,e=!1;if(!m){return this.resolve([])}for(var n=-1,i=new this(G);++n<m;){h(l[n])}return i}var x=w(7),d={},c=["REJECTED"],I=["FULFILLED"],F=["PENDING"];k.exports=j,j.prototype["catch"]=function(e){return this.then(null,e)},j.prototype.then=function(f,e){if("function"!=typeof f&&this.state===I||"function"!=typeof e&&this.state===c){return this}var i=new this.constructor(G);if(this.state!==F){var h=this.state===I?f:e;H(i,h,this.outcome)}else{this.queue.push(new J(i,f,e))}return i},J.prototype.callFulfilled=function(e){d.resolve(this.promise,e)},J.prototype.otherCallFulfilled=function(e){H(this.promise,this.onFulfilled,e)},J.prototype.callRejected=function(e){d.reject(this.promise,e)},J.prototype.otherCallRejected=function(e){H(this.promise,this.onRejected,e)},d.resolve=function(i,f){var m=q(z,f);if("error"===m.status){return d.reject(i,m.value)}var h=m.value;if(h){g(i,h)}else{i.state=I,i.outcome=f;for(var l=-1,e=i.queue.length;++l<e;){i.queue[l].callFulfilled(f)}}return i},d.reject=function(h,e){h.state=c,h.outcome=e;for(var i=-1,f=h.queue.length;++i<f;){h.queue[i].callRejected(e)}return h},j.resolve=D,j.reject=A,j.all=C,j.race=E},{7:7}],11:[function(p,x,h){function d(i){if(i=""+i,!(i.length>10000)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(i);if(e){var l=parseFloat(e[1]),f=(e[2]||"ms").toLowerCase();switch(f){case"years":case"year":case"yrs":case"yr":case"y":return l*j;case"days":case"day":case"d":return l*m;case"hours":case"hour":case"hrs":case"hr":case"h":return l*q;case"minutes":case"minute":case"mins":case"min":case"m":return l*w;case"seconds":case"second":case"secs":case"sec":case"s":return l*c;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return l}}}}function g(e){return e>=m?Math.round(e/m)+"d":e>=q?Math.round(e/q)+"h":e>=w?Math.round(e/w)+"m":e>=c?Math.round(e/c)+"s":e+"ms"}function k(e){return v(e,m,"day")||v(e,q,"hour")||v(e,w,"minute")||v(e,c,"second")||e+" ms"}function v(f,e,i){return e>f?void 0:1.5*e>f?Math.floor(f/e)+" "+i:Math.ceil(f/e)+" "+i+"s"}var c=1000,w=60*c,q=60*w,m=24*q,j=365.25*m;x.exports=function(f,e){return e=e||{},"string"==typeof f?d(f):e["long"]?k(f):g(f)}},{}],12:[function(m,j,v){function y(e){if(null!==e){switch(typeof e){case"boolean":return e?1:0;case"number":return k(e);case"string":return e.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var l=Array.isArray(e),f=l?e:Object.keys(e),o=-1,i=f.length,n="";if(l){for(;++o<i;){n+=v.toIndexableString(f[o])}}else{for(;++o<i;){var h=f[o];n+=v.toIndexableString(h)+v.toIndexableString(e[h])}}return n}}return""}function d(r,h){var o,l=h,n="1"===r[h];if(n){o=0,h++}else{var p="0"===r[h];h++;var e="",i=r.substring(h,h+q),f=parseInt(i,10)+B;for(p&&(f=-f),h+=q;;){var s=r[h];if("\x00"===s){break}e+=s,h++}e=e.split("."),o=1===e.length?parseInt(e,10):parseFloat(e[0]+"."+e[1]),p&&(o-=10),0!==f&&(o=parseFloat(o+"e"+f))}return{num:o,length:h-l}}function c(f,o){var l=f.pop();if(o.length){var n=o[o.length-1];l===n.element&&(o.pop(),n=o[o.length-1]);var i=n.element,e=n.index;if(Array.isArray(i)){i.push(l)}else{if(e===f.length-2){var h=f.pop();i[h]=l}else{f.push(l)}}}}function C(i,f){for(var h=Math.min(i.length,f.length),l=0;h>l;l++){var e=v.collate(i[l],f[l]);if(0!==e){return e}}return i.length===f.length?0:i.length>f.length?1:-1}function x(f,e){return f===e?0:f>e?1:-1}function A(e,l){for(var f=Object.keys(e),o=Object.keys(l),i=Math.min(f.length,o.length),n=0;i>n;n++){var h=v.collate(f[n],o[n]);if(0!==h){return h}if(h=v.collate(e[f[n]],l[o[n]]),0!==h){return h}}return f.length===o.length?0:f.length>o.length?1:-1}function g(f){var e=["boolean","number","string","object"],h=e.indexOf(typeof f);return ~h?null===f?1:Array.isArray(f)?5:3>h?h+2:h+3:Array.isArray(f)?5:void 0}function k(r){if(0===r){return"1"}var h=r.toExponential().split(/e\+?/),o=parseInt(h[1],10),l=0>r,n=l?"0":"2",p=(l?-o:o)-B,e=z.padLeft(p.toString(),"0",q);n+=w+e;var i=Math.abs(parseFloat(h[0]));l&&(i=10-i);var f=i.toFixed(20);return f=f.replace(/\.?0+$/,""),n+=w+f}var B=-324,q=3,w="",z=m(13);v.collate=function(h,e){if(h===e){return 0}h=v.normalizeKey(h),e=v.normalizeKey(e);var f=g(h),i=g(e);if(f-i!==0){return f-i}if(null===h){return 0}switch(typeof h){case"number":return h-e;case"boolean":return h===e?0:e>h?-1:1;case"string":return x(h,e)}return Array.isArray(h)?C(h,e):A(h,e)},v.normalizeKey=function(l){switch(typeof l){case"undefined":return null;case"number":return l===1/0||l===-(1/0)||isNaN(l)?null:l;case"object":var h=l;if(Array.isArray(l)){var i=l.length;l=new Array(i);for(var e=0;i>e;e++){l[e]=v.normalizeKey(h[e])}}else{if(l instanceof Date){return l.toJSON()}if(null!==l){l={};for(var n in h){if(h.hasOwnProperty(n)){var f=h[n];"undefined"!=typeof f&&(l[n]=v.normalizeKey(f))}}}}}return l},v.toIndexableString=function(f){var e="\x00";return f=v.normalizeKey(f),g(f)+w+y(f)+e},v.parseIndexableString=function(r){for(var h=[],n=[],l=0;;){var e=r[l++];if("\x00"!==e){switch(e){case"1":h.push(null);break;case"2":h.push("1"===r[l]),l++;break;case"3":var i=d(r,l);h.push(i.num),l+=i.length;break;case"4":for(var f="";;){var s=r[l];if("\x00"===s){break}f+=s,l++}f=f.replace(/\u0001\u0001/g,"\x00").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),h.push(f);break;case"5":var p={element:[],index:h.length};h.push(p.element),n.push(p);break;case"6":var o={element:{},index:h.length};h.push(o.element),n.push(o);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+e)}}else{if(1===h.length){return h.pop()}c(h,n)}}}},{13:13}],13:[function(f,c,g){function d(h,k,j){for(var e="",i=j-h.length;e.length<i;){e+=k}return e}g.padLeft=function(h,e,j){var i=d(h,e,j);return i+h},g.padRight=function(h,e,j){var i=d(h,e,j);return h+i},g.stringLexCompare=function(j,p){var h,m=j.length,l=p.length;for(h=0;m>h;h++){if(h===l){return 1}var e=j.charAt(h),k=p.charAt(h);if(e!==k){return k>e?-1:1}}return l>m?-1:0},g.intToDecimalForm=function(i){var e=0>i,j="";do{var h=e?-Math.ceil(i%10):Math.floor(i%10);j=h+j,i=e?Math.ceil(i/10):Math.floor(i/10)}while(i);return e&&"0"!==j&&(j="-"+j),j}},{}],14:[function(f,c,h){function d(){this.store={}}function g(i){if(this.store=new d,i&&Array.isArray(i)){for(var e=0,j=i.length;j>e;e++){this.add(i[e])}}}h.Map=d,h.Set=g,d.prototype.mangle=function(e){if("string"!=typeof e){throw new TypeError("key must be a string but Got "+e)}return"$"+e},d.prototype.unmangle=function(e){return e.substring(1)},d.prototype.get=function(i){var e=this.mangle(i);return e in this.store?this.store[e]:void 0},d.prototype.set=function(i,e){var j=this.mangle(i);return this.store[j]=e,!0},d.prototype.has=function(i){var e=this.mangle(i);return e in this.store},d.prototype["delete"]=function(i){var e=this.mangle(i);return e in this.store?(delete this.store[e],!0):!1},d.prototype.forEach=function(e){for(var k=Object.keys(this.store),i=0,m=k.length;m>i;i++){var l=k[i],j=this.store[l];l=this.unmangle(l),e(j,l)}},g.prototype.add=function(e){return this.store.set(e,!0)},g.prototype.has=function(e){return this.store.has(e)},g.prototype["delete"]=function(e){return this.store["delete"](e)}},{}],15:[function(f,d,c){(function(){var e={}.hasOwnProperty,g=[].slice;d.exports=function(k,j){var i,m,l,h;m=[],h=[];for(i in j){e.call(j,i)&&(l=j[i],"this"!==i&&(m.push(i),h.push(l)))}return Function.apply(null,g.call(m).concat([k])).apply(j["this"],h)}}).call(this)},{}],16:[function(d,c,e){!function(g){if("object"==typeof e){c.exports=g()}else{if("function"==typeof b&&b.amd){b(g)}else{var h;try{h=window}catch(f){h=self}h.SparkMD5=g()}}}(function(F){function w(m,h,n,l,i,g){return h=K(K(h,m),K(l,g)),K(h<<i|h>>>32-i,n)}function A(m,h,l,i,n,o,g){return w(h&l|~h&i,m,h,n,o,g)}function H(m,h,l,i,n,o,g){return w(h&i|l&~i,m,h,n,o,g)}function x(m,h,l,i,n,o,g){return w(h^l^i,m,h,n,o,g)}function D(m,h,l,i,n,o,g){return w(l^(h|~i),m,h,n,o,g)}function M(m,h){var n=m[0],l=m[1],g=m[2],i=m[3];n=A(n,l,g,i,h[0],7,-680876936),i=A(i,n,l,g,h[1],12,-389564586),g=A(g,i,n,l,h[2],17,606105819),l=A(l,g,i,n,h[3],22,-1044525330),n=A(n,l,g,i,h[4],7,-176418897),i=A(i,n,l,g,h[5],12,1200080426),g=A(g,i,n,l,h[6],17,-1473231341),l=A(l,g,i,n,h[7],22,-45705983),n=A(n,l,g,i,h[8],7,1770035416),i=A(i,n,l,g,h[9],12,-1958414417),g=A(g,i,n,l,h[10],17,-42063),l=A(l,g,i,n,h[11],22,-1990404162),n=A(n,l,g,i,h[12],7,1804603682),i=A(i,n,l,g,h[13],12,-40341101),g=A(g,i,n,l,h[14],17,-1502002290),l=A(l,g,i,n,h[15],22,1236535329),n=H(n,l,g,i,h[1],5,-165796510),i=H(i,n,l,g,h[6],9,-1069501632),g=H(g,i,n,l,h[11],14,643717713),l=H(l,g,i,n,h[0],20,-373897302),n=H(n,l,g,i,h[5],5,-701558691),i=H(i,n,l,g,h[10],9,38016083),g=H(g,i,n,l,h[15],14,-660478335),l=H(l,g,i,n,h[4],20,-405537848),n=H(n,l,g,i,h[9],5,568446438),i=H(i,n,l,g,h[14],9,-1019803690),g=H(g,i,n,l,h[3],14,-187363961),l=H(l,g,i,n,h[8],20,1163531501),n=H(n,l,g,i,h[13],5,-1444681467),i=H(i,n,l,g,h[2],9,-51403784),g=H(g,i,n,l,h[7],14,1735328473),l=H(l,g,i,n,h[12],20,-1926607734),n=x(n,l,g,i,h[5],4,-378558),i=x(i,n,l,g,h[8],11,-2022574463),g=x(g,i,n,l,h[11],16,1839030562),l=x(l,g,i,n,h[14],23,-35309556),n=x(n,l,g,i,h[1],4,-1530992060),i=x(i,n,l,g,h[4],11,1272893353),g=x(g,i,n,l,h[7],16,-155497632),l=x(l,g,i,n,h[10],23,-1094730640),n=x(n,l,g,i,h[13],4,681279174),i=x(i,n,l,g,h[0],11,-358537222),g=x(g,i,n,l,h[3],16,-722521979),l=x(l,g,i,n,h[6],23,76029189),n=x(n,l,g,i,h[9],4,-640364487),i=x(i,n,l,g,h[12],11,-421815835),g=x(g,i,n,l,h[15],16,530742520),l=x(l,g,i,n,h[2],23,-995338651),n=D(n,l,g,i,h[0],6,-198630844),i=D(i,n,l,g,h[7],10,1126891415),g=D(g,i,n,l,h[14],15,-1416354905),l=D(l,g,i,n,h[5],21,-57434055),n=D(n,l,g,i,h[12],6,1700485571),i=D(i,n,l,g,h[3],10,-1894986606),g=D(g,i,n,l,h[10],15,-1051523),l=D(l,g,i,n,h[1],21,-2054922799),n=D(n,l,g,i,h[8],6,1873313359),i=D(i,n,l,g,h[15],10,-30611744),g=D(g,i,n,l,h[6],15,-1560198380),l=D(l,g,i,n,h[13],21,1309151649),n=D(n,l,g,i,h[4],6,-145523070),i=D(i,n,l,g,h[11],10,-1120210379),g=D(g,i,n,l,h[2],15,718787259),l=D(l,g,i,n,h[9],21,-343485551),m[0]=K(n,m[0]),m[1]=K(l,m[1]),m[2]=K(g,m[2]),m[3]=K(i,m[3])}function C(i){var h,g=[];for(h=0;64>h;h+=4){g[h>>2]=i.charCodeAt(h)+(i.charCodeAt(h+1)<<8)+(i.charCodeAt(h+2)<<16)+(i.charCodeAt(h+3)<<24)}return g}function B(i){var h,g=[];for(h=0;64>h;h+=4){g[h>>2]=i[h]+(i[h+1]<<8)+(i[h+2]<<16)+(i[h+3]<<24)}return g}function G(g){var m,o,l,n,p,i,h=g.length,r=[1732584193,-271733879,-1732584194,271733878];for(m=64;h>=m;m+=64){M(r,C(g.substring(m-64,m)))}for(g=g.substring(m-64),o=g.length,l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],m=0;o>m;m+=1){l[m>>2]|=g.charCodeAt(m)<<(m%4<<3)}if(l[m>>2]|=128<<(m%4<<3),m>55){for(M(r,l),m=0;16>m;m+=1){l[m]=0}}return n=8*h,n=n.toString(16).match(/(.*?)(.{0,8})$/),p=parseInt(n[2],16),i=parseInt(n[1],16)||0,l[14]=p,l[15]=i,M(r,l),r}function q(g){var i,o,l,n,p,m,h=g.length,r=[1732584193,-271733879,-1732584194,271733878];for(i=64;h>=i;i+=64){M(r,B(g.subarray(i-64,i)))}for(g=h>i-64?g.subarray(i-64):new Uint8Array(0),o=g.length,l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i=0;o>i;i+=1){l[i>>2]|=g[i]<<(i%4<<3)}if(l[i>>2]|=128<<(i%4<<3),i>55){for(M(r,l),i=0;16>i;i+=1){l[i]=0}}return n=8*h,n=n.toString(16).match(/(.*?)(.{0,8})$/),p=parseInt(n[2],16),m=parseInt(n[1],16)||0,l[14]=p,l[15]=m,M(r,l),r}function E(i){var h,g="";for(h=0;4>h;h+=1){g+=L[i>>8*h+4&15]+L[i>>8*h&15]}return g}function I(h){var g;for(g=0;g<h.length;g+=1){h[g]=E(h[g])}return h.join("")}function z(g){return/[\u0080-\uFFFF]/.test(g)&&(g=unescape(encodeURIComponent(g))),g}function k(m,h){var n,l=m.length,i=new ArrayBuffer(l),g=new Uint8Array(i);for(n=0;l>n;n+=1){g[n]=m.charCodeAt(n)}return h?g:i}function j(g){return String.fromCharCode.apply(null,new Uint8Array(g))}function f(l,g,h){var i=new Uint8Array(l.byteLength+g.byteLength);return i.set(new Uint8Array(l)),i.set(new Uint8Array(g),l.byteLength),h?i:i.buffer}function N(l){var g,h=[],i=l.length;for(g=0;i-1>g;g+=2){h.push(parseInt(l.substr(g,2),16))}return String.fromCharCode.apply(String,h)}function J(){this.reset()}var K=function(h,g){return h+g&4294967295},L=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return"5d41402abc4b2a76b9719d911017c592"!==I(G("hello"))&&(K=function(l,g){var h=(65535&l)+(65535&g),i=(l>>16)+(g>>16)+(h>>16);return i<<16|65535&h}),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||!function(){function g(i,h){return i=0|i||0,0>i?Math.max(i+h,0):Math.min(i,h)}ArrayBuffer.prototype.slice=function(h,r){var o,n,s,l,p=this.byteLength,i=g(h,p),m=p;return r!==F&&(m=g(r,p)),i>m?new ArrayBuffer(0):(o=m-i,n=new ArrayBuffer(o),s=new Uint8Array(n),l=new Uint8Array(this,i,o),s.set(l),n)}}(),J.prototype.append=function(g){return this.appendBinary(z(g)),this},J.prototype.appendBinary=function(i){this._buff+=i,this._length+=i.length;var h,g=this._buff.length;for(h=64;g>=h;h+=64){M(this._hash,C(this._buff.substring(h-64,h)))}return this._buff=this._buff.substring(h-64),this},J.prototype.end=function(m){var h,n,l=this._buff,i=l.length,g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(h=0;i>h;h+=1){g[h>>2]|=l.charCodeAt(h)<<(h%4<<3)}return this._finish(g,i),n=I(this._hash),m&&(n=N(n)),this.reset(),n},J.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},J.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},J.prototype.setState=function(g){return this._buff=g.buff,this._length=g.length,this._hash=g.hash,this},J.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},J.prototype._finish=function(m,h){var n,l,i,g=h;if(m[g>>2]|=128<<(g%4<<3),g>55){for(M(this._hash,m),g=0;16>g;g+=1){m[g]=0}}n=8*this._length,n=n.toString(16).match(/(.*?)(.{0,8})$/),l=parseInt(n[2],16),i=parseInt(n[1],16)||0,m[14]=l,m[15]=i,M(this._hash,m)},J.hash=function(h,g){return J.hashBinary(z(h),g)},J.hashBinary=function(l,g){var h=G(l),i=I(h);return g?N(i):i},J.ArrayBuffer=function(){this.reset()},J.ArrayBuffer.prototype.append=function(l){var g,h=f(this._buff.buffer,l,!0),i=h.length;for(this._length+=l.byteLength,g=64;i>=g;g+=64){M(this._hash,B(h.subarray(g-64,g)))}return this._buff=i>g-64?new Uint8Array(h.buffer.slice(g-64)):new Uint8Array(0),this},J.ArrayBuffer.prototype.end=function(m){var h,n,l=this._buff,i=l.length,g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(h=0;i>h;h+=1){g[h>>2]|=l[h]<<(h%4<<3)}return this._finish(g,i),n=I(this._hash),m&&(n=N(n)),this.reset(),n},J.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},J.ArrayBuffer.prototype.getState=function(){var g=J.prototype.getState.call(this);return g.buff=j(g.buff),g},J.ArrayBuffer.prototype.setState=function(g){return g.buff=k(g.buff,!0),J.prototype.setState.call(this,g)},J.ArrayBuffer.prototype.destroy=J.prototype.destroy,J.ArrayBuffer.prototype._finish=J.prototype._finish,J.ArrayBuffer.hash=function(l,g){var h=q(new Uint8Array(l)),i=I(h);return g?N(i):i},J})},{}],17:[function(f,c,g){function d(j,p,h){var m=h[h.length-1];j===m.element&&(h.pop(),m=h[h.length-1]);var l=m.element,e=m.index;if(Array.isArray(l)){l.push(j)}else{if(e===p.length-2){var k=p.pop();l[k]=j}else{p.push(j)}}}g.stringify=function(q){var z=[];z.push({obj:q});for(var w,x,p,m,B,v,h,e,A,k,j,y="";w=z.pop();){if(x=w.obj,p=w.prefix||"",m=w.val||"",y+=p,m){y+=m}else{if("object"!=typeof x){y+="undefined"==typeof x?null:JSON.stringify(x)}else{if(null===x){y+="null"}else{if(Array.isArray(x)){for(z.push({val:"]"}),B=x.length-1;B>=0;B--){v=0===B?"":",",z.push({obj:x[B],prefix:v})}z.push({val:"["})}else{h=[];for(e in x){x.hasOwnProperty(e)&&h.push(e)}for(z.push({val:"}"}),B=h.length-1;B>=0;B--){A=h[B],k=x[A],j=B>0?",":"",j+=JSON.stringify(A)+":",z.push({obj:k,prefix:j})}z.push({val:"{"})}}}}}return y},g.parse=function(x){for(var w,e,v,y,m,h,q,p,k,z=[],r=[],j=0;;){if(w=x[j++],"}"!==w&&"]"!==w&&"undefined"!=typeof w){switch(w){case" ":case"	":case"\n":case":":case",":break;case"n":j+=3,d(null,z,r);break;case"t":j+=3,d(!0,z,r);break;case"f":j+=4,d(!1,z,r);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(e="",j--;;){if(v=x[j++],!/[\d\.\-e\+]/.test(v)){j--;break}e+=v}d(parseFloat(e),z,r);break;case'"':for(y="",m=void 0,h=0;;){if(q=x[j++],'"'===q&&("\\"!==m||h%2!==1)){break}y+=q,m=q,"\\"===m?h++:h=0}d(JSON.parse('"'+y+'"'),z,r);break;case"[":p={element:[],index:z.length},z.push(p.element),r.push(p);break;case"{":k={element:{},index:z.length},z.push(k.element),r.push(k);break;default:throw new Error("unexpectedly reached end of input: "+w)}}else{if(1===z.length){return z.pop()}d(z.pop(),z,r)}}}},{}]},{},[3])(3)});