!function(b){if("object"==typeof exports&&"undefined"!=typeof module){module.exports=b()}else{if("function"==typeof define&&define.amd){define([],b)}else{var a;a="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,a.PouchDB=b()}}}(function(){var b;return function a(g,j,f){function h(e,k){if(!j[e]){if(!g[e]){var i="function"==typeof require&&require;if(!k&&i){return i(e,!0)}if(d){return d(e,!0)}var m=new Error("Cannot find module '"+e+"'");throw m.code="MODULE_NOT_FOUND",m}var l=j[e]={exports:{}};g[e][0].call(l.exports,function(o){var p=g[e][1][o];return h(p?p:o)},l,l.exports,a,g,j,f)}return j[e].exports}for(var d="function"==typeof require&&require,c=0;c<f.length;c++){h(f[c])}return h}({1:[function(j,f,l){function h(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function k(i){return"function"==typeof i}function d(i){return"number"==typeof i}function c(i){return"object"==typeof i&&null!==i}function g(i){return void 0===i}f.exports=h,h.EventEmitter=h,h.prototype._events=void 0,h.prototype._maxListeners=void 0,h.defaultMaxListeners=10,h.prototype.setMaxListeners=function(i){if(!d(i)||0>i||isNaN(i)){throw TypeError("n must be a positive number")}return this._maxListeners=i,this},h.prototype.emit=function(s){var p,w,q,o,m,v;if(this._events||(this._events={}),"error"===s&&(!this._events.error||c(this._events.error)&&!this._events.error.length)){if(p=arguments[1],p instanceof Error){throw p}throw TypeError('Uncaught, unspecified "error" event.')}if(w=this._events[s],g(w)){return !1}if(k(w)){switch(arguments.length){case 1:w.call(this);break;case 2:w.call(this,arguments[1]);break;case 3:w.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),w.apply(this,o)}}else{if(c(w)){for(o=Array.prototype.slice.call(arguments,1),v=w.slice(),q=v.length,m=0;q>m;m++){v[m].apply(this,o)}}}return !0},h.prototype.addListener=function(m,i){var o;if(!k(i)){throw TypeError("listener must be a function")}return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",m,k(i.listener)?i.listener:i),this._events[m]?c(this._events[m])?this._events[m].push(i):this._events[m]=[this._events[m],i]:this._events[m]=i,c(this._events[m])&&!this._events[m].warned&&(o=g(this._maxListeners)?h.defaultMaxListeners:this._maxListeners,o&&o>0&&this._events[m].length>o&&(this._events[m].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[m].length),"function"==typeof console.trace&&console.trace())),this},h.prototype.on=h.prototype.addListener,h.prototype.once=function(o,i){function p(){this.removeListener(o,p),m||(m=!0,i.apply(this,arguments))}if(!k(i)){throw TypeError("listener must be a function")}var m=!1;return p.listener=i,this.on(o,p),this},h.prototype.removeListener=function(u,o){var v,q,m,p;if(!k(o)){throw TypeError("listener must be a function")}if(!this._events||!this._events[u]){return this}if(v=this._events[u],m=v.length,q=-1,v===o||k(v.listener)&&v.listener===o){delete this._events[u],this._events.removeListener&&this.emit("removeListener",u,o)}else{if(c(v)){for(p=m;p-->0;){if(v[p]===o||v[p].listener&&v[p].listener===o){q=p;break}}if(0>q){return this}1===v.length?(v.length=0,delete this._events[u]):v.splice(q,1),this._events.removeListener&&this.emit("removeListener",u,o)}}return this},h.prototype.removeAllListeners=function(m){var i,o;if(!this._events){return this}if(!this._events.removeListener){return 0===arguments.length?this._events={}:this._events[m]&&delete this._events[m],this}if(0===arguments.length){for(i in this._events){"removeListener"!==i&&this.removeAllListeners(i)}return this.removeAllListeners("removeListener"),this._events={},this}if(o=this._events[m],k(o)){this.removeListener(m,o)}else{if(o){for(;o.length;){this.removeListener(m,o[o.length-1])}}}return delete this._events[m],this},h.prototype.listeners=function(m){var i;return i=this._events&&this._events[m]?k(this._events[m])?[this._events[m]]:this._events[m].slice():[]},h.prototype.listenerCount=function(m){if(this._events){var i=this._events[m];if(k(i)){return 1}if(i){return i.length}}return 0},h.listenerCount=function(m,i){return m.listenerCount(i)}},{}],2:[function(w,B,k){function g(){x&&v&&(x=!1,v.length?m=v.concat(m):q=-1,m.length&&j())}function j(){if(!x){var d=C(g);x=!0;for(var c=m.length;c;){for(v=m,m=[];++q<c;){v&&v[q].run()}q=-1,c=m.length}v=null,x=!1,A(d)}}function p(d,c){this.fun=d,this.array=c}function z(){}var C,A,y=B.exports={};!function(){try{C=setTimeout}catch(c){C=function(){throw new Error("setTimeout is not defined")}}try{A=clearTimeout}catch(c){A=function(){throw new Error("clearTimeout is not defined")}}}();var v,m=[],x=!1,q=-1;y.nextTick=function(d){var c=new Array(arguments.length-1);if(arguments.length>1){for(var f=1;f<arguments.length;f++){c[f-1]=arguments[f]}}m.push(new p(d,c)),1!==m.length||x||C(j,0)},p.prototype.run=function(){this.fun.apply(null,this.array)},y.title="browser",y.browser=!0,y.env={},y.argv=[],y.version="",y.versions={},y.on=z,y.addListener=z,y.once=z,y.off=z,y.removeListener=z,y.removeAllListeners=z,y.emit=z,y.binding=function(c){throw new Error("process.binding is not supported")},y.cwd=function(){return"/"},y.chdir=function(c){throw new Error("process.chdir is not supported")},y.umask=function(){return 0}},{}],3:[function(d,c,f){(function(eH,eB){function eF(g){return g&&"object"==typeof g&&"default" in g?g["default"]:g}function eP(g){return g instanceof ArrayBuffer||"undefined"!=typeof Blob&&g instanceof Blob}function eZ(i){if("function"==typeof i.slice){return i.slice(0)}var g=new ArrayBuffer(i.byteLength),j=new Uint8Array(g),h=new Uint8Array(i);return j.set(h),g}function ez(h){if(h instanceof ArrayBuffer){return eZ(h)}var g=h.size,i=h.type;return"function"==typeof h.slice?h.slice(0,g,i):h.webkitSlice(0,g,i)}function ex(h){var g=Object.getPrototypeOf(h);if(null===g){return !0}var i=g.constructor;return"function"==typeof i&&i instanceof i&&e.call(i)==bp}function eX(i){var g,k,h;if(!i||"object"!=typeof i){return i}if(Array.isArray(i)){for(g=[],k=0,h=i.length;h>k;k++){g[k]=eX(i[k])}return g}if(i instanceof Date){return i.toISOString()}if(eP(i)){return ez(i)}if(!ex(i)){return i}g={};for(k in i){if(Object.prototype.hasOwnProperty.call(i,k)){var j=eX(i[k]);"undefined"!=typeof j&&(g[k]=j)}}return g}function eU(h){var g=!1;return dH(function(i){if(g){throw new Error("once called more than once")}g=!0,h.apply(this,i)})}function eK(g){return dH(function(k){k=eX(k);var l,m=this,j="function"==typeof k[k.length-1]?k.pop():!1;j&&(l=function(n,i){eH.nextTick(function(){j(n,i)})});var h=new bI(function(v,u){var p;try{var o=eU(function(n,i){n?u(n):v(i)});k.push(o),p=g.apply(m,k),p&&"function"==typeof p.then&&v(p)}catch(q){u(q)}});return l&&h.then(function(i){l(null,i)},l),h})}function eW(h,g){function i(m,k,q){if(cE.enabled){for(var l=[m._db_name,k],p=0;p<q.length-1;p++){l.push(q[p])}cE.apply(null,l);var j=q[q.length-1];q[q.length-1]=function(v,s){var u=[m._db_name,k];u=u.concat(v?["error",v]:["success",s]),cE.apply(null,u),j(v,s)}}}return eK(dH(function(j){if(this._closed){return bI.reject(new Error("database is closed"))}if(this._destroyed){return bI.reject(new Error("database is destroyed"))}var k=this;return i(k,h,j),this.taskqueue.isReady?g.apply(this,j):new bI(function(l,m){k.taskqueue.addTask(function(n){n?m(n):l(k[h].apply(k,j))})})}))}function eR(k,h){for(var m={},j=0,l=h.length;l>j;j++){var g=h[j];g in k&&(m[g]=k[g])}return m}function eD(g){return g}function ew(g){return[{ok:g}]}function es(q,C,j){function g(){var i=[];v.forEach(function(l){l.docs.forEach(function(o){i.push({id:l.id,docs:[o]})})}),j(null,{results:i})}function h(){++k===p&&g()}function m(l,i,o){v[l]={id:i,docs:o},h()}function z(){if(!(A>=x.length)){var l=Math.min(A+dA,x.length),i=x.slice(A,l);D(i,A),A+=i.length}}function D(l,i){l.forEach(function(H,G){var E=i+G,y=w[H],F=eR(y[0],["atts_since","attachments"]);F.open_revs=y.map(function(n){return n.rev}),F.open_revs=F.open_revs.filter(eD);var r=eD;0===F.open_revs.length&&(delete F.open_revs,r=ew),["revs","attachments","binary","ajax"].forEach(function(n){n in C&&(F[n]=C[n])}),q.get(H,F,function(s,n){var o;o=s?[{error:s}]:r(n),m(E,H,o),z()})})}var B=C.docs,w={};B.forEach(function(i){i.id in w?w[i.id].push(i):w[i.id]=[i]});var p=Object.keys(w).length,k=0,v=new Array(p),x=Object.keys(w),A=0;z()}function e0(){return"undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage&&"undefined"!=typeof chrome.storage.local}function eI(){return dw}function eS(g){e0()?chrome.storage.onChanged.addListener(function(h){null!=h.db_name&&g.emit(h.dbName.newValue)}):eI()&&("undefined"!=typeof addEventListener?addEventListener("storage",function(h){g.emit(h.key)}):window.attachEvent("storage",function(h){g.emit(h.key)}))}function eY(){fa.EventEmitter.call(this),this._listeners={},eS(this)}function ev(h){if("undefined"!==console&&h in console){var g=Array.prototype.slice.call(arguments,1);console[h].apply(console,g)}}function fC(i,g){var k=600000;i=parseInt(i,10)||0,g=parseInt(g,10),g!==g||i>=g?g=(i||1)<<1:g+=1,g>k&&(i=k>>1,g=k);var h=Math.random(),j=g-i;return ~~(j*h+i)}function fb(h){var g=0;return h||(g=2000),fC(h,g)}function eL(h,g){ev("info","The above "+h+" is totally normal. "+g)}function eC(g){Error.call(this,g.reason),this.status=g.status,this.name=g.error,this.message=g.reason,this.error=!0}function eu(i,g,j){function h(k){for(var l in i){"function"!=typeof i[l]&&(this[l]=i[l])}void 0!==j&&(this.name=j),void 0!==k&&(this.reason=k)}return h.prototype=eC.prototype,new h(g)}function fG(k){var h,m,j,l,g;return m=k.error===!0&&"string"==typeof k.name?k.name:k.error,g=k.reason,j=cl("name",m,g),k.missing||"missing"===g||"deleted"===g||"not_found"===m?j=fq:"doc_validation"===m?(j=eh,l=g):"bad_request"===m&&j.message!==g&&(j=eM),j||(j=cl("status",k.status,g)||aj),h=eu(j,g,m),l&&(h.message=l),k.id&&(h.id=k.id),k.status&&(h.status=k.status),k.missing&&(h.missing=k.missing),h}function e9(i,g,k){try{return !i(g,k)}catch(h){var j="Filter function threw: "+h.toString();return eu(eM,j)}}function fj(h){var g={},i=h.filter&&"function"==typeof h.filter;return g.query=h.query_params,function(k){k.doc||(k.doc={});var l=i&&e9(h.filter,k.doc,g);if("object"==typeof l){return l}if(l){return !1}if(h.include_docs){if(!h.attachments){for(var j in k.doc._attachments){k.doc._attachments.hasOwnProperty(j)&&(k.doc._attachments[j].stub=!0)}}}else{delete k.doc}return !0}}function eO(i){for(var g=[],j=0,h=i.length;h>j;j++){g=g.concat(i[j])}return g}function fE(h){var g;if(h?"string"!=typeof h?g=eu(c0):/^_/.test(h)&&!/^_(design|local)/.test(h)&&(g=eu(a7)):g=eu(dL),g){throw g}}function fp(h,g){return"listenerCount" in h?h.listenerCount(g):fa.EventEmitter.listenerCount(h,g)}function fw(h){if(!h){return null}var g=h.split("/");return 2===g.length?g:1===g.length?[h,h]:null}function fD(h){var g=fw(h);return g?g.join("/"):null}function fc(l){for(var j=fO.exec(l),p={},k=14;k--;){var m=by[k],h=j[k]||"",g=-1!==["user","password"].indexOf(m);p[m]=g?decodeURIComponent(h):h}return p[b4]={},p[by[12]].replace(dj,function(o,i,n){i&&(p[b4][i]=n)}),p}function fk(h,g,i){return new bI(function(j,k){h.get(g,function(n,l){if(n){if(404!==n.status){return k(n)}l={}}var o=l._rev,m=i(l);return m?(m._id=g,m._rev=o,void j(fF(h,m,i))):j({updated:!1,rev:o})})})}function fF(h,g,i){return h.put(g).then(function(j){return{updated:!0,rev:j.rev}},function(j){if(409!==j.status){throw j}return fk(h,g._id,i)})}function fm(g){return 0|Math.random()*g}function fB(i,g){g=g||bd.length;var j="",h=-1;if(i){for(;++h<i;){j+=bd[fm(g)]}return j}for(;++h<36;){switch(h){case 8:case 13:case 18:case 23:j+="-";break;case 19:j+=bd[3&fm(16)|8];break;default:j+=bd[fm(16)]}}return j}function e8(q){for(var z,j,g,h,m=q.rev_tree.slice();h=m.pop();){var x=h.ids,A=x[2],y=h.pos;if(A.length){for(var w=0,p=A.length;p>w;w++){m.push({pos:y+1,ids:A[w]})}}else{var k=!!x[1].deleted,v=x[0];z&&!(g!==k?g:j!==y?y>j:v>z)||(z=v,j=y,g=k)}}return j+"-"+z}function fg(l,v){for(var j,g=l.slice();j=g.pop();){for(var h=j.pos,k=j.ids,p=k[2],w=v(0===p.length,h,k[0],j.ctx,k[1]),q=0,m=p.length;m>q;q++){g.push({pos:h+1,ids:p[q],ctx:w})}}}function fx(h,g){return h.pos-g.pos}function fs(i){var g=[];fg(i,function(m,q,l,p,k){m&&g.push({rev:q+"-"+l,pos:q,opts:k})}),g.sort(fx).reverse();for(var j=0,h=g.length;h>j;j++){delete g[j].pos}return g}function fu(l){for(var j=e8(l),p=fs(l.rev_tree),k=[],m=0,h=p.length;h>m;m++){var g=p[m];g.rev===j||g.opts.deleted||k.push(g.rev)}return k}function e5(h){var g=[];return fg(h.rev_tree,function(l,p,k,m,j){"available"!==j.status||l||(g.push(p+"-"+k),j.status="missing")}),g}function eq(q){for(var z,j=[],g=q.slice();z=g.pop();){var h=z.pos,m=z.ids,x=m[0],A=m[1],y=m[2],w=0===y.length,p=z.history?z.history.slice():[];p.push({id:x,opts:A}),w&&j.push({pos:h+1-p.length,ids:p});for(var k=0,v=y.length;v>k;k++){g.push({pos:h+1,ids:y[k],history:p})}}return j.reverse()}function e4(h,g){return h.pos-g.pos}function fz(k,h,m){for(var j,l=0,g=k.length;g>l;){j=l+g>>>1,m(k[j],h)<0?l=j+1:g=j}return l}function e6(i,g,j){var h=fz(i,g,j);i.splice(h,0,g)}function fd(m,j){for(var q,l,p=j,h=m.length;h>p;p++){var g=m[p],k=[g.id,g.opts,[]];l?(l[2].push(k),l=k):q=l=k}return q}function fX(h,g){return h[0]<g[0]?-1:1}function e3(l,v){for(var j=[{tree1:l,tree2:v}],g=!1;j.length>0;){var h=j.pop(),k=h.tree1,p=h.tree2;(k[1].status||p[1].status)&&(k[1].status="available"===k[1].status||"available"===p[1].status?"available":"missing");for(var w=0;w<p[2].length;w++){if(k[2][0]){for(var q=!1,m=0;m<k[2].length;m++){k[2][m][0]===p[2][w][0]&&(j.push({tree1:k[2][m],tree2:p[2][w]}),q=!0)}q||(g="new_branch",e6(k[2],p[2][w],fX))}else{g="new_leaf",k[2][0]=p[2][w]}}}return{conflicts:g,tree:l}}function e2(J,w,C){var z,B=[],F=!1,M=!1;if(!J.length){return{tree:[w],conflicts:"new_leaf"}}for(var x=0,q=J.length;q>x;x++){var L=J[x];if(L.pos===w.pos&&L.ids[0]===w.ids[0]){z=e3(L.ids,w.ids),B.push({pos:L.pos,ids:z.tree}),F=F||z.conflicts,M=!0}else{if(C!==!0){var I=L.pos<w.pos?L:w,E=L.pos<w.pos?w:L,K=E.pos-I.pos,G=[],A=[];for(A.push({ids:I.ids,diff:K,parent:null,parentIdx:null});A.length>0;){var k=A.pop();if(0!==k.diff){for(var j=k.ids[2],N=0,D=j.length;D>N;N++){A.push({ids:j[N],diff:k.diff-1,parent:k.ids,parentIdx:N})}}else{k.ids[0]===E.ids[0]&&G.push(k)}}var H=G[0];H?(z=e3(H.ids,E.ids),H.parent[2][H.parentIdx]=z.tree,B.push({pos:I.pos,ids:I.ids}),F=F||z.conflicts,M=!0):B.push(L)}else{B.push(L)}}}return M||B.push(w),B.sort(e4),{tree:B,conflicts:F||"internal_node"}}function ea(q,z){for(var j,g=eq(q),h={},m=0,x=g.length;x>m;m++){for(var A=g[m],y=A.ids,w=Math.max(0,y.length-z),p={pos:A.pos+w,ids:fd(y,w)},k=0;w>k;k++){var v=A.pos+k+"-"+y[k].id;h[v]=!0}j=j?e2(j,p,!0).tree:[p]}return fg(j,function(l,i,o){delete h[i+"-"+o]}),{tree:j,revs:Object.keys(h)}}function a5(i,g,k){var h=e2(i,g),j=ea(h.tree,k);return{tree:j.tree,stemmedRevs:j.revs,conflicts:h.conflicts}}function cx(l,v){for(var j,g=l.slice(),h=v.split("-"),k=parseInt(h[0],10),p=h[1];j=g.pop();){if(j.pos===k&&j.ids[0]===p){return !0}for(var w=j.ids[2],q=0,m=w.length;m>q;q++){g.push({pos:j.pos+1,ids:w[q]})}}return !1}function bF(g){return g.ids}function cb(i,g){g||(g=e8(i));for(var k,h=g.substring(g.indexOf("-")+1),j=i.rev_tree.map(bF);k=j.pop();){if(k[0]===h){return !!k[1].deleted}j=j.concat(k[2])}}function ds(g){return/^_local/.test(g)}function fW(g){return av("return "+g+";",{})}function bl(g){return new Function("doc",["var emitted = false;","var emit = function (a, b) {","  emitted = true;","};","var view = "+g+";","view(doc);","if (emitted) {","  return true;","}"].join("\n"))}function aU(h,g){try{h.emit("change",g)}catch(i){ev("error",'Error in .on("change", function):',i)}}function eV(l,j,p){function k(){m.cancel()}fa.EventEmitter.call(this);var m=this;this.db=l,j=j?eX(j):{};var h=j.complete=eU(function(i,o){i?fp(m,"error")>0&&m.emit("error",i):m.emit("complete",o),m.removeAllListeners(),l.removeListener("destroyed",k)});p&&(m.on("complete",function(i){p(null,i)}),m.on("error",p)),l.once("destroyed",k),j.onChange=function(i){j.isCancelled||(aU(m,i),m.startSeq&&m.startSeq<=i.seq&&(m.startSeq=!1))};var g=new bI(function(i,o){j.complete=function(n,q){n?o(n):i(q)}});m.once("cancel",function(){l.removeListener("destroyed",k),j.complete(null,{status:"cancelled"})}),this.then=g.then.bind(g),this["catch"]=g["catch"].bind(g),this.then(function(i){h(null,i)},h),l.taskqueue.isReady?m.doChanges(j):l.taskqueue.addTask(function(){m.isCancelled?m.emit("cancel"):m.doChanges(j)})}function dZ(i,g,k){var h=[{rev:i._rev}];"all_docs"===k.style&&(h=fs(g.rev_tree).map(function(l){return{rev:l.rev}}));var j={id:g.id,changes:h,doc:i};return cb(g,i._rev)&&(j.deleted=!0),k.conflicts&&(j.doc._conflicts=fu(g),j.doc._conflicts.length||delete j.doc._conflicts),j}function cT(h,g){return g>h?-1:h>g?1:0}function em(h,g){for(var i=0;i<h.length;i++){if(g(h[i],i)===!0){return h[i]}}}function dE(g){return function(h,i){h||i[0]&&i[0].error?g(h||i[0]):g(null,i.length?i[0]:i)}}function b0(k){for(var h=0;h<k.length;h++){var m=k[h];if(m._deleted){delete m._attachments}else{if(m._attachments){for(var j=Object.keys(m._attachments),l=0;l<j.length;l++){var g=j[l];m._attachments[g]=eR(m._attachments[g],["data","digest","content_type","length","revpos","stub"])}}}}}function aJ(i,g){var k=cT(i._id,g._id);if(0!==k){return k}var h=i._revisions?i._revisions.start:0,j=g._revisions?g._revisions.start:0;return cT(h,j)}function f4(h){var g={},i=[];return fg(h,function(m,l,n,k){var j=l+"-"+n;return m&&(g[j]=0),void 0!==k&&i.push({from:k,to:j}),j}),i.reverse(),i.forEach(function(j){void 0===g[j.from]?g[j.from]=1+g[j.to]:g[j.from]=Math.min(g[j.from],1+g[j.to])}),g}function ap(i,g,k){var h="limit" in g?g.keys.slice(g.skip,g.limit+g.skip):g.skip>0?g.keys.slice(g.skip):g.keys;if(g.descending&&h.reverse(),!h.length){return i._allDocs({limit:0},k)}var j={offset:g.skip};return bI.all(h.map(function(m){var l=bS.extend({key:m,deleted:"ok"},g);return["limit","skip","keys"].forEach(function(n){delete l[n]}),new bI(function(o,n){i._allDocs(l,function(q,p){return q?n(q):(j.total_rows=p.total_rows,void o(p.rows[0]||{key:m,error:"not_found"}))})})})).then(function(l){return j.rows=l,j})}function cI(i){var g=i._compactionQueue[0],h=g.opts,j=g.callback;i.get("_local/compaction")["catch"](function(){return !1}).then(function(k){k&&k.last_seq&&(h.last_seq=k.last_seq),i._compact(h,function(l,m){l?j(l):j(null,m),eH.nextTick(function(){i._compactionQueue.shift(),i._compactionQueue.length&&cI(i)})})})}function dO(g){return"_"===g.charAt(0)?g+"is not a valid attachment name, attachment names cannot start with '_'":!1}function fA(){fa.EventEmitter.call(this)}function ay(){this.isReady=!1,this.failed=!1,this.queue=[]}function aD(g){g&&eB.debug&&ev("error",g)}function cU(l,j){function p(){h.emit("destroyed",m)}function k(){l.removeListener("destroyed",p),l.emit("destroyed",l)}var m=j.originalName,h=l.constructor,g=h._destructionListeners;l.once("destroyed",p),g.has(m)||g.set(m,[]),g.get(m).push(k)}function c3(l,j,p){if(!(this instanceof c3)){return new c3(l,j,p)}var k=this;if("function"!=typeof j&&"undefined"!=typeof j||(p=j,j={}),l&&"object"==typeof l&&(j=l,l=void 0),"undefined"==typeof p){p=aD}else{var m=p;p=function(){return ev("warn","Using a callback for new PouchDB()is deprecated."),m.apply(null,arguments)}}l=l||j.name,j=eX(j),delete j.name,this.__opts=j;var h=p;k.auto_compaction=j.auto_compaction,k.prefix=c3.prefix,fA.call(k),k.taskqueue=new ay;var g=new bI(function(u,q){p=function(o,i){return o?q(o):(delete i.then,void u(i))},j=eX(j);var n,r;return function(){try{if("string"!=typeof l){throw r=new Error("Missing/invalid DB name"),r.code=400,r}var s=(j.prefix||"")+l;if(n=c3.parseAdapter(s,j),j.originalName=l,j.name=n.name,j.adapter=j.adapter||n.adapter,k._adapter=j.adapter,aF("pouchdb:adapter")("Picked adapter: "+j.adapter),k._db_name=l,!c3.adapters[j.adapter]){throw r=new Error("Adapter is missing"),r.code=404,r}if(!c3.adapters[j.adapter].valid()){throw r=new Error("Invalid Adapter"),r.code=404,r}}catch(i){k.taskqueue.fail(i)}}(),r?q(r):(k.adapter=j.adapter,k.replicate={},k.replicate.from=function(o,i,s){return k.constructor.replicate(o,k,i,s)},k.replicate.to=function(o,i,s){return k.constructor.replicate(k,o,i,s)},k.sync=function(o,i,s){return k.constructor.sync(k,o,i,s)},k.replicate.sync=k.sync,void c3.adapters[j.adapter].call(k,j,function(i){return i?(k.taskqueue.fail(i),void p(i)):(cU(k,j),k.emit("created",k),c3.emit("created",j.originalName),k.taskqueue.ready(k),void p(null,k))}))});g.then(function(i){h(null,i)},h),k.then=g.then.bind(g),k["catch"]=g["catch"].bind(g)}function bP(h){Object.keys(fa.EventEmitter.prototype).forEach(function(i){"function"==typeof fa.EventEmitter.prototype[i]&&(h[i]=aR[i].bind(aR))});var g=h._destructionListeners=new cA.Map;h.on("destroyed",function(i){g.get(i).forEach(function(j){j()}),g["delete"](i)})}function ag(g){return g.reduce(function(i,h){return i[h]=!0,i},{})}function bv(i){if(!/^\d+\-./.test(i)){return eu(cf)}var g=i.indexOf("-"),j=i.substring(0,g),h=i.substring(g+1);return{prefix:parseInt(j,10),id:h}}function cJ(l,j){for(var p=l.start-l.ids.length+1,k=l.ids,m=[k[0],j,[]],h=1,g=k.length;g>h;h++){m=[k[h],{status:"missing"},[m]]}return[{pos:p,ids:m}]}function dF(l,v){var j,g,h,k={status:"available"};if(l._deleted&&(k.deleted=!0),v){if(l._id||(l._id=fB()),g=fB(32,16).toLowerCase(),l._rev){if(h=bv(l._rev),h.error){return h}l._rev_tree=[{pos:h.prefix,ids:[h.id,{status:"missing"},[[g,k,[]]]]}],j=h.prefix+1}else{l._rev_tree=[{pos:1,ids:[g,k,[]]}],j=1}}else{if(l._revisions&&(l._rev_tree=cJ(l._revisions,k),j=l._revisions.start,g=l._revisions.ids[0]),!l._rev_tree){if(h=bv(l._rev),h.error){return h}j=h.prefix,g=h.id,l._rev_tree=[{pos:j,ids:[g,k,[]]}]}}fE(l._id),l._rev=j+"-"+g;var p={metadata:{},data:{}};for(var w in l){if(Object.prototype.hasOwnProperty.call(l,w)){var q="_"===w[0];if(q&&!cM[w]){var m=eu(eh,w);throw m.message=eh.message+": "+w,m}q&&!dx[w]?p.metadata[w.slice(1)]=l[w]:p.data[w]=l[w]}}return p}function dd(i){for(var g="",k=new Uint8Array(i),h=k.byteLength,j=0;h>j;j++){g+=String.fromCharCode(k[j])}return g}function aZ(g){return aG(dd(g))}function eb(k,h){k=k||[],h=h||{};try{return new Blob(k,h)}catch(m){if("TypeError"!==m.name){throw m}for(var j="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder,l=new j,g=0;g<k.length;g+=1){l.append(k[g])}return l.getBlob(h.type)}}function fH(i){for(var g=i.length,k=new ArrayBuffer(g),h=new Uint8Array(k),j=0;g>j;j++){h[j]=i.charCodeAt(j)}return k}function aO(h,g){return eb([fH(h)],{type:g})}function c4(h,g){return aO(bT(h),g)}function dP(i,g){if("undefined"==typeof FileReader){return g(dd((new FileReaderSync).readAsArrayBuffer(i)))}var j=new FileReader,h="function"==typeof j.readAsBinaryString;j.onloadend=function(k){var l=k.target.result||"";return h?g(l):void g(dd(l))},h?j.readAsBinaryString(i):j.readAsArrayBuffer(i)}function ba(h,g){dP(h,function(i){g(aG(i))})}function d0(h,g){if("undefined"==typeof FileReader){return g((new FileReaderSync).readAsArrayBuffer(h))}var i=new FileReader;i.onloadend=function(j){var k=j.target.result||new ArrayBuffer(0);g(k)},i.readAsArrayBuffer(h)}function aq(g){return aG(g)}function cy(i,g,j,h){(j>0||h<g.byteLength)&&(g=new Uint8Array(g,j,Math.min(h,g.byteLength)-j)),i.append(g)}function du(i,g,j,h){(j>0||h<g.length)&&(g=g.substring(j,h)),i.appendBinary(g)}function fY(l,v){function j(){var n=w*k,u=n+k;if(w++,p>w){m(q,l,n,u),f1(j)}else{m(q,l,n,u);var s=q.end(!0),i=aq(s);v(i),q.destroy()}}var g="string"==typeof l,h=g?l.length:l.byteLength,k=Math.min(ad,h),p=Math.ceil(h/k),w=0,q=g?new aA:new aA.ArrayBuffer,m=g?du:cy;j()}function ep(g){return aA.hash(g)}function e1(m,j,q){function l(o){try{return bT(o)}catch(i){var r=eu(cs,"Attachment is not a valid base64 string");return{error:r}}}function p(i,s){if(i.stub){return s()}if("string"==typeof i.data){var r=l(i.data);if(r.error){return s(r.error)}i.length=r.length,"blob"===j?i.data=aO(r,i.content_type):"base64"===j?i.data=aG(r):i.data=r,fY(r,function(n){i.digest="md5-"+n,s()})}else{d0(i.data,function(n){"binary"===j?i.data=dd(n):"base64"===j&&(i.data=aZ(n)),fY(n,function(o){i.digest="md5-"+o,i.length=n.byteLength,s()})})}}function h(){k++,m.length===k&&(g?q(g):q())}if(!m.length){return q()}var g,k=0;m.forEach(function(v){function i(n){g=n,u++,u===w.length&&h()}var w=v.data&&v.data._attachments?Object.keys(v.data._attachments):[],u=0;if(!w.length){return h()}for(var o in v.data._attachments){v.data._attachments.hasOwnProperty(o)&&p(v.data._attachments[o],i)}})}function b1(J,w,C,z,B,F,N,x){if(cx(w.rev_tree,C.metadata.rev)){return z[B]=C,F()}var q=w.winningRev||e8(w),L="deleted" in w?w.deleted:cb(w,q),I="deleted" in C.metadata?C.metadata.deleted:cb(C.metadata),E=/^1-/.test(C.metadata.rev);if(L&&!I&&x&&E){var K=C.data;K._rev=q,K._id=C.metadata.id,C=dF(K,x)}var G=a5(w.rev_tree,C.metadata.rev_tree[0],J),A=x&&(L&&I||!L&&"new_leaf"!==G.conflicts||L&&!I&&"new_branch"===G.conflicts);if(A){var k=eu(aL);return z[B]=k,F()}var j=C.metadata.rev;C.metadata.rev_tree=G.tree,C.stemmedRevs=G.stemmedRevs||[],w.rev_map&&(C.metadata.rev_map=w.rev_map);var O,D=e8(C.metadata),H=cb(C.metadata,D),M=L===H?0:H>L?-1:1;O=j===D?H:cb(C.metadata,j),N(C,D,H,O,!0,M,B,F)}function fQ(g){return"missing"===g.metadata.rev_tree[0].ids[1].status}function bQ(y,D,m,g,k,v,B,E,C){function A(s,i,H){var l=e8(s.metadata),F=cb(s.metadata,l);if("was_delete" in E&&F){return v[i]=eu(fq,"deleted"),H()}var h=q&&fQ(s);if(h){var G=eu(aL);return v[i]=G,H()}var p=F?0:1;B(s,l,F,F,!1,p,i,H)}function x(){++w===j&&C&&C()}y=y||1000;var q=E.new_edits,z=new cA.Map,w=0,j=D.length;D.forEach(function(n,i){if(n._id&&ds(n._id)){var l=n._deleted?"_removeLocal":"_putLocal";return void m[l](n,{ctx:k},function(o,p){v[i]=o||p,x()})}var h=n.metadata.id;z.has(h)?(j--,z.get(h).push([n,i])):z.set(h,[[n,i]])}),z.forEach(function(i,r){function p(){++h<i.length?l():x()}function l(){var o=i[h],u=o[0],F=o[1];if(g.has(r)){b1(y,g.get(r),u,v,F,p,B,q)}else{var n=a5([],u.metadata.rev_tree[0],y);u.metadata.rev_tree=n.tree,u.stemmedRevs=n.stemmedRevs||[],A(u,F,p)}}var h=0;l()})}function f9(h){try{return JSON.parse(h)}catch(g){return cP.parse(h)}}function cc(g){return g.length<50000?JSON.parse(g):f9(g)}function df(h){try{return JSON.stringify(h)}catch(g){return cP.stringify(h)}}function cp(i,g,k,h){try{i.apply(g,k)}catch(j){h.emit("error",j)}}function bG(h){if(!t.running&&t.queue.length){t.running=!0;var g=t.queue.shift();g.action(function(i,j){cp(g.callback,this,[i,j],h),t.running=!1,eH.nextTick(function(){bG(h)})})}}function bu(g){return function(h){var i="unknown_error";h.target&&h.target.error&&(i=h.target.error.name||h.target.error.message),g(eu(bM,i,h.type))}}function d1(h,g,i){return{data:df(h),winningRev:g,deletedOrLocal:i?"1":"0",seq:h.seq,id:h.id}}function a0(h){if(!h){return null}var g=cc(h.data);return g.winningRev=h.winningRev,g.deleted="1"===h.deletedOrLocal,g.seq=h.seq,g}function cj(h){if(!h){return h}var g=h._doc_id_rev.lastIndexOf(":");return h._id=h._doc_id_rev.substring(0,g-1),h._rev=h._doc_id_rev.substring(g+1),delete h._doc_id_rev,h}function bw(i,g,j,h){j?h(i?"string"!=typeof i?i:c4(i,g):eb([""],{type:g})):i?"string"!=typeof i?dP(i,function(k){h(aG(k))}):h(i):h("")}function b2(m,j,q,l){function p(){++k===g.length&&l&&l()}function h(v,s){var u=v._attachments[s],o=u.digest,n=q.objectStore(aw).get(o);n.onsuccess=function(i){u.body=i.target.result.body,p()}}var g=Object.keys(m._attachments||{});if(!g.length){return l&&l()}var k=0;g.forEach(function(i){j.attachments&&j.include_docs?h(m,i):(m._attachments[i].stub=!0,p())})}function dg(h,g){return bI.all(h.map(function(i){if(i.doc&&i.doc._attachments){var j=Object.keys(i.doc._attachments);return bI.all(j.map(function(p){var l=i.doc._attachments[p];if("body" in l){var m=l.body,k=l.content_type;return new bI(function(n){bw(m,k,g,function(o){i.doc._attachments[p]=bS.extend(eR(l,["digest","content_type"]),{data:o}),n()})})}}))}}))}function fM(l,v,j){function g(){m--,m||h()}function h(){k.length&&k.forEach(function(n){var i=q.index("digestSeq").count(IDBKeyRange.bound(n+"::",n+"::￿",!1,!1));i.onsuccess=function(o){var r=o.target.result;r||w["delete"](n)}})}var k=[],p=j.objectStore(ff),w=j.objectStore(aw),q=j.objectStore(aB),m=l.length;l.forEach(function(i){var s=p.index("_doc_id_rev"),r=v+"::"+i;s.getKey(r).onsuccess=function(u){var o=u.target.result;if("number"!=typeof o){return g()}p["delete"](o);var x=q.index("seq").openCursor(IDBKeyRange.only(o));x.onsuccess=function(z){var y=z.target.result;if(y){var A=y.value.digestSeq.split("::")[0];k.push(A),q["delete"](y.primaryKey),y["continue"]()}else{g()}}}})}function bb(i,g,j){try{return{txn:i.transaction(g,j)}}catch(h){return{error:h}}}function aP(bn,N,Y,R,X,ao,ce){function P(){var h=[dI,ff,aw,cX,aB],g=bb(X,h,"readwrite");return g.error?ce(g.error):(Z=g.txn,Z.onabort=bu(ce),Z.ontimeout=bu(ce),Z.oncomplete=be,at=Z.objectStore(dI),bt=Z.objectStore(ff),H=Z.objectStore(aw),M=Z.objectStore(aB),void bo(function(i){return i?(D=!0,ce(i)):void br()}))}function K(){bQ(bn.revs_limit,ai,R,Q,Z,an,ar,Y)}function br(){function l(){++p===ai.length&&K()}function j(i){var o=a0(i.target.result);o&&Q.set(o.id,o),l()}if(ai.length){for(var p=0,k=0,m=ai.length;m>k;k++){var h=ai[k];if(h._id&&ds(h._id)){l()}else{var g=at.get(h.metadata.id);g.onsuccess=j}}}}function be(){D||(ao.notify(R._meta.name),R._meta.docCount+=U,ce(null,an))}function ae(h,g){var i=H.get(h);i.onsuccess=function(k){if(k.target.result){g()}else{var j=eu(bh,"unknown stub attachment with digest "+h);j.status=412,g(j)}}}function bo(i){function g(){++j===k.length&&i(h)}var k=[];if(ai.forEach(function(l){l.data&&l.data._attachments&&Object.keys(l.data._attachments).forEach(function(m){var n=l.data._attachments[m];n.stub&&k.push(n.digest)})}),!k.length){return i()}var h,j=0;k.forEach(function(l){ae(l,function(m){m&&!h&&(h=m),g()})})}function ar(l,v,j,g,h,k,p,w){U+=k,l.metadata.winningRev=v,l.metadata.deleted=j;var q=l.data;q._id=l.metadata.id,q._rev=l.metadata.rev,g&&(q._deleted=!0);var m=q._attachments&&Object.keys(q._attachments).length;return m?J(l,v,j,h,p,w):void W(l,v,j,h,p,w)}function W(p,y,h,g,k,v){function A(o){var l=p.stemmedRevs||[];g&&R.auto_compaction&&(l=l.concat(e5(p.metadata))),l&&l.length&&fM(l,p.metadata.id,Z),j.seq=o.target.result,delete j.rev;var C=d1(j,y,h),n=at.put(C);n.onsuccess=r}function w(l){l.preventDefault(),l.stopPropagation();var i=bt.index("_doc_id_rev"),o=i.getKey(m._doc_id_rev);o.onsuccess=function(s){var n=bt.put(m,s.target.result);n.onsuccess=A}}function r(){an[k]={ok:!0,id:j.id,rev:y},Q.set(p.metadata.id,p.metadata),F(p,j.seq,v)}var m=p.data,j=p.metadata;m._doc_id_rev=j.id+"::"+j.rev,delete m._id,delete m._rev;var q=bt.put(m);q.onsuccess=A,q.onerror=w}function J(m,w,j,g,h,k){function q(){p===l.length&&W(m,w,j,g,h,k)}function y(){p++,q()}var v=m.data,p=0,l=Object.keys(v._attachments);l.forEach(function(C){var u=m.data._attachments[C];if(u.stub){p++,q()}else{var A=u.data;delete u.data,u.revpos=parseInt(w,10);var s=u.digest;ci(s,A,y)}})}function F(m,j,q){function l(){++h===g.length&&q()}function p(u){var s=m.data._attachments[u].digest,r=M.put({seq:j,digestSeq:s+"::"+j});r.onsuccess=l,r.onerror=function(i){i.preventDefault(),i.stopPropagation(),l()}}var h=0,g=Object.keys(m.data._attachments||{});if(!g.length){return q()}for(var k=0;k<g.length;k++){p(g[k])}}function ci(i,g,j){var h=H.count(i);h.onsuccess=function(m){var n=m.target.result;if(n){return j()}var l={digest:i,body:g},k=H.put(l);k.onsuccess=j}}for(var Z,at,bt,H,M,z,ai=N.docs,U=0,V=0,x=ai.length;x>V;V++){var B=ai[V];B._id&&ds(B._id)||(B=ai[V]=dF(B,Y.new_edits),B.error&&!z&&(z=B))}if(z){return ce(z)}var an=new Array(ai.length),Q=new cA.Map,D=!1,G=R._meta.blobSupport?"blob":"base64";e1(ai,G,function(g){return g?ce(g):void P()})}function ey(k,h,m,j,l){try{if(k&&h){return l?IDBKeyRange.bound(h,k,!m,!1):IDBKeyRange.bound(k,h,!1,!m)}if(k){return l?IDBKeyRange.upperBound(k):IDBKeyRange.lowerBound(k)}if(h){return l?IDBKeyRange.lowerBound(h,!m):IDBKeyRange.upperBound(h,!m)}if(j){return IDBKeyRange.only(j)}}catch(g){return{error:g}}return null}function dQ(i,g,j,h){return"DataError"===j.name&&0===j.code?h(null,{total_rows:i._meta.docCount,offset:g.skip,rows:[]}):void h(eu(bM,j.name,j.message))}function cK(k,h,m,j){function l(Q,F){function I(i,s,p){var q=i.id+"::"+p;n.get(q).onsuccess=function(o){s.doc=cj(o.target.result),Q.conflicts&&(s.doc._conflicts=fu(i)),b2(s.doc,Q,O)}}function M(q,u,s){var p={id:s.id,key:s.id,value:{rev:u}},o=s.deleted;if("ok"===Q.deleted){L.push(p),o?(p.value.deleted=!0,p.doc=null):Q.include_docs&&I(s,p,u)}else{if(!o&&R--<=0&&(L.push(p),Q.include_docs&&I(s,p,u),0===--N)){return}}q["continue"]()}function V(p){G=h._meta.docCount;var s=p.target.result;if(s){var i=a0(s.value),q=i.winningRev;M(s,q,i)}}function D(){F(null,{total_rows:G,offset:Q.skip,rows:L})}function B(){Q.attachments?dg(L,Q.binary).then(D):D()}var T="startkey" in Q?Q.startkey:!1,P="endkey" in Q?Q.endkey:!1,K="key" in Q?Q.key:!1,R=Q.skip||0,N="number"==typeof Q.limit?Q.limit:-1,H=Q.inclusive_end!==!1,A="descending" in Q&&Q.descending?"prev":null,x=ey(T,P,H,K,A);if(x&&x.error){return dQ(h,Q,x.error,F)}var W=[dI,ff];Q.attachments&&W.push(aw);var J=bb(m,W,"readonly");if(J.error){return F(J.error)}var O=J.txn,U=O.objectStore(dI),z=O.objectStore(ff),C=A?U.openCursor(x,A):U.openCursor(x),n=z.index("_doc_id_rev"),L=[],G=0;O.oncomplete=B,C.onsuccess=V}function g(i,o){return 0===i.limit?o(null,{total_rows:h._meta.docCount,offset:i.skip,rows:[]}):void l(i,o)}g(k,j)}function ec(g){return new bI(function(h){var i=eb([""]);g.objectStore(bJ).put(i,"key"),g.onabort=function(j){j.preventDefault(),j.stopPropagation(),h(!1)},g.oncomplete=function(){var j=navigator.userAgent.match(/Chrome\/(\d+)/),k=navigator.userAgent.match(/Edge\//);h(k||!j||parseInt(j[1],10)>=43)}})["catch"](function(){return !1})}function dv(h,g){var i=this;t.queue.push({action:function(j){bR(i,h,j)},callback:g}),bG(i.constructor)}function bR(q,C,g){function k(i){var h=i.createObjectStore(dI,{keyPath:"id"});i.createObjectStore(ff,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),i.createObjectStore(aw,{keyPath:"digest"}),i.createObjectStore(cR,{keyPath:"id",autoIncrement:!1}),i.createObjectStore(bJ),h.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),i.createObjectStore(cX,{keyPath:"_id"});var o=i.createObjectStore(aB,{autoIncrement:!0});o.createIndex("seq","seq"),o.createIndex("digestSeq","digestSeq",{unique:!0})}function l(i,h){var o=i.objectStore(dI);o.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),o.openCursor().onsuccess=function(u){var s=u.target.result;if(s){var v=s.value,p=cb(v);v.deletedOrLocal=p?"1":"0",o.put(v),s["continue"]()}else{h()}}}function z(h){h.createObjectStore(cX,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}function D(u,p){var y=u.objectStore(cX),s=u.objectStore(dI),v=u.objectStore(ff),h=s.openCursor();h.onsuccess=function(H){var E=H.target.result;if(E){var K=E.value,N=K.id,M=ds(N),J=e8(K);if(M){var G=N+"::"+J,r=N+"::",I=N+"::~",F=v.index("_doc_id_rev"),o=IDBKeyRange.bound(r,I,!1,!1),L=F.openCursor(o);L.onsuccess=function(O){if(L=O.target.result){var i=L.value;i._doc_id_rev===G&&y.put(i),v["delete"](L.primaryKey),L["continue"]()}else{s["delete"](E.primaryKey),E["continue"]()}}}else{E["continue"]()}}else{p&&p()}}}function B(i){var h=i.createObjectStore(aB,{autoIncrement:!0});h.createIndex("seq","seq"),h.createIndex("digestSeq","digestSeq",{unique:!0})}function n(u,p){var y=u.objectStore(ff),s=u.objectStore(aw),v=u.objectStore(aB),h=s.count();h.onsuccess=function(o){var i=o.target.result;return i?void (y.openCursor().onsuccess=function(J){var F=J.target.result;if(!F){return p()}for(var E=F.value,H=F.primaryKey,L=Object.keys(E._attachments||{}),N={},M=0;M<L.length;M++){var K=E._attachments[L[M]];N[K.digest]=!0}var I=Object.keys(N);for(M=0;M<I.length;M++){var G=I[M];v.put({seq:H,digestSeq:G+"::"+H})}F["continue"]()}):p()}}function w(p){function h(o){return o.data?a0(o):(o.deleted="1"===o.deletedOrLocal,o)}var u=p.objectStore(ff),i=p.objectStore(dI),s=i.openCursor();s.onsuccess=function(E){function F(){var I=y.id+"::",G=y.id+"::￿",H=u.index("_doc_id_rev").openCursor(IDBKeyRange.bound(I,G)),J=0;H.onsuccess=function(K){var o=K.target.result;if(!o){return y.seq=J,v()}var L=o.primaryKey;L>J&&(J=L),o["continue"]()}}function v(){var G=d1(y,y.winningRev,y.deleted),o=i.put(G);o.onsuccess=function(){r["continue"]()}}var r=E.target.result;if(r){var y=h(r.value);return y.winningRev=y.winningRev||e8(y),y.seq?v():void F()}}}var m=C.name,j=null;q._meta=null,q.type=function(){return"idb"},q._id=eK(function(h){h(null,q._meta.instanceId)}),q._bulkDocs=function(p,h,i){aP(C,p,h,q,j,cG,i)},q._get=function(E,H,v){function h(){v(F,{doc:p,metadata:y,ctx:I})}var p,y,F,I=H.ctx;if(!I){var G=bb(j,[dI,ff,aw],"readonly");if(G.error){return v(G.error)}I=G.txn}I.objectStore(dI).get(E).onsuccess=function(o){if(y=a0(o.target.result),!y){return F=eu(fq,"missing"),h()}if(cb(y)&&!H.rev){return F=eu(fq,"deleted"),h()}var s=I.objectStore(ff),i=H.rev||y.winningRev,r=y.id+"::"+i;s.index("_doc_id_rev").get(r).onsuccess=function(u){return p=u.target.result,p&&(p=cj(p)),p?void h():(F=eu(fq,"missing"),h())}}},q._getAttachment=function(E,H,v,h,p){var y;if(h.ctx){y=h.ctx}else{var F=bb(j,[dI,ff,aw],"readonly");if(F.error){return p(F.error)}y=F.txn}var I=v.digest,G=v.content_type;y.objectStore(aw).get(I).onsuccess=function(o){var i=o.target.result.body;bw(i,G,h.binary,function(r){p(null,r)})}},q._info=function(u){if(null===j||!bq.has(m)){var F=new Error("db isn't open");return F.id="idbNull",u(F)}var y,E,p=bb(j,[ff],"readonly");if(p.error){return u(p.error)}var h=p.txn,v=h.objectStore(ff).openCursor(null,"prev");v.onsuccess=function(i){var o=i.target.result;y=o?o.key:0,E=q._meta.docCount},h.oncomplete=function(){u(null,{doc_count:E,update_seq:y,idb_attachment_format:q._meta.blobSupport?"binary":"base64"})}},q._allDocs=function(h,i){cK(h,q,j,i)},q._changes=function(G){function K(y){function W(){return V.seq!==s?y["continue"]():(F=s,V.winningRev===u._rev?U(u):void v())}function v(){var o=u._id+"::"+V.winningRev,i=T.get(o);i.onsuccess=function(r){U(cj(r.target.result))}}function U(Y){var i=G.processChange(Y,V,G);i.seq=V.seq;var X=R(i);return"object"==typeof X?G.complete(X):(X&&(O++,M&&L.push(i),G.attachments&&G.include_docs?b2(Y,G,Q,function(){dg([i],G.binary).then(function(){G.onChange(i)})}):G.onChange(i)),void (O!==P&&y["continue"]()))}var u=cj(y.value),s=y.key;if(H&&!H.has(u._id)){return y["continue"]()}var V;return(V=p.get(u._id))?W():void (h.get(u._id).onsuccess=function(i){V=a0(i.target.result),p.set(u._id,V),W()})}function I(o){var i=o.target.result;i&&K(i)}function J(){var i=[dI,ff];G.attachments&&i.push(aw);var s=bb(j,i,"readonly");if(s.error){return G.complete(s.error)}Q=s.txn,Q.onabort=bu(G.complete),Q.oncomplete=N,E=Q.objectStore(ff),h=Q.objectStore(dI),T=E.index("_doc_id_rev");var r;r=G.descending?E.openCursor(null,"prev"):E.openCursor(IDBKeyRange.lowerBound(G.since,!0)),r.onsuccess=I}function N(){function i(){G.complete(null,{results:L,last_seq:F})}!G.continuous&&G.attachments?dg(L).then(i):i()}if(G=eX(G),G.continuous){var S=m+":"+fB();return cG.addListener(m,S,q,G),cG.notify(m),{cancel:function(){cG.removeListener(m,S)}}}var H=G.doc_ids&&new cA.Set(G.doc_ids);G.since=G.since||0;var F=G.since,P="limit" in G?G.limit:-1;0===P&&(P=1);var M;M="return_docs" in G?G.return_docs:"returnDocs" in G?G.returnDocs:!0;var Q,E,h,T,L=[],O=0,R=fj(G),p=new cA.Map;J()},q._close=function(h){return null===j?h(eu(dV)):(j.close(),bq["delete"](m),j=null,void h())},q._getRevisionTree=function(p,h){var u=bb(j,[dI],"readonly");if(u.error){return h(u.error)}var i=u.txn,s=i.objectStore(dI).get(p);s.onsuccess=function(o){var r=a0(o.target.result);r?h(null,r.rev_tree):h(eu(fq))}},q._doCompaction=function(v,s,E){var u=[dI,ff,aw,aB],y=bb(j,u,"readwrite");if(y.error){return E(y.error)}var p=y.txn,h=p.objectStore(dI);h.get(v).onsuccess=function(H){var F=a0(H.target.result);fg(F.rev_tree,function(L,N,K,M,J){var I=N+"-"+K;-1!==s.indexOf(I)&&(J.status="missing")}),fM(s,v,p);var G=F.winningRev,i=F.deleted;p.objectStore(dI).put(d1(F,G,i))},p.onabort=bu(E),p.oncomplete=function(){E()}},q._getLocal=function(p,h){var u=bb(j,[cX],"readonly");if(u.error){return h(u.error)}var i=u.txn,s=i.objectStore(cX).get(p);s.onerror=bu(h),s.onsuccess=function(o){var r=o.target.result;r?(delete r._doc_id_rev,h(null,r)):h(eu(fq))}},q._putLocal=function(E,I,v){"function"==typeof I&&(v=I,I={}),delete E._revisions;var h=E._rev,p=E._id;h?E._rev="0-"+(parseInt(h.split("-")[1],10)+1):E._rev="0-1";var y,G=I.ctx;if(!G){var J=bb(j,[cX],"readwrite");if(J.error){return v(J.error)}G=J.txn,G.onerror=bu(v),G.oncomplete=function(){y&&v(null,y)}}var H,F=G.objectStore(cX);h?(H=F.get(p),H.onsuccess=function(u){var i=u.target.result;if(i&&i._rev===h){var r=F.put(E);r.onsuccess=function(){y={ok:!0,id:E._id,rev:E._rev},I.ctx&&v(null,y)}}else{v(eu(aL))}}):(H=F.add(E),H.onerror=function(i){v(eu(aL)),i.preventDefault(),i.stopPropagation()},H.onsuccess=function(){y={ok:!0,id:E._id,rev:E._rev},I.ctx&&v(null,y)})},q._removeLocal=function(E,H,v){"function"==typeof H&&(v=H,H={});var h=H.ctx;if(!h){var p=bb(j,[cX],"readwrite");if(p.error){return v(p.error)}h=p.txn,h.oncomplete=function(){y&&v(null,y)}}var y,F=E._id,I=h.objectStore(cX),G=I.get(F);G.onerror=bu(v),G.onsuccess=function(i){var s=i.target.result;s&&s._rev===E._rev?(I["delete"](F),y={ok:!0,id:F,rev:"0-0"},H.ctx&&v(null,y)):v(eu(fq))}},q._destroy=function(o,h){cG.removeAllListeners(m);var p=dC.get(m);p&&p.result&&(p.result.close(),bq["delete"](m));var i=indexedDB.deleteDatabase(m);i.onsuccess=function(){dC["delete"](m),eI()&&m in localStorage&&delete localStorage[m],h(null,{ok:!0})},i.onerror=bu(h)};var A=bq.get(m);if(A){return j=A.idb,q._meta=A.global,void eH.nextTick(function(){g(null,q)})}var x;x=C.storage?aE(m,C.storage):indexedDB.open(m,cB),dC.set(m,x),x.onupgradeneeded=function(p){function i(){var r=s[h-1];h++,r&&r(o,i)}var u=p.target.result;if(p.oldVersion<1){return k(u)}var o=p.currentTarget.transaction;p.oldVersion<3&&z(u),p.oldVersion<4&&B(u);var s=[l,D,n,w],h=p.oldVersion;i()},x.onsuccess=function(r){j=r.target.result,j.onversionchange=function(){j.close(),bq["delete"](m)},j.onabort=function(i){ev("error","Database has a global failure",i.target.error),j.close(),bq["delete"](m)};var y=j.transaction([cR,bJ,dI],"readwrite"),v=y.objectStore(cR).get(cR),p=null,h=null,u=null;v.onsuccess=function(s){var E=function(){null!==p&&null!==h&&null!==u&&(q._meta={name:m,instanceId:u,blobSupport:p,docCount:h},bq.set(m,{idb:j,global:q._meta}),g(null,q))},i=s.target.result||{id:cR};m+"_id" in i?(u=i[m+"_id"],E()):(u=fB(),i[m+"_id"]=u,y.objectStore(cR).put(i).onsuccess=function(){E()}),dS||(dS=ec(y)),dS.then(function(o){p=o,E()});var F=y.objectStore(dI).index("deletedOrLocal");F.count(IDBKeyRange.only("0")).onsuccess=function(o){h=o.target.result,E()}}},x.onerror=function(){var h="Failed to open indexedDB, are you in private browsing mode?";ev("error",h),g(eu(bM,h))}}function aE(h,g){try{return indexedDB.open(h,{version:cB,storage:g})}catch(i){return indexedDB.open(h,cB)}}function fZ(g){g.adapter("idb",dv,!0)}function ab(g){return decodeURIComponent(escape(g))}function cz(g){return 65>g?g-48:g-55}function dG(i,g,j){for(var h="";j>g;){h+=String.fromCharCode(cz(i.charCodeAt(g++))<<4|cz(i.charCodeAt(g++)))}return h}function e7(i,g,j){for(var h="";j>g;){h+=String.fromCharCode(cz(i.charCodeAt(g+2))<<12|cz(i.charCodeAt(g+3))<<8|cz(i.charCodeAt(g))<<4|cz(i.charCodeAt(g+1))),g+=4}return h}function au(h,g){return"UTF-8"===g?ab(dG(h,0,h.length)):e7(h,0,h.length)}function az(g){return"'"+g+"'"}function cO(g){return g.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"")}function cV(g){return g.replace(/\u0001\u0001/g,"\x00").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,"")}function bH(g){return delete g._id,delete g._rev,JSON.stringify(g)}function ga(h,g,i){return h=JSON.parse(h),h._id=g,h._rev=i,h}function bm(h){for(var g="(";h--;){g+="?",h&&(g+=",")}return g+")"}function cD(i,g,k,h,j){return"SELECT "+i+" FROM "+("string"==typeof g?g:g.join(" JOIN "))+(k?" ON "+k:"")+(h?" WHERE "+("string"==typeof h?h:h.join(" AND ")):"")+(j?" ORDER BY "+j:"")}function dz(l,j,p){function k(){++h===l.length&&m()}function m(){if(g.length){var i="SELECT DISTINCT digest AS digest FROM "+dM+" WHERE seq IN "+bm(g.length);p.executeSql(i,g,function(u,q){for(var w=[],s=0;s<q.rows.length;s++){w.push(q.rows.item(s).digest)}if(w.length){var v="DELETE FROM "+dM+" WHERE seq IN ("+g.map(function(){return"?"}).join(",")+")";u.executeSql(v,g,function(o){var n="SELECT digest FROM "+dM+" WHERE digest IN ("+w.map(function(){return"?"}).join(",")+")";o.executeSql(n,w,function(z,x){for(var y=new cA.Set,A=0;A<x.rows.length;A++){y.add(x.rows.item(A).digest)}w.forEach(function(r){y.has(r)||(z.executeSql("DELETE FROM "+dM+" WHERE digest=?",[r]),z.executeSql("DELETE FROM "+fv+" WHERE digest=?",[r]))})})})}})}}if(l.length){var h=0,g=[];l.forEach(function(i){var n="SELECT seq FROM "+d8+" WHERE doc_id=? AND rev=?";p.executeSql(n,[j,i],function(q,o){if(!o.rows.length){return k()}var r=o.rows.item(0).seq;g.push(r),q.executeSql("DELETE FROM "+d8+" WHERE seq=?",[r],k)})})}}function c5(g){return function(h){ev("error","WebSQL threw an error",h);var k=h&&h.constructor.toString().match(/function ([^\(]+)/),i=k&&k[1]||h.type,j=h.target||h.message;g(eu(f6,j,i))}}function aV(h){if("size" in h){return 1000000*h.size}var g="undefined"!=typeof navigator&&/Android/.test(navigator.userAgent);return g?5000000:1}function d5(L,z,E,B,D,H,P){function A(){return J?P(J):(H.notify(B._name),B._docCount=-1,void P(null,O))}function x(h,g){var i="SELECT count(*) as cnt FROM "+fv+" WHERE digest=?";F.executeSql(i,[h],function(p,l){if(0===l.rows.item(0).cnt){var m=eu(bh,"unknown stub attachment with digest "+h);g(m)}else{g()}})}function N(i){function g(){++l===m.length&&i(h)}var m=[];if(j.forEach(function(n){n.data&&n.data._attachments&&Object.keys(n.data._attachments).forEach(function(o){var p=n.data._attachments[o];p.stub&&m.push(p.digest)})}),!m.length){return i()}var h,l=0;m.forEach(function(n){x(n,function(o){o&&!h&&(h=o),g()})})}function K(S,Z,m,h,w,W,ae,Y){function U(){function v(bn,ar){function be(){return ++u===n.length&&ar(),!1}function bo(br){var bt="INSERT INTO "+dM+" (digest, seq) VALUES (?,?)",s=[ao._attachments[br].digest,bn];F.executeSql(bt,s,be,be)}var u=0,n=Object.keys(ao._attachments||{});if(!n.length){return ar()}for(var at=0;at<n.length;at++){bo(n[at])}}var ao=S.data,ai=h?1:0,p=ao._id,l=ao._rev,y=bH(ao),o="INSERT INTO "+d8+" (doc_id, rev, json, deleted) VALUES (?, ?, ?, ?);",an=[p,l,y,ai];F.executeSql(o,an,function(s,u){var i=u.insertId;v(i,function(){T(s,i)})},function(){var i=cD("seq",d8,null,"doc_id=? AND rev=?");return F.executeSql(i,[p,l],function(ar,bn){var at=bn.rows.item(0).seq,s="UPDATE "+d8+" SET json=?, deleted=? WHERE doc_id=? AND rev=?;",be=[y,ai,p,l];ar.executeSql(s,be,function(n){v(at,function(){T(n,at)})})}),!1})}function R(i){g||(i?(g=i,Y(g)):X===V.length&&U())}function r(i){X++,R(i)}function T(ai,v){var p=S.metadata.id,y=S.stemmedRevs||[];w&&B.auto_compaction&&(y=e5(S.metadata).concat(y)),y.length&&dz(y,p,ai),S.metadata.seq=v,delete S.metadata.rev;var s=w?"UPDATE "+aX+" SET json=?, max_seq=?, winningseq=(SELECT seq FROM "+d8+" WHERE doc_id="+aX+".id AND rev=?) WHERE id=?":"INSERT INTO "+aX+" (id, winningseq, max_seq, json) VALUES (?,?,?,?);",i=df(S.metadata),u=w?[i,v,Z,p]:[p,v,v,i];ai.executeSql(s,u,function(){O[ae]={ok:!0,id:S.metadata.id,rev:Z},k.set(p,S.metadata),Y()})}var g=null,X=0;S.data._id=S.metadata.id,S.data._rev=S.metadata.rev;var V=Object.keys(S.data._attachments||{});h&&(S.data._deleted=!0),V.forEach(function(u){var p=S.data._attachments[u];if(p.stub){X++,R()}else{var s=p.data;delete p.data,p.revpos=parseInt(Z,10);var l=p.digest;I(l,s,r)}}),V.length||U()}function G(){bQ(L.revs_limit,j,B,k,F,O,K,E)}function M(h){function g(){++i===j.length&&h()}if(!j.length){return h()}var i=0;j.forEach(function(l){if(l._id&&ds(l._id)){return g()}var m=l.metadata.id;F.executeSql("SELECT json FROM "+aX+" WHERE id = ?",[m],function(p,n){if(n.rows.length){var s=cc(n.rows.item(0).json);k.set(m,s)}g()})})}function I(i,g,l){var h="SELECT digest FROM "+fv+" WHERE digest=?";F.executeSql(h,[i],function(n,m){return m.rows.length?l():(h="INSERT INTO "+fv+" (digest, body, escaped) VALUES (?,?,1)",void n.executeSql(h,[i,cO(g)],function(){l()},function(){return l(),!1}))})}var C=E.new_edits,q=z.docs,j=q.map(function(h){if(h._id&&ds(h._id)){return h}var g=dF(h,C);return g}),Q=j.filter(function(g){return g.error});if(Q.length){return P(Q[0])}var F,J,O=new Array(j.length),k=new cA.Map;e1(j,"binary",function(g){return g?P(g):void D.transaction(function(h){F=h,N(function(i){i?J=i:M(G)})},c5(P),A)})}function fl(g){return g.websql(g.name,g.version,g.description,g.size)}function aK(h){try{return{db:fl(h)}}catch(g){return{error:g}}}function cZ(h){var g=a8.get(h.name);return g||(g=aK(h),a8.set(h.name,g),g.db&&(g.db._sqlitePlugin="undefined"!=typeof sqlitePlugin)),g}function dK(l,q,j,g,h){function k(){++p===v.length&&h&&h()}function m(r,u){var i=r._attachments[u],n={binary:q.binary,ctx:g};j._getAttachment(r._id,u,i,n,function(o,s){r._attachments[u]=bS.extend(eR(i,["digest","content_type"]),{data:s}),k()})}var v=Object.keys(l._attachments||{});if(!v.length){return h&&h()}var p=0;v.forEach(function(i){q.attachments&&q.include_docs?m(l,i):(l._attachments[i].stub=!0,k())})}function a6(O,B){function I(){eI()&&(window.localStorage["_pouch__websqldb_"+M._name]=!0),B(null,M)}function D(h,g){h.executeSql(fU),h.executeSql("ALTER TABLE "+d8+" ADD COLUMN deleted TINYINT(1) DEFAULT 0",[],function(){h.executeSql(cv),h.executeSql("ALTER TABLE "+aX+" ADD COLUMN local TINYINT(1) DEFAULT 0",[],function(){h.executeSql("CREATE INDEX IF NOT EXISTS 'doc-store-local-idx' ON "+aX+" (local, id)");var i="SELECT "+aX+".winningseq AS seq, "+aX+".json AS metadata FROM "+d8+" JOIN "+aX+" ON "+d8+".seq = "+aX+".winningseq";h.executeSql(i,[],function(y,S){for(var w=[],E=[],q=0;q<S.rows.length;q++){var k=S.rows.item(q),v=k.seq,p=JSON.parse(k.metadata);cb(p)&&w.push(v),ds(p.id)&&E.push(p.id)}y.executeSql("UPDATE "+aX+"SET local = 1 WHERE id IN "+bm(E.length),E,function(){y.executeSql("UPDATE "+d8+" SET deleted = 1 WHERE seq IN "+bm(w.length),w,g)})})})})}function H(h,g){var i="CREATE TABLE IF NOT EXISTS "+aM+" (id UNIQUE, rev, json)";h.executeSql(i,[],function(){var k="SELECT "+aX+".id AS id, "+d8+".json AS data FROM "+d8+" JOIN "+aX+" ON "+d8+".seq = "+aX+".winningseq WHERE local = 1";h.executeSql(k,[],function(s,v){function q(){if(!u.length){return g(s)}var r=u.shift(),o=JSON.parse(r.data)._rev;s.executeSql("INSERT INTO "+aM+" (id, rev, json) VALUES (?,?,?)",[r.id,o,r.data],function(n){n.executeSql("DELETE FROM "+aX+" WHERE id=?",[r.id],function(w){w.executeSql("DELETE FROM "+d8+" WHERE seq=?",[r.seq],function(){q()})})})}for(var u=[],p=0;p<v.rows.length;p++){u.push(v.rows.item(p))}q()})})}function K(i,g){function k(p){function o(){if(!p.length){return g(i)}var w=p.shift(),r=au(w.hex,T),n=r.lastIndexOf("::"),v=r.substring(0,n),q=r.substring(n+2),y="UPDATE "+d8+" SET doc_id=?, rev=? WHERE doc_id_rev=?";i.executeSql(y,[v,q,r],function(){o()})}o()}var h="ALTER TABLE "+d8+" ADD COLUMN doc_id";i.executeSql(h,[],function(o){var n="ALTER TABLE "+d8+" ADD COLUMN rev";o.executeSql(n,[],function(p){p.executeSql(dp,[],function(r){var q="SELECT hex(doc_id_rev) as hex FROM "+d8;r.executeSql(q,[],function(v,s){for(var u=[],w=0;w<s.rows.length;w++){u.push(s.rows.item(w))}k(u)})})})})}function R(i,g){function k(o){var p="SELECT COUNT(*) AS cnt FROM "+fv;o.executeSql(p,[],function(v,y){function u(){var r=cD(fK+", "+aX+".id AS id",[aX,d8],bY,null,aX+".id ");r+=" LIMIT "+q+" OFFSET "+s,s+=q,v.executeSql(r,[],function(Y,S){function E(at,ar){var be=V[at]=V[at]||[];-1===be.indexOf(ar)&&be.push(ar)}if(!S.rows.length){return g(Y)}for(var V={},ai=0;ai<S.rows.length;ai++){for(var ao=S.rows.item(ai),an=ga(ao.data,ao.id,ao.rev),ae=Object.keys(an._attachments||{}),X=0;X<ae.length;X++){var U=an._attachments[ae[X]];E(U.digest,ao.seq)}}var Z=[];if(Object.keys(V).forEach(function(ar){var n=V[ar];n.forEach(function(at){Z.push([ar,at])})}),!Z.length){return u()}var W=0;Z.forEach(function(ar){var at="INSERT INTO "+dM+" (digest, seq) VALUES (?,?)";Y.executeSql(at,ar,function(){++W===Z.length&&u()})})})}var w=y.rows.item(0).cnt;if(!w){return g(v)}var s=0,q=10;u()})}var h="CREATE TABLE IF NOT EXISTS "+dM+" (digest, seq INTEGER)";i.executeSql(h,[],function(n){n.executeSql(eQ,[],function(o){o.executeSql(ek,[],k)})})}function C(h,g){var i="ALTER TABLE "+fv+" ADD COLUMN escaped TINYINT(1) DEFAULT 0";h.executeSql(i,[],g)}function z(h,g){var i="ALTER TABLE "+aX+" ADD COLUMN max_seq INTEGER";h.executeSql(i,[],function(k){var o="UPDATE "+aX+" SET max_seq=(SELECT MAX(seq) FROM "+d8+" WHERE doc_id=id)";k.executeSql(o,[],function(p){var q="CREATE UNIQUE INDEX IF NOT EXISTS 'doc-max-seq-idx' ON "+aX+" (max_seq)";p.executeSql(q,[],g)})})}function N(h,g){h.executeSql('SELECT HEX("a") AS hex',[],function(k,o){var i=o.rows.item(0).hex;T=2===i.length?"UTF-8":"UTF-16",g()})}function P(){for(;A.length>0;){var g=A.pop();g(null,Q)}}function L(s,U){if(0===U){var i="CREATE TABLE IF NOT EXISTS "+c1+" (dbid, db_version INTEGER)",u="CREATE TABLE IF NOT EXISTS "+fv+" (digest UNIQUE, escaped TINYINT(1), body BLOB)",r="CREATE TABLE IF NOT EXISTS "+dM+" (digest, seq INTEGER)",o="CREATE TABLE IF NOT EXISTS "+aX+" (id unique, json, winningseq, max_seq INTEGER UNIQUE)",q="CREATE TABLE IF NOT EXISTS "+d8+" (seq INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, json, deleted TINYINT(1), doc_id, rev)",g="CREATE TABLE IF NOT EXISTS "+aM+" (id UNIQUE, rev, json)";s.executeSql(u),s.executeSql(g),s.executeSql(r,[],function(){s.executeSql(ek),s.executeSql(eQ)}),s.executeSql(o,[],function(){s.executeSql(fU),s.executeSql(q,[],function(){s.executeSql(cv),s.executeSql(dp),s.executeSql(i,[],function(){var h="INSERT INTO "+c1+" (db_version, dbid) VALUES (?,?)";Q=fB();var p=[c7,Q];s.executeSql(h,p,function(){P()})})})})}else{var S=function(){var p=c7>U;p&&s.executeSql("UPDATE "+c1+" SET db_version = "+c7);var h="SELECT dbid FROM "+c1;s.executeSql(h,[],function(v,n){Q=n.rows.item(0).dbid,P()})},w=[D,H,K,R,C,z,S],E=U,k=function(h){w[E-1](h,k),E++};k(s)}}function G(){F.transaction(function(g){N(g,function(){x(g)})},c5(B),I)}function x(h){var g="SELECT sql FROM sqlite_master WHERE tbl_name = "+c1;h.executeSql(g,[],function(k,i){i.rows.length?/db_version/.test(i.rows.item(0).sql)?k.executeSql("SELECT db_version FROM "+c1,[],function(p,o){var q=o.rows.item(0).db_version;L(p,q)}):k.executeSql("ALTER TABLE "+c1+" ADD COLUMN db_version INTEGER",[],function(){L(k,1)}):L(k,0)})}function l(h,g){if(-1!==M._docCount){return g(M._docCount)}var i=cD("COUNT("+aX+".id) AS 'num'",[aX,d8],bY,d8+".deleted=0");h.executeSql(i,[],function(k,o){M._docCount=o.rows.item(0).num,g(M._docCount)})}var T,M=this,Q=null,m=aV(O),A=[];M._docCount=-1,M._name=O.name;var j=bS.extend({},O,{version:al,description:O.name,size:m}),J=cZ(j);if(J.error){return c5(B)(J.error)}var F=J.db;"function"!=typeof F.readTransaction&&(F.readTransaction=F.transaction),G(),M.type=function(){return"websql"},M._id=eK(function(g){g(null,Q)}),M._info=function(g){F.readTransaction(function(h){l(h,function(k){var i="SELECT MAX(seq) AS seq FROM "+d8;h.executeSql(i,[],function(n,p){var q=p.rows.item(0).seq||0;g(null,{doc_count:k,update_seq:q,sqlite_plugin:F._sqlitePlugin,websql_encoding:T})})})},c5(g))},M._bulkDocs=function(g,i,h){d5(O,g,i,M,F,dX,h)},M._get=function(q,E,k){function g(){k(w,{doc:h,metadata:p,ctx:S})}var h,p,w,S=E.ctx;if(!S){return F.readTransaction(function(i){M._get(q,bS.extend({ctx:i},E),k)})}var y,v;E.rev?(y=cD(fK,[aX,d8],aX+".id="+d8+".doc_id",[d8+".doc_id=?",d8+".rev=?"]),v=[q,E.rev]):(y=cD(fK,[aX,d8],bY,aX+".id=?"),v=[q]),S.executeSql(y,v,function(o,r){if(!r.rows.length){return w=eu(fq,"missing"),g()}var i=r.rows.item(0);return p=cc(i.metadata),i.deleted&&!E.rev?(w=eu(fq,"deleted"),g()):(h=ga(i.data,p.id,i.rev),void g())})},M._allDocs=function(E,X){var p,g=[],k="startkey" in E?E.startkey:!1,v="endkey" in E?E.endkey:!1,V="key" in E?E.key:!1,Y="descending" in E?E.descending:!1,W="limit" in E?E.limit:-1,U="skip" in E?E.skip:0,y=E.inclusive_end!==!1,q=[],S=[];if(V!==!1){S.push(aX+".id = ?"),q.push(V)}else{if(k!==!1||v!==!1){if(k!==!1&&(S.push(aX+".id "+(Y?"<=":">=")+" ?"),q.push(k)),v!==!1){var w=Y?">":"<";y&&(w+="="),S.push(aX+".id "+w+" ?"),q.push(v)}V!==!1&&(S.push(aX+".id = ?"),q.push(V))}}"ok"!==E.deleted&&S.push(d8+".deleted = 0"),F.readTransaction(function(h){l(h,function(r){if(p=r,0!==W){var n=cD(fK,[aX,d8],bY,S,aX+".id "+(Y?"DESC":"ASC"));n+=" LIMIT "+W+" OFFSET "+U,h.executeSql(n,q,function(bn,ae){for(var Z=0,an=ae.rows.length;an>Z;Z++){var at=ae.rows.item(Z),bo=cc(at.metadata),be=bo.id,ar=ga(at.data,be,at.rev),ao=ar._rev,ai={id:be,key:be,value:{rev:ao}};if(E.include_docs&&(ai.doc=ar,ai.doc._rev=ao,E.conflicts&&(ai.doc._conflicts=fu(bo)),dK(ai.doc,E,M,bn)),at.deleted){if("ok"!==E.deleted){continue}ai.value.deleted=!0,ai.doc=null}g.push(ai)}})}})},c5(X),function(){X(null,{total_rows:p,offset:E.skip,rows:g})})},M._changes=function(u){function k(){var V=aX+".json AS metadata, "+aX+".max_seq AS maxSeq, "+d8+".json AS winningDoc, "+d8+".rev AS winningRev ",o=aX+" JOIN "+d8,U=aX+".id="+d8+".doc_id AND "+aX+".winningseq="+d8+".seq",S=["maxSeq > ?"],y=[u.since];u.doc_ids&&(S.push(aX+".id IN "+bm(u.doc_ids.length)),y=y.concat(u.doc_ids));var r="maxSeq "+(q?"DESC":"ASC"),E=cD(V,o,U,S,r),s=fj(u);u.view||u.filter||(E+=" LIMIT "+v);var i=u.since||0;F.readTransaction(function(n){n.executeSql(E,y,function(at,X){function W(be){return function(){u.onChange(be)}}for(var ar=0,ai=X.rows.length;ai>ar;ar++){var Z=X.rows.item(ar),Y=cc(Z.metadata);i=Z.maxSeq;var ae=ga(Z.winningDoc,Y.id,Z.winningRev),ao=u.processChange(ae,Y,u);ao.seq=Z.maxSeq;var an=s(ao);if("object"==typeof an){return u.complete(an)}if(an&&(p++,h&&g.push(ao),u.attachments&&u.include_docs?dK(ae,u,M,at,W(ao)):W(ao)()),p===v){break}}})},c5(u.complete),function(){u.continuous||u.complete(null,{results:g,last_seq:i})})}if(u=eX(u),u.continuous){var w=M._name+":"+fB();return dX.addListener(M._name,w,M,u),dX.notify(M._name),{cancel:function(){dX.removeListener(M._name,w)}}}var q=u.descending;u.since=u.since&&!q?u.since:0;var v="limit" in u?u.limit:-1;0===v&&(v=1);var h;h="return_docs" in u?u.return_docs:"returnDocs" in u?u.returnDocs:!0;var g=[],p=0;k()},M._close=function(g){g()},M._getAttachment=function(q,E,k,g,h){var p,w=g.ctx,S=k.digest,y=k.content_type,v="SELECT escaped, CASE WHEN escaped = 1 THEN body ELSE HEX(body) END AS body FROM "+fv+" WHERE digest=?";w.executeSql(v,[S],function(r,o){var s=o.rows.item(0),i=s.escaped?cV(s.body):au(s.body,T);p=g.binary?aO(i,y):aG(i),h(null,p)})},M._getRevisionTree=function(h,g){F.readTransaction(function(k){var i="SELECT json AS metadata FROM "+aX+" WHERE id = ?";k.executeSql(i,[h],function(p,q){if(q.rows.length){var o=cc(q.rows.item(0).metadata);g(null,o.rev_tree)}else{g(eu(fq))}})})},M._doCompaction=function(h,g,i){return g.length?void F.transaction(function(o){var k="SELECT json AS metadata FROM "+aX+" WHERE id = ?";o.executeSql(k,[h],function(u,q){var s=cc(q.rows.item(0).metadata);fg(s.rev_tree,function(E,U,y,S,w){var v=U+"-"+y;-1!==g.indexOf(v)&&(w.status="missing")});var p="UPDATE "+aX+" SET json = ? WHERE id = ?";u.executeSql(p,[df(s),h])}),dz(g,h,o)},c5(i),function(){i()}):i()},M._getLocal=function(h,g){F.readTransaction(function(k){var i="SELECT json, rev FROM "+aM+" WHERE id=?";k.executeSql(i,[h],function(u,q){if(q.rows.length){var s=q.rows.item(0),p=ga(s.json,h,s.rev);g(null,p)}else{g(eu(fq))}})})},M._putLocal=function(q,y,k){function g(n){var i,o;p?(i="UPDATE "+aM+" SET rev=?, json=? WHERE id=? AND rev=?",o=[h,w,v,p]):(i="INSERT INTO "+aM+" (id, rev, json) VALUES (?,?,?)",o=[v,h,w]),n.executeSql(i,o,function(u,s){s.rowsAffected?(E={ok:!0,id:v,rev:h},y.ctx&&k(null,E)):k(eu(aL))},function(){return k(eu(aL)),!1})}"function"==typeof y&&(k=y,y={}),delete q._revisions;var h,p=q._rev,v=q._id;h=p?q._rev="0-"+(parseInt(p.split("-")[1],10)+1):q._rev="0-1";var E,w=bH(q);y.ctx?g(y.ctx):F.transaction(g,c5(k),function(){E&&k(null,E)})},M._removeLocal=function(i,g,p){function h(q){var o="DELETE FROM "+aM+" WHERE id=? AND rev=?",n=[i._id,i._rev];q.executeSql(o,n,function(u,s){return s.rowsAffected?(k={ok:!0,id:i._id,rev:"0-0"},void (g.ctx&&p(null,k))):p(eu(fq))})}"function"==typeof g&&(p=g,g={});var k;g.ctx?h(g.ctx):F.transaction(h,c5(p),function(){k&&p(null,k)})},M._destroy=function(h,g){dX.removeAllListeners(M._name),F.transaction(function(k){var i=[aX,d8,fv,c1,aM,dM];i.forEach(function(n){k.executeSql("DROP TABLE IF EXISTS "+n,[])})},c5(g),function(){eI()&&(delete window.localStorage["_pouch__websqldb_"+M._name],delete window.localStorage[M._name]),g(null,{ok:!0})})}}function dU(){try{return openDatabase("_pouch_validate_websql",1,"",1),!0}catch(g){return !1}}function ah(){if("undefined"==typeof indexedDB||null===indexedDB||!/iP(hone|od|ad)/.test(navigator.userAgent)){return !0}var h=eI(),g="_pouch__websqldb_valid_"+navigator.userAgent;if(h&&localStorage[g]){return"1"===localStorage[g]}var i=dU();return h&&(localStorage[g]=i?"1":"0"),i}function cq(){return"undefined"!=typeof SQLitePlugin?!0:"undefined"==typeof openDatabase?!1:ah()}function dk(g){return function(j,m,k,l){if("undefined"!=typeof sqlitePlugin){var h=bS.extend({},g,{name:j,version:m,description:k,size:l});return sqlitePlugin.openDatabase(h)}return openDatabase(j,m,k,l)}}function fR(i,g){var j=dk(i),h=bS.extend({websql:j},i);a6.call(this,h,g)}function eg(g){g.adapter("websql",fR,!0)}function eJ(){for(var i={},g=new bI(function(k,l){i.resolve=k,i.reject=l}),j=new Array(arguments.length),h=0;h<j.length;h++){j[h]=arguments[h]}return i.promise=g,bI.resolve().then(function(){return fetch.apply(null,j)}).then(function(k){i.resolve(k)})["catch"](function(k){i.reject(k)}),i}function bV(l,j){var p,k,m,h=new Headers,g={method:l.method,credentials:"include",headers:h};return l.json&&(h.set("Accept","application/json"),h.set("Content-Type",l.headers["Content-Type"]||"application/json")),l.body&&l.body instanceof Blob?d0(l.body,function(i){g.body=i}):l.body&&l.processData&&"string"!=typeof l.body?g.body=JSON.stringify(l.body):"body" in l?g.body=l.body:g.body=null,Object.keys(l.headers).forEach(function(i){l.headers.hasOwnProperty(i)&&h.set(i,l.headers[i])}),p=eJ(l.url,g),l.timeout>0&&(k=setTimeout(function(){p.reject(new Error("Load timeout for resource: "+l.url))},l.timeout)),p.promise.then(function(i){return m={statusCode:i.status},l.timeout>0&&clearTimeout(k),m.statusCode>=200&&m.statusCode<300?l.binary?i.blob():i.text():i.json()}).then(function(i){m.statusCode>=200&&m.statusCode<300?j(null,m,i):j(i,m)})["catch"](function(i){j(i,m)}),{abort:p.reject}}function fI(l,q){var j,g,h=!1,k=function(){j.abort()},m=function(){h=!0,j.abort()};j=l.xhr?new l.xhr:new XMLHttpRequest;try{j.open(l.method,l.url)}catch(v){q(v,{statusCode:413})}j.withCredentials="withCredentials" in l?l.withCredentials:!0,"GET"===l.method?delete l.headers["Content-Type"]:l.json&&(l.headers.Accept="application/json",l.headers["Content-Type"]=l.headers["Content-Type"]||"application/json",l.body&&l.processData&&"string"!=typeof l.body&&(l.body=JSON.stringify(l.body))),l.binary&&(j.responseType="arraybuffer"),"body" in l||(l.body=null);for(var p in l.headers){l.headers.hasOwnProperty(p)&&j.setRequestHeader(p,l.headers[p])}return l.timeout>0&&(g=setTimeout(m,l.timeout),j.onprogress=function(){clearTimeout(g),4!==j.readyState&&(g=setTimeout(m,l.timeout))},"undefined"!=typeof j.upload&&(j.upload.onprogress=j.onprogress)),j.onreadystatechange=function(){if(4===j.readyState){var w={statusCode:j.status};if(j.status>=200&&j.status<300){var o;o=l.binary?eb([j.response||""],{type:j.getResponseHeader("Content-Type")}):j.responseText,q(null,w,o)}else{var n={};if(h){n=new Error("ETIMEDOUT"),w.statusCode=400}else{try{n=JSON.parse(j.response)}catch(u){}}q(n,w)}}},l.body&&l.body instanceof Blob?d0(l.body,function(i){j.send(i)}):j.send(l.body),{abort:k}}function bL(){try{return new XMLHttpRequest,!0}catch(g){return !1}}function f5(h,g){return bN||h.xhr?fI(h,g):bV(h,g)}function b6(){return""}function c9(i,g){function k(l,q,m){if(!i.binary&&i.json&&"string"==typeof l){try{l=JSON.parse(l)}catch(p){return m(p)}}Array.isArray(l)&&(l=l.map(function(n){return n.error||n.missing?fG(n):n})),i.binary&&f7(l,q),m(null,l,q)}function h(q,m){var u,p;if(q.code&&q.status){var s=new Error(q.message||q.code);return s.status=q.status,m(s)}if(q.message&&"ETIMEDOUT"===q.message){return m(q)}try{u=JSON.parse(q.responseText),p=fG(u)}catch(l){p=fG(q)}m(p)}i=eX(i);var j={method:"GET",headers:{},json:!0,processData:!0,timeout:10000,cache:!1};return i=bS.extend(j,i),i.json&&(i.binary||(i.headers.Accept="application/json"),i.headers["Content-Type"]=i.headers["Content-Type"]||"application/json"),i.binary&&(i.encoding=null,i.json=!1),i.processData||(i.json=!1),f5(i,function(r,n,l){if(r){return r.status=n?n.statusCode:400,h(r,g)}var p,m=n.headers&&n.headers["content-type"],v=l||b6();if(!i.binary&&(i.json||!i.processData)&&"object"!=typeof v&&(/json/.test(m)||/^[\s]*\{/.test(v)&&/\}[\s]*$/.test(v))){try{v=JSON.parse(v.toString())}catch(q){}}n.statusCode>=200&&n.statusCode<300?k(v,n,g):(p=fG(v),p.status=n.statusCode,g(p))})}function cd(l,v){var j=navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",g=-1!==j.indexOf("safari")&&-1===j.indexOf("chrome"),h=-1!==j.indexOf("msie"),k=-1!==j.indexOf("edge"),p=g||(h||k)&&"GET"===l.method,w="cache" in l?l.cache:!0,q=/^blob:/.test(l.url);if(!q&&(p||!w)){var m=-1!==l.url.indexOf("?");l.url+=(m?"&":"?")+"_nonce="+Date.now()}return c9(l,v)}function bA(h){var g=h.doc&&h.doc._attachments;g&&Object.keys(g).forEach(function(i){var j=g[i];j.data=c4(j.data,j.content_type)})}function bg(g){return/^_design/.test(g)?"_design/"+encodeURIComponent(g.slice(8)):/^_local/.test(g)?"_local/"+encodeURIComponent(g.slice(7)):encodeURIComponent(g)}function d4(g){return g._attachments&&Object.keys(g._attachments)?bI.all(Object.keys(g._attachments).map(function(h){var i=g._attachments[h];return i.data&&"string"!=typeof i.data?new bI(function(j){ba(i.data,j)}).then(function(j){i.data=j}):void 0})):bI.resolve()}function a3(h){var g=fc(h);(g.user||g.password)&&(g.auth={username:g.user,password:g.password});var i=g.path.replace(/(^\/|\/$)/g,"").split("/");return g.db=i.pop(),-1===g.db.indexOf("%")&&(g.db=encodeURIComponent(g.db)),g.path=i.join("/"),g}function cm(h,g){return bz(h,h.db+"/"+g)}function bz(h,g){var i=h.path?"/":"";return h.protocol+"://"+h.host+(h.port?":"+h.port:"")+"/"+h.path+i+g}function b5(g){return"?"+Object.keys(g).map(function(h){return h+"="+encodeURIComponent(g[h])}).join("&")}function fP(B,G){function q(l,g,p){var i=l.ajax||{},m=bS.extend(eX(j),i,g);return bj(m.method+" "+m.url),H._ajax(m,p)}function h(i,g){return new bI(function(l,m){q(i,g,function(o,n){return o?m(o):void l(n)})})}function k(i,g){return eW(i,dH(function(l){y().then(function(){return g.apply(this,l)})["catch"](function(m){var o=l.pop();o(m)})}))}function y(){if(B.skipSetup||B.skip_setup){return bI.resolve()}if(z){return z}var g={method:"GET",url:x};return z=h({},g)["catch"](function(i){return i&&i.status&&404===i.status?(eL(404,"PouchDB is just detecting if the remote exists."),h({},{method:"PUT",url:x})):bI.reject(i)})["catch"](function(i){return i&&i.status&&412===i.status?!0:bI.reject(i)}),z["catch"](function(){z=null}),z}function C(g){return g.split("/").map(encodeURIComponent).join("/")}var H=this,F=a3;B.getHost&&(F=B.getHost);var A=F(B.name,B),x=cm(A,"");B=eX(B);var j=B.ajax||{};if(H.getUrl=function(){return x},H.getHeaders=function(){return j.headers||{}},B.auth||A.auth){var E=B.auth||A.auth,D=E.username+":"+E.password,w=aG(unescape(encodeURIComponent(D)));j.headers=j.headers||{},j.headers.Authorization="Basic "+w}H._ajax=cd;var z;setTimeout(function(){G(null,H)}),H.type=function(){return"http"},H.id=k("id",function(g){q({},{method:"GET",url:bz(A,"")},function(i,m){var l=m&&m.uuid?m.uuid+A.db:cm(A,"");g(null,l)})}),H.request=k("request",function(i,g){i.url=cm(A,i.url),q({},i,g)}),H.compact=k("compact",function(i,g){"function"==typeof i&&(g=i,i={}),i=eX(i),q(i,{url:cm(A,"_compact"),method:"POST"},function(){function l(){H.info(function(m,n){n&&!n.compact_running?g(null,{ok:!0}):setTimeout(l,i.interval||200)})}l()})}),H.bulkGet=eW("bulkGet",function(u,m){function p(i){var o={};u.revs&&(o.revs=!0),u.attachments&&(o.attachments=!0),q({},{url:cm(A,"_bulk_get"+b5(o)),method:"POST",body:{docs:u.docs}},i)}function v(){function N(o){return function(O,s){J[o]=s.results,++i===L&&m(null,{results:eO(J)})}}for(var K=db,L=Math.ceil(u.docs.length/K),i=0,J=new Array(L),I=0;L>I;I++){var M=eR(u,["revs","attachments"]);M.ajax=j,M.docs=u.docs.slice(I*K,Math.min(u.docs.length,(I+1)*K)),es(l,M,N(I))}}var l=this,g=bz(A,""),n=cg[g];"boolean"!=typeof n?p(function(o,s){if(o){var i=Math.floor(o.status/100);4===i||5===i?(cg[g]=!1,eL(o.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),v()):m(o)}else{cg[g]=!0,m(null,s)}}):n?p(m):v()}),H._info=function(g){y().then(function(){q({},{method:"GET",url:cm(A,"")},function(i,l){return i?g(i):(l.host=cm(A,""),void g(null,l))})})["catch"](g)},H.get=k("get",function(r,m,I){function v(i){var u=i._attachments,s=u&&Object.keys(u);return u&&s.length?bI.all(s.map(function(K){var n=u[K],J=bg(i._id)+"/"+C(K)+"?rev="+i._rev;return h(m,{method:"GET",url:cm(A,J),binary:!0}).then(function(o){return m.binary?o:new bI(function(L){ba(o,L)})}).then(function(o){delete n.stub,delete n.length,n.data=o})})):void 0}function l(i){return Array.isArray(i)?bI.all(i.map(function(n){return n.ok?v(n.ok):void 0})):v(i)}"function"==typeof m&&(I=m,m={}),m=eX(m);var p={};m.revs&&(p.revs=!0),m.revs_info&&(p.revs_info=!0),m.open_revs&&("all"!==m.open_revs&&(m.open_revs=JSON.stringify(m.open_revs)),p.open_revs=m.open_revs),m.rev&&(p.rev=m.rev),m.conflicts&&(p.conflicts=m.conflicts),r=bg(r);var g={method:"GET",url:cm(A,r+b5(p))};h(m,g).then(function(i){return bI.resolve().then(function(){return m.attachments?l(i):void 0}).then(function(){I(null,i)})})["catch"](I)}),H.remove=k("remove",function(p,m,n,s){var l;"string"==typeof m?(l={_id:p,_rev:m},"function"==typeof n&&(s=n,n={})):(l=p,"function"==typeof m?(s=m,n={}):(s=n,n=m));var g=l._rev||n.rev;q(n,{method:"DELETE",url:cm(A,bg(l._id))+"?rev="+g},s)}),H.getAttachment=k("getAttachment",function(p,l,n,u){"function"==typeof n&&(u=n,n={});var g=n.rev?"?rev="+n.rev:"",m=cm(A,bg(p))+"/"+C(l)+g;q(n,{method:"GET",url:m,binary:!0},u)}),H.removeAttachment=k("removeAttachment",function(n,l,m,p){var g=cm(A,bg(n)+"/"+C(l))+"?rev="+m;q({},{method:"DELETE",url:g},p)}),H.putAttachment=k("putAttachment",function(I,M,g,m,p,N){"function"==typeof p&&(N=p,p=m,m=g,g=null);var L=bg(I)+"/"+C(M),K=cm(A,L);if(g&&(K+="?rev="+g),"string"==typeof m){var n;try{n=bT(m)}catch(J){return N(eu(cs,"Attachment is not a valid base64 string"))}m=n?aO(n,p):""}var v={headers:{"Content-Type":p},method:"PUT",url:K,processData:!1,body:m,timeout:j.timeout||60000};q({},v,N)}),H._bulkDocs=function(l,g,i){l.new_edits=g.new_edits,y().then(function(){return bI.all(l.docs.map(d4))}).then(function(){q(g,{method:"POST",url:cm(A,"_bulk_docs"),body:l},function(n,m){return n?i(n):(m.forEach(function(o){o.ok=!0}),void i(null,m))})})["catch"](i)},H.allDocs=k("allDocs",function(r,m){"function"==typeof r&&(m=r,r={}),r=eX(r);var v,u={},l="GET";r.conflicts&&(u.conflicts=!0),r.descending&&(u.descending=!0),r.include_docs&&(u.include_docs=!0),r.attachments&&(u.attachments=!0),r.key&&(u.key=JSON.stringify(r.key)),r.start_key&&(r.startkey=r.start_key),r.startkey&&(u.startkey=JSON.stringify(r.startkey)),r.end_key&&(r.endkey=r.end_key),r.endkey&&(u.endkey=JSON.stringify(r.endkey)),"undefined"!=typeof r.inclusive_end&&(u.inclusive_end=!!r.inclusive_end),"undefined"!=typeof r.limit&&(u.limit=r.limit),"undefined"!=typeof r.skip&&(u.skip=r.skip);var g=b5(u);if("undefined"!=typeof r.keys){var p="keys="+encodeURIComponent(JSON.stringify(r.keys));p.length+g.length+1<=bD?g+="&"+p:(l="POST",v={keys:r.keys})}h(r,{method:l,url:cm(A,"_all_docs"+g),body:v}).then(function(i){r.include_docs&&r.attachments&&r.binary&&i.rows.forEach(bA),m(null,i)})["catch"](m)}),H._changes=function(L){var S="batch_size" in L?L.batch_size:b9;L=eX(L),L.timeout="timeout" in L?L.timeout:"timeout" in j?j.timeout:30000;var i,n=L.timeout?{timeout:L.timeout-5000}:{},O="undefined"!=typeof L.limit?L.limit:!1;i="return_docs" in L?L.return_docs:"returnDocs" in L?L.returnDocs:!0;var T=O;if(L.style&&(n.style=L.style),(L.include_docs||L.filter&&"function"==typeof L.filter)&&(n.include_docs=!0),L.attachments&&(n.attachments=!0),L.continuous&&(n.feed="longpoll"),L.conflicts&&(n.conflicts=!0),L.descending&&(n.descending=!0),"heartbeat" in L?L.heartbeat&&(n.heartbeat=L.heartbeat):n.heartbeat=10000,L.filter&&"string"==typeof L.filter&&(n.filter=L.filter),L.view&&"string"==typeof L.view&&(n.filter="_view",n.view=L.view),L.query_params&&"object"==typeof L.query_params){for(var R in L.query_params){L.query_params.hasOwnProperty(R)&&(n[R]=L.query_params[R])}}var I,M="GET";if(L.doc_ids){n.filter="_doc_ids";var J=JSON.stringify(L.doc_ids);J.length<bD?n.doc_ids=J:(M="POST",I={doc_ids:L.doc_ids})}var Q,N,P=function(l,g){if(!L.aborted){n.since=l,"object"==typeof n.since&&(n.since=JSON.stringify(n.since)),L.descending?O&&(n.limit=T):n.limit=!O||T>S?S:T;var m={method:M,url:cm(A,"_changes"+b5(n)),timeout:L.timeout,body:I};N=l,L.aborted||y().then(function(){Q=q(L,m,g)})["catch"](g)}},p={results:[]},K=function(s,m){if(!L.aborted){var l=0;if(m&&m.results){l=m.results.length,p.last_seq=m.last_seq;var g={};g.query=L.query_params,m.results=m.results.filter(function(o){T--;var u=fj(L)(o);return u&&(L.include_docs&&L.attachments&&L.binary&&bA(o),i&&p.results.push(o),L.onChange(o)),u})}else{if(s){return L.aborted=!0,void L.complete(s)}}m&&m.last_seq&&(N=m.last_seq);var r=O&&0>=T||m&&S>l||L.descending;(!L.continuous||O&&0>=T)&&r?L.complete(null,p):setTimeout(function(){P(N,K)},0)}};return P(L.since||0,K),{cancel:function(){L.aborted=!0,Q&&Q.abort()}}},H.revsDiff=k("revsDiff",function(l,g,i){"function"==typeof g&&(i=g,g={}),q(g,{method:"POST",url:cm(A,"_revs_diff"),body:l},i)}),H._close=function(g){g()},H._destroy=function(i,g){q(i,{url:cm(A,""),method:"DELETE"},function(l,m){return l&&l.status&&404!==l.status?g(l):void g(null,m)})}}function bf(g){g.adapter("http",fP,!1),g.adapter("https",fP,!1)}function aS(){this.promise=new bI(function(g){g()})}function eG(m){var j=m.db,q=m.viewName,l=m.map,p=m.reduce,h=m.temporary,g=l.toString()+(p&&p.toString())+"undefined";if(!h&&j._cachedViews){var k=j._cachedViews[g];if(k){return bI.resolve(k)}}return j.info().then(function(o){function n(v){v.views=v.views||{};var s=q;-1===s.indexOf("/")&&(s=q+"/"+q);var u=v.views[s]=v.views[s]||{};if(!u[i]){return u[i]=!0,v}}var i=o.db_name+"-mrview-"+(h?"temp":ep(g));return fk(j,"_local/mrviews",n).then(function(){return j.registerDependentDatabase(i).then(function(u){var v=u.db;v.auto_compaction=!0;var r={name:i,db:v,sourceDB:j,adapter:j.adapter,mapFun:l,reduceFun:p};return r.db.get("_local/lastSeq")["catch"](function(s){if(404!==s.status){throw s}}).then(function(s){return r.seq=s?s.seq:0,h||(j._cachedViews=j._cachedViews||{},j._cachedViews[g]=r,r.db.once("destroyed",function(){delete j._cachedViews[g]})),r})})})})}function dT(k,h,m,j,l,g){return av("return ("+k.replace(/;\s*$/,"")+");",{emit:h,sum:m,log:j,isArray:l,toJSON:g})}function cN(g){return -1===g.indexOf("/")?[g,g]:g.split("/")}function ef(g){return 1===g.length&&/^1-/.test(g[0].rev)}function dy(h,g){try{h.emit("error",g)}catch(i){ev("error","The user's map/reduce function threw an uncaught error.\nYou can debug this error by doing:\nmyDatabase.on('error', function (err) { debugger; });\nPlease double-check your map/reduce function."),ev("error",g)}}function bU(i,g,j){try{return{output:g.apply(null,j)}}catch(h){return dy(i,h),{error:h}}}function aH(h,g){var i=cW.collate(h.key,g.key);return 0!==i?i:cW.collate(h.value,g.value)}function f2(h,g,i){return i=i||0,"number"==typeof g?h.slice(i,g+i):i>0?h.slice(i):h}function af(h){var g=h.value,i=g&&"object"==typeof g&&g._id||h.id;return i}function cC(g){g.rows.forEach(function(i){var h=i.doc&&i.doc._attachments;h&&Object.keys(h).forEach(function(j){var k=h[j];h[j].data=c4(k.data,k.content_type)})})}function dJ(g){return function(h){return g.include_docs&&g.attachments&&g.binary&&cC(h),h}}function fh(h){var g="builtin "+h+" function requires map values to be numbers or number arrays";return new eT(g)}function ax(m){for(var j=0,q=0,l=m.length;l>q;q++){var p=m[q];if("number"!=typeof p){if(!Array.isArray(p)){throw fh("_sum")}j="number"==typeof j?[j]:j;for(var h=0,g=p.length;g>h;h++){var k=p[h];if("number"!=typeof k){throw fh("_sum")}"undefined"==typeof j[h]?j.push(k):j[h]+=k}}else{"number"==typeof j?j+=p:j[0]+=p}}return j}function aC(i,g,k,h){var j=g[i];"undefined"!=typeof j&&(h&&(j=encodeURIComponent(JSON.stringify(j))),k.push(i+"="+j))}function cS(h){if("undefined"!=typeof h){var g=Number(h);return isNaN(g)||g!==parseInt(h,10)?h:g}}function cY(g){return g.group_level=cS(g.group_level),g.limit=cS(g.limit),g.skip=cS(g.skip),g}function bK(g){if(g){if("number"!=typeof g){return new fV('Invalid value for integer: "'+g+'"')}if(0>g){return new fV('Invalid value for positive integer: "'+g+'"')}}}function aa(i,g){var j=i.descending?"endkey":"startkey",h=i.descending?"startkey":"endkey";if("undefined"!=typeof i[j]&&"undefined"!=typeof i[h]&&cW.collate(i[j],i[h])>0){throw new fV("No rows can match your key range, reverse your start_key and end_key or set {descending : true}")}if(g.reduce&&i.reduce!==!1){if(i.include_docs){throw new fV("{include_docs:true} is invalid for reduce")}if(i.keys&&i.keys.length>1&&!i.group&&!i.group_level){throw new fV("Multi-key fetches for reduce views must use {group: true}")}}["group_level","limit","skip"].forEach(function(k){var l=bK(i[k]);if(l){throw l}})}function bs(l,q,j){var g,h=[],k="GET";if(aC("reduce",j,h),aC("include_docs",j,h),aC("attachments",j,h),aC("limit",j,h),aC("descending",j,h),aC("group",j,h),aC("group_level",j,h),aC("skip",j,h),aC("stale",j,h),aC("conflicts",j,h),aC("startkey",j,h,!0),aC("start_key",j,h,!0),aC("endkey",j,h,!0),aC("end_key",j,h,!0),aC("inclusive_end",j,h),aC("key",j,h,!0),h=h.join("&"),h=""===h?"":"?"+h,"undefined"!=typeof j.keys){var m=2000,v="keys="+encodeURIComponent(JSON.stringify(j.keys));v.length+h.length+1<=m?h+=("?"===h[0]?"&":"?")+v:(k="POST","string"==typeof q?g={keys:j.keys}:q.keys=j.keys)}if("string"==typeof q){var p=cN(q);return l.request({method:k,url:"_design/"+p[0]+"/_view/"+p[1]+h,body:g}).then(dJ(j))}return g=g||{},Object.keys(q).forEach(function(i){Array.isArray(q[i])?g[i]=q[i]:g[i]=q[i].toString()}),l.request({method:"POST",url:"_temp_view"+h,body:g}).then(dJ(j))}function cH(h,g,i){return new bI(function(j,k){h._query(g,i,function(m,l){return m?k(m):void j(l)})})}function dD(g){return new bI(function(h,i){g._viewCleanup(function(k,j){return k?i(k):void h(j)})})}function c8(g){return function(h){if(404===h.status){return g}throw h}}function aY(m,w,j){function g(){return ef(l)?bI.resolve(x):w.db.get(q)["catch"](c8(x))}function h(i){return i.keys.length?w.db.allDocs({keys:i.keys,include_docs:!0}):bI.resolve({rows:[]})}function k(D,G){for(var A=[],y={},z=0,B=G.rows.length;B>z;z++){var E=G.rows[z],H=E.doc;if(H&&(A.push(H),y[H._id]=!0,H._deleted=!p[H._id],!H._deleted)){var F=p[H._id];"value" in F&&(H.value=F.value)}}var C=Object.keys(p);return C.forEach(function(n){if(!y[n]){var i={_id:n},r=p[n];"value" in r&&(i.value=r.value),A.push(i)}}),D.keys=b8(C.concat(D.keys)),A.push(D),A}var q="_local/doc_"+m,x={_id:q,keys:[]},v=j[m],p=v.indexableKeysToKeyValues,l=v.changes;return g().then(function(i){return h(i).then(function(n){return k(i,n)})})}function d9(i,g,j){var h="_local/lastSeq";return i.db.get(h)["catch"](c8({_id:h,seq:0})).then(function(k){var l=Object.keys(g);return bI.all(l.map(function(m){return aY(m,i,g)})).then(function(m){var n=eO(m);return k.seq=j,n.push(k),i.db.bulkDocs({docs:n})})})}function fy(h){var g="string"==typeof h?h:h.name,i=dm[g];return i||(i=dm[g]=new aS),i}function aN(g){return bC(fy(g),function(){return c2(g)})()}function c2(l){function q(o,i){var r={id:h._id,key:cW.normalizeKey(o)};"undefined"!=typeof i&&null!==i&&(r.value=cW.normalizeKey(i)),g.push(r)}function j(i,o){return function(){return d9(l,i,o)}}var g,h,k;if("function"==typeof l.mapFun&&2===l.mapFun.length){var m=l.mapFun;k=function(i){return m(i,q)}}else{k=dT(l.mapFun.toString(),q,ax,aT,Array.isArray,JSON.parse)}var v=l.seq||0,p=new aS;return new bI(function(n,i){function r(){p.finish().then(function(){l.seq=v,n()})}function o(){function s(u){i(u)}l.sourceDB.changes({conflicts:!0,include_docs:!0,style:"all_docs",since:v,limit:bi}).on("complete",function(J){var F=J.results;if(!F.length){return r()}for(var z={},C=0,A=F.length;A>C;C++){var u=F[C];if("_"!==u.doc._id[0]){g=[],h=u.doc,h._deleted||bU(l.sourceDB,k,[h]),g.sort(aH);for(var I,E={},H=0,x=g.length;x>H;H++){var B=g[H],D=[B.key,B.id];0===cW.collate(B.key,I)&&D.push(H);var G=cW.toIndexableString(D);E[G]=B,I=B.key}z[u.doc._id]={indexableKeysToKeyValues:E,changes:u.changes}}v=u.seq}return p.add(j(z,v)),F.length<bi?r():o()}).on("error",s)}o()})}function dN(m,w,j){0===j.group_level&&delete j.group_level;var g,h=j.group||j.group_level;g=eN[m.reduceFun]?eN[m.reduceFun]:dT(m.reduceFun.toString(),null,ax,aT,Array.isArray,JSON.parse);var k=[],q=isNaN(j.group_level)?Number.POSITIVE_INFINITY:j.group_level;w.forEach(function(o){var i=k[k.length-1],r=h?o.key:null;return h&&Array.isArray(r)&&(r=r.slice(0,q)),i&&0===cW.collate(i.groupKey,r)?(i.keys.push([o.key,o.id]),void i.values.push(o.value)):void k.push({keys:[[o.key,o.id]],values:[o.value],groupKey:r})}),w=[];for(var x=0,v=k.length;v>x;x++){var p=k[x],l=bU(m.sourceDB,g,[p.keys,p.values,!1]);if(l.error&&l.error instanceof eT){throw l.error}w.push({value:l.error?null:l.output,key:p.groupKey})}return{rows:f2(w,j.limit,j.skip)}}function a9(h,g){return bC(fy(h),function(){return dY(h,g)})()}function dY(q,z){function j(i){return i.include_docs=!0,q.db.allDocs(i).then(function(l){return h=l.total_rows,l.rows.map(function(u){if("value" in u.doc&&"object"==typeof u.doc.value&&null!==u.doc.value){var o=Object.keys(u.doc.value).sort(),B=["id","key","value"];if(!(B>o||o>B)){return u.doc.value}}var s=cW.parseIndexableString(u.doc._id);return{key:s[0],id:s[1],value:"value" in u.doc?u.doc.value:null}})})}function g(o){var l;if(l=m?dN(q,o,z):{total_rows:h,offset:x,rows:o},z.include_docs){var i=b8(o.map(af));return q.sourceDB.allDocs({keys:i,include_docs:!0,conflicts:z.conflicts,attachments:z.attachments,binary:z.binary}).then(function(r){var n={};return r.rows.forEach(function(s){s.doc&&(n["$"+s.id]=s.doc)}),o.forEach(function(u){var B=af(u),s=n["$"+B];s&&(u.doc=s)}),l})}return l}var h,m=q.reduceFun&&z.reduce!==!1,x=z.skip||0;if("undefined"==typeof z.keys||z.keys.length||(z.limit=0,delete z.keys),"undefined"!=typeof z.keys){var A=z.keys,y=A.map(function(l){var i={startkey:cW.toIndexableString([l]),endkey:cW.toIndexableString([l,{}])};return j(i)});return bI.all(y).then(eO).then(g)}var w={descending:z.descending};if(z.start_key&&(z.startkey=z.start_key),z.end_key&&(z.endkey=z.end_key),"undefined"!=typeof z.startkey&&(w.startkey=z.descending?cW.toIndexableString([z.startkey,{}]):cW.toIndexableString([z.startkey])),"undefined"!=typeof z.endkey){var p=z.inclusive_end!==!1;z.descending&&(p=!p),w.endkey=cW.toIndexableString(p?[z.endkey,{}]:[z.endkey])}if("undefined"!=typeof z.key){var k=cW.toIndexableString([z.key]),v=cW.toIndexableString([z.key,{}]);w.descending?(w.endkey=k,w.startkey=v):(w.startkey=k,w.endkey=v)}return m||("number"==typeof z.limit&&(w.limit=z.limit),w.skip=x),j(w).then(g)}function am(g){return g.request({method:"POST",url:"_view_cleanup"})}function cw(g){return g.get("_local/mrviews").then(function(h){var j={};Object.keys(h.views).forEach(function(m){var k=cN(m),l="_design/"+k[0],n=k[1];j[l]=j[l]||{},j[l][n]=!0});var i={keys:Object.keys(j),include_docs:!0};return g.allDocs(i).then(function(m){var n={};m.rows.forEach(function(p){var o=p.key.substring(8);Object.keys(j[p.key]).forEach(function(v){var r=o+"/"+v;h.views[r]||(r=v);var q=Object.keys(h.views[r]),u=p.doc&&p.doc.views&&p.doc.views[v];q.forEach(function(s){n[s]=n[s]||u})})});var l=Object.keys(n).filter(function(o){return !n[o]}),k=l.map(function(o){return bC(fy(o),function(){return new g.constructor(o,g.__opts).destroy()})()});return bI.all(k).then(function(){return{ok:!0}})})},c8({ok:!0}))}function dq(n,k,m){if("http"===n.type()){return bs(n,k,m)}if("function"==typeof n._query){return cH(n,k,m)}if("string"!=typeof k){aa(m,k);var p={db:n,viewName:"temp_view/temp_view",map:k.map,reduce:k.reduce,temporary:!0};return fT.add(function(){return eG(p).then(function(o){function i(){return o.db.destroy()}return cu(aN(o).then(function(){return a9(o,m)}),i)})}),fT.finish()}var j=k,g=cN(j),l=g[0],h=g[1];return n.get("_design/"+l).then(function(q){var r=q.views&&q.views[h];if(!r||"string"!=typeof r.map){throw new el("ddoc "+l+" has no view named "+h)}aa(m,r);var i={db:n,viewName:j,map:r.map,reduce:r.reduce};return eG(i).then(function(o){return"ok"===m.stale||"update_after"===m.stale?("update_after"===m.stale&&eH.nextTick(function(){aN(o)}),a9(o,m)):aN(o).then(function(){return a9(o,m)})})})}function fV(h){this.status=400,this.name="query_parse_error",this.message=h,this.error=!0;try{Error.captureStackTrace(this,fV)}catch(g){}}function el(h){this.status=404,this.name="not_found",this.message=h,this.error=!0;try{Error.captureStackTrace(this,el)}catch(g){}}function eT(h){this.status=500,this.name="invalid_value",this.message=h,this.error=!0;try{Error.captureStackTrace(this,eT)}catch(g){}}function bZ(g){return/^1-/.test(g)}function fL(h,g,i){return !h._attachments||!h._attachments[i]||h._attachments[i].digest!==g._attachments[i].digest}function bO(h,g){var i=Object.keys(g._attachments);return bI.all(i.map(function(j){return h.getAttachment(g._id,j,{rev:g._rev})}))}function f8(i,g,k){var h="http"===g.type()&&"http"!==i.type(),j=Object.keys(k._attachments);return h?i.get(k._id).then(function(l){return bI.all(j.map(function(m){return fL(l,k,m)?g.getAttachment(k._id,m):i.getAttachment(l._id,m)}))})["catch"](function(l){if(404!==l.status){throw l}return bO(g,k)}):bO(g,k)}function ca(h){var g=[];return Object.keys(h).forEach(function(j){var i=h[j].missing;i.forEach(function(k){g.push({id:j,rev:k})})}),{docs:g,revs:!0}}function dc(q,x,j,g){function h(){var i=ca(j);if(i.docs.length){return q.bulkGet(i).then(function(l){if(g.cancelled){throw new Error("cancelled")}return bI.all(l.results.map(function(o){return bI.all(o.docs.map(function(u){var s=u.ok;return u.error&&(k=!1),s&&s._attachments?f8(x,q,s).then(function(r){var n=Object.keys(s._attachments);return r.forEach(function(z,B){var A=s._attachments[n[B]];delete A.stub,delete A.length,A.data=z}),s}):s}))})).then(function(n){p=p.concat(eO(n).filter(Boolean))})})}}function m(i){return i._attachments&&Object.keys(i._attachments).length>0}function v(i){return q.allDocs({keys:i,include_docs:!0}).then(function(l){if(g.cancelled){throw new Error("cancelled")}l.rows.forEach(function(n){!n.deleted&&n.doc&&bZ(n.value.rev)&&!m(n.doc)&&(p.push(n.doc),delete j[n.id])})})}function y(){var i=Object.keys(j).filter(function(n){var l=j[n].missing;return 1===l.length&&bZ(l[0])});return i.length>0?v(i):void 0}function w(){return{ok:k,docs:p}}j=eX(j);var p=[],k=!0;return bI.resolve().then(y).then(h).then(w)}function ch(i,g,k,h,j){return i.get(g)["catch"](function(l){if(404===l.status){return"http"===i.type()&&eL(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:h,_id:g,history:[],replicator:bX,version:dB}}throw l}).then(function(l){return j.cancelled?void 0:(l.history=(l.history||[]).filter(function(m){return m.session_id!==h}),l.history.unshift({last_seq:k,session_id:h}),l.history=l.history.slice(0,aI),l.version=dB,l.replicator=bX,l.session_id=h,l.last_seq=k,i.put(l)["catch"](function(m){if(409===m.status){return ch(i,g,k,h,j)}throw m}))})}function bE(i,g,j,h){this.src=i,this.target=g,this.id=j,this.returnValue=h}function bk(h,g){return h.session_id===g.session_id?{last_seq:h.last_seq,history:h.history}:d2(h.history,g.history)}function d2(m,j){var q=m[0],l=m.slice(1),p=j[0],h=j.slice(1);if(!q||0===j.length){return{last_seq:f3,history:[]}}var g=q.session_id;if(a1(g,j)){return{last_seq:q.last_seq,history:m}}var k=p.session_id;return a1(k,l)?{last_seq:p.last_seq,history:h}:d2(l,h)}function a1(i,g){var j=g[0],h=g.slice(1);return i&&0!==g.length?i===j.session_id?!0:a1(i,h):!1}function ck(g){return"number"==typeof g.status&&4===Math.floor(g.status/100)}function bx(i,g,j,h){return i.retry===!1?(g.emit("error",j),void g.removeAllListeners()):("function"!=typeof i.back_off_function&&(i.back_off_function=fb),g.emit("requestError",j),"active"!==g.state&&"pending"!==g.state||(g.emit("paused",j),g.state="stopped",g.once("active",function(){i.current_back_off=cF})),i.current_back_off=i.current_back_off||cF,i.current_back_off=i.back_off_function(i.current_back_off),void setTimeout(h,i.current_back_off))}function b3(g){return Object.keys(g).sort(cW.collate).reduce(function(h,i){return h[i]=g[i],h},{})}function dh(l,j,p){var k=p.doc_ids?p.doc_ids.sort(cW.collate):"",m=p.filter?p.filter.toString():"",h="",g="";return p.filter&&p.query_params&&(h=JSON.stringify(b3(p.query_params))),p.filter&&"_view"===p.filter&&(g=p.view.toString()),bI.all([l.id(),j.id()]).then(function(n){var i=n[0]+n[1]+m+g+h+k;return new bI(function(o){fY(i,o)})}).then(function(i){return i=i.replace(/\//g,".").replace(/\+/g,"_"),"_local/"+i})}function fN(dn,ar,bt,be,br){function cr(){return G?bI.resolve():dh(dn,ar,bt).then(function(g){Q=g,G=new bE(dn,ar,Q,be)})}function ee(){if(X=[],0!==ai.docs.length){var g=ai.docs;return ar.bulkDocs({docs:g,new_edits:!1}).then(function(k){if(be.cancelled){throw bo(),new Error("cancelled")}var m=[],j={};k.forEach(function(i){i.error&&(br.doc_write_failures++,m.push(i),j[i.id]=i)}),J=J.concat(m),br.docs_written+=ai.docs.length-m.length;var h=m.filter(function(i){return"unauthorized"!==i.name&&"forbidden"!==i.name});if(g.forEach(function(n){var i=j[n._id];i?be.emit("denied",eX(i)):X.push(n)}),h.length>0){var l=new Error("bulkDocs error");throw l.other_errors=m,ct("target.bulkDocs failed to write docs",l),new Error("bulkWrite partial failure")}},function(h){throw br.doc_write_failures+=g.length,h})}}function at(){if(ai.error){throw new Error("There was a problem getting docs.")}br.last_seq=co=ai.seq;var g=eX(br);return X.length&&(g.docs=X,be.emit("change",g)),ae=!0,G.writeCheckpoint(ai.seq,K).then(function(){if(ae=!1,be.cancelled){throw bo(),new Error("cancelled")}ai=void 0,ce()})["catch"](dt)}function ao(){var g={};return ai.changes.forEach(function(h){"_user/"!==h.id&&(g[h.id]=h.changes.map(function(i){return i.rev}))}),ar.revsDiff(g).then(function(h){if(be.cancelled){throw bo(),new Error("cancelled")}ai.diffs=h})}function di(){return dc(dn,ar,ai.diffs,be).then(function(g){ai.error=!g.ok,g.docs.forEach(function(h){delete ai.diffs[h._id],br.docs_read++,ai.docs.push(h)})})}function ci(){if(!be.cancelled&&!ai){if(0===cn.length){return void dr(!0)}ai=cn.shift(),ao().then(di).then(ee).then(at).then(ci)["catch"](function(g){ct("batch processing terminated with error",g)})}}function dr(g){return 0===bn.changes.length?void (0!==cn.length||ai||((W&&z.live||Y)&&(be.state="pending",be.emit("paused")),Y&&bo())):void ((g||Y||bn.changes.length>=O)&&(cn.push(bn),bn={seq:0,changes:[],docs:[]},"pending"!==be.state&&"stopped"!==be.state||(be.state="active",be.emit("active")),ci()))}function ct(h,g){F||(g.message||(g.message=h),br.ok=!1,br.status="aborting",br.errors.push(g),J=J.concat(g),cn=[],bn={seq:0,changes:[],docs:[]},bo())}function bo(){if(!(F||be.cancelled&&(br.status="cancelled",ae))){br.status=br.status||"complete",br.end_time=new Date,br.last_seq=co,F=!0;var h=J.filter(function(i){return"unauthorized"!==i.name&&"forbidden"!==i.name});if(h.length>0){var g=J.pop();J.length>0&&(g.other_errors=J),g.result=br,bx(bt,be,g,function(){fN(dn,ar,bt,be)})}else{br.errors=J,be.emit("complete",br),be.removeAllListeners()}}}function an(h){if(be.cancelled){return bo()}var g=fj(bt)(h);g&&(bn.seq=h.seq,bn.changes.push(h),dr(0===cn.length&&z.live))}function Z(h){if(V=!1,be.cancelled){return bo()}if(h.results.length>0){z.since=h.last_seq,ce(),dr(!0)}else{var g=function(){W?(z.live=!0,ce()):Y=!0,dr(!0)};ai||0!==h.results.length?g():(ae=!0,G.writeCheckpoint(h.last_seq,K).then(function(){ae=!1,br.last_seq=co=h.last_seq,g()})["catch"](dt))}}function ei(g){return V=!1,be.cancelled?bo():void ct("changes rejected",g)}function ce(){function h(){g.cancel()}function j(){be.removeListener("cancel",h)}if(!V&&!Y&&cn.length<P){V=!0,be._changes&&(be.removeListener("cancel",be._abortChanges),be._changes.cancel()),be.once("cancel",h);var g=dn.changes(z).on("change",an);g.then(j,j),g.then(Z)["catch"](ei),bt.retry&&(be._changes=g,be._abortChanges=h)}}function de(){cr().then(function(){return be.cancelled?void bo():G.getCheckpoint().then(function(g){co=g,z={since:co,limit:O,batch_size:O,style:"all_docs",doc_ids:H,return_docs:!0},bt.filter&&("string"!=typeof bt.filter?z.include_docs=!0:z.filter=bt.filter),"heartbeat" in bt&&(z.heartbeat=bt.heartbeat),"timeout" in bt&&(z.timeout=bt.timeout),bt.query_params&&(z.query_params=bt.query_params),bt.view&&(z.view=bt.view),ce()})})["catch"](function(g){ct("getCheckpoint rejected with ",g)})}function dt(g){throw ae=!1,ct("writeCheckpoint completed with error",g),g}var ai,Q,G,cn=[],bn={seq:0,changes:[],docs:[]},ae=!1,Y=!1,F=!1,co=0,W=bt.continuous||bt.live||!1,O=bt.batch_size||100,P=bt.batches_limit||10,V=!1,H=bt.doc_ids,J=[],X=[],K=fB();br=br||{ok:!0,start_time:new Date,docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var z={};return be.ready(dn,ar),be.cancelled?void bo():(be._addedListeners||(be.once("cancel",bo),"function"==typeof bt.complete&&(be.once("error",bt.complete),be.once("complete",function(g){bt.complete(null,g)})),be._addedListeners=!0),void ("undefined"==typeof bt.since?de():cr().then(function(){return ae=!0,G.writeCheckpoint(bt.since,K)}).then(function(){return ae=!1,be.cancelled?void bo():(co=bt.since,void de())})["catch"](dt)))}function bc(){fa.EventEmitter.call(this),this.cancelled=!1,this.state="pending";var h=this,g=new bI(function(i,j){h.once("complete",i),h.once("error",j)});h.then=function(i,j){return g.then(i,j)},h["catch"]=function(i){return g["catch"](i)},h["catch"](function(){})}function aQ(h,g){var i=g.PouchConstructor;return"string"==typeof h?new i(h,g):h}function eA(l,j,p,k){if("function"==typeof p&&(k=p,p={}),"undefined"==typeof p&&(p={}),p.doc_ids&&!Array.isArray(p.doc_ids)){throw eu(eM,"`doc_ids` filter parameter is not a list.")}p.complete=k,p=eX(p),p.continuous=p.continuous||p.live,p.retry="retry" in p?p.retry:!1,p.PouchConstructor=p.PouchConstructor||this;var m=new bc(p),h=aQ(l,p),g=aQ(j,p);return fN(h,g,p,m),m}function dR(i,g,j,h){return"function"==typeof j&&(h=j,j={}),"undefined"==typeof j&&(j={}),j=eX(j),j.PouchConstructor=j.PouchConstructor||this,i=aQ(i,j),g=aQ(g,j),new cL(i,g,j,h)}function cL(F,m,A,w){function z(h){D.emit("change",{direction:"pull",change:h})}function C(h){D.emit("change",{direction:"push",change:h})}function I(h){D.emit("denied",{direction:"push",doc:h})}function q(h){D.emit("denied",{direction:"pull",doc:h})}function k(){D.pushPaused=!0,D.pullPaused&&D.emit("paused")}function H(){D.pullPaused=!0,D.pushPaused&&D.emit("paused")}function E(){D.pushPaused=!1,D.pullPaused&&D.emit("active",{direction:"push"})}function B(){D.pullPaused=!1,D.pushPaused&&D.emit("active",{direction:"pull"})}function G(h){return function(l,y){var o="change"===l&&(y===z||y===C),u="denied"===l&&(y===q||y===I),s="paused"===l&&(y===H||y===k),i="active"===l&&(y===B||y===E);(o||u||s||i)&&(l in g||(g[l]={}),g[l][h]=!0,2===Object.keys(g[l]).length&&D.removeAllListeners(l))}}var D=this;this.canceled=!1;var x=A.push?bS.extend({},A,A.push):A,j=A.pull?bS.extend({},A,A.pull):A;this.push=eA(F,m,x),this.pull=eA(m,F,j),this.pushPaused=!0,this.pullPaused=!0;var g={};A.live&&(this.push.on("complete",D.pull.cancel.bind(D.pull)),this.pull.on("complete",D.push.cancel.bind(D.push))),this.on("newListener",function(h){"change"===h?(D.pull.on("change",z),D.push.on("change",C)):"denied"===h?(D.pull.on("denied",q),D.push.on("denied",I)):"active"===h?(D.pull.on("active",B),D.push.on("active",E)):"paused"===h&&(D.pull.on("paused",H),D.push.on("paused",k))}),this.on("removeListener",function(h){"change"===h?(D.pull.removeListener("change",z),D.push.removeListener("change",C)):"denied"===h?(D.pull.removeListener("denied",q),D.push.removeListener("denied",I)):"active"===h?(D.pull.removeListener("active",B),D.push.removeListener("active",E)):"paused"===h&&(D.pull.removeListener("paused",H),D.push.removeListener("paused",k))}),this.pull.on("removeListener",G("pull")),this.push.on("removeListener",G("push"));var J=bI.all([this.push,this.pull]).then(function(i){var h={push:i[0],pull:i[1]};return D.emit("complete",h),w&&w(null,h),D.removeAllListeners(),h},function(h){if(D.cancel(),w?w(h):D.emit("error",h),D.removeAllListeners(),w){throw h}});this.then=function(i,h){return J.then(i,h)},this["catch"]=function(h){return J["catch"](h)}}function ed(g){g.replicate=eA,g.sync=dR}var dw,bS=d(9),aF=eF(d(5)),f0=eF(d(8)),ac=eF(d(10)),cA=d(14),dH=eF(d(4)),fa=d(1),av=eF(d(15)),aA=eF(d(16)),cP=eF(d(17)),cW=d(12),bI="function"==typeof Promise?Promise:ac,e=Function.prototype.toString,bp=e.call(Object),cE=aF("pouchdb:api"),dA=6;if(e0()){dw=!1}else{try{localStorage.setItem("_pouch_check_localstorage",1),dw=!!localStorage.getItem("_pouch_check_localstorage")}catch(c6){dw=!1}}f0(eY,fa.EventEmitter),eY.prototype.addListener=function(l,j,p,k){function m(){function n(){g=!1}if(h._listeners[j]){if(g){return void (g="waiting")}g=!0;var i=eR(k,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary"]);p.changes(i).on("change",function(o){o.seq>k.since&&!k.cancelled&&(k.since=o.seq,k.onChange(o))}).on("complete",function(){"waiting"===g&&setTimeout(function(){m()},0),g=!1}).on("error",n)}}if(!this._listeners[j]){var h=this,g=!1;this._listeners[j]=m,this.on(l,m)}},eY.prototype.removeListener=function(h,g){g in this._listeners&&fa.EventEmitter.prototype.removeListener.call(this,h,this._listeners[g])},eY.prototype.notifyLocalWindows=function(g){e0()?chrome.storage.local.set({dbName:g}):eI()&&(localStorage[g]="a"===localStorage[g]?"b":"a")},eY.prototype.notify=function(g){this.emit(g),this.notifyLocalWindows(g)},f0(eC,Error),eC.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};var aW=new eC({status:401,error:"unauthorized",reason:"Name or password is incorrect."}),d6=new eC({status:400,error:"bad_request",reason:"Missing JSON list of 'docs'"}),fq=new eC({status:404,error:"not_found",reason:"missing"}),aL=new eC({status:409,error:"conflict",reason:"Document update conflict"}),c0=new eC({status:400,error:"invalid_id",reason:"_id field must contain a string"}),dL=new eC({status:412,error:"missing_id",reason:"_id is required for puts"}),a7=new eC({status:400,error:"bad_request",reason:"Only reserved document ids may start with underscore."}),dV=new eC({status:412,error:"precondition_failed",reason:"Database not open"}),aj=new eC({status:500,error:"unknown_error",reason:"Database encountered an unknown error"}),cs=new eC({status:500,error:"badarg",reason:"Some query argument is invalid"}),dl=new eC({status:400,error:"invalid_request",reason:"Request was invalid"}),fS=new eC({status:400,error:"query_parse_error",reason:"Some query parameter is invalid"}),eh=new eC({status:500,error:"doc_validation",reason:"Bad special document member"}),eM=new eC({status:400,error:"bad_request",reason:"Something wrong with the request"}),bW=new eC({status:400,error:"bad_request",reason:"Document must be a JSON object"}),fJ=new eC({status:404,error:"not_found",reason:"Database not found"}),bM=new eC({status:500,error:"indexed_db_went_bad",reason:"unknown"}),f6=new eC({status:500,error:"web_sql_went_bad",reason:"unknown"}),b7=new eC({status:500,error:"levelDB_went_went_bad",reason:"unknown"}),da=new eC({status:403,error:"forbidden",reason:"Forbidden by design doc validate_doc_update function"}),cf=new eC({status:400,error:"bad_request",reason:"Invalid rev format"}),bB=new eC({status:412,error:"file_exists",reason:"The database could not be created, the file already exists."}),bh=new eC({status:412,error:"missing_stub"}),d3=new eC({status:413,error:"invalid_url",reason:"Provided URL is invalid"}),a2=[aW,d6,fq,aL,c0,dL,a7,dV,aj,cs,dl,fS,eh,eM,bW,fJ,f6,b7,da,cf,bB,bh,bM,d3],cl=function(i,g,j){var h=a2.filter(function(k){return k[i]===g});return j&&h.filter(function(k){return k.message===j})[0]||h[0]},by=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],b4="queryKey",dj=/(?:^|&)([^&=]*)=?([^&]*)/g,fO=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,bd="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");f0(eV,fa.EventEmitter),eV.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")},eV.prototype.doChanges=function(i){var g=this,k=i.complete;if(i=eX(i),"live" in i&&!("continuous" in i)&&(i.continuous=i.live),i.processChange=dZ,"latest"===i.since&&(i.since="now"),i.since||(i.since=0),"now"===i.since){return void this.db.info().then(function(l){return g.isCancelled?void k(null,{status:"cancelled"}):(i.since=l.update_seq,void g.doChanges(i))},k)}if(i.continuous&&"now"!==i.since&&this.db.info().then(function(l){g.startSeq=l.update_seq},function(l){if("idbNull"!==l.id){throw l}}),i.view&&!i.filter&&(i.filter="_view"),i.filter&&"string"==typeof i.filter&&("_view"===i.filter?i.view=fD(i.view):i.filter=fD(i.filter),"http"!==this.db.type()&&!i.doc_ids)){return this.filterChanges(i)}"descending" in i||(i.descending=!1),i.limit=0===i.limit?1:i.limit,i.complete=k;var h=this.db._changes(i);if(h&&"function"==typeof h.cancel){var j=g.cancel;g.cancel=dH(function(l){h.cancel(),j.apply(this,l)})}},eV.prototype.filterChanges=function(k){var h=this,m=k.complete;if("_view"===k.filter){if(!k.view||"string"!=typeof k.view){var j=eu(eM,"`view` filter parameter not found or invalid.");return m(j)}var l=fw(k.view);this.db.get("_design/"+l[0],function(p,o){if(h.isCancelled){return m(null,{status:"cancelled"})}if(p){return m(fG(p))}var n=o&&o.views&&o.views[l[1]]&&o.views[l[1]].map;return n?(k.filter=bl(n),void h.doChanges(k)):m(eu(fq,o.views?"missing json key: "+l[1]:"missing json key: views"))})}else{var g=fw(k.filter);if(!g){return h.doChanges(k)}this.db.get("_design/"+g[0],function(n,p){if(h.isCancelled){return m(null,{status:"cancelled"})}if(n){return m(fG(n))}var i=p&&p.filters&&p.filters[g[1]];return i?(k.filter=fW(i),void h.doChanges(k)):m(eu(fq,p&&p.filters?"missing json key: "+g[1]:"missing json key: filters"))})}},f0(fA,fa.EventEmitter),fA.prototype.post=eW("post",function(h,g,i){return"function"==typeof g&&(i=g,g={}),"object"!=typeof h||Array.isArray(h)?i(eu(bW)):void this.bulkDocs({docs:[h]},g,dE(i))}),fA.prototype.put=eW("put",dH(function(l){function q(){m||(ev("warn","db.put(doc, id, rev) has been deprecated and will be removed in a future release, please use db.put({_id: id, _rev: rev}) instead"),m=!0)}var j,g,h,k,m=!1,v=l.shift(),p="_id" in v;if("object"!=typeof v||Array.isArray(v)){return(k=l.pop())(eu(bW))}for(;;){if(j=l.shift(),g=typeof j,"string"!==g||p?"string"!==g||!p||"_rev" in v?"object"===g?h=j:"function"===g&&(k=j):(q(),v._rev=j):(q(),v._id=j,p=!0),!l.length){break}}return h=h||{},fE(v._id),ds(v._id)&&"function"==typeof this._putLocal?v._deleted?this._removeLocal(v,k):this._putLocal(v,k):void this.bulkDocs({docs:[v]},h,dE(k))})),fA.prototype.putAttachment=eW("putAttachment",function(l,j,p,k,m){function h(i){var o="_rev" in i?parseInt(i._rev,10):0;return i._attachments=i._attachments||{},i._attachments[j]={content_type:m,data:k,revpos:++o},g.put(i)}var g=this;return"function"==typeof m&&(m=k,k=p,p=null),"undefined"==typeof m&&(m=k,k=p,p=null),g.get(l).then(function(i){if(i._rev!==p){throw eu(aL)}return h(i)},function(i){if(i.reason===fq.message){return h({_id:l})}throw i})}),fA.prototype.removeAttachment=eW("removeAttachment",function(i,g,k,h){var j=this;j.get(i,function(m,l){return m?void h(m):l._rev!==k?void h(eu(aL)):l._attachments?(delete l._attachments[g],0===Object.keys(l._attachments).length&&delete l._attachments,void j.put(l,h)):h()})}),fA.prototype.remove=eW("remove",function(k,h,m,j){var l;"string"==typeof h?(l={_id:k,_rev:h},"function"==typeof m&&(j=m,m={})):(l=k,"function"==typeof h?(j=h,m={}):(j=m,m=h)),m=m||{},m.was_delete=!0;var g={_id:l._id,_rev:l._rev||m.rev};return g._deleted=!0,ds(g._id)&&"function"==typeof this._removeLocal?this._removeLocal(l,j):void this.bulkDocs({docs:[g]},m,dE(j))}),fA.prototype.revsDiff=eW("revsDiff",function(m,j,q){function l(n,i){k.has(n)||k.set(n,{missing:[]}),k.get(n).missing.push(i)}function p(i,s){var r=m[i].slice(0);fg(s,function(y,A,w,o,x){var v=A+"-"+w,z=r.indexOf(v);-1!==z&&(r.splice(z,1),"available"!==x.status&&l(i,v))}),r.forEach(function(n){l(i,n)})}"function"==typeof j&&(q=j,j={});var h=Object.keys(m);if(!h.length){return q(null,{})}var g=0,k=new cA.Map;h.map(function(i){this._getRevisionTree(i,function(o,n){if(o&&404===o.status&&"missing"===o.message){k.set(i,{missing:m[i]})}else{if(o){return q(o)}p(i,n)}if(++g===h.length){var s={};return k.forEach(function(u,r){s[r]=u}),q(null,s)}})},this)}),fA.prototype.bulkGet=eW("bulkGet",function(h,g){es(this,h,g)}),fA.prototype.compactDocument=eW("compactDocument",function(i,g,j){var h=this;this._getRevisionTree(i,function(p,m){if(p){return j(p)}var k=f4(m),n=[],l=[];Object.keys(k).forEach(function(o){k[o]>g&&n.push(o)}),fg(m,function(v,s,x,u,w){var q=s+"-"+x;"available"===w.status&&-1!==n.indexOf(q)&&l.push(q)}),h._doCompaction(i,l,j)})}),fA.prototype.compact=eW("compact",function(h,g){"function"==typeof h&&(g=h,h={});var i=this;h=h||{},i._compactionQueue=i._compactionQueue||[],i._compactionQueue.push({opts:h,callback:g}),1===i._compactionQueue.length&&cI(i)}),fA.prototype._compact=function(l,j){function p(i){g.push(m.compactDocument(i.id,0))}function k(i){var o=i.last_seq;bI.all(g).then(function(){return fk(m,"_local/compaction",function(n){return !n.last_seq||n.last_seq<o?(n.last_seq=o,n):!1})}).then(function(){j(null,{ok:!0})})["catch"](j)}var m=this,h={return_docs:!1,last_seq:l.last_seq||0},g=[];m.changes(h).on("change",p).on("complete",k).on("error",j)},fA.prototype.get=eW("get",function(m,j,q){function l(){var n=[],i=p.length;return i?void p.forEach(function(r){h.get(m,{rev:r,revs:j.revs,attachments:j.attachments},function(s,o){s?n.push({missing:r}):n.push({ok:o}),i--,i||q(null,n)})}):q(null,n)}if("function"==typeof j&&(q=j,j={}),"string"!=typeof m){return q(eu(c0))}if(ds(m)&&"function"==typeof this._getLocal){return this._getLocal(m,q)}var p=[],h=this;if(!j.open_revs){return this._get(m,j,function(B,i){if(B){return q(B)}var w=i.doc,F=i.metadata,I=i.ctx;if(j.conflicts){var H=fu(F);H.length&&(w._conflicts=H)}if(cb(F,w._rev)&&(w._deleted=!0),j.revs||j.revs_info){var D=eq(F.rev_tree),A=em(D,function(o){return -1!==o.ids.map(function(r){return r.id}).indexOf(w._rev.split("-")[1])}),x=A.ids.map(function(o){return o.id}).indexOf(w._rev.split("-")[1])+1,C=A.ids.length-x;if(A.ids.splice(x,C),A.ids.reverse(),j.revs&&(w._revisions={start:A.pos+A.ids.length-1,ids:A.ids.map(function(o){return o.id})}),j.revs_info){var z=A.pos+A.ids.length;w._revs_info=A.ids.map(function(o){return z--,{rev:z+"-"+o.id,status:o.opts.status}})}}if(j.attachments&&w._attachments){var n=w._attachments,G=Object.keys(n).length;if(0===G){return q(null,w)}Object.keys(n).forEach(function(o){this._getAttachment(w._id,o,n[o],{rev:w._rev,binary:j.binary,ctx:I},function(u,v){var s=w._attachments[o];s.data=v,delete s.stub,delete s.length,--G||q(null,w)})},h)}else{if(w._attachments){for(var E in w._attachments){w._attachments.hasOwnProperty(E)&&(w._attachments[E].stub=!0)}}q(null,w)}})}if("all"===j.open_revs){this._getRevisionTree(m,function(n,i){return n?q(n):(p=fs(i).map(function(o){return o.rev}),void l())})}else{if(!Array.isArray(j.open_revs)){return q(eu(aj,"function_clause"))}p=j.open_revs;for(var g=0;g<p.length;g++){var k=p[g];if("string"!=typeof k||!/^\d+-/.test(k)){return q(eu(cf))}}l()}}),fA.prototype.getAttachment=eW("getAttachment",function(i,g,k,h){var j=this;k instanceof Function&&(h=k,k={}),this._get(i,k,function(m,l){return m?h(m):l.doc._attachments&&l.doc._attachments[g]?(k.ctx=l.ctx,k.binary=!0,j._getAttachment(i,g,l.doc._attachments[g],k,h),void 0):h(eu(fq))})}),fA.prototype.allDocs=eW("allDocs",function(h,g){if("function"==typeof h&&(g=h,h={}),h.skip="undefined"!=typeof h.skip?h.skip:0,h.start_key&&(h.startkey=h.start_key),h.end_key&&(h.endkey=h.end_key),"keys" in h){if(!Array.isArray(h.keys)){return g(new TypeError("options.keys must be an array"))}var i=["startkey","endkey","key"].filter(function(j){return j in h})[0];if(i){return void g(eu(fS,"Query parameter `"+i+"` is not compatible with multi-get"))}if("http"!==this.type()){return ap(this,h,g)}}return this._allDocs(h,g)}),fA.prototype.changes=function(h,g){return"function"==typeof h&&(g=h,h={}),new eV(this,h,g)},fA.prototype.close=eW("close",function(g){return this._closed=!0,this._close(g)}),fA.prototype.info=eW("info",function(h){var g=this;this._info(function(j,i){return j?h(j):(i.db_name=i.db_name||g._db_name,i.auto_compaction=!(!g.auto_compaction||"http"===g.type()),i.adapter=g.type(),void h(null,i))})}),fA.prototype.id=eW("id",function(g){return this._id(g)}),fA.prototype.type=function(){return"function"==typeof this._type?this._type():this.adapter},fA.prototype.bulkDocs=eW("bulkDocs",function(i,g,k){if("function"==typeof g&&(k=g,g={}),g=g||{},Array.isArray(i)&&(i={docs:i}),!i||!i.docs||!Array.isArray(i.docs)){return k(eu(d6))}for(var h=0;h<i.docs.length;++h){if("object"!=typeof i.docs[h]||Array.isArray(i.docs[h])){return k(eu(bW))}}var j;return i.docs.forEach(function(l){l._attachments&&Object.keys(l._attachments).forEach(function(m){j=j||dO(m)})}),j?k(eu(eM,j)):("new_edits" in g||("new_edits" in i?g.new_edits=i.new_edits:g.new_edits=!0),g.new_edits||"http"===this.type()||i.docs.sort(aJ),b0(i.docs),this._bulkDocs(i,g,function(m,l){return m?k(m):(g.new_edits||(l=l.filter(function(n){return n.error})),void k(null,l))}))}),fA.prototype.registerDependentDatabase=eW("registerDependentDatabase",function(i,g){function j(k){return k.dependentDbs=k.dependentDbs||{},k.dependentDbs[i]?!1:(k.dependentDbs[i]=!0,k)}var h=new this.constructor(i,this.__opts);fk(this,"_local/_pouch_dependentDbs",j).then(function(){g(null,{db:h})})["catch"](g)}),fA.prototype.destroy=eW("destroy",function(i,g){function k(){h._destroy(i,function(l,m){return l?g(l):(h._destroyed=!0,h.emit("destroyed"),void g(null,m||{ok:!0}))})}"function"==typeof i&&(g=i,i={});var h=this,j="use_prefix" in h?h.use_prefix:!0;return"http"===h.type()?k():void h.get("_local/_pouch_dependentDbs",function(p,n){if(p){return 404!==p.status?g(p):k()}var l=n.dependentDbs,o=h.constructor,m=Object.keys(l).map(function(r){var q=j?r.replace(new RegExp("^"+o.prefix),""):r;return new o(q,h.__opts).destroy()});bI.all(m).then(k,g)})}),ay.prototype.execute=function(){var g;if(this.failed){for(;g=this.queue.shift();){g(this.failed)}}else{for(;g=this.queue.shift();){g()}}},ay.prototype.fail=function(g){this.failed=g,this.execute()},ay.prototype.ready=function(g){this.isReady=!0,this.db=g,this.execute()},ay.prototype.addTask=function(g){this.queue.push(g),this.failed&&this.execute()},f0(c3,fA),c3.debug=aF,c3.adapters={},c3.preferredAdapters=[],c3.prefix="_pouch_";var aR=new fa.EventEmitter;bP(c3),c3.parseAdapter=function(m,j){var q,l,p=m.match(/([a-z\-]*):\/\/(.*)/);if(p){if(m=/http(s?)/.test(p[1])?p[1]+"://"+p[2]:p[2],q=p[1],!c3.adapters[q].valid()){throw"Invalid adapter"}return{name:m,adapter:p[1]}}var h="idb" in c3.adapters&&"websql" in c3.adapters&&eI()&&localStorage["_pouch__websqldb_"+c3.prefix+m];if(j.adapter){l=j.adapter}else{if("undefined"!=typeof j&&j.db){l="leveldb"}else{for(var g=0;g<c3.preferredAdapters.length;++g){if(l=c3.preferredAdapters[g],l in c3.adapters){if(h&&"idb"===l){ev("log",'PouchDB is downgrading "'+m+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.');continue}break}}}}q=c3.adapters[l];var k=q&&"use_prefix" in q?q.use_prefix:!0;return{name:k?c3.prefix+m:m,adapter:l}},c3.adapter=function(h,g,i){g.valid()&&(c3.adapters[h]=g,i&&c3.preferredAdapters.push(h))},c3.plugin=function(g){return"function"==typeof g?g(c3):Object.keys(g).forEach(function(h){c3.prototype[h]=g[h]}),c3},c3.defaults=function(h){function g(k,i,j){return this instanceof g?("function"!=typeof i&&"undefined"!=typeof i||(j=i,i={}),k&&"object"==typeof k&&(i=k,k=void 0),i=bS.extend({},h,i),void c3.call(this,k,i,j)):new g(k,i,j)}return f0(g,c3),g.preferredAdapters=c3.preferredAdapters.slice(),Object.keys(c3).forEach(function(i){i in g||(g[i]=c3[i])}),g};var eE="5.4.4";c3.version=eE;var dS,cM=ag(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),dx=ag(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]),bT=function(g){return atob(g)},aG=function(g){return btoa(g)},f1=eB.setImmediate||eB.setTimeout,ad=32768,cB=5,dI="document-store",ff="by-sequence",aw="attach-store",aB="attach-seq-store",cR="meta-store",cX="local-store",bJ="detect-blob-support",t={running:!1,queue:[]},bq=new cA.Map,cG=new eY,dC=new cA.Map;dv.valid=function(){var g="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform);return !g&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange};var c7=7,aX=az("document-store"),d8=az("by-sequence"),fv=az("attach-store"),aM=az("local-store"),c1=az("metadata-store"),dM=az("attach-seq-store"),a8=new cA.Map,dX=new eY,al=1,cv="CREATE INDEX IF NOT EXISTS 'by-seq-deleted-idx' ON "+d8+" (seq, deleted)",dp="CREATE UNIQUE INDEX IF NOT EXISTS 'by-seq-doc-id-rev' ON "+d8+" (doc_id, rev)",fU="CREATE INDEX IF NOT EXISTS 'doc-winningseq-idx' ON "+aX+" (winningseq)",ek="CREATE INDEX IF NOT EXISTS 'attach-seq-seq-idx' ON "+dM+" (seq)",eQ="CREATE UNIQUE INDEX IF NOT EXISTS 'attach-seq-digest-idx' ON "+dM+" (digest, seq)",bY=d8+".seq = "+aX+".winningseq",fK=d8+".seq AS seq, "+d8+".deleted AS deleted, "+d8+".json AS data, "+d8+".rev AS rev, "+aX+".json AS metadata";fR.valid=cq,fR.use_prefix=!0;var bN=bL(),f7=function(){},b9=25,db=50,cg={},bD=1800,bj=aF("pouchdb:http");fP.valid=function(){return !0},aS.prototype.add=function(g){return this.promise=this.promise["catch"](function(){}).then(function(){return g()}),this.promise},aS.prototype.finish=function(){return this.promise};var d7=function(h,g){return g&&h.then(function(i){eH.nextTick(function(){g(null,i)})},function(i){eH.nextTick(function(){g(i)})}),h},a4=function(g){return dH(function(h){var j=h.pop(),i=g.apply(this,h);return"function"==typeof j&&d7(i,j),i})},cu=function(h,g){return h.then(function(i){return g().then(function(){return i})},function(i){return g().then(function(){throw i})})},bC=function(h,g){return function(){var j=arguments,i=this;return h.add(function(){return g.apply(i,j)})}},b8=function(k){for(var h={},m=0,j=k.length;j>m;m++){h["$"+k[m]]=!0}var l=Object.keys(h),g=new Array(l.length);for(m=0,j=l.length;j>m;m++){g[m]=l[m].substring(1)}return g},dm={},fT=new aS,bi=50,aT=ev.bind(null,"log"),eN={_sum:function(h,g){return ax(g)},_count:function(h,g){return g.length},_stats:function(h,g){function i(l){for(var j=0,p=0,k=l.length;k>p;p++){var m=l[p];j+=m*m}return j}return{sum:ax(g),min:Math.min.apply(null,g),max:Math.max.apply(null,g),count:g.length,sumsqr:i(g)}}},dW=a4(function(){var g=this;return"http"===g.type()?am(g):"function"==typeof g._viewCleanup?dD(g):cw(g)}),cQ=function(i,g,k){"function"==typeof g&&(k=g,g={}),g=g?cY(g):{},"function"==typeof i&&(i={map:i});var h=this,j=bI.resolve().then(function(){return dq(h,i,g)});return d7(j,k),j};f0(fV,Error),f0(el,Error),f0(eT,Error);var ej={query:cQ,viewCleanup:dW},dB=1,bX="pouchdb",aI=5,f3=0;bE.prototype.writeCheckpoint=function(h,g){var i=this;return this.updateTarget(h,g).then(function(){return i.updateSource(h,g)})},bE.prototype.updateTarget=function(h,g){return ch(this.target,this.id,h,g,this.returnValue)},bE.prototype.updateSource=function(h,g){var i=this;return this.readOnlySource?bI.resolve(!0):ch(this.src,this.id,h,g,this.returnValue)["catch"](function(j){if(ck(j)){return i.readOnlySource=!0,!0}throw j})};var ak={undefined:function(h,g){return 0===cW.collate(h.last_seq,g.last_seq)?g.last_seq:0},1:function(h,g){return bk(g,h).last_seq}};bE.prototype.getCheckpoint=function(){var g=this;return g.target.get(g.id).then(function(h){return g.readOnlySource?bI.resolve(h.last_seq):g.src.get(g.id).then(function(i){if(h.version!==i.version){return f3}var j;return j=h.version?h.version.toString():"undefined",j in ak?ak[j](h,i):f3},function(i){if(404===i.status&&h.last_seq){return g.src.put({_id:g.id,last_seq:f3}).then(function(){return f3},function(j){return ck(j)?(g.readOnlySource=!0,h.last_seq):f3})}throw i})})["catch"](function(h){if(404!==h.status){throw h}return f3})};var cF=0;f0(bc,fa.EventEmitter),bc.prototype.cancel=function(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")},bc.prototype.ready=function(i,g){function k(){j.cancel()}function h(){i.removeListener("destroyed",k),g.removeListener("destroyed",k)}var j=this;j._readyCalled||(j._readyCalled=!0,i.once("destroyed",k),g.once("destroyed",k),j.once("complete",h))},f0(cL,fa.EventEmitter),cL.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())},c3.plugin(fZ).plugin(eg).plugin(bf).plugin(ej).plugin(ed),c.exports=c3}).call(this,d(2),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{1:1,10:10,12:12,14:14,15:15,16:16,17:17,2:2,4:4,5:5,8:8,9:9}],4:[function(f,c,g){function d(h){return function(){var e=arguments.length;if(e){for(var j=[],i=-1;++i<e;){j[i]=arguments[i]}return h.call(this,j)}return h.call(this,[])}}c.exports=d},{}],5:[function(h,l,f){function c(){return"WebkitAppearance" in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function d(){var s=arguments,p=this.useColors;if(s[0]=(p?"%c":"")+this.namespace+(p?" %c":" ")+s[0]+(p?"%c ":" ")+"+"+f.humanize(this.diff),!p){return s}var q="color: "+this.color;s=[s[0],q,"color: inherit"].concat(Array.prototype.slice.call(s,1));var u=0,n=0;return s[0].replace(/%[a-z%]/g,function(i){"%%"!==i&&(u++,"%c"===i&&(n=u))}),s.splice(n,0,q),s}function g(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function j(n){try{null==n?f.storage.removeItem("debug"):f.storage.debug=n}catch(i){}}function m(){var n;try{n=f.storage.debug}catch(i){}return n}function k(){try{return window.localStorage}catch(i){}}f=l.exports=h(6),f.log=g,f.formatArgs=d,f.save=j,f.load=m,f.useColors=c,f.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:k(),f.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],f.formatters.j=function(i){return JSON.stringify(i)},f.enable(m())},{6:6}],6:[function(l,v,h){function d(){return h.colors[k++%h.colors.length]}function g(n){function f(){}function r(){var B=r,z=+new Date,y=z-(m||z);B.diff=y,B.prev=m,B.curr=z,m=z,null==B.useColors&&(B.useColors=h.useColors()),null==B.color&&B.useColors&&(B.color=d());var o=Array.prototype.slice.call(arguments);o[0]=h.coerce(o[0]),"string"!=typeof o[0]&&(o=["%o"].concat(o));var A=0;o[0]=o[0].replace(/%([a-z%])/g,function(s,u){if("%%"===s){return s}A++;var C=h.formatters[u];if("function"==typeof C){var e=o[A];s=C.call(B,e),o.splice(A,1),A--}return s}),"function"==typeof h.formatArgs&&(o=h.formatArgs.apply(B,o));var x=r.log||h.log||console.log.bind(console);x.apply(B,o)}f.enabled=!1,r.enabled=!0;var c=h.enabled(n)?r:f;return c.namespace=n,c}function j(i){h.save(i);for(var c=(i||"").split(/[\s,]+/),f=c.length,n=0;f>n;n++){c[n]&&(i=c[n].replace(/\*/g,".*?"),"-"===i[0]?h.skips.push(new RegExp("^"+i.substr(1)+"$")):h.names.push(new RegExp("^"+i+"$")))}}function p(){h.enable("")}function w(i){var c,f;for(c=0,f=h.skips.length;f>c;c++){if(h.skips[c].test(i)){return !1}}for(c=0,f=h.names.length;f>c;c++){if(h.names[c].test(i)){return !0}}return !1}function q(c){return c instanceof Error?c.stack||c.message:c}h=v.exports=g,h.coerce=q,h.disable=p,h.enable=j,h.enabled=w,h.humanize=l(11),h.names=[],h.skips=[],h.formatters={};var m,k=0},{11:11}],7:[function(d,c,f){(function(q){function j(){p=!0;for(var l,i,o=k.length;o;){for(i=k,k=[],l=-1;++l<o;){i[l]()}o=k.length}p=!1}function g(i){1!==k.push(i)||p||h()}var h,m=q.MutationObserver||q.WebKitMutationObserver;if(m){var v=0,x=new m(j),w=q.document.createTextNode("");x.observe(w,{characterData:!0}),h=function(){w.data=v=++v%2}}else{if(q.setImmediate||"undefined"==typeof q.MessageChannel){h="document" in q&&"onreadystatechange" in q.document.createElement("script")?function(){var e=q.document.createElement("script");e.onreadystatechange=function(){j(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},q.document.documentElement.appendChild(e)}:function(){setTimeout(j,0)}}else{var t=new q.MessageChannel;t.port1.onmessage=j,h=function(){t.port2.postMessage(0)}}}var p,k=[];c.exports=g}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],8:[function(d,c,f){"function"==typeof Object.create?c.exports=function(h,g){h.super_=g,h.prototype=Object.create(g.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}})}:c.exports=function(h,g){h.super_=g;var i=function(){};i.prototype=g.prototype,h.prototype=new i,h.prototype.constructor=h}},{}],9:[function(d,c,f){(function(){var h=Array.prototype.slice,g=Array.prototype.forEach,i=function(e){if("object"!=typeof e){throw e+" is not an object"}var j=h.call(arguments,1);return g.call(j,function(l){if(l){for(var k in l){"object"==typeof l[k]&&e[k]?i.call(e,e[k],l[k]):e[k]=l[k]}}}),e};this.extend=i}).call(this)},{}],10:[function(H,q,B){function x(){}function A(c){if("function"!=typeof c){throw new TypeError("resolver must be a function")}this.state=C,this.queue=[],this.outcome=void 0,c!==x&&k(this,c)}function E(d,c,f){this.promise=d,"function"==typeof c&&(this.onFulfilled=c,this.callFulfilled=this.otherCallFulfilled),"function"==typeof f&&(this.onRejected=f,this.callRejected=this.otherCallRejected)}function K(d,c,f){z(function(){var e;try{e=c(f)}catch(h){return j.reject(d,h)}e===d?j.reject(d,new TypeError("Cannot resolve promise with itself")):j.resolve(d,e)})}function w(d){var c=d&&d.then;return d&&"object"==typeof d&&"function"==typeof c?function(){c.apply(d,arguments)}:void 0}function k(l,f){function p(e){d||(d=!0,j.reject(l,e))}function h(e){d||(d=!0,j.resolve(l,e))}function m(){f(h,p)}var d=!1,c=J(m);"error"===c.status&&p(c.value)}function J(f,c){var h={};try{h.value=f(c),h.status="success"}catch(d){h.status="error",h.value=d}return h}function G(c){return c instanceof this?c:j.resolve(new this(x),c)}function D(d){var c=new this(x);return j.reject(c,d)}function I(l){function v(n,c){function i(o){p[c]=o,++y!==d||h||(h=!0,j.resolve(m,p))}f.resolve(n).then(i,function(o){h||(h=!0,j.reject(m,o))})}var f=this;if("[object Array]"!==Object.prototype.toString.call(l)){return this.reject(new TypeError("must be an array"))}var d=l.length,h=!1;if(!d){return this.resolve([])}for(var p=new Array(d),y=0,r=-1,m=new this(x);++r<d;){v(l[r],r)}return m}function F(l){function f(i){p.resolve(i).then(function(n){d||(d=!0,j.resolve(h,n))},function(n){d||(d=!0,j.reject(h,n))})}var p=this;if("[object Array]"!==Object.prototype.toString.call(l)){return this.reject(new TypeError("must be an array"))}var m=l.length,d=!1;if(!m){return this.resolve([])}for(var c=-1,h=new this(x);++c<m;){f(l[c])}return h}var z=H(7),j={},g=["REJECTED"],L=["FULFILLED"],C=["PENDING"];q.exports=A,A.prototype["catch"]=function(c){return this.then(null,c)},A.prototype.then=function(d,c){if("function"!=typeof d&&this.state===L||"function"!=typeof c&&this.state===g){return this}var h=new this.constructor(x);if(this.state!==C){var f=this.state===L?d:c;K(h,f,this.outcome)}else{this.queue.push(new E(h,d,c))}return h},E.prototype.callFulfilled=function(c){j.resolve(this.promise,c)},E.prototype.otherCallFulfilled=function(c){K(this.promise,this.onFulfilled,c)},E.prototype.callRejected=function(c){j.reject(this.promise,c)},E.prototype.otherCallRejected=function(c){K(this.promise,this.onRejected,c)},j.resolve=function(h,d){var m=J(w,d);if("error"===m.status){return j.reject(h,m.value)}var f=m.value;if(f){k(h,f)}else{h.state=L,h.outcome=d;for(var l=-1,c=h.queue.length;++l<c;){h.queue[l].callFulfilled(d)}}return h},j.reject=function(f,c){f.state=g,f.outcome=c;for(var h=-1,d=f.queue.length;++h<d;){f.queue[h].callRejected(c)}return f},A.resolve=G,A.reject=D,A.all=I,A.race=F},{7:7}],11:[function(p,x,h){function d(i){if(i=""+i,!(i.length>10000)){var c=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(i);if(c){var l=parseFloat(c[1]),f=(c[2]||"ms").toLowerCase();switch(f){case"years":case"year":case"yrs":case"yr":case"y":return l*j;case"days":case"day":case"d":return l*m;case"hours":case"hour":case"hrs":case"hr":case"h":return l*q;case"minutes":case"minute":case"mins":case"min":case"m":return l*w;case"seconds":case"second":case"secs":case"sec":case"s":return l*y;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return l}}}}function g(c){return c>=m?Math.round(c/m)+"d":c>=q?Math.round(c/q)+"h":c>=w?Math.round(c/w)+"m":c>=y?Math.round(c/y)+"s":c+"ms"}function k(c){return v(c,m,"day")||v(c,q,"hour")||v(c,w,"minute")||v(c,y,"second")||c+" ms"}function v(f,c,i){return c>f?void 0:1.5*c>f?Math.floor(f/c)+" "+i:Math.ceil(f/c)+" "+i+"s"}var y=1000,w=60*y,q=60*w,m=24*q,j=365.25*m;x.exports=function(f,c){return c=c||{},"string"==typeof f?d(f):c["long"]?k(f):g(f)}},{}],12:[function(y,D,m){function g(n){if(null!==n){switch(typeof n){case"boolean":return n?1:0;case"number":return x(n);case"string":return n.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var f=Array.isArray(n),l=f?n:Object.keys(n),p=-1,d=l.length,c="";if(f){for(;++p<d;){c+=m.toIndexableString(l[p])}}else{for(;++p<d;){var h=l[p];c+=m.toIndexableString(h)+m.toIndexableString(n[h])}}return c}}return""}function k(p,I){var h,d=I,f="1"===p[I];if(f){h=0,I++}else{var l="0"===p[I];I++;var G="",J=p.substring(I,I+z),H=parseInt(J,10)+q;for(l&&(H=-H),I+=z;;){var F=p[I];if("\x00"===F){break}G+=F,I++}G=G.split("."),h=1===G.length?parseInt(G,10):parseFloat(G[0]+"."+G[1]),l&&(h-=10),0!==H&&(h=parseFloat(h+"e"+H))}return{num:h,length:I-d}}function v(l,f){var s=l.pop();if(f.length){var h=f[f.length-1];s===h.element&&(f.pop(),h=f[f.length-1]);var p=h.element,d=h.index;if(Array.isArray(p)){p.push(s)}else{if(d===l.length-2){var c=l.pop();p[c]=s}else{l.push(s)}}}}function B(h,d){for(var f=Math.min(h.length,d.length),l=0;f>l;l++){var c=m.collate(h[l],d[l]);if(0!==c){return c}}return h.length===d.length?0:h.length>d.length?1:-1}function E(d,c){return d===c?0:d>c?1:-1}function C(n,f){for(var l=Object.keys(n),p=Object.keys(f),d=Math.min(l.length,p.length),c=0;d>c;c++){var h=m.collate(l[c],p[c]);if(0!==h){return h}if(h=m.collate(n[l[c]],f[p[c]]),0!==h){return h}}return l.length===p.length?0:l.length>p.length?1:-1}function A(d){var c=["boolean","number","string","object"],f=c.indexOf(typeof d);return ~f?null===d?1:Array.isArray(d)?5:3>f?f+2:f+3:Array.isArray(d)?5:void 0}function x(l){if(0===l){return"1"}var G=l.toExponential().split(/e\+?/),f=parseInt(G[1],10),c=0>l,d=c?"0":"2",h=(c?-f:f)-q,p=j.padLeft(h.toString(),"0",z);d+=w+p;var H=Math.abs(parseFloat(G[0]));c&&(H=10-H);var F=H.toFixed(20);return F=F.replace(/\.?0+$/,""),d+=w+F}var q=-324,z=3,w="",j=y(13);m.collate=function(f,c){if(f===c){return 0}f=m.normalizeKey(f),c=m.normalizeKey(c);var d=A(f),h=A(c);if(d-h!==0){return d-h}if(null===f){return 0}switch(typeof f){case"number":return f-c;case"boolean":return f===c?0:c>f?-1:1;case"string":return E(f,c)}return Array.isArray(f)?B(f,c):C(f,c)},m.normalizeKey=function(l){switch(typeof l){case"undefined":return null;case"number":return l===1/0||l===-(1/0)||isNaN(l)?null:l;case"object":var f=l;if(Array.isArray(l)){var h=l.length;l=new Array(h);for(var n=0;h>n;n++){l[n]=m.normalizeKey(f[n])}}else{if(l instanceof Date){return l.toJSON()}if(null!==l){l={};for(var d in f){if(f.hasOwnProperty(d)){var c=f[d];"undefined"!=typeof c&&(l[d]=m.normalizeKey(c))}}}}}return l},m.toIndexableString=function(d){var c="\x00";return d=m.normalizeKey(d),A(d)+w+g(d)+c},m.parseIndexableString=function(p){for(var I=[],h=[],d=0;;){var G=p[d++];if("\x00"!==G){switch(G){case"1":I.push(null);break;case"2":I.push("1"===p[d]),d++;break;case"3":var J=k(p,d);I.push(J.num),d+=J.length;break;case"4":for(var H="";;){var F=p[d];if("\x00"===F){break}H+=F,d++}H=H.replace(/\u0001\u0001/g,"\x00").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),I.push(H);break;case"5":var o={element:[],index:I.length};I.push(o.element),h.push(o);break;case"6":var i={element:{},index:I.length};I.push(i.element),h.push(i);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+G)}}else{if(1===I.length){return I.pop()}v(I,h)}}}},{13:13}],13:[function(f,c,g){function d(j,h,l){for(var i="",k=l-j.length;i.length<k;){i+=h}return i}g.padLeft=function(i,h,k){var j=d(i,h,k);return j+i},g.padRight=function(i,h,k){var j=d(i,h,k);return i+j},g.stringLexCompare=function(m,k){var q,l=m.length,p=k.length;for(q=0;l>q;q++){if(q===p){return 1}var j=m.charAt(q),h=k.charAt(q);if(j!==h){return h>j?-1:1}}return p>l?-1:0},g.intToDecimalForm=function(j){var h=0>j,k="";do{var i=h?-Math.ceil(j%10):Math.floor(j%10);k=i+k,j=h?Math.ceil(j/10):Math.floor(j/10)}while(j);return h&&"0"!==k&&(k="-"+k),k}},{}],14:[function(f,c,h){function d(){this.store={}}function g(j){if(this.store=new d,j&&Array.isArray(j)){for(var i=0,k=j.length;k>i;i++){this.add(j[i])}}}h.Map=d,h.Set=g,d.prototype.mangle=function(i){if("string"!=typeof i){throw new TypeError("key must be a string but Got "+i)}return"$"+i},d.prototype.unmangle=function(i){return i.substring(1)},d.prototype.get=function(j){var i=this.mangle(j);return i in this.store?this.store[i]:void 0},d.prototype.set=function(j,i){var k=this.mangle(j);return this.store[k]=i,!0},d.prototype.has=function(j){var i=this.mangle(j);return i in this.store},d.prototype["delete"]=function(j){var i=this.mangle(j);return i in this.store?(delete this.store[i],!0):!1},d.prototype.forEach=function(m){for(var k=Object.keys(this.store),q=0,l=k.length;l>q;q++){var p=k[q],j=this.store[p];p=this.unmangle(p),m(j,p)}},g.prototype.add=function(i){return this.store.set(i,!0)},g.prototype.has=function(i){return this.store.has(i)},g.prototype["delete"]=function(i){return this.store["delete"](i)}},{}],15:[function(d,c,f){(function(){var g={}.hasOwnProperty,h=[].slice;c.exports=function(k,m){var n,j,e,l;j=[],l=[];for(n in m){g.call(m,n)&&(e=m[n],"this"!==n&&(j.push(n),l.push(e)))}return Function.apply(null,h.call(j).concat([k])).apply(m["this"],l)}}).call(this)},{}],16:[function(c,e,d){!function(g){if("object"==typeof d){e.exports=g()}else{if("function"==typeof b&&b.amd){b(g)}else{var h;try{h=window}catch(f){h=self}h.SparkMD5=g()}}}(function(J){function w(l,g,p,h,m,f){return g=H(H(g,l),H(h,f)),H(g<<m|g>>>32-m,p)}function C(m,t,l,p,g,f,h){return w(t&l|~t&p,m,t,g,f,h)}function z(m,t,l,p,g,f,h){return w(t&p|l&~p,m,t,g,f,h)}function B(m,t,l,p,g,f,h){return w(t^l^p,m,t,g,f,h)}function F(m,t,l,p,g,f,h){return w(l^(t|~p),m,t,g,f,h)}function N(l,h){var f=l[0],i=l[1],g=l[2],m=l[3];f=C(f,i,g,m,h[0],7,-680876936),m=C(m,f,i,g,h[1],12,-389564586),g=C(g,m,f,i,h[2],17,606105819),i=C(i,g,m,f,h[3],22,-1044525330),f=C(f,i,g,m,h[4],7,-176418897),m=C(m,f,i,g,h[5],12,1200080426),g=C(g,m,f,i,h[6],17,-1473231341),i=C(i,g,m,f,h[7],22,-45705983),f=C(f,i,g,m,h[8],7,1770035416),m=C(m,f,i,g,h[9],12,-1958414417),g=C(g,m,f,i,h[10],17,-42063),i=C(i,g,m,f,h[11],22,-1990404162),f=C(f,i,g,m,h[12],7,1804603682),m=C(m,f,i,g,h[13],12,-40341101),g=C(g,m,f,i,h[14],17,-1502002290),i=C(i,g,m,f,h[15],22,1236535329),f=z(f,i,g,m,h[1],5,-165796510),m=z(m,f,i,g,h[6],9,-1069501632),g=z(g,m,f,i,h[11],14,643717713),i=z(i,g,m,f,h[0],20,-373897302),f=z(f,i,g,m,h[5],5,-701558691),m=z(m,f,i,g,h[10],9,38016083),g=z(g,m,f,i,h[15],14,-660478335),i=z(i,g,m,f,h[4],20,-405537848),f=z(f,i,g,m,h[9],5,568446438),m=z(m,f,i,g,h[14],9,-1019803690),g=z(g,m,f,i,h[3],14,-187363961),i=z(i,g,m,f,h[8],20,1163531501),f=z(f,i,g,m,h[13],5,-1444681467),m=z(m,f,i,g,h[2],9,-51403784),g=z(g,m,f,i,h[7],14,1735328473),i=z(i,g,m,f,h[12],20,-1926607734),f=B(f,i,g,m,h[5],4,-378558),m=B(m,f,i,g,h[8],11,-2022574463),g=B(g,m,f,i,h[11],16,1839030562),i=B(i,g,m,f,h[14],23,-35309556),f=B(f,i,g,m,h[1],4,-1530992060),m=B(m,f,i,g,h[4],11,1272893353),g=B(g,m,f,i,h[7],16,-155497632),i=B(i,g,m,f,h[10],23,-1094730640),f=B(f,i,g,m,h[13],4,681279174),m=B(m,f,i,g,h[0],11,-358537222),g=B(g,m,f,i,h[3],16,-722521979),i=B(i,g,m,f,h[6],23,76029189),f=B(f,i,g,m,h[9],4,-640364487),m=B(m,f,i,g,h[12],11,-421815835),g=B(g,m,f,i,h[15],16,530742520),i=B(i,g,m,f,h[2],23,-995338651),f=F(f,i,g,m,h[0],6,-198630844),m=F(m,f,i,g,h[7],10,1126891415),g=F(g,m,f,i,h[14],15,-1416354905),i=F(i,g,m,f,h[5],21,-57434055),f=F(f,i,g,m,h[12],6,1700485571),m=F(m,f,i,g,h[3],10,-1894986606),g=F(g,m,f,i,h[10],15,-1051523),i=F(i,g,m,f,h[1],21,-2054922799),f=F(f,i,g,m,h[8],6,1873313359),m=F(m,f,i,g,h[15],10,-30611744),g=F(g,m,f,i,h[6],15,-1560198380),i=F(i,g,m,f,h[13],21,1309151649),f=F(f,i,g,m,h[4],6,-145523070),m=F(m,f,i,g,h[11],10,-1120210379),g=F(g,m,f,i,h[2],15,718787259),i=F(i,g,m,f,h[9],21,-343485551),l[0]=H(f,l[0]),l[1]=H(i,l[1]),l[2]=H(g,l[2]),l[3]=H(m,l[3])}function x(g){var f,h=[];for(f=0;64>f;f+=4){h[f>>2]=g.charCodeAt(f)+(g.charCodeAt(f+1)<<8)+(g.charCodeAt(f+2)<<16)+(g.charCodeAt(f+3)<<24)}return h}function q(g){var f,h=[];for(f=0;64>f;f+=4){h[f>>2]=g[f]+(g[f+1]<<8)+(g[f+2]<<16)+(g[f+3]<<24)}return h}function L(s){var P,l,g,h,m,y,v=s.length,p=[1732584193,-271733879,-1732584194,271733878];for(P=64;v>=P;P+=64){N(p,x(s.substring(P-64,P)))}for(s=s.substring(P-64),l=s.length,g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],P=0;l>P;P+=1){g[P>>2]|=s.charCodeAt(P)<<(P%4<<3)}if(g[P>>2]|=128<<(P%4<<3),P>55){for(N(p,g),P=0;16>P;P+=1){g[P]=0}}return h=8*v,h=h.toString(16).match(/(.*?)(.{0,8})$/),m=parseInt(h[2],16),y=parseInt(h[1],16)||0,g[14]=m,g[15]=y,N(p,g),p}function I(u){var y,l,g,h,m,P,v=u.length,p=[1732584193,-271733879,-1732584194,271733878];for(y=64;v>=y;y+=64){N(p,q(u.subarray(y-64,y)))}for(u=v>y-64?u.subarray(y-64):new Uint8Array(0),l=u.length,g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],y=0;l>y;y+=1){g[y>>2]|=u[y]<<(y%4<<3)}if(g[y>>2]|=128<<(y%4<<3),y>55){for(N(p,g),y=0;16>y;y+=1){g[y]=0}}return h=8*v,h=h.toString(16).match(/(.*?)(.{0,8})$/),m=parseInt(h[2],16),P=parseInt(h[1],16)||0,g[14]=m,g[15]=P,N(p,g),p}function E(g){var f,h="";for(f=0;4>f;f+=1){h+=M[g>>8*f+4&15]+M[g>>8*f&15]}return h}function K(g){var f;for(f=0;f<g.length;f+=1){g[f]=E(g[f])}return g.join("")}function G(f){return/[\u0080-\uFFFF]/.test(f)&&(f=unescape(encodeURIComponent(f))),f}function A(l,g){var p,h=l.length,m=new ArrayBuffer(h),f=new Uint8Array(m);for(p=0;h>p;p+=1){f[p]=l.charCodeAt(p)}return g?f:m}function k(f){return String.fromCharCode.apply(null,new Uint8Array(f))}function j(h,f,i){var g=new Uint8Array(h.byteLength+f.byteLength);return g.set(new Uint8Array(h)),g.set(new Uint8Array(f),h.byteLength),i?g:g.buffer}function O(h){var f,i=[],g=h.length;for(f=0;g-1>f;f+=2){i.push(parseInt(h.substr(f,2),16))}return String.fromCharCode.apply(String,i)}function D(){this.reset()}var H=function(g,f){return g+f&4294967295},M=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return"5d41402abc4b2a76b9719d911017c592"!==K(L("hello"))&&(H=function(h,f){var i=(65535&h)+(65535&f),g=(h>>16)+(f>>16)+(i>>16);return g<<16|65535&i}),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||!function(){function f(h,g){return h=0|h||0,0>h?Math.max(h+g,0):Math.min(h,g)}ArrayBuffer.prototype.slice=function(l,g){var h,m,v,P,y=this.byteLength,t=f(l,y),p=y;return g!==J&&(p=f(g,y)),t>p?new ArrayBuffer(0):(h=p-t,m=new ArrayBuffer(h),v=new Uint8Array(m),P=new Uint8Array(this,t,h),v.set(P),m)}}(),D.prototype.append=function(f){return this.appendBinary(G(f)),this},D.prototype.appendBinary=function(g){this._buff+=g,this._length+=g.length;var f,h=this._buff.length;for(f=64;h>=f;f+=64){N(this._hash,x(this._buff.substring(f-64,f)))}return this._buff=this._buff.substring(f-64),this},D.prototype.end=function(l){var g,p,h=this._buff,m=h.length,f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(g=0;m>g;g+=1){f[g>>2]|=h.charCodeAt(g)<<(g%4<<3)}return this._finish(f,m),p=K(this._hash),l&&(p=O(p)),this.reset(),p},D.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},D.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},D.prototype.setState=function(f){return this._buff=f.buff,this._length=f.length,this._hash=f.hash,this},D.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},D.prototype._finish=function(l,g){var p,h,m,f=g;if(l[f>>2]|=128<<(f%4<<3),f>55){for(N(this._hash,l),f=0;16>f;f+=1){l[f]=0}}p=8*this._length,p=p.toString(16).match(/(.*?)(.{0,8})$/),h=parseInt(p[2],16),m=parseInt(p[1],16)||0,l[14]=h,l[15]=m,N(this._hash,l)},D.hash=function(g,f){return D.hashBinary(G(g),f)},D.hashBinary=function(h,f){var i=L(h),g=K(i);return f?O(g):g},D.ArrayBuffer=function(){this.reset()},D.ArrayBuffer.prototype.append=function(h){var f,i=j(this._buff.buffer,h,!0),g=i.length;for(this._length+=h.byteLength,f=64;g>=f;f+=64){N(this._hash,q(i.subarray(f-64,f)))}return this._buff=g>f-64?new Uint8Array(i.buffer.slice(f-64)):new Uint8Array(0),this},D.ArrayBuffer.prototype.end=function(l){var g,p,h=this._buff,m=h.length,f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(g=0;m>g;g+=1){f[g>>2]|=h[g]<<(g%4<<3)}return this._finish(f,m),p=K(this._hash),l&&(p=O(p)),this.reset(),p},D.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},D.ArrayBuffer.prototype.getState=function(){var f=D.prototype.getState.call(this);return f.buff=k(f.buff),f},D.ArrayBuffer.prototype.setState=function(f){return f.buff=A(f.buff,!0),D.prototype.setState.call(this,f)},D.ArrayBuffer.prototype.destroy=D.prototype.destroy,D.ArrayBuffer.prototype._finish=D.prototype._finish,D.ArrayBuffer.hash=function(h,f){var i=I(new Uint8Array(h)),g=K(i);return f?O(g):g},D})},{}],17:[function(f,c,g){function d(m,k,q){var l=q[q.length-1];m===l.element&&(q.pop(),l=q[q.length-1]);var p=l.element,j=l.index;if(Array.isArray(p)){p.push(m)}else{if(j===k.length-2){var h=k.pop();p[h]=m}else{k.push(m)}}}g.stringify=function(x){var C=[];C.push({obj:x});for(var m,j,k,q,A,D,B,z,w,p,y,v="";m=C.pop();){if(j=m.obj,k=m.prefix||"",q=m.val||"",v+=k,q){v+=q}else{if("object"!=typeof j){v+="undefined"==typeof j?null:JSON.stringify(j)}else{if(null===j){v+="null"}else{if(Array.isArray(j)){for(C.push({val:"]"}),A=j.length-1;A>=0;A--){D=0===A?"":",",C.push({obj:j[A],prefix:D})}C.push({val:"["})}else{B=[];for(z in j){j.hasOwnProperty(z)&&B.push(z)}for(C.push({val:"}"}),A=B.length-1;A>=0;A--){w=B[A],p=j[w],y=A>0?",":"",y+=JSON.stringify(w)+":",C.push({obj:p,prefix:y})}C.push({val:"{"})}}}}}return v},g.parse=function(v){for(var A,k,j,p,y,B,z,x,r,m=[],w=[],q=0;;){if(A=v[q++],"}"!==A&&"]"!==A&&"undefined"!=typeof A){switch(A){case" ":case"	":case"\n":case":":case",":break;case"n":q+=3,d(null,m,w);break;case"t":q+=3,d(!0,m,w);break;case"f":q+=4,d(!1,m,w);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(k="",q--;;){if(j=v[q++],!/[\d\.\-e\+]/.test(j)){q--;break}k+=j}d(parseFloat(k),m,w);break;case'"':for(p="",y=void 0,B=0;;){if(z=v[q++],'"'===z&&("\\"!==y||B%2!==1)){break}p+=z,y=z,"\\"===y?B++:B=0}d(JSON.parse('"'+p+'"'),m,w);break;case"[":x={element:[],index:m.length},m.push(x.element),w.push(x);break;case"{":r={element:{},index:m.length},m.push(r.element),w.push(r);break;default:throw new Error("unexpectedly reached end of input: "+A)}}else{if(1===m.length){return m.pop()}d(m.pop(),m,w)}}}},{}]},{},[3])(3)});