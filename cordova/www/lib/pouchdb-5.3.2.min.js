!function(b){if("object"==typeof exports&&"undefined"!=typeof module){module.exports=b()}else{if("function"==typeof define&&define.amd){define([],b)}else{var a;a="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,a.PouchDB=b()}}}(function(){var b;return function a(f,h,c){function d(l,e){if(!h[l]){if(!f[l]){var m="function"==typeof require&&require;if(!e&&m){return m(l,!0)}if(j){return j(l,!0)}var k=new Error("Cannot find module '"+l+"'");throw k.code="MODULE_NOT_FOUND",k}var i=h[l]={exports:{}};f[l][0].call(i.exports,function(n){var o=f[l][1][n];return d(o?o:n)},i,i.exports,a,f,h,c)}return h[l].exports}for(var j="function"==typeof require&&require,g=0;g<c.length;g++){d(c[g])}return d}({1:[function(f,c,g){function d(e){return function(){var h=arguments.length;if(h){for(var j=[],i=-1;++i<h;){j[i]=arguments[i]}return e.call(this,j)}return e.call(this,[])}}c.exports=d},{}],2:[function(h,l,f){function c(){return"WebkitAppearance" in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function d(){var i=arguments,p=this.useColors;if(i[0]=(p?"%c":"")+this.namespace+(p?" %c":" ")+i[0]+(p?"%c ":" ")+"+"+f.humanize(this.diff),!p){return i}var e="color: "+this.color;i=[i[0],e,"color: inherit"].concat(Array.prototype.slice.call(i,1));var n=0,o=0;return i[0].replace(/%[a-z%]/g,function(q){"%%"!==q&&(n++,"%c"===q&&(o=n))}),i.splice(o,0,e),i}function g(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function j(e){try{null==e?f.storage.removeItem("debug"):f.storage.debug=e}catch(i){}}function m(){var e;try{e=f.storage.debug}catch(i){}return e}function k(){try{return window.localStorage}catch(e){}}f=l.exports=h(3),f.log=g,f.formatArgs=d,f.save=j,f.load=m,f.useColors=c,f.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:k(),f.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],f.formatters.j=function(e){return JSON.stringify(e)},f.enable(m())},{3:3}],3:[function(g,l,v){function p(){return v.colors[d++%v.colors.length]}function q(f){function n(){}function e(){var u=e,o=+new Date,x=o-(h||o);u.diff=x,u.prev=h,u.curr=o,h=o,null==u.useColors&&(u.useColors=v.useColors()),null==u.color&&u.useColors&&(u.color=p());var s=Array.prototype.slice.call(arguments);s[0]=v.coerce(s[0]),"string"!=typeof s[0]&&(s=["%o"].concat(s));var r=0;s[0]=s[0].replace(/%([a-z%])/g,function(D,B){if("%%"===D){return D}r++;var w=v.formatters[B];if("function"==typeof w){var C=s[r];D=w.call(u,C),s.splice(r,1),r--}return D}),"function"==typeof v.formatArgs&&(s=v.formatArgs.apply(u,s));var t=e.log||v.log||console.log.bind(console);t.apply(u,s)}n.enabled=!1,e.enabled=!0;var i=v.enabled(f)?e:n;return i.namespace=f,i}function c(e){v.save(e);for(var f=(e||"").split(/[\s,]+/),n=f.length,i=0;n>i;i++){f[i]&&(e=f[i].replace(/\*/g,".*?"),"-"===e[0]?v.skips.push(new RegExp("^"+e.substr(1)+"$")):v.names.push(new RegExp("^"+e+"$")))}}function j(){v.enable("")}function m(i){var e,f;for(e=0,f=v.skips.length;f>e;e++){if(v.skips[e].test(i)){return !1}}for(e=0,f=v.names.length;f>e;e++){if(v.names[e].test(i)){return !0}}return !1}function k(e){return e instanceof Error?e.stack||e.message:e}v=l.exports=q,v.coerce=k,v.disable=j,v.enable=c,v.enabled=m,v.humanize=g(9),v.names=[],v.skips=[],v.formatters={};var h,d=0},{9:9}],4:[function(j,f,l){function d(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function k(e){return"function"==typeof e}function c(e){return"number"==typeof e}function g(e){return"object"==typeof e&&null!==e}function h(e){return void 0===e}f.exports=d,d.EventEmitter=d,d.prototype._events=void 0,d.prototype._maxListeners=void 0,d.defaultMaxListeners=10,d.prototype.setMaxListeners=function(e){if(!c(e)||0>e||isNaN(e)){throw TypeError("n must be a positive number")}return this._maxListeners=e,this},d.prototype.emit=function(q){var i,m,p,e,n,o;if(this._events||(this._events={}),"error"===q&&(!this._events.error||g(this._events.error)&&!this._events.error.length)){if(i=arguments[1],i instanceof Error){throw i}throw TypeError('Uncaught, unspecified "error" event.')}if(m=this._events[q],h(m)){return !1}if(k(m)){switch(arguments.length){case 1:m.call(this);break;case 2:m.call(this,arguments[1]);break;case 3:m.call(this,arguments[1],arguments[2]);break;default:e=Array.prototype.slice.call(arguments,1),m.apply(this,e)}}else{if(g(m)){for(e=Array.prototype.slice.call(arguments,1),o=m.slice(),p=o.length,n=0;p>n;n++){o[n].apply(this,e)}}}return !0},d.prototype.addListener=function(m,i){var e;if(!k(i)){throw TypeError("listener must be a function")}return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",m,k(i.listener)?i.listener:i),this._events[m]?g(this._events[m])?this._events[m].push(i):this._events[m]=[this._events[m],i]:this._events[m]=i,g(this._events[m])&&!this._events[m].warned&&(e=h(this._maxListeners)?d.defaultMaxListeners:this._maxListeners,e&&e>0&&this._events[m].length>e&&(this._events[m].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[m].length),"function"==typeof console.trace&&console.trace())),this},d.prototype.on=d.prototype.addListener,d.prototype.once=function(i,n){function m(){this.removeListener(i,m),e||(e=!0,n.apply(this,arguments))}if(!k(n)){throw TypeError("listener must be a function")}var e=!1;return m.listener=n,this.on(i,m),this},d.prototype.removeListener=function(e,m){var i,p,n,o;if(!k(m)){throw TypeError("listener must be a function")}if(!this._events||!this._events[e]){return this}if(i=this._events[e],n=i.length,p=-1,i===m||k(i.listener)&&i.listener===m){delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,m)}else{if(g(i)){for(o=n;o-->0;){if(i[o]===m||i[o].listener&&i[o].listener===m){p=o;break}}if(0>p){return this}1===i.length?(i.length=0,delete this._events[e]):i.splice(p,1),this._events.removeListener&&this.emit("removeListener",e,m)}}return this},d.prototype.removeAllListeners=function(m){var i,e;if(!this._events){return this}if(!this._events.removeListener){return 0===arguments.length?this._events={}:this._events[m]&&delete this._events[m],this}if(0===arguments.length){for(i in this._events){"removeListener"!==i&&this.removeAllListeners(i)}return this.removeAllListeners("removeListener"),this._events={},this}if(e=this._events[m],k(e)){this.removeListener(m,e)}else{if(e){for(;e.length;){this.removeListener(m,e[e.length-1])}}}return delete this._events[m],this},d.prototype.listeners=function(i){var e;return e=this._events&&this._events[i]?k(this._events[i])?[this._events[i]]:this._events[i].slice():[]},d.prototype.listenerCount=function(i){if(this._events){var e=this._events[i];if(k(e)){return 1}if(e){return e.length}}return 0},d.listenerCount=function(i,e){return i.listenerCount(e)}},{}],5:[function(f,d,c){(function(k){function e(){j=!0;for(var i,n,l=g.length;l;){for(n=g,g=[],i=-1;++i<l;){n[i]()}l=g.length}j=!1}function t(i){1!==g.push(i)||j||v()}var v,h=k.MutationObserver||k.WebKitMutationObserver;if(h){var m=0,q=new h(e),p=k.document.createTextNode("");q.observe(p,{characterData:!0}),v=function(){p.data=m=++m%2}}else{if(k.setImmediate||"undefined"==typeof k.MessageChannel){v="document" in k&&"onreadystatechange" in k.document.createElement("script")?function(){var i=k.document.createElement("script");i.onreadystatechange=function(){e(),i.onreadystatechange=null,i.parentNode.removeChild(i),i=null},k.document.documentElement.appendChild(i)}:function(){setTimeout(e,0)}}else{var w=new k.MessageChannel;w.port1.onmessage=e,v=function(){w.port2.postMessage(0)}}}var j,g=[];d.exports=t}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],6:[function(f,d,c){"function"==typeof Object.create?d.exports=function(g,e){g.super_=e,g.prototype=Object.create(e.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}})}:d.exports=function(g,e){g.super_=e;var h=function(){};h.prototype=e.prototype,g.prototype=new h,g.prototype.constructor=g}},{}],7:[function(f,d,c){(function(e){e("object"==typeof c?c:this)}).call(this,function(h){var e=Array.prototype.slice,i=Array.prototype.forEach,g=function(j){if("object"!=typeof j){throw j+" is not an object"}var k=e.call(arguments,1);return i.call(k,function(m){if(m){for(var l in m){"object"==typeof m[l]&&j[l]?g.call(j,j[l],m[l]):j[l]=m[l]}}}),j};h.extend=g})},{}],8:[function(A,k,w){function B(){}function j(e){if("function"!=typeof e){throw new TypeError("resolver must be a function")}this.state=F,this.queue=[],this.outcome=void 0,e!==B&&g(this,e)}function J(f,e,h){this.promise=f,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof h&&(this.onRejected=h,this.callRejected=this.otherCallRejected)}function H(f,e,h){E(function(){var i;try{i=e(h)}catch(l){return d.reject(f,l)}i===f?d.reject(f,new TypeError("Cannot resolve promise with itself")):d.resolve(f,i)})}function z(f){var e=f&&f.then;return f&&"object"==typeof f&&"function"==typeof e?function(){e.apply(f,arguments)}:void 0}function g(h,l){function f(o){e||(e=!0,d.reject(h,o))}function m(o){e||(e=!0,d.resolve(h,o))}function i(){l(m,f)}var e=!1,n=D(i);"error"===n.status&&f(n.value)}function D(e,h){var f={};try{f.value=e(h),f.status="success"}catch(i){f.status="error",f.value=i}return f}function x(e){return e instanceof this?e:d.resolve(new this(B),e)}function G(f){var e=new this(B);return d.reject(e,f)}function C(f){function h(r,s){function t(u){p[s]=u,++n!==i||m||(m=!0,d.resolve(o,p))}l.resolve(r).then(t,function(u){m||(m=!0,d.reject(o,u))})}var l=this;if("[object Array]"!==Object.prototype.toString.call(f)){return this.reject(new TypeError("must be an array"))}var i=f.length,m=!1;if(!i){return this.resolve([])}for(var p=new Array(i),n=0,e=-1,o=new this(B);++e<i;){h(f[e],e)}return o}function q(h){function l(o){f.resolve(o).then(function(p){e||(e=!0,d.resolve(m,p))},function(p){e||(e=!0,d.reject(m,p))})}var f=this;if("[object Array]"!==Object.prototype.toString.call(h)){return this.reject(new TypeError("must be an array"))}var i=h.length,e=!1;if(!i){return this.resolve([])}for(var n=-1,m=new this(B);++n<i;){l(h[n])}return m}var E=A(5),d={},c=["REJECTED"],I=["FULFILLED"],F=["PENDING"];k.exports=w=j,j.prototype["catch"]=function(e){return this.then(null,e)},j.prototype.then=function(i,h){if("function"!=typeof i&&this.state===I||"function"!=typeof h&&this.state===c){return this}var f=new this.constructor(B);if(this.state!==F){var e=this.state===I?i:h;H(f,e,this.outcome)}else{this.queue.push(new J(f,i,h))}return f},J.prototype.callFulfilled=function(e){d.resolve(this.promise,e)},J.prototype.otherCallFulfilled=function(e){H(this.promise,this.onFulfilled,e)},J.prototype.callRejected=function(e){d.reject(this.promise,e)},J.prototype.otherCallRejected=function(e){H(this.promise,this.onRejected,e)},d.resolve=function(m,f){var i=D(z,f);if("error"===i.status){return d.reject(m,i.value)}var l=i.value;if(l){g(m,l)}else{m.state=I,m.outcome=f;for(var h=-1,e=m.queue.length;++h<e;){m.queue[h].callFulfilled(f)}}return m},d.reject=function(e,h){e.state=c,e.outcome=h;for(var f=-1,i=e.queue.length;++f<i;){e.queue[f].callRejected(h)}return e},w.resolve=x,w.reject=G,w.all=C,w.race=q},{5:5}],9:[function(p,x,h){function d(i){if(i=""+i,!(i.length>10000)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(i);if(e){var l=parseFloat(e[1]),f=(e[2]||"ms").toLowerCase();switch(f){case"years":case"year":case"yrs":case"yr":case"y":return l*j;case"days":case"day":case"d":return l*m;case"hours":case"hour":case"hrs":case"hr":case"h":return l*q;case"minutes":case"minute":case"mins":case"min":case"m":return l*w;case"seconds":case"second":case"secs":case"sec":case"s":return l*c;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return l}}}}function g(e){return e>=m?Math.round(e/m)+"d":e>=q?Math.round(e/q)+"h":e>=w?Math.round(e/w)+"m":e>=c?Math.round(e/c)+"s":e+"ms"}function k(e){return v(e,m,"day")||v(e,q,"hour")||v(e,w,"minute")||v(e,c,"second")||e+" ms"}function v(f,e,i){return e>f?void 0:1.5*e>f?Math.floor(f/e)+" "+i:Math.ceil(f/e)+" "+i+"s"}var c=1000,w=60*c,q=60*w,m=24*q,j=365.25*m;x.exports=function(f,e){return e=e||{},"string"==typeof f?d(f):e["long"]?k(f):g(f)}},{}],10:[function(g,C,v){function k(e){if(null!==e){switch(typeof e){case"boolean":return e?1:0;case"number":return z(e);case"string":return e.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var l=Array.isArray(e),f=l?e:Object.keys(e),o=-1,i=f.length,h="";if(l){for(;++o<i;){h+=v.toIndexableString(f[o])}}else{for(;++o<i;){var n=f[o];h+=v.toIndexableString(n)+v.toIndexableString(e[n])}}return h}}return""}function q(e,l){var r,o=l,p="1"===e[l];if(p){r=0,l++}else{var s="0"===e[l];l++;var h="",n=e.substring(l,l+j),i=parseInt(n,10)+B;for(s&&(i=-i),l+=j;;){var f=e[l];if("\x00"===f){break}h+=f,l++}h=h.split("."),r=1===h.length?parseInt(h,10):parseFloat(h[0]+"."+h[1]),s&&(r-=10),0!==i&&(r=parseFloat(r+"e"+i))}return{num:r,length:l-o}}function d(f,o){var l=f.pop();if(o.length){var n=o[o.length-1];l===n.element&&(o.pop(),n=o[o.length-1]);var i=n.element,h=n.index;if(Array.isArray(i)){i.push(l)}else{if(h===f.length-2){var e=f.pop();i[e]=l}else{f.push(l)}}}}function c(f,l){for(var e=Math.min(f.length,l.length),h=0;e>h;h++){var i=v.collate(f[h],l[h]);if(0!==i){return i}}return f.length===l.length?0:f.length>l.length?1:-1}function x(f,e){return f===e?0:f>e?1:-1}function A(e,l){for(var f=Object.keys(e),o=Object.keys(l),i=Math.min(f.length,o.length),h=0;i>h;h++){var n=v.collate(f[h],o[h]);if(0!==n){return n}if(n=v.collate(e[f[h]],l[o[h]]),0!==n){return n}}return f.length===o.length?0:f.length>o.length?1:-1}function y(f){var e=["boolean","number","string","object"],h=e.indexOf(typeof f);return ~h?null===f?1:Array.isArray(f)?5:3>h?h+2:h+3:Array.isArray(f)?5:void 0}function z(r){if(0===r){return"1"}var h=r.toExponential().split(/e\+?/),o=parseInt(h[1],10),l=0>r,n=l?"0":"2",p=(l?-o:o)-B,e=m.padLeft(p.toString(),"0",j);n+=w+e;var i=Math.abs(parseFloat(h[0]));l&&(i=10-i);var f=i.toFixed(20);return f=f.replace(/\.?0+$/,""),n+=w+f}var B=-324,j=3,w="",m=g(11);v.collate=function(h,e){if(h===e){return 0}h=v.normalizeKey(h),e=v.normalizeKey(e);var f=y(h),i=y(e);if(f-i!==0){return f-i}if(null===h){return 0}switch(typeof h){case"number":return h-e;case"boolean":return h===e?0:e>h?-1:1;case"string":return x(h,e)}return Array.isArray(h)?c(h,e):A(h,e)},v.normalizeKey=function(l){switch(typeof l){case"undefined":return null;case"number":return l===1/0||l===-(1/0)||isNaN(l)?null:l;case"object":var h=l;if(Array.isArray(l)){var i=l.length;l=new Array(i);for(var e=0;i>e;e++){l[e]=v.normalizeKey(h[e])}}else{if(l instanceof Date){return l.toJSON()}if(null!==l){l={};for(var n in h){if(h.hasOwnProperty(n)){var f=h[n];"undefined"!=typeof f&&(l[n]=v.normalizeKey(f))}}}}}return l},v.toIndexableString=function(f){var e="\x00";return f=v.normalizeKey(f),y(f)+w+k(f)+e},v.parseIndexableString=function(e){for(var l=[],p=[],o=0;;){var h=e[o++];if("\x00"!==h){switch(h){case"1":l.push(null);break;case"2":l.push("1"===e[o]),o++;break;case"3":var n=q(e,o);l.push(n.num),o+=n.length;break;case"4":for(var i="";;){var f=e[o];if("\x00"===f){break}i+=f,o++}i=i.replace(/\u0001\u0001/g,"\x00").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),l.push(i);break;case"5":var s={element:[],index:l.length};l.push(s.element),p.push(s);break;case"6":var r={element:{},index:l.length};l.push(r.element),p.push(r);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+h)}}else{if(1===l.length){return l.pop()}d(l,p)}}}},{11:11}],11:[function(f,c,g){function d(k,i,h){for(var j="",e=h-k.length;j.length<e;){j+=i}return j}g.padLeft=function(h,e,j){var i=d(h,e,j);return i+h},g.padRight=function(h,e,j){var i=d(h,e,j);return h+i},g.stringLexCompare=function(j,h){var e,p=j.length,m=h.length;for(e=0;p>e;e++){if(e===m){return 1}var l=j.charAt(e),k=h.charAt(e);if(l!==k){return k>l?-1:1}}return m>p?-1:0},g.intToDecimalForm=function(i){var e=0>i,j="";do{var h=e?-Math.ceil(i%10):Math.floor(i%10);j=h+j,i=e?Math.ceil(i/10):Math.floor(i/10)}while(i);return e&&"0"!==j&&(j="-"+j),j}},{}],12:[function(d,h,g){function c(){this.store={}}function f(i){if(this.store=new c,i&&Array.isArray(i)){for(var e=0,j=i.length;j>e;e++){this.add(i[e])}}}g.Map=c,g.Set=f,c.prototype.mangle=function(e){if("string"!=typeof e){throw new TypeError("key must be a string but Got "+e)}return"$"+e},c.prototype.unmangle=function(e){return e.substring(1)},c.prototype.get=function(i){var e=this.mangle(i);return e in this.store?this.store[e]:void 0},c.prototype.set=function(i,e){var j=this.mangle(i);return this.store[j]=e,!0},c.prototype.has=function(i){var e=this.mangle(i);return e in this.store},c.prototype["delete"]=function(i){var e=this.mangle(i);return e in this.store?(delete this.store[e],!0):!1},c.prototype.forEach=function(e){for(var k=Object.keys(this.store),i=0,m=k.length;m>i;i++){var l=k[i],j=this.store[l];l=this.unmangle(l),e(j,l)}},f.prototype.add=function(e){return this.store.set(e,!0)},f.prototype.has=function(e){return this.store.has(e)},f.prototype["delete"]=function(e){return this.store["delete"](e)}},{}],13:[function(p,x,h){function d(){m=!1,c.length?q=c.concat(q):j=-1,q.length&&g()}function g(){if(!m){var f=setTimeout(d);m=!0;for(var e=q.length;e;){for(c=q,q=[];++j<e;){c&&c[j].run()}j=-1,e=q.length}c=null,m=!1,clearTimeout(f)}}function k(f,e){this.fun=f,this.array=e}function v(){}var c,w=x.exports={},q=[],m=!1,j=-1;w.nextTick=function(f){var e=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){e[i-1]=arguments[i]}}q.push(new k(f,e)),1!==q.length||m||setTimeout(g,0)},k.prototype.run=function(){this.fun.apply(null,this.array)},w.title="browser",w.browser=!0,w.env={},w.argv=[],w.version="",w.versions={},w.on=v,w.addListener=v,w.once=v,w.off=v,w.removeListener=v,w.removeAllListeners=v,w.emit=v,w.binding=function(e){throw new Error("process.binding is not supported")},w.cwd=function(){return"/"},w.chdir=function(e){throw new Error("process.chdir is not supported")},w.umask=function(){return 0}},{}],14:[function(f,d,c){(function(){var e={}.hasOwnProperty,g=[].slice;d.exports=function(h,l){var k,j,m,i;j=[],i=[];for(k in l){e.call(l,k)&&(m=l[k],"this"!==k&&(j.push(k),i.push(m)))}return Function.apply(null,g.call(j).concat([h])).apply(l["this"],i)}}).call(this)},{}],15:[function(d,c,e){!function(g){if("object"==typeof e){c.exports=g()}else{if("function"==typeof b&&b.amd){b(g)}else{var h;try{h=window}catch(f){h=self}h.SparkMD5=g()}}}(function(F){function A(m,h,n,l,i,g){return h=B(B(h,m),B(l,g)),B(h<<i|h>>>32-i,n)}function G(m,h,l,i,g,o,n){return A(h&l|~h&i,m,h,g,o,n)}function H(m,h,l,i,g,o,n){return A(h&i|l&~i,m,h,g,o,n)}function E(m,h,l,i,g,o,n){return A(h^l^i,m,h,g,o,n)}function x(m,h,l,i,g,o,n){return A(l^(h|~i),m,h,g,o,n)}function M(m,h){var n=m[0],l=m[1],g=m[2],i=m[3];n=G(n,l,g,i,h[0],7,-680876936),i=G(i,n,l,g,h[1],12,-389564586),g=G(g,i,n,l,h[2],17,606105819),l=G(l,g,i,n,h[3],22,-1044525330),n=G(n,l,g,i,h[4],7,-176418897),i=G(i,n,l,g,h[5],12,1200080426),g=G(g,i,n,l,h[6],17,-1473231341),l=G(l,g,i,n,h[7],22,-45705983),n=G(n,l,g,i,h[8],7,1770035416),i=G(i,n,l,g,h[9],12,-1958414417),g=G(g,i,n,l,h[10],17,-42063),l=G(l,g,i,n,h[11],22,-1990404162),n=G(n,l,g,i,h[12],7,1804603682),i=G(i,n,l,g,h[13],12,-40341101),g=G(g,i,n,l,h[14],17,-1502002290),l=G(l,g,i,n,h[15],22,1236535329),n=H(n,l,g,i,h[1],5,-165796510),i=H(i,n,l,g,h[6],9,-1069501632),g=H(g,i,n,l,h[11],14,643717713),l=H(l,g,i,n,h[0],20,-373897302),n=H(n,l,g,i,h[5],5,-701558691),i=H(i,n,l,g,h[10],9,38016083),g=H(g,i,n,l,h[15],14,-660478335),l=H(l,g,i,n,h[4],20,-405537848),n=H(n,l,g,i,h[9],5,568446438),i=H(i,n,l,g,h[14],9,-1019803690),g=H(g,i,n,l,h[3],14,-187363961),l=H(l,g,i,n,h[8],20,1163531501),n=H(n,l,g,i,h[13],5,-1444681467),i=H(i,n,l,g,h[2],9,-51403784),g=H(g,i,n,l,h[7],14,1735328473),l=H(l,g,i,n,h[12],20,-1926607734),n=E(n,l,g,i,h[5],4,-378558),i=E(i,n,l,g,h[8],11,-2022574463),g=E(g,i,n,l,h[11],16,1839030562),l=E(l,g,i,n,h[14],23,-35309556),n=E(n,l,g,i,h[1],4,-1530992060),i=E(i,n,l,g,h[4],11,1272893353),g=E(g,i,n,l,h[7],16,-155497632),l=E(l,g,i,n,h[10],23,-1094730640),n=E(n,l,g,i,h[13],4,681279174),i=E(i,n,l,g,h[0],11,-358537222),g=E(g,i,n,l,h[3],16,-722521979),l=E(l,g,i,n,h[6],23,76029189),n=E(n,l,g,i,h[9],4,-640364487),i=E(i,n,l,g,h[12],11,-421815835),g=E(g,i,n,l,h[15],16,530742520),l=E(l,g,i,n,h[2],23,-995338651),n=x(n,l,g,i,h[0],6,-198630844),i=x(i,n,l,g,h[7],10,1126891415),g=x(g,i,n,l,h[14],15,-1416354905),l=x(l,g,i,n,h[5],21,-57434055),n=x(n,l,g,i,h[12],6,1700485571),i=x(i,n,l,g,h[3],10,-1894986606),g=x(g,i,n,l,h[10],15,-1051523),l=x(l,g,i,n,h[1],21,-2054922799),n=x(n,l,g,i,h[8],6,1873313359),i=x(i,n,l,g,h[15],10,-30611744),g=x(g,i,n,l,h[6],15,-1560198380),l=x(l,g,i,n,h[13],21,1309151649),n=x(n,l,g,i,h[4],6,-145523070),i=x(i,n,l,g,h[11],10,-1120210379),g=x(g,i,n,l,h[2],15,718787259),l=x(l,g,i,n,h[9],21,-343485551),m[0]=B(n,m[0]),m[1]=B(l,m[1]),m[2]=B(g,m[2]),m[3]=B(i,m[3])}function C(i){var h,g=[];for(h=0;64>h;h+=4){g[h>>2]=i.charCodeAt(h)+(i.charCodeAt(h+1)<<8)+(i.charCodeAt(h+2)<<16)+(i.charCodeAt(h+3)<<24)}return g}function w(i){var h,g=[];for(h=0;64>h;h+=4){g[h>>2]=i[h]+(i[h+1]<<8)+(i[h+2]<<16)+(i[h+3]<<24)}return g}function J(g){var m,i,h,n,p,o,l=g.length,r=[1732584193,-271733879,-1732584194,271733878];for(m=64;l>=m;m+=64){M(r,C(g.substring(m-64,m)))}for(g=g.substring(m-64),i=g.length,h=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],m=0;i>m;m+=1){h[m>>2]|=g.charCodeAt(m)<<(m%4<<3)}if(h[m>>2]|=128<<(m%4<<3),m>55){for(M(r,h),m=0;16>m;m+=1){h[m]=0}}return n=8*l,n=n.toString(16).match(/(.*?)(.{0,8})$/),p=parseInt(n[2],16),o=parseInt(n[1],16)||0,h[14]=p,h[15]=o,M(r,h),r}function D(g){var o,i,h,n,p,m,l=g.length,r=[1732584193,-271733879,-1732584194,271733878];for(o=64;l>=o;o+=64){M(r,w(g.subarray(o-64,o)))}for(g=l>o-64?g.subarray(o-64):new Uint8Array(0),i=g.length,h=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],o=0;i>o;o+=1){h[o>>2]|=g[o]<<(o%4<<3)}if(h[o>>2]|=128<<(o%4<<3),o>55){for(M(r,h),o=0;16>o;o+=1){h[o]=0}}return n=8*l,n=n.toString(16).match(/(.*?)(.{0,8})$/),p=parseInt(n[2],16),m=parseInt(n[1],16)||0,h[14]=p,h[15]=m,M(r,h),r}function q(i){var h,g="";for(h=0;4>h;h+=1){g+=L[i>>8*h+4&15]+L[i>>8*h&15]}return g}function I(h){var g;for(g=0;g<h.length;g+=1){h[g]=q(h[g])}return h.join("")}function z(g){return/[\u0080-\uFFFF]/.test(g)&&(g=unescape(encodeURIComponent(g))),g}function k(m,h){var n,l=m.length,i=new ArrayBuffer(l),g=new Uint8Array(i);for(n=0;l>n;n+=1){g[n]=m.charCodeAt(n)}return h?g:i}function j(g){return String.fromCharCode.apply(null,new Uint8Array(g))}function f(l,g,h){var i=new Uint8Array(l.byteLength+g.byteLength);return i.set(new Uint8Array(l)),i.set(new Uint8Array(g),l.byteLength),h?i:i.buffer}function N(l){var g,h=[],i=l.length;for(g=0;i-1>g;g+=2){h.push(parseInt(l.substr(g,2),16))}return String.fromCharCode.apply(String,h)}function K(){this.reset()}var B=function(h,g){return h+g&4294967295},L=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return"5d41402abc4b2a76b9719d911017c592"!==I(J("hello"))&&(B=function(l,g){var h=(65535&l)+(65535&g),i=(l>>16)+(g>>16)+(h>>16);return i<<16|65535&h}),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||!function(){function g(i,h){return i=0|i||0,0>i?Math.max(i+h,0):Math.min(i,h)}ArrayBuffer.prototype.slice=function(h,r){var o,n,m,l,p=this.byteLength,i=g(h,p),s=p;return r!==F&&(s=g(r,p)),i>s?new ArrayBuffer(0):(o=s-i,n=new ArrayBuffer(o),m=new Uint8Array(n),l=new Uint8Array(this,i,o),m.set(l),n)}}(),K.prototype.append=function(g){return this.appendBinary(z(g)),this},K.prototype.appendBinary=function(i){this._buff+=i,this._length+=i.length;var h,g=this._buff.length;for(h=64;g>=h;h+=64){M(this._hash,C(this._buff.substring(h-64,h)))}return this._buff=this._buff.substring(h-64),this},K.prototype.end=function(m){var h,n,l=this._buff,i=l.length,g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(h=0;i>h;h+=1){g[h>>2]|=l.charCodeAt(h)<<(h%4<<3)}return this._finish(g,i),n=I(this._hash),m&&(n=N(n)),this.reset(),n},K.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},K.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},K.prototype.setState=function(g){return this._buff=g.buff,this._length=g.length,this._hash=g.hash,this},K.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},K.prototype._finish=function(m,h){var n,l,i,g=h;if(m[g>>2]|=128<<(g%4<<3),g>55){for(M(this._hash,m),g=0;16>g;g+=1){m[g]=0}}n=8*this._length,n=n.toString(16).match(/(.*?)(.{0,8})$/),l=parseInt(n[2],16),i=parseInt(n[1],16)||0,m[14]=l,m[15]=i,M(this._hash,m)},K.hash=function(h,g){return K.hashBinary(z(h),g)},K.hashBinary=function(l,g){var h=J(l),i=I(h);return g?N(i):i},K.ArrayBuffer=function(){this.reset()},K.ArrayBuffer.prototype.append=function(l){var g,h=f(this._buff.buffer,l,!0),i=h.length;for(this._length+=l.byteLength,g=64;i>=g;g+=64){M(this._hash,w(h.subarray(g-64,g)))}return this._buff=i>g-64?new Uint8Array(h.buffer.slice(g-64)):new Uint8Array(0),this},K.ArrayBuffer.prototype.end=function(m){var h,n,l=this._buff,i=l.length,g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(h=0;i>h;h+=1){g[h>>2]|=l[h]<<(h%4<<3)}return this._finish(g,i),n=I(this._hash),m&&(n=N(n)),this.reset(),n},K.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},K.ArrayBuffer.prototype.getState=function(){var g=K.prototype.getState.call(this);return g.buff=j(g.buff),g},K.ArrayBuffer.prototype.setState=function(g){return g.buff=k(g.buff,!0),K.prototype.setState.call(this,g)},K.ArrayBuffer.prototype.destroy=K.prototype.destroy,K.ArrayBuffer.prototype._finish=K.prototype._finish,K.ArrayBuffer.hash=function(l,g){var h=D(new Uint8Array(l)),i=I(h);return g?N(i):i},K})},{}],16:[function(f,c,g){function d(j,h,e){var p=e[e.length-1];j===p.element&&(e.pop(),p=e[e.length-1]);var m=p.element,l=p.index;if(Array.isArray(m)){m.push(j)}else{if(l===h.length-2){var k=h.pop();m[k]=j}else{h.push(j)}}}g.stringify=function(j){var q=[];q.push({obj:j});for(var z,x,v,m,B,w,h,e,A,k,p,y="";z=q.pop();){if(x=z.obj,v=z.prefix||"",m=z.val||"",y+=v,m){y+=m}else{if("object"!=typeof x){y+="undefined"==typeof x?null:JSON.stringify(x)}else{if(null===x){y+="null"}else{if(Array.isArray(x)){for(q.push({val:"]"}),B=x.length-1;B>=0;B--){w=0===B?"":",",q.push({obj:x[B],prefix:w})}q.push({val:"["})}else{h=[];for(e in x){x.hasOwnProperty(e)&&h.push(e)}for(q.push({val:"}"}),B=h.length-1;B>=0;B--){A=h[B],k=x[A],p=B>0?",":"",p+=JSON.stringify(A)+":",q.push({obj:k,prefix:p})}q.push({val:"{"})}}}}}return y},g.parse=function(h){for(var p,x,j,q,z,r,e,y,w,m=[],k=[],v=0;;){if(p=h[v++],"}"!==p&&"]"!==p&&"undefined"!=typeof p){switch(p){case" ":case"	":case"\n":case":":case",":break;case"n":v+=3,d(null,m,k);break;case"t":v+=3,d(!0,m,k);break;case"f":v+=4,d(!1,m,k);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(x="",v--;;){if(j=h[v++],!/[\d\.\-e\+]/.test(j)){v--;break}x+=j}d(parseFloat(x),m,k);break;case'"':for(q="",z=void 0,r=0;;){if(e=h[v++],'"'===e&&("\\"!==z||r%2!==1)){break}q+=e,z=e,"\\"===z?r++:r=0}d(JSON.parse('"'+q+'"'),m,k);break;case"[":y={element:[],index:m.length},m.push(y.element),k.push(y);break;case"{":w={element:{},index:m.length},m.push(w.element),k.push(w);break;default:throw new Error("unexpectedly reached end of input: "+p)}}else{if(1===m.length){return m.pop()}d(m.pop(),m,k)}}}},{}],17:[function(f,d,c){(function(eB,dl){function dJ(g){return g&&"object"==typeof g&&"default" in g?g["default"]:g}function dh(l,j){for(var i={},k=0,h=j.length;h>k;k++){var g=j[k];g in l&&(i[g]=l[g])}return i}function fP(g){return g instanceof ArrayBuffer||"undefined"!=typeof Blob&&g instanceof Blob}function jM(g){if("function"==typeof g.slice){return g.slice(0)}var i=new ArrayBuffer(g.byteLength),h=new Uint8Array(i),j=new Uint8Array(g);return h.set(j),i}function fL(g){if(g instanceof ArrayBuffer){return jM(g)}var i=g.size,h=g.type;return"function"==typeof g.slice?g.slice(0,i,h):g.webkitSlice(0,i,h)}function e5(k){var i,h,j;if(!k||"object"!=typeof k){return k}if(Array.isArray(k)){for(i=[],h=0,j=k.length;j>h;h++){i[h]=e5(k[h])}return i}if(k instanceof Date){return k.toISOString()}if(fP(k)){return fL(k)}i={};for(h in k){if(Object.prototype.hasOwnProperty.call(k,h)){var g=e5(k[h]);"undefined"!=typeof g&&(i[h]=g)}}return i}function eJ(h){var g=!1;return aG(function(i){if(g){throw new Error("once called more than once")}g=!0,h.apply(this,i)})}function fC(g){return aG(function(j){j=e5(j);var k,l=this,i="function"==typeof j[j.length-1]?j.pop():!1;i&&(k=function(n,m){eB.nextTick(function(){i(n,m)})});var h=new e(function(o,n){var q;try{var p=eJ(function(r,s){r?n(r):o(s)});j.push(p),q=g.apply(l,j),q&&"function"==typeof q.then&&o(q)}catch(m){n(m)}});return k&&h.then(function(m){k(null,m)},k),h})}function d5(g,i){function h(o,m,k){if(bM.enabled){for(var n=[o._db_name,m],j=0;j<k.length-1;j++){n.push(k[j])}bM.apply(null,n);var l=k[k.length-1];k[k.length-1]=function(r,p){var q=[o._db_name,m];q=q.concat(r?["error",r]:["success",p]),bM.apply(null,q),l(r,p)}}}return fC(aG(function(j){if(this._closed){return e.reject(new Error("database is closed"))}if(this._destroyed){return e.reject(new Error("database is destroyed"))}var k=this;return h(k,g,j),this.taskqueue.isReady?i.apply(this,j):new e(function(l,m){k.taskqueue.addTask(function(n){n?m(n):l(k[g].apply(k,j))})})}))}function fI(g,i,h){return new e(function(j,k){g.get(i,function(l,n){if(l){if(404!==l.status){return k(l)}n={}}var m=n._rev,o=h(n);return o?(o._id=i,o._rev=m,void j(dP(g,o,h))):j({updated:!1,rev:m})})})}function dP(g,i,h){return g.put(i).then(function(j){return{updated:!0,rev:j.rev}},function(j){if(409!==j.status){throw j}return fI(g,i._id,h)})}function fK(r){for(var n,q,o,p,g=r.rev_tree.slice();p=g.pop();){var l=p.ids,h=l[2],m=p.pos;if(h.length){for(var k=0,i=h.length;i>k;k++){g.push({pos:m+1,ids:h[k]})}}else{var s=!!l[1].deleted,j=l[0];n&&!(o!==s?o:q!==m?m>q:j>n)||(n=j,q=m,o=s)}}return q+"-"+n}function j5(g){return g.ids}function f5(k,i){i||(i=fK(k));for(var h,j=i.substring(i.indexOf("-")+1),g=k.rev_tree.map(j5);h=g.pop();){if(h[0]===j){return !!h[1].deleted}g=g.concat(h[2])}}function ej(g){return ec("return "+g+";",{})}function ac(g){return new Function("doc",["var emitted = false;","var emit = function (a, b) {","  emitted = true;","};","var view = "+g+";","view(doc);","if (emitted) {","  return true;","}"].join("\n"))}function cw(h){if(!h){return null}var g=h.split("/");return 2===g.length?g:1===g.length?[h,h]:null}function kd(h){var g=cw(h);return g?g.join("/"):null}function j8(g,i){for(var m,k=g.slice();m=k.pop();){for(var l=m.pos,o=m.ids,h=o[2],j=i(0===h.length,l,o[0],m.ctx,o[1]),p=0,n=h.length;n>p;p++){k.push({pos:l+1,ids:h[p],ctx:j})}}}function jO(h,g){return h.pos-g.pos}function e0(g){var i=[];j8(g,function(o,l,n,k,m){o&&i.push({rev:l+"-"+n,pos:l,opts:m})}),i.sort(jO).reverse();for(var h=0,j=i.length;j>h;h++){delete i[h].pos}return i}function eW(i){for(var l=fK(i),g=e0(i.rev_tree),m=[],j=0,k=g.length;k>j;j++){var h=g[j];h.rev===l||h.opts.deleted||m.push(h.rev)}return m}function j7(g){Error.call(this,g.reason),this.status=g.status,this.name=g.error,this.message=g.reason,this.error=!0}function kb(g,i,h){function j(k){for(var l in g){"function"!=typeof g[l]&&(this[l]=g[l])}void 0!==h&&(this.name=h),void 0!==k&&(this.reason=k)}return j.prototype=j7.prototype,new j(i)}function c7(l){var j,i,k,h,g;return i=l.error===!0&&"string"==typeof l.name?l.name:l.error,g=l.reason,k=j1("name",i,g),l.missing||"missing"===g||"deleted"===g||"not_found"===i?k=aO:"doc_validation"===i?(k=b4,h=g):"bad_request"===i&&k.message!==g&&(k=aQ),k||(k=j1("status",l.status,g)||bS),j=kb(k,g,i),h&&(j.message=h),l.id&&(j.id=l.id),l.status&&(j.status=l.status),l.missing&&(j.missing=l.missing),j}function f1(i,l,g){function m(){j.cancel()}aq.EventEmitter.call(this);var j=this;this.db=i,l=l?e5(l):{};var k=l.complete=eJ(function(o,n){o?j.emit("error",o):j.emit("complete",n),j.removeAllListeners(),i.removeListener("destroyed",m)});g&&(j.on("complete",function(n){g(null,n)}),j.on("error",g)),i.once("destroyed",m),l.onChange=function(n){l.isCancelled||(j.emit("change",n),j.startSeq&&j.startSeq<=n.seq&&(j.startSeq=!1))};var h=new e(function(o,n){l.complete=function(p,q){p?n(p):o(q)}});j.once("cancel",function(){i.removeListener("destroyed",m),l.complete(null,{status:"cancelled"})}),this.then=h.then.bind(h),this["catch"]=h["catch"].bind(h),this.then(function(n){k(null,n)},k),i.taskqueue.isReady?j.doChanges(l):i.taskqueue.addTask(function(){j.isCancelled?j.emit("cancel"):j.doChanges(l)})}function eE(k,i,h){var j=[{rev:k._rev}];"all_docs"===h.style&&(j=e0(i.rev_tree).map(function(l){return{rev:l.rev}}));var g={id:i.id,changes:j,doc:k};return f5(i,k._rev)&&(g.deleted=!0),h.conflicts&&(g.doc._conflicts=eW(i),g.doc._conflicts.length||delete g.doc._conflicts),g}function eD(p,j,n){function l(){var r=[];o.forEach(function(s){s.docs.forEach(function(u){r.push({id:s.id,docs:[u]})})}),n(null,{results:r})}function m(){++q===h&&l()}function g(r,u,s){o[r]={id:u,docs:s},m()}var k=Array.isArray(j)?j:j.docs,i={};k.forEach(function(r){r.id in i?i[r.id].push(r):i[r.id]=[r]});var h=Object.keys(i).length,q=0,o=new Array(h);Object.keys(i).forEach(function(r,v){var s=i[r],w=dh(s[0],["atts_since","attachments"]);w.open_revs=s.map(function(x){return x.rev}),w.open_revs=w.open_revs.filter(function(x){return x});var u=function(x){return x};0===w.open_revs.length&&(delete w.open_revs,u=function(x){return[{ok:x}]}),["revs","attachments","binary","ajax"].forEach(function(x){x in j&&(w[x]=j[x])}),p.get(r,w,function(x,y){g(v,r,x?[{error:x}]:u(y))})})}function kg(g){return/^_local/.test(g)}function aa(r){for(var n,q=[],o=r.slice();n=o.pop();){var p=n.pos,g=n.ids,l=g[0],h=g[1],m=g[2],k=0===m.length,i=n.history?n.history.slice():[];i.push({id:l,opts:h}),k&&q.push({pos:p+1-i.length,ids:i});for(var s=0,j=m.length;j>s;s++){o.push({pos:p+1,ids:m[s],history:i})}}return q.reverse()}function jQ(g){return 0|Math.random()*g}function kh(g,i){i=i||c8.length;var h="",j=-1;if(g){for(;++j<g;){h+=c8[jQ(i)]}return h}for(;++j<36;){switch(j){case 8:case 13:case 18:case 23:h+="-";break;case 19:h+=c8[3&jQ(16)|8];break;default:h+=c8[jQ(16)]}}return h}function f2(g){return g.reduce(function(i,h){return i[h]=!0,i},{})}function j4(h){var g;if(h?"string"!=typeof h?g=kb(jL):/^_/.test(h)&&!/^_(design|local)/.test(h)&&(g=kb(dK)):g=kb(b8),g){throw g}}function f6(g){if(!/^\d+\-./.test(g)){return kb(ab)}var i=g.indexOf("-"),h=g.substring(0,i),j=g.substring(i+1);return{prefix:parseInt(h,10),id:j}}function jW(i,l){for(var g=i.start-i.ids.length+1,m=i.ids,j=[m[0],l,[]],k=1,h=m.length;h>k;k++){j=[m[k],{status:"missing"},[j]]}return[{pos:g,ids:j}]}function d1(g,i){var m,k,l,o={status:"available"};if(g._deleted&&(o.deleted=!0),i){if(g._id||(g._id=kh()),k=kh(32,16).toLowerCase(),g._rev){if(l=f6(g._rev),l.error){return l}g._rev_tree=[{pos:l.prefix,ids:[l.id,{status:"missing"},[[k,o,[]]]]}],m=l.prefix+1}else{g._rev_tree=[{pos:1,ids:[k,o,[]]}],m=1}}else{if(g._revisions&&(g._rev_tree=jW(g._revisions,o),m=g._revisions.start,k=g._revisions.ids[0]),!g._rev_tree){if(l=f6(g._rev),l.error){return l}m=l.prefix,k=l.id,g._rev_tree=[{pos:m,ids:[k,o,[]]}]}}j4(g._id),g._rev=m+"-"+k;var h={metadata:{},data:{}};for(var j in g){if(Object.prototype.hasOwnProperty.call(g,j)){var p="_"===j[0];if(p&&!bc[j]){var n=kb(b4,j);throw n.message=b4.message+": "+j,n}p&&!dS[j]?h.metadata[j.slice(1)]=g[j]:h.data[j]=g[j]}}return h}function jV(h,g){return g>h?-1:h>g?1:0}function kj(g,i){for(var h=0;h<g.length;h++){if(i(g[h],h)===!0){return g[h]}}}function af(g){return function(h,i){h||i[0]&&i[0].error?g(h||i[0]):g(null,i.length?i[0]:i)}}function e1(l){for(var j=0;j<l.length;j++){var i=l[j];if(i._deleted){delete i._attachments}else{if(i._attachments){for(var k=Object.keys(i._attachments),h=0;h<k.length;h++){var g=k[h];i._attachments[g]=dh(i._attachments[g],["data","digest","content_type","length","revpos","stub"])}}}}}function ag(k,i){var h=jV(k._id,i._id);if(0!==h){return h}var j=k._revisions?k._revisions.start:0,g=i._revisions?i._revisions.start:0;return jV(j,g)}function eg(g){var i={},h=[];return j8(g,function(j,n,k,m){var l=n+"-"+k;return j&&(i[l]=0),void 0!==m&&h.push({from:m,to:l}),l}),h.reverse(),h.forEach(function(j){void 0===i[j.from]?i[j.from]=1+i[j.to]:i[j.from]=Math.min(i[j.from],1+i[j.to])}),i}function d3(k,i,h){var j="limit" in i?i.keys.slice(i.skip,i.limit+i.skip):i.skip>0?i.keys.slice(i.skip):i.keys;if(i.descending&&j.reverse(),!j.length){return k._allDocs({limit:0},h)}var g={offset:i.skip};return e.all(j.map(function(m){var l=e3.extend({key:m,deleted:"ok"},i);return["limit","skip","keys"].forEach(function(n){delete l[n]}),new e(function(o,n){k._allDocs(l,function(q,p){return q?n(q):(g.total_rows=p.total_rows,void o(p.rows[0]||{key:m,error:"not_found"}))})})})).then(function(l){return g.rows=l,g})}function eL(g){var i=g._compactionQueue[0],j=i.opts,h=i.callback;g.get("_local/compaction")["catch"](function(){return !1}).then(function(k){k&&k.last_seq&&(j.last_seq=k.last_seq),g._compact(j,function(l,m){l?h(l):h(null,m),eB.nextTick(function(){g._compactionQueue.shift(),g._compactionQueue.length&&eL(g)})})})}function jF(g){return"_"===g.charAt(0)?g+"is not a valid attachment name, attachment names cannot start with '_'":!1}function jR(k,i,h,j){i.seq=i.seq||0;var g={doc_ids:["_design/"+h],limit:1,since:i.seq};k.changes(g).then(function(l){var m=l.results&&l.results.length&&l.results[0].seq;m&&m>i.seq&&(i.seq=m,delete i.promise),j()})["catch"](j)}function fJ(g,i,h){g._ddocCache=g._ddocCache||{},g._ddocCache[i]=g._ddocCache[i]||{};var j=g._ddocCache[i];jR(g,j,i,function(k){return k?h(k):(j.promise||(j.promise=new e(function(m,l){g._get("_design/"+i,{},function(n,p){if(n){return l(n)}var o={};["views","filters"].forEach(function(q){o[q]=p.doc[q]}),m(o)})})),void j.promise.then(function(l){h(null,l)})["catch"](h))})}function ad(k,i,h,j,g){fJ(k,i,function(m,l){if(m){return g(m)}var n=l[h]&&l[h][j];return n?void g(null,n):g(kb(aO))})}function f3(){aq.EventEmitter.call(this)}function dA(){this.isReady=!1,this.failed=!1,this.queue=[]}function jX(g){g&&dl.debug&&console.error(g)}function aU(i,l){function g(){k.emit("destroyed",j)}function m(){i.removeListener("destroyed",g),i.emit("destroyed",i)}var j=l.originalName,k=i.constructor,h=k._destructionListeners;i.once("destroyed",g),h.has(j)||h.set(j,[]),h.get(j).push(m)}function bH(l,j,i){if(!(this instanceof bH)){return new bH(l,j,i)}var k=this;"function"!=typeof j&&"undefined"!=typeof j||(i=j,j={}),l&&"object"==typeof l&&(j=l,l=void 0),"undefined"==typeof i&&(i=jX),l=l||j.name,j=e5(j),delete j.name,this.__opts=j;var h=i;k.auto_compaction=j.auto_compaction,k.prefix=bH.prefix,f3.call(k),k.taskqueue=new dA;var g=new e(function(o,m){i=function(r,s){return r?m(r):(delete s.then,void o(s))},j=e5(j);var p,n,q=j.name||l;return function(){try{if("string"!=typeof q){throw n=new Error("Missing/invalid DB name"),n.code=400,n}if(p=bH.parseAdapter(q,j),j.originalName=q,j.name=p.name,j.prefix&&"http"!==p.adapter&&"https"!==p.adapter&&(j.name=j.prefix+j.name),j.adapter=j.adapter||p.adapter,k._adapter=j.adapter,aR("pouchdb:adapter")("Picked adapter: "+j.adapter),k._db_name=q,!bH.adapters[j.adapter]){throw n=new Error("Adapter is missing"),n.code=404,n}if(!bH.adapters[j.adapter].valid()){throw n=new Error("Invalid Adapter"),n.code=404,n}}catch(r){k.taskqueue.fail(r)}}(),n?m(n):(k.adapter=j.adapter,k.replicate={},k.replicate.from=function(r,u,s){return k.constructor.replicate(r,k,u,s)},k.replicate.to=function(r,u,s){return k.constructor.replicate(k,r,u,s)},k.sync=function(r,u,s){return k.constructor.sync(k,r,u,s)},k.replicate.sync=k.sync,void bH.adapters[j.adapter].call(k,j,function(r){return r?(k.taskqueue.fail(r),void i(r)):(aU(k,j),k.emit("created",k),bH.emit("created",j.originalName),k.taskqueue.ready(k),void i(null,k))}))});g.then(function(m){h(null,m)},h),k.then=g.then.bind(g),k["catch"]=g["catch"].bind(g)}function eK(){return"undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage&&"undefined"!=typeof chrome.storage.local}function jY(){return dN}function kc(h){Object.keys(aq.EventEmitter.prototype).forEach(function(i){"function"==typeof aq.EventEmitter.prototype[i]&&(h[i]=fO[i].bind(fO))});var g=h._destructionListeners=new ck.Map;h.on("destroyed",function(i){g.has(i)&&(g.get(i).forEach(function(j){j()}),g["delete"](i))})}function aZ(l,j){l=l||[],j=j||{};try{return new Blob(l,j)}catch(i){if("TypeError"!==i.name){throw i}for(var k="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder,h=new k,g=0;g<l.length;g+=1){h.append(l[g])}return h.getBlob(j.type)}}function az(g,i){if("undefined"==typeof FileReader){return i((new FileReaderSync).readAsArrayBuffer(g))}var h=new FileReader;h.onloadend=function(j){var k=j.target.result||new ArrayBuffer(0);i(k)},h.readAsArrayBuffer(g)}function dw(){for(var g={},i=new e(function(k,l){g.resolve=k,g.reject=l}),h=new Array(arguments.length),j=0;j<h.length;j++){h[j]=arguments[j]}return g.promise=i,e.resolve().then(function(){return fetch.apply(null,h)}).then(function(k){g.resolve(k)})["catch"](function(k){g.reject(k)}),g}function cg(i,l){var g,m,j,k=new Headers,h={method:i.method,credentials:"include",headers:k};return i.json&&(k.set("Accept","application/json"),k.set("Content-Type",i.headers["Content-Type"]||"application/json")),i.body&&i.body instanceof Blob?az(i.body,function(n){h.body=n}):i.body&&i.processData&&"string"!=typeof i.body?h.body=JSON.stringify(i.body):"body" in i?h.body=i.body:h.body=null,Object.keys(i.headers).forEach(function(n){i.headers.hasOwnProperty(n)&&k.set(n,i.headers[n])}),g=dw(i.url,h),i.timeout>0&&(m=setTimeout(function(){g.reject(new Error("Load timeout for resource: "+i.url))},i.timeout)),g.promise.then(function(n){return j={statusCode:n.status},i.timeout>0&&clearTimeout(m),j.statusCode>=200&&j.statusCode<300?i.binary?n.blob():n.text():n.json()}).then(function(n){j.statusCode>=200&&j.statusCode<300?l(null,j,n):l(n,j)})["catch"](function(n){l(n,j)}),{abort:g.reject}}function b6(o,g){var l,j,k=!1,m=function(){l.abort()},n=function(){k=!0,l.abort()};l=o.xhr?new o.xhr:new XMLHttpRequest;try{l.open(o.method,o.url)}catch(i){g(i,{statusCode:413})}l.withCredentials="withCredentials" in o?o.withCredentials:!0,"GET"===o.method?delete o.headers["Content-Type"]:o.json&&(o.headers.Accept="application/json",o.headers["Content-Type"]=o.headers["Content-Type"]||"application/json",o.body&&o.processData&&"string"!=typeof o.body&&(o.body=JSON.stringify(o.body))),o.binary&&(l.responseType="arraybuffer"),"body" in o||(o.body=null);for(var h in o.headers){o.headers.hasOwnProperty(h)&&l.setRequestHeader(h,o.headers[h])}return o.timeout>0&&(j=setTimeout(n,o.timeout),l.onprogress=function(){clearTimeout(j),4!==l.readyState&&(j=setTimeout(n,o.timeout))},"undefined"!=typeof l.upload&&(l.upload.onprogress=l.onprogress)),l.onreadystatechange=function(){if(4===l.readyState){var s={statusCode:l.status};if(l.status>=200&&l.status<300){var q;q=o.binary?aZ([l.response||""],{type:l.getResponseHeader("Content-Type")}):l.responseText,g(null,s,q)}else{var p={};if(k){p=new Error("ETIMEDOUT"),s.statusCode=400}else{try{p=JSON.parse(l.response)}catch(r){}}g(p,s)}}},o.body&&o.body instanceof Blob?az(o.body,function(p){l.send(p)}):l.send(o.body),{abort:m}}function bR(){try{return new XMLHttpRequest,!0}catch(g){return !1}}function fA(h,g){return dZ||h.xhr?b6(h,g):cg(h,g)}function bj(){return""}function bd(k,i){function h(n,m,o){if(!k.binary&&k.json&&"string"==typeof n){try{n=JSON.parse(n)}catch(l){return o(l)}}Array.isArray(n)&&(n=n.map(function(p){return p.error||p.missing?c7(p):p})),k.binary&&dy(n,m),o(null,n,m)}function j(q,o){var m,p;if(q.code&&q.status){var l=new Error(q.message||q.code);return l.status=q.status,o(l)}if(q.message&&"ETIMEDOUT"===q.message){return o(q)}try{m=JSON.parse(q.responseText),p=c7(m)}catch(n){p=c7(q)}o(p)}k=e5(k);var g={method:"GET",headers:{},json:!0,processData:!0,timeout:10000,cache:!1};return k=e3.extend(g,k),k.json&&(k.binary||(k.headers.Accept="application/json"),k.headers["Content-Type"]=k.headers["Content-Type"]||"application/json"),k.binary&&(k.encoding=null,k.json=!1),k.processData||(k.json=!1),fA(k,function(l,p,n){if(l){return l.status=p?p.statusCode:400,j(l,i)}var q,o=p.headers&&p.headers["content-type"],m=n||bj();if(!k.binary&&(k.json||!k.processData)&&"object"!=typeof m&&(/json/.test(o)||/^[\s]*\{/.test(m)&&/\}[\s]*$/.test(m))){try{m=JSON.parse(m.toString())}catch(r){}}p.statusCode>=200&&p.statusCode<300?h(m,p,i):(q=c7(m),q.status=p.statusCode,i(q))})}function jS(g,i){var m=navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",k=-1!==m.indexOf("safari")&&-1===m.indexOf("chrome"),l=-1!==m.indexOf("msie"),o=-1!==m.indexOf("edge"),h=k||(l||o)&&"GET"===g.method,j="cache" in g?g.cache:!0,p=/^blob:/.test(g.url);if(!p&&(h||!j)){var n=-1!==g.url.indexOf("?");g.url+=(n?"&":"?")+"_nonce="+Date.now()}return bd(g,i)}function aC(i){for(var l=e6.exec(i),g={},m=14;m--;){var j=aA[m],k=l[m]||"",h=-1!==["user","password"].indexOf(j);g[j]=h?decodeURIComponent(k):k}return g[dk]={},g[aA[12]].replace(aI,function(n,o,p){o&&(g[dk][o]=p)}),g}function cH(k){for(var i=k.length,h=new ArrayBuffer(i),j=new Uint8Array(h),g=0;i>g;g++){j[g]=k.charCodeAt(g)}return h}function bK(h,g){return aZ([cH(h)],{type:g})}function ea(k,i,h){try{return !k(i,h)}catch(j){var g="Filter function threw: "+j.toString();return kb(aQ,g)}}function eT(g){var i={},h=g.filter&&"function"==typeof g.filter;return i.query=g.query_params,function(k){k.doc||(k.doc={});var l=h&&ea(g.filter,k.doc,i);if("object"==typeof l){return l}if(l){return !1}if(g.include_docs){if(!g.attachments){for(var j in k.doc._attachments){k.doc._attachments.hasOwnProperty(j)&&(k.doc._attachments[j].stub=!0)}}}else{delete k.doc}return !0}}function b0(h,g){"console" in dl&&"info" in console&&console.info("The above "+h+" is totally normal. "+g)}function bG(k,i,h,j,g){return k.get(i)["catch"](function(l){if(404===l.status){return"http"===k.type()&&b0(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:j,_id:i,history:[],replicator:c2,version:eP}}throw l}).then(function(l){return g.cancelled?void 0:(l.history=(l.history||[]).filter(function(m){return m.session_id!==j}),l.history.unshift({last_seq:h,session_id:j}),l.history=l.history.slice(0,cy),l.version=eP,l.replicator=c2,l.session_id=j,l.last_seq=h,k.put(l)["catch"](function(m){if(409===m.status){return bG(k,i,h,j,g)}throw m}))})}function aE(g,i,h,j){this.src=g,this.target=i,this.id=h,this.returnValue=j}function dO(g,i){if(g.session_id===i.session_id){return{last_seq:g.last_seq,history:g.history||[]}}var h=g.history||[],j=i.history||[];return b2(h,j)}function b2(l,n){var i=l[0],g=l.slice(1),h=n[0],m=n.slice(1);if(!i||0===n.length){return{last_seq:au,history:[]}}var k=i.session_id;if(a8(k,n)){return{last_seq:i.last_seq,history:l}}var j=h.session_id;return a8(j,g)?{last_seq:h.last_seq,history:m}:b2(g,m)}function a8(g,i){var h=i[0],j=i.slice(1);return g&&0!==i.length?g===h.session_id?!0:a8(g,j):!1}function c3(g){return"number"==typeof g.status&&4===Math.floor(g.status/100)}function cl(g,i){g=parseInt(g,10)||0,i=parseInt(i,10),i!==i||g>=i?i=(g||1)<<1:i+=1;var h=Math.random(),j=i-g;return ~~(j*h+g)}function dz(h){var g=0;return h||(g=2000),cl(h,g)}function c1(g,i,h,j){return g.retry===!1?(i.emit("error",h),void i.removeAllListeners()):("function"!=typeof g.back_off_function&&(g.back_off_function=dz),i.emit("requestError",h),"active"!==i.state&&"pending"!==i.state||(i.emit("paused",h),i.state="stopped",i.once("active",function(){g.current_back_off=bW})),g.current_back_off=g.current_back_off||bW,g.current_back_off=g.back_off_function(g.current_back_off),void setTimeout(j,g.current_back_off))}function fM(g){return fH(g)}function t(g,i,h,j){(h>0||j<i.byteLength)&&(i=new Uint8Array(i,h,Math.min(j,i.byteLength)-h)),g.append(i)}function aJ(g,i,h,j){(h>0||j<i.length)&&(i=i.substring(h,j)),g.appendBinary(i)}function bl(g){return Object.keys(g).sort(bL.collate).reduce(function(h,i){return h[i]=g[i],h},{})}function bP(i,l,g){var m=g.doc_ids?g.doc_ids.sort(bL.collate):"",j=g.filter?g.filter.toString():"",k="",h="";return g.filter&&g.query_params&&(k=JSON.stringify(bl(g.query_params))),g.filter&&"_view"===g.filter&&(h=g.view.toString()),e.all([i.id(),l.id()]).then(function(n){var o=n[0]+n[1]+j+h+k+m;return ef(o)}).then(function(n){return n=n.replace(/\//g,".").replace(/\+/g,"_"),"_local/"+n})}function el(g){return/^1-/.test(g)}function aX(h){var g=[];return Object.keys(h).forEach(function(j){var i=h[j].missing;i.forEach(function(k){g.push({id:j,rev:k})})}),{docs:g,revs:!0,attachments:!0,binary:!0}}function aK(o,i,m){function k(){var q=aX(i);if(q.docs.length){return o.bulkGet(q).then(function(r){if(m.cancelled){throw new Error("cancelled")}r.results.forEach(function(s){s.docs.forEach(function(u){u.ok?g.push(u.ok):void 0!==u.error&&(p=!1)})})})}}function l(q){return q._attachments&&Object.keys(q._attachments).length>0}function n(q){return o.allDocs({keys:q,include_docs:!0}).then(function(r){if(m.cancelled){throw new Error("cancelled")}r.rows.forEach(function(s){!s.deleted&&s.doc&&el(s.value.rev)&&!l(s.doc)&&(g.push(s.doc),delete i[s.id])})})}function h(){var q=Object.keys(i).filter(function(r){var s=i[r].missing;return 1===s.length&&el(s[0])});return q.length>0?n(q):void 0}function j(){return{ok:p,docs:g}}i=e5(i);var g=[],p=!0;return e.resolve().then(h).then(k).then(j)}function bf(E,M,n,i,m){function u(){return x?e.resolve():bP(E,M,n).then(function(T){P=T,x=new aE(E,M,P,i)})}function h(){if(R=[],0!==C.docs.length){var T=C.docs;return M.bulkDocs({docs:T,new_edits:!1}).then(function(Y){if(i.cancelled){throw l(),new Error("cancelled")}var V=[],X={};Y.forEach(function(Z){Z.error&&(m.doc_write_failures++,V.push(Z),X[Z.id]=Z)}),D=D.concat(V),m.docs_written+=C.docs.length-V.length;var W=V.filter(function(Z){return"unauthorized"!==Z.name&&"forbidden"!==Z.name});if(T.forEach(function(Z){var ae=X[Z._id];ae?i.emit("denied",e5(ae)):R.push(Z)}),W.length>0){var U=new Error("bulkDocs error");throw U.other_errors=V,v("target.bulkDocs failed to write docs",U),new Error("bulkWrite partial failure")}},function(U){throw m.doc_write_failures+=T.length,U})}}function N(){if(C.error){throw new Error("There was a problem getting docs.")}m.last_seq=B=C.seq;var T=e5(m);return R.length&&(T.docs=R,i.emit("change",T)),y=!0,x.writeCheckpoint(C.seq,F).then(function(){if(y=!1,i.cancelled){throw l(),new Error("cancelled")}C=void 0,p()})["catch"](function(U){throw y=!1,v("writeCheckpoint completed with error",U),U})}function H(){var T={};return C.changes.forEach(function(U){"_user/"!==U.id&&(T[U.id]=U.changes.map(function(V){return V.rev}))}),M.revsDiff(T).then(function(U){if(i.cancelled){throw l(),new Error("cancelled")}C.diffs=U})}function z(){return aK(E,C.diffs,i).then(function(T){C.error=!T.ok,T.docs.forEach(function(U){delete C.diffs[U._id],m.docs_read++,C.docs.push(U)})})}function q(){if(!i.cancelled&&!C){if(0===r.length){return void I(!0)}C=r.shift(),H().then(z).then(h).then(N).then(q)["catch"](function(T){v("batch processing terminated with error",T)})}}function I(T){return 0===k.changes.length?void (0!==r.length||C||((s&&O.live||g)&&(i.state="pending",i.emit("paused")),g&&l())):void ((T||g||k.changes.length>=Q)&&(r.push(k),k={seq:0,changes:[],docs:[]},"pending"!==i.state&&"stopped"!==i.state||(i.state="active",i.emit("active")),q()))}function v(U,T){o||(T.message||(T.message=U),m.ok=!1,m.status="aborting",m.errors.push(T),D=D.concat(T),r=[],k={seq:0,changes:[],docs:[]},l())}function l(){if(!(o||i.cancelled&&(m.status="cancelled",y))){m.status=m.status||"complete",m.end_time=new Date,m.last_seq=B,o=!0;var U=D.filter(function(V){return"unauthorized"!==V.name&&"forbidden"!==V.name});if(U.length>0){var T=D.pop();D.length>0&&(T.other_errors=D),T.result=m,c1(n,i,T,function(){bf(E,M,n,i)})}else{m.errors=D,i.emit("complete",m),i.removeAllListeners()}}}function G(U){if(i.cancelled){return l()}var T=eT(n)(U);T&&(k.seq=U.seq,k.changes.push(U),I(O.live))}function S(T){return J=!1,i.cancelled?l():(T.results.length>0?(O.since=T.last_seq,p()):s?(O.live=!0,p()):g=!0,void I(!0))}function j(T){return J=!1,i.cancelled?l():void v("changes rejected",T)}function p(){function T(){V.cancel()}function U(){i.removeListener("cancel",T)}if(!J&&!g&&r.length<K){J=!0,i._changes&&(i.removeListener("cancel",i._abortChanges),i._changes.cancel()),i.once("cancel",T);var V=E.changes(O).on("change",G);V.then(U,U),V.then(S)["catch"](j),n.retry&&(i._changes=V,i._abortChanges=T)}}function w(){u().then(function(){return i.cancelled?void l():x.getCheckpoint().then(function(T){B=T,O={since:B,limit:Q,batch_size:Q,style:"all_docs",doc_ids:A,return_docs:!0},n.filter&&("string"!=typeof n.filter?O.include_docs=!0:O.filter=n.filter),"heartbeat" in n&&(O.heartbeat=n.heartbeat),"timeout" in n&&(O.timeout=n.timeout),n.query_params&&(O.query_params=n.query_params),n.view&&(O.view=n.view),p()})})["catch"](function(T){v("getCheckpoint rejected with ",T)})}function L(T){throw y=!1,v("writeCheckpoint completed with error",T),T}var C,P,x,r=[],k={seq:0,changes:[],docs:[]},y=!1,g=!1,o=!1,B=0,s=n.continuous||n.live||!1,Q=n.batch_size||100,K=n.batches_limit||10,J=!1,A=n.doc_ids,D=[],R=[],F=kh();m=m||{ok:!0,start_time:new Date,docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var O={};return i.ready(E,M),i.cancelled?void l():(i._addedListeners||(i.once("cancel",l),"function"==typeof n.complete&&(i.once("error",n.complete),i.once("complete",function(T){n.complete(null,T)})),i._addedListeners=!0),void ("undefined"==typeof n.since?w():u().then(function(){return y=!0,x.writeCheckpoint(n.since,F)}).then(function(){return y=!1,i.cancelled?void l():(B=n.since,void w())})["catch"](L)))}function eQ(){aq.EventEmitter.call(this),this.cancelled=!1,this.state="pending";var h=this,g=new e(function(i,j){h.once("complete",i),h.once("error",j)});h.then=function(i,j){return g.then(i,j)},h["catch"]=function(i){return g["catch"](i)},h["catch"](function(){})}function fN(g,i){var h=i.PouchConstructor;return"string"==typeof g?new h(g,i):g}function f7(i,l,g,m){if("function"==typeof g&&(m=g,g={}),"undefined"==typeof g&&(g={}),g.doc_ids&&!Array.isArray(g.doc_ids)){throw kb(aQ,"`doc_ids` filter parameter is not a list.")}g.complete=m,g=e5(g),g.continuous=g.continuous||g.live,g.retry="retry" in g?g.retry:!1,g.PouchConstructor=g.PouchConstructor||this;var j=new eQ(g),k=fN(i,g),h=fN(l,g);return bf(k,h,g,j),j}function bp(g,i,h,j){return"function"==typeof h&&(j=h,h={}),"undefined"==typeof h&&(h={}),h=e5(h),h.PouchConstructor=h.PouchConstructor||this,g=dc.toPouch(g,h),i=dc.toPouch(i,h),new bY(g,i,h,j)}function bY(s,l,m,v){function k(z){q.emit("change",{direction:"pull",change:z})}function p(z){q.emit("change",{direction:"push",change:z})}function y(z){q.emit("denied",{direction:"push",doc:z})}function n(z){q.emit("denied",{direction:"pull",doc:z})}function i(){q.pushPaused=!0,q.pullPaused&&q.emit("paused")}function w(){q.pullPaused=!0,q.pushPaused&&q.emit("paused")}function r(){q.pushPaused=!1,q.pullPaused&&q.emit("active",{direction:"push"})}function o(){q.pullPaused=!1,q.pushPaused&&q.emit("active",{direction:"pull"})}function u(z){return function(D,C){var A="change"===D&&(C===k||C===p),F="denied"===D&&(C===n||C===y),B="paused"===D&&(C===w||C===i),E="active"===D&&(C===o||C===r);(A||F||B||E)&&(D in g||(g[D]={}),g[D][z]=!0,2===Object.keys(g[D]).length&&q.removeAllListeners(D))}}var q=this;this.canceled=!1;var x=m.push?e3.extend({},m,m.push):m,h=m.pull?e3.extend({},m,m.pull):m;this.push=cc(s,l,x),this.pull=cc(l,s,h),this.pushPaused=!0,this.pullPaused=!0;var g={};m.live&&(this.push.on("complete",q.pull.cancel.bind(q.pull)),this.pull.on("complete",q.push.cancel.bind(q.push))),this.on("newListener",function(z){"change"===z?(q.pull.on("change",k),q.push.on("change",p)):"denied"===z?(q.pull.on("denied",n),q.push.on("denied",y)):"active"===z?(q.pull.on("active",o),q.push.on("active",r)):"paused"===z&&(q.pull.on("paused",w),q.push.on("paused",i))}),this.on("removeListener",function(z){"change"===z?(q.pull.removeListener("change",k),q.push.removeListener("change",p)):"denied"===z?(q.pull.removeListener("denied",n),q.push.removeListener("denied",y)):"active"===z?(q.pull.removeListener("active",o),q.push.removeListener("active",r)):"paused"===z&&(q.pull.removeListener("paused",w),q.push.removeListener("paused",i))}),this.pull.on("removeListener",u("pull")),this.push.on("removeListener",u("push"));var j=e.all([this.push,this.pull]).then(function(A){var z={push:A[0],pull:A[1]};return q.emit("complete",z),v&&v(null,z),q.removeAllListeners(),z},function(z){if(q.cancel(),v?v(z):q.emit("error",z),q.removeAllListeners(),v){throw z}});this.then=function(A,z){return j.then(A,z)},this["catch"]=function(z){return j["catch"](z)}}function d7(h,g){return bK(cD(h),g)}function fE(k){for(var i="",h=new Uint8Array(k),j=h.byteLength,g=0;j>g;g++){i+=String.fromCharCode(h[g])}return i}function aH(g,i){if("undefined"==typeof FileReader){return i(fE((new FileReaderSync).readAsArrayBuffer(g)))}var h=new FileReader,j="function"==typeof h.readAsBinaryString;h.onloadend=function(k){var l=k.target.result||"";return j?i(l):void i(fE(l))},j?h.readAsBinaryString(g):h.readAsArrayBuffer(g)}function f9(g){return new e(function(h){aH(g,function(i){h(fH(i))})})}function d0(g){for(var i=[],h=0,j=g.length;j>h;h++){i=i.concat(g[h])}return i}function ah(h){var g=h.doc&&h.doc._attachments;g&&Object.keys(g).forEach(function(i){var j=g[i];j.data=d7(j.data,j.content_type)})}function bX(g){return/^_design/.test(g)?"_design/"+encodeURIComponent(g.slice(8)):/^_local/.test(g)?"_local/"+encodeURIComponent(g.slice(7)):encodeURIComponent(g)}function cd(g){return g._attachments&&Object.keys(g._attachments)?e.all(Object.keys(g._attachments).map(function(h){var i=g._attachments[h];return i.data&&"string"!=typeof i.data?f9(i.data).then(function(j){i.data=j}):void 0})):e.resolve()}function eN(g){var i=aC(g);(i.user||i.password)&&(i.auth={username:i.user,password:i.password});var h=i.path.replace(/(^\/|\/$)/g,"").split("/");return i.db=h.pop(),-1===i.db.indexOf("%")&&(i.db=encodeURIComponent(i.db)),i.path=h.join("/"),i}function ep(h,g){return ed(h,h.db+"/"+g)}function ed(g,i){var h=g.path?"/":"";return g.protocol+"://"+g.host+(g.port?":"+g.port:"")+"/"+g.path+h+i}function aF(g){return"?"+Object.keys(g).map(function(h){return h+"="+encodeURIComponent(g[h])}).join("&")}function am(h,o){function v(A,z,x){var B=A.ajax||{},y=e3.extend(e5(w),B,z);return bu(y.method+" "+y.url),cW.ajax(y,x)}function u(x,y){return new e(function(A,z){v(x,y,function(C,B){return C?z(C):void A(B)})})}function g(x,y){return d5(x,aG(function(z){k().then(function(){return y.apply(this,z)})["catch"](function(B){var A=z.pop();A(B)})}))}function k(){if(h.skipSetup||h.skip_setup){return e.resolve()}if(l){return l}var x={method:"GET",url:r};return l=u({},x)["catch"](function(y){return y&&y.status&&404===y.status?(b0(404,"PouchDB is just detecting if the remote exists."),u({},{method:"PUT",url:r})):e.reject(y)})["catch"](function(y){return y&&y.status&&412===y.status?!0:e.reject(y)}),l["catch"](function(){l=null}),l}function p(x){return x.split("/").map(encodeURIComponent).join("/")}var n=this,s=eN;h.getHost&&(s=h.getHost);var q=s(h.name,h),r=ep(q,"");h=e5(h);var w=h.ajax||{};if(n.getUrl=function(){return r},n.getHeaders=function(){return w.headers||{}},h.auth||q.auth){var m=h.auth||q.auth,j=m.username+":"+m.password,i=fH(unescape(encodeURIComponent(j)));w.headers=w.headers||{},w.headers.Authorization="Basic "+i}var l;setTimeout(function(){o(null,n)}),n.type=function(){return"http"},n.id=g("id",function(x){v({},{method:"GET",url:ed(q,"")},function(z,y){var A=y&&y.uuid?y.uuid+q.db:ep(q,"");x(null,A)})}),n.request=g("request",function(x,y){x.url=ep(q,x.url),v({},x,y)}),n.compact=g("compact",function(x,y){"function"==typeof x&&(y=x,x={}),x=e5(x),v(x,{url:ep(q,"_compact"),method:"POST"},function(){function z(){n.info(function(B,A){A&&!A.compact_running?y(null,{ok:!0}):setTimeout(z,x.interval||200)})}z()})}),n.bulkGet=d5("bulkGet",function(C,A){function B(E){var F={};C.revs&&(F.revs=!0),C.attachments&&(F.attachments=!0),v({},{url:ep(q,"_bulk_get"+aF(F)),method:"POST",body:{docs:C.docs}},E)}function y(){function J(L){return function(N,M){K[L]=M.results,++E===H&&A(null,{results:d0(K)})}}for(var F=cE,H=Math.ceil(C.docs.length/F),E=0,K=new Array(H),I=0;H>I;I++){var G=dh(C,["revs","attachments"]);G.ajax=w,G.docs=C.docs.slice(I*F,Math.min(C.docs.length,(I+1)*F)),eD(D,G,J(I))}}var D=this,x=ed(q,""),z=aP[x];"boolean"!=typeof z?B(function(F,G){if(F){var E=Math.floor(F.status/100);4===E||5===E?(aP[x]=!1,b0(F.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),y()):A(F)}else{aP[x]=!0,A(null,G)}}):z?B(A):y()}),n._info=function(x){k().then(function(){v({},{method:"GET",url:ep(q,"")},function(y,z){return y?x(y):(z.host=ep(q,""),void x(null,z))})})["catch"](x)},n.get=g("get",function(C,y,B){function x(F){var G=F._attachments,E=G&&Object.keys(G);return G&&E.length?e.all(E.map(function(H){var J=G[H],I=bX(F._id)+"/"+p(H)+"?rev="+F._rev;return u(y,{method:"GET",url:ep(q,I),binary:!0}).then(function(K){return y.binary?K:f9(K)}).then(function(K){delete J.stub,delete J.length,J.data=K})})):void 0}function A(E){return Array.isArray(E)?e.all(E.map(function(F){return F.ok?x(F.ok):void 0})):x(E)}"function"==typeof y&&(B=y,y={}),y=e5(y);var D={};y.revs&&(D.revs=!0),y.revs_info&&(D.revs_info=!0),y.open_revs&&("all"!==y.open_revs&&(y.open_revs=JSON.stringify(y.open_revs)),D.open_revs=y.open_revs),y.rev&&(D.rev=y.rev),y.conflicts&&(D.conflicts=y.conflicts),C=bX(C);var z={method:"GET",url:ep(q,C+aF(D))};u(y,z).then(function(E){return e.resolve().then(function(){return y.attachments?A(E):void 0}).then(function(){B(null,E)})})["catch"](B)}),n.remove=g("remove",function(z,x,y,B){var C;"string"==typeof x?(C={_id:z,_rev:x},"function"==typeof y&&(B=y,y={})):(C=z,"function"==typeof x?(B=x,y={}):(B=y,y=x));var A=C._rev||y.rev;v(y,{method:"DELETE",url:ep(q,bX(C._id))+"?rev="+A},B)}),n.getAttachment=g("getAttachment",function(z,x,y,B){"function"==typeof y&&(B=y,y={});var C=y.rev?"?rev="+y.rev:"",A=ep(q,bX(z))+"/"+p(x)+C;v(y,{method:"GET",url:A,binary:!0},B)}),n.removeAttachment=g("removeAttachment",function(A,y,z,B){var x=ep(q,bX(A)+"/"+p(y))+"?rev="+z;v({},{method:"DELETE",url:x},B)}),n.putAttachment=g("putAttachment",function(G,A,B,C,D,x){"function"==typeof D&&(x=D,D=C,C=B,B=null);var y=bX(G)+"/"+p(A),H=ep(q,y);if(B&&(H+="?rev="+B),"string"==typeof C){var F;try{F=cD(C)}catch(z){return x(kb(cm,"Attachment is not a valid base64 string"))}C=F?bK(F,D):""}var E={headers:{"Content-Type":D},method:"PUT",url:H,processData:!1,body:C,timeout:w.timeout||60000};v({},E,x)}),n._bulkDocs=function(y,z,x){y.new_edits=z.new_edits,k().then(function(){return e.all(y.docs.map(cd))}).then(function(){v(z,{method:"POST",url:ep(q,"_bulk_docs"),body:y},function(A,B){return A?x(A):(B.forEach(function(C){C.ok=!0}),void x(null,B))})})["catch"](x)},n.allDocs=g("allDocs",function(C,A){"function"==typeof C&&(A=C,C={}),C=e5(C);var B,y={},x="GET";C.conflicts&&(y.conflicts=!0),C.descending&&(y.descending=!0),C.include_docs&&(y.include_docs=!0),C.attachments&&(y.attachments=!0),C.key&&(y.key=JSON.stringify(C.key)),C.start_key&&(C.startkey=C.start_key),C.startkey&&(y.startkey=JSON.stringify(C.startkey)),C.end_key&&(C.endkey=C.end_key),C.endkey&&(y.endkey=JSON.stringify(C.endkey)),"undefined"!=typeof C.inclusive_end&&(y.inclusive_end=!!C.inclusive_end),"undefined"!=typeof C.limit&&(y.limit=C.limit),"undefined"!=typeof C.skip&&(y.skip=C.skip);var z=aF(y);if("undefined"!=typeof C.keys){var D="keys="+encodeURIComponent(JSON.stringify(C.keys));D.length+z.length+1<=c6?z+="&"+D:(x="POST",B={keys:C.keys})}u(C,{method:x,url:ep(q,"_all_docs"+z),body:B}).then(function(E){C.include_docs&&C.attachments&&C.binary&&E.rows.forEach(ah),A(null,E)})["catch"](A)}),n._changes=function(y){var C="batch_size" in y?y.batch_size:eG;y=e5(y),y.timeout="timeout" in y?y.timeout:"timeout" in w?w.timeout:30000;var H,G=y.timeout?{timeout:y.timeout-5000}:{},F="undefined"!=typeof y.limit?y.limit:!1;H="return_docs" in y?y.return_docs:"returnDocs" in y?y.returnDocs:!0;var D=F;if(y.style&&(G.style=y.style),(y.include_docs||y.filter&&"function"==typeof y.filter)&&(G.include_docs=!0),y.attachments&&(G.attachments=!0),y.continuous&&(G.feed="longpoll"),y.conflicts&&(G.conflicts=!0),y.descending&&(G.descending=!0),"heartbeat" in y?y.heartbeat&&(G.heartbeat=y.heartbeat):G.heartbeat=10000,y.filter&&"string"==typeof y.filter&&(G.filter=y.filter,"_view"===y.filter&&y.view&&"string"==typeof y.view&&(G.view=y.view)),y.query_params&&"object"==typeof y.query_params){for(var B in y.query_params){y.query_params.hasOwnProperty(B)&&(G[B]=y.query_params[B])}}var L,A="GET";if(y.doc_ids){G.filter="_doc_ids";var E=JSON.stringify(y.doc_ids);E.length<c6?G.doc_ids=E:(A="POST",L={doc_ids:y.doc_ids})}var z,K,x=function(O,N){if(!y.aborted){G.since=O,"object"==typeof G.since&&(G.since=JSON.stringify(G.since)),y.descending?F&&(G.limit=D):G.limit=!F||D>C?C:D;var M={method:A,url:ep(q,"_changes"+aF(G)),timeout:y.timeout,body:L};K=O,y.aborted||k().then(function(){z=v(y,M,N)})["catch"](N)}},J={results:[]},I=function(P,M){if(!y.aborted){var N=0;if(M&&M.results){N=M.results.length,J.last_seq=M.last_seq;var Q={};Q.query=y.query_params,M.results=M.results.filter(function(R){D--;var S=eT(y)(R);return S&&(y.include_docs&&y.attachments&&y.binary&&ah(R),H&&J.results.push(R),y.onChange(R)),S})}else{if(P){return y.aborted=!0,void y.complete(P)}}M&&M.last_seq&&(K=M.last_seq);var O=F&&0>=D||M&&C>N||y.descending;(!y.continuous||F&&0>=D)&&O?y.complete(null,J):setTimeout(function(){x(K,I)},0)}};return x(y.since||0,I),{cancel:function(){y.aborted=!0,z&&z.abort()}}},n.revsDiff=g("revsDiff",function(y,z,x){"function"==typeof z&&(x=z,z={}),v(z,{method:"POST",url:ep(q,"_revs_diff"),body:y},x)}),n._close=function(x){x()},n._destroy=function(y,x){v(y,{url:ep(q,""),method:"DELETE"},function(A,z){return A&&A.status&&404!==A.status?x(A):(n.emit("destroyed"),n.constructor.emit("destroyed",h.name),void x(null,z))})}}function eZ(){this.promise=new e(function(g){g()})}function bJ(g){return al.hash(g)}function cM(l){var n=l.db,i=l.viewName,g=l.map,h=l.reduce,m=l.temporary,k=g.toString()+(h&&h.toString())+"undefined";if(!m&&n._cachedViews){var j=n._cachedViews[k];if(j){return e.resolve(j)}}return n.info().then(function(p){function o(u){u.views=u.views||{};var r=i;-1===r.indexOf("/")&&(r=i+"/"+i);var s=u.views[r]=u.views[r]||{};if(!s[q]){return s[q]=!0,u}}var q=p.db_name+"-mrview-"+(m?"temp":bJ(k));return fI(n,"_local/mrviews",o).then(function(){return n.registerDependentDatabase(q).then(function(s){var u=s.db;u.auto_compaction=!0;var r={name:q,db:u,sourceDB:n,adapter:n.adapter,mapFun:g,reduceFun:h};return r.db.get("_local/lastSeq")["catch"](function(v){if(404!==v.status){throw v}}).then(function(v){return r.seq=v?v.seq:0,m||(n._cachedViews=n._cachedViews||{},n._cachedViews[k]=r,r.db.once("destroyed",function(){delete n._cachedViews[k]})),r})})})})}function ak(l,j,i,k,h,g){return ec("return ("+l.replace(/;\s*$/,"")+");",{emit:j,sum:i,log:k,isArray:h,toJSON:g})}function fR(g){return -1===g.indexOf("/")?[g,g]:g.split("/")}function jE(g){return 1===g.length&&/^1-/.test(g[0].rev)}function dj(g,i){try{g.emit("error",i)}catch(h){console.error("The user's map/reduce function threw an uncaught error.\nYou can debug this error by doing:\nmyDatabase.on('error', function (err) { debugger; });\nPlease double-check your map/reduce function."),console.error(i)}}function kk(g,i,h){try{return{output:i.apply(null,h)}}catch(j){return dj(g,j),{error:j}}}function eb(g,i){var h=aY(g.key,i.key);return 0!==h?h:aY(g.value,i.value)}function aM(g,i,h){return h=h||0,"number"==typeof i?g.slice(h,i+h):h>0?g.slice(h):g}function b5(g){var i=g.value,h=i&&"object"==typeof i&&i._id||g.id;return h}function jK(g){g.rows.forEach(function(i){var h=i.doc&&i.doc._attachments;h&&Object.keys(h).forEach(function(j){var k=h[j];h[j].data=d7(k.data,k.content_type)})})}function bD(g){return function(h){return g.include_docs&&g.attachments&&g.binary&&jK(h),h}}function dg(h){var g="builtin "+h+" function requires map values to be numbers or number arrays";return new cf(g)}function cZ(l){for(var n=0,i=0,g=l.length;g>i;i++){var h=l[i];if("number"!=typeof h){if(!Array.isArray(h)){throw dg("_sum")}n="number"==typeof n?[n]:n;for(var m=0,k=h.length;k>m;m++){var j=h[m];if("number"!=typeof j){throw dg("_sum")}"undefined"==typeof n[m]?n.push(j):n[m]+=j}}else{"number"==typeof n?n+=h:n[0]+=h}}return n}function dI(k,i,h,j){var g=i[k];"undefined"!=typeof g&&(j&&(g=encodeURIComponent(JSON.stringify(g))),h.push(k+"="+g))}function dR(h){if("undefined"!=typeof h){var g=Number(h);return isNaN(g)||g!==parseInt(h,10)?h:g}}function e9(g){return g.group_level=dR(g.group_level),g.limit=dR(g.limit),g.skip=dR(g.skip),g}function a9(g){if(g){if("number"!=typeof g){return new df('Invalid value for integer: "'+g+'"')}if(0>g){return new df('Invalid value for positive integer: "'+g+'"')}}}function bN(g,i){var h=g.descending?"endkey":"startkey",j=g.descending?"startkey":"endkey";if("undefined"!=typeof g[h]&&"undefined"!=typeof g[j]&&aY(g[h],g[j])>0){throw new df("No rows can match your key range, reverse your start_key and end_key or set {descending : true}")}if(i.reduce&&g.reduce!==!1){if(g.include_docs){throw new df("{include_docs:true} is invalid for reduce")}if(g.keys&&g.keys.length>1&&!g.group&&!g.group_level){throw new df("Multi-key fetches for reduce views must use {group: true}")}}["group_level","limit","skip"].forEach(function(k){var l=a9(g[k]);if(l){throw l}})}function b9(o,g,l){var j,k=[],m="GET";if(dI("reduce",l,k),dI("include_docs",l,k),dI("attachments",l,k),dI("limit",l,k),dI("descending",l,k),dI("group",l,k),dI("group_level",l,k),dI("skip",l,k),dI("stale",l,k),dI("conflicts",l,k),dI("startkey",l,k,!0),dI("start_key",l,k,!0),dI("endkey",l,k,!0),dI("end_key",l,k,!0),dI("inclusive_end",l,k),dI("key",l,k,!0),k=k.join("&"),k=""===k?"":"?"+k,"undefined"!=typeof l.keys){var n=2000,i="keys="+encodeURIComponent(JSON.stringify(l.keys));i.length+k.length+1<=n?k+=("?"===k[0]?"&":"?")+i:(m="POST","string"==typeof g?j={keys:l.keys}:g.keys=l.keys)}if("string"==typeof g){var h=fR(g);return o.request({method:m,url:"_design/"+h[0]+"/_view/"+h[1]+k,body:j}).then(bD(l))}return j=j||{},Object.keys(g).forEach(function(p){Array.isArray(g[p])?j[p]=g[p]:j[p]=g[p].toString()}),o.request({method:"POST",url:"_temp_view"+k,body:j}).then(bD(l))}function cP(g,i,h){return new e(function(j,k){g._query(i,h,function(m,l){return m?k(m):void j(l)})})}function bh(g){return new e(function(h,i){g._viewCleanup(function(k,j){return k?i(k):void h(j)})})}function db(g){return function(h){if(404===h.status){return g}throw h}}function jJ(p,j,n){function l(){return jE(q)?e.resolve(k):j.db.get(g)["catch"](db(k))}function m(r){return r.keys.length?j.db.allDocs({keys:r.keys,include_docs:!0}):e.resolve({rows:[]})}function o(v,x){for(var B=[],y={},A=0,r=x.rows.length;r>A;A++){var u=x.rows[A],z=u.doc;if(z&&(B.push(z),y[z._id]=!0,z._deleted=!h[z._id],!z._deleted)){var w=h[z._id];"value" in w&&(z.value=w.value)}}var s=Object.keys(h);return s.forEach(function(C){if(!y[C]){var E={_id:C},D=h[C];"value" in D&&(E.value=D.value),B.push(E)}}),v.keys=dV(s.concat(v.keys)),B.push(v),B}var g="_local/doc_"+p,k={_id:g,keys:[]},i=n[p],h=i.indexableKeysToKeyValues,q=i.changes;return l().then(function(r){return m(r).then(function(s){return o(r,s)})})}function cB(g,i,h){var j="_local/lastSeq";return g.db.get(j)["catch"](db({_id:j,seq:0})).then(function(k){var l=Object.keys(i);return e.all(l.map(function(m){return jJ(m,g,i)})).then(function(m){var n=d0(m);return k.seq=h,n.push(k),g.db.bulkDocs({docs:n})})})}function cS(g){var i="string"==typeof g?g:g.name,h=dv[i];return h||(h=dv[i]=new eZ),h}function f4(g){return jH(cS(g),function(){return cO(g)})()}function cO(o){function g(p,r){var q={id:k._id,key:bZ(p)};"undefined"!=typeof r&&null!==r&&(q.value=bZ(r)),j.push(q)}function l(q,p){return function(){return cB(o,q,p)}}var j,k,m;if("function"==typeof o.mapFun&&2===o.mapFun.length){var n=o.mapFun;m=function(p){return n(p,g)}}else{m=ak(o.mapFun.toString(),g,cZ,d4,Array.isArray,JSON.parse)}var i=o.seq||0,h=new eZ;return new e(function(p,s){function r(){h.finish().then(function(){o.seq=i,p()})}function q(){function u(v){s(v)}o.sourceDB.changes({conflicts:!0,include_docs:!0,style:"all_docs",since:i,limit:cI}).on("complete",function(A){var v=A.results;if(!v.length){return r()}for(var D={},F=0,C=v.length;C>F;F++){var w=v[F];if("_"!==w.doc._id[0]){j=[],k=w.doc,k._deleted||kk(o.sourceDB,m,[k]),j.sort(eb);for(var z,H={},y=0,B=j.length;B>y;y++){var E=j[y],G=[E.key,E.id];0===aY(E.key,z)&&G.push(y);var x=cG(G);H[x]=E,z=E.key}D[w.doc._id]={indexableKeysToKeyValues:H,changes:w.changes}}i=w.seq}return h.add(l(D,i)),v.length<cI?r():q()}).on("error",u)}q()})}function aN(p,j,n){0===n.group_level&&delete n.group_level;var l,m=n.group||n.group_level;l=j2[p.reduceFun]?j2[p.reduceFun]:ak(p.reduceFun.toString(),null,cZ,d4,Array.isArray,JSON.parse);var o=[],g=isNaN(n.group_level)?Number.POSITIVE_INFINITY:n.group_level;j.forEach(function(r){var u=o[o.length-1],s=m?r.key:null;return m&&Array.isArray(s)&&(s=s.slice(0,g)),u&&0===aY(u.groupKey,s)?(u.keys.push([r.key,r.id]),void u.values.push(r.value)):void o.push({keys:[[r.key,r.id]],values:[r.value],groupKey:s})}),j=[];for(var k=0,i=o.length;i>k;k++){var h=o[k],q=kk(p.sourceDB,l,[h.keys,h.values,!1]);if(q.error&&q.error instanceof cf){throw q.error}j.push({value:q.error?null:q.output,key:h.groupKey})}return{rows:aM(j,n.limit,n.skip)}}function bi(h,g){return jH(cS(h),function(){return dF(h,g)})()}function dF(r,n){function q(u){return u.include_docs=!0,r.db.allDocs(u).then(function(v){return p=v.total_rows,v.rows.map(function(x){if("value" in x.doc&&"object"==typeof x.doc.value&&null!==x.doc.value){var z=Object.keys(x.doc.value).sort(),y=["id","key","value"];if(!(y>z||z>y)){return x.doc.value}}var w=cp(x.doc._id);return{key:w[0],id:w[1],value:"value" in x.doc?x.doc.value:null}})})}function o(w){var v;if(v=g?aN(r,w,n):{total_rows:p,offset:l,rows:w},n.include_docs){var u=dV(w.map(b5));return r.sourceDB.allDocs({keys:u,include_docs:!0,conflicts:n.conflicts,attachments:n.attachments,binary:n.binary}).then(function(x){var y={};return x.rows.forEach(function(z){z.doc&&(y["$"+z.id]=z.doc)}),w.forEach(function(A){var B=b5(A),z=y["$"+B];z&&(A.doc=z)}),v})}return v}var p,g=r.reduceFun&&n.reduce!==!1,l=n.skip||0;if("undefined"==typeof n.keys||n.keys.length||(n.limit=0,delete n.keys),"undefined"!=typeof n.keys){var h=n.keys,m=h.map(function(v){var u={startkey:cG([v]),endkey:cG([v,{}])};return q(u)});return e.all(m).then(d0).then(o)}var k={descending:n.descending};if(n.start_key&&(n.startkey=n.start_key),n.end_key&&(n.endkey=n.end_key),"undefined"!=typeof n.startkey&&(k.startkey=cG(n.descending?[n.startkey,{}]:[n.startkey])),"undefined"!=typeof n.endkey){var i=n.inclusive_end!==!1;n.descending&&(i=!i),k.endkey=cG(i?[n.endkey,{}]:[n.endkey])}if("undefined"!=typeof n.key){var s=cG([n.key]),j=cG([n.key,{}]);k.descending?(k.endkey=s,k.startkey=j):(k.startkey=s,k.endkey=j)}return g||("number"==typeof n.limit&&(k.limit=n.limit),k.skip=l),q(k).then(o)}function j0(g){return g.request({method:"POST",url:"_view_cleanup"})}function d2(g){return g.get("_local/mrviews").then(function(h){var j={};Object.keys(h.views).forEach(function(k){var m=fR(k),n="_design/"+m[0],l=m[1];j[n]=j[n]||{},j[n][l]=!0});var i={keys:Object.keys(j),include_docs:!0};return g.allDocs(i).then(function(k){var l={};k.rows.forEach(function(p){var o=p.key.substring(8);Object.keys(j[p.key]).forEach(function(u){var r=o+"/"+u;h.views[r]||(r=u);var q=Object.keys(h.views[r]),s=p.doc&&p.doc.views&&p.doc.views[u];q.forEach(function(v){l[v]=l[v]||s})})});var n=Object.keys(l).filter(function(o){return !l[o]}),m=n.map(function(o){return jH(cS(o),function(){return new g.constructor(o,g.__opts).destroy()})()});return e.all(m).then(function(){return{ok:!0}})})},db({ok:!0}))}function aT(h,j,l){if("http"===h.type()){return b9(h,j,l)}if("function"==typeof h._query){return cP(h,j,l)}if("string"!=typeof j){bN(l,j);var i={db:h,viewName:"temp_view/temp_view",map:j.map,reduce:j.reduce,temporary:!0};return dD.add(function(){return cM(i).then(function(o){function p(){return o.db.destroy()}return kf(f4(o).then(function(){return bi(o,l)}),p)})}),dD.finish()}var n=j,k=fR(n),g=k[0],m=k[1];return h.getView(g,m).then(function(p){bN(l,p);var o={db:h,viewName:n,map:p.map,reduce:p.reduce};return cM(o).then(function(q){return"ok"===l.stale||"update_after"===l.stale?("update_after"===l.stale&&eB.nextTick(function(){f4(q)}),bi(q,l)):f4(q).then(function(){return bi(q,l)})})})}function df(h){this.status=400,this.name="query_parse_error",this.message=h,this.error=!0;try{Error.captureStackTrace(this,df)}catch(g){}}function cf(h){this.status=500,this.name="invalid_value",this.message=h,this.error=!0;try{Error.captureStackTrace(this,cf)}catch(g){}}function jD(g){return fH(fE(g))}function ke(l,n,i){function g(o){try{return cD(o)}catch(q){var p=kb(cm,"Attachment is not a valid base64 string");return{error:p}}}function h(q,p){if(q.stub){return p()}if("string"==typeof q.data){var o=g(q.data);if(o.error){return p(o.error)}q.length=o.length,"blob"===n?q.data=bK(o,q.content_type):"base64"===n?q.data=fH(o):q.data=o,ef(o).then(function(r){q.digest="md5-"+r,p()})}else{az(q.data,function(r){"binary"===n?q.data=fE(r):"base64"===n&&(q.data=jD(r)),ef(r).then(function(s){q.digest="md5-"+s,q.length=r.byteLength,p()})})}}function m(){j++,l.length===j&&(k?i(k):i())}if(!l.length){return i()}var k,j=0;l.forEach(function(r){function p(u){k=u,q++,q===s.length&&m()}var s=r.data&&r.data._attachments?Object.keys(r.data._attachments):[],q=0;if(!s.length){return m()}for(var o in r.data._attachments){r.data._attachments.hasOwnProperty(o)&&h(r.data._attachments[o],p)}})}function dQ(h,g){return h.pos-g.pos}function eX(l,j,i){for(var k,h=0,g=l.length;g>h;){k=h+g>>>1,i(l[k],j)<0?h=k+1:g=k}return h}function ay(g,i,h){var j=eX(g,i,h);g.splice(j,0,i)}function ki(l,n){for(var i,g,h=n,m=l.length;m>h;h++){var k=l[h],j=[k.id,k.opts,[]];g?(g[2].push(j),g=j):i=g=j}return i}function aB(h,g){return h[0]<g[0]?-1:1}function jU(g,i){for(var m=[{tree1:g,tree2:i}],k=!1;m.length>0;){var l=m.pop(),o=l.tree1,h=l.tree2;(o[1].status||h[1].status)&&(o[1].status="available"===o[1].status||"available"===h[1].status?"available":"missing");for(var j=0;j<h[2].length;j++){if(o[2][0]){for(var p=!1,n=0;n<o[2].length;n++){o[2][n][0]===h[2][j][0]&&(m.push({tree1:o[2][n],tree2:h[2][j]}),p=!0)}p||(k="new_branch",ay(o[2],h[2][j],aB))}else{k="new_leaf",o[2][0]=h[2][j]}}}return{conflicts:k,tree:g}}function cx(y,u,n){var z,k=[],q=!1,r=!1;if(!y.length){return{tree:[u],conflicts:"new_leaf"}}for(var w=0,j=y.length;j>w;w++){var m=y[w];if(m.pos===u.pos&&m.ids[0]===u.ids[0]){z=jU(m.ids,u.ids),k.push({pos:m.pos,ids:z.tree}),q=q||z.conflicts,r=!0}else{if(n!==!0){var x=m.pos<u.pos?m:u,p=m.pos<u.pos?u:m,A=p.pos-x.pos,s=[],i=[];for(i.push({ids:x.ids,diff:A,parent:null,parentIdx:null});i.length>0;){var h=i.pop();if(0!==h.diff){for(var g=h.ids[2],l=0,o=g.length;o>l;l++){i.push({ids:g[l],diff:h.diff-1,parent:h.ids,parentIdx:l})}}else{h.ids[0]===p.ids[0]&&s.push(h)}}var v=s[0];v?(z=jU(v.ids,p.ids),v.parent[2][v.parentIdx]=z.tree,k.push({pos:x.pos,ids:x.ids}),q=q||z.conflicts,r=!0):k.push(m)}else{k.push(m)}}}return r||k.push(u),k.sort(dQ),{tree:k,conflicts:q||"internal_node"}}function eC(r,n){for(var q,o=aa(r),p={},g=0,l=o.length;l>g;g++){for(var h=o[g],m=h.ids,k=Math.max(0,m.length-n),i={pos:h.pos+k,ids:ki(m,k)},s=0;k>s;s++){var j=h.pos+s+"-"+m[s].id;p[j]=!0}q=q?cx(q,i,!0).tree:[i]}return j8(q,function(v,u,w){delete p[u+"-"+w]}),{tree:q,revs:Object.keys(p)}}function ds(k,i,h){var j=cx(k,i),g=eC(j.tree,h);return{tree:g.tree,stemmedRevs:g.revs,conflicts:j.conflicts}}function cq(g,i){for(var m,k=g.slice(),l=i.split("-"),o=parseInt(l[0],10),h=l[1];m=k.pop();){if(m.pos===o&&m.ids[0]===h){return !0}for(var j=m.ids[2],p=0,n=j.length;n>p;p++){k.push({pos:m.pos+1,ids:j[p]})}}return !1}function bO(B,w,m,g,j,v,k,z){if(cq(w.rev_tree,m.metadata.rev)){return g[j]=m,v()}var h=w.winningRev||fK(w),r="deleted" in w?w.deleted:f5(w,h),A="deleted" in m.metadata?m.metadata.deleted:f5(m.metadata),q=/^1-/.test(m.metadata.rev);if(r&&!A&&z&&q){var l=m.data;l._rev=h,l._id=m.metadata.id,m=d1(l,z)}var x=ds(w.rev_tree,m.metadata.rev_tree[0],B),i=z&&(r&&A||!r&&"new_leaf"!==x.conflicts||r&&!A&&"new_branch"===x.conflicts);if(i){var p=kb(b7);return g[j]=p,v()}var n=m.metadata.rev;m.metadata.rev_tree=x.tree,m.stemmedRevs=x.stemmedRevs||[],w.rev_map&&(m.metadata.rev_map=w.rev_map);var y,s=fK(m.metadata),o=f5(m.metadata,s),u=r===o?0:o>r?-1:1;y=n===s?o:f5(m.metadata,n),k(m,s,o,y,!0,u,j,v)}function eU(g){return"missing"===g.metadata.rev_tree[0].ids[1].status}function bs(p,i,g,r,v,m,h,l,j){function u(x,C,B){var z=fK(x.metadata),w=f5(x.metadata,z);if("was_delete" in l&&w){return m[C]=kb(aO,"deleted"),B()}var D=k&&eU(x);if(D){var y=kb(b7);return m[C]=y,B()}var A=w?0:1;h(x,z,w,w,!1,A,C,B)}function o(){++n===s&&j&&j()}p=p||1000;var k=l.new_edits,q=new ck.Map,n=0,s=i.length;i.forEach(function(y,w){if(y._id&&kg(y._id)){var x=y._deleted?"_removeLocal":"_putLocal";return void g[x](y,{ctx:v},function(B,A){m[w]=B||A,o()})}var z=y.metadata.id;q.has(z)?(s--,q.get(z).push([y,w])):q.set(z,[[y,w]])}),q.forEach(function(x,z){function y(){++w<x.length?A():o()}function A(){var C=x[w],E=C[0],D=C[1];if(r.has(z)){bO(p,r.get(z),E,m,D,y,h,k)}else{var B=ds([],E.metadata.rev_tree[0],p);E.metadata.rev_tree=B.tree,E.stemmedRevs=B.stemmedRevs||[],u(E,D,y)}}var w=0;A()})}function eR(h){var g=[];return j8(h.rev_tree,function(l,i,k,m,j){"available"!==j.status||l||(g.push(i+"-"+k),j.status="missing")}),g}function aw(h){try{return JSON.parse(h)}catch(g){return jN.parse(h)}}function f8(g){return g.length<50000?JSON.parse(g):aw(g)}function dL(h){try{return JSON.stringify(h)}catch(g){return jN.stringify(h)}}function av(k,i,h,j){try{k.apply(i,h)}catch(g){j.emit("error",g)}}function ek(h){if(!cU.running&&cU.queue.length){cU.running=!0;var g=cU.queue.shift();g.action(function(i,j){av(g.callback,this,[i,j],h),cU.running=!1,eB.nextTick(function(){ek(h)})})}}function eV(g){return function(h){var i="unknown_error";h.target&&h.target.error&&(i=h.target.error.name||h.target.error.message),g(kb(eA,i,h.type))}}function aW(g,i,h){return{data:dL(g),winningRev:i,deletedOrLocal:h?"1":"0",seq:g.seq,id:g.id}}function jZ(h){if(!h){return null}var g=f8(h.data);return g.winningRev=h.winningRev,g.deleted="1"===h.deletedOrLocal,g.seq=h.seq,g}function fG(h){if(!h){return h}var g=h._doc_id_rev.lastIndexOf(":");return h._id=h._doc_id_rev.substring(0,g-1),h._rev=h._doc_id_rev.substring(g+1),delete h._doc_id_rev,h}function cN(g,i,h,j){h?j(g?"string"!=typeof g?g:d7(g,i):aZ([""],{type:i})):g?"string"!=typeof g?aH(g,function(k){j(fH(k))}):j(g):j("")}function aS(l,n,i,g){function h(){++j===k.length&&g&&g()}function m(s,q){var r=s._attachments[q],p=r.digest,o=i.objectStore(c5).get(p);o.onsuccess=function(u){r.body=u.target.result.body,h()}}var k=Object.keys(l._attachments||{});if(!k.length){return g&&g()}var j=0;k.forEach(function(o){n.attachments&&n.include_docs?m(l,o):(l._attachments[o].stub=!0,h())})}function bx(h,g){return e.all(h.map(function(i){if(i.doc&&i.doc._attachments){var j=Object.keys(i.doc._attachments);return e.all(j.map(function(l){var n=i.doc._attachments[l];if("body" in n){var k=n.body,m=n.content_type;return new e(function(o){cN(k,m,g,function(p){i.doc._attachments[l]=e3.extend(dh(n,["digest","content_type"]),{data:p}),o()})})}}))}}))}function bQ(g,i,m){function k(){n--,n||l()}function l(){o.length&&o.forEach(function(q){var r=p.index("digestSeq").count(IDBKeyRange.bound(q+"::",q+"::￿",!1,!1));r.onsuccess=function(s){var u=s.target.result;u||j["delete"](q)}})}var o=[],h=m.objectStore(bz),j=m.objectStore(c5),p=m.objectStore(bF),n=g.length;g.forEach(function(s){var r=h.index("_doc_id_rev"),q=i+"::"+s;r.getKey(q).onsuccess=function(u){var w=u.target.result;if("number"!=typeof w){return k()}h["delete"](w);var v=p.index("seq").openCursor(IDBKeyRange.only(w));v.onsuccess=function(x){var z=x.target.result;if(z){var y=z.value.digestSeq.split("::")[0];o.push(y),p["delete"](z.primaryKey),z["continue"]()}else{k()}}}})}function eH(g,i,h){try{return{txn:g.transaction(i,h)}}catch(j){return{error:j}}}function fB(h,B,k,M,v,K,l){function J(){var Q=[j9,bz,c5,dx,bF],P=eH(v,Q,"readwrite");return P.error?l(P.error):(E=P.txn,E.onabort=eV(l),E.ontimeout=eV(l),E.oncomplete=g,n=E.objectStore(j9),A=E.objectStore(bz),s=E.objectStore(c5),D=E.objectStore(bF),void i(function(R){return R?(H=!0,l(R)):void I()}))}function z(){bs(h.revs_limit,N,M,j,E,L,G,k)}function I(){function Q(){++S===N.length&&z()}function V(W){var X=jZ(W.target.result);X&&j.set(X.id,X),Q()}if(N.length){for(var S=0,P=0,R=N.length;R>P;P++){var U=N[P];if(U._id&&kg(U._id)){Q()}else{var T=n.get(U.metadata.id);T.onsuccess=V}}}}function g(){H||(K.notify(M._meta.name),M._meta.docCount+=r,l(null,L))}function w(Q,P){var R=s.get(Q);R.onsuccess=function(T){if(T.target.result){P()}else{var S=kb(ch,"unknown stub attachment with digest "+Q);S.status=412,P(S)}}}function i(R){function P(){++S===T.length&&R(Q)}var T=[];if(N.forEach(function(U){U.data&&U.data._attachments&&Object.keys(U.data._attachments).forEach(function(W){var V=U.data._attachments[W];V.stub&&T.push(V.digest)})}),!T.length){return R()}var Q,S=0;T.forEach(function(U){w(U,function(V){V&&!Q&&(Q=V),P()})})}function G(V,P,T,R,S,U,X,Q){r+=U,V.metadata.winningRev=P,V.metadata.deleted=T;var Y=V.data;Y._id=V.metadata.id,Y._rev=V.metadata.rev,R&&(Y._deleted=!0);var W=Y._attachments&&Object.keys(Y._attachments).length;return W?m(V,P,T,S,X,Q):void o(V,P,T,S,X,Q)}function O(Q){var P=eR(Q.metadata);bQ(P,Q.metadata.id,E)}function o(Z,S,V,U,X,Q){function T(ao){U&&M.auto_compaction?O(Z):Z.stemmedRevs.length&&bQ(Z.stemmedRevs,Z.metadata.id,E),W.seq=ao.target.result,delete W.rev;var an=aW(W,S,V),ai=n.put(an);ai.onsuccess=P}function R(an){an.preventDefault(),an.stopPropagation();var ai=A.index("_doc_id_rev"),ao=ai.getKey(Y._doc_id_rev);ao.onsuccess=function(at){var ar=A.put(Y,at.target.result);ar.onsuccess=T}}function P(){L[X]={ok:!0,id:W.id,rev:S},j.set(Z.metadata.id,Z.metadata),q(Z,W.seq,Q)}var Y=Z.data,W=Z.metadata;Y._doc_id_rev=W.id+"::"+W.rev,delete Y._id,delete Y._rev;var ae=A.put(Y);ae.onsuccess=T,ae.onerror=R}function m(X,Q,U,S,T,V){function Z(){Y===W.length&&o(X,Q,U,S,T,V)}function R(){Y++,Z()}var P=X.data,Y=0,W=Object.keys(P._attachments);W.forEach(function(ai){var ao=X.data._attachments[ai];if(ao.stub){Y++,Z()}else{var ae=ao.data;delete ao.data,ao.revpos=parseInt(Q,10);var an=ao.digest;p(an,ae,R)}})}function q(Q,V,S){function P(){++U===T.length&&S()}function R(Z){var Y=Q.data._attachments[Z].digest,X=D.put({seq:V,digestSeq:Y+"::"+V});X.onsuccess=P,X.onerror=function(ae){ae.preventDefault(),ae.stopPropagation(),P()}}var U=0,T=Object.keys(Q.data._attachments||{});if(!T.length){return S()}for(var W=0;W<T.length;W++){R(T[W])}}function p(R,P,S){var Q=s.count(R);Q.onsuccess=function(U){var V=U.target.result;if(V){return S()}var T={digest:R,body:P},W=s.put(T);W.onsuccess=S}}for(var E,n,A,s,D,x,N=B.docs,r=0,C=0,y=N.length;y>C;C++){var u=N[C];u._id&&kg(u._id)||(u=N[C]=d1(u,k.new_edits),u.error&&!x&&(x=u))}if(x){return l(x)}var L=new Array(N.length),j=new ck.Map,H=!1,F=M._meta.blobSupport?"blob":"base64";ke(N,F,function(P){return P?l(P):void J()})}function f0(l,j,i,k,h){try{if(l&&j){return h?IDBKeyRange.bound(j,l,!i,!1):IDBKeyRange.bound(l,j,!1,!i)}if(l){return h?IDBKeyRange.upperBound(l):IDBKeyRange.lowerBound(l)}if(j){return h?IDBKeyRange.lowerBound(j,!i):IDBKeyRange.upperBound(j,!i)}if(k){return IDBKeyRange.only(k)}}catch(g){return{error:g}}return null}function cX(g,i,h,j){return"DataError"===h.name&&0===h.code?j(null,{total_rows:g._meta.docCount,offset:i.skip,rows:[]}):void j(kb(eA,h.name,h.message))}function dp(l,j,i,k){function h(s,u){function D(M,N,O){var L=M.id+"::"+O;p.get(L).onsuccess=function(P){N.doc=fG(P.target.result),s.conflicts&&(N.doc._conflicts=eW(M)),aS(N.doc,s,y)}}function v(M,O,N){var L={id:N.id,key:N.id,value:{rev:O}},P=N.deleted;if("ok"===s.deleted){B.push(L),P?(L.value.deleted=!0,L.doc=null):s.include_docs&&D(N,L,O)}else{if(!P&&x--<=0&&(B.push(L),s.include_docs&&D(N,L,O),0===--F)){return}}M["continue"]()}function H(O){w=j._meta.docCount;var N=O.target.result;if(N){var M=jZ(N.value),L=M.winningRev;v(N,L,M)}}function J(){u(null,{total_rows:w,offset:s.skip,rows:B})}function C(){s.attachments?bx(B,s.binary).then(J):J()}var E="startkey" in s?s.startkey:!1,n="endkey" in s?s.endkey:!1,r="key" in s?s.key:!1,x=s.skip||0,F="number"==typeof s.limit?s.limit:-1,A=s.inclusive_end!==!1,q="descending" in s&&s.descending?"prev":null,m=f0(E,n,A,r,q);if(m&&m.error){return cX(j,s,m.error,u)}var K=[j9,bz];s.attachments&&K.push(c5);var o=eH(i,K,"readonly");if(o.error){return u(o.error)}var y=o.txn,G=y.objectStore(j9),z=y.objectStore(bz),I=q?G.openCursor(m,q):G.openCursor(m),p=z.index("_doc_id_rev"),B=[],w=0;y.oncomplete=C,I.onsuccess=H}function g(m,n){return 0===m.limit?n(null,{total_rows:j._meta.docCount,offset:m.skip,rows:[]}):void h(m,n)}g(l,k)}function bq(g){return new e(function(h){var i=aZ([""]);g.objectStore(cF).put(i,"key"),g.onabort=function(j){j.preventDefault(),j.stopPropagation(),h(!1)},g.oncomplete=function(){var j=navigator.userAgent.match(/Chrome\/(\d+)/),k=navigator.userAgent.match(/Edge\//);h(k||!j||parseInt(j[1],10)>=43)}})["catch"](function(){return !1})}function bg(g){eK()?chrome.storage.onChanged.addListener(function(h){null!=h.db_name&&g.emit(h.dbName.newValue)}):jY()&&("undefined"!=typeof addEventListener?addEventListener("storage",function(h){g.emit(h.key)}):window.attachEvent("storage",function(h){g.emit(h.key)}))}function bm(){aq.EventEmitter.call(this),this._listeners={},bg(this)}function bI(g,i){var h=this;cU.queue.push({action:function(j){by(h,g,j)},callback:i}),ek(h.constructor)}function by(l,i,o){function q(w){var v=w.createObjectStore(j9,{keyPath:"id"});w.createObjectStore(bz,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),w.createObjectStore(c5,{keyPath:"digest"}),w.createObjectStore(cz,{keyPath:"id",autoIncrement:!1}),w.createObjectStore(cF),v.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),w.createObjectStore(dx,{keyPath:"_id"});var x=w.createObjectStore(bF,{autoIncrement:!0});x.createIndex("seq","seq"),x.createIndex("digestSeq","digestSeq",{unique:!0})}function u(w,v){var x=w.objectStore(j9);x.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),x.openCursor().onsuccess=function(B){var z=B.target.result;if(z){var A=z.value,y=f5(A);A.deletedOrLocal=y?"1":"0",x.put(A),z["continue"]()}else{v()}}}function g(v){v.createObjectStore(dx,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}function h(z,A){var x=z.objectStore(dx),y=z.objectStore(j9),w=z.objectStore(bz),v=y.openCursor();v.onsuccess=function(J){var G=J.target.result;if(G){var B=G.value,D=B.id,C=kg(D),L=fK(B);if(C){var I=D+"::"+L,F=D+"::",K=D+"::~",H=w.index("_doc_id_rev"),E=IDBKeyRange.bound(F,K,!1,!1),M=H.openCursor(E);M.onsuccess=function(N){if(M=N.target.result){var O=M.value;O._doc_id_rev===I&&x.put(O),w["delete"](M.primaryKey),M["continue"]()}else{y["delete"](G.primaryKey),G["continue"]()}}}else{G["continue"]()}}else{A&&A()}}}function s(w){var v=w.createObjectStore(bF,{autoIncrement:!0});v.createIndex("seq","seq"),v.createIndex("digestSeq","digestSeq",{unique:!0})}function k(z,A){var x=z.objectStore(bz),y=z.objectStore(c5),w=z.objectStore(bF),v=y.count();v.onsuccess=function(B){var C=B.target.result;return C?void (x.openCursor().onsuccess=function(D){var J=D.target.result;if(!J){return A()}for(var I=J.value,L=J.primaryKey,F=Object.keys(I._attachments||{}),H={},G=0;G<F.length;G++){var E=I._attachments[F[G]];H[E.digest]=!0}var M=Object.keys(H);for(G=0;G<M.length;G++){var K=M[G];w.put({seq:L,digestSeq:K+"::"+L})}J["continue"]()}):A()}}function m(w){function y(A){return A.data?jZ(A):(A.deleted="1"===A.deletedOrLocal,A)}var z=w.objectStore(bz),v=w.objectStore(j9),x=v.openCursor();x.onsuccess=function(C){function D(){var H=B.id+"::",F=B.id+"::￿",G=z.index("_doc_id_rev").openCursor(IDBKeyRange.bound(H,F)),I=0;G.onsuccess=function(K){var J=K.target.result;if(!J){return B.seq=I,A()}var L=J.primaryKey;L>I&&(I=L),J["continue"]()}}function A(){var G=aW(B,B.winningRev,B.deleted),F=v.put(G);F.onsuccess=function(){E["continue"]()}}var E=C.target.result;if(E){var B=y(E.value);return B.winningRev=B.winningRev||fK(B),B.seq?A():void D()}}}var j=i.name,p=null;l._meta=null,l.type=function(){return"idb"},l._id=fC(function(v){v(null,l._meta.instanceId)}),l._bulkDocs=function(x,v,w){fB(i,x,v,l,p,cb,w)},l._get=function(D,x,C){function A(){C(v,{doc:B,metadata:z,ctx:y})}var B,z,v,y=x.ctx;if(!y){var w=eH(p,[j9,bz,c5],"readonly");if(w.error){return C(w.error)}y=w.txn}y.objectStore(j9).get(D).onsuccess=function(E){if(z=jZ(E.target.result),!z){return v=kb(aO,"missing"),A()}if(f5(z)&&!x.rev){return v=kb(aO,"deleted"),A()}var G=y.objectStore(bz),H=x.rev||z.winningRev,F=z.id+"::"+H;G.index("_doc_id_rev").get(F).onsuccess=function(I){return B=I.target.result,B&&(B=fG(B)),B?void A():(v=kb(aO,"missing"),A())}}},l._getAttachment=function(A,y,z){var x;if(y.ctx){x=y.ctx}else{var B=eH(p,[j9,bz,c5],"readonly");if(B.error){return z(B.error)}x=B.txn}var v=A.digest,w=A.content_type;x.objectStore(c5).get(v).onsuccess=function(C){var D=C.target.result.body;cN(D,w,y.binary,function(E){z(null,E)})}},l._info=function(y){if(null===p||!fF.has(j)){var x=new Error("db isn't open");return x.id="idbNull",y(x)}var A,z,v=eH(p,[bz],"readonly");if(v.error){return y(v.error)}var w=v.txn,B=w.objectStore(bz).openCursor(null,"prev");B.onsuccess=function(D){var C=D.target.result;A=C?C.key:0,z=l._meta.docCount},w.oncomplete=function(){y(null,{doc_count:z,update_seq:A,idb_attachment_format:l._meta.blobSupport?"binary":"base64"})}},l._allDocs=function(v,w){dp(v,l,p,w)},l._changes=function(z){function y(N){function S(){return R.seq!==T?N["continue"]():(v=T,R.winningRev===O._rev?Q(O):void P())}function P(){var U=O._id+"::"+R.winningRev,V=J.get(U);V.onsuccess=function(W){Q(fG(W.target.result))}}function Q(V){var W=z.processChange(V,R,z);W.seq=R.seq;var U=A(W);return"object"==typeof U?z.complete(U):(U&&(L++,F&&D.push(W),z.attachments&&z.include_docs?aS(V,z,w,function(){bx([W],z.binary).then(function(){z.onChange(W)})}):z.onChange(W)),void (L!==x&&N["continue"]()))}var O=fG(N.value),T=N.key;if(C&&!C.has(O._id)){return N["continue"]()}var R;return(R=K.get(O._id))?S():void (G.get(O._id).onsuccess=function(U){R=jZ(U.target.result),K.set(O._id,R),S()})}function I(O){var N=O.target.result;N&&y(N)}function M(){var O=[j9,bz];z.attachments&&O.push(c5);var N=eH(p,O,"readonly");if(N.error){return z.complete(N.error)}w=N.txn,w.onabort=eV(z.complete),w.oncomplete=H,B=w.objectStore(bz),G=w.objectStore(j9),J=B.index("_doc_id_rev");var P;P=z.descending?B.openCursor(null,"prev"):B.openCursor(IDBKeyRange.lowerBound(z.since,!0)),P.onsuccess=I}function H(){function N(){z.complete(null,{results:D,last_seq:v})}!z.continuous&&z.attachments?bx(D).then(N):N()}if(z=e5(z),z.continuous){var E=j+":"+kh();return cb.addListener(j,E,l,z),cb.notify(j),{cancel:function(){cb.removeListener(j,E)}}}var C=z.doc_ids&&new ck.Set(z.doc_ids);z.since=z.since||0;var v=z.since,x="limit" in z?z.limit:-1;0===x&&(x=1);var F;F="return_docs" in z?z.return_docs:"returnDocs" in z?z.returnDocs:!0;var w,B,G,J,D=[],L=0,A=eT(z),K=new ck.Map;M()},l._close=function(v){return null===p?v(kb(e4)):(p.close(),fF["delete"](j),p=null,void v())},l._getRevisionTree=function(w,y){var z=eH(p,[j9],"readonly");if(z.error){return y(z.error)}var v=z.txn,x=v.objectStore(j9).get(w);x.onsuccess=function(B){var A=jZ(B.target.result);A?y(null,A.rev_tree):y(kb(aO))}},l._doCompaction=function(A,y,z){var x=[j9,bz,c5,bF],B=eH(p,x,"readwrite");if(B.error){return z(B.error)}var v=B.txn,w=v.objectStore(j9);w.get(A).onsuccess=function(E){var C=jZ(E.target.result);j8(C.rev_tree,function(L,H,K,G,J){var I=H+"-"+K;-1!==y.indexOf(I)&&(J.status="missing")}),bQ(y,A,v);var D=C.winningRev,F=C.deleted;v.objectStore(j9).put(aW(C,D,F))},v.onabort=eV(z),v.oncomplete=function(){z()}},l._getLocal=function(w,y){var z=eH(p,[dx],"readonly");if(z.error){return y(z.error)}var v=z.txn,x=v.objectStore(dx).get(w);x.onerror=eV(y),x.onsuccess=function(B){var A=B.target.result;A?(delete A._doc_id_rev,y(null,A)):y(kb(aO))}},l._putLocal=function(E,y,D){"function"==typeof y&&(D=y,y={}),delete E._revisions;var B=E._rev,C=E._id;B?E._rev="0-"+(parseInt(B.split("-")[1],10)+1):E._rev="0-1";var A,w=y.ctx;if(!w){var z=eH(p,[dx],"readwrite");if(z.error){return D(z.error)}w=z.txn,w.onerror=eV(D),w.oncomplete=function(){A&&D(null,A)}}var x,v=w.objectStore(dx);B?(x=v.get(C),x.onsuccess=function(H){var G=H.target.result;if(G&&G._rev===B){var F=v.put(E);F.onsuccess=function(){A={ok:!0,id:E._id,rev:E._rev},y.ctx&&D(null,A)}}else{D(kb(b7))}}):(x=v.add(E),x.onerror=function(F){D(kb(b7)),F.preventDefault(),F.stopPropagation()},x.onsuccess=function(){A={ok:!0,id:E._id,rev:E._rev},y.ctx&&D(null,A)})},l._removeLocal=function(D,x,C){"function"==typeof x&&(C=x,x={});var A=x.ctx;if(!A){var B=eH(p,[dx],"readwrite");if(B.error){return C(B.error)}A=B.txn,A.oncomplete=function(){z&&C(null,z)}}var z,v=D._id,y=A.objectStore(dx),w=y.get(v);w.onerror=eV(C),w.onsuccess=function(F){var E=F.target.result;E&&E._rev===D._rev?(y["delete"](v),z={ok:!0,id:v,rev:"0-0"},x.ctx&&C(null,z)):C(kb(aO))}},l._destroy=function(v,x){cb.removeAllListeners(j);var w=b1.get(j);w&&w.result&&(w.result.close(),fF["delete"](j));var y=indexedDB.deleteDatabase(j);y.onsuccess=function(){b1["delete"](j),jY()&&j in localStorage&&delete localStorage[j],x(null,{ok:!0})},y.onerror=eV(x)};var n=fF.get(j);if(n){return p=n.idb,l._meta=n.global,void eB.nextTick(function(){o(null,l)})}var r;r=i.storage?cY(j,i.storage):indexedDB.open(j,cA),b1.set(j,r),r.onupgradeneeded=function(x){function w(){var B=y[v-1];v++,B&&B(A,w)}var z=x.target.result;if(x.oldVersion<1){return q(z)}var A=x.currentTarget.transaction;x.oldVersion<3&&g(z),x.oldVersion<4&&s(z);var y=[u,h,k,m],v=x.oldVersion;w()},r.onsuccess=function(y){p=y.target.result,p.onversionchange=function(){p.close(),fF["delete"](j)},p.onabort=function(B){console.error("Database has a global failure",B.target.error),p.close(),fF["delete"](j)};var x=p.transaction([cz,cF,j9],"readwrite"),w=x.objectStore(cz).get(cz),z=null,v=null,A=null;w.onsuccess=function(D){var B=function(){null!==z&&null!==v&&null!==A&&(l._meta={name:j,instanceId:A,blobSupport:z,docCount:v},fF.set(j,{idb:p,global:l._meta}),o(null,l))},E=D.target.result||{id:cz};j+"_id" in E?(A=E[j+"_id"],B()):(A=kh(),E[j+"_id"]=A,x.objectStore(cz).put(E).onsuccess=function(){B()}),e2||(e2=bq(x)),e2.then(function(F){z=F,B()});var C=x.objectStore(j9).index("deletedOrLocal");C.count(IDBKeyRange.only("0")).onsuccess=function(F){v=F.target.result,B()}}},r.onerror=function(){var v="Failed to open indexedDB, are you in private browsing mode?";console.error(v),o(kb(eA,v))}}function cY(g,i){try{return indexedDB.open(g,{version:cA,storage:i})}catch(h){return indexedDB.open(g,cA)}}function em(g){return decodeURIComponent(window.escape(g))}function jI(g){return 65>g?g-48:g-55}function cQ(g,i,h){for(var j="";h>i;){j+=String.fromCharCode(jI(g.charCodeAt(i++))<<4|jI(g.charCodeAt(i++)))}return j}function dX(g,i,h){for(var j="";h>i;){j+=String.fromCharCode(jI(g.charCodeAt(i+2))<<12|jI(g.charCodeAt(i+3))<<8|jI(g.charCodeAt(i))<<4|jI(g.charCodeAt(i+1))),i+=4}return j}function aV(h,g){return"UTF-8"===g?em(cQ(h,0,h.length)):dX(h,0,h.length)}function dB(g){return"'"+g+"'"}function dG(){return"undefined"!=typeof sqlitePlugin?sqlitePlugin.openDatabase.bind(sqlitePlugin):"undefined"!=typeof openDatabase?function(g){return openDatabase(g.name,g.version,g.description,g.size)}:void 0}function dm(){return"undefined"!=typeof openDatabase||"undefined"!=typeof SQLitePlugin}function j3(g){return g.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"")}function ca(g){return g.replace(/\u0001\u0001/g,"\x00").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,"")}function cv(g){return delete g._id,delete g._rev,JSON.stringify(g)}function b3(g,i,h){return g=JSON.parse(g),g._id=i,g._rev=h,g}function bU(h){for(var g="(";h--;){g+="?",h&&(g+=",")}return g+")"}function ka(k,i,h,j,g){return"SELECT "+k+" FROM "+("string"==typeof i?i:i.join(" JOIN "))+(h?" ON "+h:"")+(j?" WHERE "+("string"==typeof j?j:j.join(" AND ")):"")+(g?" ORDER BY "+g:"")}function bE(i,l,g){function m(){++k===i.length&&j()}function j(){if(h.length){var n="SELECT DISTINCT digest AS digest FROM "+j6+" WHERE seq IN "+bU(h.length);g.executeSql(n,h,function(q,o){for(var s=[],p=0;p<o.rows.length;p++){s.push(o.rows.item(p).digest)}if(s.length){var r="DELETE FROM "+j6+" WHERE seq IN ("+h.map(function(){return"?"}).join(",")+")";q.executeSql(r,h,function(v){var u="SELECT digest FROM "+j6+" WHERE digest IN ("+s.map(function(){return"?"}).join(",")+")";v.executeSql(u,s,function(z,w){for(var y=new ck.Set,x=0;x<w.rows.length;x++){y.add(w.rows.item(x).digest)}s.forEach(function(A){y.has(A)||(z.executeSql("DELETE FROM "+j6+" WHERE digest=?",[A]),z.executeSql("DELETE FROM "+bV+" WHERE digest=?",[A]))})})})}})}}if(i.length){var k=0,h=[];i.forEach(function(o){var n="SELECT seq FROM "+cu+" WHERE doc_id=? AND rev=?";g.executeSql(n,[l,o],function(q,p){if(!p.rows.length){return m()}var r=p.rows.item(0).seq;h.push(r),q.executeSql("DELETE FROM "+cu+" WHERE seq=?",[r],m)})})}}function eO(g){return function(h){console.error("WebSQL threw an error",h);var k=h&&h.constructor.toString().match(/function ([^\(]+)/),i=k&&k[1]||h.type,j=h.target||h.message;g(kb(jP,j,i))}}function aj(h){if("size" in h){return 1000000*h.size}var g="undefined"!=typeof navigator&&/Android/.test(navigator.userAgent);return g?5000000:1}function dE(g,i){try{return{db:g(i)}}catch(h){return{error:h}}}function dM(g){var i=bv.get(g.name);if(!i){var h=dG();i=dE(h,g),bv.set(g.name,i),i.db&&(i.db._sqlitePlugin="undefined"!=typeof sqlitePlugin)}return i}function eY(C,A,k,g,i,v,w){function n(){return z?w(z):(v.notify(g._name),g._docCount=-1,void w(null,u))}function x(E,D){var F="SELECT count(*) as cnt FROM "+bV+" WHERE digest=?";l.executeSql(F,[E],function(G,H){if(0===H.rows.item(0).cnt){var I=kb(ch,"unknown stub attachment with digest "+E);D(I)}else{D()}})}function q(F){function D(){++G===H.length&&F(E)}var H=[];if(o.forEach(function(I){I.data&&I.data._attachments&&Object.keys(I.data._attachments).forEach(function(J){var K=I.data._attachments[J];K.stub&&H.push(K.digest)})}),!H.length){return F()}var E,G=0;H.forEach(function(I){x(I,function(J){J&&!E&&(E=J),D()})})}function B(I,Q,L,G,E,N,D,P){function K(){function W(ai,ar){function at(){return ++a0===ae.length&&ar(),!1}function an(a3){var a1="INSERT INTO "+j6+" (digest, seq) VALUES (?,?)",a2=[V._attachments[a3].digest,ai];l.executeSql(a1,a2,at,at)}var a0=0,ae=Object.keys(V._attachments||{});if(!ae.length){return ar()}for(var ao=0;ao<ae.length;ao++){an(ae[ao])}}var V=I.data,Y=G?1:0,T=V._id,X=V._rev,Z=cv(V),S="INSERT INTO "+cu+" (doc_id, rev, json, deleted) VALUES (?, ?, ?, ?);",U=[T,X,Z,Y];l.executeSql(S,U,function(ae,an){var ai=an.insertId;W(ai,function(){J(ae,ai)})},function(){var ae=ka("seq",cu,null,"doc_id=? AND rev=?");return l.executeSql(ae,[T,X],function(ao,ar){var at=ar.rows.item(0).seq,an="UPDATE "+cu+" SET json=?, deleted=? WHERE doc_id=? AND rev=?;",ai=[Z,Y,T,X];ao.executeSql(an,ai,function(a0){W(at,function(){J(a0,at)})})}),!1})}function H(S){F||(S?(F=S,P(F)):O===M.length&&K())}function R(S){O++,H(S)}function J(X,V){var S=I.metadata.id;E&&g.auto_compaction?bE(eR(I.metadata),S,X):I.stemmedRevs.length&&bE(I.stemmedRevs,S,X),I.metadata.seq=V,delete I.metadata.rev;var W=E?"UPDATE "+e8+" SET json=?, max_seq=?, winningseq=(SELECT seq FROM "+cu+" WHERE doc_id="+e8+".id AND rev=?) WHERE id=?":"INSERT INTO "+e8+" (id, winningseq, max_seq, json) VALUES (?,?,?,?);",T=dL(I.metadata),U=E?[T,V,Q,S]:[S,V,V,T];X.executeSql(W,U,function(){u[D]={ok:!0,id:I.metadata.id,rev:Q},r.set(S,I.metadata),P()})}var F=null,O=0;I.data._id=I.metadata.id,I.data._rev=I.metadata.rev;var M=Object.keys(I.data._attachments||{});G&&(I.data._deleted=!0),M.forEach(function(U){var S=I.data._attachments[U];if(S.stub){O++,H()}else{var T=S.data;delete S.data,S.revpos=parseInt(Q,10);var V=S.digest;y(V,T,R)}}),M.length||K()}function s(){bs(C.revs_limit,o,g,r,l,u,B,k)}function m(E){function D(){++F===o.length&&E()}if(!o.length){return E()}var F=0;o.forEach(function(G){if(G._id&&kg(G._id)){return D()}var H=G.metadata.id;l.executeSql("SELECT json FROM "+e8+" WHERE id = ?",[H],function(I,K){if(K.rows.length){var J=f8(K.rows.item(0).json);r.set(H,J)}D()})})}function y(F,D,G){var E="SELECT digest FROM "+bV+" WHERE digest=?";l.executeSql(E,[F],function(H,I){return I.rows.length?G():(E="INSERT INTO "+bV+" (digest, body, escaped) VALUES (?,?,1)",void H.executeSql(E,[F,j3(D)],function(){G()},function(){return G(),!1}))})}var h=k.new_edits,p=A.docs,o=p.map(function(E){if(E._id&&kg(E._id)){return E}var D=d1(E,h);return D}),j=o.filter(function(D){return D.error});if(j.length){return w(j[0])}var l,z,u=new Array(o.length),r=new ck.Map;ke(o,"binary",function(D){return D?w(D):void i.transaction(function(E){l=E,q(function(F){F?z=F:m(s)})},eO(w),n)})}function bw(l,h,k,i,j){function o(){++m===n.length&&j&&j()}function g(r,s){var q=r._attachments[s],p={binary:h.binary,ctx:i};k._getAttachment(q,p,function(u,v){r._attachments[s]=e3.extend(dh(q,["digest","content_type"]),{data:v}),o()})}var n=Object.keys(l._attachments||{});if(!n.length){return j&&j()}var m=0;n.forEach(function(p){h.attachments&&h.include_docs?g(l,p):(l._attachments[p].stub=!0,o())})}function dH(s,g){function x(){jY()&&(window.localStorage["_pouch__websqldb_"+m._name]=!0),g(null,m)}function j(F,E){F.executeSql(cs),F.executeSql("ALTER TABLE "+cu+" ADD COLUMN deleted TINYINT(1) DEFAULT 0",[],function(){F.executeSql(cL),F.executeSql("ALTER TABLE "+e8+" ADD COLUMN local TINYINT(1) DEFAULT 0",[],function(){F.executeSql("CREATE INDEX IF NOT EXISTS 'doc-store-local-idx' ON "+e8+" (local, id)");var G="SELECT "+e8+".winningseq AS seq, "+e8+".json AS metadata FROM "+cu+" JOIN "+e8+" ON "+cu+".seq = "+e8+".winningseq";F.executeSql(G,[],function(M,I){for(var L=[],O=[],H=0;H<I.rows.length;H++){var J=I.rows.item(H),K=J.seq,N=JSON.parse(J.metadata);f5(N)&&L.push(K),kg(N.id)&&O.push(N.id)}M.executeSql("UPDATE "+e8+"SET local = 1 WHERE id IN "+bU(O.length),O,function(){M.executeSql("UPDATE "+cu+" SET deleted = 1 WHERE seq IN "+bU(L.length),L,E)})})})})}function v(F,E){var G="CREATE TABLE IF NOT EXISTS "+c9+" (id UNIQUE, rev, json)";F.executeSql(G,[],function(){var H="SELECT "+e8+".id AS id, "+cu+".json AS data FROM "+cu+" JOIN "+e8+" ON "+cu+".seq = "+e8+".winningseq WHERE local = 1";F.executeSql(H,[],function(M,J){function L(){if(!I.length){return E(M)}var O=I.shift(),N=JSON.parse(O.data)._rev;M.executeSql("INSERT INTO "+c9+" (id, rev, json) VALUES (?,?,?)",[O.id,N,O.data],function(P){P.executeSql("DELETE FROM "+e8+" WHERE id=?",[O.id],function(Q){Q.executeSql("DELETE FROM "+cu+" WHERE seq=?",[O.seq],function(){L()})})})}for(var I=[],K=0;K<J.rows.length;K++){I.push(J.rows.item(K))}L()})})}function C(G,E){function H(I){function J(){if(!I.length){return E(G)}var M=I.shift(),K=aV(M.hex,z),O=K.lastIndexOf("::"),L=K.substring(0,O),P=K.substring(O+2),N="UPDATE "+cu+" SET doc_id=?, rev=? WHERE doc_id_rev=?";G.executeSql(N,[L,P,K],function(){J()})}J()}var F="ALTER TABLE "+cu+" ADD COLUMN doc_id";G.executeSql(F,[],function(I){var J="ALTER TABLE "+cu+" ADD COLUMN rev";I.executeSql(J,[],function(K){K.executeSql(dC,[],function(L){var M="SELECT hex(doc_id_rev) as hex FROM "+cu;L.executeSql(M,[],function(P,N){for(var O=[],Q=0;Q<N.rows.length;Q++){O.push(N.rows.item(Q))}H(O)})})})})}function i(G,E){function H(J){var I="SELECT COUNT(*) AS cnt FROM "+bV;J.executeSql(I,[],function(L,N){function K(){var Q=ka(fQ+", "+e8+".id AS id",[e8,cu],bb,null,e8+".id ");Q+=" LIMIT "+O+" OFFSET "+P,P+=O,L.executeSql(Q,[],function(ai,V){function Z(at,ar){var ao=X[at]=X[at]||[];-1===ao.indexOf(ar)&&ao.push(ar)}if(!V.rows.length){return E(ai)}for(var X={},S=0;S<V.rows.length;S++){for(var U=V.rows.item(S),T=b3(U.data,U.id,U.rev),an=Object.keys(T._attachments||{}),ae=0;ae<an.length;ae++){var W=T._attachments[an[ae]];Z(W.digest,U.seq)}}var R=[];if(Object.keys(X).forEach(function(ar){var ao=X[ar];ao.forEach(function(at){R.push([ar,at])})}),!R.length){return K()}var Y=0;R.forEach(function(ao){var ar="INSERT INTO "+j6+" (digest, seq) VALUES (?,?)";ai.executeSql(ar,ao,function(){++Y===R.length&&K()})})})}var M=N.rows.item(0).cnt;if(!M){return E(L)}var P=0,O=10;K()})}var F="CREATE TABLE IF NOT EXISTS "+j6+" (digest, seq INTEGER)";G.executeSql(F,[],function(I){I.executeSql(cR,[],function(J){J.executeSql(e7,[],H)})})}function h(F,E){var G="ALTER TABLE "+bV+" ADD COLUMN escaped TINYINT(1) DEFAULT 0";F.executeSql(G,[],E)}function q(F,E){var G="ALTER TABLE "+e8+" ADD COLUMN max_seq INTEGER";F.executeSql(G,[],function(H){var I="UPDATE "+e8+" SET max_seq=(SELECT MAX(seq) FROM "+cu+" WHERE doc_id=id)";H.executeSql(I,[],function(J){var K="CREATE UNIQUE INDEX IF NOT EXISTS 'doc-max-seq-idx' ON "+e8+" (max_seq)";J.executeSql(K,[],E)})})}function r(F,E){F.executeSql('SELECT HEX("a") AS hex',[],function(H,I){var G=I.rows.item(0).hex;z=2===G.length?"UTF-8":"UTF-16",E()})}function w(){for(;l.length>0;){var E=l.pop();E(null,y)}}function D(H,P){if(0===P){var L="CREATE TABLE IF NOT EXISTS "+dU+" (dbid, db_version INTEGER)",I="CREATE TABLE IF NOT EXISTS "+bV+" (digest UNIQUE, escaped TINYINT(1), body BLOB)",G="CREATE TABLE IF NOT EXISTS "+j6+" (digest, seq INTEGER)",E="CREATE TABLE IF NOT EXISTS "+e8+" (id unique, json, winningseq, max_seq INTEGER UNIQUE)",F="CREATE TABLE IF NOT EXISTS "+cu+" (seq INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, json, deleted TINYINT(1), doc_id, rev)",K="CREATE TABLE IF NOT EXISTS "+c9+" (id UNIQUE, rev, json)";H.executeSql(I),H.executeSql(K),H.executeSql(G,[],function(){H.executeSql(e7),H.executeSql(cR)}),H.executeSql(E,[],function(){H.executeSql(cs),H.executeSql(F,[],function(){H.executeSql(cL),H.executeSql(dC),H.executeSql(L,[],function(){var Q="INSERT INTO "+dU+" (db_version, dbid) VALUES (?,?)";y=kh();var R=[bT,y];H.executeSql(Q,R,function(){w()})})})})}else{var N=function(){var R=bT>P;R&&H.executeSql("UPDATE "+dU+" SET db_version = "+bT);var Q="SELECT dbid FROM "+dU;H.executeSql(Q,[],function(T,S){y=S.rows.item(0).dbid,w()})},J=[j,v,C,i,h,q,N],M=P,O=function(Q){J[M-1](Q,O),M++};O(H)}}function p(){k.transaction(function(E){r(E,function(){o(E)})},eO(g),x)}function o(F){var E="SELECT sql FROM sqlite_master WHERE tbl_name = "+dU;F.executeSql(E,[],function(H,G){G.rows.length?/db_version/.test(G.rows.item(0).sql)?H.executeSql("SELECT db_version FROM "+dU,[],function(K,J){var I=J.rows.item(0).db_version;D(K,I)}):H.executeSql("ALTER TABLE "+dU+" ADD COLUMN db_version INTEGER",[],function(){D(H,1)}):D(H,0)})}function n(F,E){if(-1!==m._docCount){return E(m._docCount)}var G=ka("COUNT("+e8+".id) AS 'num'",[e8,cu],bb,cu+".deleted=0");F.executeSql(G,[],function(H,I){m._docCount=I.rows.item(0).num,E(m._docCount)})}var z,m=this,y=null,u=aj(s),l=[];m._docCount=-1,m._name=s.name;var A=e3.extend({},s,{size:u,version:d9}),B=dM(A);if(B.error){return eO(g)(B.error)}var k=B.db;"function"!=typeof k.readTransaction&&(k.readTransaction=k.transaction),p(),m.type=function(){return"websql"},m._id=fC(function(E){E(null,y)}),m._info=function(E){k.readTransaction(function(F){n(F,function(H){var G="SELECT MAX(seq) AS seq FROM "+cu;F.executeSql(G,[],function(J,K){var I=K.rows.item(0).seq||0;E(null,{doc_count:H,update_seq:I,sqlite_plugin:k._sqlitePlugin,websql_encoding:z})})})},eO(E))},m._bulkDocs=function(E,G,F){eY(s,E,G,m,k,ax,F)},m._get=function(H,L,F){function M(){F(J,{doc:N,metadata:G,ctx:E})}var N,G,J,E=L.ctx;if(!E){return k.readTransaction(function(O){m._get(H,e3.extend({ctx:O},L),F)})}var K,I;L.rev?(K=ka(fQ,[e8,cu],e8+".id="+cu+".doc_id",[cu+".doc_id=?",cu+".rev=?"]),I=[H,L.rev]):(K=ka(fQ,[e8,cu],bb,e8+".id=?"),I=[H]),E.executeSql(K,I,function(O,P){if(!P.rows.length){return J=kb(aO,"missing"),M()}var Q=P.rows.item(0);return G=f8(Q.metadata),Q.deleted&&!L.rev?(J=kb(aO,"deleted"),M()):(N=b3(Q.data,G.id,Q.rev),void M())})},m._allDocs=function(H,P){var M,I=[],K="startkey" in H?H.startkey:!1,E="endkey" in H?H.endkey:!1,N="key" in H?H.key:!1,Q="descending" in H?H.descending:!1,O="limit" in H?H.limit:-1,L="skip" in H?H.skip:0,G=H.inclusive_end!==!1,R=[],J=[];if(N!==!1){J.push(e8+".id = ?"),R.push(N)}else{if(K!==!1||E!==!1){if(K!==!1&&(J.push(e8+".id "+(Q?"<=":">=")+" ?"),R.push(K)),E!==!1){var F=Q?">":"<";G&&(F+="="),J.push(e8+".id "+F+" ?"),R.push(E)}N!==!1&&(J.push(e8+".id = ?"),R.push(N))}}"ok"!==H.deleted&&J.push(cu+".deleted = 0"),k.readTransaction(function(S){n(S,function(U){if(M=U,0!==O){var T=ka(fQ,[e8,cu],bb,J,e8+".id "+(Q?"DESC":"ASC"));T+=" LIMIT "+O+" OFFSET "+L,S.executeSql(T,R,function(Z,an){for(var ai=0,V=an.rows.length;V>ai;ai++){var Y=an.rows.item(ai),ae=f8(Y.metadata),ar=ae.id,X=b3(Y.data,ar,Y.rev),W=X._rev,ao={id:ar,key:ar,value:{rev:W}};if(H.include_docs&&(ao.doc=X,ao.doc._rev=W,H.conflicts&&(ao.doc._conflicts=eW(ae)),bw(ao.doc,H,m,Z)),Y.deleted){if("ok"!==H.deleted){continue}ao.value.deleted=!0,ao.doc=null}I.push(ao)}})}})},eO(P),function(){P(null,{total_rows:M,offset:H.skip,rows:I})})},m._changes=function(J){function K(){var S=e8+".json AS metadata, "+e8+".max_seq AS maxSeq, "+cu+".json AS winningDoc, "+cu+".rev AS winningRev ",T=e8+" JOIN "+cu,R=e8+".id="+cu+".doc_id AND "+e8+".winningseq="+cu+".seq",Q=["maxSeq > ?"],N=[J.since];J.doc_ids&&(Q.push(e8+".id IN "+bU(J.doc_ids.length)),N=N.concat(J.doc_ids));var U="maxSeq "+(G?"DESC":"ASC"),O=ka(S,T,R,Q,U),M=eT(J);J.view||J.filter||(O+=" LIMIT "+L);var P=J.since||0;k.readTransaction(function(V){V.executeSql(O,N,function(Y,Z){function X(a0){return function(){J.onChange(a0)}}for(var W=0,ao=Z.rows.length;ao>W;W++){var an=Z.rows.item(W),ai=f8(an.metadata);P=an.maxSeq;var ae=b3(an.winningDoc,ai.id,an.winningRev),at=J.processChange(ae,ai,J);at.seq=an.maxSeq;var ar=M(at);if("object"==typeof ar){return J.complete(ar)}if(ar&&(F++,I&&H.push(at),J.attachments&&J.include_docs?bw(ae,J,m,Y,X(at)):X(at)()),F===L){break}}})},eO(J.complete),function(){J.continuous||J.complete(null,{results:H,last_seq:P})})}if(J=e5(J),J.continuous){var E=m._name+":"+kh();return ax.addListener(m._name,E,m,J),ax.notify(m._name),{cancel:function(){ax.removeListener(m._name,E)}}}var G=J.descending;J.since=J.since&&!G?J.since:0;var L="limit" in J?J.limit:-1;0===L&&(L=1);var I;I="return_docs" in J?J.return_docs:"returnDocs" in J?J.returnDocs:!0;var H=[],F=0;K()},m._close=function(E){E()},m._getAttachment=function(J,K,E){var G,L=K.ctx,I=J.digest,H=J.content_type,F="SELECT escaped, CASE WHEN escaped = 1 THEN body ELSE HEX(body) END AS body FROM "+bV+" WHERE digest=?";L.executeSql(F,[I],function(P,M){var N=M.rows.item(0),O=N.escaped?ca(N.body):aV(N.body,z);G=K.binary?bK(O,H):fH(O),E(null,G)})},m._getRevisionTree=function(F,E){k.readTransaction(function(H){var G="SELECT json AS metadata FROM "+e8+" WHERE id = ?";H.executeSql(G,[F],function(K,I){if(I.rows.length){var J=f8(I.rows.item(0).metadata);E(null,J.rev_tree)}else{E(kb(aO))}})})},m._doCompaction=function(F,E,G){return E.length?void k.transaction(function(I){var H="SELECT json AS metadata FROM "+e8+" WHERE id = ?";I.executeSql(H,[F],function(J,L){var M=f8(L.rows.item(0).metadata);j8(M.rev_tree,function(O,Q,N,P,S){var R=Q+"-"+N;-1!==E.indexOf(R)&&(S.status="missing")});var K="UPDATE "+e8+" SET json = ? WHERE id = ?";J.executeSql(K,[dL(M),F])}),bE(E,F,I)},eO(G),function(){G()}):G()},m._getLocal=function(F,E){k.readTransaction(function(H){var G="SELECT json, rev FROM "+c9+" WHERE id=?";H.executeSql(G,[F],function(I,K){if(K.rows.length){var L=K.rows.item(0),J=b3(L.json,F,L.rev);E(null,J)}else{E(kb(aO))}})})},m._putLocal=function(I,L,G){function E(N){var P,O;H?(P="UPDATE "+c9+" SET rev=?, json=? WHERE id=? AND rev=?",O=[F,K,J,H]):(P="INSERT INTO "+c9+" (id, rev, json) VALUES (?,?,?)",O=[J,F,K]),N.executeSql(P,O,function(R,Q){Q.rowsAffected?(M={ok:!0,id:J,rev:F},L.ctx&&G(null,M)):G(kb(b7))},function(){return G(kb(b7)),!1})}"function"==typeof L&&(G=L,L={}),delete I._revisions;var F,H=I._rev,J=I._id;F=H?I._rev="0-"+(parseInt(H.split("-")[1],10)+1):I._rev="0-1";var M,K=cv(I);L.ctx?E(L.ctx):k.transaction(E,eO(G),function(){M&&G(null,M)})},m._removeLocal=function(G,E,I){function F(L){var K="DELETE FROM "+c9+" WHERE id=? AND rev=?",J=[G._id,G._rev];L.executeSql(K,J,function(N,M){return M.rowsAffected?(H={ok:!0,id:G._id,rev:"0-0"},void (E.ctx&&I(null,H))):I(kb(aO))})}"function"==typeof E&&(I=E,E={});var H;E.ctx?F(E.ctx):k.transaction(F,eO(I),function(){H&&I(null,H)})},m._destroy=function(F,E){ax.removeAllListeners(m._name),k.transaction(function(H){var G=[e8,cu,bV,dU,c9,j6];G.forEach(function(I){H.executeSql("DROP TABLE IF EXISTS "+I,[])})},eO(E),function(){jY()&&(delete window.localStorage["_pouch__websqldb_"+m._name],delete window.localStorage[m._name]),E(null,{ok:!0})})}}var e3=f(7),bB=dJ(e3),aR=dJ(f(2)),du=dJ(f(6)),eI=dJ(f(8)),ck=f(12),aG=dJ(f(1)),aq=f(4),ec=dJ(f(14)),bL=f(10),cV=dJ(bL),al=dJ(f(15)),jN=dJ(f(16)),e="function"==typeof Promise?Promise:eI,bM=aR("pouchdb:api");du(j7,Error),j7.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};var eh=new j7({status:401,error:"unauthorized",reason:"Name or password is incorrect."}),eS=new j7({status:400,error:"bad_request",reason:"Missing JSON list of 'docs'"}),aO=new j7({status:404,error:"not_found",reason:"missing"}),b7=new j7({status:409,error:"conflict",reason:"Document update conflict"}),jL=new j7({status:400,error:"invalid_id",reason:"_id field must contain a string"}),b8=new j7({status:412,error:"missing_id",reason:"_id is required for puts"}),dK=new j7({status:400,error:"bad_request",reason:"Only reserved document ids may start with underscore."}),e4=new j7({status:412,error:"precondition_failed",reason:"Database not open"}),bS=new j7({status:500,error:"unknown_error",reason:"Database encountered an unknown error"}),cm=new j7({status:500,error:"badarg",reason:"Some query argument is invalid"}),c0=new j7({status:400,error:"invalid_request",reason:"Request was invalid"}),dq=new j7({status:400,error:"query_parse_error",reason:"Some query parameter is invalid"}),b4=new j7({status:500,error:"doc_validation",reason:"Bad special document member"}),aQ=new j7({status:400,error:"bad_request",reason:"Something wrong with the request"}),cC=new j7({status:400,error:"bad_request",reason:"Document must be a JSON object"}),d8=new j7({status:404,error:"not_found",reason:"Database not found"}),eA=new j7({status:500,error:"indexed_db_went_bad",reason:"unknown"}),jP=new j7({status:500,error:"web_sql_went_bad",reason:"unknown"}),cK=new j7({status:500,error:"levelDB_went_went_bad",reason:"unknown"}),c4=new j7({status:403,error:"forbidden",reason:"Forbidden by design doc validate_doc_update function"}),ab=new j7({status:400,error:"bad_request",reason:"Invalid rev format"}),cT=new j7({status:412,error:"file_exists",reason:"The database could not be created, the file already exists."}),ch=new j7({status:412,error:"missing_stub"}),bk=new j7({status:413,error:"invalid_url",reason:"Provided URL is invalid"}),dY={UNAUTHORIZED:eh,MISSING_BULK_DOCS:eS,MISSING_DOC:aO,REV_CONFLICT:b7,INVALID_ID:jL,MISSING_ID:b8,RESERVED_ID:dK,NOT_OPEN:e4,UNKNOWN_ERROR:bS,BAD_ARG:cm,INVALID_REQUEST:c0,QUERY_PARSE_ERROR:dq,DOC_VALIDATION:b4,BAD_REQUEST:aQ,NOT_AN_OBJECT:cC,DB_MISSING:d8,WSQ_ERROR:jP,LDB_ERROR:cK,FORBIDDEN:c4,INVALID_REV:ab,FILE_EXISTS:cT,MISSING_STUB:ch,IDB_ERROR:eA,INVALID_URL:bk},j1=function(k,i,h){var j=Object.keys(dY).filter(function(m){var l=dY[m];return"function"!=typeof l&&l[k]===i}),g=h&&j.filter(function(m){var l=dY[m];return l.message===h})[0]||j[0];return g?dY[g]:null};du(f1,aq.EventEmitter),f1.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")},f1.prototype.doChanges=function(k){var i=this,h=k.complete;if(k=e5(k),"live" in k&&!("continuous" in k)&&(k.continuous=k.live),k.processChange=eE,"latest"===k.since&&(k.since="now"),k.since||(k.since=0),"now"===k.since){return void this.db.info().then(function(l){return i.isCancelled?void h(null,{status:"cancelled"}):(k.since=l.update_seq,void i.doChanges(k))},h)}if(k.continuous&&"now"!==k.since&&this.db.info().then(function(l){i.startSeq=l.update_seq},function(l){if("idbNull"!==l.id){throw l}}),k.filter&&"string"==typeof k.filter&&("_view"===k.filter?k.view=kd(k.view):k.filter=kd(k.filter),"http"!==this.db.type()&&!k.doc_ids)){return this.filterChanges(k)}"descending" in k||(k.descending=!1),k.limit=0===k.limit?1:k.limit,k.complete=h;var j=this.db._changes(k);if(j&&"function"==typeof j.cancel){var g=i.cancel;i.cancel=aG(function(l){j.cancel(),g.apply(this,l)})}},f1.prototype.filterChanges=function(l){var j=this,i=l.complete;if("_view"===l.filter){if(!l.view||"string"!=typeof l.view){var k=kb(aQ,"`view` filter parameter not found or invalid.");return i(k)}var h=cw(l.view);this.db.getView(h[0],h[1],function(m,n){return j.isCancelled?i(null,{status:"cancelled"}):m?i(c7(m)):n.map?(l.filter=ac(n.map),void j.doChanges(l)):i(kb(aO))})}else{var g=cw(l.filter);if(!g){return j.doChanges(l)}this.db.getFilter(g[0],g[1],function(m,n){return j.isCancelled?i(null,{status:"cancelled"}):m?i(c7(m)):(l.filter=ej(n),void j.doChanges(l))})}};var c8="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),bc=f2(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),dS=f2(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);du(f3,aq.EventEmitter),f3.prototype.post=d5("post",function(g,i,h){return"function"==typeof i&&(h=i,i={}),"object"!=typeof g||Array.isArray(g)?h(kb(cC)):void this.bulkDocs({docs:[g]},i,af(h))}),f3.prototype.put=d5("put",aG(function(i){var l,g,m,j,k=i.shift(),h="_id" in k;if("object"!=typeof k||Array.isArray(k)){return(j=i.pop())(kb(cC))}for(;;){if(l=i.shift(),g=typeof l,"string"!==g||h?"string"!==g||!h||"_rev" in k?"object"===g?m=l:"function"===g&&(j=l):k._rev=l:(k._id=l,h=!0),!i.length){break}}return m=m||{},j4(k._id),kg(k._id)&&"function"==typeof this._putLocal?k._deleted?this._removeLocal(k,j):this._putLocal(k,j):void this.bulkDocs({docs:[k]},m,af(j))})),f3.prototype.putAttachment=d5("putAttachment",function(i,l,g,m,j){function k(o){var n="_rev" in o?parseInt(o._rev,10):0;return o._attachments=o._attachments||{},o._attachments[l]={content_type:j,data:m,revpos:++n},h.put(o)}var h=this;return"function"==typeof j&&(j=m,m=g,g=null),"undefined"==typeof j&&(j=m,m=g,g=null),h.get(i).then(function(n){if(n._rev!==g){throw kb(b7)}return k(n)},function(n){if(n.reason===aO.message){return k({_id:i})}throw n})}),f3.prototype.removeAttachment=d5("removeAttachment",function(k,i,h,j){var g=this;g.get(k,function(m,l){return m?void j(m):l._rev!==h?void j(kb(b7)):l._attachments?(delete l._attachments[i],0===Object.keys(l._attachments).length&&delete l._attachments,void g.put(l,j)):j()})}),f3.prototype.remove=d5("remove",function(l,j,i,k){var h;"string"==typeof j?(h={_id:l,_rev:j},"function"==typeof i&&(k=i,i={})):(h=l,"function"==typeof j?(k=j,i={}):(k=i,i=j)),i=i||{},i.was_delete=!0;var g={_id:h._id,_rev:h._rev||i.rev};return g._deleted=!0,kg(g._id)&&"function"==typeof this._removeLocal?this._removeLocal(h,k):void this.bulkDocs({docs:[g]},i,af(k))}),f3.prototype.revsDiff=d5("revsDiff",function(l,n,i){function g(o,p){j.has(o)||j.set(o,{missing:[]}),j.get(o).missing.push(p)}function h(q,p){var o=l[q].slice(0);j8(p,function(r,x,w,s,y){var v=x+"-"+w,u=o.indexOf(v);-1!==u&&(o.splice(u,1),"available"!==y.status&&g(q,v))}),o.forEach(function(r){g(q,r)})}"function"==typeof n&&(i=n,n={});var m=Object.keys(l);if(!m.length){return i(null,{})}var k=0,j=new ck.Map;m.map(function(o){this._getRevisionTree(o,function(q,p){if(q&&404===q.status&&"missing"===q.message){j.set(o,{missing:l[o]})}else{if(q){return i(q)}h(o,p)}if(++k===m.length){var r={};return j.forEach(function(u,s){r[s]=u}),i(null,r)}})},this)}),f3.prototype.bulkGet=d5("bulkGet",function(h,g){eD(this,h,g)}),f3.prototype.compactDocument=d5("compactDocument",function(g,i,h){var j=this;this._getRevisionTree(g,function(l,o){if(l){return h(l)}var m=eg(o),k=[],n=[];Object.keys(m).forEach(function(p){m[p]>i&&k.push(p)}),j8(o,function(q,v,s,p,r){var u=v+"-"+s;"available"===r.status&&-1!==k.indexOf(u)&&n.push(u)}),j._doCompaction(g,n,h)})}),f3.prototype.compact=d5("compact",function(g,i){"function"==typeof g&&(i=g,g={});var h=this;g=g||{},h._compactionQueue=h._compactionQueue||[],h._compactionQueue.push({opts:g,callback:i}),1===h._compactionQueue.length&&eL(h)}),f3.prototype._compact=function(i,l){function g(n){h.push(j.compactDocument(n.id,0))}function m(o){var n=o.last_seq;e.all(h).then(function(){return fI(j,"_local/compaction",function(p){return !p.last_seq||p.last_seq<n?(p.last_seq=n,p):!1})}).then(function(){l(null,{ok:!0})})["catch"](l)}var j=this,k={return_docs:!1,last_seq:i.last_seq||0},h=[];j.changes(k).on("change",g).on("complete",m).on("error",l)},f3.prototype.get=d5("get",function(l,n,i){function g(){var o=[],p=h.length;return p?void h.forEach(function(q){m.get(l,{rev:q,revs:n.revs,attachments:n.attachments},function(s,r){s?o.push({missing:q}):o.push({ok:r}),p--,p||i(null,o)})}):i(null,o)}if("function"==typeof n&&(i=n,n={}),"string"!=typeof l){return i(kb(jL))}if(kg(l)&&"function"==typeof this._getLocal){return this._getLocal(l,i)}var h=[],m=this;if(!n.open_revs){return this._get(l,n,function(p,u){if(p){return i(p)}var s=u.doc,C=u.metadata,v=u.ctx;if(n.conflicts){var y=eW(C);y.length&&(s._conflicts=y)}if(f5(C,s._rev)&&(s._deleted=!0),n.revs||n.revs_info){var r=aa(C.rev_tree),o=kj(r,function(D){return -1!==D.ids.map(function(E){return E.id}).indexOf(s._rev.split("-")[1])}),z=o.ids.map(function(D){return D.id}).indexOf(s._rev.split("-")[1])+1,q=o.ids.length-z;if(o.ids.splice(z,q),o.ids.reverse(),n.revs&&(s._revisions={start:o.pos+o.ids.length-1,ids:o.ids.map(function(D){return D.id})}),n.revs_info){var A=o.pos+o.ids.length;s._revs_info=o.ids.map(function(D){return A--,{rev:A+"-"+D.id,status:D.opts.status}})}}if(n.attachments&&s._attachments){var B=s._attachments,x=Object.keys(B).length;if(0===x){return i(null,s)}Object.keys(B).forEach(function(D){this._getAttachment(B[D],{binary:n.binary,ctx:v},function(F,G){var E=s._attachments[D];E.data=G,delete E.stub,delete E.length,--x||i(null,s)})},m)}else{if(s._attachments){for(var w in s._attachments){s._attachments.hasOwnProperty(w)&&(s._attachments[w].stub=!0)}}i(null,s)}})}if("all"===n.open_revs){this._getRevisionTree(l,function(o,p){return o?i(o):(h=e0(p).map(function(q){return q.rev}),void g())})}else{if(!Array.isArray(n.open_revs)){return i(kb(bS,"function_clause"))}h=n.open_revs;for(var k=0;k<h.length;k++){var j=h[k];if("string"!=typeof j||!/^\d+-/.test(j)){return i(kb(ab))}}g()}}),f3.prototype.getView=d5("getView",function(g,i,h){ad(this,g,"views",i,h)}),f3.prototype.getFilter=d5("getFilter",function(g,i,h){ad(this,g,"filters",i,h)}),f3.prototype.getAttachment=d5("getAttachment",function(k,i,h,j){var g=this;h instanceof Function&&(j=h,h={}),this._get(k,h,function(m,l){return m?j(m):l.doc._attachments&&l.doc._attachments[i]?(h.ctx=l.ctx,h.binary=!0,g._getAttachment(l.doc._attachments[i],h,j),void 0):j(kb(aO))})}),f3.prototype.allDocs=d5("allDocs",function(g,i){if("function"==typeof g&&(i=g,g={}),g.skip="undefined"!=typeof g.skip?g.skip:0,g.start_key&&(g.startkey=g.start_key),g.end_key&&(g.endkey=g.end_key),"keys" in g){if(!Array.isArray(g.keys)){return i(new TypeError("options.keys must be an array"))}var h=["startkey","endkey","key"].filter(function(j){return j in g})[0];if(h){return void i(kb(dq,"Query parameter `"+h+"` is not compatible with multi-get"))}if("http"!==this.type()){return d3(this,g,i)}}return this._allDocs(g,i)}),f3.prototype.changes=function(h,g){return"function"==typeof h&&(g=h,h={}),new f1(this,h,g)},f3.prototype.close=d5("close",function(g){return this._closed=!0,this._close(g)}),f3.prototype.info=d5("info",function(h){var g=this;this._info(function(j,i){return j?h(j):(i.db_name=i.db_name||g._db_name,i.auto_compaction=!(!g.auto_compaction||"http"===g.type()),i.adapter=g.type(),void h(null,i))})}),f3.prototype.id=d5("id",function(g){return this._id(g)}),f3.prototype.type=function(){return"function"==typeof this._type?this._type():this.adapter},f3.prototype.bulkDocs=d5("bulkDocs",function(k,i,h){if("function"==typeof i&&(h=i,i={}),i=i||{},Array.isArray(k)&&(k={docs:k}),!k||!k.docs||!Array.isArray(k.docs)){return h(kb(eS))}for(var j=0;j<k.docs.length;++j){if("object"!=typeof k.docs[j]||Array.isArray(k.docs[j])){return h(kb(cC))}}var g;return k.docs.forEach(function(l){l._attachments&&Object.keys(l._attachments).forEach(function(m){g=g||jF(m)})}),g?h(kb(aQ,g)):("new_edits" in i||("new_edits" in k?i.new_edits=k.new_edits:i.new_edits=!0),i.new_edits||"http"===this.type()||k.docs.sort(ag),e1(k.docs),this._bulkDocs(k,i,function(m,l){return m?h(m):(i.new_edits||(l=l.filter(function(n){return n.error})),void h(null,l))}))}),f3.prototype.registerDependentDatabase=d5("registerDependentDatabase",function(g,i){function h(k){return k.dependentDbs=k.dependentDbs||{},k.dependentDbs[g]?!1:(k.dependentDbs[g]=!0,k)}var j=new this.constructor(g,this.__opts);fI(this,"_local/_pouch_dependentDbs",h).then(function(){i(null,{db:j})})["catch"](i)}),f3.prototype.destroy=d5("destroy",function(k,i){function h(){j._destroy(k,function(l,m){return l?i(l):(j._destroyed=!0,j.emit("destroyed"),void i(null,m||{ok:!0}))})}"function"==typeof k&&(i=k,k={});var j=this,g="use_prefix" in j?j.use_prefix:!0;return"http"===j.type()?h():void j.get("_local/_pouch_dependentDbs",function(m,p){if(m){return 404!==m.status?i(m):h()}var n=p.dependentDbs,l=j.constructor,o=Object.keys(n).map(function(r){var q=g?r.replace(new RegExp("^"+l.prefix),""):r;return new l(q,j.__opts).destroy()});e.all(o).then(h,i)})}),dA.prototype.execute=function(){var g;if(this.failed){for(;g=this.queue.shift();){g(this.failed)}}else{for(;g=this.queue.shift();){g()}}},dA.prototype.fail=function(g){this.failed=g,this.execute()},dA.prototype.ready=function(g){this.isReady=!0,this.db=g,this.execute()},dA.prototype.addTask=function(g){this.queue.push(g),this.failed&&this.execute()},du(bH,f3),bH.debug=aR;var dN;if(eK()){dN=!1}else{try{localStorage.setItem("_pouch_check_localstorage",1),dN=!!localStorage.getItem("_pouch_check_localstorage")}catch(jG){dN=!1}}bH.adapters={},bH.preferredAdapters=[],bH.prefix="_pouch_";var fO=new aq.EventEmitter;kc(bH),bH.parseAdapter=function(l,n){var i,g,h=l.match(/([a-z\-]*):\/\/(.*)/);if(h){if(l=/http(s?)/.test(h[1])?h[1]+"://"+h[2]:h[2],i=h[1],!bH.adapters[i].valid()){throw"Invalid adapter"}return{name:l,adapter:h[1]}}var m="idb" in bH.adapters&&"websql" in bH.adapters&&jY()&&localStorage["_pouch__websqldb_"+bH.prefix+l];if(n.adapter){g=n.adapter}else{if("undefined"!=typeof n&&n.db){g="leveldb"}else{for(var k=0;k<bH.preferredAdapters.length;++k){if(g=bH.preferredAdapters[k],g in bH.adapters){if(m&&"idb"===g){console.log('PouchDB is downgrading "'+l+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.');continue}break}}}}i=bH.adapters[g];var j=i&&"use_prefix" in i?i.use_prefix:!0;return{name:j?bH.prefix+l:l,adapter:g}},bH.adapter=function(g,i,h){i.valid()&&(bH.adapters[g]=i,h&&bH.preferredAdapters.push(g))},bH.plugin=function(g){return Object.keys(g).forEach(function(h){bH.prototype[h]=g[h]}),bH},bH.defaults=function(h){function g(k,i,j){return this instanceof g?("function"!=typeof i&&"undefined"!=typeof i||(j=i,i={}),k&&"object"==typeof k&&(i=k,k=void 0),i=e3.extend({},h,i),void bH.call(this,k,i,j)):new g(k,i,j)}return du(g,bH),kc(g),g.preferredAdapters=bH.preferredAdapters.slice(),Object.keys(bH).forEach(function(i){i in g||(g[i]=bH[i])}),g};var dZ=bR(),dy=function(){},aA=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],dk="queryKey",aI=/(?:^|&)([^&=]*)=?([^&]*)/g,e6=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,cD=function(g){return atob(g)},fH=function(g){return btoa(g)},bC=bB.extend,cW={ajax:jS,parseUri:aC,uuid:kh,Promise:e,atob:cD,btoa:fH,binaryStringToBlobOrBuffer:bK,clone:e5,extend:bC,createError:kb},dT=cV.collate,eP=1,c2="pouchdb",cy=5,au=0;aE.prototype.writeCheckpoint=function(g,i){var h=this;return this.updateTarget(g,i).then(function(){return h.updateSource(g,i)})},aE.prototype.updateTarget=function(h,g){return bG(this.target,this.id,h,g,this.returnValue)},aE.prototype.updateSource=function(g,i){var h=this;return this.readOnlySource?e.resolve(!0):bG(this.src,this.id,g,i,this.returnValue)["catch"](function(j){if(c3(j)){return h.readOnlySource=!0,!0}throw j})};var eM={undefined:function(h,g){return 0===dT(h.last_seq,g.last_seq)?g.last_seq:0},1:function(h,g){return dO(g,h).last_seq}};aE.prototype.getCheckpoint=function(){var g=this;return g.target.get(g.id).then(function(h){return g.readOnlySource?e.resolve(h.last_seq):g.src.get(g.id).then(function(i){if(h.version!==i.version){return au}var j;return j=h.version?h.version.toString():"undefined",j in eM?eM[j](h,i):au},function(i){if(404===i.status&&h.last_seq){return g.src.put({_id:g.id,last_seq:au}).then(function(){return au},function(j){return c3(j)?(g.readOnlySource=!0,h.last_seq):au})}throw i})})["catch"](function(h){if(404!==h.status){throw h}return au})};var bW=0,d6=dl.setImmediate||dl.setTimeout,ap=32768,ef=fC(function(g,i){function m(){var q=j*o,u=q+o;if(j++,h>j){n(p,g,q,u),d6(m)}else{n(p,g,q,u);var r=p.end(!0),s=fM(r);i(null,s),p.destroy()}}var k="string"==typeof g,l=k?g.length:g.byteLength,o=Math.min(ap,l),h=Math.ceil(l/o),j=0,p=k?new al:new al.ArrayBuffer,n=k?aJ:t;m()});du(eQ,aq.EventEmitter),eQ.prototype.cancel=function(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")},eQ.prototype.ready=function(k,i){function h(){g.cancel()}function j(){k.removeListener("destroyed",h),i.removeListener("destroyed",h)}var g=this;g._readyCalled||(g._readyCalled=!0,k.once("destroyed",h),i.once("destroyed",h),g.once("complete",j))};var dc={replicate:f7,toPouch:fN},cc=dc.replicate;du(bY,aq.EventEmitter),bY.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())};var eG=25,cE=50,aP={},c6=1800,bu=aR("pouchdb:http");am.valid=function(){return !0},eZ.prototype.add=function(g){return this.promise=this.promise["catch"](function(){}).then(function(){return g()}),this.promise},eZ.prototype.finish=function(){return this.promise};var d4,fD=function(h,g){return g&&h.then(function(i){eB.nextTick(function(){g(null,i)})},function(i){eB.nextTick(function(){g(i)})}),h},jT=function(g){return aG(function(h){var j=h.pop(),i=g.apply(this,h);return"function"==typeof j&&fD(i,j),i})},cJ=function(h,g){return h.then(function(i){return g().then(function(){return i})},function(i){return g().then(function(){throw i})})},da=function(h,g){return function(){var j=arguments,i=this;return h.add(function(){return g.apply(i,j)})}},eF=function(l){for(var j={},i=0,k=l.length;k>i;i++){j["$"+l[i]]=!0}var h=Object.keys(j),g=new Array(h.length);for(i=0,k=h.length;k>i;i++){g[i]=h[i].substring(1)}return g},ba={uniq:eF,sequentialize:da,fin:cJ,callbackify:jT,promisedCallback:fD},aY=cV.collate,cG=cV.toIndexableString,bZ=cV.normalizeKey,cp=cV.parseIndexableString;d4="undefined"!=typeof console&&"function"==typeof console.log?Function.prototype.bind.call(console.log,console):function(){};var dW=ba.callbackify,jH=ba.sequentialize,dV=ba.uniq,kf=ba.fin,cj=ba.promisedCallback,dv={},dD=new eZ,cI=50,j2={_sum:function(h,g){return cZ(g)},_count:function(h,g){return g.length},_stats:function(g,i){function h(n){for(var l=0,k=0,m=n.length;m>k;k++){var j=n[k];l+=j*j}return l}return{sum:cZ(i),min:Math.min.apply(null,i),max:Math.max.apply(null,i),count:i.length,sumsqr:h(i)}}},dd=dW(function(){var g=this;return g._ddocCache&&delete g._ddocCache,"http"===g.type()?j0(g):"function"==typeof g._viewCleanup?bh(g):d2(g)}),aL=function(k,i,h){"function"==typeof i&&(h=i,i={}),i=i?e9(i):{},"function"==typeof k&&(k={map:k});var j=this,g=e.resolve().then(function(){return aT(j,k,i)});return cj(g,h),g};du(df,Error),du(cf,Error);var bA={query:aL,viewCleanup:dd},cA=5,j9="document-store",bz="by-sequence",c5="attach-store",bF="attach-seq-store",cz="meta-store",dx="local-store",cF="detect-blob-support",cU={running:!1,queue:[]};du(bm,aq.EventEmitter),bm.prototype.addListener=function(m,h,j,l){function i(){function o(){k=!1}if(g._listeners[h]){if(k){return void (k="waiting")}k=!0;var n=dh(l,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary"]);j.changes(n).on("change",function(p){p.seq>l.since&&!l.cancelled&&(l.since=p.seq,l.onChange(p))}).on("complete",function(){"waiting"===k&&setTimeout(function(){i()},0),k=!1}).on("error",o)}}if(!this._listeners[h]){var g=this,k=!1;this._listeners[h]=i,this.on(m,i)}},bm.prototype.removeListener=function(h,g){g in this._listeners&&aq.EventEmitter.prototype.removeListener.call(this,h,this._listeners[g])},bm.prototype.notifyLocalWindows=function(g){eK()?chrome.storage.local.set({dbName:g}):jY()&&(localStorage[g]="a"===localStorage[g]?"b":"a")},bm.prototype.notify=function(g){this.emit(g),this.notifyLocalWindows(g)};var e2,fF=new ck.Map,cb=new bm,b1=new ck.Map;bI.valid=function(){var g="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform);return !g&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange};var bT=7,e8=dB("document-store"),cu=dB("by-sequence"),bV=dB("attach-store"),c9=dB("local-store"),dU=dB("metadata-store"),j6=dB("attach-seq-store"),bv=new ck.Map,ax=new bm,d9=1,cL="CREATE INDEX IF NOT EXISTS 'by-seq-deleted-idx' ON "+cu+" (seq, deleted)",dC="CREATE UNIQUE INDEX IF NOT EXISTS 'by-seq-doc-id-rev' ON "+cu+" (doc_id, rev)",cs="CREATE INDEX IF NOT EXISTS 'doc-winningseq-idx' ON "+e8+" (winningseq)",e7="CREATE INDEX IF NOT EXISTS 'attach-seq-seq-idx' ON "+j6+" (seq)",cR="CREATE UNIQUE INDEX IF NOT EXISTS 'attach-seq-digest-idx' ON "+j6+" (digest, seq)",bb=cu+".seq = "+e8+".winningseq",fQ=cu+".seq AS seq, "+cu+".deleted AS deleted, "+cu+".json AS data, "+cu+".rev AS rev, "+e8+".json AS metadata";dH.use_prefix=!("undefined"!=typeof eB&&!eB.browser),dH.valid=dm;var aD={idb:bI,websql:dH};bH.ajax=jS,bH.utils=cW,bH.Errors=dY,bH.replicate=dc.replicate,bH.sync=bp,bH.version="5.3.2",bH.adapter("http",am),bH.adapter("https",am),bH.plugin(bA),Object.keys(aD).forEach(function(g){bH.adapter(g,aD[g],!0)}),d.exports=bH}).call(this,f(13),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{1:1,10:10,12:12,13:13,14:14,15:15,16:16,2:2,4:4,6:6,7:7,8:8}]},{},[17])(17)});