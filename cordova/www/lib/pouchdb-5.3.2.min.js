!function(b){if("object"==typeof exports&&"undefined"!=typeof module){module.exports=b()}else{if("function"==typeof define&&define.amd){define([],b)}else{var a;a="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,a.PouchDB=b()}}}(function(){var b;return function a(c,f,h){function j(e,k){if(!f[e]){if(!c[e]){var i="function"==typeof require&&require;if(!k&&i){return i(e,!0)}if(g){return g(e,!0)}var m=new Error("Cannot find module '"+e+"'");throw m.code="MODULE_NOT_FOUND",m}var l=f[e]={exports:{}};c[e][0].call(l.exports,function(n){var o=c[e][1][n];return j(o?o:n)},l,l.exports,a,c,f,h)}return f[e].exports}for(var g="function"==typeof require&&require,d=0;d<h.length;d++){j(h[d])}return j}({1:[function(f,c,g){function d(e){return function(){var h=arguments.length;if(h){for(var j=[],i=-1;++i<h;){j[i]=arguments[i]}return e.call(this,j)}return e.call(this,[])}}c.exports=d},{}],2:[function(h,l,f){function c(){return"WebkitAppearance" in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function d(){var n=arguments,e=this.useColors;if(n[0]=(e?"%c":"")+this.namespace+(e?" %c":" ")+n[0]+(e?"%c ":" ")+"+"+f.humanize(this.diff),!e){return n}var i="color: "+this.color;n=[n[0],i,"color: inherit"].concat(Array.prototype.slice.call(n,1));var o=0,p=0;return n[0].replace(/%[a-z%]/g,function(q){"%%"!==q&&(o++,"%c"===q&&(p=o))}),n.splice(p,0,i),n}function g(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function j(e){try{null==e?f.storage.removeItem("debug"):f.storage.debug=e}catch(i){}}function m(){var e;try{e=f.storage.debug}catch(i){}return e}function k(){try{return window.localStorage}catch(e){}}f=l.exports=h(3),f.log=g,f.formatArgs=d,f.save=j,f.load=m,f.useColors=c,f.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:k(),f.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],f.formatters.j=function(e){return JSON.stringify(e)},f.enable(m())},{3:3}],3:[function(p,d,k){function h(){return k.colors[m++%k.colors.length]}function j(f){function n(){}function e(){var s=e,u=+new Date,t=u-(q||u);s.diff=t,s.prev=q,s.curr=u,q=u,null==s.useColors&&(s.useColors=k.useColors()),null==s.color&&s.useColors&&(s.color=h());var o=Array.prototype.slice.call(arguments);o[0]=k.coerce(o[0]),"string"!=typeof o[0]&&(o=["%o"].concat(o));var x=0;o[0]=o[0].replace(/%([a-z%])/g,function(D,B){if("%%"===D){return D}x++;var w=k.formatters[B];if("function"==typeof w){var C=o[x];D=w.call(s,C),o.splice(x,1),x--}return D}),"function"==typeof k.formatArgs&&(o=k.formatArgs.apply(s,o));var r=e.log||k.log||console.log.bind(console);r.apply(s,o)}n.enabled=!1,e.enabled=!0;var i=k.enabled(f)?e:n;return i.namespace=f,i}function l(e){k.save(e);for(var f=(e||"").split(/[\s,]+/),n=f.length,i=0;n>i;i++){f[i]&&(e=f[i].replace(/\*/g,".*?"),"-"===e[0]?k.skips.push(new RegExp("^"+e.substr(1)+"$")):k.names.push(new RegExp("^"+e+"$")))}}function v(){k.enable("")}function g(i){var e,f;for(e=0,f=k.skips.length;f>e;e++){if(k.skips[e].test(i)){return !1}}for(e=0,f=k.names.length;f>e;e++){if(k.names[e].test(i)){return !0}}return !1}function c(e){return e instanceof Error?e.stack||e.message:e}k=d.exports=j,k.coerce=c,k.disable=v,k.enable=l,k.enabled=g,k.humanize=p(9),k.names=[],k.skips=[],k.formatters={};var q,m=0},{9:9}],4:[function(j,f,l){function d(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function k(e){return"function"==typeof e}function g(e){return"number"==typeof e}function h(e){return"object"==typeof e&&null!==e}function c(e){return void 0===e}f.exports=d,d.EventEmitter=d,d.prototype._events=void 0,d.prototype._maxListeners=void 0,d.defaultMaxListeners=10,d.prototype.setMaxListeners=function(e){if(!g(e)||0>e||isNaN(e)){throw TypeError("n must be a positive number")}return this._maxListeners=e,this},d.prototype.emit=function(p){var i,o,e,n,m,q;if(this._events||(this._events={}),"error"===p&&(!this._events.error||h(this._events.error)&&!this._events.error.length)){if(i=arguments[1],i instanceof Error){throw i}throw TypeError('Uncaught, unspecified "error" event.')}if(o=this._events[p],c(o)){return !1}if(k(o)){switch(arguments.length){case 1:o.call(this);break;case 2:o.call(this,arguments[1]);break;case 3:o.call(this,arguments[1],arguments[2]);break;default:n=Array.prototype.slice.call(arguments,1),o.apply(this,n)}}else{if(h(o)){for(n=Array.prototype.slice.call(arguments,1),q=o.slice(),e=q.length,m=0;e>m;m++){q[m].apply(this,n)}}}return !0},d.prototype.addListener=function(m,i){var e;if(!k(i)){throw TypeError("listener must be a function")}return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",m,k(i.listener)?i.listener:i),this._events[m]?h(this._events[m])?this._events[m].push(i):this._events[m]=[this._events[m],i]:this._events[m]=i,h(this._events[m])&&!this._events[m].warned&&(e=c(this._maxListeners)?d.defaultMaxListeners:this._maxListeners,e&&e>0&&this._events[m].length>e&&(this._events[m].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[m].length),"function"==typeof console.trace&&console.trace())),this},d.prototype.on=d.prototype.addListener,d.prototype.once=function(i,n){function m(){this.removeListener(i,m),e||(e=!0,n.apply(this,arguments))}if(!k(n)){throw TypeError("listener must be a function")}var e=!1;return m.listener=n,this.on(i,m),this},d.prototype.removeListener=function(p,m){var i,e,n,o;if(!k(m)){throw TypeError("listener must be a function")}if(!this._events||!this._events[p]){return this}if(i=this._events[p],n=i.length,e=-1,i===m||k(i.listener)&&i.listener===m){delete this._events[p],this._events.removeListener&&this.emit("removeListener",p,m)}else{if(h(i)){for(o=n;o-->0;){if(i[o]===m||i[o].listener&&i[o].listener===m){e=o;break}}if(0>e){return this}1===i.length?(i.length=0,delete this._events[p]):i.splice(e,1),this._events.removeListener&&this.emit("removeListener",p,m)}}return this},d.prototype.removeAllListeners=function(m){var i,e;if(!this._events){return this}if(!this._events.removeListener){return 0===arguments.length?this._events={}:this._events[m]&&delete this._events[m],this}if(0===arguments.length){for(i in this._events){"removeListener"!==i&&this.removeAllListeners(i)}return this.removeAllListeners("removeListener"),this._events={},this}if(e=this._events[m],k(e)){this.removeListener(m,e)}else{if(e){for(;e.length;){this.removeListener(m,e[e.length-1])}}}return delete this._events[m],this},d.prototype.listeners=function(i){var e;return e=this._events&&this._events[i]?k(this._events[i])?[this._events[i]]:this._events[i].slice():[]},d.prototype.listenerCount=function(i){if(this._events){var e=this._events[i];if(k(e)){return 1}if(e){return e.length}}return 0},d.listenerCount=function(i,e){return i.listenerCount(e)}},{}],5:[function(c,f,d){(function(w){function p(){v=!0;for(var n,l,i=q.length;i;){for(l=q,q=[],n=-1;++n<i;){l[n]()}i=q.length}v=!1}function j(i){1!==q.push(i)||v||k()}var k,t=w.MutationObserver||w.WebKitMutationObserver;if(t){var e=0,h=new t(p),g=w.document.createTextNode("");h.observe(g,{characterData:!0}),k=function(){g.data=e=++e%2}}else{if(w.setImmediate||"undefined"==typeof w.MessageChannel){k="document" in w&&"onreadystatechange" in w.document.createElement("script")?function(){var i=w.document.createElement("script");i.onreadystatechange=function(){p(),i.onreadystatechange=null,i.parentNode.removeChild(i),i=null},w.document.documentElement.appendChild(i)}:function(){setTimeout(p,0)}}else{var m=new w.MessageChannel;m.port1.onmessage=p,k=function(){m.port2.postMessage(0)}}}var v,q=[];f.exports=j}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],6:[function(c,f,d){"function"==typeof Object.create?f.exports=function(g,e){g.super_=e,g.prototype=Object.create(e.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}})}:f.exports=function(g,e){g.super_=e;var h=function(){};h.prototype=e.prototype,g.prototype=new h,g.prototype.constructor=g}},{}],7:[function(c,f,d){(function(e){e("object"==typeof d?d:this)}).call(this,function(h){var e=Array.prototype.slice,i=Array.prototype.forEach,g=function(j){if("object"!=typeof j){throw j+" is not an object"}var k=e.call(arguments,1);return i.call(k,function(m){if(m){for(var l in m){"object"==typeof m[l]&&j[l]?g.call(j,j[l],m[l]):j[l]=m[l]}}}),j};h.extend=g})},{}],8:[function(A,k,w){function B(){}function j(e){if("function"!=typeof e){throw new TypeError("resolver must be a function")}this.state=z,this.queue=[],this.outcome=void 0,e!==B&&g(this,e)}function H(f,e,h){this.promise=f,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof h&&(this.onRejected=h,this.callRejected=this.otherCallRejected)}function C(f,e,h){E(function(){var i;try{i=e(h)}catch(l){return d.reject(f,l)}i===f?d.reject(f,new TypeError("Cannot resolve promise with itself")):d.resolve(f,i)})}function I(f){var e=f&&f.then;return f&&"object"==typeof f&&"function"==typeof e?function(){e.apply(f,arguments)}:void 0}function g(h,l){function f(o){e||(e=!0,d.reject(h,o))}function m(o){e||(e=!0,d.resolve(h,o))}function i(){l(m,f)}var e=!1,n=D(i);"error"===n.status&&f(n.value)}function D(e,h){var f={};try{f.value=e(h),f.status="success"}catch(i){f.status="error",f.value=i}return f}function x(e){return e instanceof this?e:d.resolve(new this(B),e)}function G(f){var e=new this(B);return d.reject(e,f)}function J(e){function f(r,s){function t(u){l[s]=u,++h!==n||p||(p=!0,d.resolve(i,l))}o.resolve(r).then(t,function(u){p||(p=!0,d.reject(i,u))})}var o=this;if("[object Array]"!==Object.prototype.toString.call(e)){return this.reject(new TypeError("must be an array"))}var n=e.length,p=!1;if(!n){return this.resolve([])}for(var l=new Array(n),h=0,m=-1,i=new this(B);++m<n;){f(e[m],m)}return i}function q(h){function l(o){f.resolve(o).then(function(p){e||(e=!0,d.resolve(m,p))},function(p){e||(e=!0,d.reject(m,p))})}var f=this;if("[object Array]"!==Object.prototype.toString.call(h)){return this.reject(new TypeError("must be an array"))}var i=h.length,e=!1;if(!i){return this.resolve([])}for(var n=-1,m=new this(B);++n<i;){l(h[n])}return m}var E=A(5),d={},c=["REJECTED"],F=["FULFILLED"],z=["PENDING"];k.exports=w=j,j.prototype["catch"]=function(e){return this.then(null,e)},j.prototype.then=function(i,h){if("function"!=typeof i&&this.state===F||"function"!=typeof h&&this.state===c){return this}var f=new this.constructor(B);if(this.state!==z){var e=this.state===F?i:h;C(f,e,this.outcome)}else{this.queue.push(new H(f,i,h))}return f},H.prototype.callFulfilled=function(e){d.resolve(this.promise,e)},H.prototype.otherCallFulfilled=function(e){C(this.promise,this.onFulfilled,e)},H.prototype.callRejected=function(e){d.reject(this.promise,e)},H.prototype.otherCallRejected=function(e){C(this.promise,this.onRejected,e)},d.resolve=function(m,f){var i=D(I,f);if("error"===i.status){return d.reject(m,i.value)}var l=i.value;if(l){g(m,l)}else{m.state=F,m.outcome=f;for(var h=-1,e=m.queue.length;++h<e;){m.queue[h].callFulfilled(f)}}return m},d.reject=function(e,h){e.state=c,e.outcome=h;for(var f=-1,i=e.queue.length;++f<i;){e.queue[f].callRejected(h)}return e},w.resolve=x,w.reject=G,w.all=J,w.race=q},{5:5}],9:[function(p,x,h){function d(i){if(i=""+i,!(i.length>10000)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(i);if(e){var l=parseFloat(e[1]),f=(e[2]||"ms").toLowerCase();switch(f){case"years":case"year":case"yrs":case"yr":case"y":return l*j;case"days":case"day":case"d":return l*m;case"hours":case"hour":case"hrs":case"hr":case"h":return l*q;case"minutes":case"minute":case"mins":case"min":case"m":return l*w;case"seconds":case"second":case"secs":case"sec":case"s":return l*c;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return l}}}}function g(e){return e>=m?Math.round(e/m)+"d":e>=q?Math.round(e/q)+"h":e>=w?Math.round(e/w)+"m":e>=c?Math.round(e/c)+"s":e+"ms"}function k(e){return v(e,m,"day")||v(e,q,"hour")||v(e,w,"minute")||v(e,c,"second")||e+" ms"}function v(f,e,i){return e>f?void 0:1.5*e>f?Math.floor(f/e)+" "+i:Math.ceil(f/e)+" "+i+"s"}var c=1000,w=60*c,q=60*w,m=24*q,j=365.25*m;x.exports=function(f,e){return e=e||{},"string"==typeof f?d(f):e["long"]?k(f):g(f)}},{}],10:[function(m,j,C){function y(i){if(null!==i){switch(typeof i){case"boolean":return i?1:0;case"number":return z(i);case"string":return i.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var f=Array.isArray(i),o=f?i:Object.keys(i),l=-1,n=o.length,e="";if(f){for(;++l<n;){e+=C.toIndexableString(o[l])}}else{for(;++l<n;){var h=o[l];e+=C.toIndexableString(h)+C.toIndexableString(i[h])}}return e}}return""}function d(r,h){var o,l=h,n="1"===r[h];if(n){o=0,h++}else{var p="0"===r[h];h++;var e="",i=r.substring(h,h+g),f=parseInt(i,10)+B;for(p&&(f=-f),h+=g;;){var s=r[h];if("\x00"===s){break}e+=s,h++}e=e.split("."),o=1===e.length?parseInt(e,10):parseFloat(e[0]+"."+e[1]),p&&(o-=10),0!==f&&(o=parseFloat(o+"e"+f))}return{num:o,length:h-l}}function v(o,l){var f=o.pop();if(l.length){var e=l[l.length-1];f===e.element&&(l.pop(),e=l[l.length-1]);var n=e.element,i=e.index;if(Array.isArray(n)){n.push(f)}else{if(i===o.length-2){var h=o.pop();n[h]=f}else{o.push(f)}}}}function q(i,f){for(var h=Math.min(i.length,f.length),l=0;h>l;l++){var e=C.collate(i[l],f[l]);if(0!==e){return e}}return i.length===f.length?0:i.length>f.length?1:-1}function x(f,e){return f===e?0:f>e?1:-1}function A(i,f){for(var o=Object.keys(i),l=Object.keys(f),n=Math.min(o.length,l.length),e=0;n>e;e++){var h=C.collate(o[e],l[e]);if(0!==h){return h}if(h=C.collate(i[o[e]],f[l[e]]),0!==h){return h}}return o.length===l.length?0:o.length>l.length?1:-1}function c(f){var e=["boolean","number","string","object"],h=e.indexOf(typeof f);return ~h?null===f?1:Array.isArray(f)?5:3>h?h+2:h+3:Array.isArray(f)?5:void 0}function z(i){if(0===i){return"1"}var o=i.toExponential().split(/e\+?/),f=parseInt(o[1],10),r=0>i,e=r?"0":"2",h=(r?-f:f)-B,l=k.padLeft(h.toString(),"0",g);e+=w+l;var p=Math.abs(parseFloat(o[0]));r&&(p=10-p);var n=p.toFixed(20);return n=n.replace(/\.?0+$/,""),e+=w+n}var B=-324,g=3,w="",k=m(11);C.collate=function(h,e){if(h===e){return 0}h=C.normalizeKey(h),e=C.normalizeKey(e);var f=c(h),i=c(e);if(f-i!==0){return f-i}if(null===h){return 0}switch(typeof h){case"number":return h-e;case"boolean":return h===e?0:e>h?-1:1;case"string":return x(h,e)}return Array.isArray(h)?q(h,e):A(h,e)},C.normalizeKey=function(l){switch(typeof l){case"undefined":return null;case"number":return l===1/0||l===-(1/0)||isNaN(l)?null:l;case"object":var h=l;if(Array.isArray(l)){var i=l.length;l=new Array(i);for(var f=0;i>f;f++){l[f]=C.normalizeKey(h[f])}}else{if(l instanceof Date){return l.toJSON()}if(null!==l){l={};for(var e in h){if(h.hasOwnProperty(e)){var n=h[e];"undefined"!=typeof n&&(l[e]=C.normalizeKey(n))}}}}}return l},C.toIndexableString=function(f){var e="\x00";return f=C.normalizeKey(f),c(f)+w+y(f)+e},C.parseIndexableString=function(r){for(var h=[],n=[],l=0;;){var e=r[l++];if("\x00"!==e){switch(e){case"1":h.push(null);break;case"2":h.push("1"===r[l]),l++;break;case"3":var i=d(r,l);h.push(i.num),l+=i.length;break;case"4":for(var f="";;){var s=r[l];if("\x00"===s){break}f+=s,l++}f=f.replace(/\u0001\u0001/g,"\x00").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),h.push(f);break;case"5":var p={element:[],index:h.length};h.push(p.element),n.push(p);break;case"6":var o={element:{},index:h.length};h.push(o.element),n.push(o);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+e)}}else{if(1===h.length){return h.pop()}v(h,n)}}}},{11:11}],11:[function(f,c,g){function d(h,k,j){for(var e="",i=j-h.length;e.length<i;){e+=k}return e}g.padLeft=function(h,e,j){var i=d(h,e,j);return i+h},g.padRight=function(h,e,j){var i=d(h,e,j);return h+i},g.stringLexCompare=function(j,p){var l,h=j.length,m=p.length;for(l=0;h>l;l++){if(l===m){return 1}var e=j.charAt(l),k=p.charAt(l);if(e!==k){return k>e?-1:1}}return m>h?-1:0},g.intToDecimalForm=function(i){var e=0>i,j="";do{var h=e?-Math.ceil(i%10):Math.floor(i%10);j=h+j,i=e?Math.ceil(i/10):Math.floor(i/10)}while(i);return e&&"0"!==j&&(j="-"+j),j}},{}],12:[function(f,c,h){function d(){this.store={}}function g(i){if(this.store=new d,i&&Array.isArray(i)){for(var e=0,j=i.length;j>e;e++){this.add(i[e])}}}h.Map=d,h.Set=g,d.prototype.mangle=function(e){if("string"!=typeof e){throw new TypeError("key must be a string but Got "+e)}return"$"+e},d.prototype.unmangle=function(e){return e.substring(1)},d.prototype.get=function(i){var e=this.mangle(i);return e in this.store?this.store[e]:void 0},d.prototype.set=function(i,e){var j=this.mangle(i);return this.store[j]=e,!0},d.prototype.has=function(i){var e=this.mangle(i);return e in this.store},d.prototype["delete"]=function(i){var e=this.mangle(i);return e in this.store?(delete this.store[e],!0):!1},d.prototype.forEach=function(e){for(var k=Object.keys(this.store),i=0,m=k.length;m>i;i++){var l=k[i],j=this.store[l];l=this.unmangle(l),e(j,l)}},g.prototype.add=function(e){return this.store.set(e,!0)},g.prototype.has=function(e){return this.store.has(e)},g.prototype["delete"]=function(e){return this.store["delete"](e)}},{}],13:[function(p,x,h){function d(){m=!1,c.length?q=c.concat(q):j=-1,q.length&&g()}function g(){if(!m){var f=setTimeout(d);m=!0;for(var e=q.length;e;){for(c=q,q=[];++j<e;){c&&c[j].run()}j=-1,e=q.length}c=null,m=!1,clearTimeout(f)}}function k(f,e){this.fun=f,this.array=e}function v(){}var c,w=x.exports={},q=[],m=!1,j=-1;w.nextTick=function(f){var e=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){e[i-1]=arguments[i]}}q.push(new k(f,e)),1!==q.length||m||setTimeout(g,0)},k.prototype.run=function(){this.fun.apply(null,this.array)},w.title="browser",w.browser=!0,w.env={},w.argv=[],w.version="",w.versions={},w.on=v,w.addListener=v,w.once=v,w.off=v,w.removeListener=v,w.removeAllListeners=v,w.emit=v,w.binding=function(e){throw new Error("process.binding is not supported")},w.cwd=function(){return"/"},w.chdir=function(e){throw new Error("process.chdir is not supported")},w.umask=function(){return 0}},{}],14:[function(c,f,d){(function(){var e={}.hasOwnProperty,g=[].slice;f.exports=function(k,j){var i,m,l,h;m=[],h=[];for(i in j){e.call(j,i)&&(l=j[i],"this"!==i&&(m.push(i),h.push(l)))}return Function.apply(null,g.call(m).concat([k])).apply(j["this"],h)}}).call(this)},{}],15:[function(e,d,c){!function(g){if("object"==typeof c){d.exports=g()}else{if("function"==typeof b&&b.amd){b(g)}else{var h;try{h=window}catch(f){h=self}h.SparkMD5=g()}}}(function(z){function A(i,h,n,m,l,g){return h=K(K(h,i),K(m,g)),K(h<<l|h>>>32-l,n)}function G(m,n,l,h,i,o,g){return A(n&l|~n&h,m,n,i,o,g)}function C(m,n,l,h,i,o,g){return A(n&h|l&~h,m,n,i,o,g)}function E(m,n,l,h,i,o,g){return A(n^l^h,m,n,i,o,g)}function x(m,n,l,h,i,o,g){return A(l^(n|~h),m,n,i,o,g)}function M(i,h){var n=i[0],m=i[1],g=i[2],l=i[3];n=G(n,m,g,l,h[0],7,-680876936),l=G(l,n,m,g,h[1],12,-389564586),g=G(g,l,n,m,h[2],17,606105819),m=G(m,g,l,n,h[3],22,-1044525330),n=G(n,m,g,l,h[4],7,-176418897),l=G(l,n,m,g,h[5],12,1200080426),g=G(g,l,n,m,h[6],17,-1473231341),m=G(m,g,l,n,h[7],22,-45705983),n=G(n,m,g,l,h[8],7,1770035416),l=G(l,n,m,g,h[9],12,-1958414417),g=G(g,l,n,m,h[10],17,-42063),m=G(m,g,l,n,h[11],22,-1990404162),n=G(n,m,g,l,h[12],7,1804603682),l=G(l,n,m,g,h[13],12,-40341101),g=G(g,l,n,m,h[14],17,-1502002290),m=G(m,g,l,n,h[15],22,1236535329),n=C(n,m,g,l,h[1],5,-165796510),l=C(l,n,m,g,h[6],9,-1069501632),g=C(g,l,n,m,h[11],14,643717713),m=C(m,g,l,n,h[0],20,-373897302),n=C(n,m,g,l,h[5],5,-701558691),l=C(l,n,m,g,h[10],9,38016083),g=C(g,l,n,m,h[15],14,-660478335),m=C(m,g,l,n,h[4],20,-405537848),n=C(n,m,g,l,h[9],5,568446438),l=C(l,n,m,g,h[14],9,-1019803690),g=C(g,l,n,m,h[3],14,-187363961),m=C(m,g,l,n,h[8],20,1163531501),n=C(n,m,g,l,h[13],5,-1444681467),l=C(l,n,m,g,h[2],9,-51403784),g=C(g,l,n,m,h[7],14,1735328473),m=C(m,g,l,n,h[12],20,-1926607734),n=E(n,m,g,l,h[5],4,-378558),l=E(l,n,m,g,h[8],11,-2022574463),g=E(g,l,n,m,h[11],16,1839030562),m=E(m,g,l,n,h[14],23,-35309556),n=E(n,m,g,l,h[1],4,-1530992060),l=E(l,n,m,g,h[4],11,1272893353),g=E(g,l,n,m,h[7],16,-155497632),m=E(m,g,l,n,h[10],23,-1094730640),n=E(n,m,g,l,h[13],4,681279174),l=E(l,n,m,g,h[0],11,-358537222),g=E(g,l,n,m,h[3],16,-722521979),m=E(m,g,l,n,h[6],23,76029189),n=E(n,m,g,l,h[9],4,-640364487),l=E(l,n,m,g,h[12],11,-421815835),g=E(g,l,n,m,h[15],16,530742520),m=E(m,g,l,n,h[2],23,-995338651),n=x(n,m,g,l,h[0],6,-198630844),l=x(l,n,m,g,h[7],10,1126891415),g=x(g,l,n,m,h[14],15,-1416354905),m=x(m,g,l,n,h[5],21,-57434055),n=x(n,m,g,l,h[12],6,1700485571),l=x(l,n,m,g,h[3],10,-1894986606),g=x(g,l,n,m,h[10],15,-1051523),m=x(m,g,l,n,h[1],21,-2054922799),n=x(n,m,g,l,h[8],6,1873313359),l=x(l,n,m,g,h[15],10,-30611744),g=x(g,l,n,m,h[6],15,-1560198380),m=x(m,g,l,n,h[13],21,1309151649),n=x(n,m,g,l,h[4],6,-145523070),l=x(l,n,m,g,h[11],10,-1120210379),g=x(g,l,n,m,h[2],15,718787259),m=x(m,g,l,n,h[9],21,-343485551),i[0]=K(n,i[0]),i[1]=K(m,i[1]),i[2]=K(g,i[2]),i[3]=K(l,i[3])}function J(g){var i,h=[];for(i=0;64>i;i+=4){h[i>>2]=g.charCodeAt(i)+(g.charCodeAt(i+1)<<8)+(g.charCodeAt(i+2)<<16)+(g.charCodeAt(i+3)<<24)}return h}function w(g){var i,h=[];for(i=0;64>i;i+=4){h[i>>2]=g[i]+(g[i+1]<<8)+(g[i+2]<<16)+(g[i+3]<<24)}return h}function B(g){var m,i,h,n,p,o,l=g.length,r=[1732584193,-271733879,-1732584194,271733878];for(m=64;l>=m;m+=64){M(r,J(g.substring(m-64,m)))}for(g=g.substring(m-64),i=g.length,h=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],m=0;i>m;m+=1){h[m>>2]|=g.charCodeAt(m)<<(m%4<<3)}if(h[m>>2]|=128<<(m%4<<3),m>55){for(M(r,h),m=0;16>m;m+=1){h[m]=0}}return n=8*l,n=n.toString(16).match(/(.*?)(.{0,8})$/),p=parseInt(n[2],16),o=parseInt(n[1],16)||0,h[14]=p,h[15]=o,M(r,h),r}function D(g){var o,i,h,n,p,m,l=g.length,r=[1732584193,-271733879,-1732584194,271733878];for(o=64;l>=o;o+=64){M(r,w(g.subarray(o-64,o)))}for(g=l>o-64?g.subarray(o-64):new Uint8Array(0),i=g.length,h=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],o=0;i>o;o+=1){h[o>>2]|=g[o]<<(o%4<<3)}if(h[o>>2]|=128<<(o%4<<3),o>55){for(M(r,h),o=0;16>o;o+=1){h[o]=0}}return n=8*l,n=n.toString(16).match(/(.*?)(.{0,8})$/),p=parseInt(n[2],16),m=parseInt(n[1],16)||0,h[14]=p,h[15]=m,M(r,h),r}function q(g){var i,h="";for(i=0;4>i;i+=1){h+=L[g>>8*i+4&15]+L[g>>8*i&15]}return h}function F(h){var g;for(g=0;g<h.length;g+=1){h[g]=q(h[g])}return h.join("")}function I(g){return/[\u0080-\uFFFF]/.test(g)&&(g=unescape(encodeURIComponent(g))),g}function k(i,h){var n,m=i.length,l=new ArrayBuffer(m),g=new Uint8Array(l);for(n=0;m>n;n+=1){g[n]=i.charCodeAt(n)}return h?g:l}function j(g){return String.fromCharCode.apply(null,new Uint8Array(g))}function f(h,g,i){var l=new Uint8Array(h.byteLength+g.byteLength);return l.set(new Uint8Array(h)),l.set(new Uint8Array(g),h.byteLength),i?l:l.buffer}function N(h){var g,i=[],l=h.length;for(g=0;l-1>g;g+=2){i.push(parseInt(h.substr(g,2),16))}return String.fromCharCode.apply(String,i)}function H(){this.reset()}var K=function(h,g){return h+g&4294967295},L=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return"5d41402abc4b2a76b9719d911017c592"!==F(B("hello"))&&(K=function(h,g){var i=(65535&h)+(65535&g),l=(h>>16)+(g>>16)+(i>>16);return l<<16|65535&i}),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||!function(){function g(i,h){return i=0|i||0,0>i?Math.max(i+h,0):Math.min(i,h)}ArrayBuffer.prototype.slice=function(s,n){var r,o,l,p,m=this.byteLength,h=g(s,m),i=m;return n!==z&&(i=g(n,m)),h>i?new ArrayBuffer(0):(r=i-h,o=new ArrayBuffer(r),l=new Uint8Array(o),p=new Uint8Array(this,h,r),l.set(p),o)}}(),H.prototype.append=function(g){return this.appendBinary(I(g)),this},H.prototype.appendBinary=function(g){this._buff+=g,this._length+=g.length;var i,h=this._buff.length;for(i=64;h>=i;i+=64){M(this._hash,J(this._buff.substring(i-64,i)))}return this._buff=this._buff.substring(i-64),this},H.prototype.end=function(i){var h,n,m=this._buff,l=m.length,g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(h=0;l>h;h+=1){g[h>>2]|=m.charCodeAt(h)<<(h%4<<3)}return this._finish(g,l),n=F(this._hash),i&&(n=N(n)),this.reset(),n},H.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},H.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},H.prototype.setState=function(g){return this._buff=g.buff,this._length=g.length,this._hash=g.hash,this},H.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},H.prototype._finish=function(i,h){var n,m,l,g=h;if(i[g>>2]|=128<<(g%4<<3),g>55){for(M(this._hash,i),g=0;16>g;g+=1){i[g]=0}}n=8*this._length,n=n.toString(16).match(/(.*?)(.{0,8})$/),m=parseInt(n[2],16),l=parseInt(n[1],16)||0,i[14]=m,i[15]=l,M(this._hash,i)},H.hash=function(h,g){return H.hashBinary(I(h),g)},H.hashBinary=function(h,g){var i=B(h),l=F(i);return g?N(l):l},H.ArrayBuffer=function(){this.reset()},H.ArrayBuffer.prototype.append=function(h){var g,i=f(this._buff.buffer,h,!0),l=i.length;for(this._length+=h.byteLength,g=64;l>=g;g+=64){M(this._hash,w(i.subarray(g-64,g)))}return this._buff=l>g-64?new Uint8Array(i.buffer.slice(g-64)):new Uint8Array(0),this},H.ArrayBuffer.prototype.end=function(i){var h,n,m=this._buff,l=m.length,g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(h=0;l>h;h+=1){g[h>>2]|=m[h]<<(h%4<<3)}return this._finish(g,l),n=F(this._hash),i&&(n=N(n)),this.reset(),n},H.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},H.ArrayBuffer.prototype.getState=function(){var g=H.prototype.getState.call(this);return g.buff=j(g.buff),g},H.ArrayBuffer.prototype.setState=function(g){return g.buff=k(g.buff,!0),H.prototype.setState.call(this,g)},H.ArrayBuffer.prototype.destroy=H.prototype.destroy,H.ArrayBuffer.prototype._finish=H.prototype._finish,H.ArrayBuffer.hash=function(h,g){var i=D(new Uint8Array(h)),l=F(i);return g?N(l):l},H})},{}],16:[function(f,c,g){function d(j,p,l){var h=l[l.length-1];j===h.element&&(l.pop(),h=l[l.length-1]);var m=h.element,e=h.index;if(Array.isArray(m)){m.push(j)}else{if(e===p.length-2){var k=p.pop();m[k]=j}else{p.push(j)}}}g.stringify=function(w){var z=[];z.push({obj:w});for(var B,x,h,m,q,A,p,j,v,k,y,e="";B=z.pop();){if(x=B.obj,h=B.prefix||"",m=B.val||"",e+=h,m){e+=m}else{if("object"!=typeof x){e+="undefined"==typeof x?null:JSON.stringify(x)}else{if(null===x){e+="null"}else{if(Array.isArray(x)){for(z.push({val:"]"}),q=x.length-1;q>=0;q--){A=0===q?"":",",z.push({obj:x[q],prefix:A})}z.push({val:"["})}else{p=[];for(j in x){x.hasOwnProperty(j)&&p.push(j)}for(z.push({val:"}"}),q=p.length-1;q>=0;q--){v=p[q],k=x[v],y=q>0?",":"",y+=JSON.stringify(v)+":",z.push({obj:k,prefix:y})}z.push({val:"{"})}}}}}return e},g.parse=function(h){for(var p,x,v,y,m,r,q,j,e,w=[],k=[],z=0;;){if(p=h[z++],"}"!==p&&"]"!==p&&"undefined"!=typeof p){switch(p){case" ":case"	":case"\n":case":":case",":break;case"n":z+=3,d(null,w,k);break;case"t":z+=3,d(!0,w,k);break;case"f":z+=4,d(!1,w,k);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(x="",z--;;){if(v=h[z++],!/[\d\.\-e\+]/.test(v)){z--;break}x+=v}d(parseFloat(x),w,k);break;case'"':for(y="",m=void 0,r=0;;){if(q=h[z++],'"'===q&&("\\"!==m||r%2!==1)){break}y+=q,m=q,"\\"===m?r++:r=0}d(JSON.parse('"'+y+'"'),w,k);break;case"[":j={element:[],index:w.length},w.push(j.element),k.push(j);break;case"{":e={element:{},index:w.length},w.push(e.element),k.push(e);break;default:throw new Error("unexpectedly reached end of input: "+p)}}else{if(1===w.length){return w.pop()}d(w.pop(),w,k)}}}},{}],17:[function(c,f,d){(function(em,bY){function aK(g){return g&&"object"==typeof g&&"default" in g?g["default"]:g}function d1(j,h){for(var l={},i=0,k=h.length;k>i;i++){var g=h[i];g in j&&(l[g]=j[g])}return l}function fG(g){return g instanceof ArrayBuffer||"undefined"!=typeof Blob&&g instanceof Blob}function aX(g){if("function"==typeof g.slice){return g.slice(0)}var i=new ArrayBuffer(g.byteLength),h=new Uint8Array(i),j=new Uint8Array(g);return h.set(j),i}function aL(i){if(i instanceof ArrayBuffer){return aX(i)}var h=i.size,g=i.type;return"function"==typeof i.slice?i.slice(0,h,g):i.webkitSlice(0,h,g)}function bO(i){var g,k,h;if(!i||"object"!=typeof i){return i}if(Array.isArray(i)){for(g=[],k=0,h=i.length;h>k;k++){g[k]=bO(i[k])}return g}if(i instanceof Date){return i.toISOString()}if(fG(i)){return aL(i)}g={};for(k in i){if(Object.prototype.hasOwnProperty.call(i,k)){var j=bO(i[k]);"undefined"!=typeof j&&(g[k]=j)}}return g}function cV(h){var g=!1;return ba(function(i){if(g){throw new Error("once called more than once")}g=!0,h.apply(this,i)})}function aq(g){return ba(function(j){j=bO(j);var k,l=this,i="function"==typeof j[j.length-1]?j.pop():!1;i&&(k=function(n,m){em.nextTick(function(){i(n,m)})});var h=new aC(function(m,q){var o;try{var n=cV(function(r,s){r?q(r):m(s)});j.push(n),o=g.apply(l,j),o&&"function"==typeof o.then&&m(o)}catch(p){q(p)}});return k&&h.then(function(m){k(null,m)},k),h})}function eE(i,h){function g(k,o,m){if(aQ.enabled){for(var j=[k._db_name,o],l=0;l<m.length-1;l++){j.push(m[l])}aQ.apply(null,j);var n=m[m.length-1];m[m.length-1]=function(r,p){var q=[k._db_name,o];q=q.concat(r?["error",r]:["success",p]),aQ.apply(null,q),n(r,p)}}}return aq(ba(function(j){if(this._closed){return aC.reject(new Error("database is closed"))}if(this._destroyed){return aC.reject(new Error("database is destroyed"))}var k=this;return g(k,i,j),this.taskqueue.isReady?h.apply(this,j):new aC(function(l,m){k.taskqueue.addTask(function(n){n?m(n):l(k[i].apply(k,j))})})}))}function bw(i,h,g){return new aC(function(j,k){i.get(h,function(l,n){if(l){if(404!==l.status){return k(l)}n={}}var m=n._rev,o=g(n);return o?(o._id=h,o._rev=m,void j(jL(i,o,g))):j({updated:!1,rev:m})})})}function jL(i,h,g){return i.put(h).then(function(j){return{updated:!0,rev:j.rev}},function(j){if(409!==j.status){throw j}return bw(i,h._id,g)})}function dL(r){for(var s,i,g,h,k=r.rev_tree.slice();h=k.pop();){var p=h.ids,l=p[2],q=h.pos;if(l.length){for(var o=0,m=l.length;m>o;o++){k.push({pos:q+1,ids:l[o]})}}else{var j=!!p[1].deleted,n=p[0];s&&!(g!==j?g:i!==q?q>i:n>s)||(s=n,i=q,g=j)}}return i+"-"+s}function ek(g){return g.ids}function aT(i,g){g||(g=dL(i));for(var k,h=g.substring(g.indexOf("-")+1),j=i.rev_tree.map(ek);k=j.pop();){if(k[0]===h){return !!k[1].deleted}j=j.concat(k[2])}}function dR(g){return ef("return "+g+";",{})}function cl(g){return new Function("doc",["var emitted = false;","var emit = function (a, b) {","  emitted = true;","};","var view = "+g+";","view(doc);","if (emitted) {","  return true;","}"].join("\n"))}function dz(h){if(!h){return null}var g=h.split("/");return 2===g.length?g:1===g.length?[h,h]:null}function jD(h){var g=dz(h);return g?g.join("/"):null}function cY(g,i){for(var m,k=g.slice();m=k.pop();){for(var l=m.pos,o=m.ids,h=o[2],j=i(0===h.length,l,o[0],m.ctx,o[1]),p=0,n=h.length;n>p;p++){k.push({pos:l+1,ids:h[p],ctx:j})}}}function bh(h,g){return h.pos-g.pos}function f1(g){var i=[];cY(g,function(m,o,l,n,k){m&&i.push({rev:o+"-"+l,pos:o,opts:k})}),i.sort(bh).reverse();for(var h=0,j=i.length;j>h;h++){delete i[h].pos}return i}function fF(l){for(var j=dL(l),g=f1(l.rev_tree),k=[],m=0,i=g.length;i>m;m++){var h=g[m];h.rev===j||h.opts.deleted||k.push(h.rev)}return k}function cw(g){Error.call(this,g.reason),this.status=g.status,this.name=g.error,this.message=g.reason,this.error=!0}function cM(g,i,h){function j(k){for(var l in g){"function"!=typeof g[l]&&(this[l]=g[l])}void 0!==h&&(this.name=h),void 0!==k&&(this.reason=k)}return j.prototype=cw.prototype,new j(i)}function cC(j){var h,l,i,k,g;return l=j.error===!0&&"string"==typeof j.name?j.name:j.error,g=j.reason,i=bW("name",l,g),j.missing||"missing"===g||"deleted"===g||"not_found"===l?i=jY:"doc_validation"===l?(i=jV,k=g):"bad_request"===l&&i.message!==g&&(i=dE),i||(i=bW("status",j.status,g)||j9),h=cM(i,g,l),k&&(h.message=k),j.id&&(h.id=j.id),j.status&&(h.status=j.status),j.missing&&(h.missing=j.missing),h}function dg(l,j,g){function k(){m.cancel()}aE.EventEmitter.call(this);var m=this;this.db=l,j=j?bO(j):{};var i=j.complete=cV(function(o,n){o?m.emit("error",o):m.emit("complete",n),m.removeAllListeners(),l.removeListener("destroyed",k)});g&&(m.on("complete",function(n){g(null,n)}),m.on("error",g)),l.once("destroyed",k),j.onChange=function(n){j.isCancelled||(m.emit("change",n),m.startSeq&&m.startSeq<=n.seq&&(m.startSeq=!1))};var h=new aC(function(o,n){j.complete=function(p,q){p?n(p):o(q)}});m.once("cancel",function(){l.removeListener("destroyed",k),j.complete(null,{status:"cancelled"})}),this.then=h.then.bind(h),this["catch"]=h["catch"].bind(h),this.then(function(n){i(null,n)},i),l.taskqueue.isReady?m.doChanges(j):l.taskqueue.addTask(function(){m.isCancelled?m.emit("cancel"):m.doChanges(j)})}function cQ(i,g,k){var h=[{rev:i._rev}];"all_docs"===k.style&&(h=f1(g.rev_tree).map(function(l){return{rev:l.rev}}));var j={id:g.id,changes:h,doc:i};return aT(g,i._rev)&&(j.deleted=!0),k.conflicts&&(j.doc._conflicts=fF(g),j.doc._conflicts.length||delete j.doc._conflicts),j}function cX(n,i,m){function k(){var r=[];o.forEach(function(s){s.docs.forEach(function(u){r.push({id:s.id,docs:[u]})})}),m(null,{results:r})}function l(){++q===g&&k()}function p(r,u,s){o[r]={id:u,docs:s},l()}var j=Array.isArray(i)?i:i.docs,h={};j.forEach(function(r){r.id in h?h[r.id].push(r):h[r.id]=[r]});var g=Object.keys(h).length,q=0,o=new Array(g);Object.keys(h).forEach(function(w,u){var r=h[w],v=d1(r[0],["atts_since","attachments"]);v.open_revs=r.map(function(x){return x.rev}),v.open_revs=v.open_revs.filter(function(x){return x});var s=function(x){return x};0===v.open_revs.length&&(delete v.open_revs,s=function(x){return[{ok:x}]}),["revs","attachments","binary","ajax"].forEach(function(x){x in i&&(v[x]=i[x])}),n.get(w,v,function(x,y){p(u,w,x?[{error:x}]:s(y))})})}function jP(g){return/^_local/.test(g)}function eL(r){for(var s,i=[],g=r.slice();s=g.pop();){var h=s.pos,k=s.ids,p=k[0],l=k[1],q=k[2],o=0===q.length,m=s.history?s.history.slice():[];m.push({id:p,opts:l}),o&&i.push({pos:h+1-m.length,ids:m});for(var j=0,n=q.length;n>j;j++){g.push({pos:h+1,ids:q[j],history:m})}}return i.reverse()}function ah(g){return 0|Math.random()*g}function bN(g,i){i=i||a9.length;var h="",j=-1;if(g){for(;++j<g;){h+=a9[ah(i)]}return h}for(;++j<36;){switch(j){case 8:case 13:case 18:case 23:h+="-";break;case 19:h+=a9[3&ah(16)|8];break;default:h+=a9[ah(16)]}}return h}function aU(g){return g.reduce(function(i,h){return i[h]=!0,i},{})}function bg(h){var g;if(h?"string"!=typeof h?g=cM(bd):/^_/.test(h)&&!/^_(design|local)/.test(h)&&(g=cM(aM)):g=cM(ay),g){throw g}}function e2(g){if(!/^\d+\-./.test(g)){return cM(fH)}var i=g.indexOf("-"),h=g.substring(0,i),j=g.substring(i+1);return{prefix:parseInt(h,10),id:j}}function dh(l,j){for(var g=l.start-l.ids.length+1,k=l.ids,m=[k[0],j,[]],i=1,h=k.length;h>i;i++){m=[k[i],{status:"missing"},[m]]}return[{pos:g,ids:m}]}function cg(g,i){var m,k,l,o={status:"available"};if(g._deleted&&(o.deleted=!0),i){if(g._id||(g._id=bN()),k=bN(32,16).toLowerCase(),g._rev){if(l=e2(g._rev),l.error){return l}g._rev_tree=[{pos:l.prefix,ids:[l.id,{status:"missing"},[[k,o,[]]]]}],m=l.prefix+1}else{g._rev_tree=[{pos:1,ids:[k,o,[]]}],m=1}}else{if(g._revisions&&(g._rev_tree=dh(g._revisions,o),m=g._revisions.start,k=g._revisions.ids[0]),!g._rev_tree){if(l=e2(g._rev),l.error){return l}m=l.prefix,k=l.id,g._rev_tree=[{pos:m,ids:[k,o,[]]}]}}bg(g._id),g._rev=m+"-"+k;var h={metadata:{},data:{}};for(var j in g){if(Object.prototype.hasOwnProperty.call(g,j)){var p="_"===j[0];if(p&&!eP[j]){var n=cM(jV,j);throw n.message=jV.message+": "+j,n}p&&!cy[j]?h.metadata[j.slice(1)]=g[j]:h.data[j]=g[j]}}return h}function ds(h,g){return g>h?-1:h>g?1:0}function ea(i,h){for(var g=0;g<i.length;g++){if(h(i[g],g)===!0){return i[g]}}}function dw(g){return function(h,i){h||i[0]&&i[0].error?g(h||i[0]):g(null,i.length?i[0]:i)}}function eW(j){for(var h=0;h<j.length;h++){var l=j[h];if(l._deleted){delete l._attachments}else{if(l._attachments){for(var i=Object.keys(l._attachments),k=0;k<i.length;k++){var g=i[k];l._attachments[g]=d1(l._attachments[g],["data","digest","content_type","length","revpos","stub"])}}}}}function dK(i,g){var k=ds(i._id,g._id);if(0!==k){return k}var h=i._revisions?i._revisions.start:0,j=g._revisions?g._revisions.start:0;return ds(h,j)}function c5(i){var h={},g=[];return cY(i,function(m,l,n,k){var j=l+"-"+n;return m&&(h[j]=0),void 0!==k&&g.push({from:k,to:j}),j}),g.reverse(),g.forEach(function(j){void 0===h[j.from]?h[j.from]=1+h[j.to]:h[j.from]=Math.min(h[j.from],1+h[j.to])}),h}function cW(i,g,k){var h="limit" in g?g.keys.slice(g.skip,g.limit+g.skip):g.skip>0?g.keys.slice(g.skip):g.keys;if(g.descending&&h.reverse(),!h.length){return i._allDocs({limit:0},k)}var j={offset:g.skip};return aC.all(h.map(function(m){var l=bL.extend({key:m,deleted:"ok"},g);return["limit","skip","keys"].forEach(function(n){delete l[n]}),new aC(function(o,n){i._allDocs(l,function(q,p){return q?n(q):(j.total_rows=p.total_rows,void o(p.rows[0]||{key:m,error:"not_found"}))})})})).then(function(l){return j.rows=l,j})}function aw(g){var i=g._compactionQueue[0],j=i.opts,h=i.callback;g.get("_local/compaction")["catch"](function(){return !1}).then(function(k){k&&k.last_seq&&(j.last_seq=k.last_seq),g._compact(j,function(l,m){l?h(l):h(null,m),em.nextTick(function(){g._compactionQueue.shift(),g._compactionQueue.length&&aw(g)})})})}function fI(g){return"_"===g.charAt(0)?g+"is not a valid attachment name, attachment names cannot start with '_'":!1}function ki(i,g,k,h){g.seq=g.seq||0;var j={doc_ids:["_design/"+k],limit:1,since:g.seq};i.changes(j).then(function(l){var m=l.results&&l.results.length&&l.results[0].seq;m&&m>g.seq&&(g.seq=m,delete g.promise),h()})["catch"](h)}function dp(g,i,h){g._ddocCache=g._ddocCache||{},g._ddocCache[i]=g._ddocCache[i]||{};var j=g._ddocCache[i];ki(g,j,i,function(k){return k?h(k):(j.promise||(j.promise=new aC(function(m,l){g._get("_design/"+i,{},function(p,o){if(p){return l(p)}var n={};["views","filters"].forEach(function(q){n[q]=o.doc[q]}),m(n)})})),void j.promise.then(function(l){h(null,l)})["catch"](h))})}function av(i,g,k,h,j){dp(i,g,function(l,n){if(l){return j(l)}var m=n[k]&&n[k][h];return m?void j(null,m):j(cM(jY))})}function aS(){aE.EventEmitter.call(this)}function af(){this.isReady=!1,this.failed=!1,this.queue=[]}function jX(g){g&&bY.debug&&console.error(g)}function df(l,j){function g(){i.emit("destroyed",m)}function k(){l.removeListener("destroyed",g),l.emit("destroyed",l)}var m=j.originalName,i=l.constructor,h=i._destructionListeners;l.once("destroyed",g),h.has(m)||h.set(m,[]),h.get(m).push(k)}function e5(j,h,l){if(!(this instanceof e5)){return new e5(j,h,l)}var i=this;"function"!=typeof h&&"undefined"!=typeof h||(l=h,h={}),j&&"object"==typeof j&&(h=j,j=void 0),"undefined"==typeof l&&(l=jX),j=j||h.name,h=bO(h),delete h.name,this.__opts=h;var k=l;i.auto_compaction=h.auto_compaction,i.prefix=e5.prefix,aS.call(i),i.taskqueue=new af;var g=new aC(function(m,p){l=function(r,s){return r?p(r):(delete s.then,void m(s))},h=bO(h);var n,q,o=h.name||j;return function(){try{if("string"!=typeof o){throw q=new Error("Missing/invalid DB name"),q.code=400,q}if(n=e5.parseAdapter(o,h),h.originalName=o,h.name=n.name,h.prefix&&"http"!==n.adapter&&"https"!==n.adapter&&(h.name=h.prefix+h.name),h.adapter=h.adapter||n.adapter,i._adapter=h.adapter,al("pouchdb:adapter")("Picked adapter: "+h.adapter),i._db_name=o,!e5.adapters[h.adapter]){throw q=new Error("Adapter is missing"),q.code=404,q}if(!e5.adapters[h.adapter].valid()){throw q=new Error("Invalid Adapter"),q.code=404,q}}catch(r){i.taskqueue.fail(r)}}(),q?p(q):(i.adapter=h.adapter,i.replicate={},i.replicate.from=function(r,u,s){return i.constructor.replicate(r,i,u,s)},i.replicate.to=function(r,u,s){return i.constructor.replicate(i,r,u,s)},i.sync=function(r,u,s){return i.constructor.sync(i,r,u,s)},i.replicate.sync=i.sync,void e5.adapters[h.adapter].call(i,h,function(r){return r?(i.taskqueue.fail(r),void l(r)):(df(i,h),i.emit("created",i),e5.emit("created",h.originalName),i.taskqueue.ready(i),void l(null,i))}))});g.then(function(m){k(null,m)},k),i.then=g.then.bind(g),i["catch"]=g["catch"].bind(g)}function bH(){return"undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage&&"undefined"!=typeof chrome.storage.local}function e6(){return bu}function bD(h){Object.keys(aE.EventEmitter.prototype).forEach(function(i){"function"==typeof aE.EventEmitter.prototype[i]&&(h[i]=b8[i].bind(b8))});var g=h._destructionListeners=new e4.Map;h.on("destroyed",function(i){g.has(i)&&(g.get(i).forEach(function(j){j()}),g["delete"](i))})}function d2(j,h){j=j||[],h=h||{};try{return new Blob(j,h)}catch(l){if("TypeError"!==l.name){throw l}for(var i="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder,k=new i,g=0;g<j.length;g+=1){k.append(j[g])}return k.getBlob(h.type)}}function b7(i,h){if("undefined"==typeof FileReader){return h((new FileReaderSync).readAsArrayBuffer(i))}var g=new FileReader;g.onloadend=function(j){var k=j.target.result||new ArrayBuffer(0);h(k)},g.readAsArrayBuffer(i)}function aJ(){for(var g={},i=new aC(function(k,l){g.resolve=k,g.reject=l}),h=new Array(arguments.length),j=0;j<h.length;j++){h[j]=arguments[j]}return g.promise=i,aC.resolve().then(function(){return fetch.apply(null,h)}).then(function(k){g.resolve(k)})["catch"](function(k){g.reject(k)}),g}function cv(l,j){var g,k,m,i=new Headers,h={method:l.method,credentials:"include",headers:i};return l.json&&(i.set("Accept","application/json"),i.set("Content-Type",l.headers["Content-Type"]||"application/json")),l.body&&l.body instanceof Blob?b7(l.body,function(n){h.body=n}):l.body&&l.processData&&"string"!=typeof l.body?h.body=JSON.stringify(l.body):"body" in l?h.body=l.body:h.body=null,Object.keys(l.headers).forEach(function(n){l.headers.hasOwnProperty(n)&&i.set(n,l.headers[n])}),g=aJ(l.url,h),l.timeout>0&&(k=setTimeout(function(){g.reject(new Error("Load timeout for resource: "+l.url))},l.timeout)),g.promise.then(function(n){return m={statusCode:n.status},l.timeout>0&&clearTimeout(k),m.statusCode>=200&&m.statusCode<300?l.binary?n.blob():n.text():n.json()}).then(function(n){m.statusCode>=200&&m.statusCode<300?j(null,m,n):j(n,m)})["catch"](function(n){j(n,m)}),{abort:g.reject}}function fM(m,n){var k,i,j=!1,l=function(){k.abort()},g=function(){j=!0,k.abort()};k=m.xhr?new m.xhr:new XMLHttpRequest;try{k.open(m.method,m.url)}catch(h){n(h,{statusCode:413})}k.withCredentials="withCredentials" in m?m.withCredentials:!0,"GET"===m.method?delete m.headers["Content-Type"]:m.json&&(m.headers.Accept="application/json",m.headers["Content-Type"]=m.headers["Content-Type"]||"application/json",m.body&&m.processData&&"string"!=typeof m.body&&(m.body=JSON.stringify(m.body))),m.binary&&(k.responseType="arraybuffer"),"body" in m||(m.body=null);for(var o in m.headers){m.headers.hasOwnProperty(o)&&k.setRequestHeader(o,m.headers[o])}return m.timeout>0&&(i=setTimeout(g,m.timeout),k.onprogress=function(){clearTimeout(i),4!==k.readyState&&(i=setTimeout(g,m.timeout))},"undefined"!=typeof k.upload&&(k.upload.onprogress=k.onprogress)),k.onreadystatechange=function(){if(4===k.readyState){var s={statusCode:k.status};if(k.status>=200&&k.status<300){var q;q=m.binary?d2([k.response||""],{type:k.getResponseHeader("Content-Type")}):k.responseText,n(null,s,q)}else{var p={};if(j){p=new Error("ETIMEDOUT"),s.statusCode=400}else{try{p=JSON.parse(k.response)}catch(r){}}n(p,s)}}},m.body&&m.body instanceof Blob?b7(m.body,function(p){k.send(p)}):k.send(m.body),{abort:l}}function jH(){try{return new XMLHttpRequest,!0}catch(g){return !1}}function bm(h,g){return bI||h.xhr?fM(h,g):cv(h,g)}function bf(){return""}function c3(i,g){function k(n,m,o){if(!i.binary&&i.json&&"string"==typeof n){try{n=JSON.parse(n)}catch(l){return o(l)}}Array.isArray(n)&&(n=n.map(function(p){return p.error||p.missing?cC(p):p})),i.binary&&du(n,m),o(null,n,m)}function h(m,q){var o,l;if(m.code&&m.status){var n=new Error(m.message||m.code);return n.status=m.status,q(n)}if(m.message&&"ETIMEDOUT"===m.message){return q(m)}try{o=JSON.parse(m.responseText),l=cC(o)}catch(p){l=cC(m)}q(l)}i=bO(i);var j={method:"GET",headers:{},json:!0,processData:!0,timeout:10000,cache:!1};return i=bL.extend(j,i),i.json&&(i.binary||(i.headers.Accept="application/json"),i.headers["Content-Type"]=i.headers["Content-Type"]||"application/json"),i.binary&&(i.encoding=null,i.json=!1),i.processData||(i.json=!1),bm(i,function(m,q,o){if(m){return m.status=q?q.statusCode:400,h(m,g)}var r,p=q.headers&&q.headers["content-type"],n=o||bf();if(!i.binary&&(i.json||!i.processData)&&"object"!=typeof n&&(/json/.test(p)||/^[\s]*\{/.test(n)&&/\}[\s]*$/.test(n))){try{n=JSON.parse(n.toString())}catch(l){}}q.statusCode>=200&&q.statusCode<300?k(n,q,g):(r=cC(n),r.status=q.statusCode,g(r))})}function aW(g,i){var m=navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",k=-1!==m.indexOf("safari")&&-1===m.indexOf("chrome"),l=-1!==m.indexOf("msie"),o=-1!==m.indexOf("edge"),h=k||(l||o)&&"GET"===g.method,j="cache" in g?g.cache:!0,p=/^blob:/.test(g.url);if(!p&&(h||!j)){var n=-1!==g.url.indexOf("?");g.url+=(n?"&":"?")+"_nonce="+Date.now()}return c3(g,i)}function jM(l){for(var j=dY.exec(l),g={},k=14;k--;){var m=fO[k],i=j[k]||"",h=-1!==["user","password"].indexOf(m);g[m]=h?decodeURIComponent(i):i}return g[f6]={},g[fO[12]].replace(dX,function(p,n,o){n&&(g[f6][n]=o)}),g}function t(i){for(var g=i.length,k=new ArrayBuffer(g),h=new Uint8Array(k),j=0;g>j;j++){h[j]=i.charCodeAt(j)}return k}function cH(h,g){return d2([t(h)],{type:g})}function cK(i,g,k){try{return !i(g,k)}catch(h){var j="Filter function threw: "+h.toString();return cM(dE,j)}}function kf(i){var h={},g=i.filter&&"function"==typeof i.filter;return h.query=i.query_params,function(k){k.doc||(k.doc={});var l=g&&cK(i.filter,k.doc,h);if("object"==typeof l){return l}if(l){return !1}if(i.include_docs){if(!i.attachments){for(var j in k.doc._attachments){k.doc._attachments.hasOwnProperty(j)&&(k.doc._attachments[j].stub=!0)}}}else{delete k.doc}return !0}}function b5(h,g){"console" in bY&&"info" in console&&console.info("The above "+h+" is totally normal. "+g)}function e0(i,g,k,h,j){return i.get(g)["catch"](function(l){if(404===l.status){return"http"===i.type()&&b5(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:h,_id:g,history:[],replicator:dN,version:c8}}throw l}).then(function(l){return j.cancelled?void 0:(l.history=(l.history||[]).filter(function(m){return m.session_id!==h}),l.history.unshift({last_seq:k,session_id:h}),l.history=l.history.slice(0,aZ),l.version=c8,l.replicator=dN,l.session_id=h,l.last_seq=k,i.put(l)["catch"](function(m){if(409===m.status){return e0(i,g,k,h,j)}throw m}))})}function bZ(g,i,h,j){this.src=g,this.target=i,this.id=h,this.returnValue=j}function cZ(g,i){if(g.session_id===i.session_id){return{last_seq:g.last_seq,history:g.history||[]}}var h=g.history||[],j=i.history||[];return eJ(h,j)}function eJ(l,n){var i=l[0],g=l.slice(1),h=n[0],m=n.slice(1);if(!i||0===n.length){return{last_seq:ad,history:[]}}var k=i.session_id;if(cU(k,n)){return{last_seq:i.last_seq,history:l}}var j=h.session_id;return cU(j,g)?{last_seq:h.last_seq,history:m}:eJ(g,m)}function cU(g,i){var h=i[0],j=i.slice(1);return g&&0!==i.length?g===h.session_id?!0:cU(g,j):!1}function bP(g){return"number"==typeof g.status&&4===Math.floor(g.status/100)}function fR(g,i){g=parseInt(g,10)||0,i=parseInt(i,10),i!==i||g>=i?i=(g||1)<<1:i+=1;var h=Math.random(),j=i-g;return ~~(j*h+g)}function bX(h){var g=0;return h||(g=2000),fR(h,g)}function bG(g,i,h,j){return g.retry===!1?(i.emit("error",h),void i.removeAllListeners()):("function"!=typeof g.back_off_function&&(g.back_off_function=bX),i.emit("requestError",h),"active"!==i.state&&"pending"!==i.state||(i.emit("paused",h),i.state="stopped",i.once("active",function(){g.current_back_off=jI})),g.current_back_off=g.current_back_off||jI,g.current_back_off=g.back_off_function(g.current_back_off),void setTimeout(j,g.current_back_off))}function dD(g){return bq(g)}function ax(g,i,h,j){(h>0||j<i.byteLength)&&(i=new Uint8Array(i,h,Math.min(j,i.byteLength)-h)),g.append(i)}function eD(g,i,h,j){(h>0||j<i.length)&&(i=i.substring(h,j)),g.appendBinary(i)}function ca(g){return Object.keys(g).sort(eA.collate).reduce(function(h,i){return h[i]=g[i],h},{})}function jG(l,j,g){var k=g.doc_ids?g.doc_ids.sort(eA.collate):"",m=g.filter?g.filter.toString():"",i="",h="";return g.filter&&g.query_params&&(i=JSON.stringify(ca(g.query_params))),g.filter&&"_view"===g.filter&&(h=g.view.toString()),aC.all([l.id(),j.id()]).then(function(n){var o=n[0]+n[1]+m+h+i+k;return d4(o)}).then(function(n){return n=n.replace(/\//g,".").replace(/\+/g,"_"),"_local/"+n})}function eZ(g){return/^1-/.test(g)}function jZ(h){var g=[];return Object.keys(h).forEach(function(j){var i=h[j].missing;i.forEach(function(k){g.push({id:j,rev:k})})}),{docs:g,revs:!0,attachments:!0,binary:!0}}function d7(n,i,m){function k(){var q=jZ(i);if(q.docs.length){return n.bulkGet(q).then(function(r){if(m.cancelled){throw new Error("cancelled")}r.results.forEach(function(s){s.docs.forEach(function(u){u.ok?g.push(u.ok):void 0!==u.error&&(p=!1)})})})}}function j(q){return q._attachments&&Object.keys(q._attachments).length>0}function l(q){return n.allDocs({keys:q,include_docs:!0}).then(function(r){if(m.cancelled){throw new Error("cancelled")}r.rows.forEach(function(s){!s.deleted&&s.doc&&eZ(s.value.rev)&&!j(s.doc)&&(g.push(s.doc),delete i[s.id])})})}function o(){var q=Object.keys(i).filter(function(r){var s=i[r].missing;return 1===s.length&&eZ(s[0])});return q.length>0?l(q):void 0}function h(){return{ok:p,docs:g}}i=bO(i);var g=[],p=!0;return aC.resolve().then(o).then(k).then(h)}function aY(I,Q,r,m,q){function y(){return B?aC.resolve():jG(I,Q,r).then(function(T){h=T,B=new bZ(I,Q,h,m)})}function l(){if(j=[],0!==G.docs.length){var T=G.docs;return Q.bulkDocs({docs:T,new_edits:!1}).then(function(U){if(m.cancelled){throw p(),new Error("cancelled")}var W=[],Y={};U.forEach(function(Z){Z.error&&(q.doc_write_failures++,W.push(Z),Y[Z.id]=Z)}),H=H.concat(W),q.docs_written+=G.docs.length-W.length;var X=W.filter(function(Z){return"unauthorized"!==Z.name&&"forbidden"!==Z.name});if(T.forEach(function(Z){var ae=Y[Z._id];ae?m.emit("denied",bO(ae)):j.push(Z)}),X.length>0){var V=new Error("bulkDocs error");throw V.other_errors=W,z("target.bulkDocs failed to write docs",V),new Error("bulkWrite partial failure")}},function(U){throw q.doc_write_failures+=T.length,U})}}function R(){if(G.error){throw new Error("There was a problem getting docs.")}q.last_seq=F=G.seq;var T=bO(q);return j.length&&(T.docs=j,m.emit("change",T)),C=!0,B.writeCheckpoint(G.seq,J).then(function(){if(C=!1,m.cancelled){throw p(),new Error("cancelled")}G=void 0,u()})["catch"](function(U){throw C=!1,z("writeCheckpoint completed with error",U),U})}function L(){var T={};return G.changes.forEach(function(U){"_user/"!==U.id&&(T[U.id]=U.changes.map(function(V){return V.rev}))}),Q.revsDiff(T).then(function(U){if(m.cancelled){throw p(),new Error("cancelled")}G.diffs=U})}function D(){return d7(I,G.diffs,m).then(function(T){G.error=!T.ok,T.docs.forEach(function(U){delete G.diffs[U._id],q.docs_read++,G.docs.push(U)})})}function v(){if(!m.cancelled&&!G){if(0===w.length){return void M(!0)}G=w.shift(),L().then(D).then(l).then(R).then(v)["catch"](function(T){z("batch processing terminated with error",T)})}}function M(T){return 0===o.changes.length?void (0!==w.length||G||((x&&g.live||k)&&(m.state="pending",m.emit("paused")),k&&p())):void ((T||k||o.changes.length>=i)&&(w.push(o),o={seq:0,changes:[],docs:[]},"pending"!==m.state&&"stopped"!==m.state||(m.state="active",m.emit("active")),v()))}function z(U,T){s||(T.message||(T.message=U),q.ok=!1,q.status="aborting",q.errors.push(T),H=H.concat(T),w=[],o={seq:0,changes:[],docs:[]},p())}function p(){if(!(s||m.cancelled&&(q.status="cancelled",C))){q.status=q.status||"complete",q.end_time=new Date,q.last_seq=F,s=!0;var U=H.filter(function(V){return"unauthorized"!==V.name&&"forbidden"!==V.name});if(U.length>0){var T=H.pop();H.length>0&&(T.other_errors=H),T.result=q,bG(r,m,T,function(){aY(I,Q,r,m)})}else{q.errors=H,m.emit("complete",q),m.removeAllListeners()}}}function K(U){if(m.cancelled){return p()}var T=kf(r)(U);T&&(o.seq=U.seq,o.changes.push(U),M(g.live))}function S(T){return N=!1,m.cancelled?p():(T.results.length>0?(g.since=T.last_seq,u()):x?(g.live=!0,u()):k=!0,void M(!0))}function n(T){return N=!1,m.cancelled?p():void z("changes rejected",T)}function u(){function V(){U.cancel()}function T(){m.removeListener("cancel",V)}if(!N&&!k&&w.length<O){N=!0,m._changes&&(m.removeListener("cancel",m._abortChanges),m._changes.cancel()),m.once("cancel",V);var U=I.changes(g).on("change",K);U.then(T,T),U.then(S)["catch"](n),r.retry&&(m._changes=U,m._abortChanges=V)}}function A(){y().then(function(){return m.cancelled?void p():B.getCheckpoint().then(function(T){F=T,g={since:F,limit:i,batch_size:i,style:"all_docs",doc_ids:E,return_docs:!0},r.filter&&("string"!=typeof r.filter?g.include_docs=!0:g.filter=r.filter),"heartbeat" in r&&(g.heartbeat=r.heartbeat),"timeout" in r&&(g.timeout=r.timeout),r.query_params&&(g.query_params=r.query_params),r.view&&(g.view=r.view),u()})})["catch"](function(T){z("getCheckpoint rejected with ",T)})}function P(T){throw C=!1,z("writeCheckpoint completed with error",T),T}var G,h,B,w=[],o={seq:0,changes:[],docs:[]},C=!1,k=!1,s=!1,F=0,x=r.continuous||r.live||!1,i=r.batch_size||100,O=r.batches_limit||10,N=!1,E=r.doc_ids,H=[],j=[],J=bN();q=q||{ok:!0,start_time:new Date,docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var g={};return m.ready(I,Q),m.cancelled?void p():(m._addedListeners||(m.once("cancel",p),"function"==typeof r.complete&&(m.once("error",r.complete),m.once("complete",function(T){r.complete(null,T)})),m._addedListeners=!0),void ("undefined"==typeof r.since?A():y().then(function(){return C=!0,B.writeCheckpoint(r.since,J)}).then(function(){return C=!1,m.cancelled?void p():(F=r.since,void A())})["catch"](P)))}function eO(){aE.EventEmitter.call(this),this.cancelled=!1,this.state="pending";var h=this,g=new aC(function(i,j){h.once("complete",i),h.once("error",j)});h.then=function(i,j){return g.then(i,j)},h["catch"]=function(i){return g["catch"](i)},h["catch"](function(){})}function aN(i,h){var g=h.PouchConstructor;return"string"==typeof i?new g(i,h):i}function f7(l,j,g,k){if("function"==typeof g&&(k=g,g={}),"undefined"==typeof g&&(g={}),g.doc_ids&&!Array.isArray(g.doc_ids)){throw cM(dE,"`doc_ids` filter parameter is not a list.")}g.complete=k,g=bO(g),g.continuous=g.continuous||g.live,g.retry="retry" in g?g.retry:!1,g.PouchConstructor=g.PouchConstructor||this;var m=new eO(g),i=aN(l,g),h=aN(j,g);return aY(i,h,g,m),m}function f9(g,i,h,j){return"function"==typeof h&&(j=h,h={}),"undefined"==typeof h&&(h={}),h=bO(h),h.PouchConstructor=h.PouchConstructor||this,g=by.toPouch(g,h),i=by.toPouch(i,h),new dJ(g,i,h,j)}function dJ(m,u,v,o){function s(z){k.emit("change",{direction:"pull",change:z})}function y(z){k.emit("change",{direction:"push",change:z})}function r(z){k.emit("denied",{direction:"push",doc:z})}function w(z){k.emit("denied",{direction:"pull",doc:z})}function i(){k.pushPaused=!0,k.pullPaused&&k.emit("paused")}function p(){k.pullPaused=!0,k.pushPaused&&k.emit("paused")}function l(){k.pushPaused=!1,k.pullPaused&&k.emit("active",{direction:"push"})}function x(){k.pullPaused=!1,k.pushPaused&&k.emit("active",{direction:"pull"})}function n(z){return function(D,A){var B="change"===D&&(A===s||A===y),F="denied"===D&&(A===w||A===r),C="paused"===D&&(A===p||A===i),E="active"===D&&(A===x||A===l);(B||F||C||E)&&(D in g||(g[D]={}),g[D][z]=!0,2===Object.keys(g[D]).length&&k.removeAllListeners(D))}}var k=this;this.canceled=!1;var q=v.push?bL.extend({},v,v.push):v,h=v.pull?bL.extend({},v,v.pull):v;this.push=eV(m,u,q),this.pull=eV(u,m,h),this.pushPaused=!0,this.pullPaused=!0;var g={};v.live&&(this.push.on("complete",k.pull.cancel.bind(k.pull)),this.pull.on("complete",k.push.cancel.bind(k.push))),this.on("newListener",function(z){"change"===z?(k.pull.on("change",s),k.push.on("change",y)):"denied"===z?(k.pull.on("denied",w),k.push.on("denied",r)):"active"===z?(k.pull.on("active",x),k.push.on("active",l)):"paused"===z&&(k.pull.on("paused",p),k.push.on("paused",i))}),this.on("removeListener",function(z){"change"===z?(k.pull.removeListener("change",s),k.push.removeListener("change",y)):"denied"===z?(k.pull.removeListener("denied",w),k.push.removeListener("denied",r)):"active"===z?(k.pull.removeListener("active",x),k.push.removeListener("active",l)):"paused"===z&&(k.pull.removeListener("paused",p),k.push.removeListener("paused",i))}),this.pull.on("removeListener",n("pull")),this.push.on("removeListener",n("push"));var j=aC.all([this.push,this.pull]).then(function(A){var z={push:A[0],pull:A[1]};return k.emit("complete",z),o&&o(null,z),k.removeAllListeners(),z},function(z){if(k.cancel(),o?o(z):k.emit("error",z),k.removeAllListeners(),o){throw z}});this.then=function(A,z){return j.then(A,z)},this["catch"]=function(z){return j["catch"](z)}}function d5(h,g){return cH(c7(h),g)}function j6(i){for(var g="",k=new Uint8Array(i),h=k.byteLength,j=0;h>j;j++){g+=String.fromCharCode(k[j])}return g}function cJ(g,i){if("undefined"==typeof FileReader){return i(j6((new FileReaderSync).readAsArrayBuffer(g)))}var h=new FileReader,j="function"==typeof h.readAsBinaryString;h.onloadend=function(k){var l=k.target.result||"";return j?i(l):void i(j6(l))},j?h.readAsBinaryString(g):h.readAsArrayBuffer(g)}function dx(g){return new aC(function(h){cJ(g,function(i){h(bq(i))})})}function kk(g){for(var i=[],h=0,j=g.length;j>h;h++){i=i.concat(g[h])}return i}function fE(h){var g=h.doc&&h.doc._attachments;g&&Object.keys(g).forEach(function(i){var j=g[i];j.data=d5(j.data,j.content_type)})}function jE(g){return/^_design/.test(g)?"_design/"+encodeURIComponent(g.slice(8)):/^_local/.test(g)?"_local/"+encodeURIComponent(g.slice(7)):encodeURIComponent(g)}function bR(g){return g._attachments&&Object.keys(g._attachments)?aC.all(Object.keys(g._attachments).map(function(h){var i=g._attachments[h];return i.data&&"string"!=typeof i.data?dx(i.data).then(function(j){i.data=j}):void 0})):aC.resolve()}function bA(i){var h=jM(i);(h.user||h.password)&&(h.auth={username:h.user,password:h.password});var g=h.path.replace(/(^\/|\/$)/g,"").split("/");return h.db=g.pop(),-1===h.db.indexOf("%")&&(h.db=encodeURIComponent(h.db)),h.path=g.join("/"),h}function el(h,g){return dl(h,h.db+"/"+g)}function dl(i,h){var g=i.path?"/":"";return i.protocol+"://"+i.host+(i.port?":"+i.port:"")+"/"+i.path+g+h}function d0(g){return"?"+Object.keys(g).map(function(h){return h+"="+encodeURIComponent(g[h])}).join("&")}function bl(o,i){function m(A,z,x){var y=A.ajax||{},B=bL.extend(bO(p),y,z);return jN(B.method+" "+B.url),eY.ajax(B,x)}function j(x,y){return new aC(function(A,z){m(x,y,function(C,B){return C?z(C):void A(B)})})}function q(x,y){return eE(x,ba(function(z){w().then(function(){return y.apply(this,z)})["catch"](function(B){var A=z.pop();A(B)})}))}function w(){if(o.skipSetup||o.skip_setup){return aC.resolve()}if(g){return g}var x={method:"GET",url:u};return g=j({},x)["catch"](function(y){return y&&y.status&&404===y.status?(b5(404,"PouchDB is just detecting if the remote exists."),j({},{method:"PUT",url:u})):aC.reject(y)})["catch"](function(y){return y&&y.status&&412===y.status?!0:aC.reject(y)}),g["catch"](function(){g=null}),g}function k(x){return x.split("/").map(encodeURIComponent).join("/")}var v=this,h=bA;o.getHost&&(h=o.getHost);var l=h(o.name,o),u=el(l,"");o=bO(o);var p=o.ajax||{};if(v.getUrl=function(){return u},v.getHeaders=function(){return p.headers||{}},o.auth||l.auth){var s=o.auth||l.auth,r=s.username+":"+s.password,n=bq(unescape(encodeURIComponent(r)));p.headers=p.headers||{},p.headers.Authorization="Basic "+n}var g;setTimeout(function(){i(null,v)}),v.type=function(){return"http"},v.id=q("id",function(x){m({},{method:"GET",url:dl(l,"")},function(z,y){var A=y&&y.uuid?y.uuid+l.db:el(l,"");x(null,A)})}),v.request=q("request",function(x,y){x.url=el(l,x.url),m({},x,y)}),v.compact=q("compact",function(x,y){"function"==typeof x&&(y=x,x={}),x=bO(x),m(x,{url:el(l,"_compact"),method:"POST"},function(){function z(){v.info(function(B,A){A&&!A.compact_running?y(null,{ok:!0}):setTimeout(z,x.interval||200)})}z()})}),v.bulkGet=eE("bulkGet",function(C,y){function A(E){var F={};C.revs&&(F.revs=!0),C.attachments&&(F.attachments=!0),m({},{url:el(l,"_bulk_get"+d0(F)),method:"POST",body:{docs:C.docs}},E)}function B(){function H(L){return function(N,M){I[L]=M.results,++J===F&&y(null,{results:kk(I)})}}for(var K=dZ,F=Math.ceil(C.docs.length/K),J=0,I=new Array(F),G=0;F>G;G++){var E=d1(C,["revs","attachments"]);E.ajax=p,E.docs=C.docs.slice(G*K,Math.min(C.docs.length,(G+1)*K)),cX(x,E,H(G))}}var x=this,z=dl(l,""),D=dT[z];"boolean"!=typeof D?A(function(F,G){if(F){var E=Math.floor(F.status/100);4===E||5===E?(dT[z]=!1,b5(F.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),B()):y(F)}else{dT[z]=!0,y(null,G)}}):D?A(y):B()}),v._info=function(x){w().then(function(){m({},{method:"GET",url:el(l,"")},function(y,z){return y?x(y):(z.host=el(l,""),void x(null,z))})})["catch"](x)},v.get=q("get",function(C,y,B){function A(F){var G=F._attachments,E=G&&Object.keys(G);return G&&E.length?aC.all(E.map(function(I){var H=G[I],J=jE(F._id)+"/"+k(I)+"?rev="+F._rev;return j(y,{method:"GET",url:el(l,J),binary:!0}).then(function(K){return y.binary?K:dx(K)}).then(function(K){delete H.stub,delete H.length,H.data=K})})):void 0}function z(E){return Array.isArray(E)?aC.all(E.map(function(F){return F.ok?A(F.ok):void 0})):A(E)}"function"==typeof y&&(B=y,y={}),y=bO(y);var x={};y.revs&&(x.revs=!0),y.revs_info&&(x.revs_info=!0),y.open_revs&&("all"!==y.open_revs&&(y.open_revs=JSON.stringify(y.open_revs)),x.open_revs=y.open_revs),y.rev&&(x.rev=y.rev),y.conflicts&&(x.conflicts=y.conflicts),C=jE(C);var D={method:"GET",url:el(l,C+d0(x))};j(y,D).then(function(E){return aC.resolve().then(function(){return y.attachments?z(E):void 0}).then(function(){B(null,E)})})["catch"](B)}),v.remove=q("remove",function(B,z,x,C){var A;"string"==typeof z?(A={_id:B,_rev:z},"function"==typeof x&&(C=x,x={})):(A=B,"function"==typeof z?(C=z,x={}):(C=x,x=z));var y=A._rev||x.rev;m(x,{method:"DELETE",url:el(l,jE(A._id))+"?rev="+y},C)}),v.getAttachment=q("getAttachment",function(B,z,x,C){"function"==typeof x&&(C=x,x={});var A=x.rev?"?rev="+x.rev:"",y=el(l,jE(B))+"/"+k(z)+A;m(x,{method:"GET",url:y,binary:!0},C)}),v.removeAttachment=q("removeAttachment",function(A,y,z,B){var x=el(l,jE(A)+"/"+k(y))+"?rev="+z;m({},{method:"DELETE",url:x},B)}),v.putAttachment=q("putAttachment",function(z,E,F,G,H,B){"function"==typeof H&&(B=H,H=G,G=F,F=null);var C=jE(z)+"/"+k(E),A=el(l,C);if(F&&(A+="?rev="+F),"string"==typeof G){var y;try{y=c7(G)}catch(D){return B(cM(dS,"Attachment is not a valid base64 string"))}G=y?cH(y,H):""}var x={headers:{"Content-Type":H},method:"PUT",url:A,processData:!1,body:G,timeout:p.timeout||60000};m({},x,B)}),v._bulkDocs=function(z,x,y){z.new_edits=x.new_edits,w().then(function(){return aC.all(z.docs.map(bR))}).then(function(){m(x,{method:"POST",url:el(l,"_bulk_docs"),body:z},function(A,B){return A?y(A):(B.forEach(function(C){C.ok=!0}),void y(null,B))})})["catch"](y)},v.allDocs=q("allDocs",function(C,y){"function"==typeof C&&(y=C,C={}),C=bO(C);var A,B={},z="GET";C.conflicts&&(B.conflicts=!0),C.descending&&(B.descending=!0),C.include_docs&&(B.include_docs=!0),C.attachments&&(B.attachments=!0),C.key&&(B.key=JSON.stringify(C.key)),C.start_key&&(C.startkey=C.start_key),C.startkey&&(B.startkey=JSON.stringify(C.startkey)),C.end_key&&(C.endkey=C.end_key),C.endkey&&(B.endkey=JSON.stringify(C.endkey)),"undefined"!=typeof C.inclusive_end&&(B.inclusive_end=!!C.inclusive_end),"undefined"!=typeof C.limit&&(B.limit=C.limit),"undefined"!=typeof C.skip&&(B.skip=C.skip);var D=d0(B);if("undefined"!=typeof C.keys){var x="keys="+encodeURIComponent(JSON.stringify(C.keys));x.length+D.length+1<=cN?D+="&"+x:(z="POST",A={keys:C.keys})}j(C,{method:z,url:el(l,"_all_docs"+D),body:A}).then(function(E){C.include_docs&&C.attachments&&C.binary&&E.rows.forEach(fE),y(null,E)})["catch"](y)}),v._changes=function(D){var F="batch_size" in D?D.batch_size:c6;D=bO(D),D.timeout="timeout" in D?D.timeout:"timeout" in p?p.timeout:30000;var L,A=D.timeout?{timeout:D.timeout-5000}:{},y="undefined"!=typeof D.limit?D.limit:!1;L="return_docs" in D?D.return_docs:"returnDocs" in D?D.returnDocs:!0;var J=y;if(D.style&&(A.style=D.style),(D.include_docs||D.filter&&"function"==typeof D.filter)&&(A.include_docs=!0),D.attachments&&(A.attachments=!0),D.continuous&&(A.feed="longpoll"),D.conflicts&&(A.conflicts=!0),D.descending&&(A.descending=!0),"heartbeat" in D?D.heartbeat&&(A.heartbeat=D.heartbeat):A.heartbeat=10000,D.filter&&"string"==typeof D.filter&&(A.filter=D.filter,"_view"===D.filter&&D.view&&"string"==typeof D.view&&(A.view=D.view)),D.query_params&&"object"==typeof D.query_params){for(var H in D.query_params){D.query_params.hasOwnProperty(H)&&(A[H]=D.query_params[H])}}var B,z="GET";if(D.doc_ids){A.filter="_doc_ids";var K=JSON.stringify(D.doc_ids);K.length<cN?A.doc_ids=K:(z="POST",B={doc_ids:D.doc_ids})}var x,I,G=function(O,N){if(!D.aborted){A.since=O,"object"==typeof A.since&&(A.since=JSON.stringify(A.since)),D.descending?y&&(A.limit=J):A.limit=!y||J>F?F:J;var M={method:z,url:el(l,"_changes"+d0(A)),timeout:D.timeout,body:B};I=O,D.aborted||w().then(function(){x=m(D,M,N)})["catch"](N)}},E={results:[]},C=function(P,M){if(!D.aborted){var N=0;if(M&&M.results){N=M.results.length,E.last_seq=M.last_seq;var Q={};Q.query=D.query_params,M.results=M.results.filter(function(R){J--;var S=kf(D)(R);return S&&(D.include_docs&&D.attachments&&D.binary&&fE(R),L&&E.results.push(R),D.onChange(R)),S})}else{if(P){return D.aborted=!0,void D.complete(P)}}M&&M.last_seq&&(I=M.last_seq);var O=y&&0>=J||M&&F>N||D.descending;(!D.continuous||y&&0>=J)&&O?D.complete(null,E):setTimeout(function(){G(I,C)},0)}};return G(D.since||0,C),{cancel:function(){D.aborted=!0,x&&x.abort()}}},v.revsDiff=q("revsDiff",function(z,x,y){"function"==typeof x&&(y=x,x={}),m(x,{method:"POST",url:el(l,"_revs_diff"),body:z},y)}),v._close=function(x){x()},v._destroy=function(y,x){m(y,{url:el(l,""),method:"DELETE"},function(A,z){return A&&A.status&&404!==A.status?x(A):(v.emit("destroyed"),v.constructor.emit("destroyed",o.name),void x(null,z))})}}function db(){this.promise=new aC(function(g){g()})}function fC(g){return eH.hash(g)}function ej(l){var n=l.db,i=l.viewName,g=l.map,h=l.reduce,m=l.temporary,k=g.toString()+(h&&h.toString())+"undefined";if(!m&&n._cachedViews){var j=n._cachedViews[k];if(j){return aC.resolve(j)}}return n.info().then(function(p){function o(u){u.views=u.views||{};var r=i;-1===r.indexOf("/")&&(r=i+"/"+i);var s=u.views[r]=u.views[r]||{};if(!s[q]){return s[q]=!0,u}}var q=p.db_name+"-mrview-"+(m?"temp":fC(k));return bw(n,"_local/mrviews",o).then(function(){return n.registerDependentDatabase(q).then(function(s){var u=s.db;u.auto_compaction=!0;var r={name:q,db:u,sourceDB:n,adapter:n.adapter,mapFun:g,reduceFun:h};return r.db.get("_local/lastSeq")["catch"](function(v){if(404!==v.status){throw v}}).then(function(v){return r.seq=v?v.seq:0,m||(n._cachedViews=n._cachedViews||{},n._cachedViews[k]=r,r.db.once("destroyed",function(){delete n._cachedViews[k]})),r})})})})}function dI(j,h,l,i,k,g){return ef("return ("+j.replace(/;\s*$/,"")+");",{emit:h,sum:l,log:i,isArray:k,toJSON:g})}function f4(g){return -1===g.indexOf("/")?[g,g]:g.split("/")}function jR(g){return 1===g.length&&/^1-/.test(g[0].rev)}function f0(i,h){try{i.emit("error",h)}catch(g){console.error("The user's map/reduce function threw an uncaught error.\nYou can debug this error by doing:\nmyDatabase.on('error', function (err) { debugger; });\nPlease double-check your map/reduce function."),console.error(h)}}function ep(g,i,h){try{return{output:i.apply(null,h)}}catch(j){return f0(g,j),{error:j}}}function kd(i,h){var g=cF(i.key,h.key);return 0!==g?g:cF(i.value,h.value)}function kb(i,h,g){return g=g||0,"number"==typeof h?i.slice(g,h+g):g>0?i.slice(g):i}function dj(i){var h=i.value,g=h&&"object"==typeof h&&h._id||i.id;return g}function cp(g){g.rows.forEach(function(i){var h=i.doc&&i.doc._attachments;h&&Object.keys(h).forEach(function(j){var k=h[j];h[j].data=d5(k.data,k.content_type)})})}function j4(g){return function(h){return g.include_docs&&g.attachments&&g.binary&&cp(h),h}}function dG(h){var g="builtin "+h+" function requires map values to be numbers or number arrays";return new f5(g)}function jJ(l){for(var n=0,i=0,g=l.length;g>i;i++){var h=l[i];if("number"!=typeof h){if(!Array.isArray(h)){throw dG("_sum")}n="number"==typeof n?[n]:n;for(var m=0,k=h.length;k>m;m++){var j=h[m];if("number"!=typeof j){throw dG("_sum")}"undefined"==typeof n[m]?n.push(j):n[m]+=j}}else{"number"==typeof n?n+=h:n[0]+=h}}return n}function ac(i,g,k,h){var j=g[i];"undefined"!=typeof j&&(h&&(j=encodeURIComponent(JSON.stringify(j))),k.push(i+"="+j))}function e9(h){if("undefined"!=typeof h){var g=Number(h);return isNaN(g)||g!==parseInt(h,10)?h:g}}function dF(g){return g.group_level=e9(g.group_level),g.limit=e9(g.limit),g.skip=e9(g.skip),g}function bK(g){if(g){if("number"!=typeof g){return new eg('Invalid value for integer: "'+g+'"')}if(0>g){return new eg('Invalid value for positive integer: "'+g+'"')}}}function fP(g,i){var h=g.descending?"endkey":"startkey",j=g.descending?"startkey":"endkey";if("undefined"!=typeof g[h]&&"undefined"!=typeof g[j]&&cF(g[h],g[j])>0){throw new eg("No rows can match your key range, reverse your start_key and end_key or set {descending : true}")}if(i.reduce&&g.reduce!==!1){if(g.include_docs){throw new eg("{include_docs:true} is invalid for reduce")}if(g.keys&&g.keys.length>1&&!g.group&&!g.group_level){throw new eg("Multi-key fetches for reduce views must use {group: true}")}}["group_level","limit","skip"].forEach(function(k){var l=bK(g[k]);if(l){throw l}})}function cP(m,n,k){var i,j=[],l="GET";if(ac("reduce",k,j),ac("include_docs",k,j),ac("attachments",k,j),ac("limit",k,j),ac("descending",k,j),ac("group",k,j),ac("group_level",k,j),ac("skip",k,j),ac("stale",k,j),ac("conflicts",k,j),ac("startkey",k,j,!0),ac("start_key",k,j,!0),ac("endkey",k,j,!0),ac("end_key",k,j,!0),ac("inclusive_end",k,j),ac("key",k,j,!0),j=j.join("&"),j=""===j?"":"?"+j,"undefined"!=typeof k.keys){var g=2000,h="keys="+encodeURIComponent(JSON.stringify(k.keys));h.length+j.length+1<=g?j+=("?"===j[0]?"&":"?")+h:(l="POST","string"==typeof n?i={keys:k.keys}:n.keys=k.keys)}if("string"==typeof n){var o=f4(n);return m.request({method:l,url:"_design/"+o[0]+"/_view/"+o[1]+j,body:i}).then(j4(k))}return i=i||{},Object.keys(n).forEach(function(p){Array.isArray(n[p])?i[p]=n[p]:i[p]=n[p].toString()}),m.request({method:"POST",url:"_temp_view"+j,body:i}).then(j4(k))}function dd(i,h,g){return new aC(function(j,k){i._query(h,g,function(m,l){return m?k(m):void j(l)})})}function bz(g){return new aC(function(h,i){g._viewCleanup(function(k,j){return k?i(k):void h(j)})})}function cG(g){return function(h){if(404===h.status){return g}throw h}}function dP(n,i,m){function k(){return jR(q)?aC.resolve(h):i.db.get(p)["catch"](cG(h))}function j(r){return r.keys.length?i.db.allDocs({keys:r.keys,include_docs:!0}):aC.resolve({rows:[]})}function l(r,v){for(var z=[],x={},y=0,A=v.rows.length;A>y;y++){var s=v.rows[y],w=s.doc;if(w&&(z.push(w),x[w._id]=!0,w._deleted=!g[w._id],!w._deleted)){var u=g[w._id];"value" in u&&(w.value=u.value)}}var B=Object.keys(g);return B.forEach(function(C){if(!x[C]){var E={_id:C},D=g[C];"value" in D&&(E.value=D.value),z.push(E)}}),r.keys=kj(B.concat(r.keys)),z.push(r),z}var p="_local/doc_"+n,h={_id:p,keys:[]},o=m[n],g=o.indexableKeysToKeyValues,q=o.changes;return k().then(function(r){return j(r).then(function(s){return l(r,s)})})}function eS(g,i,h){var j="_local/lastSeq";return g.db.get(j)["catch"](cG({_id:j,seq:0})).then(function(k){var l=Object.keys(i);return aC.all(l.map(function(m){return dP(m,g,i)})).then(function(m){var n=kk(m);return k.seq=h,n.push(k),g.db.bulkDocs({docs:n})})})}function kh(i){var h="string"==typeof i?i:i.name,g=cA[h];return g||(g=cA[h]=new db),g}function kc(g){return bJ(kh(g),function(){return dv(g)})()}function dv(m){function n(p,r){var q={id:j._id,key:dC(p)};"undefined"!=typeof r&&null!==r&&(q.value=dC(r)),i.push(q)}function k(q,p){return function(){return eS(m,q,p)}}var i,j,l;if("function"==typeof m.mapFun&&2===m.mapFun.length){var g=m.mapFun;l=function(p){return g(p,n)}}else{l=dI(m.mapFun.toString(),n,jJ,bc,Array.isArray,JSON.parse)}var h=m.seq||0,o=new db;return new aC(function(p,s){function r(){o.finish().then(function(){m.seq=h,p()})}function q(){function u(v){s(v)}m.sourceDB.changes({conflicts:!0,include_docs:!0,style:"all_docs",since:h,limit:am}).on("complete",function(x){var F=x.results;if(!F.length){return r()}for(var G={},C=0,A=F.length;A>C;C++){var v=F[C];if("_"!==v.doc._id[0]){i=[],j=v.doc,j._deleted||ep(m.sourceDB,l,[j]),i.sort(kd);for(var D,H={},z=0,y=i.length;y>z;z++){var B=i[z],E=[B.key,B.id];0===cF(B.key,D)&&E.push(z);var w=eT(E);H[w]=B,D=B.key}G[v.doc._id]={indexableKeysToKeyValues:H,changes:v.changes}}h=v.seq}return o.add(k(G,h)),F.length<am?r():q()}).on("error",u)}q()})}function jO(n,i,m){0===m.group_level&&delete m.group_level;var k,j=m.group||m.group_level;k=bT[n.reduceFun]?bT[n.reduceFun]:dI(n.reduceFun.toString(),null,jJ,bc,Array.isArray,JSON.parse);var l=[],p=isNaN(m.group_level)?Number.POSITIVE_INFINITY:m.group_level;i.forEach(function(r){var u=l[l.length-1],s=j?r.key:null;return j&&Array.isArray(s)&&(s=s.slice(0,p)),u&&0===cF(u.groupKey,s)?(u.keys.push([r.key,r.id]),void u.values.push(r.value)):void l.push({keys:[[r.key,r.id]],values:[r.value],groupKey:s})}),i=[];for(var h=0,o=l.length;o>h;h++){var g=l[h],q=ep(n.sourceDB,k,[g.keys,g.values,!1]);if(q.error&&q.error instanceof f5){throw q.error}i.push({value:q.error?null:q.output,key:g.groupKey})}return{rows:kb(i,m.limit,m.skip)}}function cS(h,g){return bJ(kh(h),function(){return ed(h,g)})()}function ed(r,s){function i(u){return u.include_docs=!0,r.db.allDocs(u).then(function(v){return h=v.total_rows,v.rows.map(function(x){if("value" in x.doc&&"object"==typeof x.doc.value&&null!==x.doc.value){var z=Object.keys(x.doc.value).sort(),y=["id","key","value"];if(!(y>z||z>y)){return x.doc.value}}var w=eb(x.doc._id);return{key:w[0],id:w[1],value:"value" in x.doc?x.doc.value:null}})})}function g(v){var u;if(u=k?jO(r,v,s):{total_rows:h,offset:p,rows:v},s.include_docs){var w=kj(v.map(dj));return r.sourceDB.allDocs({keys:w,include_docs:!0,conflicts:s.conflicts,attachments:s.attachments,binary:s.binary}).then(function(x){var y={};return x.rows.forEach(function(z){z.doc&&(y["$"+z.id]=z.doc)}),v.forEach(function(A){var B=dj(A),z=y["$"+B];z&&(A.doc=z)}),u})}return u}var h,k=r.reduceFun&&s.reduce!==!1,p=s.skip||0;if("undefined"==typeof s.keys||s.keys.length||(s.limit=0,delete s.keys),"undefined"!=typeof s.keys){var l=s.keys,q=l.map(function(v){var u={startkey:eT([v]),endkey:eT([v,{}])};return i(u)});return aC.all(q).then(kk).then(g)}var o={descending:s.descending};if(s.start_key&&(s.startkey=s.start_key),s.end_key&&(s.endkey=s.end_key),"undefined"!=typeof s.startkey&&(o.startkey=eT(s.descending?[s.startkey,{}]:[s.startkey])),"undefined"!=typeof s.endkey){var m=s.inclusive_end!==!1;s.descending&&(m=!m),o.endkey=eT(m?[s.endkey,{}]:[s.endkey])}if("undefined"!=typeof s.key){var j=eT([s.key]),n=eT([s.key,{}]);o.descending?(o.endkey=j,o.startkey=n):(o.startkey=j,o.endkey=n)}return k||("number"==typeof s.limit&&(o.limit=s.limit),o.skip=p),i(o).then(g)}function a8(g){return g.request({method:"POST",url:"_view_cleanup"})}function j7(g){return g.get("_local/mrviews").then(function(h){var j={};Object.keys(h.views).forEach(function(k){var m=f4(k),n="_design/"+m[0],l=m[1];j[n]=j[n]||{},j[n][l]=!0});var i={keys:Object.keys(j),include_docs:!0};return g.allDocs(i).then(function(k){var l={};k.rows.forEach(function(p){var o=p.key.substring(8);Object.keys(j[p.key]).forEach(function(u){var r=o+"/"+u;h.views[r]||(r=u);var q=Object.keys(h.views[r]),s=p.doc&&p.doc.views&&p.doc.views[u];q.forEach(function(v){l[v]=l[v]||s})})});var n=Object.keys(l).filter(function(o){return !l[o]}),m=n.map(function(o){return bJ(kh(o),function(){return new g.constructor(o,g.__opts).destroy()})()});return aC.all(m).then(function(){return{ok:!0}})})},cG({ok:!0}))}function bU(h,j,l){if("http"===h.type()){return cP(h,j,l)}if("function"==typeof h._query){return dd(h,j,l)}if("string"!=typeof j){fP(l,j);var i={db:h,viewName:"temp_view/temp_view",map:j.map,reduce:j.reduce,temporary:!0};return fL.add(function(){return ej(i).then(function(o){function p(){return o.db.destroy()}return fN(kc(o).then(function(){return cS(o,l)}),p)})}),fL.finish()}var n=j,k=f4(n),g=k[0],m=k[1];return h.getView(g,m).then(function(p){fP(l,p);var o={db:h,viewName:n,map:p.map,reduce:p.reduce};return ej(o).then(function(q){return"ok"===l.stale||"update_after"===l.stale?("update_after"===l.stale&&em.nextTick(function(){kc(q)}),cS(q,l)):kc(q).then(function(){return cS(q,l)})})})}function eg(h){this.status=400,this.name="query_parse_error",this.message=h,this.error=!0;try{Error.captureStackTrace(this,eg)}catch(g){}}function f5(h){this.status=500,this.name="invalid_value",this.message=h,this.error=!0;try{Error.captureStackTrace(this,f5)}catch(g){}}function dc(g){return bq(j6(g))}function e1(l,n,i){function g(o){try{return c7(o)}catch(q){var p=cM(dS,"Attachment is not a valid base64 string");return{error:p}}}function h(q,p){if(q.stub){return p()}if("string"==typeof q.data){var o=g(q.data);if(o.error){return p(o.error)}q.length=o.length,"blob"===n?q.data=cH(o,q.content_type):"base64"===n?q.data=bq(o):q.data=o,d4(o).then(function(r){q.digest="md5-"+r,p()})}else{b7(q.data,function(r){"binary"===n?q.data=j6(r):"base64"===n&&(q.data=dc(r)),d4(r).then(function(s){q.digest="md5-"+s,q.length=r.byteLength,p()})})}}function m(){j++,l.length===j&&(k?i(k):i())}if(!l.length){return i()}var k,j=0;l.forEach(function(r){function p(u){k=u,q++,q===s.length&&m()}var s=r.data&&r.data._attachments?Object.keys(r.data._attachments):[],q=0;if(!s.length){return m()}for(var o in r.data._attachments){r.data._attachments.hasOwnProperty(o)&&h(r.data._attachments[o],p)}})}function bj(h,g){return h.pos-g.pos}function bE(j,h,l){for(var i,k=0,g=j.length;g>k;){i=k+g>>>1,l(j[i],h)<0?k=i+1:g=i}return k}function e3(g,i,h){var j=bE(g,i,h);g.splice(j,0,i)}function bS(l,n){for(var i,g,h=n,m=l.length;m>h;h++){var k=l[h],j=[k.id,k.opts,[]];g?(g[2].push(j),g=j):i=g=j}return i}function eX(h,g){return h[0]<g[0]?-1:1}function cd(g,i){for(var m=[{tree1:g,tree2:i}],k=!1;m.length>0;){var l=m.pop(),o=l.tree1,h=l.tree2;(o[1].status||h[1].status)&&(o[1].status="available"===o[1].status||"available"===h[1].status?"available":"missing");for(var j=0;j<h[2].length;j++){if(o[2][0]){for(var p=!1,n=0;n<o[2].length;n++){o[2][n][0]===h[2][j][0]&&(m.push({tree1:o[2][n],tree2:h[2][j]}),p=!0)}p||(k="new_branch",e3(o[2],h[2][j],eX))}else{k="new_leaf",o[2][0]=h[2][j]}}}return{conflicts:k,tree:g}}function fK(n,A,m){var x,k=[],p=!1,y=!1;if(!n.length){return{tree:[A],conflicts:"new_leaf"}}for(var r=0,j=n.length;j>r;r++){var z=n[r];if(z.pos===A.pos&&z.ids[0]===A.ids[0]){x=cd(z.ids,A.ids),k.push({pos:z.pos,ids:x.tree}),p=p||x.conflicts,y=!0}else{if(m!==!0){var v=z.pos<A.pos?z:A,o=z.pos<A.pos?A:z,w=o.pos-v.pos,q=[],i=[];for(i.push({ids:v.ids,diff:w,parent:null,parentIdx:null});i.length>0;){var h=i.pop();if(0!==h.diff){for(var g=h.ids[2],s=0,u=g.length;u>s;s++){i.push({ids:g[s],diff:h.diff-1,parent:h.ids,parentIdx:s})}}else{h.ids[0]===o.ids[0]&&q.push(h)}}var l=q[0];l?(x=cd(l.ids,o.ids),l.parent[2][l.parentIdx]=x.tree,k.push({pos:v.pos,ids:v.ids}),p=p||x.conflicts,y=!0):k.push(z)}else{k.push(z)}}}return y||k.push(A),k.sort(bj),{tree:k,conflicts:p||"internal_node"}}function dH(r,s){for(var i,g=eL(r),h={},k=0,p=g.length;p>k;k++){for(var l=g[k],q=l.ids,o=Math.max(0,q.length-s),m={pos:l.pos+o,ids:bS(q,o)},j=0;o>j;j++){var n=l.pos+j+"-"+q[j].id;h[n]=!0}i=i?fK(i,m,!0).tree:[m]}return cY(i,function(u,w,v){delete h[w+"-"+v]}),{tree:i,revs:Object.keys(h)}}function cx(i,g,k){var h=fK(i,g),j=dH(h.tree,k);return{tree:j.tree,stemmedRevs:j.revs,conflicts:h.conflicts}}function dk(g,i){for(var m,k=g.slice(),l=i.split("-"),o=parseInt(l[0],10),h=l[1];m=k.pop();){if(m.pos===o&&m.ids[0]===h){return !0}for(var j=m.ids[2],p=0,n=j.length;n>p;p++){k.push({pos:m.pos+1,ids:j[p]})}}return !1}function b0(u,p,m,j,z,y,w,q){if(dk(p.rev_tree,m.metadata.rev)){return j[z]=m,y()}var k=p.winningRev||dL(p),v="deleted" in p?p.deleted:aT(p,k),r="deleted" in m.metadata?m.metadata.deleted:aT(m.metadata),h=/^1-/.test(m.metadata.rev);if(v&&!r&&q&&h){var s=m.data;s._rev=k,s._id=m.metadata.id,m=cg(s,q)}var A=cx(p.rev_tree,m.metadata.rev_tree[0],u),l=q&&(v&&r||!v&&"new_leaf"!==A.conflicts||v&&!r&&"new_branch"===A.conflicts);if(l){var i=cM(aA);return j[z]=i,y()}var n=m.metadata.rev;m.metadata.rev_tree=A.tree,m.stemmedRevs=A.stemmedRevs||[],p.rev_map&&(m.metadata.rev_map=p.rev_map);var B,g=dL(m.metadata),o=aT(m.metadata,g),x=v===o?0:o>v?-1:1;B=n===g?o:aT(m.metadata,n),w(m,g,o,B,!0,x,z,y)}function b3(g){return"missing"===g.metadata.rev_tree[0].ids[1].status}function aH(q,l,k,u,g,p,i,m,j){function h(B,x,C){var z=dL(B.metadata),w=aT(B.metadata,z);if("was_delete" in m&&w){return p[x]=cM(jY,"deleted"),C()}var D=o&&b3(B);if(D){var A=cM(aA);return p[x]=A,C()}var y=w?0:1;i(B,z,w,w,!1,y,x,C)}function r(){++n===s&&j&&j()}q=q||1000;var o=m.new_edits,v=new e4.Map,n=0,s=l.length;l.forEach(function(y,w){if(y._id&&jP(y._id)){var x=y._deleted?"_removeLocal":"_putLocal";return void k[x](y,{ctx:g},function(B,A){p[w]=B||A,r()})}var z=y.metadata.id;v.has(z)?(s--,v.get(z).push([y,w])):v.set(z,[[y,w]])}),v.forEach(function(x,z){function y(){++w<x.length?A():r()}function A(){var C=x[w],E=C[0],D=C[1];if(u.has(z)){b0(q,u.get(z),E,p,D,y,i,o)}else{var B=cx([],E.metadata.rev_tree[0],q);E.metadata.rev_tree=B.tree,E.stemmedRevs=B.stemmedRevs||[],h(E,D,y)}}var w=0;A()})}function dq(h){var g=[];return cY(h.rev_tree,function(l,i,k,m,j){"available"!==j.status||l||(g.push(i+"-"+k),j.status="missing")}),g}function cB(h){try{return JSON.parse(h)}catch(g){return b4.parse(h)}}function aV(g){return g.length<50000?JSON.parse(g):cB(g)}function dW(h){try{return JSON.stringify(h)}catch(g){return b4.stringify(h)}}function cD(i,g,k,h){try{i.apply(g,k)}catch(j){h.emit("error",j)}}function c4(h){if(!c1.running&&c1.queue.length){c1.running=!0;var g=c1.queue.shift();g.action(function(i,j){cD(g.callback,this,[i,j],h),c1.running=!1,em.nextTick(function(){c4(h)})})}}function j2(g){return function(h){var i="unknown_error";h.target&&h.target.error&&(i=h.target.error.name||h.target.error.message),g(cM(d6,i,h.type))}}function aR(i,h,g){return{data:dW(i),winningRev:h,deletedOrLocal:g?"1":"0",seq:i.seq,id:i.id}}function j1(h){if(!h){return null}var g=aV(h.data);return g.winningRev=h.winningRev,g.deleted="1"===h.deletedOrLocal,g.seq=h.seq,g}function da(h){if(!h){return h}var g=h._doc_id_rev.lastIndexOf(":");return h._id=h._doc_id_rev.substring(0,g-1),h._rev=h._doc_id_rev.substring(g+1),delete h._doc_id_rev,h}function f3(g,i,h,j){h?j(g?"string"!=typeof g?g:d5(g,i):d2([""],{type:i})):g?"string"!=typeof g?cJ(g,function(k){j(bq(k))}):j(g):j("")}function dQ(l,n,i,g){function h(){++j===k.length&&g&&g()}function m(s,q){var r=s._attachments[q],p=r.digest,o=i.objectStore(dV).get(p);o.onsuccess=function(u){r.body=u.target.result.body,h()}}var k=Object.keys(l._attachments||{});if(!k.length){return g&&g()}var j=0;k.forEach(function(o){n.attachments&&n.include_docs?m(l,o):(l._attachments[o].stub=!0,h())})}function d8(h,g){return aC.all(h.map(function(i){if(i.doc&&i.doc._attachments){var j=Object.keys(i.doc._attachments);return aC.all(j.map(function(l){var n=i.doc._attachments[l];if("body" in n){var k=n.body,m=n.content_type;return new aC(function(o){f3(k,m,g,function(p){i.doc._attachments[l]=bL.extend(d1(n,["digest","content_type"]),{data:p}),o()})})}}))}}))}function cq(g,i,m){function k(){n--,n||l()}function l(){o.length&&o.forEach(function(q){var r=p.index("digestSeq").count(IDBKeyRange.bound(q+"::",q+"::￿",!1,!1));r.onsuccess=function(s){var u=s.target.result;u||j["delete"](q)}})}var o=[],h=m.objectStore(jF),j=m.objectStore(dV),p=m.objectStore(bF),n=g.length;g.forEach(function(s){var r=h.index("_doc_id_rev"),q=i+"::"+s;r.getKey(q).onsuccess=function(w){var v=w.target.result;if("number"!=typeof v){return k()}h["delete"](v);var u=p.index("seq").openCursor(IDBKeyRange.only(v));u.onsuccess=function(y){var x=y.target.result;if(x){var z=x.value.digestSeq.split("::")[0];o.push(z),p["delete"](x.primaryKey),x["continue"]()}else{k()}}}})}function fD(g,i,h){try{return{txn:g.transaction(i,h)}}catch(j){return{error:j}}}function dA(h,E,G,L,m,z,M){function B(){var Q=[cO,jF,dV,jQ,bF],P=fD(m,Q,"readwrite");return P.error?M(P.error):(I=P.txn,I.onabort=j2(M),I.ontimeout=j2(M),I.oncomplete=g,o=I.objectStore(cO),y=I.objectStore(jF),H=I.objectStore(dV),p=I.objectStore(bF),void i(function(R){return R?(j=!0,M(R)):void A()}))}function q(){aH(h.revs_limit,v,L,l,I,n,K,G)}function A(){function V(){++Q===v.length&&q()}function T(W){var X=j1(W.target.result);X&&l.set(X.id,X),V()}if(v.length){for(var Q=0,U=0,P=v.length;P>U;U++){var S=v[U];if(S._id&&jP(S._id)){V()}else{var R=o.get(S.metadata.id);R.onsuccess=T}}}}function g(){j||(z.notify(L._meta.name),L._meta.docCount+=C,M(null,n))}function O(Q,P){var R=H.get(Q);R.onsuccess=function(T){if(T.target.result){P()}else{var S=cM(c2,"unknown stub attachment with digest "+Q);S.status=412,P(S)}}}function i(R){function P(){++S===T.length&&R(Q)}var T=[];if(v.forEach(function(U){U.data&&U.data._attachments&&Object.keys(U.data._attachments).forEach(function(W){var V=U.data._attachments[W];V.stub&&T.push(V.digest)})}),!T.length){return R()}var Q,S=0;T.forEach(function(U){O(U,function(V){V&&!Q&&(Q=V),P()})})}function K(V,P,T,R,S,U,X,Q){C+=U,V.metadata.winningRev=P,V.metadata.deleted=T;var Y=V.data;Y._id=V.metadata.id,Y._rev=V.metadata.rev,R&&(Y._deleted=!0);var W=Y._attachments&&Object.keys(Y._attachments).length;return W?w(V,P,T,S,X,Q):void N(V,P,T,S,X,Q)}function s(Q){var P=dq(Q.metadata);cq(P,Q.metadata.id,I)}function N(V,ae,R,Q,T,Y){function P(ai){Q&&L.auto_compaction?s(V):V.stemmedRevs.length&&cq(V.stemmedRevs,V.metadata.id,I),S.seq=ai.target.result,delete S.rev;var ao=aR(S,ae,R),an=o.put(ao);an.onsuccess=X}function Z(ao){ao.preventDefault(),ao.stopPropagation();var an=y.index("_doc_id_rev"),ai=an.getKey(U._doc_id_rev);ai.onsuccess=function(at){var ar=y.put(U,at.target.result);ar.onsuccess=P}}function X(){n[T]={ok:!0,id:S.id,rev:ae},l.set(V.metadata.id,V.metadata),F(V,S.seq,Y)}var U=V.data,S=V.metadata;U._doc_id_rev=S.id+"::"+S.rev,delete U._id,delete U._rev;var W=y.put(U);W.onsuccess=P,W.onerror=Z}function w(X,Q,U,S,T,V){function Z(){Y===W.length&&N(X,Q,U,S,T,V)}function R(){Y++,Z()}var P=X.data,Y=0,W=Object.keys(P._attachments);W.forEach(function(ai){var ao=X.data._attachments[ai];if(ao.stub){Y++,Z()}else{var ae=ao.data;delete ao.data,ao.revpos=parseInt(Q,10);var an=ao.digest;x(an,ae,R)}})}function F(Q,V,S){function P(){++U===T.length&&S()}function R(Z){var Y=Q.data._attachments[Z].digest,X=p.put({seq:V,digestSeq:Y+"::"+V});X.onsuccess=P,X.onerror=function(ae){ae.preventDefault(),ae.stopPropagation(),P()}}var U=0,T=Object.keys(Q.data._attachments||{});if(!T.length){return S()}for(var W=0;W<T.length;W++){R(T[W])}}function x(R,P,S){var Q=H.count(R);Q.onsuccess=function(U){var V=U.target.result;if(V){return S()}var T={digest:R,body:P},W=H.put(T);W.onsuccess=S}}for(var I,o,y,H,p,D,v=E.docs,C=0,r=0,J=v.length;J>r;r++){var k=v[r];k._id&&jP(k._id)||(k=v[r]=cg(k,G.new_edits),k.error&&!D&&(D=k))}if(D){return M(D)}var n=new Array(v.length),l=new e4.Map,j=!1,u=L._meta.blobSupport?"blob":"base64";e1(v,u,function(P){return P?M(P):void B()})}function bx(j,h,l,i,k){try{if(j&&h){return k?IDBKeyRange.bound(h,j,!l,!1):IDBKeyRange.bound(j,h,!1,!l)}if(j){return k?IDBKeyRange.upperBound(j):IDBKeyRange.lowerBound(j)}if(h){return k?IDBKeyRange.lowerBound(h,!l):IDBKeyRange.upperBound(h,!l)}if(i){return IDBKeyRange.only(i)}}catch(g){return{error:g}}return null}function ec(g,i,h,j){return"DataError"===h.name&&0===h.code?j(null,{total_rows:g._meta.docCount,offset:i.skip,rows:[]}):void j(cM(d6,h.name,h.message))}function jT(j,h,l,i){function k(u,I){function C(M,N,O){var L=M.id+"::"+O;m.get(L).onsuccess=function(P){N.doc=da(P.target.result),u.conflicts&&(N.doc._conflicts=fF(M)),dQ(N.doc,u,F)}}function v(O,L,P){var N={id:P.id,key:P.id,value:{rev:L}},M=P.deleted;if("ok"===u.deleted){K.push(N),M?(N.value.deleted=!0,N.doc=null):u.include_docs&&C(P,N,L)}else{if(!M&&q--<=0&&(K.push(N),u.include_docs&&C(P,N,L),0===--y)){return}}O["continue"]()}function E(O){n=h._meta.docCount;var N=O.target.result;if(N){var M=j1(N.value),L=M.winningRev;v(N,L,M)}}function x(){I(null,{total_rows:n,offset:u.skip,rows:K})}function s(){u.attachments?d8(K,u.binary).then(x):x()}var B="startkey" in u?u.startkey:!1,z="endkey" in u?u.endkey:!1,p="key" in u?u.key:!1,q=u.skip||0,y="number"==typeof u.limit?u.limit:-1,A=u.inclusive_end!==!1,H="descending" in u&&u.descending?"prev":null,J=bx(B,z,A,p,H);if(J&&J.error){return ec(h,u,J.error,I)}var o=[cO,jF];u.attachments&&o.push(dV);var r=fD(l,o,"readonly");if(r.error){return I(r.error)}var F=r.txn,w=F.objectStore(cO),G=F.objectStore(jF),D=H?w.openCursor(J,H):w.openCursor(J),m=G.index("_doc_id_rev"),K=[],n=0;F.oncomplete=s,D.onsuccess=E}function g(m,n){return 0===m.limit?n(null,{total_rows:h._meta.docCount,offset:m.skip,rows:[]}):void k(m,n)}g(j,i)}function bB(g){return new aC(function(h){var i=d2([""]);g.objectStore(cI).put(i,"key"),g.onabort=function(j){j.preventDefault(),j.stopPropagation(),h(!1)},g.oncomplete=function(){var j=navigator.userAgent.match(/Chrome\/(\d+)/),k=navigator.userAgent.match(/Edge\//);h(k||!j||parseInt(j[1],10)>=43)}})["catch"](function(){return !1})}function jU(g){bH()?chrome.storage.onChanged.addListener(function(h){null!=h.db_name&&g.emit(h.dbName.newValue)}):e6()&&("undefined"!=typeof addEventListener?addEventListener("storage",function(h){g.emit(h.key)}):window.attachEvent("storage",function(h){g.emit(h.key)}))}function ab(){aE.EventEmitter.call(this),this._listeners={},jU(this)}function b6(i,h){var g=this;c1.queue.push({action:function(j){ap(g,i,j)},callback:h}),c4(g.constructor)}function ap(j,g,m){function o(w){var v=w.createObjectStore(cO,{keyPath:"id"});w.createObjectStore(jF,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),w.createObjectStore(dV,{keyPath:"digest"}),w.createObjectStore(cL,{keyPath:"id",autoIncrement:!1}),w.createObjectStore(cI),v.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),w.createObjectStore(jQ,{keyPath:"_id"});var x=w.createObjectStore(bF,{autoIncrement:!0});x.createIndex("seq","seq"),x.createIndex("digestSeq","digestSeq",{unique:!0})}function q(w,v){var x=w.objectStore(cO);x.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),x.openCursor().onsuccess=function(B){var z=B.target.result;if(z){var A=z.value,y=aT(A);A.deletedOrLocal=y?"1":"0",x.put(A),z["continue"]()}else{v()}}}function s(v){v.createObjectStore(jQ,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}function u(v,y){var w=v.objectStore(jQ),z=v.objectStore(cO),x=v.objectStore(jF),A=z.openCursor();A.onsuccess=function(F){var C=F.target.result;if(C){var J=C.value,L=J.id,K=jP(L),H=dL(J);if(K){var E=L+"::"+H,B=L+"::",G=L+"::~",D=x.index("_doc_id_rev"),M=IDBKeyRange.bound(B,G,!1,!1),I=D.openCursor(M);I.onsuccess=function(N){if(I=N.target.result){var O=I.value;O._doc_id_rev===E&&w.put(O),x["delete"](I.primaryKey),I["continue"]()}else{z["delete"](C.primaryKey),C["continue"]()}}}else{C["continue"]()}}else{y&&y()}}}function p(w){var v=w.createObjectStore(bF,{autoIncrement:!0});v.createIndex("seq","seq"),v.createIndex("digestSeq","digestSeq",{unique:!0})}function i(v,y){var w=v.objectStore(jF),z=v.objectStore(dV),x=v.objectStore(bF),A=z.count();A.onsuccess=function(B){var C=B.target.result;return C?void (w.openCursor().onsuccess=function(J){var F=J.target.result;if(!F){return y()}for(var E=F.value,H=F.primaryKey,L=Object.keys(E._attachments||{}),D={},M=0;M<L.length;M++){var K=E._attachments[L[M]];D[K.digest]=!0}var I=Object.keys(D);for(M=0;M<I.length;M++){var G=I[M];x.put({seq:H,digestSeq:G+"::"+H})}F["continue"]()}):y()}}function k(x){function z(A){return A.data?j1(A):(A.deleted="1"===A.deletedOrLocal,A)}var v=x.objectStore(jF),w=x.objectStore(cO),y=w.openCursor();y.onsuccess=function(C){function D(){var H=B.id+"::",F=B.id+"::￿",G=v.index("_doc_id_rev").openCursor(IDBKeyRange.bound(H,F)),I=0;G.onsuccess=function(K){var J=K.target.result;if(!J){return B.seq=I,A()}var L=J.primaryKey;L>I&&(I=L),J["continue"]()}}function A(){var G=aR(B,B.winningRev,B.deleted),F=w.put(G);F.onsuccess=function(){E["continue"]()}}var E=C.target.result;if(E){var B=z(E.value);return B.winningRev=B.winningRev||dL(B),B.seq?A():void D()}}}var h=g.name,n=null;j._meta=null,j.type=function(){return"idb"},j._id=aq(function(v){v(null,j._meta.instanceId)}),j._bulkDocs=function(x,v,w){dA(g,x,v,j,n,j5,w)},j._get=function(z,C,y){function w(){y(A,{doc:x,metadata:v,ctx:D})}var x,v,A,D=C.ctx;if(!D){var B=fD(n,[cO,jF,dV],"readonly");if(B.error){return y(B.error)}D=B.txn}D.objectStore(cO).get(z).onsuccess=function(E){if(v=j1(E.target.result),!v){return A=cM(jY,"missing"),w()}if(aT(v)&&!C.rev){return A=cM(jY,"deleted"),w()}var G=D.objectStore(jF),H=C.rev||v.winningRev,F=v.id+"::"+H;G.index("_doc_id_rev").get(F).onsuccess=function(I){return x=I.target.result,x&&(x=da(x)),x?void w():(A=cM(jY,"missing"),w())}}},j._getAttachment=function(A,y,z){var v;if(y.ctx){v=y.ctx}else{var x=fD(n,[cO,jF,dV],"readonly");if(x.error){return z(x.error)}v=x.txn}var B=A.digest,w=A.content_type;v.objectStore(dV).get(B).onsuccess=function(C){var D=C.target.result.body;f3(D,w,y.binary,function(E){z(null,E)})}},j._info=function(y){if(null===n||!cz.has(h)){var A=new Error("db isn't open");return A.id="idbNull",y(A)}var v,z,B=fD(n,[jF],"readonly");if(B.error){return y(B.error)}var w=B.txn,x=w.objectStore(jF).openCursor(null,"prev");x.onsuccess=function(D){var C=D.target.result;v=C?C.key:0,z=j._meta.docCount},w.oncomplete=function(){y(null,{doc_count:z,update_seq:v,idb_attachment_format:j._meta.blobSupport?"binary":"base64"})}},j._allDocs=function(v,w){jT(v,j,n,w)},j._changes=function(C){function w(N){function S(){return R.seq!==T?N["continue"]():(v=T,R.winningRev===O._rev?Q(O):void P())}function P(){var U=O._id+"::"+R.winningRev,V=B.get(U);V.onsuccess=function(W){Q(da(W.target.result))}}function Q(V){var W=C.processChange(V,R,C);W.seq=R.seq;var U=A(W);return"object"==typeof U?C.complete(U):(U&&(x++,L&&D.push(W),C.attachments&&C.include_docs?dQ(V,C,F,function(){d8([W],C.binary).then(function(){C.onChange(W)})}):C.onChange(W)),void (x!==J&&N["continue"]()))}var O=da(N.value),T=N.key;if(E&&!E.has(O._id)){return N["continue"]()}var R;return(R=y.get(O._id))?S():void (G.get(O._id).onsuccess=function(U){R=j1(U.target.result),y.set(O._id,R),S()})}function I(O){var N=O.target.result;N&&w(N)}function M(){var O=[cO,jF];C.attachments&&O.push(dV);var N=fD(n,O,"readonly");if(N.error){return C.complete(N.error)}F=N.txn,F.onabort=j2(C.complete),F.oncomplete=H,z=F.objectStore(jF),G=F.objectStore(cO),B=z.index("_doc_id_rev");var P;P=C.descending?z.openCursor(null,"prev"):z.openCursor(IDBKeyRange.lowerBound(C.since,!0)),P.onsuccess=I}function H(){function N(){C.complete(null,{results:D,last_seq:v})}!C.continuous&&C.attachments?d8(D).then(N):N()}if(C=bO(C),C.continuous){var K=h+":"+bN();return j5.addListener(h,K,j,C),j5.notify(h),{cancel:function(){j5.removeListener(h,K)}}}var E=C.doc_ids&&new e4.Set(C.doc_ids);C.since=C.since||0;var v=C.since,J="limit" in C?C.limit:-1;0===J&&(J=1);var L;L="return_docs" in C?C.return_docs:"returnDocs" in C?C.returnDocs:!0;var F,z,G,B,D=[],x=0,A=kf(C),y=new e4.Map;M()},j._close=function(v){return null===n?v(cM(dy)):(n.close(),cz["delete"](h),n=null,void v())},j._getRevisionTree=function(x,z){var v=fD(n,[cO],"readonly");if(v.error){return z(v.error)}var w=v.txn,y=w.objectStore(cO).get(x);y.onsuccess=function(B){var A=j1(B.target.result);A?z(null,A.rev_tree):z(cM(jY))}},j._doCompaction=function(A,y,z){var v=[cO,jF,dV,bF],x=fD(n,v,"readwrite");if(x.error){return z(x.error)}var B=x.txn,w=B.objectStore(cO);w.get(A).onsuccess=function(E){var C=j1(E.target.result);cY(C.rev_tree,function(L,H,K,G,J){var I=H+"-"+K;-1!==y.indexOf(I)&&(J.status="missing")}),cq(y,A,B);var D=C.winningRev,F=C.deleted;B.objectStore(cO).put(aR(C,D,F))},B.onabort=j2(z),B.oncomplete=function(){z()}},j._getLocal=function(x,z){var v=fD(n,[jQ],"readonly");if(v.error){return z(v.error)}var w=v.txn,y=w.objectStore(jQ).get(x);y.onerror=j2(z),y.onsuccess=function(B){var A=B.target.result;A?(delete A._doc_id_rev,z(null,A)):z(cM(jY))}},j._putLocal=function(E,y,D){"function"==typeof y&&(D=y,y={}),delete E._revisions;var B=E._rev,C=E._id;B?E._rev="0-"+(parseInt(B.split("-")[1],10)+1):E._rev="0-1";var A,w=y.ctx;if(!w){var z=fD(n,[jQ],"readwrite");if(z.error){return D(z.error)}w=z.txn,w.onerror=j2(D),w.oncomplete=function(){A&&D(null,A)}}var x,v=w.objectStore(jQ);B?(x=v.get(C),x.onsuccess=function(H){var G=H.target.result;if(G&&G._rev===B){var F=v.put(E);F.onsuccess=function(){A={ok:!0,id:E._id,rev:E._rev},y.ctx&&D(null,A)}}else{D(cM(aA))}}):(x=v.add(E),x.onerror=function(F){D(cM(aA)),F.preventDefault(),F.stopPropagation()},x.onsuccess=function(){A={ok:!0,id:E._id,rev:E._rev},y.ctx&&D(null,A)})},j._removeLocal=function(z,C,y){"function"==typeof C&&(y=C,C={});var w=C.ctx;if(!w){var x=fD(n,[jQ],"readwrite");if(x.error){return y(x.error)}w=x.txn,w.oncomplete=function(){v&&y(null,v)}}var v,A=z._id,D=w.objectStore(jQ),B=D.get(A);B.onerror=j2(y),B.onsuccess=function(F){var E=F.target.result;E&&E._rev===z._rev?(D["delete"](A),v={ok:!0,id:A,rev:"0-0"},C.ctx&&y(null,v)):y(cM(jY))}},j._destroy=function(v,x){j5.removeAllListeners(h);var w=ak.get(h);w&&w.result&&(w.result.close(),cz["delete"](h));var y=indexedDB.deleteDatabase(h);y.onsuccess=function(){ak["delete"](h),e6()&&h in localStorage&&delete localStorage[h],x(null,{ok:!0})},y.onerror=j2(x)};var l=cz.get(h);if(l){return n=l.idb,j._meta=l.global,void em.nextTick(function(){m(null,j)})}var r;r=g.storage?aG(h,g.storage):indexedDB.open(h,eF),ak.set(h,r),r.onupgradeneeded=function(y){function x(){var B=z[A-1];A++,B&&B(w,x)}var v=y.target.result;if(y.oldVersion<1){return o(v)}var w=y.currentTarget.transaction;y.oldVersion<3&&s(v),y.oldVersion<4&&p(v);var z=[q,u,i,k],A=y.oldVersion;x()},r.onsuccess=function(z){n=z.target.result,n.onversionchange=function(){n.close(),cz["delete"](h)},n.onabort=function(B){console.error("Database has a global failure",B.target.error),n.close(),cz["delete"](h)};var y=n.transaction([cL,cI,cO],"readwrite"),x=y.objectStore(cL).get(cL),v=null,w=null,A=null;x.onsuccess=function(D){var B=function(){null!==v&&null!==w&&null!==A&&(j._meta={name:h,instanceId:A,blobSupport:v,docCount:w},cz.set(h,{idb:n,global:j._meta}),m(null,j))},E=D.target.result||{id:cL};h+"_id" in E?(A=E[h+"_id"],B()):(A=bN(),E[h+"_id"]=A,y.objectStore(cL).put(E).onsuccess=function(){B()}),e8||(e8=bB(y)),e8.then(function(F){v=F,B()});var C=y.objectStore(cO).index("deletedOrLocal");C.count(IDBKeyRange.only("0")).onsuccess=function(F){w=F.target.result,B()}}},r.onerror=function(){var v="Failed to open indexedDB, are you in private browsing mode?";console.error(v),m(cM(d6,v))}}function aG(i,h){try{return indexedDB.open(i,{version:eF,storage:h})}catch(g){return indexedDB.open(i,eF)}}function eh(g){return decodeURIComponent(window.escape(g))}function bC(g){return 65>g?g-48:g-55}function j8(g,i,h){for(var j="";h>i;){j+=String.fromCharCode(bC(g.charCodeAt(i++))<<4|bC(g.charCodeAt(i++)))}return j}function ag(g,i,h){for(var j="";h>i;){j+=String.fromCharCode(bC(g.charCodeAt(i+2))<<12|bC(g.charCodeAt(i+3))<<8|bC(g.charCodeAt(i))<<4|bC(g.charCodeAt(i+1))),i+=4}return j}function e(h,g){return"UTF-8"===g?eh(j8(h,0,h.length)):ag(h,0,h.length)}function fA(g){return"'"+g+"'"}function aB(){return"undefined"!=typeof sqlitePlugin?sqlitePlugin.openDatabase.bind(sqlitePlugin):"undefined"!=typeof openDatabase?function(g){return openDatabase(g.name,g.version,g.description,g.size)}:void 0}function cE(){return"undefined"!=typeof openDatabase||"undefined"!=typeof SQLitePlugin}function cT(g){return g.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"")}function eB(g){return g.replace(/\u0001\u0001/g,"\x00").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,"")}function aO(g){return delete g._id,delete g._rev,JSON.stringify(g)}function eC(i,h,g){return i=JSON.parse(i),i._id=h,i._rev=g,i}function aa(h){for(var g="(";h--;){g+="?",h&&(g+=",")}return g+")"}function jW(i,g,k,h,j){return"SELECT "+i+" FROM "+("string"==typeof g?g:g.join(" JOIN "))+(k?" ON "+k:"")+(h?" WHERE "+("string"==typeof h?h:h.join(" AND ")):"")+(j?" ORDER BY "+j:"")}function bs(l,j,g){function k(){++i===l.length&&m()}function m(){if(h.length){var n="SELECT DISTINCT digest AS digest FROM "+jK+" WHERE seq IN "+aa(h.length);g.executeSql(n,h,function(q,o){for(var s=[],p=0;p<o.rows.length;p++){s.push(o.rows.item(p).digest)}if(s.length){var r="DELETE FROM "+jK+" WHERE seq IN ("+h.map(function(){return"?"}).join(",")+")";q.executeSql(r,h,function(v){var u="SELECT digest FROM "+jK+" WHERE digest IN ("+s.map(function(){return"?"}).join(",")+")";v.executeSql(u,s,function(z,w){for(var y=new e4.Set,x=0;x<w.rows.length;x++){y.add(w.rows.item(x).digest)}s.forEach(function(A){y.has(A)||(z.executeSql("DELETE FROM "+jK+" WHERE digest=?",[A]),z.executeSql("DELETE FROM "+bV+" WHERE digest=?",[A]))})})})}})}}if(l.length){var i=0,h=[];l.forEach(function(o){var n="SELECT seq FROM "+d9+" WHERE doc_id=? AND rev=?";g.executeSql(n,[j,o],function(q,p){if(!p.rows.length){return k()}var r=p.rows.item(0).seq;h.push(r),q.executeSql("DELETE FROM "+d9+" WHERE seq=?",[r],k)})})}}function c0(g){return function(h){console.error("WebSQL threw an error",h);var k=h&&h.constructor.toString().match(/function ([^\(]+)/),i=k&&k[1]||h.type,j=h.target||h.message;g(cM(au,j,i))}}function jS(h){if("size" in h){return 1000000*h.size}var g="undefined"!=typeof navigator&&/Android/.test(navigator.userAgent);return g?5000000:1}function ke(i,h){try{return{db:i(h)}}catch(g){return{error:g}}}function e7(i){var h=bv.get(i.name);if(!h){var g=aB();h=ke(g,i),bv.set(i.name,h),h.db&&(h.db._sqlitePlugin="undefined"!=typeof sqlitePlugin)}return h}function eK(x,s,n,k,m,B,q){function i(){return w?q(w):(B.notify(k._name),k._docCount=-1,void q(null,r))}function j(E,D){var F="SELECT count(*) as cnt FROM "+bV+" WHERE digest=?";p.executeSql(F,[E],function(G,H){if(0===H.rows.item(0).cnt){var I=cM(c2,"unknown stub attachment with digest "+E);D(I)}else{D()}})}function y(F){function D(){++G===H.length&&F(E)}var H=[];if(o.forEach(function(I){I.data&&I.data._attachments&&Object.keys(I.data._attachments).forEach(function(J){var K=I.data._attachments[J];K.stub&&H.push(K.digest)})}),!H.length){return F()}var E,G=0;H.forEach(function(I){j(I,function(J){J&&!E&&(E=J),D()})})}function h(E,M,H,R,P,J,O,L){function G(){function W(ar,at){function a0(){return ++ao===an.length&&at(),!1}function ai(a2){var a3="INSERT INTO "+jK+" (digest, seq) VALUES (?,?)",a1=[V._attachments[a2].digest,ar];p.executeSql(a3,a1,a0,a0)}var ao=0,an=Object.keys(V._attachments||{});if(!an.length){return at()}for(var ae=0;ae<an.length;ae++){ai(an[ae])}}var V=E.data,Y=R?1:0,T=V._id,X=V._rev,Z=aO(V),S="INSERT INTO "+d9+" (doc_id, rev, json, deleted) VALUES (?, ?, ?, ?);",U=[T,X,Z,Y];p.executeSql(S,U,function(ai,ae){var an=ae.insertId;W(an,function(){F(ai,an)})},function(){var ae=jW("seq",d9,null,"doc_id=? AND rev=?");return p.executeSql(ae,[T,X],function(ao,ar){var ai=ar.rows.item(0).seq,an="UPDATE "+d9+" SET json=?, deleted=? WHERE doc_id=? AND rev=?;",at=[Z,Y,T,X];ao.executeSql(an,at,function(a0){W(ai,function(){F(a0,ai)})})}),!1})}function D(S){Q||(S?(Q=S,L(Q)):K===I.length&&G())}function N(S){K++,D(S)}function F(X,V){var S=E.metadata.id;P&&k.auto_compaction?bs(dq(E.metadata),S,X):E.stemmedRevs.length&&bs(E.stemmedRevs,S,X),E.metadata.seq=V,delete E.metadata.rev;var W=P?"UPDATE "+bi+" SET json=?, max_seq=?, winningseq=(SELECT seq FROM "+d9+" WHERE doc_id="+bi+".id AND rev=?) WHERE id=?":"INSERT INTO "+bi+" (id, winningseq, max_seq, json) VALUES (?,?,?,?);",T=dW(E.metadata),U=P?[T,V,M,S]:[S,V,V,T];X.executeSql(W,U,function(){r[O]={ok:!0,id:E.metadata.id,rev:M},A.set(S,E.metadata),L()})}var Q=null,K=0;E.data._id=E.metadata.id,E.data._rev=E.metadata.rev;var I=Object.keys(E.data._attachments||{});R&&(E.data._deleted=!0),I.forEach(function(U){var S=E.data._attachments[U];if(S.stub){K++,D()}else{var T=S.data;delete S.data,S.revpos=parseInt(M,10);var V=S.digest;u(V,T,N)}}),I.length||G()}function l(){aH(x.revs_limit,o,k,A,p,r,h,n)}function g(E){function D(){++F===o.length&&E()}if(!o.length){return E()}var F=0;o.forEach(function(G){if(G._id&&jP(G._id)){return D()}var H=G.metadata.id;p.executeSql("SELECT json FROM "+bi+" WHERE id = ?",[H],function(K,J){if(J.rows.length){var I=aV(J.rows.item(0).json);A.set(H,I)}D()})})}function u(F,D,G){var E="SELECT digest FROM "+bV+" WHERE digest=?";p.executeSql(E,[F],function(H,I){return I.rows.length?G():(E="INSERT INTO "+bV+" (digest, body, escaped) VALUES (?,?,1)",void H.executeSql(E,[F,cT(D)],function(){G()},function(){return G(),!1}))})}var C=n.new_edits,v=s.docs,o=v.map(function(E){if(E._id&&jP(E._id)){return E}var D=cg(E,C);return D}),z=o.filter(function(D){return D.error});if(z.length){return q(z[0])}var p,w,r=new Array(o.length),A=new e4.Map;e1(o,"binary",function(D){return D?q(D):void m.transaction(function(E){p=E,y(function(F){F?w=F:g(l)})},c0(q),i)})}function bk(k,g,l,j,i){function n(){++m===o.length&&i&&i()}function h(r,s){var q=r._attachments[s],p={binary:g.binary,ctx:j};l._getAttachment(q,p,function(u,v){r._attachments[s]=bL.extend(d1(q,["digest","content_type"]),{data:v}),n()})}var o=Object.keys(k._attachments||{});if(!o.length){return i&&i()}var m=0;o.forEach(function(p){g.attachments&&g.include_docs?h(k,p):(k._attachments[p].stub=!0,n())})}function cm(x,n){function q(){e6()&&(window.localStorage["_pouch__websqldb_"+j._name]=!0),n(null,j)}function g(F,E){F.executeSql(cs),F.executeSql("ALTER TABLE "+d9+" ADD COLUMN deleted TINYINT(1) DEFAULT 0",[],function(){F.executeSql(b9),F.executeSql("ALTER TABLE "+bi+" ADD COLUMN local TINYINT(1) DEFAULT 0",[],function(){F.executeSql("CREATE INDEX IF NOT EXISTS 'doc-store-local-idx' ON "+bi+" (local, id)");var G="SELECT "+bi+".winningseq AS seq, "+bi+".json AS metadata FROM "+d9+" JOIN "+bi+" ON "+d9+".seq = "+bi+".winningseq";F.executeSql(G,[],function(M,I){for(var L=[],O=[],H=0;H<I.rows.length;H++){var J=I.rows.item(H),K=J.seq,N=JSON.parse(J.metadata);aT(N)&&L.push(K),jP(N.id)&&O.push(N.id)}M.executeSql("UPDATE "+bi+"SET local = 1 WHERE id IN "+aa(O.length),O,function(){M.executeSql("UPDATE "+d9+" SET deleted = 1 WHERE seq IN "+aa(L.length),L,E)})})})})}function r(F,E){var G="CREATE TABLE IF NOT EXISTS "+c9+" (id UNIQUE, rev, json)";F.executeSql(G,[],function(){var H="SELECT "+bi+".id AS id, "+d9+".json AS data FROM "+d9+" JOIN "+bi+" ON "+d9+".seq = "+bi+".winningseq WHERE local = 1";F.executeSql(H,[],function(I,K){function M(){if(!J.length){return E(I)}var O=J.shift(),N=JSON.parse(O.data)._rev;I.executeSql("INSERT INTO "+c9+" (id, rev, json) VALUES (?,?,?)",[O.id,N,O.data],function(P){P.executeSql("DELETE FROM "+bi+" WHERE id=?",[O.id],function(Q){Q.executeSql("DELETE FROM "+d9+" WHERE seq=?",[O.seq],function(){M()})})})}for(var J=[],L=0;L<K.rows.length;L++){J.push(K.rows.item(L))}M()})})}function s(G,E){function H(I){function J(){if(!I.length){return E(G)}var O=I.shift(),M=e(O.hex,C),K=M.lastIndexOf("::"),N=M.substring(0,K),L=M.substring(K+2),P="UPDATE "+d9+" SET doc_id=?, rev=? WHERE doc_id_rev=?";G.executeSql(P,[N,L,M],function(){J()})}J()}var F="ALTER TABLE "+d9+" ADD COLUMN doc_id";G.executeSql(F,[],function(I){var J="ALTER TABLE "+d9+" ADD COLUMN rev";I.executeSql(J,[],function(K){K.executeSql(j0,[],function(L){var M="SELECT hex(doc_id_rev) as hex FROM "+d9;L.executeSql(M,[],function(P,N){for(var O=[],Q=0;Q<N.rows.length;Q++){O.push(N.rows.item(Q))}H(O)})})})})}function v(G,E){function H(J){var I="SELECT COUNT(*) AS cnt FROM "+bV;J.executeSql(I,[],function(N,P){function M(){var Q=jW(f2+", "+bi+".id AS id",[bi,d9],bb,null,bi+".id ");Q+=" LIMIT "+K+" OFFSET "+L,L+=K,N.executeSql(Q,[],function(ai,U){function X(at,ar){var ao=W[at]=W[at]||[];-1===ao.indexOf(ar)&&ao.push(ar)}if(!U.rows.length){return E(ai)}for(var W={},R=0;R<U.rows.length;R++){for(var T=U.rows.item(R),S=eC(T.data,T.id,T.rev),Z=Object.keys(S._attachments||{}),an=0;an<Z.length;an++){var V=S._attachments[Z[an]];X(V.digest,T.seq)}}var ae=[];if(Object.keys(W).forEach(function(ar){var ao=W[ar];ao.forEach(function(at){ae.push([ar,at])})}),!ae.length){return M()}var Y=0;ae.forEach(function(ao){var ar="INSERT INTO "+jK+" (digest, seq) VALUES (?,?)";ai.executeSql(ar,ao,function(){++Y===ae.length&&M()})})})}var O=P.rows.item(0).cnt;if(!O){return E(N)}var L=0,K=10;M()})}var F="CREATE TABLE IF NOT EXISTS "+jK+" (digest, seq INTEGER)";G.executeSql(F,[],function(I){I.executeSql(cR,[],function(J){J.executeSql(aD,[],H)})})}function o(F,E){var G="ALTER TABLE "+bV+" ADD COLUMN escaped TINYINT(1) DEFAULT 0";F.executeSql(G,[],E)}function D(F,E){var G="ALTER TABLE "+bi+" ADD COLUMN max_seq INTEGER";F.executeSql(G,[],function(H){var I="UPDATE "+bi+" SET max_seq=(SELECT MAX(seq) FROM "+d9+" WHERE doc_id=id)";H.executeSql(I,[],function(J){var K="CREATE UNIQUE INDEX IF NOT EXISTS 'doc-max-seq-idx' ON "+bi+" (max_seq)";J.executeSql(K,[],E)})})}function A(F,E){F.executeSql('SELECT HEX("a") AS hex',[],function(H,I){var G=I.rows.item(0).hex;C=2===G.length?"UTF-8":"UTF-16",E()})}function B(){for(;u.length>0;){var E=u.pop();E(null,y)}}function w(P,L){if(0===L){var H="CREATE TABLE IF NOT EXISTS "+dU+" (dbid, db_version INTEGER)",E="CREATE TABLE IF NOT EXISTS "+bV+" (digest UNIQUE, escaped TINYINT(1), body BLOB)",O="CREATE TABLE IF NOT EXISTS "+jK+" (digest, seq INTEGER)",M="CREATE TABLE IF NOT EXISTS "+bi+" (id unique, json, winningseq, max_seq INTEGER UNIQUE)",N="CREATE TABLE IF NOT EXISTS "+d9+" (seq INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, json, deleted TINYINT(1), doc_id, rev)",G="CREATE TABLE IF NOT EXISTS "+c9+" (id UNIQUE, rev, json)";P.executeSql(E),P.executeSql(G),P.executeSql(O,[],function(){P.executeSql(aD),P.executeSql(cR)}),P.executeSql(M,[],function(){P.executeSql(cs),P.executeSql(N,[],function(){P.executeSql(b9),P.executeSql(j0),P.executeSql(H,[],function(){var Q="INSERT INTO "+dU+" (db_version, dbid) VALUES (?,?)";y=bN();var R=[b2,y];P.executeSql(Q,R,function(){B()})})})})}else{var J=function(){var R=b2>L;R&&P.executeSql("UPDATE "+dU+" SET db_version = "+b2);var Q="SELECT dbid FROM "+dU;P.executeSql(Q,[],function(T,S){y=S.rows.item(0).dbid,B()})},F=[g,r,s,v,o,D,J],I=L,K=function(Q){F[I-1](Q,K),I++};K(P)}}function p(){l.transaction(function(E){A(E,function(){m(E)})},c0(n),q)}function m(F){var E="SELECT sql FROM sqlite_master WHERE tbl_name = "+dU;F.executeSql(E,[],function(H,G){G.rows.length?/db_version/.test(G.rows.item(0).sql)?H.executeSql("SELECT db_version FROM "+dU,[],function(J,I){var K=I.rows.item(0).db_version;w(J,K)}):H.executeSql("ALTER TABLE "+dU+" ADD COLUMN db_version INTEGER",[],function(){w(H,1)}):w(H,0)})}function k(F,E){if(-1!==j._docCount){return E(j._docCount)}var G=jW("COUNT("+bi+".id) AS 'num'",[bi,d9],bb,d9+".deleted=0");F.executeSql(G,[],function(H,I){j._docCount=I.rows.item(0).num,E(j._docCount)})}var C,j=this,y=null,i=jS(x),u=[];j._docCount=-1,j._name=x.name;var z=bL.extend({},x,{size:i,version:aF}),h=e7(z);if(h.error){return c0(n)(h.error)}var l=h.db;"function"!=typeof l.readTransaction&&(l.readTransaction=l.transaction),p(),j.type=function(){return"websql"},j._id=aq(function(E){E(null,y)}),j._info=function(E){l.readTransaction(function(F){k(F,function(H){var G="SELECT MAX(seq) AS seq FROM "+d9;F.executeSql(G,[],function(I,J){var K=J.rows.item(0).seq||0;E(null,{doc_count:H,update_seq:K,sqlite_plugin:l._sqlitePlugin,websql_encoding:C})})})},c0(E))},j._bulkDocs=function(E,G,F){eK(x,E,G,j,l,dO,F)},j._get=function(N,H,L){function I(){L(F,{doc:J,metadata:M,ctx:K})}var J,M,F,K=H.ctx;if(!K){return l.readTransaction(function(O){j._get(N,bL.extend({ctx:O},H),L)})}var G,E;H.rev?(G=jW(f2,[bi,d9],bi+".id="+d9+".doc_id",[d9+".doc_id=?",d9+".rev=?"]),E=[N,H.rev]):(G=jW(f2,[bi,d9],bb,bi+".id=?"),E=[N]),K.executeSql(G,E,function(O,P){if(!P.rows.length){return F=cM(jY,"missing"),I()}var Q=P.rows.item(0);return M=aV(Q.metadata),Q.deleted&&!H.rev?(F=cM(jY,"deleted"),I()):(J=eC(Q.data,M.id,Q.rev),void I())})},j._allDocs=function(H,P){var M,I=[],K="startkey" in H?H.startkey:!1,E="endkey" in H?H.endkey:!1,N="key" in H?H.key:!1,Q="descending" in H?H.descending:!1,O="limit" in H?H.limit:-1,L="skip" in H?H.skip:0,G=H.inclusive_end!==!1,R=[],J=[];if(N!==!1){J.push(bi+".id = ?"),R.push(N)}else{if(K!==!1||E!==!1){if(K!==!1&&(J.push(bi+".id "+(Q?"<=":">=")+" ?"),R.push(K)),E!==!1){var F=Q?">":"<";G&&(F+="="),J.push(bi+".id "+F+" ?"),R.push(E)}N!==!1&&(J.push(bi+".id = ?"),R.push(N))}}"ok"!==H.deleted&&J.push(d9+".deleted = 0"),l.readTransaction(function(S){k(S,function(U){if(M=U,0!==O){var T=jW(f2,[bi,d9],bb,J,bi+".id "+(Q?"DESC":"ASC"));T+=" LIMIT "+O+" OFFSET "+L,S.executeSql(T,R,function(X,ai){for(var Z=0,ar=ai.rows.length;ar>Z;Z++){var W=ai.rows.item(Z),Y=aV(W.metadata),ao=Y.id,V=eC(W.data,ao,W.rev),an=V._rev,ae={id:ao,key:ao,value:{rev:an}};if(H.include_docs&&(ae.doc=V,ae.doc._rev=an,H.conflicts&&(ae.doc._conflicts=fF(Y)),bk(ae.doc,H,j,X)),W.deleted){if("ok"!==H.deleted){continue}ae.value.deleted=!0,ae.doc=null}I.push(ae)}})}})},c0(P),function(){P(null,{total_rows:M,offset:H.skip,rows:I})})},j._changes=function(J){function K(){var S=bi+".json AS metadata, "+bi+".max_seq AS maxSeq, "+d9+".json AS winningDoc, "+d9+".rev AS winningRev ",T=bi+" JOIN "+d9,R=bi+".id="+d9+".doc_id AND "+bi+".winningseq="+d9+".seq",Q=["maxSeq > ?"],N=[J.since];J.doc_ids&&(Q.push(bi+".id IN "+aa(J.doc_ids.length)),N=N.concat(J.doc_ids));var U="maxSeq "+(G?"DESC":"ASC"),O=jW(S,T,R,Q,U),M=kf(J);J.view||J.filter||(O+=" LIMIT "+L);var P=J.since||0;l.readTransaction(function(V){V.executeSql(O,N,function(Y,Z){function X(a0){return function(){J.onChange(a0)}}for(var ao=0,an=Z.rows.length;an>ao;ao++){var ai=Z.rows.item(ao),W=aV(ai.metadata);P=ai.maxSeq;var ae=eC(ai.winningDoc,W.id,ai.winningRev),at=J.processChange(ae,W,J);at.seq=ai.maxSeq;var ar=M(at);if("object"==typeof ar){return J.complete(ar)}if(ar&&(F++,I&&H.push(at),J.attachments&&J.include_docs?bk(ae,J,j,Y,X(at)):X(at)()),F===L){break}}})},c0(J.complete),function(){J.continuous||J.complete(null,{results:H,last_seq:P})})}if(J=bO(J),J.continuous){var E=j._name+":"+bN();return dO.addListener(j._name,E,j,J),dO.notify(j._name),{cancel:function(){dO.removeListener(j._name,E)}}}var G=J.descending;J.since=J.since&&!G?J.since:0;var L="limit" in J?J.limit:-1;0===L&&(L=1);var I;I="return_docs" in J?J.return_docs:"returnDocs" in J?J.returnDocs:!0;var H=[],F=0;K()},j._close=function(E){E()},j._getAttachment=function(J,K,E){var G,L=K.ctx,I=J.digest,H=J.content_type,F="SELECT escaped, CASE WHEN escaped = 1 THEN body ELSE HEX(body) END AS body FROM "+bV+" WHERE digest=?";L.executeSql(F,[I],function(P,M){var N=M.rows.item(0),O=N.escaped?eB(N.body):e(N.body,C);G=K.binary?cH(O,H):bq(O),E(null,G)})},j._getRevisionTree=function(F,E){l.readTransaction(function(H){var G="SELECT json AS metadata FROM "+bi+" WHERE id = ?";H.executeSql(G,[F],function(J,K){if(K.rows.length){var I=aV(K.rows.item(0).metadata);E(null,I.rev_tree)}else{E(cM(jY))}})})},j._doCompaction=function(F,E,G){return E.length?void l.transaction(function(I){var H="SELECT json AS metadata FROM "+bi+" WHERE id = ?";I.executeSql(H,[F],function(J,L){var M=aV(L.rows.item(0).metadata);cY(M.rev_tree,function(O,Q,N,P,S){var R=Q+"-"+N;-1!==E.indexOf(R)&&(S.status="missing")});var K="UPDATE "+bi+" SET json = ? WHERE id = ?";J.executeSql(K,[dW(M),F])}),bs(E,F,I)},c0(G),function(){G()}):G()},j._getLocal=function(F,E){l.readTransaction(function(H){var G="SELECT json, rev FROM "+c9+" WHERE id=?";H.executeSql(G,[F],function(I,K){if(K.rows.length){var L=K.rows.item(0),J=eC(L.json,F,L.rev);E(null,J)}else{E(cM(jY))}})})},j._putLocal=function(K,E,I){function G(N){var P,O;J?(P="UPDATE "+c9+" SET rev=?, json=? WHERE id=? AND rev=?",O=[H,M,L,J]):(P="INSERT INTO "+c9+" (id, rev, json) VALUES (?,?,?)",O=[L,H,M]),N.executeSql(P,O,function(R,Q){Q.rowsAffected?(F={ok:!0,id:L,rev:H},E.ctx&&I(null,F)):I(cM(aA))},function(){return I(cM(aA)),!1})}"function"==typeof E&&(I=E,E={}),delete K._revisions;var H,J=K._rev,L=K._id;H=J?K._rev="0-"+(parseInt(J.split("-")[1],10)+1):K._rev="0-1";var F,M=aO(K);E.ctx?G(E.ctx):l.transaction(G,c0(I),function(){F&&I(null,F)})},j._removeLocal=function(G,E,I){function F(L){var K="DELETE FROM "+c9+" WHERE id=? AND rev=?",J=[G._id,G._rev];L.executeSql(K,J,function(N,M){return M.rowsAffected?(H={ok:!0,id:G._id,rev:"0-0"},void (E.ctx&&I(null,H))):I(cM(jY))})}"function"==typeof E&&(I=E,E={});var H;E.ctx?F(E.ctx):l.transaction(F,c0(I),function(){H&&I(null,H)})},j._destroy=function(F,E){dO.removeAllListeners(j._name),l.transaction(function(H){var G=[bi,d9,bV,dU,c9,jK];G.forEach(function(I){H.executeSql("DROP TABLE IF EXISTS "+I,[])})},c0(E),function(){e6()&&(delete window.localStorage["_pouch__websqldb_"+j._name],delete window.localStorage[j._name]),E(null,{ok:!0})})}}var bL=c(7),dB=aK(bL),al=aK(c(2)),bM=aK(c(6)),bp=aK(c(8)),e4=c(12),ba=aK(c(1)),aE=c(4),ef=aK(c(14)),eA=c(10),eI=aK(eA),eH=aK(c(15)),b4=aK(c(16)),aC="function"==typeof Promise?Promise:bp,aQ=al("pouchdb:api");bM(cw,Error),cw.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};var aP=new cw({status:401,error:"unauthorized",reason:"Name or password is incorrect."}),bQ=new cw({status:400,error:"bad_request",reason:"Missing JSON list of 'docs'"}),jY=new cw({status:404,error:"not_found",reason:"missing"}),aA=new cw({status:409,error:"conflict",reason:"Document update conflict"}),bd=new cw({status:400,error:"invalid_id",reason:"_id field must contain a string"}),ay=new cw({status:412,error:"missing_id",reason:"_id is required for puts"}),aM=new cw({status:400,error:"bad_request",reason:"Only reserved document ids may start with underscore."}),dy=new cw({status:412,error:"precondition_failed",reason:"Database not open"}),j9=new cw({status:500,error:"unknown_error",reason:"Database encountered an unknown error"}),dS=new cw({status:500,error:"badarg",reason:"Some query argument is invalid"}),f8=new cw({status:400,error:"invalid_request",reason:"Request was invalid"}),d3=new cw({status:400,error:"query_parse_error",reason:"Some query parameter is invalid"}),jV=new cw({status:500,error:"doc_validation",reason:"Bad special document member"}),dE=new cw({status:400,error:"bad_request",reason:"Something wrong with the request"}),cf=new cw({status:400,error:"bad_request",reason:"Document must be a JSON object"}),fJ=new cw({status:404,error:"not_found",reason:"Database not found"}),d6=new cw({status:500,error:"indexed_db_went_bad",reason:"unknown"}),au=new cw({status:500,error:"web_sql_went_bad",reason:"unknown"}),cc=new cw({status:500,error:"levelDB_went_went_bad",reason:"unknown"}),fB=new cw({status:403,error:"forbidden",reason:"Forbidden by design doc validate_doc_update function"}),fH=new cw({status:400,error:"bad_request",reason:"Invalid rev format"}),ch=new cw({status:412,error:"file_exists",reason:"The database could not be created, the file already exists."}),c2=new cw({status:412,error:"missing_stub"}),kg=new cw({status:413,error:"invalid_url",reason:"Provided URL is invalid"}),eU={UNAUTHORIZED:aP,MISSING_BULK_DOCS:bQ,MISSING_DOC:jY,REV_CONFLICT:aA,INVALID_ID:bd,MISSING_ID:ay,RESERVED_ID:aM,NOT_OPEN:dy,UNKNOWN_ERROR:j9,BAD_ARG:dS,INVALID_REQUEST:f8,QUERY_PARSE_ERROR:d3,DOC_VALIDATION:jV,BAD_REQUEST:dE,NOT_AN_OBJECT:cf,DB_MISSING:fJ,WSQ_ERROR:au,LDB_ERROR:cc,FORBIDDEN:fB,INVALID_REV:fH,FILE_EXISTS:ch,MISSING_STUB:c2,IDB_ERROR:d6,INVALID_URL:kg},bW=function(i,g,k){var h=Object.keys(eU).filter(function(m){var l=eU[m];return"function"!=typeof l&&l[i]===g}),j=k&&h.filter(function(m){var l=eU[m];return l.message===k})[0]||h[0];return j?eU[j]:null};bM(dg,aE.EventEmitter),dg.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")},dg.prototype.doChanges=function(i){var g=this,k=i.complete;if(i=bO(i),"live" in i&&!("continuous" in i)&&(i.continuous=i.live),i.processChange=cQ,"latest"===i.since&&(i.since="now"),i.since||(i.since=0),"now"===i.since){return void this.db.info().then(function(l){return g.isCancelled?void k(null,{status:"cancelled"}):(i.since=l.update_seq,void g.doChanges(i))},k)}if(i.continuous&&"now"!==i.since&&this.db.info().then(function(l){g.startSeq=l.update_seq},function(l){if("idbNull"!==l.id){throw l}}),i.filter&&"string"==typeof i.filter&&("_view"===i.filter?i.view=jD(i.view):i.filter=jD(i.filter),"http"!==this.db.type()&&!i.doc_ids)){return this.filterChanges(i)}"descending" in i||(i.descending=!1),i.limit=0===i.limit?1:i.limit,i.complete=k;var h=this.db._changes(i);if(h&&"function"==typeof h.cancel){var j=g.cancel;g.cancel=ba(function(l){h.cancel(),j.apply(this,l)})}},dg.prototype.filterChanges=function(j){var h=this,l=j.complete;if("_view"===j.filter){if(!j.view||"string"!=typeof j.view){var i=cM(dE,"`view` filter parameter not found or invalid.");return l(i)}var k=dz(j.view);this.db.getView(k[0],k[1],function(m,n){return h.isCancelled?l(null,{status:"cancelled"}):m?l(cC(m)):n.map?(j.filter=cl(n.map),void h.doChanges(j)):l(cM(jY))})}else{var g=dz(j.filter);if(!g){return h.doChanges(j)}this.db.getFilter(g[0],g[1],function(m,n){return h.isCancelled?l(null,{status:"cancelled"}):m?l(cC(m)):(j.filter=dR(n),void h.doChanges(j))})}};var a9="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),eP=aU(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),cy=aU(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);bM(aS,aE.EventEmitter),aS.prototype.post=eE("post",function(i,h,g){return"function"==typeof h&&(g=h,h={}),"object"!=typeof i||Array.isArray(i)?g(cM(cf)):void this.bulkDocs({docs:[i]},h,dw(g))}),aS.prototype.put=eE("put",ba(function(l){var j,g,k,m,i=l.shift(),h="_id" in i;if("object"!=typeof i||Array.isArray(i)){return(m=l.pop())(cM(cf))}for(;;){if(j=l.shift(),g=typeof j,"string"!==g||h?"string"!==g||!h||"_rev" in i?"object"===g?k=j:"function"===g&&(m=j):i._rev=j:(i._id=j,h=!0),!l.length){break}}return k=k||{},bg(i._id),jP(i._id)&&"function"==typeof this._putLocal?i._deleted?this._removeLocal(i,m):this._putLocal(i,m):void this.bulkDocs({docs:[i]},k,dw(m))})),aS.prototype.putAttachment=eE("putAttachment",function(l,j,g,k,m){function i(o){var n="_rev" in o?parseInt(o._rev,10):0;return o._attachments=o._attachments||{},o._attachments[j]={content_type:m,data:k,revpos:++n},h.put(o)}var h=this;return"function"==typeof m&&(m=k,k=g,g=null),"undefined"==typeof m&&(m=k,k=g,g=null),h.get(l).then(function(n){if(n._rev!==g){throw cM(aA)}return i(n)},function(n){if(n.reason===jY.message){return i({_id:l})}throw n})}),aS.prototype.removeAttachment=eE("removeAttachment",function(i,g,k,h){var j=this;j.get(i,function(m,l){return m?void h(m):l._rev!==k?void h(cM(aA)):l._attachments?(delete l._attachments[g],0===Object.keys(l._attachments).length&&delete l._attachments,void j.put(l,h)):h()})}),aS.prototype.remove=eE("remove",function(j,h,l,i){var k;"string"==typeof h?(k={_id:j,_rev:h},"function"==typeof l&&(i=l,l={})):(k=j,"function"==typeof h?(i=h,l={}):(i=l,l=h)),l=l||{},l.was_delete=!0;var g={_id:k._id,_rev:k._rev||l.rev};return g._deleted=!0,jP(g._id)&&"function"==typeof this._removeLocal?this._removeLocal(k,i):void this.bulkDocs({docs:[g]},l,dw(i))}),aS.prototype.revsDiff=eE("revsDiff",function(l,n,i){function g(o,p){j.has(o)||j.set(o,{missing:[]}),j.get(o).missing.push(p)}function h(q,p){var o=l[q].slice(0);cY(p,function(x,w,v,r,s){var y=w+"-"+v,u=o.indexOf(y);-1!==u&&(o.splice(u,1),"available"!==s.status&&g(q,y))}),o.forEach(function(r){g(q,r)})}"function"==typeof n&&(i=n,n={});var m=Object.keys(l);if(!m.length){return i(null,{})}var k=0,j=new e4.Map;m.map(function(o){this._getRevisionTree(o,function(q,p){if(q&&404===q.status&&"missing"===q.message){j.set(o,{missing:l[o]})}else{if(q){return i(q)}h(o,p)}if(++k===m.length){var r={};return j.forEach(function(u,s){r[s]=u}),i(null,r)}})},this)}),aS.prototype.bulkGet=eE("bulkGet",function(h,g){cX(this,h,g)}),aS.prototype.compactDocument=eE("compactDocument",function(g,i,h){var j=this;this._getRevisionTree(g,function(o,m){if(o){return h(o)}var k=c5(m),n=[],l=[];Object.keys(k).forEach(function(p){k[p]>i&&n.push(p)}),cY(m,function(v,s,q,u,p){var r=s+"-"+q;"available"===p.status&&-1!==n.indexOf(r)&&l.push(r)}),j._doCompaction(g,l,h)})}),aS.prototype.compact=eE("compact",function(i,h){"function"==typeof i&&(h=i,i={});var g=this;i=i||{},g._compactionQueue=g._compactionQueue||[],g._compactionQueue.push({opts:i,callback:h}),1===g._compactionQueue.length&&aw(g)}),aS.prototype._compact=function(l,j){function g(n){h.push(m.compactDocument(n.id,0))}function k(o){var n=o.last_seq;aC.all(h).then(function(){return bw(m,"_local/compaction",function(p){return !p.last_seq||p.last_seq<n?(p.last_seq=n,p):!1})}).then(function(){j(null,{ok:!0})})["catch"](j)}var m=this,i={return_docs:!1,last_seq:l.last_seq||0},h=[];m.changes(i).on("change",g).on("complete",k).on("error",j)},aS.prototype.get=eE("get",function(l,n,i){function g(){var o=[],p=h.length;return p?void h.forEach(function(q){m.get(l,{rev:q,revs:n.revs,attachments:n.attachments},function(s,r){s?o.push({missing:q}):o.push({ok:r}),p--,p||i(null,o)})}):i(null,o)}if("function"==typeof n&&(i=n,n={}),"string"!=typeof l){return i(cM(bd))}if(jP(l)&&"function"==typeof this._getLocal){return this._getLocal(l,i)}var h=[],m=this;if(!n.open_revs){return this._get(l,n,function(C,B){if(C){return i(C)}var v=B.doc,u=B.metadata,y=B.ctx;if(n.conflicts){var s=fF(u);s.length&&(v._conflicts=s)}if(aT(u,v._rev)&&(v._deleted=!0),n.revs||n.revs_info){var r=eL(u.rev_tree),A=ea(r,function(D){return -1!==D.ids.map(function(E){return E.id}).indexOf(v._rev.split("-")[1])}),w=A.ids.map(function(D){return D.id}).indexOf(v._rev.split("-")[1])+1,o=A.ids.length-w;if(A.ids.splice(w,o),A.ids.reverse(),n.revs&&(v._revisions={start:A.pos+A.ids.length-1,ids:A.ids.map(function(D){return D.id})}),n.revs_info){var p=A.pos+A.ids.length;v._revs_info=A.ids.map(function(D){return p--,{rev:p+"-"+D.id,status:D.opts.status}})}}if(n.attachments&&v._attachments){var q=v._attachments,x=Object.keys(q).length;if(0===x){return i(null,v)}Object.keys(q).forEach(function(D){this._getAttachment(q[D],{binary:n.binary,ctx:y},function(F,G){var E=v._attachments[D];E.data=G,delete E.stub,delete E.length,--x||i(null,v)})},m)}else{if(v._attachments){for(var z in v._attachments){v._attachments.hasOwnProperty(z)&&(v._attachments[z].stub=!0)}}i(null,v)}})}if("all"===n.open_revs){this._getRevisionTree(l,function(o,p){return o?i(o):(h=f1(p).map(function(q){return q.rev}),void g())})}else{if(!Array.isArray(n.open_revs)){return i(cM(j9,"function_clause"))}h=n.open_revs;for(var k=0;k<h.length;k++){var j=h[k];if("string"!=typeof j||!/^\d+-/.test(j)){return i(cM(fH))}}g()}}),aS.prototype.getView=eE("getView",function(i,h,g){av(this,i,"views",h,g)}),aS.prototype.getFilter=eE("getFilter",function(i,h,g){av(this,i,"filters",h,g)}),aS.prototype.getAttachment=eE("getAttachment",function(i,g,k,h){var j=this;k instanceof Function&&(h=k,k={}),this._get(i,k,function(m,l){return m?h(m):l.doc._attachments&&l.doc._attachments[g]?(k.ctx=l.ctx,k.binary=!0,j._getAttachment(l.doc._attachments[g],k,h),void 0):h(cM(jY))})}),aS.prototype.allDocs=eE("allDocs",function(i,h){if("function"==typeof i&&(h=i,i={}),i.skip="undefined"!=typeof i.skip?i.skip:0,i.start_key&&(i.startkey=i.start_key),i.end_key&&(i.endkey=i.end_key),"keys" in i){if(!Array.isArray(i.keys)){return h(new TypeError("options.keys must be an array"))}var g=["startkey","endkey","key"].filter(function(j){return j in i})[0];if(g){return void h(cM(d3,"Query parameter `"+g+"` is not compatible with multi-get"))}if("http"!==this.type()){return cW(this,i,h)}}return this._allDocs(i,h)}),aS.prototype.changes=function(h,g){return"function"==typeof h&&(g=h,h={}),new dg(this,h,g)},aS.prototype.close=eE("close",function(g){return this._closed=!0,this._close(g)}),aS.prototype.info=eE("info",function(h){var g=this;this._info(function(j,i){return j?h(j):(i.db_name=i.db_name||g._db_name,i.auto_compaction=!(!g.auto_compaction||"http"===g.type()),i.adapter=g.type(),void h(null,i))})}),aS.prototype.id=eE("id",function(g){return this._id(g)}),aS.prototype.type=function(){return"function"==typeof this._type?this._type():this.adapter},aS.prototype.bulkDocs=eE("bulkDocs",function(i,g,k){if("function"==typeof g&&(k=g,g={}),g=g||{},Array.isArray(i)&&(i={docs:i}),!i||!i.docs||!Array.isArray(i.docs)){return k(cM(bQ))}for(var h=0;h<i.docs.length;++h){if("object"!=typeof i.docs[h]||Array.isArray(i.docs[h])){return k(cM(cf))}}var j;return i.docs.forEach(function(l){l._attachments&&Object.keys(l._attachments).forEach(function(m){j=j||fI(m)})}),j?k(cM(dE,j)):("new_edits" in g||("new_edits" in i?g.new_edits=i.new_edits:g.new_edits=!0),g.new_edits||"http"===this.type()||i.docs.sort(dK),eW(i.docs),this._bulkDocs(i,g,function(m,l){return m?k(m):(g.new_edits||(l=l.filter(function(n){return n.error})),void k(null,l))}))}),aS.prototype.registerDependentDatabase=eE("registerDependentDatabase",function(g,i){function h(k){return k.dependentDbs=k.dependentDbs||{},k.dependentDbs[g]?!1:(k.dependentDbs[g]=!0,k)}var j=new this.constructor(g,this.__opts);bw(this,"_local/_pouch_dependentDbs",h).then(function(){i(null,{db:j})})["catch"](i)}),aS.prototype.destroy=eE("destroy",function(i,g){function k(){h._destroy(i,function(l,m){return l?g(l):(h._destroyed=!0,h.emit("destroyed"),void g(null,m||{ok:!0}))})}"function"==typeof i&&(g=i,i={});var h=this,j="use_prefix" in h?h.use_prefix:!0;return"http"===h.type()?k():void h.get("_local/_pouch_dependentDbs",function(p,n){if(p){return 404!==p.status?g(p):k()}var l=n.dependentDbs,o=h.constructor,m=Object.keys(l).map(function(r){var q=j?r.replace(new RegExp("^"+o.prefix),""):r;return new o(q,h.__opts).destroy()});aC.all(m).then(k,g)})}),af.prototype.execute=function(){var g;if(this.failed){for(;g=this.queue.shift();){g(this.failed)}}else{for(;g=this.queue.shift();){g()}}},af.prototype.fail=function(g){this.failed=g,this.execute()},af.prototype.ready=function(g){this.isReady=!0,this.db=g,this.execute()},af.prototype.addTask=function(g){this.queue.push(g),this.failed&&this.execute()},bM(e5,aS),e5.debug=al;var bu;if(bH()){bu=!1}else{try{localStorage.setItem("_pouch_check_localstorage",1),bu=!!localStorage.getItem("_pouch_check_localstorage")}catch(aj){bu=!1}}e5.adapters={},e5.preferredAdapters=[],e5.prefix="_pouch_";var b8=new aE.EventEmitter;bD(e5),e5.parseAdapter=function(l,n){var i,g,h=l.match(/([a-z\-]*):\/\/(.*)/);if(h){if(l=/http(s?)/.test(h[1])?h[1]+"://"+h[2]:h[2],i=h[1],!e5.adapters[i].valid()){throw"Invalid adapter"}return{name:l,adapter:h[1]}}var m="idb" in e5.adapters&&"websql" in e5.adapters&&e6()&&localStorage["_pouch__websqldb_"+e5.prefix+l];if(n.adapter){g=n.adapter}else{if("undefined"!=typeof n&&n.db){g="leveldb"}else{for(var k=0;k<e5.preferredAdapters.length;++k){if(g=e5.preferredAdapters[k],g in e5.adapters){if(m&&"idb"===g){console.log('PouchDB is downgrading "'+l+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.');continue}break}}}}i=e5.adapters[g];var j=i&&"use_prefix" in i?i.use_prefix:!0;return{name:j?e5.prefix+l:l,adapter:g}},e5.adapter=function(i,h,g){h.valid()&&(e5.adapters[i]=h,g&&e5.preferredAdapters.push(i))},e5.plugin=function(g){return Object.keys(g).forEach(function(h){e5.prototype[h]=g[h]}),e5},e5.defaults=function(h){function g(k,i,j){return this instanceof g?("function"!=typeof i&&"undefined"!=typeof i||(j=i,i={}),k&&"object"==typeof k&&(i=k,k=void 0),i=bL.extend({},h,i),void e5.call(this,k,i,j)):new g(k,i,j)}return bM(g,e5),bD(g),g.preferredAdapters=e5.preferredAdapters.slice(),Object.keys(e5).forEach(function(i){i in g||(g[i]=e5[i])}),g};var bI=jH(),du=function(){},fO=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],f6="queryKey",dX=/(?:^|&)([^&=]*)=?([^&]*)/g,dY=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,c7=function(g){return atob(g)},bq=function(g){return btoa(g)},j3=dB.extend,eY={ajax:aW,parseUri:jM,uuid:bN,Promise:aC,atob:c7,btoa:bq,binaryStringToBlobOrBuffer:cH,clone:bO,extend:j3,createError:cM},dM=eI.collate,c8=1,dN="pouchdb",aZ=5,ad=0;bZ.prototype.writeCheckpoint=function(i,h){var g=this;return this.updateTarget(i,h).then(function(){return g.updateSource(i,h)})},bZ.prototype.updateTarget=function(h,g){return e0(this.target,this.id,h,g,this.returnValue)},bZ.prototype.updateSource=function(i,h){var g=this;return this.readOnlySource?aC.resolve(!0):e0(this.src,this.id,i,h,this.returnValue)["catch"](function(j){if(bP(j)){return g.readOnlySource=!0,!0}throw j})};var dm={undefined:function(h,g){return 0===dM(h.last_seq,g.last_seq)?g.last_seq:0},1:function(h,g){return cZ(g,h).last_seq}};bZ.prototype.getCheckpoint=function(){var g=this;return g.target.get(g.id).then(function(h){return g.readOnlySource?aC.resolve(h.last_seq):g.src.get(g.id).then(function(i){if(h.version!==i.version){return ad}var j;return j=h.version?h.version.toString():"undefined",j in dm?dm[j](h,i):ad},function(i){if(404===i.status&&h.last_seq){return g.src.put({_id:g.id,last_seq:ad}).then(function(){return ad},function(j){return bP(j)?(g.readOnlySource=!0,h.last_seq):ad})}throw i})})["catch"](function(h){if(404!==h.status){throw h}return ad})};var jI=0,eG=bY.setImmediate||bY.setTimeout,ck=32768,d4=aq(function(g,i){function m(){var q=j*o,u=q+o;if(j++,h>j){n(p,g,q,u),eG(m)}else{n(p,g,q,u);var r=p.end(!0),s=dD(r);i(null,s),p.destroy()}}var k="string"==typeof g,l=k?g.length:g.byteLength,o=Math.min(ck,l),h=Math.ceil(l/o),j=0,p=k?new eH:new eH.ArrayBuffer,n=k?eD:ax;m()});bM(eO,aE.EventEmitter),eO.prototype.cancel=function(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")},eO.prototype.ready=function(i,g){function k(){j.cancel()}function h(){i.removeListener("destroyed",k),g.removeListener("destroyed",k)}var j=this;j._readyCalled||(j._readyCalled=!0,i.once("destroyed",k),g.once("destroyed",k),j.once("complete",h))};var by={replicate:f7,toPouch:aN},eV=by.replicate;bM(dJ,aE.EventEmitter),dJ.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())};var c6=25,dZ=50,dT={},cN=1800,jN=al("pouchdb:http");bl.valid=function(){return !0},db.prototype.add=function(g){return this.promise=this.promise["catch"](function(){}).then(function(){return g()}),this.promise},db.prototype.finish=function(){return this.promise};var bc,eM=function(h,g){return g&&h.then(function(i){em.nextTick(function(){g(null,i)})},function(i){em.nextTick(function(){g(i)})}),h},aI=function(g){return ba(function(h){var j=h.pop(),i=g.apply(this,h);return"function"==typeof j&&eM(i,j),i})},cb=function(h,g){return h.then(function(i){return g().then(function(){return i})},function(i){return g().then(function(){throw i})})},az=function(h,g){return function(){var j=arguments,i=this;return h.add(function(){return g.apply(i,j)})}},eR=function(j){for(var h={},l=0,i=j.length;i>l;l++){h["$"+j[l]]=!0}var k=Object.keys(h),g=new Array(k.length);for(l=0,i=k.length;i>l;l++){g[l]=k[l].substring(1)}return g},eQ={uniq:eR,sequentialize:az,fin:cb,callbackify:aI,promisedCallback:eM},cF=eI.collate,eT=eI.toIndexableString,dC=eI.normalizeKey,eb=eI.parseIndexableString;bc="undefined"!=typeof console&&"function"==typeof console.log?Function.prototype.bind.call(console.log,console):function(){};var fQ=eQ.callbackify,bJ=eQ.sequentialize,kj=eQ.uniq,fN=eQ.fin,ka=eQ.promisedCallback,cA={},fL=new db,am=50,bT={_sum:function(h,g){return jJ(g)},_count:function(h,g){return g.length},_stats:function(i,h){function g(l){for(var j=0,n=0,k=l.length;k>n;n++){var m=l[n];j+=m*m}return j}return{sum:jJ(h),min:Math.min.apply(null,h),max:Math.max.apply(null,h),count:h.length,sumsqr:g(h)}}},cu=fQ(function(){var g=this;return g._ddocCache&&delete g._ddocCache,"http"===g.type()?a8(g):"function"==typeof g._viewCleanup?bz(g):j7(g)}),eN=function(i,g,k){"function"==typeof g&&(k=g,g={}),g=g?dF(g):{},"function"==typeof i&&(i={map:i});var h=this,j=aC.resolve().then(function(){return bU(h,i,g)});return ka(j,k),j};bM(eg,Error),bM(f5,Error);var cj={query:eN,viewCleanup:cu},eF=5,cO="document-store",jF="by-sequence",dV="attach-store",bF="attach-seq-store",cL="meta-store",jQ="local-store",cI="detect-blob-support",c1={running:!1,queue:[]};bM(ab,aE.EventEmitter),ab.prototype.addListener=function(k,h,m,j){function l(){function o(){i=!1}if(g._listeners[h]){if(i){return void (i="waiting")}i=!0;var n=d1(j,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary"]);m.changes(n).on("change",function(p){p.seq>j.since&&!j.cancelled&&(j.since=p.seq,j.onChange(p))}).on("complete",function(){"waiting"===i&&setTimeout(function(){l()},0),i=!1}).on("error",o)}}if(!this._listeners[h]){var g=this,i=!1;this._listeners[h]=l,this.on(k,l)}},ab.prototype.removeListener=function(h,g){g in this._listeners&&aE.EventEmitter.prototype.removeListener.call(this,h,this._listeners[g])},ab.prototype.notifyLocalWindows=function(g){bH()?chrome.storage.local.set({dbName:g}):e6()&&(localStorage[g]="a"===localStorage[g]?"b":"a")},ab.prototype.notify=function(g){this.emit(g),this.notifyLocalWindows(g)};var e8,cz=new e4.Map,j5=new ab,ak=new e4.Map;b6.valid=function(){var g="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform);return !g&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange};var b2=7,bi=fA("document-store"),d9=fA("by-sequence"),bV=fA("attach-store"),c9=fA("local-store"),dU=fA("metadata-store"),jK=fA("attach-seq-store"),bv=new e4.Map,dO=new ab,aF=1,b9="CREATE INDEX IF NOT EXISTS 'by-seq-deleted-idx' ON "+d9+" (seq, deleted)",j0="CREATE UNIQUE INDEX IF NOT EXISTS 'by-seq-doc-id-rev' ON "+d9+" (doc_id, rev)",cs="CREATE INDEX IF NOT EXISTS 'doc-winningseq-idx' ON "+bi+" (winningseq)",aD="CREATE INDEX IF NOT EXISTS 'attach-seq-seq-idx' ON "+jK+" (seq)",cR="CREATE UNIQUE INDEX IF NOT EXISTS 'attach-seq-digest-idx' ON "+jK+" (digest, seq)",bb=d9+".seq = "+bi+".winningseq",f2=d9+".seq AS seq, "+d9+".deleted AS deleted, "+d9+".json AS data, "+d9+".rev AS rev, "+bi+".json AS metadata";cm.use_prefix=!("undefined"!=typeof em&&!em.browser),cm.valid=cE;var b1={idb:b6,websql:cm};e5.ajax=aW,e5.utils=eY,e5.Errors=eU,e5.replicate=by.replicate,e5.sync=f9,e5.version="5.3.2",e5.adapter("http",bl),e5.adapter("https",bl),e5.plugin(cj),Object.keys(b1).forEach(function(g){e5.adapter(g,b1[g],!0)}),f.exports=e5}).call(this,c(13),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{1:1,10:10,12:12,13:13,14:14,15:15,16:16,2:2,4:4,6:6,7:7,8:8}]},{},[17])(17)});