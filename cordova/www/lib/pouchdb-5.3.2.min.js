!function(b){if("object"==typeof exports&&"undefined"!=typeof module){module.exports=b()}else{if("function"==typeof define&&define.amd){define([],b)}else{var a;a="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,a.PouchDB=b()}}}(function(){var b;return function a(j,f,h){function c(m,i){if(!f[m]){if(!j[m]){var e="function"==typeof require&&require;if(!i&&e){return e(m,!0)}if(g){return g(m,!0)}var l=new Error("Cannot find module '"+m+"'");throw l.code="MODULE_NOT_FOUND",l}var k=f[m]={exports:{}};j[m][0].call(k.exports,function(o){var n=j[m][1][o];return c(n?n:o)},k,k.exports,a,j,f,h)}return f[m].exports}for(var g="function"==typeof require&&require,d=0;d<h.length;d++){c(h[d])}return c}({1:[function(c,f,d){function g(e){return function(){var h=arguments.length;if(h){for(var j=[],i=-1;++i<h;){j[i]=arguments[i]}return e.call(this,j)}return e.call(this,[])}}f.exports=g},{}],2:[function(h,l,f){function c(){return"WebkitAppearance" in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function d(){var o=arguments,i=this.useColors;if(o[0]=(i?"%c":"")+this.namespace+(i?" %c":" ")+o[0]+(i?"%c ":" ")+"+"+f.humanize(this.diff),!i){return o}var n="color: "+this.color;o=[o[0],n,"color: inherit"].concat(Array.prototype.slice.call(o,1));var p=0,e=0;return o[0].replace(/%[a-z%]/g,function(q){"%%"!==q&&(p++,"%c"===q&&(e=p))}),o.splice(e,0,n),o}function g(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function j(e){try{null==e?f.storage.removeItem("debug"):f.storage.debug=e}catch(i){}}function m(){var e;try{e=f.storage.debug}catch(i){}return e}function k(){try{return window.localStorage}catch(e){}}f=l.exports=h(3),f.log=g,f.formatArgs=d,f.save=j,f.load=m,f.useColors=c,f.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:k(),f.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],f.formatters.j=function(e){return JSON.stringify(e)},f.enable(m())},{3:3}],3:[function(j,p,d){function v(){return d.colors[h++%d.colors.length]}function c(e){function i(){}function n(){var s=n,u=+new Date,t=u-(k||u);s.diff=t,s.prev=k,s.curr=u,k=u,null==s.useColors&&(s.useColors=d.useColors()),null==s.color&&s.useColors&&(s.color=v());var x=Array.prototype.slice.call(arguments);x[0]=d.coerce(x[0]),"string"!=typeof x[0]&&(x=["%o"].concat(x));var o=0;x[0]=x[0].replace(/%([a-z%])/g,function(D,B){if("%%"===D){return D}o++;var w=d.formatters[B];if("function"==typeof w){var C=x[o];D=w.call(s,C),x.splice(o,1),o--}return D}),"function"==typeof d.formatArgs&&(x=d.formatArgs.apply(s,x));var r=n.log||d.log||console.log.bind(console);r.apply(s,x)}i.enabled=!1,n.enabled=!0;var f=d.enabled(e)?n:i;return f.namespace=e,f}function g(n){d.save(n);for(var e=(n||"").split(/[\s,]+/),i=e.length,f=0;i>f;f++){e[f]&&(n=e[f].replace(/\*/g,".*?"),"-"===n[0]?d.skips.push(new RegExp("^"+n.substr(1)+"$")):d.names.push(new RegExp("^"+n+"$")))}}function l(){d.enable("")}function q(i){var e,f;for(e=0,f=d.skips.length;f>e;e++){if(d.skips[e].test(i)){return !1}}for(e=0,f=d.names.length;f>e;e++){if(d.names[e].test(i)){return !0}}return !1}function m(e){return e instanceof Error?e.stack||e.message:e}d=p.exports=c,d.coerce=m,d.disable=l,d.enable=g,d.enabled=q,d.humanize=j(9),d.names=[],d.skips=[],d.formatters={};var k,h=0},{9:9}],4:[function(j,l,f){function g(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function d(e){return"function"==typeof e}function k(e){return"number"==typeof e}function h(e){return"object"==typeof e&&null!==e}function c(e){return void 0===e}l.exports=g,g.EventEmitter=g,g.prototype._events=void 0,g.prototype._maxListeners=void 0,g.defaultMaxListeners=10,g.prototype.setMaxListeners=function(e){if(!k(e)||0>e||isNaN(e)){throw TypeError("n must be a positive number")}return this._maxListeners=e,this},g.prototype.emit=function(m){var e,p,i,o,q,n;if(this._events||(this._events={}),"error"===m&&(!this._events.error||h(this._events.error)&&!this._events.error.length)){if(e=arguments[1],e instanceof Error){throw e}throw TypeError('Uncaught, unspecified "error" event.')}if(p=this._events[m],c(p)){return !1}if(d(p)){switch(arguments.length){case 1:p.call(this);break;case 2:p.call(this,arguments[1]);break;case 3:p.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),p.apply(this,o)}}else{if(h(p)){for(o=Array.prototype.slice.call(arguments,1),n=p.slice(),i=n.length,q=0;i>q;q++){n[q].apply(this,o)}}}return !0},g.prototype.addListener=function(m,i){var e;if(!d(i)){throw TypeError("listener must be a function")}return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",m,d(i.listener)?i.listener:i),this._events[m]?h(this._events[m])?this._events[m].push(i):this._events[m]=[this._events[m],i]:this._events[m]=i,h(this._events[m])&&!this._events[m].warned&&(e=c(this._maxListeners)?g.defaultMaxListeners:this._maxListeners,e&&e>0&&this._events[m].length>e&&(this._events[m].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[m].length),"function"==typeof console.trace&&console.trace())),this},g.prototype.on=g.prototype.addListener,g.prototype.once=function(e,m){function i(){this.removeListener(e,i),n||(n=!0,m.apply(this,arguments))}if(!d(m)){throw TypeError("listener must be a function")}var n=!1;return i.listener=m,this.on(e,i),this},g.prototype.removeListener=function(n,e){var o,m,p,i;if(!d(e)){throw TypeError("listener must be a function")}if(!this._events||!this._events[n]){return this}if(o=this._events[n],p=o.length,m=-1,o===e||d(o.listener)&&o.listener===e){delete this._events[n],this._events.removeListener&&this.emit("removeListener",n,e)}else{if(h(o)){for(i=p;i-->0;){if(o[i]===e||o[i].listener&&o[i].listener===e){m=i;break}}if(0>m){return this}1===o.length?(o.length=0,delete this._events[n]):o.splice(m,1),this._events.removeListener&&this.emit("removeListener",n,e)}}return this},g.prototype.removeAllListeners=function(m){var i,e;if(!this._events){return this}if(!this._events.removeListener){return 0===arguments.length?this._events={}:this._events[m]&&delete this._events[m],this}if(0===arguments.length){for(i in this._events){"removeListener"!==i&&this.removeAllListeners(i)}return this.removeAllListeners("removeListener"),this._events={},this}if(e=this._events[m],d(e)){this.removeListener(m,e)}else{if(e){for(;e.length;){this.removeListener(m,e[e.length-1])}}}return delete this._events[m],this},g.prototype.listeners=function(i){var e;return e=this._events&&this._events[i]?d(this._events[i])?[this._events[i]]:this._events[i].slice():[]},g.prototype.listenerCount=function(i){if(this._events){var e=this._events[i];if(d(e)){return 1}if(e){return e.length}}return 0},g.listenerCount=function(i,e){return i.listenerCount(e)}},{}],5:[function(c,f,d){(function(p){function h(){m=!0;for(var n,l,i=j.length;i;){for(l=j,j=[],n=-1;++n<i;){l[n]()}i=j.length}m=!1}function w(i){1!==j.push(i)||m||e()}var e,k=p.MutationObserver||p.WebKitMutationObserver;if(k){var q=0,v=new k(h),t=p.document.createTextNode("");v.observe(t,{characterData:!0}),e=function(){t.data=q=++q%2}}else{if(p.setImmediate||"undefined"==typeof p.MessageChannel){e="document" in p&&"onreadystatechange" in p.document.createElement("script")?function(){var i=p.document.createElement("script");i.onreadystatechange=function(){h(),i.onreadystatechange=null,i.parentNode.removeChild(i),i=null},p.document.documentElement.appendChild(i)}:function(){setTimeout(h,0)}}else{var g=new p.MessageChannel;g.port1.onmessage=h,e=function(){g.port2.postMessage(0)}}}var m,j=[];f.exports=w}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],6:[function(c,f,d){"function"==typeof Object.create?f.exports=function(g,e){g.super_=e,g.prototype=Object.create(e.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}})}:f.exports=function(g,e){g.super_=e;var h=function(){};h.prototype=e.prototype,g.prototype=new h,g.prototype.constructor=g}},{}],7:[function(c,f,d){(function(e){e("object"==typeof d?d:this)}).call(this,function(h){var e=Array.prototype.slice,i=Array.prototype.forEach,g=function(j){if("object"!=typeof j){throw j+" is not an object"}var k=e.call(arguments,1);return i.call(k,function(l){if(l){for(var m in l){"object"==typeof l[m]&&j[m]?g.call(j,j[m],l[m]):j[m]=l[m]}}}),j};h.extend=g})},{}],8:[function(D,k,q){function E(){}function j(e){if("function"!=typeof e){throw new TypeError("resolver must be a function")}this.state=w,this.queue=[],this.outcome=void 0,e!==E&&g(this,e)}function z(f,e,h){this.promise=f,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof h&&(this.onRejected=h,this.callRejected=this.otherCallRejected)}function I(f,e,h){H(function(){var i;try{i=e(h)}catch(l){return d.reject(f,l)}i===f?d.reject(f,new TypeError("Cannot resolve promise with itself")):d.resolve(f,i)})}function C(f){var e=f&&f.then;return f&&"object"==typeof f&&"function"==typeof e?function(){e.apply(f,arguments)}:void 0}function g(i,m){function f(o){e||(e=!0,d.reject(i,o))}function h(o){e||(e=!0,d.resolve(i,o))}function l(){m(h,f)}var e=!1,n=G(l);"error"===n.status&&f(n.value)}function G(f,i){var h={};try{h.value=f(i),h.status="success"}catch(e){h.status="error",h.value=e}return h}function B(e){return e instanceof this?e:d.resolve(new this(E),e)}function x(f){var e=new this(E);return d.reject(e,f)}function F(e){function f(r,s){function t(u){l[s]=u,++h!==n||p||(p=!0,d.resolve(i,l))}o.resolve(r).then(t,function(u){p||(p=!0,d.reject(i,u))})}var o=this;if("[object Array]"!==Object.prototype.toString.call(e)){return this.reject(new TypeError("must be an array"))}var n=e.length,p=!1;if(!n){return this.resolve([])}for(var l=new Array(n),h=0,m=-1,i=new this(E);++m<n;){f(e[m],m)}return i}function A(i){function m(o){f.resolve(o).then(function(p){e||(e=!0,d.resolve(h,p))},function(p){e||(e=!0,d.reject(h,p))})}var f=this;if("[object Array]"!==Object.prototype.toString.call(i)){return this.reject(new TypeError("must be an array"))}var l=i.length,e=!1;if(!l){return this.resolve([])}for(var n=-1,h=new this(E);++n<l;){m(i[n])}return h}var H=D(5),d={},c=["REJECTED"],J=["FULFILLED"],w=["PENDING"];k.exports=q=j,j.prototype["catch"]=function(e){return this.then(null,e)},j.prototype.then=function(e,i){if("function"!=typeof e&&this.state===J||"function"!=typeof i&&this.state===c){return this}var h=new this.constructor(E);if(this.state!==w){var f=this.state===J?e:i;I(h,f,this.outcome)}else{this.queue.push(new z(h,e,i))}return h},z.prototype.callFulfilled=function(e){d.resolve(this.promise,e)},z.prototype.otherCallFulfilled=function(e){I(this.promise,this.onFulfilled,e)},z.prototype.callRejected=function(e){d.reject(this.promise,e)},z.prototype.otherCallRejected=function(e){I(this.promise,this.onRejected,e)},d.resolve=function(h,f){var l=G(C,f);if("error"===l.status){return d.reject(h,l.value)}var m=l.value;if(m){g(h,m)}else{h.state=J,h.outcome=f;for(var i=-1,e=h.queue.length;++i<e;){h.queue[i].callFulfilled(f)}}return h},d.reject=function(f,i){f.state=c,f.outcome=i;for(var h=-1,e=f.queue.length;++h<e;){f.queue[h].callRejected(i)}return f},q.resolve=B,q.reject=x,q.all=F,q.race=A},{5:5}],9:[function(p,x,h){function d(i){if(i=""+i,!(i.length>10000)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(i);if(e){var l=parseFloat(e[1]),f=(e[2]||"ms").toLowerCase();switch(f){case"years":case"year":case"yrs":case"yr":case"y":return l*j;case"days":case"day":case"d":return l*m;case"hours":case"hour":case"hrs":case"hr":case"h":return l*q;case"minutes":case"minute":case"mins":case"min":case"m":return l*w;case"seconds":case"second":case"secs":case"sec":case"s":return l*c;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return l}}}}function g(e){return e>=m?Math.round(e/m)+"d":e>=q?Math.round(e/q)+"h":e>=w?Math.round(e/w)+"m":e>=c?Math.round(e/c)+"s":e+"ms"}function k(e){return v(e,m,"day")||v(e,q,"hour")||v(e,w,"minute")||v(e,c,"second")||e+" ms"}function v(f,e,i){return e>f?void 0:1.5*e>f?Math.floor(f/e)+" "+i:Math.ceil(f/e)+" "+i+"s"}var c=1000,w=60*c,q=60*w,m=24*q,j=365.25*m;x.exports=function(f,e){return e=e||{},"string"==typeof f?d(f):e["long"]?k(f):g(f)}},{}],10:[function(c,y,m){function g(f){if(null!==f){switch(typeof f){case"boolean":return f?1:0;case"number":return C(f);case"string":return f.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var i=Array.isArray(f),n=i?f:Object.keys(f),e=-1,o=n.length,h="";if(i){for(;++e<o;){h+=m.toIndexableString(n[e])}}else{for(;++e<o;){var l=n[e];h+=m.toIndexableString(l)+m.toIndexableString(f[l])}}return h}}return""}function k(l,r){var h,e=r,f="1"===l[r];if(f){h=0,r++}else{var i="0"===l[r];r++;var o="",s=l.substring(r,r+d),p=parseInt(s,10)+x;for(i&&(p=-p),r+=d;;){var n=l[r];if("\x00"===n){break}o+=n,r++}o=o.split("."),h=1===o.length?parseInt(o,10):parseFloat(o[0]+"."+o[1]),i&&(h-=10),0!==p&&(h=parseFloat(h+"e"+p))}return{num:h,length:r-e}}function z(n,e){var i=n.pop();if(e.length){var l=e[e.length-1];i===l.element&&(e.pop(),l=e[e.length-1]);var o=l.element,h=l.index;if(Array.isArray(o)){o.push(i)}else{if(h===n.length-2){var f=n.pop();o[f]=i}else{n.push(i)}}}}function v(h,e){for(var f=Math.min(h.length,e.length),i=0;f>i;i++){var l=m.collate(h[i],e[i]);if(0!==l){return l}}return h.length===e.length?0:h.length>e.length?1:-1}function B(f,e){return f===e?0:f>e?1:-1}function w(f,i){for(var n=Object.keys(f),e=Object.keys(i),o=Math.min(n.length,e.length),h=0;o>h;h++){var l=m.collate(n[h],e[h]);if(0!==l){return l}if(l=m.collate(f[n[h]],i[e[h]]),0!==l){return l}}return n.length===e.length?0:n.length>e.length?1:-1}function q(f){var e=["boolean","number","string","object"],h=e.indexOf(typeof f);return ~h?null===f?1:Array.isArray(f)?5:3>h?h+2:h+3:Array.isArray(f)?5:void 0}function C(i){if(0===i){return"1"}var o=i.toExponential().split(/e\+?/),f=parseInt(o[1],10),r=0>i,e=r?"0":"2",h=(r?-f:f)-x,l=j.padLeft(h.toString(),"0",d);e+=A+l;var p=Math.abs(parseFloat(o[0]));r&&(p=10-p);var n=p.toFixed(20);return n=n.replace(/\.?0+$/,""),e+=A+n}var x=-324,d=3,A="",j=c(11);m.collate=function(h,e){if(h===e){return 0}h=m.normalizeKey(h),e=m.normalizeKey(e);var f=q(h),i=q(e);if(f-i!==0){return f-i}if(null===h){return 0}switch(typeof h){case"number":return h-e;case"boolean":return h===e?0:e>h?-1:1;case"string":return B(h,e)}return Array.isArray(h)?v(h,e):w(h,e)},m.normalizeKey=function(l){switch(typeof l){case"undefined":return null;case"number":return l===1/0||l===-(1/0)||isNaN(l)?null:l;case"object":var h=l;if(Array.isArray(l)){var i=l.length;l=new Array(i);for(var f=0;i>f;f++){l[f]=m.normalizeKey(h[f])}}else{if(l instanceof Date){return l.toJSON()}if(null!==l){l={};for(var e in h){if(h.hasOwnProperty(e)){var n=h[e];"undefined"!=typeof n&&(l[e]=m.normalizeKey(n))}}}}}return l},m.toIndexableString=function(f){var e="\x00";return f=m.normalizeKey(f),q(f)+A+g(f)+e},m.parseIndexableString=function(l){for(var r=[],f=[],e=0;;){var o=l[e++];if("\x00"!==o){switch(o){case"1":r.push(null);break;case"2":r.push("1"===l[e]),e++;break;case"3":var s=k(l,e);r.push(s.num),e+=s.length;break;case"4":for(var p="";;){var n=l[e];if("\x00"===n){break}p+=n,e++}p=p.replace(/\u0001\u0001/g,"\x00").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),r.push(p);break;case"5":var i={element:[],index:r.length};r.push(i.element),f.push(i);break;case"6":var h={element:{},index:r.length};r.push(h.element),f.push(h);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+o)}}else{if(1===r.length){return r.pop()}z(r,f)}}}},{11:11}],11:[function(c,f,d){function g(e,j,i){for(var k="",h=i-e.length;k.length<h;){k+=j}return k}d.padLeft=function(h,e,j){var i=g(h,e,j);return i+h},d.padRight=function(h,e,j){var i=g(h,e,j);return h+i},d.stringLexCompare=function(l,e){var k,j=l.length,h=e.length;for(k=0;j>k;k++){if(k===h){return 1}var p=l.charAt(k),m=e.charAt(k);if(p!==m){return m>p?-1:1}}return h>j?-1:0},d.intToDecimalForm=function(i){var e=0>i,j="";do{var h=e?-Math.ceil(i%10):Math.floor(i%10);j=h+j,i=e?Math.ceil(i/10):Math.floor(i/10)}while(i);return e&&"0"!==j&&(j="-"+j),j}},{}],12:[function(h,f,d){function g(){this.store={}}function c(i){if(this.store=new g,i&&Array.isArray(i)){for(var e=0,j=i.length;j>e;e++){this.add(i[e])}}}d.Map=g,d.Set=c,g.prototype.mangle=function(e){if("string"!=typeof e){throw new TypeError("key must be a string but Got "+e)}return"$"+e},g.prototype.unmangle=function(e){return e.substring(1)},g.prototype.get=function(i){var e=this.mangle(i);return e in this.store?this.store[e]:void 0},g.prototype.set=function(i,e){var j=this.mangle(i);return this.store[j]=e,!0},g.prototype.has=function(i){var e=this.mangle(i);return e in this.store},g.prototype["delete"]=function(i){var e=this.mangle(i);return e in this.store?(delete this.store[e],!0):!1},g.prototype.forEach=function(k){for(var e=Object.keys(this.store),l=0,j=e.length;j>l;l++){var i=e[l],m=this.store[i];i=this.unmangle(i),k(m,i)}},c.prototype.add=function(e){return this.store.set(e,!0)},c.prototype.has=function(e){return this.store.has(e)},c.prototype["delete"]=function(e){return this.store["delete"](e)}},{}],13:[function(p,x,h){function d(){m=!1,c.length?q=c.concat(q):j=-1,q.length&&g()}function g(){if(!m){var f=setTimeout(d);m=!0;for(var e=q.length;e;){for(c=q,q=[];++j<e;){c&&c[j].run()}j=-1,e=q.length}c=null,m=!1,clearTimeout(f)}}function k(f,e){this.fun=f,this.array=e}function v(){}var c,w=x.exports={},q=[],m=!1,j=-1;w.nextTick=function(f){var e=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){e[i-1]=arguments[i]}}q.push(new k(f,e)),1!==q.length||m||setTimeout(g,0)},k.prototype.run=function(){this.fun.apply(null,this.array)},w.title="browser",w.browser=!0,w.env={},w.argv=[],w.version="",w.versions={},w.on=v,w.addListener=v,w.once=v,w.off=v,w.removeListener=v,w.removeAllListeners=v,w.emit=v,w.binding=function(e){throw new Error("process.binding is not supported")},w.cwd=function(){return"/"},w.chdir=function(e){throw new Error("process.chdir is not supported")},w.umask=function(){return 0}},{}],14:[function(c,f,d){(function(){var e={}.hasOwnProperty,g=[].slice;f.exports=function(n,k){var j,m,l,i;m=[],i=[];for(j in k){e.call(k,j)&&(l=k[j],"this"!==j&&(m.push(j),i.push(l)))}return Function.apply(null,g.call(m).concat([n])).apply(k["this"],i)}}).call(this)},{}],15:[function(e,d,c){!function(g){if("object"==typeof c){d.exports=g()}else{if("function"==typeof b&&b.amd){b(g)}else{var h;try{h=window}catch(f){h=self}h.SparkMD5=g()}}}(function(H){function D(i,h,n,m,l,g){return h=E(E(h,i),E(m,g)),E(h<<l|h>>>32-l,n)}function x(m,n,l,h,g,o,i){return D(n&l|~n&h,m,n,g,o,i)}function I(m,n,l,h,g,o,i){return D(n&h|l&~h,m,n,g,o,i)}function w(m,n,l,h,g,o,i){return D(n^l^h,m,n,g,o,i)}function B(m,n,l,h,g,o,i){return D(l^(n|~h),m,n,g,o,i)}function M(i,h){var n=i[0],m=i[1],g=i[2],l=i[3];n=x(n,m,g,l,h[0],7,-680876936),l=x(l,n,m,g,h[1],12,-389564586),g=x(g,l,n,m,h[2],17,606105819),m=x(m,g,l,n,h[3],22,-1044525330),n=x(n,m,g,l,h[4],7,-176418897),l=x(l,n,m,g,h[5],12,1200080426),g=x(g,l,n,m,h[6],17,-1473231341),m=x(m,g,l,n,h[7],22,-45705983),n=x(n,m,g,l,h[8],7,1770035416),l=x(l,n,m,g,h[9],12,-1958414417),g=x(g,l,n,m,h[10],17,-42063),m=x(m,g,l,n,h[11],22,-1990404162),n=x(n,m,g,l,h[12],7,1804603682),l=x(l,n,m,g,h[13],12,-40341101),g=x(g,l,n,m,h[14],17,-1502002290),m=x(m,g,l,n,h[15],22,1236535329),n=I(n,m,g,l,h[1],5,-165796510),l=I(l,n,m,g,h[6],9,-1069501632),g=I(g,l,n,m,h[11],14,643717713),m=I(m,g,l,n,h[0],20,-373897302),n=I(n,m,g,l,h[5],5,-701558691),l=I(l,n,m,g,h[10],9,38016083),g=I(g,l,n,m,h[15],14,-660478335),m=I(m,g,l,n,h[4],20,-405537848),n=I(n,m,g,l,h[9],5,568446438),l=I(l,n,m,g,h[14],9,-1019803690),g=I(g,l,n,m,h[3],14,-187363961),m=I(m,g,l,n,h[8],20,1163531501),n=I(n,m,g,l,h[13],5,-1444681467),l=I(l,n,m,g,h[2],9,-51403784),g=I(g,l,n,m,h[7],14,1735328473),m=I(m,g,l,n,h[12],20,-1926607734),n=w(n,m,g,l,h[5],4,-378558),l=w(l,n,m,g,h[8],11,-2022574463),g=w(g,l,n,m,h[11],16,1839030562),m=w(m,g,l,n,h[14],23,-35309556),n=w(n,m,g,l,h[1],4,-1530992060),l=w(l,n,m,g,h[4],11,1272893353),g=w(g,l,n,m,h[7],16,-155497632),m=w(m,g,l,n,h[10],23,-1094730640),n=w(n,m,g,l,h[13],4,681279174),l=w(l,n,m,g,h[0],11,-358537222),g=w(g,l,n,m,h[3],16,-722521979),m=w(m,g,l,n,h[6],23,76029189),n=w(n,m,g,l,h[9],4,-640364487),l=w(l,n,m,g,h[12],11,-421815835),g=w(g,l,n,m,h[15],16,530742520),m=w(m,g,l,n,h[2],23,-995338651),n=B(n,m,g,l,h[0],6,-198630844),l=B(l,n,m,g,h[7],10,1126891415),g=B(g,l,n,m,h[14],15,-1416354905),m=B(m,g,l,n,h[5],21,-57434055),n=B(n,m,g,l,h[12],6,1700485571),l=B(l,n,m,g,h[3],10,-1894986606),g=B(g,l,n,m,h[10],15,-1051523),m=B(m,g,l,n,h[1],21,-2054922799),n=B(n,m,g,l,h[8],6,1873313359),l=B(l,n,m,g,h[15],10,-30611744),g=B(g,l,n,m,h[6],15,-1560198380),m=B(m,g,l,n,h[13],21,1309151649),n=B(n,m,g,l,h[4],6,-145523070),l=B(l,n,m,g,h[11],10,-1120210379),g=B(g,l,n,m,h[2],15,718787259),m=B(m,g,l,n,h[9],21,-343485551),i[0]=E(n,i[0]),i[1]=E(m,i[1]),i[2]=E(g,i[2]),i[3]=E(l,i[3])}function F(g){var i,h=[];for(i=0;64>i;i+=4){h[i>>2]=g.charCodeAt(i)+(g.charCodeAt(i+1)<<8)+(g.charCodeAt(i+2)<<16)+(g.charCodeAt(i+3)<<24)}return h}function q(g){var i,h=[];for(i=0;64>i;i+=4){h[i>>2]=g[i]+(g[i+1]<<8)+(g[i+2]<<16)+(g[i+3]<<24)}return h}function K(g){var p,h,o,r,m,l,i=g.length,n=[1732584193,-271733879,-1732584194,271733878];for(p=64;i>=p;p+=64){M(n,F(g.substring(p-64,p)))}for(g=g.substring(p-64),h=g.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],p=0;h>p;p+=1){o[p>>2]|=g.charCodeAt(p)<<(p%4<<3)}if(o[p>>2]|=128<<(p%4<<3),p>55){for(M(n,o),p=0;16>p;p+=1){o[p]=0}}return r=8*i,r=r.toString(16).match(/(.*?)(.{0,8})$/),m=parseInt(r[2],16),l=parseInt(r[1],16)||0,o[14]=m,o[15]=l,M(n,o),n}function G(g){var l,h,o,r,m,p,i=g.length,n=[1732584193,-271733879,-1732584194,271733878];for(l=64;i>=l;l+=64){M(n,q(g.subarray(l-64,l)))}for(g=i>l-64?g.subarray(l-64):new Uint8Array(0),h=g.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],l=0;h>l;l+=1){o[l>>2]|=g[l]<<(l%4<<3)}if(o[l>>2]|=128<<(l%4<<3),l>55){for(M(n,o),l=0;16>l;l+=1){o[l]=0}}return r=8*i,r=r.toString(16).match(/(.*?)(.{0,8})$/),m=parseInt(r[2],16),p=parseInt(r[1],16)||0,o[14]=m,o[15]=p,M(n,o),n}function A(g){var i,h="";for(i=0;4>i;i+=1){h+=L[g>>8*i+4&15]+L[g>>8*i&15]}return h}function J(h){var g;for(g=0;g<h.length;g+=1){h[g]=A(h[g])}return h.join("")}function C(g){return/[\u0080-\uFFFF]/.test(g)&&(g=unescape(encodeURIComponent(g))),g}function k(i,h){var n,m=i.length,l=new ArrayBuffer(m),g=new Uint8Array(l);for(n=0;m>n;n+=1){g[n]=i.charCodeAt(n)}return h?g:l}function j(g){return String.fromCharCode.apply(null,new Uint8Array(g))}function f(h,g,i){var l=new Uint8Array(h.byteLength+g.byteLength);return l.set(new Uint8Array(h)),l.set(new Uint8Array(g),h.byteLength),i?l:l.buffer}function N(h){var g,i=[],l=h.length;for(g=0;l-1>g;g+=2){i.push(parseInt(h.substr(g,2),16))}return String.fromCharCode.apply(String,i)}function z(){this.reset()}var E=function(h,g){return h+g&4294967295},L=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return"5d41402abc4b2a76b9719d911017c592"!==J(K("hello"))&&(E=function(h,g){var i=(65535&h)+(65535&g),l=(h>>16)+(g>>16)+(i>>16);return l<<16|65535&i}),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||!function(){function g(h,i){return h=0|h||0,0>h?Math.max(h+i,0):Math.min(h,i)}ArrayBuffer.prototype.slice=function(s,n){var r,l,i,p,m=this.byteLength,h=g(s,m),o=m;return n!==H&&(o=g(n,m)),h>o?new ArrayBuffer(0):(r=o-h,l=new ArrayBuffer(r),i=new Uint8Array(l),p=new Uint8Array(this,h,r),i.set(p),l)}}(),z.prototype.append=function(g){return this.appendBinary(C(g)),this},z.prototype.appendBinary=function(g){this._buff+=g,this._length+=g.length;var i,h=this._buff.length;for(i=64;h>=i;i+=64){M(this._hash,F(this._buff.substring(i-64,i)))}return this._buff=this._buff.substring(i-64),this},z.prototype.end=function(i){var h,n,m=this._buff,l=m.length,g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(h=0;l>h;h+=1){g[h>>2]|=m.charCodeAt(h)<<(h%4<<3)}return this._finish(g,l),n=J(this._hash),i&&(n=N(n)),this.reset(),n},z.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},z.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},z.prototype.setState=function(g){return this._buff=g.buff,this._length=g.length,this._hash=g.hash,this},z.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},z.prototype._finish=function(i,h){var n,m,l,g=h;if(i[g>>2]|=128<<(g%4<<3),g>55){for(M(this._hash,i),g=0;16>g;g+=1){i[g]=0}}n=8*this._length,n=n.toString(16).match(/(.*?)(.{0,8})$/),m=parseInt(n[2],16),l=parseInt(n[1],16)||0,i[14]=m,i[15]=l,M(this._hash,i)},z.hash=function(h,g){return z.hashBinary(C(h),g)},z.hashBinary=function(h,g){var i=K(h),l=J(i);return g?N(l):l},z.ArrayBuffer=function(){this.reset()},z.ArrayBuffer.prototype.append=function(h){var g,i=f(this._buff.buffer,h,!0),l=i.length;for(this._length+=h.byteLength,g=64;l>=g;g+=64){M(this._hash,q(i.subarray(g-64,g)))}return this._buff=l>g-64?new Uint8Array(i.buffer.slice(g-64)):new Uint8Array(0),this},z.ArrayBuffer.prototype.end=function(i){var h,n,m=this._buff,l=m.length,g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(h=0;l>h;h+=1){g[h>>2]|=m[h]<<(h%4<<3)}return this._finish(g,l),n=J(this._hash),i&&(n=N(n)),this.reset(),n},z.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},z.ArrayBuffer.prototype.getState=function(){var g=z.prototype.getState.call(this);return g.buff=j(g.buff),g},z.ArrayBuffer.prototype.setState=function(g){return g.buff=k(g.buff,!0),z.prototype.setState.call(this,g)},z.ArrayBuffer.prototype.destroy=z.prototype.destroy,z.ArrayBuffer.prototype._finish=z.prototype._finish,z.ArrayBuffer.hash=function(h,g){var i=G(new Uint8Array(h)),l=J(i);return g?N(l):l},z})},{}],16:[function(c,f,d){function g(l,e,k){var j=k[k.length-1];l===j.element&&(k.pop(),j=k[k.length-1]);var h=j.element,p=j.index;if(Array.isArray(h)){h.push(l)}else{if(p===e.length-2){var m=e.pop();h[m]=l}else{e.push(l)}}}d.stringify=function(y){var p=[];p.push({obj:y});for(var e,z,B,m,h,q,j,x,w,k,A,v="";e=p.pop();){if(z=e.obj,B=e.prefix||"",m=e.val||"",v+=B,m){v+=m}else{if("object"!=typeof z){v+="undefined"==typeof z?null:JSON.stringify(z)}else{if(null===z){v+="null"}else{if(Array.isArray(z)){for(p.push({val:"]"}),h=z.length-1;h>=0;h--){q=0===h?"":",",p.push({obj:z[h],prefix:q})}p.push({val:"["})}else{j=[];for(x in z){z.hasOwnProperty(x)&&j.push(x)}for(p.push({val:"}"}),h=j.length-1;h>=0;h--){w=j[h],k=z[w],A=h>0?",":"",A+=JSON.stringify(w)+":",p.push({obj:k,prefix:A})}p.push({val:"{"})}}}}}return v},d.parse=function(w){for(var k,z,x,m,h,p,v,e,r,j=[],y=[],q=0;;){if(k=w[q++],"}"!==k&&"]"!==k&&"undefined"!=typeof k){switch(k){case" ":case"	":case"\n":case":":case",":break;case"n":q+=3,g(null,j,y);break;case"t":q+=3,g(!0,j,y);break;case"f":q+=4,g(!1,j,y);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(z="",q--;;){if(x=w[q++],!/[\d\.\-e\+]/.test(x)){q--;break}z+=x}g(parseFloat(z),j,y);break;case'"':for(m="",h=void 0,p=0;;){if(v=w[q++],'"'===v&&("\\"!==h||p%2!==1)){break}m+=v,h=v,"\\"===h?p++:p=0}g(JSON.parse('"'+m+'"'),j,y);break;case"[":e={element:[],index:j.length},j.push(e.element),y.push(e);break;case"{":r={element:{},index:j.length},j.push(r.element),y.push(r);break;default:throw new Error("unexpectedly reached end of input: "+k)}}else{if(1===j.length){return j.pop()}g(j.pop(),j,y)}}}},{}],17:[function(c,f,d){(function(eT,db){function eL(g){return g&&"object"==typeof g&&"default" in g?g["default"]:g}function d1(k,i){for(var h={},j=0,l=i.length;l>j;j++){var g=i[j];g in k&&(h[g]=k[g])}return h}function fC(g){return g instanceof ArrayBuffer||"undefined"!=typeof Blob&&g instanceof Blob}function j2(j){if("function"==typeof j.slice){return j.slice(0)}var h=new ArrayBuffer(j.byteLength),g=new Uint8Array(h),i=new Uint8Array(j);return g.set(i),h}function jV(i){if(i instanceof ArrayBuffer){return j2(i)}var h=i.size,g=i.type;return"function"==typeof i.slice?i.slice(0,h,g):i.webkitSlice(0,h,g)}function eX(j){var h,g,i;if(!j||"object"!=typeof j){return j}if(Array.isArray(j)){for(h=[],g=0,i=j.length;i>g;g++){h[g]=eX(j[g])}return h}if(j instanceof Date){return j.toISOString()}if(fC(j)){return jV(j)}h={};for(g in j){if(Object.prototype.hasOwnProperty.call(j,g)){var k=eX(j[g]);"undefined"!=typeof k&&(h[g]=k)}}return h}function eD(g){var h=!1;return b3(function(i){if(h){throw new Error("once called more than once")}h=!0,g.apply(this,i)})}function dx(g){return b3(function(j){j=eX(j);var k,l=this,i="function"==typeof j[j.length-1]?j.pop():!1;i&&(k=function(m,n){eT.nextTick(function(){i(m,n)})});var h=new eh(function(n,m){var p;try{var o=eD(function(r,s){r?m(r):n(s)});j.push(o),p=g.apply(l,j),p&&"function"==typeof p.then&&n(p)}catch(q){m(q)}});return k&&h.then(function(m){k(null,m)},k),h})}function eP(i,h){function g(n,l,j){if(cV.enabled){for(var m=[n._db_name,l],o=0;o<j.length-1;o++){m.push(j[o])}cV.apply(null,m);var k=j[j.length-1];j[j.length-1]=function(r,p){var q=[n._db_name,l];q=q.concat(r?["error",r]:["success",p]),cV.apply(null,q),k(r,p)}}}return dx(b3(function(j){if(this._closed){return eh.reject(new Error("database is closed"))}if(this._destroyed){return eh.reject(new Error("database is destroyed"))}var k=this;return g(k,i,j),this.taskqueue.isReady?h.apply(this,j):new eh(function(l,m){k.taskqueue.addTask(function(n){n?m(n):l(k[i].apply(k,j))})})}))}function ea(i,h,g){return new eh(function(j,k){i.get(h,function(o,m){if(o){if(404!==o.status){return k(o)}m={}}var l=m._rev,n=g(m);return n?(n._id=h,n._rev=l,void j(dl(i,n,g))):j({updated:!1,rev:l})})})}function dl(i,h,g){return i.put(h).then(function(j){return{updated:!0,rev:j.rev}},function(j){if(409!==j.status){throw j}return ea(i,h._id,g)})}function jU(r){for(var l,o,m,n,q=r.rev_tree.slice();n=q.pop();){var j=n.ids,s=j[2],k=n.pos;if(s.length){for(var i=0,g=s.length;g>i;i++){q.push({pos:k+1,ids:s[i]})}}else{var p=!!j[1].deleted,h=j[0];l&&!(m!==p?m:o!==k?k>o:h>l)||(l=h,o=k,m=p)}}return o+"-"+l}function jK(g){return g.ids}function fD(j,h){h||(h=jU(j));for(var g,i=h.substring(h.indexOf("-")+1),k=j.rev_tree.map(jK);g=k.pop();){if(g[0]===i){return !!g[1].deleted}k=k.concat(g[2])}}function e2(g){return e1("return "+g+";",{})}function ej(g){return new Function("doc",["var emitted = false;","var emit = function (a, b) {","  emitted = true;","};","var view = "+g+";","view(doc);","if (emitted) {","  return true;","}"].join("\n"))}function e6(g){if(!g){return null}var h=g.split("/");return 2===h.length?h:1===h.length?[g,g]:null}function jR(g){var h=e6(g);return h?h.join("/"):null}function fH(o,h){for(var l,j=o.slice();l=j.pop();){for(var k=l.pos,m=l.ids,g=m[2],i=h(0===g.length,k,m[0],l.ctx,m[1]),n=0,p=g.length;p>n;n++){j.push({pos:k+1,ids:g[n],ctx:i})}}}function j4(g,h){return g.pos-h.pos}function dD(j){var h=[];fH(j,function(n,k,m,o,l){n&&h.push({rev:k+"-"+m,pos:k,opts:l})}),h.sort(j4).reverse();for(var g=0,i=h.length;i>g;g++){delete h[g].pos}return h}function df(m){for(var k=jU(m),g=dD(m.rev_tree),l=[],i=0,j=g.length;j>i;i++){var h=g[i];h.rev===k||h.opts.deleted||l.push(h.rev)}return l}function jM(g){Error.call(this,g.reason),this.status=g.status,this.name=g.error,this.message=g.reason,this.error=!0}function jP(j,h,g){function i(k){for(var l in j){"function"!=typeof j[l]&&(this[l]=j[l])}void 0!==g&&(this.name=g),void 0!==k&&(this.reason=k)}return i.prototype=jM.prototype,new i(h)}function cN(k){var i,h,j,l,g;return h=k.error===!0&&"string"==typeof k.name?k.name:k.error,g=k.reason,j=jG("name",h,g),k.missing||"missing"===g||"deleted"===g||"not_found"===h?j=aV:"doc_validation"===h?(j=bM,l=g):"bad_request"===h&&j.message!==g&&(j=bQ),j||(j=jG("status",k.status,g)||cW),i=jP(j,g,h),l&&(i.message=l),k.id&&(i.id=k.id),k.status&&(i.status=k.status),k.missing&&(i.missing=k.missing),i}function kb(m,k,g){function l(){i.cancel()}aH.EventEmitter.call(this);var i=this;this.db=m,k=k?eX(k):{};var j=k.complete=eD(function(n,o){n?i.emit("error",n):i.emit("complete",o),i.removeAllListeners(),m.removeListener("destroyed",l)});g&&(i.on("complete",function(n){g(null,n)}),i.on("error",g)),m.once("destroyed",l),k.onChange=function(n){k.isCancelled||(i.emit("change",n),i.startSeq&&i.startSeq<=n.seq&&(i.startSeq=!1))};var h=new eh(function(n,o){k.complete=function(p,q){p?o(p):n(q)}});i.once("cancel",function(){m.removeListener("destroyed",l),k.complete(null,{status:"cancelled"})}),this.then=h.then.bind(h),this["catch"]=h["catch"].bind(h),this.then(function(n){j(null,n)},j),m.taskqueue.isReady?i.doChanges(k):m.taskqueue.addTask(function(){i.isCancelled?i.emit("cancel"):i.doChanges(k)})}function dR(j,h,g){var i=[{rev:j._rev}];"all_docs"===g.style&&(i=dD(h.rev_tree).map(function(l){return{rev:l.rev}}));var k={id:h.id,changes:i,doc:j};return fD(h,j._rev)&&(k.deleted=!0),g.conflicts&&(k.doc._conflicts=df(h),k.doc._conflicts.length||delete k.doc._conflicts),k}function f5(q,i,m){function k(){var r=[];n.forEach(function(s){s.docs.forEach(function(u){r.push({id:s.id,docs:[u]})})}),m(null,{results:r})}function l(){++o===g&&k()}function p(r,u,s){n[r]={id:u,docs:s},l()}var j=Array.isArray(i)?i:i.docs,h={};j.forEach(function(r){r.id in h?h[r.id].push(r):h[r.id]=[r]});var g=Object.keys(h).length,o=0,n=new Array(g);Object.keys(h).forEach(function(u,r){var v=h[u],s=d1(v[0],["atts_since","attachments"]);s.open_revs=v.map(function(x){return x.rev}),s.open_revs=s.open_revs.filter(function(x){return x});var w=function(x){return x};0===s.open_revs.length&&(delete s.open_revs,w=function(x){return[{ok:x}]}),["revs","attachments","binary","ajax"].forEach(function(x){x in i&&(s[x]=i[x])}),q.get(u,s,function(y,x){p(r,u,y?[{error:y}]:w(x))})})}function fO(g){return/^_local/.test(g)}function fJ(r){for(var l,o=[],m=r.slice();l=m.pop();){var n=l.pos,q=l.ids,j=q[0],s=q[1],k=q[2],i=0===k.length,g=l.history?l.history.slice():[];g.push({id:j,opts:s}),i&&o.push({pos:n+1-g.length,ids:g});for(var p=0,h=k.length;h>p;p++){m.push({pos:n+1,ids:k[p],history:g})}}return o.reverse()}function j5(g){return 0|Math.random()*g}function fP(j,h){h=h||cy.length;var g="",i=-1;if(j){for(;++i<j;){g+=cy[j5(h)]}return g}for(;++i<36;){switch(i){case 8:case 13:case 18:case 23:g+="-";break;case 19:g+=cy[3&j5(16)|8];break;default:g+=cy[j5(16)]}}return g}function kc(g){return g.reduce(function(i,h){return i[h]=!0,i},{})}function jJ(g){var h;if(g?"string"!=typeof g?h=jP(j1):/^_/.test(g)&&!/^_(design|local)/.test(g)&&(h=jP(dJ)):h=jP(by),h){throw h}}function ke(j){if(!/^\d+\-./.test(j)){return jP(fK)}var h=j.indexOf("-"),g=j.substring(0,h),i=j.substring(h+1);return{prefix:parseInt(g,10),id:i}}function fG(m,k){for(var g=m.start-m.ids.length+1,l=m.ids,i=[l[0],k,[]],j=1,h=l.length;h>j;j++){i=[l[j],{status:"missing"},[i]]}return[{pos:g,ids:i}]}function cD(o,h){var l,j,k,m={status:"available"};if(o._deleted&&(m.deleted=!0),h){if(o._id||(o._id=fP()),j=fP(32,16).toLowerCase(),o._rev){if(k=ke(o._rev),k.error){return k}o._rev_tree=[{pos:k.prefix,ids:[k.id,{status:"missing"},[[j,m,[]]]]}],l=k.prefix+1}else{o._rev_tree=[{pos:1,ids:[j,m,[]]}],l=1}}else{if(o._revisions&&(o._rev_tree=fG(o._revisions,m),l=o._revisions.start,j=o._revisions.ids[0]),!o._rev_tree){if(k=ke(o._rev),k.error){return k}l=k.prefix,j=k.id,o._rev_tree=[{pos:l,ids:[j,m,[]]}]}}jJ(o._id),o._rev=l+"-"+j;var g={metadata:{},data:{}};for(var i in o){if(Object.prototype.hasOwnProperty.call(o,i)){var n="_"===i[0];if(n&&!bW[i]){var p=jP(bM,i);throw p.message=bM.message+": "+i,p}n&&!ck[i]?g.metadata[i.slice(1)]=o[i]:g.data[i]=o[i]}}return g}function j9(g,h){return h>g?-1:g>h?1:0}function fQ(i,h){for(var g=0;g<i.length;g++){if(h(i[g],g)===!0){return i[g]}}}function fL(g){return function(h,i){h||i[0]&&i[0].error?g(h||i[0]):g(null,i.length?i[0]:i)}}function eH(k){for(var i=0;i<k.length;i++){var h=k[i];if(h._deleted){delete h._attachments}else{if(h._attachments){for(var j=Object.keys(h._attachments),l=0;l<j.length;l++){var g=j[l];h._attachments[g]=d1(h._attachments[g],["data","digest","content_type","length","revpos","stub"])}}}}}function fM(j,h){var g=j9(j._id,h._id);if(0!==g){return g}var i=j._revisions?j._revisions.start:0,k=h._revisions?h._revisions.start:0;return j9(i,k)}function cp(i){var h={},g=[];return fH(i,function(n,m,j,l){var k=m+"-"+j;return n&&(h[k]=0),void 0!==l&&g.push({from:l,to:k}),k}),g.reverse(),g.forEach(function(j){void 0===h[j.from]?h[j.from]=1+h[j.to]:h[j.from]=Math.min(h[j.from],1+h[j.to])}),h}function f1(j,h,g){var i="limit" in h?h.keys.slice(h.skip,h.limit+h.skip):h.skip>0?h.keys.slice(h.skip):h.keys;if(h.descending&&i.reverse(),!i.length){return j._allDocs({limit:0},g)}var k={offset:h.skip};return eh.all(i.map(function(m){var l=dE.extend({key:m,deleted:"ok"},h);return["limit","skip","keys"].forEach(function(n){delete l[n]}),new eh(function(n,o){j._allDocs(l,function(q,p){return q?o(q):(k.total_rows=p.total_rows,void n(p.rows[0]||{key:m,error:"not_found"}))})})})).then(function(l){return k.rows=l,k})}function eE(j){var h=j._compactionQueue[0],i=h.opts,g=h.callback;j.get("_local/compaction")["catch"](function(){return !1}).then(function(k){k&&k.last_seq&&(i.last_seq=k.last_seq),j._compact(i,function(l,m){l?g(l):g(null,m),eT.nextTick(function(){j._compactionQueue.shift(),j._compactionQueue.length&&eE(j)})})})}function kj(g){return"_"===g.charAt(0)?g+"is not a valid attachment name, attachment names cannot start with '_'":!1}function j6(j,h,g,i){h.seq=h.seq||0;var k={doc_ids:["_design/"+g],limit:1,since:h.seq};j.changes(k).then(function(l){var m=l.results&&l.results.length&&l.results[0].seq;m&&m>h.seq&&(h.seq=m,delete h.promise),i()})["catch"](i)}function jT(j,h,g){j._ddocCache=j._ddocCache||{},j._ddocCache[h]=j._ddocCache[h]||{};var i=j._ddocCache[h];j6(j,i,h,function(k){return k?g(k):(i.promise||(i.promise=new eh(function(m,l){j._get("_design/"+h,{},function(p,o){if(p){return l(p)}var n={};["views","filters"].forEach(function(q){n[q]=o.doc[q]}),m(n)})})),void i.promise.then(function(l){g(null,l)})["catch"](g))})}function ek(j,h,g,i,k){jT(j,h,function(l,n){if(l){return k(l)}var m=n[g]&&n[g][i];return m?void k(null,m):k(jP(aV))})}function ec(){aH.EventEmitter.call(this)}function bZ(){this.isReady=!1,this.failed=!1,this.queue=[]}function jD(g){g&&db.debug&&console.error(g)}function c3(m,k){function g(){j.emit("destroyed",i)}function l(){m.removeListener("destroyed",g),m.emit("destroyed",m)}var i=k.originalName,j=m.constructor,h=j._destructionListeners;m.once("destroyed",g),h.has(i)||h.set(i,[]),h.get(i).push(l)}function bG(k,i,h){if(!(this instanceof bG)){return new bG(k,i,h)}var j=this;"function"!=typeof i&&"undefined"!=typeof i||(h=i,i={}),k&&"object"==typeof k&&(i=k,k=void 0),"undefined"==typeof h&&(h=jD),k=k||i.name,i=eX(i),delete i.name,this.__opts=i;var l=h;j.auto_compaction=i.auto_compaction,j.prefix=bG.prefix,ec.call(j),j.taskqueue=new bZ;var g=new eh(function(n,q){h=function(r,s){return r?q(r):(delete s.then,void n(s))},i=eX(i);var o,m,p=i.name||k;return function(){try{if("string"!=typeof p){throw m=new Error("Missing/invalid DB name"),m.code=400,m}if(o=bG.parseAdapter(p,i),i.originalName=p,i.name=o.name,i.prefix&&"http"!==o.adapter&&"https"!==o.adapter&&(i.name=i.prefix+i.name),i.adapter=i.adapter||o.adapter,j._adapter=i.adapter,c2("pouchdb:adapter")("Picked adapter: "+i.adapter),j._db_name=p,!bG.adapters[i.adapter]){throw m=new Error("Adapter is missing"),m.code=404,m}if(!bG.adapters[i.adapter].valid()){throw m=new Error("Invalid Adapter"),m.code=404,m}}catch(r){j.taskqueue.fail(r)}}(),m?q(m):(j.adapter=i.adapter,j.replicate={},j.replicate.from=function(r,u,s){return j.constructor.replicate(r,j,u,s)},j.replicate.to=function(r,u,s){return j.constructor.replicate(j,r,u,s)},j.sync=function(r,u,s){return j.constructor.sync(j,r,u,s)},j.replicate.sync=j.sync,void bG.adapters[i.adapter].call(j,i,function(r){return r?(j.taskqueue.fail(r),void h(r)):(c3(j,i),j.emit("created",j),bG.emit("created",i.originalName),j.taskqueue.ready(j),void h(null,j))}))});g.then(function(m){l(null,m)},l),j.then=g.then.bind(g),j["catch"]=g["catch"].bind(g)}function eU(){return"undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage&&"undefined"!=typeof chrome.storage.local}function eg(){return dK}function jQ(g){Object.keys(aH.EventEmitter.prototype).forEach(function(i){"function"==typeof aH.EventEmitter.prototype[i]&&(g[i]=jY[i].bind(jY))});var h=g._destructionListeners=new dT.Map;g.on("destroyed",function(i){h.has(i)&&(h.get(i).forEach(function(j){j()}),h["delete"](i))})}function c6(k,i){k=k||[],i=i||{};try{return new Blob(k,i)}catch(h){if("TypeError"!==h.name){throw h}for(var j="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder,l=new j,g=0;g<k.length;g+=1){l.append(k[g])}return l.getBlob(i.type)}}function aN(i,h){if("undefined"==typeof FileReader){return h((new FileReaderSync).readAsArrayBuffer(i))}var g=new FileReader;g.onloadend=function(j){var k=j.target.result||new ArrayBuffer(0);h(k)},g.readAsArrayBuffer(i)}function eI(){for(var j={},h=new eh(function(k,l){j.resolve=k,j.reject=l}),g=new Array(arguments.length),i=0;i<g.length;i++){g[i]=arguments[i]}return j.promise=h,eh.resolve().then(function(){return fetch.apply(null,g)}).then(function(k){j.resolve(k)})["catch"](function(k){j.reject(k)}),j}function c1(m,k){var g,l,i,j=new Headers,h={method:m.method,credentials:"include",headers:j};return m.json&&(j.set("Accept","application/json"),j.set("Content-Type",m.headers["Content-Type"]||"application/json")),m.body&&m.body instanceof Blob?aN(m.body,function(n){h.body=n}):m.body&&m.processData&&"string"!=typeof m.body?h.body=JSON.stringify(m.body):"body" in m?h.body=m.body:h.body=null,Object.keys(m.headers).forEach(function(n){m.headers.hasOwnProperty(n)&&j.set(n,m.headers[n])}),g=eI(m.url,h),m.timeout>0&&(l=setTimeout(function(){g.reject(new Error("Load timeout for resource: "+m.url))},m.timeout)),g.promise.then(function(n){return i={statusCode:n.status},m.timeout>0&&clearTimeout(l),i.statusCode>=200&&i.statusCode<300?m.binary?n.blob():n.text():n.json()}).then(function(n){i.statusCode>=200&&i.statusCode<300?k(null,i,n):k(n,i)})["catch"](function(n){k(n,i)}),{abort:g.reject}}function bx(m,n){var k,i,j=!1,l=function(){k.abort()},o=function(){j=!0,k.abort()};k=m.xhr?new m.xhr:new XMLHttpRequest;try{k.open(m.method,m.url)}catch(h){n(h,{statusCode:413})}k.withCredentials="withCredentials" in m?m.withCredentials:!0,"GET"===m.method?delete m.headers["Content-Type"]:m.json&&(m.headers.Accept="application/json",m.headers["Content-Type"]=m.headers["Content-Type"]||"application/json",m.body&&m.processData&&"string"!=typeof m.body&&(m.body=JSON.stringify(m.body))),m.binary&&(k.responseType="arraybuffer"),"body" in m||(m.body=null);for(var g in m.headers){m.headers.hasOwnProperty(g)&&k.setRequestHeader(g,m.headers[g])}return m.timeout>0&&(i=setTimeout(o,m.timeout),k.onprogress=function(){clearTimeout(i),4!==k.readyState&&(i=setTimeout(o,m.timeout))},"undefined"!=typeof k.upload&&(k.upload.onprogress=k.onprogress)),k.onreadystatechange=function(){if(4===k.readyState){var s={statusCode:k.status};if(k.status>=200&&k.status<300){var q;q=m.binary?c6([k.response||""],{type:k.getResponseHeader("Content-Type")}):k.responseText,n(null,s,q)}else{var p={};if(j){p=new Error("ETIMEDOUT"),s.statusCode=400}else{try{p=JSON.parse(k.response)}catch(r){}}n(p,s)}}},m.body&&m.body instanceof Blob?aN(m.body,function(p){k.send(p)}):k.send(m.body),{abort:l}}function ah(){try{return new XMLHttpRequest,!0}catch(g){return !1}}function eY(g,h){return bc||g.xhr?bx(g,h):c1(g,h)}function aA(){return""}function av(j,h){function g(m,l,n){if(!j.binary&&j.json&&"string"==typeof m){try{m=JSON.parse(m)}catch(o){return n(o)}}Array.isArray(m)&&(m=m.map(function(p){return p.error||p.missing?cN(p):p})),j.binary&&dH(m,l),n(null,m,l)}function i(p,n){var l,o;if(p.code&&p.status){var q=new Error(p.message||p.code);return q.status=p.status,n(q)}if(p.message&&"ETIMEDOUT"===p.message){return n(p)}try{l=JSON.parse(p.responseText),o=cN(l)}catch(m){o=cN(p)}n(o)}j=eX(j);var k={method:"GET",headers:{},json:!0,processData:!0,timeout:10000,cache:!1};return j=dE.extend(k,j),j.json&&(j.binary||(j.headers.Accept="application/json"),j.headers["Content-Type"]=j.headers["Content-Type"]||"application/json"),j.binary&&(j.encoding=null,j.json=!1),j.processData||(j.json=!1),eY(j,function(r,o,m){if(r){return r.status=o?o.statusCode:400,i(r,h)}var p,n=o.headers&&o.headers["content-type"],l=m||aA();if(!j.binary&&(j.json||!j.processData)&&"object"!=typeof l&&(/json/.test(n)||/^[\s]*\{/.test(l)&&/\}[\s]*$/.test(l))){try{l=JSON.parse(l.toString())}catch(q){}}o.statusCode>=200&&o.statusCode<300?g(l,o,h):(p=cN(l),p.status=o.statusCode,h(p))})}function ef(o,h){var l=navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",j=-1!==l.indexOf("safari")&&-1===l.indexOf("chrome"),k=-1!==l.indexOf("msie"),m=-1!==l.indexOf("edge"),g=j||(k||m)&&"GET"===o.method,i="cache" in o?o.cache:!0,n=/^blob:/.test(o.url);if(!n&&(g||!i)){var p=-1!==o.url.indexOf("?");o.url+=(p?"&":"?")+"_nonce="+Date.now()}return av(o,h)}function aP(m){for(var k=e.exec(m),g={},l=14;l--;){var i=aO[l],j=k[l]||"",h=-1!==["user","password"].indexOf(i);g[i]=h?decodeURIComponent(j):j}return g[eC]={},g[aO[12]].replace(b4,function(p,n,o){n&&(g[eC][n]=o)}),g}function cH(j){for(var h=j.length,g=new ArrayBuffer(h),i=new Uint8Array(g),k=0;h>k;k++){i[k]=j.charCodeAt(k)}return g}function d6(g,h){return c6([cH(g)],{type:h})}function f2(j,h,g){try{return !j(h,g)}catch(i){var k="Filter function threw: "+i.toString();return jP(bQ,k)}}function dC(i){var h={},g=i.filter&&"function"==typeof i.filter;return h.query=i.query_params,function(k){k.doc||(k.doc={});var l=g&&f2(i.filter,k.doc,h);if("object"==typeof l){return l}if(l){return !1}if(i.include_docs){if(!i.attachments){for(var j in k.doc._attachments){k.doc._attachments.hasOwnProperty(j)&&(k.doc._attachments[j].stub=!0)}}}else{delete k.doc}return !0}}function ak(g,h){"console" in db&&"info" in console&&console.info("The above "+g+" is totally normal. "+h)}function bF(j,h,g,i,k){return j.get(h)["catch"](function(l){if(404===l.status){return"http"===j.type()&&ak(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:i,_id:h,history:[],replicator:dY,version:f7}}throw l}).then(function(l){return k.cancelled?void 0:(l.history=(l.history||[]).filter(function(m){return m.session_id!==i}),l.history.unshift({last_seq:g,session_id:i}),l.history=l.history.slice(0,b8),l.version=f7,l.replicator=dY,l.session_id=i,l.last_seq=g,j.put(l)["catch"](function(m){if(409===m.status){return bF(j,h,g,i,k)}throw m}))})}function aQ(j,h,g,i){this.src=j,this.target=h,this.id=g,this.returnValue=i}function cj(j,h){if(j.session_id===h.session_id){return{last_seq:j.last_seq,history:j.history||[]}}var g=j.history||[],i=h.history||[];return bL(g,i)}function bL(j,l){var h=j[0],n=j.slice(1),g=l[0],k=l.slice(1);if(!h||0===l.length){return{last_seq:aI,history:[]}}var i=h.session_id;if(bU(i,l)){return{last_seq:h.last_seq,history:j}}var m=g.session_id;return bU(m,n)?{last_seq:g.last_seq,history:k}:bL(n,k)}function bU(j,h){var g=h[0],i=h.slice(1);return j&&0!==h.length?j===g.session_id?!0:bU(j,i):!1}function cM(g){return"number"==typeof g.status&&4===Math.floor(g.status/100)}function e5(j,h){j=parseInt(j,10)||0,h=parseInt(h,10),h!==h||j>=h?h=(j||1)<<1:h+=1;var g=Math.random(),i=h-j;return ~~(i*g+j)}function eK(g){var h=0;return g||(h=2000),e5(g,h)}function cL(j,h,g,i){return j.retry===!1?(h.emit("error",g),void h.removeAllListeners()):("function"!=typeof j.back_off_function&&(j.back_off_function=eK),h.emit("requestError",g),"active"!==h.state&&"pending"!==h.state||(h.emit("paused",g),h.state="stopped",h.once("active",function(){j.current_back_off=aj})),j.current_back_off=j.current_back_off||aj,j.current_back_off=j.back_off_function(j.current_back_off),void setTimeout(i,j.current_back_off))}function jW(g){return fB(g)}function fI(j,h,g,i){(g>0||i<h.byteLength)&&(h=new Uint8Array(h,g,Math.min(i,h.byteLength)-g)),j.append(h)}function aS(j,h,g,i){(g>0||i<h.length)&&(h=h.substring(g,i)),j.appendBinary(h)}function aB(g){return Object.keys(g).sort(ag.collate).reduce(function(h,i){return h[i]=g[i],h},{})}function d7(m,k,g){var l=g.doc_ids?g.doc_ids.sort(ag.collate):"",i=g.filter?g.filter.toString():"",j="",h="";return g.filter&&g.query_params&&(j=JSON.stringify(aB(g.query_params))),g.filter&&"_view"===g.filter&&(h=g.view.toString()),eh.all([m.id(),k.id()]).then(function(o){var n=o[0]+o[1]+i+h+j+l;return dq(n)}).then(function(n){return n=n.replace(/\//g,".").replace(/\+/g,"_"),"_local/"+n})}function dQ(g){return/^1-/.test(g)}function c5(g){var h=[];return Object.keys(g).forEach(function(j){var i=g[j].missing;i.forEach(function(k){h.push({id:j,rev:k})})}),{docs:h,revs:!0,attachments:!0,binary:!0}}function aT(p,h,l){function j(){var q=c5(h);if(q.docs.length){return p.bulkGet(q).then(function(r){if(l.cancelled){throw new Error("cancelled")}r.results.forEach(function(s){s.docs.forEach(function(u){u.ok?o.push(u.ok):void 0!==u.error&&(n=!1)})})})}}function k(q){return q._attachments&&Object.keys(q._attachments).length>0}function m(q){return p.allDocs({keys:q,include_docs:!0}).then(function(r){if(l.cancelled){throw new Error("cancelled")}r.rows.forEach(function(s){!s.deleted&&s.doc&&dQ(s.value.rev)&&!k(s.doc)&&(o.push(s.doc),delete h[s.id])})})}function g(){var q=Object.keys(h).filter(function(r){var s=h[r].missing;return 1===s.length&&dQ(s[0])});return q.length>0?m(q):void 0}function i(){return{ok:n,docs:o}}h=eX(h);var o=[],n=!0;return eh.resolve().then(g).then(j).then(i)}function c8(k,s,G,B,F){function M(){return P?eh.resolve():d7(k,s,G).then(function(T){w=T,P=new aQ(k,s,w,B)})}function A(){if(y=[],0!==i.docs.length){var T=i.docs;return s.bulkDocs({docs:T,new_edits:!1}).then(function(W){if(B.cancelled){throw E(),new Error("cancelled")}var Y=[],V={};W.forEach(function(Z){Z.error&&(F.doc_write_failures++,Y.push(Z),V[Z.id]=Z)}),j=j.concat(Y),F.docs_written+=i.docs.length-Y.length;var U=Y.filter(function(Z){return"unauthorized"!==Z.name&&"forbidden"!==Z.name});if(T.forEach(function(Z){var ae=V[Z._id];ae?B.emit("denied",eX(ae)):y.push(Z)}),U.length>0){var X=new Error("bulkDocs error");throw X.other_errors=Y,N("target.bulkDocs failed to write docs",X),new Error("bulkWrite partial failure")}},function(U){throw F.doc_write_failures+=T.length,U})}}function u(){if(i.error){throw new Error("There was a problem getting docs.")}F.last_seq=h=i.seq;var T=eX(F);return y.length&&(T.docs=y,B.emit("change",T)),Q=!0,P.writeCheckpoint(i.seq,l).then(function(){if(Q=!1,B.cancelled){throw E(),new Error("cancelled")}i=void 0,I()})["catch"](function(U){throw Q=!1,N("writeCheckpoint completed with error",U),U})}function n(){var T={};return i.changes.forEach(function(U){"_user/"!==U.id&&(T[U.id]=U.changes.map(function(V){return V.rev}))}),s.revsDiff(T).then(function(U){if(B.cancelled){throw E(),new Error("cancelled")}i.diffs=U})}function R(){return aT(k,i.diffs,B).then(function(T){i.error=!T.ok,T.docs.forEach(function(U){delete i.diffs[U._id],F.docs_read++,i.docs.push(U)})})}function J(){if(!B.cancelled&&!i){if(0===K.length){return void o(!0)}i=K.shift(),n().then(R).then(A).then(u).then(J)["catch"](function(T){N("batch processing terminated with error",T)})}}function o(T){return 0===D.changes.length?void (0!==K.length||i||((L&&v.live||z)&&(B.state="pending",B.emit("paused")),z&&E())):void ((T||z||D.changes.length>=x)&&(K.push(D),D={seq:0,changes:[],docs:[]},"pending"!==B.state&&"stopped"!==B.state||(B.state="active",B.emit("active")),J()))}function N(T,U){H||(U.message||(U.message=T),F.ok=!1,F.status="aborting",F.errors.push(U),j=j.concat(U),K=[],D={seq:0,changes:[],docs:[]},E())}function E(){if(!(H||B.cancelled&&(F.status="cancelled",Q))){F.status=F.status||"complete",F.end_time=new Date,F.last_seq=h,H=!0;var T=j.filter(function(V){return"unauthorized"!==V.name&&"forbidden"!==V.name});if(T.length>0){var U=j.pop();j.length>0&&(U.other_errors=j),U.result=F,cL(G,B,U,function(){c8(k,s,G,B)})}else{F.errors=j,B.emit("complete",F),B.removeAllListeners()}}}function m(T){if(B.cancelled){return E()}var U=dC(G)(T);U&&(D.seq=T.seq,D.changes.push(T),o(v.live))}function S(T){return p=!1,B.cancelled?E():(T.results.length>0?(v.since=T.last_seq,I()):L?(v.live=!0,I()):z=!0,void o(!0))}function C(T){return p=!1,B.cancelled?E():void N("changes rejected",T)}function I(){function V(){U.cancel()}function T(){B.removeListener("cancel",V)}if(!p&&!z&&K.length<q){p=!0,B._changes&&(B.removeListener("cancel",B._abortChanges),B._changes.cancel()),B.once("cancel",V);var U=k.changes(v).on("change",m);U.then(T,T),U.then(S)["catch"](C),G.retry&&(B._changes=U,B._abortChanges=V)}}function O(){M().then(function(){return B.cancelled?void E():P.getCheckpoint().then(function(T){h=T,v={since:h,limit:x,batch_size:x,style:"all_docs",doc_ids:g,return_docs:!0},G.filter&&("string"!=typeof G.filter?v.include_docs=!0:v.filter=G.filter),"heartbeat" in G&&(v.heartbeat=G.heartbeat),"timeout" in G&&(v.timeout=G.timeout),G.query_params&&(v.query_params=G.query_params),G.view&&(v.view=G.view),I()})})["catch"](function(T){N("getCheckpoint rejected with ",T)})}function r(T){throw Q=!1,N("writeCheckpoint completed with error",T),T}var i,w,P,K=[],D={seq:0,changes:[],docs:[]},Q=!1,z=!1,H=!1,h=0,L=G.continuous||G.live||!1,x=G.batch_size||100,q=G.batches_limit||10,p=!1,g=G.doc_ids,j=[],y=[],l=fP();F=F||{ok:!0,start_time:new Date,docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var v={};return B.ready(k,s),B.cancelled?void E():(B._addedListeners||(B.once("cancel",E),"function"==typeof G.complete&&(B.once("error",G.complete),B.once("complete",function(T){G.complete(null,T)})),B._addedListeners=!0),void ("undefined"==typeof G.since?O():M().then(function(){return Q=!0,P.writeCheckpoint(G.since,l)}).then(function(){return Q=!1,B.cancelled?void E():(h=G.since,void O())})["catch"](r)))}function eF(){aH.EventEmitter.call(this),this.cancelled=!1,this.state="pending";var g=this,h=new eh(function(i,j){g.once("complete",i),g.once("error",j)});g.then=function(i,j){return h.then(i,j)},g["catch"]=function(i){return h["catch"](i)},g["catch"](function(){})}function jX(i,h){var g=h.PouchConstructor;return"string"==typeof i?new g(i,h):i}function kf(m,k,g,l){if("function"==typeof g&&(l=g,g={}),"undefined"==typeof g&&(g={}),g.doc_ids&&!Array.isArray(g.doc_ids)){throw jP(bQ,"`doc_ids` filter parameter is not a list.")}g.complete=l,g=eX(g),g.continuous=g.continuous||g.live,g.retry="retry" in g?g.retry:!1,g.PouchConstructor=g.PouchConstructor||this;var i=new eF(g),j=jX(m,g),h=jX(k,g);return c8(j,h,g,i),i}function aC(j,h,g,i){return"function"==typeof g&&(i=g,g={}),"undefined"==typeof g&&(g={}),g=eX(g),g.PouchConstructor=g.PouchConstructor||this,j=eA.toPouch(j,g),h=eA.toPouch(h,g),new d9(j,h,g,i)}function d9(r,k,l,u){function j(z){p.emit("change",{direction:"pull",change:z})}function o(z){p.emit("change",{direction:"push",change:z})}function x(z){p.emit("denied",{direction:"push",doc:z})}function m(z){p.emit("denied",{direction:"pull",doc:z})}function i(){p.pushPaused=!0,p.pullPaused&&p.emit("paused")}function v(){p.pullPaused=!0,p.pushPaused&&p.emit("paused")}function q(){p.pushPaused=!1,p.pullPaused&&p.emit("active",{direction:"push"})}function n(){p.pullPaused=!1,p.pushPaused&&p.emit("active",{direction:"pull"})}function s(z){return function(D,A){var B="change"===D&&(A===j||A===o),F="denied"===D&&(A===m||A===x),C="paused"===D&&(A===v||A===i),E="active"===D&&(A===n||A===q);(B||F||C||E)&&(D in g||(g[D]={}),g[D][z]=!0,2===Object.keys(g[D]).length&&p.removeAllListeners(D))}}var p=this;this.canceled=!1;var w=l.push?dE.extend({},l,l.push):l,h=l.pull?dE.extend({},l,l.pull):l;this.push=c0(r,k,w),this.pull=c0(k,r,h),this.pushPaused=!0,this.pullPaused=!0;var g={};l.live&&(this.push.on("complete",p.pull.cancel.bind(p.pull)),this.pull.on("complete",p.push.cancel.bind(p.push))),this.on("newListener",function(z){"change"===z?(p.pull.on("change",j),p.push.on("change",o)):"denied"===z?(p.pull.on("denied",m),p.push.on("denied",x)):"active"===z?(p.pull.on("active",n),p.push.on("active",q)):"paused"===z&&(p.pull.on("paused",v),p.push.on("paused",i))}),this.on("removeListener",function(z){"change"===z?(p.pull.removeListener("change",j),p.push.removeListener("change",o)):"denied"===z?(p.pull.removeListener("denied",m),p.push.removeListener("denied",x)):"active"===z?(p.pull.removeListener("active",n),p.push.removeListener("active",q)):"paused"===z&&(p.pull.removeListener("paused",v),p.push.removeListener("paused",i))}),this.pull.on("removeListener",s("pull")),this.push.on("removeListener",s("push"));var y=eh.all([this.push,this.pull]).then(function(A){var z={push:A[0],pull:A[1]};return p.emit("complete",z),u&&u(null,z),p.removeAllListeners(),z},function(z){if(p.cancel(),u?u(z):p.emit("error",z),p.removeAllListeners(),u){throw z}});this.then=function(A,z){return y.then(A,z)},this["catch"]=function(z){return y["catch"](z)}}function e0(g,h){return d6(bg(g),h)}function eZ(j){for(var h="",g=new Uint8Array(j),i=g.byteLength,k=0;i>k;k++){h+=String.fromCharCode(g[k])}return h}function aR(j,h){if("undefined"==typeof FileReader){return h(eZ((new FileReaderSync).readAsArrayBuffer(j)))}var g=new FileReader,i="function"==typeof g.readAsBinaryString;g.onloadend=function(k){var l=k.target.result||"";return i?h(l):void h(eZ(l))},i?g.readAsBinaryString(j):g.readAsArrayBuffer(j)}function kh(g){return new eh(function(h){aR(g,function(i){h(fB(i))})})}function eO(j){for(var h=[],g=0,i=j.length;i>g;g++){h=h.concat(j[g])}return h}function el(g){var h=g.doc&&g.doc._attachments;h&&Object.keys(h).forEach(function(i){var j=h[i];j.data=e0(j.data,j.content_type)})}function bK(g){return/^_design/.test(g)?"_design/"+encodeURIComponent(g.slice(8)):/^_local/.test(g)?"_local/"+encodeURIComponent(g.slice(7)):encodeURIComponent(g)}function bO(g){return g._attachments&&Object.keys(g._attachments)?eh.all(Object.keys(g._attachments).map(function(h){var i=g._attachments[h];return i.data&&"string"!=typeof i.data?kh(i.data).then(function(j){i.data=j}):void 0})):eh.resolve()}function dd(i){var h=aP(i);(h.user||h.password)&&(h.auth={username:h.user,password:h.password});var g=h.path.replace(/(^\/|\/$)/g,"").split("/");return h.db=g.pop(),-1===h.db.indexOf("%")&&(h.db=encodeURIComponent(h.db)),h.path=g.join("/"),h}function f4(g,h){return dP(g,g.db+"/"+h)}function dP(i,h){var g=i.path?"/":"";return i.protocol+"://"+i.host+(i.port?":"+i.port:"")+"/"+i.path+g+h}function b2(g){return"?"+Object.keys(g).map(function(h){return h+"="+encodeURIComponent(g[h])}).join("&")}function aF(s,j){function r(B,x,y){var A=B.ajax||{},z=dE.extend(eX(p),A,x);return bC(z.method+" "+z.url),cK.ajax(z,y)}function o(y,x){return new eh(function(A,z){r(y,x,function(C,B){return C?z(C):void A(B)})})}function q(y,x){return eP(y,b3(function(z){w().then(function(){return x.apply(this,z)})["catch"](function(B){var A=z.pop();A(B)})}))}function w(){if(s.skipSetup||s.skip_setup){return eh.resolve()}if(g){return g}var x={method:"GET",url:m};return g=o({},x)["catch"](function(y){return y&&y.status&&404===y.status?(ak(404,"PouchDB is just detecting if the remote exists."),o({},{method:"PUT",url:m})):eh.reject(y)})["catch"](function(y){return y&&y.status&&412===y.status?!0:eh.reject(y)}),g["catch"](function(){g=null}),g}function k(x){return x.split("/").map(encodeURIComponent).join("/")}var i=this,n=dd;s.getHost&&(n=s.getHost);var l=n(s.name,s),m=f4(l,"");s=eX(s);var p=s.ajax||{};if(i.getUrl=function(){return m},i.getHeaders=function(){return p.headers||{}},s.auth||l.auth){var h=s.auth||l.auth,v=h.username+":"+h.password,u=fB(unescape(encodeURIComponent(v)));p.headers=p.headers||{},p.headers.Authorization="Basic "+u}var g;setTimeout(function(){j(null,i)}),i.type=function(){return"http"},i.id=q("id",function(x){r({},{method:"GET",url:dP(l,"")},function(z,y){var A=y&&y.uuid?y.uuid+l.db:f4(l,"");x(null,A)})}),i.request=q("request",function(y,x){y.url=f4(l,y.url),r({},y,x)}),i.compact=q("compact",function(y,x){"function"==typeof y&&(x=y,y={}),y=eX(y),r(y,{url:f4(l,"_compact"),method:"POST"},function(){function z(){i.info(function(B,A){A&&!A.compact_running?x(null,{ok:!0}):setTimeout(z,y.interval||200)})}z()})}),i.bulkGet=eP("bulkGet",function(A,D){function C(E){var F={};A.revs&&(F.revs=!0),A.attachments&&(F.attachments=!0),r({},{url:f4(l,"_bulk_get"+b2(F)),method:"POST",body:{docs:A.docs}},E)}function y(){function E(L){return function(N,M){F[L]=M.results,++G===J&&D(null,{results:eO(F)})}}for(var H=aX,J=Math.ceil(A.docs.length/H),G=0,F=new Array(J),K=0;J>K;K++){var I=d1(A,["revs","attachments"]);I.ajax=p,I.docs=A.docs.slice(K*H,Math.min(A.docs.length,(K+1)*H)),f5(x,I,E(K))}}var x=this,z=dP(l,""),B=ap[z];"boolean"!=typeof B?C(function(F,G){if(F){var E=Math.floor(F.status/100);4===E||5===E?(ap[z]=!1,ak(F.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),y()):D(F)}else{ap[z]=!0,D(null,G)}}):B?C(D):y()}),i._info=function(x){w().then(function(){r({},{method:"GET",url:f4(l,"")},function(y,z){return y?x(y):(z.host=f4(l,""),void x(null,z))})})["catch"](x)},i.get=q("get",function(A,y,z){function C(F){var G=F._attachments,E=G&&Object.keys(G);return G&&E.length?eh.all(E.map(function(I){var H=G[I],J=bK(F._id)+"/"+k(I)+"?rev="+F._rev;return o(y,{method:"GET",url:f4(l,J),binary:!0}).then(function(K){return y.binary?K:kh(K)}).then(function(K){delete H.stub,delete H.length,H.data=K})})):void 0}function D(E){return Array.isArray(E)?eh.all(E.map(function(F){return F.ok?C(F.ok):void 0})):C(E)}"function"==typeof y&&(z=y,y={}),y=eX(y);var x={};y.revs&&(x.revs=!0),y.revs_info&&(x.revs_info=!0),y.open_revs&&("all"!==y.open_revs&&(y.open_revs=JSON.stringify(y.open_revs)),x.open_revs=y.open_revs),y.rev&&(x.rev=y.rev),y.conflicts&&(x.conflicts=y.conflicts),A=bK(A);var B={method:"GET",url:f4(l,A+b2(x))};o(y,B).then(function(E){return eh.resolve().then(function(){return y.attachments?D(E):void 0}).then(function(){z(null,E)})})["catch"](z)}),i.remove=q("remove",function(B,C,z,x){var A;"string"==typeof C?(A={_id:B,_rev:C},"function"==typeof z&&(x=z,z={})):(A=B,"function"==typeof C?(x=C,z={}):(x=z,z=C));var y=A._rev||z.rev;r(z,{method:"DELETE",url:f4(l,bK(A._id))+"?rev="+y},x)}),i.getAttachment=q("getAttachment",function(B,C,z,x){"function"==typeof z&&(x=z,z={});var A=z.rev?"?rev="+z.rev:"",y=f4(l,bK(B))+"/"+k(C)+A;r(z,{method:"GET",url:y,binary:!0},x)}),i.removeAttachment=q("removeAttachment",function(A,z,B,x){var y=f4(l,bK(A)+"/"+k(z))+"?rev="+B;r({},{method:"DELETE",url:y},x)}),i.putAttachment=q("putAttachment",function(A,F,G,H,x,C){"function"==typeof x&&(C=x,x=H,H=G,G=null);var D=bK(A)+"/"+k(F),B=f4(l,D);if(G&&(B+="?rev="+G),"string"==typeof H){var z;try{z=bg(H)}catch(E){return C(jP(bd,"Attachment is not a valid base64 string"))}H=z?d6(z,x):""}var y={headers:{"Content-Type":x},method:"PUT",url:B,processData:!1,body:H,timeout:p.timeout||60000};r({},y,C)}),i._bulkDocs=function(z,x,y){z.new_edits=x.new_edits,w().then(function(){return eh.all(z.docs.map(bO))}).then(function(){r(x,{method:"POST",url:f4(l,"_bulk_docs"),body:z},function(A,B){return A?y(A):(B.forEach(function(C){C.ok=!0}),void y(null,B))})})["catch"](y)},i.allDocs=q("allDocs",function(A,D){"function"==typeof A&&(D=A,A={}),A=eX(A);var z,y={},C="GET";A.conflicts&&(y.conflicts=!0),A.descending&&(y.descending=!0),A.include_docs&&(y.include_docs=!0),A.attachments&&(y.attachments=!0),A.key&&(y.key=JSON.stringify(A.key)),A.start_key&&(A.startkey=A.start_key),A.startkey&&(y.startkey=JSON.stringify(A.startkey)),A.end_key&&(A.endkey=A.end_key),A.endkey&&(y.endkey=JSON.stringify(A.endkey)),"undefined"!=typeof A.inclusive_end&&(y.inclusive_end=!!A.inclusive_end),"undefined"!=typeof A.limit&&(y.limit=A.limit),"undefined"!=typeof A.skip&&(y.skip=A.skip);var B=b2(y);if("undefined"!=typeof A.keys){var x="keys="+encodeURIComponent(JSON.stringify(A.keys));x.length+B.length+1<=dZ?B+="&"+x:(C="POST",z={keys:A.keys})}o(A,{method:C,url:f4(l,"_all_docs"+B),body:z}).then(function(E){A.include_docs&&A.attachments&&A.binary&&E.rows.forEach(el),D(null,E)})["catch"](D)}),i._changes=function(C){var I="batch_size" in C?C.batch_size:e4;C=eX(C),C.timeout="timeout" in C?C.timeout:"timeout" in p?p.timeout:30000;var L,y=C.timeout?{timeout:C.timeout-5000}:{},K="undefined"!=typeof C.limit?C.limit:!1;L="return_docs" in C?C.return_docs:"returnDocs" in C?C.returnDocs:!0;var J=K;if(C.style&&(y.style=C.style),(C.include_docs||C.filter&&"function"==typeof C.filter)&&(y.include_docs=!0),C.attachments&&(y.attachments=!0),C.continuous&&(y.feed="longpoll"),C.conflicts&&(y.conflicts=!0),C.descending&&(y.descending=!0),"heartbeat" in C?C.heartbeat&&(y.heartbeat=C.heartbeat):y.heartbeat=10000,C.filter&&"string"==typeof C.filter&&(y.filter=C.filter,"_view"===C.filter&&C.view&&"string"==typeof C.view&&(y.view=C.view)),C.query_params&&"object"==typeof C.query_params){for(var H in C.query_params){C.query_params.hasOwnProperty(H)&&(y[H]=C.query_params[H])}}var B,D="GET";if(C.doc_ids){y.filter="_doc_ids";var x=JSON.stringify(C.doc_ids);x.length<dZ?y.doc_ids=x:(D="POST",B={doc_ids:C.doc_ids})}var G,E,F=function(O,N){if(!C.aborted){y.since=O,"object"==typeof y.since&&(y.since=JSON.stringify(y.since)),C.descending?K&&(y.limit=J):y.limit=!K||J>I?I:J;var M={method:D,url:f4(l,"_changes"+b2(y)),timeout:C.timeout,body:B};E=O,C.aborted||w().then(function(){G=r(C,M,N)})["catch"](N)}},A={results:[]},z=function(P,M){if(!C.aborted){var N=0;if(M&&M.results){N=M.results.length,A.last_seq=M.last_seq;var Q={};Q.query=C.query_params,M.results=M.results.filter(function(R){J--;var S=dC(C)(R);return S&&(C.include_docs&&C.attachments&&C.binary&&el(R),L&&A.results.push(R),C.onChange(R)),S})}else{if(P){return C.aborted=!0,void C.complete(P)}}M&&M.last_seq&&(E=M.last_seq);var O=K&&0>=J||M&&I>N||C.descending;(!C.continuous||K&&0>=J)&&O?C.complete(null,A):setTimeout(function(){F(E,z)},0)}};return F(C.since||0,z),{cancel:function(){C.aborted=!0,G&&G.abort()}}},i.revsDiff=q("revsDiff",function(z,x,y){"function"==typeof x&&(y=x,x={}),r(x,{method:"POST",url:f4(l,"_revs_diff"),body:z},y)}),i._close=function(x){x()},i._destroy=function(x,y){r(x,{url:f4(l,""),method:"DELETE"},function(A,z){return A&&A.status&&404!==A.status?y(A):(i.emit("destroyed"),i.constructor.emit("destroyed",s.name),void y(null,z))})}}function eW(){this.promise=new eh(function(g){g()})}function af(g){return aE.hash(g)}function dW(j){var l=j.db,h=j.viewName,n=j.map,g=j.reduce,k=j.temporary,i=n.toString()+(g&&g.toString())+"undefined";if(!k&&l._cachedViews){var m=l._cachedViews[i];if(m){return eh.resolve(m)}}return l.info().then(function(p){function o(u){u.views=u.views||{};var r=h;-1===r.indexOf("/")&&(r=h+"/"+h);var s=u.views[r]=u.views[r]||{};if(!s[q]){return s[q]=!0,u}}var q=p.db_name+"-mrview-"+(k?"temp":af(i));return ea(l,"_local/mrviews",o).then(function(){return l.registerDependentDatabase(q).then(function(s){var u=s.db;u.auto_compaction=!0;var r={name:q,db:u,sourceDB:l,adapter:l.adapter,mapFun:n,reduceFun:g};return r.db.get("_local/lastSeq")["catch"](function(v){if(404!==v.status){throw v}}).then(function(v){return r.seq=v?v.seq:0,k||(l._cachedViews=l._cachedViews||{},l._cachedViews[i]=r,r.db.once("destroyed",function(){delete l._cachedViews[i]})),r})})})})}function aD(k,i,h,j,l,g){return e1("return ("+k.replace(/;\s*$/,"")+");",{emit:i,sum:h,log:j,isArray:l,toJSON:g})}function jZ(g){return -1===g.indexOf("/")?[g,g]:g.split("/")}function ed(g){return 1===g.length&&/^1-/.test(g[0].rev)}function cP(i,h){try{i.emit("error",h)}catch(g){console.error("The user's map/reduce function threw an uncaught error.\nYou can debug this error by doing:\nmyDatabase.on('error', function (err) { debugger; });\nPlease double-check your map/reduce function."),console.error(h)}}function fR(j,h,g){try{return{output:h.apply(null,g)}}catch(i){return cP(j,i),{error:i}}}function eQ(i,h){var g=bT(i.key,h.key);return 0!==g?g:bT(i.value,h.value)}function aU(i,h,g){return g=g||0,"number"==typeof h?i.slice(g,h+g):g>0?i.slice(g):i}function al(i){var h=i.value,g=h&&"object"==typeof h&&h._id||i.id;return g}function j0(g){g.rows.forEach(function(i){var h=i.doc&&i.doc._attachments;h&&Object.keys(h).forEach(function(j){var k=h[j];h[j].data=e0(k.data,k.content_type)})})}function bs(g){return function(h){return g.include_docs&&g.attachments&&g.binary&&j0(h),h}}function da(g){var h="builtin "+g+" function requires map values to be numbers or number arrays";return new dA(h)}function e9(j){for(var l=0,h=0,n=j.length;n>h;h++){var g=j[h];if("number"!=typeof g){if(!Array.isArray(g)){throw da("_sum")}l="number"==typeof l?[l]:l;for(var k=0,i=g.length;i>k;k++){var m=g[k];if("number"!=typeof m){throw da("_sum")}"undefined"==typeof l[k]?l.push(m):l[k]+=m}}else{"number"==typeof l?l+=g:l[0]+=g}}return l}function cA(j,h,g,i){var k=h[j];"undefined"!=typeof k&&(i&&(k=encodeURIComponent(JSON.stringify(k))),g.push(j+"="+k))}function bb(g){if("undefined"!=typeof g){var h=Number(g);return isNaN(h)||h!==parseInt(g,10)?g:h}}function dF(g){return g.group_level=bb(g.group_level),g.limit=bb(g.limit),g.skip=bb(g.skip),g}function c7(g){if(g){if("number"!=typeof g){return new eB('Invalid value for integer: "'+g+'"')}if(0>g){return new eB('Invalid value for positive integer: "'+g+'"')}}}function bH(j,h){var g=j.descending?"endkey":"startkey",i=j.descending?"startkey":"endkey";if("undefined"!=typeof j[g]&&"undefined"!=typeof j[i]&&bT(j[g],j[i])>0){throw new eB("No rows can match your key range, reverse your start_key and end_key or set {descending : true}")}if(h.reduce&&j.reduce!==!1){if(j.include_docs){throw new eB("{include_docs:true} is invalid for reduce")}if(j.keys&&j.keys.length>1&&!j.group&&!j.group_level){throw new eB("Multi-key fetches for reduce views must use {group: true}")}}["group_level","limit","skip"].forEach(function(k){var l=c7(j[k]);if(l){throw l}})}function bN(m,n,k){var i,j=[],l="GET";if(cA("reduce",k,j),cA("include_docs",k,j),cA("attachments",k,j),cA("limit",k,j),cA("descending",k,j),cA("group",k,j),cA("group_level",k,j),cA("skip",k,j),cA("stale",k,j),cA("conflicts",k,j),cA("startkey",k,j,!0),cA("start_key",k,j,!0),cA("endkey",k,j,!0),cA("end_key",k,j,!0),cA("inclusive_end",k,j),cA("key",k,j,!0),j=j.join("&"),j=""===j?"":"?"+j,"undefined"!=typeof k.keys){var o=2000,h="keys="+encodeURIComponent(JSON.stringify(k.keys));h.length+j.length+1<=o?j+=("?"===j[0]?"&":"?")+h:(l="POST","string"==typeof n?i={keys:k.keys}:n.keys=k.keys)}if("string"==typeof n){var g=jZ(n);return m.request({method:l,url:"_design/"+g[0]+"/_view/"+g[1]+j,body:i}).then(bs(k))}return i=i||{},Object.keys(n).forEach(function(p){Array.isArray(n[p])?i[p]=n[p]:i[p]=n[p].toString()}),m.request({method:"POST",url:"_temp_view"+j,body:i}).then(bs(k))}function e8(i,h,g){return new eh(function(j,k){i._query(h,g,function(m,l){return m?k(m):void j(l)})})}function c9(g){return new eh(function(h,i){g._viewCleanup(function(k,j){return k?i(k):void h(j)})})}function d0(g){return function(h){if(404===h.status){return g}throw h}}function fE(q,i,m){function k(){return ed(o)?eh.resolve(j):i.db.get(p)["catch"](d0(j))}function l(r){return r.keys.length?i.db.allDocs({keys:r.keys,include_docs:!0}):eh.resolve({rows:[]})}function n(z,B){for(var v=[],s={},u=0,w=B.rows.length;w>u;u++){var y=B.rows[u],r=y.doc;if(r&&(v.push(r),s[r._id]=!0,r._deleted=!g[r._id],!r._deleted)){var A=g[r._id];"value" in A&&(r.value=A.value)}}var x=Object.keys(g);return x.forEach(function(C){if(!s[C]){var E={_id:C},D=g[C];"value" in D&&(E.value=D.value),v.push(E)}}),z.keys=cC(x.concat(z.keys)),v.push(z),v}var p="_local/doc_"+q,j={_id:p,keys:[]},h=m[q],g=h.indexableKeysToKeyValues,o=h.changes;return k().then(function(r){return l(r).then(function(s){return n(r,s)})})}function aW(j,h,g){var i="_local/lastSeq";return j.db.get(i)["catch"](d0({_id:i,seq:0})).then(function(k){var l=Object.keys(h);return eh.all(l.map(function(m){return fE(m,j,h)})).then(function(n){var m=eO(n);return k.seq=g,m.push(k),j.db.bulkDocs({docs:m})})})}function cv(i){var h="string"==typeof i?i:i.name,g=cf[h];return g||(g=cf[h]=new eW),g}function kd(g){return a8(cv(g),function(){return bA(g)})()}function bA(m){function n(p,r){var q={id:j._id,key:bw(p)};"undefined"!=typeof r&&null!==r&&(q.value=bw(r)),i.push(q)}function k(q,p){return function(){return aW(m,q,p)}}var i,j,l;if("function"==typeof m.mapFun&&2===m.mapFun.length){var o=m.mapFun;l=function(p){return o(p,n)}}else{l=aD(m.mapFun.toString(),n,e9,dN,Array.isArray,JSON.parse)}var h=m.seq||0,g=new eW;return new eh(function(p,s){function r(){g.finish().then(function(){m.seq=h,p()})}function q(){function u(v){s(v)}m.sourceDB.changes({conflicts:!0,include_docs:!0,style:"all_docs",since:h,limit:dV}).on("complete",function(F){var A=F.results;if(!A.length){return r()}for(var H={},x=0,v=A.length;v>x;x++){var B=A[x];if("_"!==B.doc._id[0]){i=[],j=B.doc,j._deleted||fR(m.sourceDB,l,[j]),i.sort(eQ);for(var E,z={},D=0,G=i.length;G>D;D++){var w=i[D],y=[w.key,w.id];0===bT(w.key,E)&&y.push(D);var C=cu(y);z[C]=w,E=w.key}H[B.doc._id]={indexableKeysToKeyValues:z,changes:B.changes}}h=B.seq}return g.add(k(H,h)),A.length<dV?r():q()}).on("error",u)}q()})}function b6(q,i,m){0===m.group_level&&delete m.group_level;var k,l=m.group||m.group_level;k=jH[q.reduceFun]?jH[q.reduceFun]:aD(q.reduceFun.toString(),null,e9,dN,Array.isArray,JSON.parse);var n=[],p=isNaN(m.group_level)?Number.POSITIVE_INFINITY:m.group_level;i.forEach(function(r){var u=n[n.length-1],s=l?r.key:null;return l&&Array.isArray(s)&&(s=s.slice(0,p)),u&&0===bT(u.groupKey,s)?(u.keys.push([r.key,r.id]),void u.values.push(r.value)):void n.push({keys:[[r.key,r.id]],values:[r.value],groupKey:s})}),i=[];for(var j=0,h=n.length;h>j;j++){var g=n[j],o=fR(q.sourceDB,k,[g.keys,g.values,!1]);if(o.error&&o.error instanceof dA){throw o.error}i.push({value:o.error?null:o.output,key:g.groupKey})}return{rows:aU(i,m.limit,m.skip)}}function aw(g,h){return a8(cv(g),function(){return dI(g,h)})()}function dI(r,l){function o(u){return u.include_docs=!0,r.db.allDocs(u).then(function(v){return n=v.total_rows,v.rows.map(function(z){if("value" in z.doc&&"object"==typeof z.doc.value&&null!==z.doc.value){var x=Object.keys(z.doc.value).sort(),w=["id","key","value"];if(!(w>x||x>w)){return z.doc.value}}var y=cs(z.doc._id);return{key:y[0],id:y[1],value:"value" in z.doc?z.doc.value:null}})})}function m(v){var u;if(u=q?b6(r,v,l):{total_rows:n,offset:j,rows:v},l.include_docs){var w=cC(v.map(al));return r.sourceDB.allDocs({keys:w,include_docs:!0,conflicts:l.conflicts,attachments:l.attachments,binary:l.binary}).then(function(y){var x={};return y.rows.forEach(function(z){z.doc&&(x["$"+z.id]=z.doc)}),v.forEach(function(A){var B=al(A),z=x["$"+B];z&&(A.doc=z)}),u})}return u}var n,q=r.reduceFun&&l.reduce!==!1,j=l.skip||0;if("undefined"==typeof l.keys||l.keys.length||(l.limit=0,delete l.keys),"undefined"!=typeof l.keys){var s=l.keys,k=s.map(function(u){var v={startkey:cu([u]),endkey:cu([u,{}])};return o(v)});return eh.all(k).then(eO).then(m)}var i={descending:l.descending};if(l.start_key&&(l.startkey=l.start_key),l.end_key&&(l.endkey=l.end_key),"undefined"!=typeof l.startkey&&(i.startkey=cu(l.descending?[l.startkey,{}]:[l.startkey])),"undefined"!=typeof l.endkey){var g=l.inclusive_end!==!1;l.descending&&(g=!g),i.endkey=cu(g?[l.endkey,{}]:[l.endkey])}if("undefined"!=typeof l.key){var p=cu([l.key]),h=cu([l.key,{}]);i.descending?(i.endkey=p,i.startkey=h):(i.startkey=p,i.endkey=h)}return q||("number"==typeof l.limit&&(i.limit=l.limit),i.skip=j),o(i).then(m)}function jF(g){return g.request({method:"POST",url:"_view_cleanup"})}function cl(g){return g.get("_local/mrviews").then(function(h){var j={};Object.keys(h.views).forEach(function(n){var l=jZ(n),m="_design/"+l[0],k=l[1];j[m]=j[m]||{},j[m][k]=!0});var i={keys:Object.keys(j),include_docs:!0};return g.allDocs(i).then(function(n){var k={};n.rows.forEach(function(p){var o=p.key.substring(8);Object.keys(j[p.key]).forEach(function(u){var r=o+"/"+u;h.views[r]||(r=u);var q=Object.keys(h.views[r]),s=p.doc&&p.doc.views&&p.doc.views[u];q.forEach(function(v){k[v]=k[v]||s})})});var m=Object.keys(k).filter(function(o){return !k[o]}),l=m.map(function(o){return a8(cv(o),function(){return new g.constructor(o,g.__opts).destroy()})()});return eh.all(l).then(function(){return{ok:!0}})})},d0({ok:!0}))}function bR(g,m,j){if("http"===g.type()){return bN(g,m,j)}if("function"==typeof g._query){return e8(g,m,j)}if("string"!=typeof m){bH(j,m);var h={db:g,viewName:"temp_view/temp_view",map:m.map,reduce:m.reduce,temporary:!0};return ay.add(function(){return dW(h).then(function(o){function p(){return o.db.destroy()}return fN(kd(o).then(function(){return aw(o,j)}),p)})}),ay.finish()}var l=m,i=jZ(l),n=i[0],k=i[1];return g.getView(n,k).then(function(p){bH(j,p);var o={db:g,viewName:l,map:p.map,reduce:p.reduce};return dW(o).then(function(q){return"ok"===j.stale||"update_after"===j.stale?("update_after"===j.stale&&eT.nextTick(function(){kd(q)}),aw(q,j)):kd(q).then(function(){return aw(q,j)})})})}function eB(g){this.status=400,this.name="query_parse_error",this.message=g,this.error=!0;try{Error.captureStackTrace(this,eB)}catch(h){}}function dA(g){this.status=500,this.name="invalid_value",this.message=g,this.error=!0;try{Error.captureStackTrace(this,dA)}catch(h){}}function ki(g){return fB(eZ(g))}function jS(j,l,h){function n(o){try{return bg(o)}catch(q){var p=jP(bd,"Attachment is not a valid base64 string");return{error:p}}}function g(q,p){if(q.stub){return p()}if("string"==typeof q.data){var o=n(q.data);if(o.error){return p(o.error)}q.length=o.length,"blob"===l?q.data=d6(o,q.content_type):"base64"===l?q.data=fB(o):q.data=o,dq(o).then(function(r){q.digest="md5-"+r,p()})}else{aN(q.data,function(r){"binary"===l?q.data=eZ(r):"base64"===l&&(q.data=ki(r)),dq(r).then(function(s){q.digest="md5-"+s,q.length=r.byteLength,p()})})}}function k(){m++,j.length===m&&(i?h(i):h())}if(!j.length){return h()}var i,m=0;j.forEach(function(r){function p(u){i=u,q++,q===s.length&&k()}var s=r.data&&r.data._attachments?Object.keys(r.data._attachments):[],q=0;if(!s.length){return k()}for(var o in r.data._attachments){r.data._attachments.hasOwnProperty(o)&&g(r.data._attachments[o],p)}})}function ba(g,h){return g.pos-h.pos}function dv(k,i,h){for(var j,l=0,g=k.length;g>l;){j=l+g>>>1,h(k[j],i)<0?l=j+1:g=j}return l}function aM(j,h,g){var i=dv(j,h,g);j.splice(i,0,h)}function ep(j,l){for(var h,n,g=l,k=j.length;k>g;g++){var i=j[g],m=[i.id,i.opts,[]];n?(n[2].push(m),n=m):h=n=m}return h}function b0(g,h){return g[0]<h[0]?-1:1}function j8(o,h){for(var l=[{tree1:o,tree2:h}],j=!1;l.length>0;){var k=l.pop(),m=k.tree1,g=k.tree2;(m[1].status||g[1].status)&&(m[1].status="available"===m[1].status||"available"===g[1].status?"available":"missing");for(var i=0;i<g[2].length;i++){if(m[2][0]){for(var n=!1,p=0;p<m[2].length;p++){m[2][p][0]===g[2][i][0]&&(l.push({tree1:m[2][p],tree2:g[2][i]}),n=!0)}n||(j="new_branch",aM(m[2],g[2][i],b0))}else{j="new_leaf",m[2][0]=g[2][i]}}}return{conflicts:j,tree:o}}function bf(w,r,m){var x,k=[],p=!1,A=!1;if(!w.length){return{tree:[r],conflicts:"new_leaf"}}for(var u=0,j=w.length;j>u;u++){var z=w[u];if(z.pos===r.pos&&z.ids[0]===r.ids[0]){x=j8(z.ids,r.ids),k.push({pos:z.pos,ids:x.tree}),p=p||x.conflicts,A=!0}else{if(m!==!0){var v=z.pos<r.pos?z:r,o=z.pos<r.pos?r:z,y=o.pos-v.pos,q=[],i=[];for(i.push({ids:v.ids,diff:y,parent:null,parentIdx:null});i.length>0;){var h=i.pop();if(0!==h.diff){for(var g=h.ids[2],l=0,n=g.length;n>l;l++){i.push({ids:g[l],diff:h.diff-1,parent:h.ids,parentIdx:l})}}else{h.ids[0]===o.ids[0]&&q.push(h)}}var s=q[0];s?(x=j8(s.ids,o.ids),s.parent[2][s.parentIdx]=x.tree,k.push({pos:v.pos,ids:v.ids}),p=p||x.conflicts,A=!0):k.push(z)}else{k.push(z)}}}return A||k.push(r),k.sort(ba),{tree:k,conflicts:p||"internal_node"}}function e3(r,l){for(var o,m=fJ(r),n={},q=0,j=m.length;j>q;q++){for(var s=m[q],k=s.ids,i=Math.max(0,k.length-l),g={pos:s.pos+i,ids:ep(k,i)},p=0;i>p;p++){var h=s.pos+p+"-"+k[p].id;n[h]=!0}o=o?bf(o,g,!0).tree:[g]}return fH(o,function(u,w,v){delete n[w+"-"+v]}),{tree:o,revs:Object.keys(n)}}function cQ(j,h,g){var i=bf(j,h),k=e3(i.tree,g);return{tree:k.tree,stemmedRevs:k.revs,conflicts:i.conflicts}}function cE(o,h){for(var l,j=o.slice(),k=h.split("-"),m=parseInt(k[0],10),g=k[1];l=j.pop();){if(l.pos===m&&l.ids[0]===g){return !0}for(var i=l.ids[2],n=0,p=i.length;p>n;n++){j.push({pos:l.pos+1,ids:i[n]})}}return !1}function bu(y,s,m,h,k,r,l,w){if(cE(s.rev_tree,m.metadata.rev)){return h[k]=m,r()}var i=s.winningRev||jU(s),A="deleted" in s?s.deleted:fD(s,i),x="deleted" in m.metadata?m.metadata.deleted:fD(m.metadata),p=/^1-/.test(m.metadata.rev);if(A&&!x&&w&&p){var z=m.data;z._rev=i,z._id=m.metadata.id,m=cD(z,w)}var u=cQ(s.rev_tree,m.metadata.rev_tree[0],y),j=w&&(A&&x||!A&&"new_leaf"!==u.conflicts||A&&!x&&"new_branch"===u.conflicts);if(j){var o=jP(am);return h[k]=o,r()}var n=m.metadata.rev;m.metadata.rev_tree=u.tree,m.stemmedRevs=u.stemmedRevs||[],s.rev_map&&(m.metadata.rev_map=s.rev_map);var v,B=jU(m.metadata),g=fD(m.metadata,B),q=A===g?0:g>A?-1:1;v=n===B?g:fD(m.metadata,n),l(m,B,g,v,!0,q,k,r)}function f8(g){return"missing"===g.metadata.rev_tree[0].ids[1].status}function d3(l,u,q,n,p,i,s,h,v){function r(B,A,C){var D=jU(B.metadata),z=fD(B.metadata,D);if("was_delete" in h&&z){return i[A]=jP(aV,"deleted"),C()}var x=g&&f8(B);if(x){var y=jP(am);return i[A]=y,C()}var w=z?0:1;s(B,D,z,z,!1,w,A,C)}function k(){++j===o&&v&&v()}l=l||1000;var g=h.new_edits,m=new dT.Map,j=0,o=u.length;u.forEach(function(w,y){if(w._id&&fO(w._id)){var z=w._deleted?"_removeLocal":"_putLocal";return void q[z](w,{ctx:p},function(B,A){i[y]=B||A,k()})}var x=w.metadata.id;m.has(x)?(o--,m.get(x).push([w,y])):m.set(x,[[w,y]])}),m.forEach(function(z,x){function w(){++y<z.length?A():k()}function A(){var C=z[y],E=C[0],D=C[1];if(n.has(x)){bu(l,n.get(x),E,i,D,w,s,g)}else{var B=cQ([],E.metadata.rev_tree[0],l);E.metadata.rev_tree=B.tree,E.stemmedRevs=B.stemmedRevs||[],r(E,D,w)}}var y=0;A()})}function cb(g){var h=[];return fH(g.rev_tree,function(l,i,k,m,j){"available"!==j.status||l||(h.push(i+"-"+k),j.status="missing")}),h}function aK(g){try{return JSON.parse(g)}catch(h){return j3.parse(g)}}function kg(g){return g.length<50000?JSON.parse(g):aK(g)}function cB(g){try{return JSON.stringify(g)}catch(h){return j3.stringify(g)}}function aJ(j,h,g,i){try{j.apply(h,g)}catch(k){i.emit("error",k)}}function eR(g){if(!aa.running&&aa.queue.length){aa.running=!0;var h=aa.queue.shift();h.action(function(i,j){aJ(h.callback,this,[i,j],g),aa.running=!1,eT.nextTick(function(){eR(g)})})}}function eG(g){return function(h){var i="unknown_error";h.target&&h.target.error&&(i=h.target.error.name||h.target.error.message),g(jP(cq,i,h.type))}}function c4(i,h,g){return{data:cB(i),winningRev:h,deletedOrLocal:g?"1":"0",seq:i.seq,id:i.id}}function jE(g){if(!g){return null}var h=kg(g.data);return h.winningRev=g.winningRev,h.deleted="1"===g.deletedOrLocal,h.seq=g.seq,h}function fA(g){if(!g){return g}var h=g._doc_id_rev.lastIndexOf(":");return g._id=g._doc_id_rev.substring(0,h-1),g._rev=g._doc_id_rev.substring(h+1),delete g._doc_id_rev,g}function aZ(j,h,g,i){g?i(j?"string"!=typeof j?j:e0(j,h):c6([""],{type:h})):j?"string"!=typeof j?aR(j,function(k){i(fB(k))}):i(j):i("")}function aq(j,l,h,n){function g(){++m===i.length&&n&&n()}function k(s,q){var r=s._attachments[q],p=r.digest,o=h.objectStore(bl).get(p);o.onsuccess=function(u){r.body=u.target.result.body,g()}}var i=Object.keys(j._attachments||{});if(!i.length){return n&&n()}var m=0;i.forEach(function(o){l.attachments&&l.include_docs?k(j,o):(j._attachments[o].stub=!0,g())})}function d4(g,h){return eh.all(g.map(function(i){if(i.doc&&i.doc._attachments){var j=Object.keys(i.doc._attachments);return eh.all(j.map(function(k){var m=i.doc._attachments[k];if("body" in m){var n=m.body,l=m.content_type;return new eh(function(o){aZ(n,l,h,function(p){i.doc._attachments[k]=dE.extend(d1(m,["digest","content_type"]),{data:p}),o()})})}}))}}))}function bI(o,h,l){function j(){p--,p||k()}function k(){m.length&&m.forEach(function(q){var r=n.index("digestSeq").count(IDBKeyRange.bound(q+"::",q+"::￿",!1,!1));r.onsuccess=function(s){var u=s.target.result;u||i["delete"](q)}})}var m=[],g=l.objectStore(ac),i=l.objectStore(bl),n=l.objectStore(d5),p=o.length;o.forEach(function(s){var r=g.index("_doc_id_rev"),q=h+"::"+s;r.getKey(q).onsuccess=function(w){var v=w.target.result;if("number"!=typeof v){return j()}g["delete"](v);var u=n.index("seq").openCursor(IDBKeyRange.only(v));u.onsuccess=function(y){var x=y.target.result;if(x){var z=x.value.digestSeq.split("::")[0];m.push(z),n["delete"](x.primaryKey),x["continue"]()}else{j()}}}})}function dS(j,h,g){try{return{txn:j.transaction(h,g)}}catch(i){return{error:i}}}function dG(h,G,j,L,O,z,D){function J(){var Q=[jN,ac,bl,eJ,d5],P=dS(O,Q,"readwrite");return P.error?D(P.error):(w=P.txn,w.onabort=eG(D),w.ontimeout=eG(D),w.oncomplete=g,l=w.objectStore(jN),q=w.objectStore(ac),F=w.objectStore(bl),r=w.objectStore(d5),void i(function(R){return R?(x=!0,D(R)):void y()}))}function B(){d3(h.revs_limit,M,L,C,w,K,I,j)}function y(){function S(){++U===M.length&&B()}function Q(X){var W=jE(X.target.result);W&&C.set(W.id,W),S()}if(M.length){for(var U=0,R=0,T=M.length;T>R;R++){var P=M[R];if(P._id&&fO(P._id)){S()}else{var V=l.get(P.metadata.id);V.onsuccess=Q}}}}function g(){x||(z.notify(L._meta.name),L._meta.docCount+=n,D(null,K))}function o(Q,P){var R=F.get(Q);R.onsuccess=function(T){if(T.target.result){P()}else{var S=jP(ca,"unknown stub attachment with digest "+Q);S.status=412,P(S)}}}function i(R){function P(){++S===T.length&&R(Q)}var T=[];if(M.forEach(function(U){U.data&&U.data._attachments&&Object.keys(U.data._attachments).forEach(function(W){var V=U.data._attachments[W];V.stub&&T.push(V.digest)})}),!T.length){return R()}var Q,S=0;T.forEach(function(U){o(U,function(V){V&&!Q&&(Q=V),P()})})}function I(V,P,T,R,S,U,X,Q){n+=U,V.metadata.winningRev=P,V.metadata.deleted=T;var Y=V.data;Y._id=V.metadata.id,Y._rev=V.metadata.rev,R&&(Y._deleted=!0);var W=Y._attachments&&Object.keys(Y._attachments).length;return W?k(V,P,T,S,X,Q):void s(V,P,T,S,X,Q)}function N(Q){var P=cb(Q.metadata);bI(P,Q.metadata.id,w)}function s(Y,R,U,T,W,P){function S(ai){T&&L.auto_compaction?N(Y):Y.stemmedRevs.length&&bI(Y.stemmedRevs,Y.metadata.id,w),V.seq=ai.target.result,delete V.rev;var ao=c4(V,R,U),an=l.put(ao);an.onsuccess=ae}function Q(ao){ao.preventDefault(),ao.stopPropagation();var an=q.index("_doc_id_rev"),ai=an.getKey(X._doc_id_rev);ai.onsuccess=function(at){var ar=q.put(X,at.target.result);ar.onsuccess=S}}function ae(){K[W]={ok:!0,id:V.id,rev:R},C.set(Y.metadata.id,Y.metadata),E(Y,V.seq,P)}var X=Y.data,V=Y.metadata;X._doc_id_rev=V.id+"::"+V.rev,delete X._id,delete X._rev;var Z=q.put(X);Z.onsuccess=S,Z.onerror=Q}function k(X,Q,U,S,T,V){function Z(){Y===W.length&&s(X,Q,U,S,T,V)}function R(){Y++,Z()}var P=X.data,Y=0,W=Object.keys(P._attachments);W.forEach(function(an){var ae=X.data._attachments[an];if(ae.stub){Y++,Z()}else{var ai=ae.data;delete ae.data,ae.revpos=parseInt(Q,10);var ao=ae.digest;m(ao,ai,R)}})}function E(T,Q,V){function S(){++P===W.length&&V()}function U(Z){var Y=T.data._attachments[Z].digest,X=r.put({seq:Q,digestSeq:Y+"::"+Q});X.onsuccess=S,X.onerror=function(ae){ae.preventDefault(),ae.stopPropagation(),S()}}var P=0,W=Object.keys(T.data._attachments||{});if(!W.length){return V()}for(var R=0;R<W.length;R++){U(W[R])}}function m(R,P,S){var Q=F.count(R);Q.onsuccess=function(T){var U=T.target.result;if(U){return S()}var W={digest:R,body:P},V=F.put(W);V.onsuccess=S}}for(var w,l,q,F,r,p,M=G.docs,n=0,v=0,A=M.length;A>v;v++){var u=M[v];u._id&&fO(u._id)||(u=M[v]=cD(u,j.new_edits),u.error&&!p&&(p=u))}if(p){return D(p)}var K=new Array(M.length),C=new dT.Map,x=!1,H=L._meta.blobSupport?"blob":"base64";jS(M,H,function(P){return P?D(P):void J()})}function ka(k,i,h,j,l){try{if(k&&i){return l?IDBKeyRange.bound(i,k,!h,!1):IDBKeyRange.bound(k,i,!1,!h)}if(k){return l?IDBKeyRange.upperBound(k):IDBKeyRange.lowerBound(k)}if(i){return l?IDBKeyRange.lowerBound(i,!h):IDBKeyRange.upperBound(i,!h)}if(j){return IDBKeyRange.only(j)}}catch(g){return{error:g}}return null}function bj(j,h,g,i){return"DataError"===g.name&&0===g.code?i(null,{total_rows:j._meta.docCount,offset:h.skip,rows:[]}):void i(jP(cq,g.name,g.message))}function bp(k,i,h,j){function l(F,A){function D(N,O,L){var M=N.id+"::"+L;n.get(M).onsuccess=function(P){O.doc=fA(P.target.result),F.conflicts&&(O.doc._conflicts=df(N)),aq(O.doc,F,B)}}function v(N,P,O){var M={id:O.id,key:O.id,value:{rev:P}},L=O.deleted;if("ok"===F.deleted){r.push(M),L?(M.value.deleted=!0,M.doc=null):F.include_docs&&D(O,M,P)}else{if(!L&&G--<=0&&(r.push(M),F.include_docs&&D(O,M,P),0===--x)){return}}N["continue"]()}function J(L){p=i._meta.docCount;var O=L.target.result;if(O){var N=jE(O.value),M=N.winningRev;v(O,M,N)}}function z(){A(null,{total_rows:p,offset:F.skip,rows:r})}function w(){F.attachments?d4(r,F.binary).then(z):z()}var H="startkey" in F?F.startkey:!1,E="endkey" in F?F.endkey:!1,o="key" in F?F.key:!1,G=F.skip||0,x="number"==typeof F.limit?F.limit:-1,C=F.inclusive_end!==!1,u="descending" in F&&F.descending?"prev":null,s=ka(H,E,C,o,u);if(s&&s.error){return bj(i,F,s.error,A)}var K=[jN,ac];F.attachments&&K.push(bl);var m=dS(h,K,"readonly");if(m.error){return A(m.error)}var B=m.txn,I=B.objectStore(jN),q=B.objectStore(ac),y=u?I.openCursor(s,u):I.openCursor(s),n=q.index("_doc_id_rev"),r=[],p=0;B.oncomplete=w,y.onsuccess=J}function g(n,m){return 0===n.limit?m(null,{total_rows:i._meta.docCount,offset:n.skip,rows:[]}):void l(n,m)}g(k,j)}function bq(g){return new eh(function(h){var i=c6([""]);g.objectStore(b9).put(i,"key"),g.onabort=function(j){j.preventDefault(),j.stopPropagation(),h(!1)},g.oncomplete=function(){var j=navigator.userAgent.match(/Chrome\/(\d+)/),k=navigator.userAgent.match(/Edge\//);h(k||!j||parseInt(j[1],10)>=43)}})["catch"](function(){return !1})}function bX(g){eU()?chrome.storage.onChanged.addListener(function(h){null!=h.db_name&&g.emit(h.dbName.newValue)}):eg()&&("undefined"!=typeof addEventListener?addEventListener("storage",function(h){g.emit(h.key)}):window.attachEvent("storage",function(h){g.emit(h.key)}))}function bY(){aH.EventEmitter.call(this),this._listeners={},bX(this)}function cU(i,h){var g=this;aa.queue.push({action:function(j){bD(g,i,j)},callback:h}),eR(g.constructor)}function bD(i,u,l){function n(w){var v=w.createObjectStore(jN,{keyPath:"id"});w.createObjectStore(ac,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),w.createObjectStore(bl,{keyPath:"digest"}),w.createObjectStore(cG,{keyPath:"id",autoIncrement:!1}),w.createObjectStore(b9),v.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),w.createObjectStore(eJ,{keyPath:"_id"});var x=w.createObjectStore(d5,{autoIncrement:!0});x.createIndex("seq","seq"),x.createIndex("digestSeq","digestSeq",{unique:!0})}function p(w,v){var x=w.objectStore(jN);x.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),x.openCursor().onsuccess=function(B){var z=B.target.result;if(z){var A=z.value,y=fD(A);A.deletedOrLocal=y?"1":"0",x.put(A),z["continue"]()}else{v()}}}function q(v){v.createObjectStore(eJ,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}function s(x,A){var v=x.objectStore(eJ),w=x.objectStore(jN),z=x.objectStore(ac),y=w.openCursor();y.onsuccess=function(C){var L=C.target.result;if(L){var G=L.value,I=G.id,H=fO(I),E=jU(G);if(H){var B=I+"::"+E,K=I+"::",D=I+"::~",M=z.index("_doc_id_rev"),J=IDBKeyRange.bound(K,D,!1,!1),F=M.openCursor(J);F.onsuccess=function(N){if(F=N.target.result){var O=F.value;O._doc_id_rev===B&&v.put(O),z["delete"](F.primaryKey),F["continue"]()}else{w["delete"](L.primaryKey),L["continue"]()}}}else{L["continue"]()}}else{A&&A()}}}function r(w){var v=w.createObjectStore(d5,{autoIncrement:!0});v.createIndex("seq","seq"),v.createIndex("digestSeq","digestSeq",{unique:!0})}function h(x,A){var v=x.objectStore(ac),w=x.objectStore(bl),z=x.objectStore(d5),y=w.count();y.onsuccess=function(B){var C=B.target.result;return C?void (v.openCursor().onsuccess=function(G){var M=G.target.result;if(!M){return A()}for(var L=M.value,E=M.primaryKey,I=Object.keys(L._attachments||{}),K={},J=0;J<I.length;J++){var H=L._attachments[I[J]];K[H.digest]=!0}var F=Object.keys(K);for(J=0;J<F.length;J++){var D=F[J];z.put({seq:E,digestSeq:D+"::"+E})}M["continue"]()}):A()}}function j(z){function w(A){return A.data?jE(A):(A.deleted="1"===A.deletedOrLocal,A)}var x=z.objectStore(ac),y=z.objectStore(jN),v=y.openCursor();v.onsuccess=function(C){function D(){var H=A.id+"::",F=A.id+"::￿",G=x.index("_doc_id_rev").openCursor(IDBKeyRange.bound(H,F)),I=0;G.onsuccess=function(K){var J=K.target.result;if(!J){return A.seq=I,B()}var L=J.primaryKey;L>I&&(I=L),J["continue"]()}}function B(){var G=c4(A,A.winningRev,A.deleted),F=y.put(G);F.onsuccess=function(){E["continue"]()}}var E=C.target.result;if(E){var A=w(E.value);return A.winningRev=A.winningRev||jU(A),A.seq?B():void D()}}}var g=u.name,m=null;i._meta=null,i.type=function(){return"idb"},i._id=dx(function(v){v(null,i._meta.instanceId)}),i._bulkDocs=function(x,v,w){dG(u,x,v,i,m,bz,w)},i._get=function(z,C,y){function w(){y(A,{doc:x,metadata:v,ctx:D})}var x,v,A,D=C.ctx;if(!D){var B=dS(m,[jN,ac,bl],"readonly");if(B.error){return y(B.error)}D=B.txn}D.objectStore(jN).get(z).onsuccess=function(E){if(v=jE(E.target.result),!v){return A=jP(aV,"missing"),w()}if(fD(v)&&!C.rev){return A=jP(aV,"deleted"),w()}var G=D.objectStore(ac),H=C.rev||v.winningRev,F=v.id+"::"+H;G.index("_doc_id_rev").get(F).onsuccess=function(I){return x=I.target.result,x&&(x=fA(x)),x?void w():(A=jP(aV,"missing"),w())}}},i._getAttachment=function(A,v,w){var y;if(v.ctx){y=v.ctx}else{var x=dS(m,[jN,ac,bl],"readonly");if(x.error){return w(x.error)}y=x.txn}var B=A.digest,z=A.content_type;y.objectStore(bl).get(B).onsuccess=function(C){var D=C.target.result.body;aZ(D,z,v.binary,function(E){w(null,E)})}},i._info=function(v){if(null===m||!dz.has(g)){var y=new Error("db isn't open");return y.id="idbNull",v(y)}var x,w,B=dS(m,[ac],"readonly");if(B.error){return v(B.error)}var z=B.txn,A=z.objectStore(ac).openCursor(null,"prev");A.onsuccess=function(D){var C=D.target.result;x=C?C.key:0,w=i._meta.docCount},z.oncomplete=function(){v(null,{doc_count:w,update_seq:x,idb_attachment_format:i._meta.blobSupport?"binary":"base64"})}},i._allDocs=function(v,w){bp(v,i,m,w)},i._changes=function(C){function J(N){function S(){return R.seq!==T?N["continue"]():(A=T,R.winningRev===O._rev?Q(O):void P())}function P(){var U=O._id+"::"+R.winningRev,V=H.get(U);V.onsuccess=function(W){Q(fA(W.target.result))}}function Q(V){var W=C.processChange(V,R,C);W.seq=R.seq;var U=D(W);return"object"==typeof U?C.complete(U):(U&&(x++,L&&K.push(W),C.attachments&&C.include_docs?aq(V,C,B,function(){d4([W],C.binary).then(function(){C.onChange(W)})}):C.onChange(W)),void (x!==y&&N["continue"]()))}var O=fA(N.value),T=N.key;if(E&&!E.has(O._id)){return N["continue"]()}var R;return(R=w.get(O._id))?S():void (v.get(O._id).onsuccess=function(U){R=jE(U.target.result),w.set(O._id,R),S()})}function G(O){var N=O.target.result;N&&J(N)}function I(){var O=[jN,ac];C.attachments&&O.push(bl);var N=dS(m,O,"readonly");if(N.error){return C.complete(N.error)}B=N.txn,B.onabort=eG(C.complete),B.oncomplete=M,z=B.objectStore(ac),v=B.objectStore(jN),H=z.index("_doc_id_rev");var P;P=C.descending?z.openCursor(null,"prev"):z.openCursor(IDBKeyRange.lowerBound(C.since,!0)),P.onsuccess=G}function M(){function N(){C.complete(null,{results:K,last_seq:A})}!C.continuous&&C.attachments?d4(K).then(N):N()}if(C=eX(C),C.continuous){var F=g+":"+fP();return bz.addListener(g,F,i,C),bz.notify(g),{cancel:function(){bz.removeListener(g,F)}}}var E=C.doc_ids&&new dT.Set(C.doc_ids);C.since=C.since||0;var A=C.since,y="limit" in C?C.limit:-1;0===y&&(y=1);var L;L="return_docs" in C?C.return_docs:"returnDocs" in C?C.returnDocs:!0;var B,z,v,H,K=[],x=0,D=dC(C),w=new dT.Map;I()},i._close=function(v){return null===m?v(jP(dw)):(m.close(),dz["delete"](g),m=null,void v())},i._getRevisionTree=function(z,w){var x=dS(m,[jN],"readonly");if(x.error){return w(x.error)}var y=x.txn,v=y.objectStore(jN).get(z);v.onsuccess=function(B){var A=jE(B.target.result);A?w(null,A.rev_tree):w(jP(aV))}},i._doCompaction=function(A,v,w){var y=[jN,ac,bl,d5],x=dS(m,y,"readwrite");if(x.error){return w(x.error)}var B=x.txn,z=B.objectStore(jN);z.get(A).onsuccess=function(E){var C=jE(E.target.result);fH(C.rev_tree,function(I,K,H,J,G){var L=K+"-"+H;-1!==v.indexOf(L)&&(G.status="missing")}),bI(v,A,B);var D=C.winningRev,F=C.deleted;B.objectStore(jN).put(c4(C,D,F))},B.onabort=eG(w),B.oncomplete=function(){w()}},i._getLocal=function(z,w){var x=dS(m,[eJ],"readonly");if(x.error){return w(x.error)}var y=x.txn,v=y.objectStore(eJ).get(z);v.onerror=eG(w),v.onsuccess=function(B){var A=B.target.result;A?(delete A._doc_id_rev,w(null,A)):w(jP(aV))}},i._putLocal=function(z,D,y){"function"==typeof D&&(y=D,D={}),delete z._revisions;var w=z._rev,x=z._id;w?z._rev="0-"+(parseInt(w.split("-")[1],10)+1):z._rev="0-1";var v,B=D.ctx;if(!B){var E=dS(m,[eJ],"readwrite");if(E.error){return y(E.error)}B=E.txn,B.onerror=eG(y),B.oncomplete=function(){v&&y(null,v)}}var C,A=B.objectStore(eJ);w?(C=A.get(x),C.onsuccess=function(H){var G=H.target.result;if(G&&G._rev===w){var F=A.put(z);F.onsuccess=function(){v={ok:!0,id:z._id,rev:z._rev},D.ctx&&y(null,v)}}else{y(jP(am))}}):(C=A.add(z),C.onerror=function(F){y(jP(am)),F.preventDefault(),F.stopPropagation()},C.onsuccess=function(){v={ok:!0,id:z._id,rev:z._rev},D.ctx&&y(null,v)})},i._removeLocal=function(z,C,y){"function"==typeof C&&(y=C,C={});var w=C.ctx;if(!w){var x=dS(m,[eJ],"readwrite");if(x.error){return y(x.error)}w=x.txn,w.oncomplete=function(){v&&y(null,v)}}var v,A=z._id,D=w.objectStore(eJ),B=D.get(A);B.onerror=eG(y),B.onsuccess=function(F){var E=F.target.result;E&&E._rev===z._rev?(D["delete"](A),v={ok:!0,id:A,rev:"0-0"},C.ctx&&y(null,v)):y(jP(aV))}},i._destroy=function(y,w){bz.removeAllListeners(g);var v=cX.get(g);v&&v.result&&(v.result.close(),dz["delete"](g));var x=indexedDB.deleteDatabase(g);x.onsuccess=function(){cX["delete"](g),eg()&&g in localStorage&&delete localStorage[g],w(null,{ok:!0})},x.onerror=eG(w)};var k=dz.get(g);if(k){return m=k.idb,i._meta=k.global,void eT.nextTick(function(){l(null,i)})}var o;o=u.storage?cw(g,u.storage):indexedDB.open(g,dU),cX.set(g,o),o.onupgradeneeded=function(v){function z(){var B=w[y-1];y++,B&&B(A,z)}var x=v.target.result;if(v.oldVersion<1){return n(x)}var A=v.currentTarget.transaction;v.oldVersion<3&&q(x),v.oldVersion<4&&r(x);var w=[p,s,h,j],y=v.oldVersion;z()},o.onsuccess=function(w){m=w.target.result,m.onversionchange=function(){m.close(),dz["delete"](g)},m.onabort=function(B){console.error("Database has a global failure",B.target.error),m.close(),dz["delete"](g)};var v=m.transaction([cG,b9,jN],"readwrite"),z=v.objectStore(cG).get(cG),A=null,y=null,x=null;z.onsuccess=function(D){var B=function(){null!==A&&null!==y&&null!==x&&(i._meta={name:g,instanceId:x,blobSupport:A,docCount:y},dz.set(g,{idb:m,global:i._meta}),l(null,i))},E=D.target.result||{id:cG};g+"_id" in E?(x=E[g+"_id"],B()):(x=fP(),E[g+"_id"]=x,v.objectStore(cG).put(E).onsuccess=function(){B()}),dg||(dg=bq(v)),dg.then(function(F){A=F,B()});var C=v.objectStore(jN).index("deletedOrLocal");C.count(IDBKeyRange.only("0")).onsuccess=function(F){y=F.target.result,B()}}},o.onerror=function(){var v="Failed to open indexedDB, are you in private browsing mode?";console.error(v),l(jP(cq,v))}}function cw(i,h){try{return indexedDB.open(i,{version:dU,storage:h})}catch(g){return indexedDB.open(i,dU)}}function eS(g){return decodeURIComponent(window.escape(g))}function a9(g){return 65>g?g-48:g-55}function cJ(j,h,g){for(var i="";g>h;){i+=String.fromCharCode(a9(j.charCodeAt(h++))<<4|a9(j.charCodeAt(h++)))}return i}function f0(j,h,g){for(var i="";g>h;){i+=String.fromCharCode(a9(j.charCodeAt(h+2))<<12|a9(j.charCodeAt(h+3))<<8|a9(j.charCodeAt(h))<<4|a9(j.charCodeAt(h+1))),h+=4}return i}function bS(g,h){return"UTF-8"===h?eS(cJ(g,0,g.length)):f0(g,0,g.length)}function cg(g){return"'"+g+"'"}function az(){return"undefined"!=typeof sqlitePlugin?sqlitePlugin.openDatabase.bind(sqlitePlugin):"undefined"!=typeof openDatabase?function(g){return openDatabase(g.name,g.version,g.description,g.size)}:void 0}function d2(){return"undefined"!=typeof openDatabase||"undefined"!=typeof SQLitePlugin}function jI(g){return g.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"")}function cZ(g){return g.replace(/\u0001\u0001/g,"\x00").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,"")}function b7(g){return delete g._id,delete g._rev,JSON.stringify(g)}function cY(i,h,g){return i=JSON.parse(i),i._id=h,i._rev=g,i}function d8(g){for(var h="(";g--;){h+="?",g&&(h+=",")}return h+")"}function jO(j,h,g,i,k){return"SELECT "+j+" FROM "+("string"==typeof h?h:h.join(" JOIN "))+(g?" ON "+g:"")+(i?" WHERE "+("string"==typeof i?i:i.join(" AND ")):"")+(k?" ORDER BY "+k:"")}function ad(m,k,g){function l(){++j===m.length&&i()}function i(){if(h.length){var n="SELECT DISTINCT digest AS digest FROM "+jL+" WHERE seq IN "+d8(h.length);g.executeSql(n,h,function(q,o){for(var s=[],p=0;p<o.rows.length;p++){s.push(o.rows.item(p).digest)}if(s.length){var r="DELETE FROM "+jL+" WHERE seq IN ("+h.map(function(){return"?"}).join(",")+")";q.executeSql(r,h,function(u){var v="SELECT digest FROM "+jL+" WHERE digest IN ("+s.map(function(){return"?"}).join(",")+")";u.executeSql(v,s,function(x,y){for(var w=new dT.Set,z=0;z<y.rows.length;z++){w.add(y.rows.item(z).digest)}s.forEach(function(A){w.has(A)||(x.executeSql("DELETE FROM "+jL+" WHERE digest=?",[A]),x.executeSql("DELETE FROM "+bv+" WHERE digest=?",[A]))})})})}})}}if(m.length){var j=0,h=[];m.forEach(function(n){var o="SELECT seq FROM "+cF+" WHERE doc_id=? AND rev=?";g.executeSql(o,[k,n],function(q,p){if(!p.rows.length){return l()}var r=p.rows.item(0).seq;h.push(r),q.executeSql("DELETE FROM "+cF+" WHERE seq=?",[r],l)})})}}function dB(g){return function(h){console.error("WebSQL threw an error",h);var k=h&&h.constructor.toString().match(/function ([^\(]+)/),i=k&&k[1]||h.type,j=h.target||h.message;g(jP(fF,j,i))}}function em(g){if("size" in g){return 1000000*g.size}var h="undefined"!=typeof navigator&&/Android/.test(navigator.userAgent);return h?5000000:1}function ch(i,h){try{return{db:i(h)}}catch(g){return{error:g}}}function eM(i){var h=cR.get(i.name);if(!h){var g=az();h=ch(g,i),cR.set(i.name,h),h.db&&(h.db._sqlitePlugin="undefined"!=typeof sqlitePlugin)}return h}function cc(y,w,m,i,k,r,C){function g(){return v?C(v):(r.notify(i._name),i._docCount=-1,void C(null,B))}function s(E,D){var F="SELECT count(*) as cnt FROM "+bv+" WHERE digest=?";n.executeSql(F,[E],function(G,H){if(0===H.rows.item(0).cnt){var I=jP(ca,"unknown stub attachment with digest "+E);D(I)}else{D()}})}function A(F){function D(){++G===H.length&&F(E)}var H=[];if(o.forEach(function(I){I.data&&I.data._attachments&&Object.keys(I.data._attachments).forEach(function(J){var K=I.data._attachments[J];K.stub&&H.push(K.digest)})}),!H.length){return F()}var E,G=0;H.forEach(function(I){s(I,function(J){J&&!E&&(E=J),D()})})}function x(Q,J,E,O,M,G,L,I){function D(){function Z(an,a0){function ar(){return ++at===ai.length&&a0(),!1}function ao(a2){var a3="INSERT INTO "+jL+" (digest, seq) VALUES (?,?)",a1=[Y._attachments[a2].digest,an];n.executeSql(a3,a1,ar,ar)}var at=0,ai=Object.keys(Y._attachments||{});if(!ai.length){return a0()}for(var ae=0;ae<ai.length;ae++){ao(ai[ae])}}var Y=Q.data,T=O?1:0,W=Y._id,S=Y._rev,U=b7(Y),V="INSERT INTO "+cF+" (doc_id, rev, json, deleted) VALUES (?, ?, ?, ?);",X=[W,S,U,T];n.executeSql(V,X,function(ai,ae){var an=ae.insertId;Z(an,function(){R(ai,an)})},function(){var ae=jO("seq",cF,null,"doc_id=? AND rev=?");return n.executeSql(ae,[W,S],function(ar,ai){var at=ai.rows.item(0).seq,ao="UPDATE "+cF+" SET json=?, deleted=? WHERE doc_id=? AND rev=?;",an=[U,T,W,S];ar.executeSql(ao,an,function(a0){Z(at,function(){R(a0,at)})})}),!1})}function P(S){N||(S?(N=S,I(N)):H===F.length&&D())}function K(S){H++,P(S)}function R(U,S){var V=Q.metadata.id;M&&i.auto_compaction?ad(cb(Q.metadata),V,U):Q.stemmedRevs.length&&ad(Q.stemmedRevs,V,U),Q.metadata.seq=S,delete Q.metadata.rev;var T=M?"UPDATE "+f9+" SET json=?, max_seq=?, winningseq=(SELECT seq FROM "+cF+" WHERE doc_id="+f9+".id AND rev=?) WHERE id=?":"INSERT INTO "+f9+" (id, winningseq, max_seq, json) VALUES (?,?,?,?);",W=cB(Q.metadata),X=M?[W,S,J,V]:[V,S,S,W];U.executeSql(T,X,function(){B[L]={ok:!0,id:Q.metadata.id,rev:J},p.set(V,Q.metadata),I()})}var N=null,H=0;Q.data._id=Q.metadata.id,Q.data._rev=Q.metadata.rev;var F=Object.keys(Q.data._attachments||{});O&&(Q.data._deleted=!0),F.forEach(function(S){var U=Q.data._attachments[S];if(U.stub){H++,P()}else{var V=U.data;delete U.data,U.revpos=parseInt(J,10);var T=U.digest;u(T,V,K)}}),F.length||D()}function q(){d3(y.revs_limit,o,i,p,n,B,x,m)}function z(E){function D(){++F===o.length&&E()}if(!o.length){return E()}var F=0;o.forEach(function(G){if(G._id&&fO(G._id)){return D()}var H=G.metadata.id;n.executeSql("SELECT json FROM "+f9+" WHERE id = ?",[H],function(K,J){if(J.rows.length){var I=kg(J.rows.item(0).json);p.set(H,I)}D()})})}function u(F,D,G){var E="SELECT digest FROM "+bv+" WHERE digest=?";n.executeSql(E,[F],function(H,I){return I.rows.length?G():(E="INSERT INTO "+bv+" (digest, body, escaped) VALUES (?,?,1)",void H.executeSql(E,[F,jI(D)],function(){G()},function(){return G(),!1}))})}var j=m.new_edits,h=w.docs,o=h.map(function(E){if(E._id&&fO(E._id)){return E}var D=cD(E,j);return D}),l=o.filter(function(D){return D.error});if(l.length){return C(l[0])}var n,v,B=new Array(o.length),p=new dT.Map;jS(o,"binary",function(D){return D?C(D):void k.transaction(function(E){n=E,A(function(F){F?v=F:z(q)})},dB(C),g)})}function ab(k,g,j,h,i){function m(){++l===o.length&&i&&i()}function n(r,s){var q=r._attachments[s],p={binary:g.binary,ctx:h};j._getAttachment(q,p,function(v,u){r._attachments[s]=dE.extend(d1(q,["digest","content_type"]),{data:u}),m()})}var o=Object.keys(k._attachments||{});if(!o.length){return i&&i()}var l=0;o.forEach(function(p){g.attachments&&g.include_docs?n(k,p):(k._attachments[p].stub=!0,m())})}function dk(B,j){function s(){eg()&&(window.localStorage["_pouch__websqldb_"+z._name]=!0),j(null,z)}function m(F,E){F.executeSql(t),F.executeSql("ALTER TABLE "+cF+" ADD COLUMN deleted TINYINT(1) DEFAULT 0",[],function(){F.executeSql(cI),F.executeSql("ALTER TABLE "+f9+" ADD COLUMN local TINYINT(1) DEFAULT 0",[],function(){F.executeSql("CREATE INDEX IF NOT EXISTS 'doc-store-local-idx' ON "+f9+" (local, id)");var G="SELECT "+f9+".winningseq AS seq, "+f9+".json AS metadata FROM "+cF+" JOIN "+f9+" ON "+cF+".seq = "+f9+".winningseq";F.executeSql(G,[],function(H,L){for(var O=[],J=[],K=0;K<L.rows.length;K++){var M=L.rows.item(K),N=M.seq,I=JSON.parse(M.metadata);fD(I)&&O.push(N),fO(I.id)&&J.push(I.id)}H.executeSql("UPDATE "+f9+"SET local = 1 WHERE id IN "+d8(J.length),J,function(){H.executeSql("UPDATE "+cF+" SET deleted = 1 WHERE seq IN "+d8(O.length),O,E)})})})})}function r(F,E){var G="CREATE TABLE IF NOT EXISTS "+cz+" (id UNIQUE, rev, json)";F.executeSql(G,[],function(){var H="SELECT "+f9+".id AS id, "+cF+".json AS data FROM "+cF+" JOIN "+f9+" ON "+cF+".seq = "+f9+".winningseq WHERE local = 1";F.executeSql(H,[],function(K,M){function J(){if(!L.length){return E(K)}var O=L.shift(),N=JSON.parse(O.data)._rev;K.executeSql("INSERT INTO "+cz+" (id, rev, json) VALUES (?,?,?)",[O.id,N,O.data],function(P){P.executeSql("DELETE FROM "+f9+" WHERE id=?",[O.id],function(Q){Q.executeSql("DELETE FROM "+cF+" WHERE seq=?",[O.seq],function(){J()})})})}for(var L=[],I=0;I<M.rows.length;I++){L.push(M.rows.item(I))}J()})})}function x(G,E){function H(J){function I(){if(!J.length){return E(G)}var O=J.shift(),M=bS(O.hex,u),K=M.lastIndexOf("::"),N=M.substring(0,K),L=M.substring(K+2),P="UPDATE "+cF+" SET doc_id=?, rev=? WHERE doc_id_rev=?";G.executeSql(P,[N,L,M],function(){I()})}I()}var F="ALTER TABLE "+cF+" ADD COLUMN doc_id";G.executeSql(F,[],function(J){var I="ALTER TABLE "+cF+" ADD COLUMN rev";J.executeSql(I,[],function(K){K.executeSql(dj,[],function(M){var L="SELECT hex(doc_id_rev) as hex FROM "+cF;M.executeSql(L,[],function(P,N){for(var O=[],Q=0;Q<N.rows.length;Q++){O.push(N.rows.item(Q))}H(O)})})})})}function l(G,E){function H(I){var J="SELECT COUNT(*) AS cnt FROM "+bv;I.executeSql(J,[],function(N,P){function M(){var Q=jO(eb+", "+f9+".id AS id",[f9,cF],au,null,f9+".id ");Q+=" LIMIT "+K+" OFFSET "+L,L+=K,N.executeSql(Q,[],function(ai,U){function ae(at,ar){var ao=W[at]=W[at]||[];-1===ao.indexOf(ar)&&ao.push(ar)}if(!U.rows.length){return E(ai)}for(var W={},R=0;R<U.rows.length;R++){for(var T=U.rows.item(R),S=cY(T.data,T.id,T.rev),Z=Object.keys(S._attachments||{}),Y=0;Y<Z.length;Y++){var V=S._attachments[Z[Y]];ae(V.digest,T.seq)}}var an=[];if(Object.keys(W).forEach(function(ar){var ao=W[ar];ao.forEach(function(at){an.push([ar,at])})}),!an.length){return M()}var X=0;an.forEach(function(ao){var ar="INSERT INTO "+jL+" (digest, seq) VALUES (?,?)";ai.executeSql(ar,ao,function(){++X===an.length&&M()})})})}var O=P.rows.item(0).cnt;if(!O){return E(N)}var L=0,K=10;M()})}var F="CREATE TABLE IF NOT EXISTS "+jL+" (digest, seq INTEGER)";G.executeSql(F,[],function(I){I.executeSql(bi,[],function(J){J.executeSql(cd,[],H)})})}function k(F,E){var G="ALTER TABLE "+bv+" ADD COLUMN escaped TINYINT(1) DEFAULT 0";F.executeSql(G,[],E)}function i(F,E){var G="ALTER TABLE "+f9+" ADD COLUMN max_seq INTEGER";F.executeSql(G,[],function(H){var I="UPDATE "+f9+" SET max_seq=(SELECT MAX(seq) FROM "+cF+" WHERE doc_id=id)";H.executeSql(I,[],function(J){var K="CREATE UNIQUE INDEX IF NOT EXISTS 'doc-max-seq-idx' ON "+f9+" (max_seq)";J.executeSql(K,[],E)})})}function A(F,E){F.executeSql('SELECT HEX("a") AS hex',[],function(H,I){var G=I.rows.item(0).hex;u=2===G.length?"UTF-8":"UTF-16",E()})}function C(){for(;o.length>0;){var E=o.pop();E(null,D)}}function y(M,I){if(0===I){var E="CREATE TABLE IF NOT EXISTS "+dL+" (dbid, db_version INTEGER)",N="CREATE TABLE IF NOT EXISTS "+bv+" (digest UNIQUE, escaped TINYINT(1), body BLOB)",L="CREATE TABLE IF NOT EXISTS "+jL+" (digest, seq INTEGER)",J="CREATE TABLE IF NOT EXISTS "+f9+" (id unique, json, winningseq, max_seq INTEGER UNIQUE)",K="CREATE TABLE IF NOT EXISTS "+cF+" (seq INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, json, deleted TINYINT(1), doc_id, rev)",P="CREATE TABLE IF NOT EXISTS "+cz+" (id UNIQUE, rev, json)";M.executeSql(N),M.executeSql(P),M.executeSql(L,[],function(){M.executeSql(cd),M.executeSql(bi)}),M.executeSql(J,[],function(){M.executeSql(t),M.executeSql(K,[],function(){M.executeSql(cI),M.executeSql(dj),M.executeSql(E,[],function(){var Q="INSERT INTO "+dL+" (db_version, dbid) VALUES (?,?)";D=fP();var R=[bJ,D];M.executeSql(Q,R,function(){C()})})})})}else{var G=function(){var R=bJ>I;R&&M.executeSql("UPDATE "+dL+" SET db_version = "+bJ);var Q="SELECT dbid FROM "+dL;M.executeSql(Q,[],function(T,S){D=S.rows.item(0).dbid,C()})},O=[m,r,x,l,k,i,G],F=I,H=function(Q){O[F-1](Q,H),F++};H(M)}}function p(){n.transaction(function(E){A(E,function(){h(E)})},dB(j),s)}function h(F){var E="SELECT sql FROM sqlite_master WHERE tbl_name = "+dL;F.executeSql(E,[],function(H,G){G.rows.length?/db_version/.test(G.rows.item(0).sql)?H.executeSql("SELECT db_version FROM "+dL,[],function(J,I){var K=I.rows.item(0).db_version;y(J,K)}):H.executeSql("ALTER TABLE "+dL+" ADD COLUMN db_version INTEGER",[],function(){y(H,1)}):y(H,0)})}function g(F,E){if(-1!==z._docCount){return E(z._docCount)}var G=jO("COUNT("+f9+".id) AS 'num'",[f9,cF],au,cF+".deleted=0");F.executeSql(G,[],function(H,I){z._docCount=I.rows.item(0).num,E(z._docCount)})}var u,z=this,D=null,q=em(B),o=[];z._docCount=-1,z._name=B.name;var v=dE.extend({},B,{size:q,version:dO}),w=eM(v);if(w.error){return dB(j)(w.error)}var n=w.db;"function"!=typeof n.readTransaction&&(n.readTransaction=n.transaction),p(),z.type=function(){return"websql"},z._id=dx(function(E){E(null,D)}),z._info=function(E){n.readTransaction(function(F){g(F,function(H){var G="SELECT MAX(seq) AS seq FROM "+cF;F.executeSql(G,[],function(I,J){var K=J.rows.item(0).seq||0;E(null,{doc_count:H,update_seq:K,sqlite_plugin:n._sqlitePlugin,websql_encoding:u})})})},dB(E))},z._bulkDocs=function(E,G,F){cc(B,E,G,z,n,aL,F)},z._get=function(K,E,I){function F(){I(M,{doc:G,metadata:J,ctx:H})}var G,J,M,H=E.ctx;if(!H){return n.readTransaction(function(O){z._get(K,dE.extend({ctx:O},E),I)})}var N,L;E.rev?(N=jO(eb,[f9,cF],f9+".id="+cF+".doc_id",[cF+".doc_id=?",cF+".rev=?"]),L=[K,E.rev]):(N=jO(eb,[f9,cF],au,f9+".id=?"),L=[K]),H.executeSql(N,L,function(O,P){if(!P.rows.length){return M=jP(aV,"missing"),F()}var Q=P.rows.item(0);return J=kg(Q.metadata),Q.deleted&&!E.rev?(M=jP(aV,"deleted"),F()):(G=cY(Q.data,J.id,Q.rev),void F())})},z._allDocs=function(O,I){var F,P=[],R="startkey" in O?O.startkey:!1,L="endkey" in O?O.endkey:!1,G="key" in O?O.key:!1,J="descending" in O?O.descending:!1,H="limit" in O?O.limit:-1,E="skip" in O?O.skip:0,N=O.inclusive_end!==!1,K=[],Q=[];if(G!==!1){Q.push(f9+".id = ?"),K.push(G)}else{if(R!==!1||L!==!1){if(R!==!1&&(Q.push(f9+".id "+(J?"<=":">=")+" ?"),K.push(R)),L!==!1){var M=J?">":"<";N&&(M+="="),Q.push(f9+".id "+M+" ?"),K.push(L)}G!==!1&&(Q.push(f9+".id = ?"),K.push(G))}}"ok"!==O.deleted&&Q.push(cF+".deleted = 0"),n.readTransaction(function(S){g(S,function(T){if(F=T,0!==H){var U=jO(eb,[f9,cF],au,Q,f9+".id "+(J?"DESC":"ASC"));U+=" LIMIT "+H+" OFFSET "+E,S.executeSql(U,K,function(Y,ai){for(var ae=0,ar=ai.rows.length;ar>ae;ae++){var X=ai.rows.item(ae),Z=kg(X.metadata),ao=Z.id,W=cY(X.data,ao,X.rev),V=W._rev,an={id:ao,key:ao,value:{rev:V}};if(O.include_docs&&(an.doc=W,an.doc._rev=V,O.conflicts&&(an.doc._conflicts=df(Z)),ab(an.doc,O,z,Y)),X.deleted){if("ok"!==O.deleted){continue}an.value.deleted=!0,an.doc=null}P.push(an)}})}})},dB(I),function(){I(null,{total_rows:F,offset:O.skip,rows:P})})},z._changes=function(E){function F(){var S=f9+".json AS metadata, "+f9+".max_seq AS maxSeq, "+cF+".json AS winningDoc, "+cF+".rev AS winningRev ",T=f9+" JOIN "+cF,R=f9+".id="+cF+".doc_id AND "+f9+".winningseq="+cF+".seq",Q=["maxSeq > ?"],N=[E.since];E.doc_ids&&(Q.push(f9+".id IN "+d8(E.doc_ids.length)),N=N.concat(E.doc_ids));var U="maxSeq "+(J?"DESC":"ASC"),O=jO(S,T,R,Q,U),M=dC(E);E.view||E.filter||(O+=" LIMIT "+G);var P=E.since||0;n.readTransaction(function(V){V.executeSql(O,N,function(X,Y){function W(a0){return function(){E.onChange(a0)}}for(var at=0,an=Y.rows.length;an>at;at++){var ai=Y.rows.item(at),Z=kg(ai.metadata);P=ai.maxSeq;var ae=cY(ai.winningDoc,Z.id,ai.winningRev),ar=E.processChange(ae,Z,E);ar.seq=ai.maxSeq;var ao=M(ar);if("object"==typeof ao){return E.complete(ao)}if(ao&&(I++,L&&K.push(ar),E.attachments&&E.include_docs?ab(ae,E,z,X,W(ar)):W(ar)()),I===G){break}}})},dB(E.complete),function(){E.continuous||E.complete(null,{results:K,last_seq:P})})}if(E=eX(E),E.continuous){var H=z._name+":"+fP();return aL.addListener(z._name,H,z,E),aL.notify(z._name),{cancel:function(){aL.removeListener(z._name,H)}}}var J=E.descending;E.since=E.since&&!J?E.since:0;var G="limit" in E?E.limit:-1;0===G&&(G=1);var L;L="return_docs" in E?E.return_docs:"returnDocs" in E?E.returnDocs:!0;var K=[],I=0;F()},z._close=function(E){E()},z._getAttachment=function(E,F,H){var J,G=F.ctx,L=E.digest,K=E.content_type,I="SELECT escaped, CASE WHEN escaped = 1 THEN body ELSE HEX(body) END AS body FROM "+bv+" WHERE digest=?";G.executeSql(I,[L],function(P,M){var N=M.rows.item(0),O=N.escaped?cZ(N.body):bS(N.body,u);J=F.binary?d6(O,K):fB(O),H(null,J)})},z._getRevisionTree=function(F,E){n.readTransaction(function(H){var G="SELECT json AS metadata FROM "+f9+" WHERE id = ?";H.executeSql(G,[F],function(J,K){if(K.rows.length){var I=kg(K.rows.item(0).metadata);E(null,I.rev_tree)}else{E(jP(aV))}})})},z._doCompaction=function(F,E,G){return E.length?void n.transaction(function(I){var H="SELECT json AS metadata FROM "+f9+" WHERE id = ?";I.executeSql(H,[F],function(M,K){var L=kg(K.rows.item(0).metadata);fH(L.rev_tree,function(O,Q,N,P,S){var R=Q+"-"+N;-1!==E.indexOf(R)&&(S.status="missing")});var J="UPDATE "+f9+" SET json = ? WHERE id = ?";M.executeSql(J,[cB(L),F])}),ad(E,F,I)},dB(G),function(){G()}):G()},z._getLocal=function(F,E){n.readTransaction(function(H){var G="SELECT json, rev FROM "+cz+" WHERE id=?";H.executeSql(G,[F],function(L,J){if(J.rows.length){var K=J.rows.item(0),I=cY(K.json,F,K.rev);E(null,I)}else{E(jP(aV))}})})},z._putLocal=function(K,E,I){function G(N){var P,O;J?(P="UPDATE "+cz+" SET rev=?, json=? WHERE id=? AND rev=?",O=[H,M,L,J]):(P="INSERT INTO "+cz+" (id, rev, json) VALUES (?,?,?)",O=[L,H,M]),N.executeSql(P,O,function(R,Q){Q.rowsAffected?(F={ok:!0,id:L,rev:H},E.ctx&&I(null,F)):I(jP(am))},function(){return I(jP(am)),!1})}"function"==typeof E&&(I=E,E={}),delete K._revisions;var H,J=K._rev,L=K._id;H=J?K._rev="0-"+(parseInt(J.split("-")[1],10)+1):K._rev="0-1";var F,M=b7(K);E.ctx?G(E.ctx):n.transaction(G,dB(I),function(){F&&I(null,F)})},z._removeLocal=function(G,E,I){function F(L){var K="DELETE FROM "+cz+" WHERE id=? AND rev=?",J=[G._id,G._rev];L.executeSql(K,J,function(N,M){return M.rowsAffected?(H={ok:!0,id:G._id,rev:"0-0"},void (E.ctx&&I(null,H))):I(jP(aV))})}"function"==typeof E&&(I=E,E={});var H;E.ctx?F(E.ctx):n.transaction(F,dB(I),function(){H&&I(null,H)})},z._destroy=function(F,E){aL.removeAllListeners(z._name),n.transaction(function(H){var G=[f9,cF,bv,dL,cz,jL];G.forEach(function(I){H.executeSql("DROP TABLE IF EXISTS "+I,[])})},dB(E),function(){eg()&&(delete window.localStorage["_pouch__websqldb_"+z._name],delete window.localStorage[z._name]),E(null,{ok:!0})})}}var dE=c(7),bE=eL(dE),c2=eL(c(2)),dh=eL(c(6)),f6=eL(c(8)),dT=c(12),b3=eL(c(1)),aH=c(4),e1=eL(c(14)),ag=c(10),dX=eL(ag),aE=eL(c(15)),j3=eL(c(16)),eh="function"==typeof Promise?Promise:f6,cV=c2("pouchdb:api");dh(jM,Error),jM.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};var f3=new jM({status:401,error:"unauthorized",reason:"Name or password is incorrect."}),eV=new jM({status:400,error:"bad_request",reason:"Missing JSON list of 'docs'"}),aV=new jM({status:404,error:"not_found",reason:"missing"}),am=new jM({status:409,error:"conflict",reason:"Document update conflict"}),j1=new jM({status:400,error:"invalid_id",reason:"_id field must contain a string"}),by=new jM({status:412,error:"missing_id",reason:"_id is required for puts"}),dJ=new jM({status:400,error:"bad_request",reason:"Only reserved document ids may start with underscore."}),dw=new jM({status:412,error:"precondition_failed",reason:"Database not open"}),cW=new jM({status:500,error:"unknown_error",reason:"Database encountered an unknown error"}),bd=new jM({status:500,error:"badarg",reason:"Some query argument is invalid"}),bk=new jM({status:400,error:"invalid_request",reason:"Request was invalid"}),dc=new jM({status:400,error:"query_parse_error",reason:"Some query parameter is invalid"}),bM=new jM({status:500,error:"doc_validation",reason:"Bad special document member"}),bQ=new jM({status:400,error:"bad_request",reason:"Something wrong with the request"}),e7=new jM({status:400,error:"bad_request",reason:"Document must be a JSON object"}),dp=new jM({status:404,error:"not_found",reason:"Database not found"}),cq=new jM({status:500,error:"indexed_db_went_bad",reason:"unknown"}),fF=new jM({status:500,error:"web_sql_went_bad",reason:"unknown"}),aY=new jM({status:500,error:"levelDB_went_went_bad",reason:"unknown"}),cx=new jM({status:403,error:"forbidden",reason:"Forbidden by design doc validate_doc_update function"}),fK=new jM({status:400,error:"bad_request",reason:"Invalid rev format"}),bB=new jM({status:412,error:"file_exists",reason:"The database could not be created, the file already exists."}),ca=new jM({status:412,error:"missing_stub"}),ax=new jM({status:413,error:"invalid_url",reason:"Provided URL is invalid"}),dM={UNAUTHORIZED:f3,MISSING_BULK_DOCS:eV,MISSING_DOC:aV,REV_CONFLICT:am,INVALID_ID:j1,MISSING_ID:by,RESERVED_ID:dJ,NOT_OPEN:dw,UNKNOWN_ERROR:cW,BAD_ARG:bd,INVALID_REQUEST:bk,QUERY_PARSE_ERROR:dc,DOC_VALIDATION:bM,BAD_REQUEST:bQ,NOT_AN_OBJECT:e7,DB_MISSING:dp,WSQ_ERROR:fF,LDB_ERROR:aY,FORBIDDEN:cx,INVALID_REV:fK,FILE_EXISTS:bB,MISSING_STUB:ca,IDB_ERROR:cq,INVALID_URL:ax},jG=function(j,h,g){var i=Object.keys(dM).filter(function(m){var l=dM[m];return"function"!=typeof l&&l[j]===h}),k=g&&i.filter(function(m){var l=dM[m];return l.message===g})[0]||i[0];return k?dM[k]:null};dh(kb,aH.EventEmitter),kb.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")},kb.prototype.doChanges=function(j){var h=this,g=j.complete;if(j=eX(j),"live" in j&&!("continuous" in j)&&(j.continuous=j.live),j.processChange=dR,"latest"===j.since&&(j.since="now"),j.since||(j.since=0),"now"===j.since){return void this.db.info().then(function(l){return h.isCancelled?void g(null,{status:"cancelled"}):(j.since=l.update_seq,void h.doChanges(j))},g)}if(j.continuous&&"now"!==j.since&&this.db.info().then(function(l){h.startSeq=l.update_seq},function(l){if("idbNull"!==l.id){throw l}}),j.filter&&"string"==typeof j.filter&&("_view"===j.filter?j.view=jR(j.view):j.filter=jR(j.filter),"http"!==this.db.type()&&!j.doc_ids)){return this.filterChanges(j)}"descending" in j||(j.descending=!1),j.limit=0===j.limit?1:j.limit,j.complete=g;var i=this.db._changes(j);if(i&&"function"==typeof i.cancel){var k=h.cancel;h.cancel=b3(function(l){i.cancel(),k.apply(this,l)})}},kb.prototype.filterChanges=function(k){var i=this,h=k.complete;if("_view"===k.filter){if(!k.view||"string"!=typeof k.view){var j=jP(bQ,"`view` filter parameter not found or invalid.");return h(j)}var l=e6(k.view);this.db.getView(l[0],l[1],function(n,m){return i.isCancelled?h(null,{status:"cancelled"}):n?h(cN(n)):m.map?(k.filter=ej(m.map),void i.doChanges(k)):h(jP(aV))})}else{var g=e6(k.filter);if(!g){return i.doChanges(k)}this.db.getFilter(g[0],g[1],function(n,m){return i.isCancelled?h(null,{status:"cancelled"}):n?h(cN(n)):(k.filter=e2(m),void i.doChanges(k))})}};var cy="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),bW=kc(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),ck=kc(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);dh(ec,aH.EventEmitter),ec.prototype.post=eP("post",function(i,h,g){return"function"==typeof h&&(g=h,h={}),"object"!=typeof i||Array.isArray(i)?g(jP(e7)):void this.bulkDocs({docs:[i]},h,fL(g))}),ec.prototype.put=eP("put",b3(function(m){var k,g,l,i,j=m.shift(),h="_id" in j;if("object"!=typeof j||Array.isArray(j)){return(i=m.pop())(jP(e7))}for(;;){if(k=m.shift(),g=typeof k,"string"!==g||h?"string"!==g||!h||"_rev" in j?"object"===g?l=k:"function"===g&&(i=k):j._rev=k:(j._id=k,h=!0),!m.length){break}}return l=l||{},jJ(j._id),fO(j._id)&&"function"==typeof this._putLocal?j._deleted?this._removeLocal(j,i):this._putLocal(j,i):void this.bulkDocs({docs:[j]},l,fL(i))})),ec.prototype.putAttachment=eP("putAttachment",function(m,k,g,l,i){function j(n){var o="_rev" in n?parseInt(n._rev,10):0;return n._attachments=n._attachments||{},n._attachments[k]={content_type:i,data:l,revpos:++o},h.put(n)}var h=this;return"function"==typeof i&&(i=l,l=g,g=null),"undefined"==typeof i&&(i=l,l=g,g=null),h.get(m).then(function(n){if(n._rev!==g){throw jP(am)}return j(n)},function(n){if(n.reason===aV.message){return j({_id:m})}throw n})}),ec.prototype.removeAttachment=eP("removeAttachment",function(j,h,g,i){var k=this;k.get(j,function(m,l){return m?void i(m):l._rev!==g?void i(jP(am)):l._attachments?(delete l._attachments[h],0===Object.keys(l._attachments).length&&delete l._attachments,void k.put(l,i)):i()})}),ec.prototype.remove=eP("remove",function(k,i,h,j){var l;"string"==typeof i?(l={_id:k,_rev:i},"function"==typeof h&&(j=h,h={})):(l=k,"function"==typeof i?(j=i,h={}):(j=h,h=i)),h=h||{},h.was_delete=!0;var g={_id:l._id,_rev:l._rev||h.rev};return g._deleted=!0,fO(g._id)&&"function"==typeof this._removeLocal?this._removeLocal(l,j):void this.bulkDocs({docs:[g]},h,fL(j))}),ec.prototype.revsDiff=eP("revsDiff",function(j,l,h){function n(o,p){m.has(o)||m.set(o,{missing:[]}),m.get(o).missing.push(p)}function g(q,p){var o=j[q].slice(0);fH(p,function(v,s,r,w,u){var y=s+"-"+r,x=o.indexOf(y);-1!==x&&(o.splice(x,1),"available"!==u.status&&n(q,y))}),o.forEach(function(r){n(q,r)})}"function"==typeof l&&(h=l,l={});var k=Object.keys(j);if(!k.length){return h(null,{})}var i=0,m=new dT.Map;k.map(function(o){this._getRevisionTree(o,function(q,p){if(q&&404===q.status&&"missing"===q.message){m.set(o,{missing:j[o]})}else{if(q){return h(q)}g(o,p)}if(++i===k.length){var r={};return m.forEach(function(u,s){r[s]=u}),h(null,r)}})},this)}),ec.prototype.bulkGet=eP("bulkGet",function(g,h){f5(this,g,h)}),ec.prototype.compactDocument=eP("compactDocument",function(j,h,g){var i=this;this._getRevisionTree(j,function(k,n){if(k){return g(k)}var l=cp(n),o=[],m=[];Object.keys(l).forEach(function(p){l[p]>h&&o.push(p)}),fH(n,function(r,p,u,q,s){var v=p+"-"+u;"available"===s.status&&-1!==o.indexOf(v)&&m.push(v)}),i._doCompaction(j,m,g)})}),ec.prototype.compact=eP("compact",function(i,h){"function"==typeof i&&(h=i,i={});var g=this;i=i||{},g._compactionQueue=g._compactionQueue||[],g._compactionQueue.push({opts:i,callback:h}),1===g._compactionQueue.length&&eE(g)}),ec.prototype._compact=function(m,k){function g(n){h.push(i.compactDocument(n.id,0))}function l(n){var o=n.last_seq;eh.all(h).then(function(){return ea(i,"_local/compaction",function(p){return !p.last_seq||p.last_seq<o?(p.last_seq=o,p):!1})}).then(function(){k(null,{ok:!0})})["catch"](k)}var i=this,j={return_docs:!1,last_seq:m.last_seq||0},h=[];i.changes(j).on("change",g).on("complete",l).on("error",k)},ec.prototype.get=eP("get",function(j,l,h){function n(){var o=[],p=g.length;return p?void g.forEach(function(q){k.get(j,{rev:q,revs:l.revs,attachments:l.attachments},function(s,r){s?o.push({missing:q}):o.push({ok:r}),p--,p||h(null,o)})}):h(null,o)}if("function"==typeof l&&(h=l,l={}),"string"!=typeof j){return h(jP(j1))}if(fO(j)&&"function"==typeof this._getLocal){return this._getLocal(j,h)}var g=[],k=this;if(!l.open_revs){return this._get(j,l,function(y,s){if(y){return h(y)}var o=s.doc,w=s.metadata,p=s.ctx;if(l.conflicts){var C=df(w);C.length&&(o._conflicts=C)}if(fD(w,o._rev)&&(o._deleted=!0),l.revs||l.revs_info){var A=fJ(w.rev_tree),x=fQ(A,function(D){return -1!==D.ids.map(function(E){return E.id}).indexOf(o._rev.split("-")[1])}),q=x.ids.map(function(D){return D.id}).indexOf(o._rev.split("-")[1])+1,z=x.ids.length-q;if(x.ids.splice(q,z),x.ids.reverse(),l.revs&&(o._revisions={start:x.pos+x.ids.length-1,ids:x.ids.map(function(D){return D.id})}),l.revs_info){var r=x.pos+x.ids.length;o._revs_info=x.ids.map(function(D){return r--,{rev:r+"-"+D.id,status:D.opts.status}})}}if(l.attachments&&o._attachments){var v=o._attachments,B=Object.keys(v).length;if(0===B){return h(null,o)}Object.keys(v).forEach(function(D){this._getAttachment(v[D],{binary:l.binary,ctx:p},function(F,G){var E=o._attachments[D];E.data=G,delete E.stub,delete E.length,--B||h(null,o)})},k)}else{if(o._attachments){for(var u in o._attachments){o._attachments.hasOwnProperty(u)&&(o._attachments[u].stub=!0)}}h(null,o)}})}if("all"===l.open_revs){this._getRevisionTree(j,function(o,p){return o?h(o):(g=dD(p).map(function(q){return q.rev}),void n())})}else{if(!Array.isArray(l.open_revs)){return h(jP(cW,"function_clause"))}g=l.open_revs;for(var i=0;i<g.length;i++){var m=g[i];if("string"!=typeof m||!/^\d+-/.test(m)){return h(jP(fK))}}n()}}),ec.prototype.getView=eP("getView",function(i,h,g){ek(this,i,"views",h,g)}),ec.prototype.getFilter=eP("getFilter",function(i,h,g){ek(this,i,"filters",h,g)}),ec.prototype.getAttachment=eP("getAttachment",function(j,h,g,i){var k=this;g instanceof Function&&(i=g,g={}),this._get(j,g,function(m,l){return m?i(m):l.doc._attachments&&l.doc._attachments[h]?(g.ctx=l.ctx,g.binary=!0,k._getAttachment(l.doc._attachments[h],g,i),void 0):i(jP(aV))})}),ec.prototype.allDocs=eP("allDocs",function(i,h){if("function"==typeof i&&(h=i,i={}),i.skip="undefined"!=typeof i.skip?i.skip:0,i.start_key&&(i.startkey=i.start_key),i.end_key&&(i.endkey=i.end_key),"keys" in i){if(!Array.isArray(i.keys)){return h(new TypeError("options.keys must be an array"))}var g=["startkey","endkey","key"].filter(function(j){return j in i})[0];if(g){return void h(jP(dc,"Query parameter `"+g+"` is not compatible with multi-get"))}if("http"!==this.type()){return f1(this,i,h)}}return this._allDocs(i,h)}),ec.prototype.changes=function(g,h){return"function"==typeof g&&(h=g,g={}),new kb(this,g,h)},ec.prototype.close=eP("close",function(g){return this._closed=!0,this._close(g)}),ec.prototype.info=eP("info",function(g){var h=this;this._info(function(j,i){return j?g(j):(i.db_name=i.db_name||h._db_name,i.auto_compaction=!(!h.auto_compaction||"http"===h.type()),i.adapter=h.type(),void g(null,i))})}),ec.prototype.id=eP("id",function(g){return this._id(g)}),ec.prototype.type=function(){return"function"==typeof this._type?this._type():this.adapter},ec.prototype.bulkDocs=eP("bulkDocs",function(j,h,g){if("function"==typeof h&&(g=h,h={}),h=h||{},Array.isArray(j)&&(j={docs:j}),!j||!j.docs||!Array.isArray(j.docs)){return g(jP(eV))}for(var i=0;i<j.docs.length;++i){if("object"!=typeof j.docs[i]||Array.isArray(j.docs[i])){return g(jP(e7))}}var k;return j.docs.forEach(function(l){l._attachments&&Object.keys(l._attachments).forEach(function(m){k=k||kj(m)})}),k?g(jP(bQ,k)):("new_edits" in h||("new_edits" in j?h.new_edits=j.new_edits:h.new_edits=!0),h.new_edits||"http"===this.type()||j.docs.sort(fM),eH(j.docs),this._bulkDocs(j,h,function(m,l){return m?g(m):(h.new_edits||(l=l.filter(function(n){return n.error})),void g(null,l))}))}),ec.prototype.registerDependentDatabase=eP("registerDependentDatabase",function(j,h){function g(k){return k.dependentDbs=k.dependentDbs||{},k.dependentDbs[j]?!1:(k.dependentDbs[j]=!0,k)}var i=new this.constructor(j,this.__opts);ea(this,"_local/_pouch_dependentDbs",g).then(function(){h(null,{db:i})})["catch"](h)}),ec.prototype.destroy=eP("destroy",function(j,h){function g(){i._destroy(j,function(l,m){return l?h(l):(i._destroyed=!0,i.emit("destroyed"),void h(null,m||{ok:!0}))})}"function"==typeof j&&(h=j,j={});var i=this,k="use_prefix" in i?i.use_prefix:!0;return"http"===i.type()?g():void i.get("_local/_pouch_dependentDbs",function(l,o){if(l){return 404!==l.status?h(l):g()}var m=o.dependentDbs,p=i.constructor,n=Object.keys(m).map(function(r){var q=k?r.replace(new RegExp("^"+p.prefix),""):r;return new p(q,i.__opts).destroy()});eh.all(n).then(g,h)})}),bZ.prototype.execute=function(){var g;if(this.failed){for(;g=this.queue.shift();){g(this.failed)}}else{for(;g=this.queue.shift();){g()}}},bZ.prototype.fail=function(g){this.failed=g,this.execute()},bZ.prototype.ready=function(g){this.isReady=!0,this.db=g,this.execute()},bZ.prototype.addTask=function(g){this.queue.push(g),this.failed&&this.execute()},dh(bG,ec),bG.debug=c2;var dK;if(eU()){dK=!1}else{try{localStorage.setItem("_pouch_check_localstorage",1),dK=!!localStorage.getItem("_pouch_check_localstorage")}catch(kk){dK=!1}}bG.adapters={},bG.preferredAdapters=[],bG.prefix="_pouch_";var jY=new aH.EventEmitter;jQ(bG),bG.parseAdapter=function(j,l){var h,n,g=j.match(/([a-z\-]*):\/\/(.*)/);if(g){if(j=/http(s?)/.test(g[1])?g[1]+"://"+g[2]:g[2],h=g[1],!bG.adapters[h].valid()){throw"Invalid adapter"}return{name:j,adapter:g[1]}}var k="idb" in bG.adapters&&"websql" in bG.adapters&&eg()&&localStorage["_pouch__websqldb_"+bG.prefix+j];if(l.adapter){n=l.adapter}else{if("undefined"!=typeof l&&l.db){n="leveldb"}else{for(var i=0;i<bG.preferredAdapters.length;++i){if(n=bG.preferredAdapters[i],n in bG.adapters){if(k&&"idb"===n){console.log('PouchDB is downgrading "'+j+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.');continue}break}}}}h=bG.adapters[n];var m=h&&"use_prefix" in h?h.use_prefix:!0;return{name:m?bG.prefix+j:j,adapter:n}},bG.adapter=function(i,h,g){h.valid()&&(bG.adapters[i]=h,g&&bG.preferredAdapters.push(i))},bG.plugin=function(g){return Object.keys(g).forEach(function(h){bG.prototype[h]=g[h]}),bG},bG.defaults=function(g){function h(k,i,j){return this instanceof h?("function"!=typeof i&&"undefined"!=typeof i||(j=i,i={}),k&&"object"==typeof k&&(i=k,k=void 0),i=dE.extend({},g,i),void bG.call(this,k,i,j)):new h(k,i,j)}return dh(h,bG),jQ(h),h.preferredAdapters=bG.preferredAdapters.slice(),Object.keys(bG).forEach(function(i){i in h||(h[i]=bG[i])}),h};var bc=ah(),dH=function(){},aO=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],eC="queryKey",b4=/(?:^|&)([^&=]*)=?([^&]*)/g,e=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,bg=function(g){return atob(g)},fB=function(g){return btoa(g)},cT=bE.extend,cK={ajax:ef,parseUri:aP,uuid:fP,Promise:eh,atob:bg,btoa:fB,binaryStringToBlobOrBuffer:d6,clone:eX,extend:cT,createError:jP},dm=dX.collate,f7=1,dY="pouchdb",b8=5,aI=0;aQ.prototype.writeCheckpoint=function(i,h){var g=this;return this.updateTarget(i,h).then(function(){return g.updateSource(i,h)})},aQ.prototype.updateTarget=function(g,h){return bF(this.target,this.id,g,h,this.returnValue)},aQ.prototype.updateSource=function(i,h){var g=this;return this.readOnlySource?eh.resolve(!0):bF(this.src,this.id,i,h,this.returnValue)["catch"](function(j){if(cM(j)){return g.readOnlySource=!0,!0}throw j})};var du={undefined:function(g,h){return 0===dm(g.last_seq,h.last_seq)?h.last_seq:0},1:function(g,h){return cj(h,g).last_seq}};aQ.prototype.getCheckpoint=function(){var g=this;return g.target.get(g.id).then(function(h){return g.readOnlySource?eh.resolve(h.last_seq):g.src.get(g.id).then(function(i){if(h.version!==i.version){return aI}var j;return j=h.version?h.version.toString():"undefined",j in du?du[j](h,i):aI},function(i){if(404===i.status&&h.last_seq){return g.src.put({_id:g.id,last_seq:aI}).then(function(){return aI},function(j){return cM(j)?(g.readOnlySource=!0,h.last_seq):aI})}throw i})})["catch"](function(h){if(404!==h.status){throw h}return aI})};var aj=0,cm=db.setImmediate||db.setTimeout,aG=32768,dq=dx(function(o,h){function l(){var q=i*m,u=q+m;if(i++,g>i){p(n,o,q,u),cm(l)}else{p(n,o,q,u);var r=n.end(!0),s=jW(r);h(null,s),n.destroy()}}var j="string"==typeof o,k=j?o.length:o.byteLength,m=Math.min(aG,k),g=Math.ceil(k/m),i=0,n=j?new aE:new aE.ArrayBuffer,p=j?aS:fI;l()});dh(eF,aH.EventEmitter),eF.prototype.cancel=function(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")},eF.prototype.ready=function(j,h){function g(){k.cancel()}function i(){j.removeListener("destroyed",g),h.removeListener("destroyed",g)}var k=this;k._readyCalled||(k._readyCalled=!0,j.once("destroyed",g),h.once("destroyed",g),k.once("complete",i))};var eA={replicate:kf,toPouch:jX},c0=eA.replicate;dh(d9,aH.EventEmitter),d9.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())};var e4=25,aX=50,ap={},dZ=1800,bC=c2("pouchdb:http");aF.valid=function(){return !0},eW.prototype.add=function(g){return this.promise=this.promise["catch"](function(){}).then(function(){return g()}),this.promise},eW.prototype.finish=function(){return this.promise};var dN,dy=function(g,h){return h&&g.then(function(i){eT.nextTick(function(){h(null,i)})},function(i){eT.nextTick(function(){h(i)})}),g},j7=function(g){return b3(function(h){var j=h.pop(),i=g.apply(this,h);return"function"==typeof j&&dy(i,j),i})},bh=function(g,h){return g.then(function(i){return h().then(function(){return i})},function(i){return h().then(function(){throw i})})},bm=function(g,h){return function(){var j=arguments,i=this;return g.add(function(){return h.apply(i,j)})}},ds=function(k){for(var i={},h=0,j=k.length;j>h;h++){i["$"+k[h]]=!0}var l=Object.keys(i),g=new Array(l.length);for(h=0,j=l.length;j>h;h++){g[h]=l[h].substring(1)}return g},bV={uniq:ds,sequentialize:bm,fin:bh,callbackify:j7,promisedCallback:dy},bT=dX.collate,cu=dX.toIndexableString,bw=dX.normalizeKey,cs=dX.parseIndexableString;dN="undefined"!=typeof console&&"function"==typeof console.log?Function.prototype.bind.call(console.log,console):function(){};var eN=bV.callbackify,a8=bV.sequentialize,cC=bV.uniq,fN=bV.fin,bP=bV.promisedCallback,cf={},ay=new eW,dV=50,jH={_sum:function(g,h){return e9(h)},_count:function(g,h){return h.length},_stats:function(i,h){function g(m){for(var k=0,j=0,l=m.length;l>j;j++){var n=m[j];k+=n*n}return k}return{sum:e9(h),min:Math.min.apply(null,h),max:Math.max.apply(null,h),count:h.length,sumsqr:g(h)}}},cO=eN(function(){var g=this;return g._ddocCache&&delete g._ddocCache,"http"===g.type()?jF(g):"function"==typeof g._viewCleanup?c9(g):cl(g)}),b5=function(j,h,g){"function"==typeof h&&(g=h,h={}),h=h?dF(h):{},"function"==typeof j&&(j={map:j});var i=this,k=eh.resolve().then(function(){return bR(i,j,h)});return bP(k,g),k};dh(eB,Error),dh(dA,Error);var cS={query:b5,viewCleanup:cO},dU=5,jN="document-store",ac="by-sequence",bl="attach-store",d5="attach-seq-store",cG="meta-store",eJ="local-store",b9="detect-blob-support",aa={running:!1,queue:[]};dh(bY,aH.EventEmitter),bY.prototype.addListener=function(l,h,i,k){function m(){function n(){j=!1}if(g._listeners[h]){if(j){return void (j="waiting")}j=!0;var o=d1(k,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary"]);i.changes(o).on("change",function(p){p.seq>k.since&&!k.cancelled&&(k.since=p.seq,k.onChange(p))}).on("complete",function(){"waiting"===j&&setTimeout(function(){m()},0),j=!1}).on("error",n)}}if(!this._listeners[h]){var g=this,j=!1;this._listeners[h]=m,this.on(l,m)}},bY.prototype.removeListener=function(g,h){h in this._listeners&&aH.EventEmitter.prototype.removeListener.call(this,g,this._listeners[h])},bY.prototype.notifyLocalWindows=function(g){eU()?chrome.storage.local.set({dbName:g}):eg()&&(localStorage[g]="a"===localStorage[g]?"b":"a")},bY.prototype.notify=function(g){this.emit(g),this.notifyLocalWindows(g)};var dg,dz=new dT.Map,bz=new bY,cX=new dT.Map;cU.valid=function(){var g="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform);return !g&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange};var bJ=7,f9=cg("document-store"),cF=cg("by-sequence"),bv=cg("attach-store"),cz=cg("local-store"),dL=cg("metadata-store"),jL=cg("attach-seq-store"),cR=new dT.Map,aL=new bY,dO=1,cI="CREATE INDEX IF NOT EXISTS 'by-seq-deleted-idx' ON "+cF+" (seq, deleted)",dj="CREATE UNIQUE INDEX IF NOT EXISTS 'by-seq-doc-id-rev' ON "+cF+" (doc_id, rev)",t="CREATE INDEX IF NOT EXISTS 'doc-winningseq-idx' ON "+f9+" (winningseq)",cd="CREATE INDEX IF NOT EXISTS 'attach-seq-seq-idx' ON "+jL+" (seq)",bi="CREATE UNIQUE INDEX IF NOT EXISTS 'attach-seq-digest-idx' ON "+jL+" (digest, seq)",au=cF+".seq = "+f9+".winningseq",eb=cF+".seq AS seq, "+cF+".deleted AS deleted, "+cF+".json AS data, "+cF+".rev AS rev, "+f9+".json AS metadata";dk.use_prefix=!("undefined"!=typeof eT&&!eT.browser),dk.valid=d2;var b1={idb:cU,websql:dk};bG.ajax=ef,bG.utils=cK,bG.Errors=dM,bG.replicate=eA.replicate,bG.sync=aC,bG.version="5.3.2",bG.adapter("http",aF),bG.adapter("https",aF),bG.plugin(cS),Object.keys(b1).forEach(function(g){bG.adapter(g,b1[g],!0)}),f.exports=bG}).call(this,c(13),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{1:1,10:10,12:12,13:13,14:14,15:15,16:16,2:2,4:4,6:6,7:7,8:8}]},{},[17])(17)});