!function(b){if("object"==typeof exports&&"undefined"!=typeof module){module.exports=b()}else{if("function"==typeof define&&define.amd){define([],b)}else{var a;a="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,a.PouchDB=b()}}}(function(){var b;return function a(f,h,c){function d(l,e){if(!h[l]){if(!f[l]){var m="function"==typeof require&&require;if(!e&&m){return m(l,!0)}if(j){return j(l,!0)}var k=new Error("Cannot find module '"+l+"'");throw k.code="MODULE_NOT_FOUND",k}var i=h[l]={exports:{}};f[l][0].call(i.exports,function(n){var o=f[l][1][n];return d(o?o:n)},i,i.exports,a,f,h,c)}return h[l].exports}for(var j="function"==typeof require&&require,g=0;g<c.length;g++){d(c[g])}return d}({1:[function(j,f,l){function d(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function k(e){return"function"==typeof e}function c(e){return"number"==typeof e}function g(e){return"object"==typeof e&&null!==e}function h(e){return void 0===e}f.exports=d,d.EventEmitter=d,d.prototype._events=void 0,d.prototype._maxListeners=void 0,d.defaultMaxListeners=10,d.prototype.setMaxListeners=function(e){if(!c(e)||0>e||isNaN(e)){throw TypeError("n must be a positive number")}return this._maxListeners=e,this},d.prototype.emit=function(q){var i,m,p,e,n,o;if(this._events||(this._events={}),"error"===q&&(!this._events.error||g(this._events.error)&&!this._events.error.length)){if(i=arguments[1],i instanceof Error){throw i}throw TypeError('Uncaught, unspecified "error" event.')}if(m=this._events[q],h(m)){return !1}if(k(m)){switch(arguments.length){case 1:m.call(this);break;case 2:m.call(this,arguments[1]);break;case 3:m.call(this,arguments[1],arguments[2]);break;default:e=Array.prototype.slice.call(arguments,1),m.apply(this,e)}}else{if(g(m)){for(e=Array.prototype.slice.call(arguments,1),o=m.slice(),p=o.length,n=0;p>n;n++){o[n].apply(this,e)}}}return !0},d.prototype.addListener=function(m,i){var e;if(!k(i)){throw TypeError("listener must be a function")}return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",m,k(i.listener)?i.listener:i),this._events[m]?g(this._events[m])?this._events[m].push(i):this._events[m]=[this._events[m],i]:this._events[m]=i,g(this._events[m])&&!this._events[m].warned&&(e=h(this._maxListeners)?d.defaultMaxListeners:this._maxListeners,e&&e>0&&this._events[m].length>e&&(this._events[m].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[m].length),"function"==typeof console.trace&&console.trace())),this},d.prototype.on=d.prototype.addListener,d.prototype.once=function(i,n){function m(){this.removeListener(i,m),e||(e=!0,n.apply(this,arguments))}if(!k(n)){throw TypeError("listener must be a function")}var e=!1;return m.listener=n,this.on(i,m),this},d.prototype.removeListener=function(e,m){var i,p,n,o;if(!k(m)){throw TypeError("listener must be a function")}if(!this._events||!this._events[e]){return this}if(i=this._events[e],n=i.length,p=-1,i===m||k(i.listener)&&i.listener===m){delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,m)}else{if(g(i)){for(o=n;o-->0;){if(i[o]===m||i[o].listener&&i[o].listener===m){p=o;break}}if(0>p){return this}1===i.length?(i.length=0,delete this._events[e]):i.splice(p,1),this._events.removeListener&&this.emit("removeListener",e,m)}}return this},d.prototype.removeAllListeners=function(m){var i,e;if(!this._events){return this}if(!this._events.removeListener){return 0===arguments.length?this._events={}:this._events[m]&&delete this._events[m],this}if(0===arguments.length){for(i in this._events){"removeListener"!==i&&this.removeAllListeners(i)}return this.removeAllListeners("removeListener"),this._events={},this}if(e=this._events[m],k(e)){this.removeListener(m,e)}else{if(e){for(;e.length;){this.removeListener(m,e[e.length-1])}}}return delete this._events[m],this},d.prototype.listeners=function(i){var e;return e=this._events&&this._events[i]?k(this._events[i])?[this._events[i]]:this._events[i].slice():[]},d.prototype.listenerCount=function(i){if(this._events){var e=this._events[i];if(k(e)){return 1}if(e){return e.length}}return 0},d.listenerCount=function(i,e){return i.listenerCount(e)}},{}],2:[function(A,d,p){function k(){g&&c&&(g=!1,c.length?q=c.concat(q):z=-1,q.length&&m())}function m(){if(!g){var f=y(k);g=!0;for(var e=q.length;e;){for(c=q,q=[];++z<e;){c&&c[z].run()}z=-1,e=q.length}c=null,g=!1,w(f)}}function x(f,e){this.fun=f,this.array=e}function j(){}var y,w,v=d.exports={};!function(){try{y=setTimeout}catch(e){y=function(){throw new Error("setTimeout is not defined")}}try{w=clearTimeout}catch(e){w=function(){throw new Error("clearTimeout is not defined")}}}();var c,q=[],g=!1,z=-1;v.nextTick=function(f){var e=new Array(arguments.length-1);if(arguments.length>1){for(var h=1;h<arguments.length;h++){e[h-1]=arguments[h]}}q.push(new x(f,e)),1!==q.length||g||y(m,0)},x.prototype.run=function(){this.fun.apply(null,this.array)},v.title="browser",v.browser=!0,v.env={},v.argv=[],v.version="",v.versions={},v.on=j,v.addListener=j,v.once=j,v.off=j,v.removeListener=j,v.removeAllListeners=j,v.emit=j,v.binding=function(e){throw new Error("process.binding is not supported")},v.cwd=function(){return"/"},v.chdir=function(e){throw new Error("process.chdir is not supported")},v.umask=function(){return 0}},{}],3:[function(f,d,c){(function(eR,eK){function dS(g){return g&&"object"==typeof g&&"default" in g?g["default"]:g}function dk(g){return g instanceof ArrayBuffer||"undefined"!=typeof Blob&&g instanceof Blob}function f3(g){if("function"==typeof g.slice){return g.slice(0)}var i=new ArrayBuffer(g.byteLength),h=new Uint8Array(i),j=new Uint8Array(g);return h.set(j),i}function jQ(g){if(g instanceof ArrayBuffer){return f3(g)}var i=g.size,h=g.type;return"function"==typeof g.slice?g.slice(0,i,h):g.webkitSlice(0,i,h)}function fN(g){var i=Object.getPrototypeOf(g);if(null===i){return !0}var h=i.constructor;return"function"==typeof h&&h instanceof h&&eH.call(h)==dD}function d8(k){var i,h,j;if(!k||"object"!=typeof k){return k}if(Array.isArray(k)){for(i=[],h=0,j=k.length;j>h;h++){i[h]=d8(k[h])}return i}if(k instanceof Date){return k.toISOString()}if(dk(k)){return jQ(k)}if(!fN(k)){return k}i={};for(h in k){if(Object.prototype.hasOwnProperty.call(k,h)){var g=d8(k[h]);"undefined"!=typeof g&&(i[h]=g)}}return i}function eS(h){var g=!1;return fG(function(i){if(g){throw new Error("once called more than once")}g=!0,h.apply(this,i)})}function fE(g){return fG(function(j){j=d8(j);var k,l=this,i="function"==typeof j[j.length-1]?j.pop():!1;i&&(k=function(n,m){eR.nextTick(function(){i(n,m)})});var h=new ca(function(o,n){var q;try{var p=eS(function(r,s){r?n(r):o(s)});j.push(p),q=g.apply(l,j),q&&"function"==typeof q.then&&o(q)}catch(m){n(m)}});return k&&h.then(function(m){k(null,m)},k),h})}function ek(g,i){function h(o,m,k){if(bw.enabled){for(var n=[o._db_name,m],j=0;j<k.length-1;j++){n.push(k[j])}bw.apply(null,n);var l=k[k.length-1];k[k.length-1]=function(r,p){var q=[o._db_name,m];q=q.concat(r?["error",r]:["success",p]),bw.apply(null,q),l(r,p)}}}return fE(fG(function(j){if(this._closed){return ca.reject(new Error("database is closed"))}if(this._destroyed){return ca.reject(new Error("database is destroyed"))}var k=this;return h(k,g,j),this.taskqueue.isReady?i.apply(this,j):new ca(function(l,m){k.taskqueue.addTask(function(n){n?m(n):l(k[g].apply(k,j))})})}))}function f5(l,j){for(var i={},k=0,h=j.length;h>k;k++){var g=j[k];g in l&&(i[g]=l[g])}return i}function eb(g){return g}function fL(g){return[{ok:g}]}function j8(j,k,r){function p(){var w=[];l.forEach(function(x){x.docs.forEach(function(y){w.push({id:x.id,docs:[y]})})}),r(null,{results:w})}function q(){++s===h&&p()}function v(w,y,x){l[w]={id:y,docs:x},q()}function o(){if(!(g>=n.length)){var x=Math.min(g+eT,n.length),w=n.slice(g,x);i(w,g),g+=w.length}}function i(x,w){x.forEach(function(B,z){var D=w+z,C=m[B],y=f5(C[0],["atts_since","attachments"]);y.open_revs=C.map(function(E){return E.rev}),y.open_revs=y.open_revs.filter(eb);var A=eb;0===y.open_revs.length&&(delete y.open_revs,A=fL),["revs","attachments","binary","ajax"].forEach(function(E){E in k&&(y[E]=k[E])}),j.get(B,y,function(G,E){var F;F=G?[{error:G}]:A(E),v(D,B,F),o()})})}var u=k.docs,m={};u.forEach(function(w){w.id in m?m[w.id].push(w):m[w.id]=[w]});var h=Object.keys(m).length,s=0,l=new Array(h),n=Object.keys(m),g=0;o()}function bz(){return"undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage&&"undefined"!=typeof chrome.storage.local}function eE(){return fD}function ag(g){bz()?chrome.storage.onChanged.addListener(function(h){null!=h.db_name&&g.emit(h.dbName.newValue)}):eE()&&("undefined"!=typeof addEventListener?addEventListener("storage",function(h){g.emit(h.key)}):window.attachEvent("storage",function(h){g.emit(h.key)}))}function fF(){jS.EventEmitter.call(this),this._listeners={},ag(this)}function fJ(h){if("undefined"!==console&&h in console){var g=Array.prototype.slice.call(arguments,1);console[h].apply(console,g)}}function ka(k,i){var h=600000;k=parseInt(k,10)||0,i=parseInt(i,10),i!==i||k>=i?i=(k||1)<<1:i+=1,i>h&&(k=h>>1,i=h);var j=Math.random(),g=i-k;return ~~(g*j+k)}function jT(h){var g=0;return h||(g=2000),ka(h,g)}function eY(h,g){fJ("info","The above "+h+" is totally normal. "+g)}function e4(g){Error.call(this,g.reason),this.status=g.status,this.name=g.error,this.message=g.reason,this.error=!0}function ke(g,i,h){function j(k){for(var l in g){"function"!=typeof g[l]&&(this[l]=g[l])}void 0!==h&&(this.name=h),void 0!==k&&(this.reason=k)}return j.prototype=e4.prototype,new j(i)}function kg(l){var j,i,k,h,g;return i=l.error===!0&&"string"==typeof l.name?l.name:l.error,g=l.reason,k=cA("name",i,g),l.missing||"missing"===g||"deleted"===g||"not_found"===i?k=aa:"doc_validation"===i?(k=fO,h=g):"bad_request"===i&&k.message!==g&&(k=dA),k||(k=cA("status",l.status,g)||aX),j=ke(k,g,i),h&&(j.message=h),l.id&&(j.id=l.id),l.status&&(j.status=l.status),l.missing&&(j.missing=l.missing),j}function bK(k,i,h){try{return !k(i,h)}catch(j){var g="Filter function threw: "+j.toString();return ke(dA,g)}}function f1(g){var i={},h=g.filter&&"function"==typeof g.filter;return i.query=g.query_params,function(k){k.doc||(k.doc={});var l=h&&bK(g.filter,k.doc,i);if("object"==typeof l){return l}if(l){return !1}if(g.include_docs){if(!g.attachments){for(var j in k.doc._attachments){k.doc._attachments.hasOwnProperty(j)&&(k.doc._attachments[j].stub=!0)}}}else{delete k.doc}return !0}}function c1(g){for(var i=[],h=0,j=g.length;j>h;h++){i=i.concat(g[h])}return i}function j1(h){var g;if(h?"string"!=typeof h?g=ke(cf):/^_/.test(h)&&!/^_(design|local)/.test(h)&&(g=ke(j3)):g=ke(ea),g){throw g}}function t(h,g){return"listenerCount" in h?h.listenerCount(g):jS.EventEmitter.listenerCount(h,g)}function kh(h){if(!h){return null}var g=h.split("/");return 2===g.length?g:1===g.length?[h,h]:null}function km(h){var g=kh(h);return g?g.join("/"):null}function jV(i){for(var l=f7.exec(i),g={},m=14;m--;){var j=aK[m],k=l[m]||"",h=-1!==["user","password"].indexOf(j);g[j]=h?decodeURIComponent(k):k}return g[al]={},g[aK[12]].replace(fC,function(n,o,p){o&&(g[al][o]=p)}),g}function f2(g,i,h){return new ca(function(j,k){g.get(i,function(l,n){if(l){if(404!==l.status){return k(l)}n={}}var m=n._rev,o=h(n);return o?(o._id=i,o._rev=m,void j(j6(g,o,h))):j({updated:!1,rev:m})})})}function j6(g,i,h){return g.put(i).then(function(j){return{updated:!0,rev:j.rev}},function(j){if(409!==j.status){throw j}return f2(g,i._id,h)})}function f6(g){return 0|Math.random()*g}function jY(g,i){i=i||da.length;var h="",j=-1;if(g){for(;++j<g;){h+=da[f6(i)]}return h}for(;++j<36;){switch(j){case 8:case 13:case 18:case 23:h+="-";break;case 19:h+=da[3&f6(16)|8];break;default:h+=da[f6(16)]}}return h}function cI(r){for(var n,q,o,p,g=r.rev_tree.slice();p=g.pop();){var l=p.ids,h=l[2],m=p.pos;if(h.length){for(var k=0,i=h.length;i>k;k++){g.push({pos:m+1,ids:h[k]})}}else{var s=!!l[1].deleted,j=l[0];n&&!(o!==s?o:q!==m?m>q:j>n)||(n=j,q=m,o=s)}}return q+"-"+n}function fQ(g,i){for(var m,k=g.slice();m=k.pop();){for(var l=m.pos,o=m.ids,h=o[2],j=i(0===h.length,l,o[0],m.ctx,o[1]),p=0,n=h.length;n>p;p++){k.push({pos:l+1,ids:h[p],ctx:j})}}}function kk(h,g){return h.pos-g.pos}function ad(g){var i=[];fQ(g,function(o,l,n,k,m){o&&i.push({rev:l+"-"+n,pos:l,opts:m})}),i.sort(kk).reverse();for(var h=0,j=i.length;j>h;h++){delete i[h].pos}return i}function af(i){for(var l=cI(i),g=ad(i.rev_tree),m=[],j=0,k=g.length;k>j;j++){var h=g[j];h.rev===l||h.opts.deleted||m.push(h.rev)}return m}function dZ(h){var g=[];return fQ(h.rev_tree,function(l,i,k,m,j){"available"!==j.status||l||(g.push(i+"-"+k),j.status="missing")}),g}function jI(r){for(var n,q=[],o=r.slice();n=o.pop();){var p=n.pos,g=n.ids,l=g[0],h=g[1],m=g[2],k=0===m.length,i=n.history?n.history.slice():[];i.push({id:l,opts:h}),k&&q.push({pos:p+1-i.length,ids:i});for(var s=0,j=m.length;j>s;s++){o.push({pos:p+1,ids:m[s],history:i})}}return q.reverse()}function ds(h,g){return h.pos-g.pos}function d4(l,j,i){for(var k,h=0,g=l.length;g>h;){k=h+g>>>1,i(l[k],j)<0?h=k+1:g=k}return h}function c0(g,i,h){var j=d4(g,i,h);g.splice(j,0,i)}function jW(l,n){for(var i,g,h=n,m=l.length;m>h;h++){var k=l[h],j=[k.id,k.opts,[]];g?(g[2].push(j),g=j):i=g=j}return i}function fK(h,g){return h[0]<g[0]?-1:1}function c9(g,i){for(var m=[{tree1:g,tree2:i}],k=!1;m.length>0;){var l=m.pop(),o=l.tree1,h=l.tree2;(o[1].status||h[1].status)&&(o[1].status="available"===o[1].status||"available"===h[1].status?"available":"missing");for(var j=0;j<h[2].length;j++){if(o[2][0]){for(var p=!1,n=0;n<o[2].length;n++){o[2][n][0]===h[2][j][0]&&(m.push({tree1:o[2][n],tree2:h[2][j]}),p=!0)}p||(k="new_branch",c0(o[2],h[2][j],fK))}else{k="new_leaf",o[2][0]=h[2][j]}}}return{conflicts:k,tree:g}}function jU(y,u,n){var z,k=[],q=!1,r=!1;if(!y.length){return{tree:[u],conflicts:"new_leaf"}}for(var w=0,j=y.length;j>w;w++){var m=y[w];if(m.pos===u.pos&&m.ids[0]===u.ids[0]){z=c9(m.ids,u.ids),k.push({pos:m.pos,ids:z.tree}),q=q||z.conflicts,r=!0}else{if(n!==!0){var x=m.pos<u.pos?m:u,p=m.pos<u.pos?u:m,A=p.pos-x.pos,s=[],i=[];for(i.push({ids:x.ids,diff:A,parent:null,parentIdx:null});i.length>0;){var h=i.pop();if(0!==h.diff){for(var g=h.ids[2],l=0,o=g.length;o>l;l++){i.push({ids:g[l],diff:h.diff-1,parent:h.ids,parentIdx:l})}}else{h.ids[0]===p.ids[0]&&s.push(h)}}var v=s[0];v?(z=c9(v.ids,p.ids),v.parent[2][v.parentIdx]=z.tree,k.push({pos:x.pos,ids:x.ids}),q=q||z.conflicts,r=!0):k.push(m)}else{k.push(m)}}}return r||k.push(u),k.sort(ds),{tree:k,conflicts:q||"internal_node"}}function jR(r,n){for(var q,o=jI(r),p={},g=0,l=o.length;l>g;g++){for(var h=o[g],m=h.ids,k=Math.max(0,m.length-n),i={pos:h.pos+k,ids:jW(m,k)},s=0;k>s;s++){var j=h.pos+s+"-"+m[s].id;p[j]=!0}q=q?jU(q,i,!0).tree:[i]}return fQ(q,function(v,u,w){delete p[u+"-"+w]}),{tree:q,revs:Object.keys(p)}}function j0(k,i,h){var j=jU(k,i),g=jR(j.tree,h);return{tree:g.tree,stemmedRevs:g.revs,conflicts:j.conflicts}}function ch(g,i){for(var m,k=g.slice(),l=i.split("-"),o=parseInt(l[0],10),h=l[1];m=k.pop();){if(m.pos===o&&m.ids[0]===h){return !0}for(var j=m.ids[2],p=0,n=j.length;n>p;p++){k.push({pos:m.pos+1,ids:j[p]})}}return !1}function bA(g){return g.ids}function dH(k,i){i||(i=cI(k));for(var h,j=i.substring(i.indexOf("-")+1),g=k.rev_tree.map(bA);h=g.pop();){if(h[0]===j){return !!h[1].deleted}g=g.concat(h[2])}}function dg(g){return/^_local/.test(g)}function kf(g){return dP("return "+g+";",{})}function aR(g){return new Function("doc",["var emitted = false;","var emit = function (a, b) {","  emitted = true;","};","var view = "+g+";","view(doc);","if (emitted) {","  return true;","}"].join("\n"))}function av(g,i){try{g.emit("change",i)}catch(h){fJ("error",'Error in .on("change", function):',h)}}function dw(i,l,g){function m(){j.cancel()}jS.EventEmitter.call(this);var j=this;this.db=i,l=l?d8(l):{};var k=l.complete=eS(function(o,n){o?t(j,"error")>0&&j.emit("error",o):j.emit("complete",n),j.removeAllListeners(),i.removeListener("destroyed",m)});g&&(j.on("complete",function(n){g(null,n)}),j.on("error",g)),i.once("destroyed",m),l.onChange=function(n){l.isCancelled||(av(j,n),j.startSeq&&j.startSeq<=n.seq&&(j.startSeq=!1))};var h=new ca(function(o,n){l.complete=function(p,q){p?n(p):o(q)}});j.once("cancel",function(){i.removeListener("destroyed",m),l.complete(null,{status:"cancelled"})}),this.then=h.then.bind(h),this["catch"]=h["catch"].bind(h),this.then(function(n){k(null,n)},k),i.taskqueue.isReady?j.doChanges(l):i.taskqueue.addTask(function(){j.isCancelled?j.emit("cancel"):j.doChanges(l)})}function aT(k,i,h){var j=[{rev:k._rev}];"all_docs"===h.style&&(j=ad(i.rev_tree).map(function(l){return{rev:l.rev}}));var g={id:i.id,changes:j,doc:k};return dH(i,k._rev)&&(g.deleted=!0),h.conflicts&&(g.doc._conflicts=af(i),g.doc._conflicts.length||delete g.doc._conflicts),g}function cO(h,g){return g>h?-1:h>g?1:0}function bU(g,i){for(var h=0;h<g.length;h++){if(i(g[h],h)===!0){return g[h]}}}function ec(g){return function(h,i){h||i[0]&&i[0].error?g(h||i[0]):g(null,i.length?i[0]:i)}}function bl(l){for(var j=0;j<l.length;j++){var i=l[j];if(i._deleted){delete i._attachments}else{if(i._attachments){for(var k=Object.keys(i._attachments),h=0;h<k.length;h++){var g=k[h];i._attachments[g]=f5(i._attachments[g],["data","digest","content_type","length","revpos","stub"])}}}}}function aQ(k,i){var h=cO(k._id,i._id);if(0!==h){return h}var j=k._revisions?k._revisions.start:0,g=i._revisions?i._revisions.start:0;return cO(j,g)}function ac(g){var i={},h=[];return fQ(g,function(j,n,k,m){var l=n+"-"+k;return j&&(i[l]=0),void 0!==m&&h.push({from:m,to:l}),l}),h.reverse(),h.forEach(function(j){void 0===i[j.from]?i[j.from]=1+i[j.to]:i[j.from]=Math.min(i[j.from],1+i[j.to])}),i}function dX(k,i,h){var j="limit" in i?i.keys.slice(i.skip,i.limit+i.skip):i.skip>0?i.keys.slice(i.skip):i.keys;if(i.descending&&j.reverse(),!j.length){return k._allDocs({limit:0},h)}var g={offset:i.skip};return ca.all(j.map(function(m){var l=aI.extend({key:m,deleted:"ok"},i);return["limit","skip","keys"].forEach(function(n){delete l[n]}),new ca(function(o,n){k._allDocs(l,function(q,p){return q?n(q):(g.total_rows=p.total_rows,void o(p.rows[0]||{key:m,error:"not_found"}))})})})).then(function(l){return g.rows=l,g})}function cP(g){var i=g._compactionQueue[0],j=i.opts,h=i.callback;g.get("_local/compaction")["catch"](function(){return !1}).then(function(k){k&&k.last_seq&&(j.last_seq=k.last_seq),g._compact(j,function(l,m){l?h(l):h(null,m),eR.nextTick(function(){g._compactionQueue.shift(),g._compactionQueue.length&&cP(g)})})})}function bS(g){return"_"===g.charAt(0)?g+"is not a valid attachment name, attachment names cannot start with '_'":!1}function jL(){jS.EventEmitter.call(this)}function bu(){this.isReady=!1,this.failed=!1,this.queue=[]}function dl(g){g&&eK.debug&&fJ("error",g)}function bP(i,l){function g(){k.emit("destroyed",j)}function m(){i.removeListener("destroyed",g),i.emit("destroyed",i)}var j=l.originalName,k=i.constructor,h=k._destructionListeners;i.once("destroyed",g),h.has(j)||h.set(j,[]),h.get(j).push(m)}function aD(i,l,g){if(!(this instanceof aD)){return new aD(i,l,g)}var m=this;if("function"!=typeof l&&"undefined"!=typeof l||(g=l,l={}),i&&"object"==typeof i&&(l=i,i=void 0),"undefined"==typeof g){g=dl}else{var j=g;g=function(){return fJ("warn","Using a callback for new PouchDB()is deprecated."),j.apply(null,arguments)}}i=i||l.name,l=d8(l),delete l.name,this.__opts=l;var k=g;m.auto_compaction=l.auto_compaction,m.prefix=aD.prefix,jL.call(m),m.taskqueue=new bu;var h=new ca(function(o,q){g=function(r,s){return r?q(r):(delete s.then,void o(s))},l=d8(l);var p,n;return function(){try{if("string"!=typeof i){throw n=new Error("Missing/invalid DB name"),n.code=400,n}var r=(l.prefix||"")+i;if(p=aD.parseAdapter(r,l),l.originalName=i,l.name=p.name,l.adapter=l.adapter||p.adapter,m._adapter=l.adapter,bY("pouchdb:adapter")("Picked adapter: "+l.adapter),m._db_name=i,!aD.adapters[l.adapter]){throw n=new Error("Adapter is missing"),n.code=404,n}if(!aD.adapters[l.adapter].valid()){throw n=new Error("Invalid Adapter"),n.code=404,n}}catch(s){m.taskqueue.fail(s)}}(),n?q(n):(m.adapter=l.adapter,m.replicate={},m.replicate.from=function(r,u,s){return m.constructor.replicate(r,m,u,s)},m.replicate.to=function(r,u,s){return m.constructor.replicate(m,r,u,s)},m.sync=function(r,u,s){return m.constructor.sync(m,r,u,s)},m.replicate.sync=m.sync,void aD.adapters[l.adapter].call(m,l,function(r){return r?(m.taskqueue.fail(r),void g(r)):(bP(m,l),m.emit("created",m),aD.emit("created",l.originalName),m.taskqueue.ready(m),void g(null,m))}))});h.then(function(n){k(null,n)},k),m.then=h.then.bind(h),m["catch"]=h["catch"].bind(h)}function e1(h){Object.keys(jS.EventEmitter.prototype).forEach(function(i){"function"==typeof jS.EventEmitter.prototype[i]&&(h[i]=bs[i].bind(bs))});var g=h._destructionListeners=new e7.Map;h.on("destroyed",function(i){g.get(i).forEach(function(j){j()}),g["delete"](i)})}function bV(g){return g.reduce(function(i,h){return i[h]=!0,i},{})}function aU(g){if(!/^\d+\-./.test(g)){return ke(cD)}var i=g.indexOf("-"),h=g.substring(0,i),j=g.substring(i+1);return{prefix:parseInt(h,10),id:j}}function cY(i,l){for(var g=i.start-i.ids.length+1,m=i.ids,j=[m[0],l,[]],k=1,h=m.length;h>k;k++){j=[m[k],{status:"missing"},[j]]}return[{pos:g,ids:j}]}function cx(g,i){var m,k,l,o={status:"available"};if(g._deleted&&(o.deleted=!0),i){if(g._id||(g._id=jY()),k=jY(32,16).toLowerCase(),g._rev){if(l=aU(g._rev),l.error){return l}g._rev_tree=[{pos:l.prefix,ids:[l.id,{status:"missing"},[[k,o,[]]]]}],m=l.prefix+1}else{g._rev_tree=[{pos:1,ids:[k,o,[]]}],m=1}}else{if(g._revisions&&(g._rev_tree=cY(g._revisions,o),m=g._revisions.start,k=g._revisions.ids[0]),!g._rev_tree){if(l=aU(g._rev),l.error){return l}m=l.prefix,k=l.id,g._rev_tree=[{pos:m,ids:[k,o,[]]}]}}j1(g._id),g._rev=m+"-"+k;var h={metadata:{},data:{}};for(var j in g){if(Object.prototype.hasOwnProperty.call(g,j)){var p="_"===j[0];if(p&&!ck[j]){var n=ke(fO,j);throw n.message=fO.message+": "+j,n}p&&!cS[j]?h.metadata[j.slice(1)]=g[j]:h.data[j]=g[j]}}return h}function dE(k){for(var i="",h=new Uint8Array(k),j=h.byteLength,g=0;j>g;g++){i+=String.fromCharCode(h[g])}return i}function cy(g){return b2(dE(g))}function ki(l,j){l=l||[],j=j||{};try{return new Blob(l,j)}catch(i){if("TypeError"!==i.name){throw i}for(var k="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder,h=new k,g=0;g<l.length;g+=1){h.append(l[g])}return h.getBlob(j.type)}}function jM(k){for(var i=k.length,h=new ArrayBuffer(i),j=new Uint8Array(h),g=0;i>g;g++){j[g]=k.charCodeAt(g)}return h}function dC(h,g){return ki([jM(h)],{type:g})}function aL(h,g){return dC(aM(h),g)}function fH(g,i){if("undefined"==typeof FileReader){return i(dE((new FileReaderSync).readAsArrayBuffer(g)))}var h=new FileReader,j="function"==typeof h.readAsBinaryString;h.onloadend=function(k){var l=k.target.result||"";return j?i(l):void i(dE(l))},j?h.readAsBinaryString(g):h.readAsArrayBuffer(g)}function dR(h,g){fH(h,function(i){g(b2(i))})}function bd(g,i){if("undefined"==typeof FileReader){return i((new FileReaderSync).readAsArrayBuffer(g))}var h=new FileReader;h.onloadend=function(j){var k=j.target.result||new ArrayBuffer(0);i(k)},h.readAsArrayBuffer(g)}function aE(g){return b2(g)}function aV(g,i,h,j){(h>0||j<i.byteLength)&&(i=new Uint8Array(i,h,Math.min(j,i.byteLength)-h)),g.append(i)}function dy(g,i,h,j){(h>0||j<i.length)&&(i=i.substring(h,j)),g.appendBinary(i)}function jN(g,i){function m(){var q=j*o,u=q+o;if(j++,h>j){n(p,g,q,u),df(m)}else{n(p,g,q,u);var r=p.end(!0),s=aE(r);i(s),p.destroy()}}var k="string"==typeof g,l=k?g.length:g.byteLength,o=Math.min(cM,l),h=Math.ceil(l/o),j=0,p=k?new cL:new cL.ArrayBuffer,n=k?dy:aV;m()}function f9(g){return cL.hash(g)}function fP(l,n,i){function g(o){try{return aM(o)}catch(q){var p=ke(eW,"Attachment is not a valid base64 string");return{error:p}}}function h(q,p){if(q.stub){return p()}if("string"==typeof q.data){var o=g(q.data);if(o.error){return p(o.error)}q.length=o.length,"blob"===n?q.data=dC(o,q.content_type):"base64"===n?q.data=b2(o):q.data=o,jN(o,function(r){q.digest="md5-"+r,p()})}else{bd(q.data,function(r){"binary"===n?q.data=dE(r):"base64"===n&&(q.data=cy(r)),jN(r,function(s){q.digest="md5-"+s,q.length=r.byteLength,p()})})}}function m(){j++,l.length===j&&(k?i(k):i())}if(!l.length){return i()}var k,j=0;l.forEach(function(r){function p(u){k=u,q++,q===s.length&&m()}var s=r.data&&r.data._attachments?Object.keys(r.data._attachments):[],q=0;if(!s.length){return m()}for(var o in r.data._attachments){r.data._attachments.hasOwnProperty(o)&&h(r.data._attachments[o],p)}})}function bh(z,v,j,A,i,q,u,x){if(ch(v.rev_tree,j.metadata.rev)){return A[i]=j,q()}var h=v.winningRev||cI(v),m="deleted" in v?v.deleted:dH(v,h),y="deleted" in j.metadata?j.metadata.deleted:dH(j.metadata),n=/^1-/.test(j.metadata.rev);if(m&&!y&&x&&n){var B=j.data;B._rev=h,B._id=j.metadata.id,j=cx(B,x)}var s=j0(v.rev_tree,j.metadata.rev_tree[0],z),g=x&&(m&&y||!m&&"new_leaf"!==s.conflicts||m&&!y&&"new_branch"===s.conflicts);if(g){var o=ke(ba);return A[i]=o,q()}var p=j.metadata.rev;j.metadata.rev_tree=s.tree,j.stemmedRevs=s.stemmedRevs||[],v.rev_map&&(j.metadata.rev_map=v.rev_map);var l,k=cI(j.metadata),w=dH(j.metadata,k),r=m===w?0:w>m?-1:1;l=p===k?w:dH(j.metadata,p),u(j,k,w,l,!0,r,i,q)}function jF(g){return"missing"===g.metadata.rev_tree[0].ids[1].status}function aB(p,i,g,r,v,m,h,l,j){function u(x,C,B){var z=cI(x.metadata),w=dH(x.metadata,z);if("was_delete" in l&&w){return m[C]=ke(aa,"deleted"),B()}var D=k&&jF(x);if(D){var y=ke(ba);return m[C]=y,B()}var A=w?0:1;h(x,z,w,w,!1,A,C,B)}function o(){++n===s&&j&&j()}p=p||1000;var k=l.new_edits,q=new e7.Map,n=0,s=i.length;i.forEach(function(y,w){if(y._id&&dg(y._id)){var x=y._deleted?"_removeLocal":"_putLocal";return void g[x](y,{ctx:v},function(B,A){m[w]=B||A,o()})}var z=y.metadata.id;q.has(z)?(s--,q.get(z).push([y,w])):q.set(z,[[y,w]])}),q.forEach(function(x,z){function y(){++w<x.length?A():o()}function A(){var C=x[w],E=C[0],D=C[1];if(r.has(z)){bh(p,r.get(z),E,m,D,y,h,k)}else{var B=j0([],E.metadata.rev_tree[0],p);E.metadata.rev_tree=B.tree,E.stemmedRevs=B.stemmedRevs||[],u(E,D,y)}}var w=0;A()})}function em(h){try{return JSON.parse(h)}catch(g){return eQ.parse(h)}}function eM(g){return g.length<50000?JSON.parse(g):em(g)}function ed(h){try{return JSON.stringify(h)}catch(g){return eQ.stringify(h)}}function e(k,i,h,j){try{k.apply(i,h)}catch(g){j.emit("error",g)}}function bJ(h){if(!eA.running&&eA.queue.length){eA.running=!0;var g=eA.queue.shift();g.action(function(i,j){e(g.callback,this,[i,j],h),eA.running=!1,eR.nextTick(function(){bJ(h)})})}}function bR(g){return function(h){var i="unknown_error";h.target&&h.target.error&&(i=h.target.error.name||h.target.error.message),g(ke(aC,i,h.type))}}function eX(g,i,h){return{data:ed(g),winningRev:i,deletedOrLocal:h?"1":"0",seq:g.seq,id:g.id}}function el(h){if(!h){return null}var g=eM(h.data);return g.winningRev=h.winningRev,g.deleted="1"===h.deletedOrLocal,g.seq=h.seq,g}function fB(h){if(!h){return h}var g=h._doc_id_rev.lastIndexOf(":");return h._id=h._doc_id_rev.substring(0,g-1),h._rev=h._doc_id_rev.substring(g+1),delete h._doc_id_rev,h}function bf(g,i,h,j){h?j(g?"string"!=typeof g?g:aL(g,i):ki([""],{type:i})):g?"string"!=typeof g?fH(g,function(k){j(b2(k))}):j(g):j("")}function bq(l,n,i,g){function h(){++j===k.length&&g&&g()}function m(s,q){var r=s._attachments[q],p=r.digest,o=i.objectStore(cv).get(p);o.onsuccess=function(u){r.body=u.target.result.body,h()}}var k=Object.keys(l._attachments||{});if(!k.length){return g&&g()}var j=0;k.forEach(function(o){n.attachments&&n.include_docs?m(l,o):(l._attachments[o].stub=!0,h())})}function e0(h,g){return ca.all(h.map(function(i){if(i.doc&&i.doc._attachments){var j=Object.keys(i.doc._attachments);return ca.all(j.map(function(l){var n=i.doc._attachments[l];if("body" in n){var k=n.body,m=n.content_type;return new ca(function(o){bf(k,m,g,function(p){i.doc._attachments[l]=aI.extend(f5(n,["digest","content_type"]),{data:p}),o()})})}}))}}))}function bM(g,i,m){function k(){n--,n||l()}function l(){o.length&&o.forEach(function(q){var r=p.index("digestSeq").count(IDBKeyRange.bound(q+"::",q+"::￿",!1,!1));r.onsuccess=function(s){var u=s.target.result;u||j["delete"](q)}})}var o=[],h=m.objectStore(jX),j=m.objectStore(cv),p=m.objectStore(cZ),n=g.length;g.forEach(function(s){var r=h.index("_doc_id_rev"),q=i+"::"+s;r.getKey(q).onsuccess=function(u){var w=u.target.result;if("number"!=typeof w){return k()}h["delete"](w);var v=p.index("seq").openCursor(IDBKeyRange.only(w));v.onsuccess=function(x){var z=x.target.result;if(z){var y=z.value.digestSeq.split("::")[0];o.push(y),p["delete"](z.primaryKey),z["continue"]()}else{k()}}}})}function ep(g,i,h){try{return{txn:g.transaction(i,h)}}catch(j){return{error:j}}}function bj(p,n,N,D,M,A,G){function r(){var P=[cc,jX,cv,az,cZ],O=ep(M,P,"readwrite");return O.error?G(O.error):(u=O.txn,u.onabort=bR(G),u.ontimeout=bR(G),u.oncomplete=E,I=u.objectStore(cc),k=u.objectStore(jX),s=u.objectStore(cv),B=u.objectStore(cZ),void g(function(Q){return Q?(L=!0,G(Q)):void h()}))}function C(){aB(p.revs_limit,q,D,z,u,w,v,N)}function h(){function R(){++T===q.length&&C()}function P(W){var V=el(W.target.result);V&&z.set(V.id,V),R()}if(q.length){for(var T=0,Q=0,S=q.length;S>Q;Q++){var O=q[Q];if(O._id&&dg(O._id)){R()}else{var U=I.get(O.metadata.id);U.onsuccess=P}}}}function E(){L||(A.notify(D._meta.name),D._meta.docCount+=H,G(null,w))}function o(P,O){var Q=s.get(P);Q.onsuccess=function(S){if(S.target.result){O()}else{var R=ke(cu,"unknown stub attachment with digest "+P);R.status=412,O(R)}}}function g(Q){function O(){++R===S.length&&Q(P)}var S=[];if(q.forEach(function(T){T.data&&T.data._attachments&&Object.keys(T.data._attachments).forEach(function(V){var U=T.data._attachments[V];U.stub&&S.push(U.digest)})}),!S.length){return Q()}var P,R=0;S.forEach(function(T){o(T,function(U){U&&!P&&(P=U),O()})})}function v(U,O,S,Q,R,T,W,P){H+=T,U.metadata.winningRev=O,U.metadata.deleted=S;var X=U.data;X._id=U.metadata.id,X._rev=U.metadata.rev,Q&&(X._deleted=!0);var V=X._attachments&&Object.keys(X._attachments).length;return V?j(U,O,S,R,W,P):void K(U,O,S,R,W,P)}function K(X,Q,S,R,U,O){function W(ai){var ao=X.stemmedRevs||[];R&&D.auto_compaction&&(ao=ao.concat(dZ(X.metadata))),ao&&ao.length&&bM(ao,X.metadata.id,u),T.seq=ai.target.result,delete T.rev;var an=eX(T,Q,S),ae=I.put(an);ae.onsuccess=Z}function P(an){an.preventDefault(),an.stopPropagation();var ai=k.index("_doc_id_rev"),ae=ai.getKey(V._doc_id_rev);ae.onsuccess=function(ar){var ao=k.put(V,ar.target.result);ao.onsuccess=W}}function Z(){w[U]={ok:!0,id:T.id,rev:Q},z.set(X.metadata.id,X.metadata),l(X,T.seq,O)}var V=X.data,T=X.metadata;V._doc_id_rev=T.id+"::"+T.rev,delete V._id,delete V._rev;var Y=k.put(V);Y.onsuccess=W,Y.onerror=P}function j(W,P,T,R,S,U){function Y(){X===V.length&&K(W,P,T,R,S,U)}function Q(){X++,Y()}var O=W.data,X=0,V=Object.keys(O._attachments);V.forEach(function(ae){var ai=W.data._attachments[ae];if(ai.stub){X++,Y()}else{var Z=ai.data;delete ai.data,ai.revpos=parseInt(P,10);var an=ai.digest;m(an,Z,Q)}})}function l(R,O,T){function Q(){++V===U.length&&T()}function S(X){var W=R.data._attachments[X].digest,Y=B.put({seq:O,digestSeq:W+"::"+O});Y.onsuccess=Q,Y.onerror=function(Z){Z.preventDefault(),Z.stopPropagation(),Q()}}var V=0,U=Object.keys(R.data._attachments||{});if(!U.length){return T()}for(var P=0;P<U.length;P++){S(U[P])}}function m(Q,O,R){var P=s.count(Q);P.onsuccess=function(V){var S=V.target.result;if(S){return R()}var U={digest:Q,body:O},T=s.put(U);T.onsuccess=R}}for(var u,I,k,s,B,x,q=n.docs,H=0,J=0,y=q.length;y>J;J++){var F=q[J];F._id&&dg(F._id)||(F=q[J]=cx(F,N.new_edits),F.error&&!x&&(x=F))}if(x){return G(x)}var w=new Array(q.length),z=new e7.Map,L=!1,i=D._meta.blobSupport?"blob":"base64";fP(q,i,function(O){return O?G(O):void r()})}function jO(l,j,i,k,h){try{if(l&&j){return h?IDBKeyRange.bound(j,l,!i,!1):IDBKeyRange.bound(l,j,!1,!i)}if(l){return h?IDBKeyRange.upperBound(l):IDBKeyRange.lowerBound(l)}if(j){return h?IDBKeyRange.lowerBound(j,!i):IDBKeyRange.upperBound(j,!i)}if(k){return IDBKeyRange.only(k)}}catch(g){return{error:g}}return null}function ab(g,i,h,j){return"DataError"===h.name&&0===h.code?j(null,{total_rows:g._meta.docCount,offset:i.skip,rows:[]}):void j(ke(aC,h.name,h.message))}function dp(l,j,i,k){function h(q,H){function D(N,M,O){var L=N.id+"::"+O;p.get(L).onsuccess=function(P){M.doc=fB(P.target.result),q.conflicts&&(M.doc._conflicts=af(N)),bq(M.doc,q,z)}}function v(M,O,N){var L={id:N.id,key:N.id,value:{rev:O}},P=N.deleted;if("ok"===q.deleted){B.push(L),P?(L.value.deleted=!0,L.doc=null):q.include_docs&&D(N,L,O)}else{if(!P&&x--<=0&&(B.push(L),q.include_docs&&D(N,L,O),0===--F)){return}}M["continue"]()}function I(O){K=j._meta.docCount;var M=O.target.result;if(M){var N=el(M.value),L=N.winningRev;v(M,L,N)}}function C(){H(null,{total_rows:K,offset:q.skip,rows:B})}function m(){q.attachments?e0(B,q.binary).then(C):C()}var E="startkey" in q?q.startkey:!1,n="endkey" in q?q.endkey:!1,s="key" in q?q.key:!1,x=q.skip||0,F="number"==typeof q.limit?q.limit:-1,u=q.inclusive_end!==!1,y="descending" in q&&q.descending?"prev":null,A=jO(E,n,u,s,y);if(A&&A.error){return ab(j,q,A.error,H)}var J=[cc,jX];q.attachments&&J.push(cv);var o=ep(i,J,"readonly");if(o.error){return H(o.error)}var z=o.txn,G=z.objectStore(cc),w=z.objectStore(jX),r=y?G.openCursor(A,y):G.openCursor(A),p=w.index("_doc_id_rev"),B=[],K=0;z.oncomplete=m,r.onsuccess=I}function g(m,n){return 0===m.limit?n(null,{total_rows:j._meta.docCount,offset:m.skip,rows:[]}):void h(m,n)}g(l,k)}function eh(g){return new ca(function(h){var i=ki([""]);g.objectStore(aS).put(i,"key"),g.onabort=function(j){j.preventDefault(),j.stopPropagation(),h(!1)},g.oncomplete=function(){var j=navigator.userAgent.match(/Chrome\/(\d+)/),k=navigator.userAgent.match(/Edge\//);h(k||!j||parseInt(j[1],10)>=43)}})["catch"](function(){return !1})}function eG(g,i){var h=this;eA.queue.push({action:function(j){aH(h,g,j)},callback:i}),bJ(h.constructor)}function aH(i,j,n){function p(x){var w=x.createObjectStore(cc,{keyPath:"id"});x.createObjectStore(jX,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),x.createObjectStore(cv,{keyPath:"digest"}),x.createObjectStore(eU,{keyPath:"id",autoIncrement:!1}),x.createObjectStore(aS),w.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),x.createObjectStore(az,{keyPath:"_id"});var v=x.createObjectStore(cZ,{autoIncrement:!0});v.createIndex("seq","seq"),v.createIndex("digestSeq","digestSeq",{unique:!0})}function q(x,w){var v=x.objectStore(cc);v.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),v.openCursor().onsuccess=function(z){var B=z.target.result;if(B){var y=B.value,A=dH(y);y.deletedOrLocal=A?"1":"0",v.put(y),B["continue"]()}else{w()}}}function m(v){v.createObjectStore(az,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}function h(w,y){var x=w.objectStore(az),z=w.objectStore(cc),A=w.objectStore(jX),v=z.openCursor();v.onsuccess=function(J){var G=J.target.result;if(G){var M=G.value,D=M.id,C=dg(D),L=cI(M);if(C){var I=D+"::"+L,F=D+"::",K=D+"::~",H=A.index("_doc_id_rev"),E=IDBKeyRange.bound(F,K,!1,!1),B=H.openCursor(E);B.onsuccess=function(N){if(B=N.target.result){var O=B.value;O._doc_id_rev===I&&x.put(O),A["delete"](B.primaryKey),B["continue"]()}else{z["delete"](G.primaryKey),G["continue"]()}}}else{G["continue"]()}}else{y&&y()}}}function s(w){var v=w.createObjectStore(cZ,{autoIncrement:!0});v.createIndex("seq","seq"),v.createIndex("digestSeq","digestSeq",{unique:!0})}function u(w,y){var x=w.objectStore(jX),z=w.objectStore(cv),A=w.objectStore(cZ),v=z.count();v.onsuccess=function(B){var C=B.target.result;return C?void (x.openCursor().onsuccess=function(D){var J=D.target.result;if(!J){return y()}for(var I=J.value,L=J.primaryKey,F=Object.keys(I._attachments||{}),H={},G=0;G<F.length;G++){var E=I._attachments[F[G]];H[E.digest]=!0}var M=Object.keys(H);for(G=0;G<M.length;G++){var K=M[G];A.put({seq:L,digestSeq:K+"::"+L})}J["continue"]()}):y()}}function k(x){function y(A){return A.data?el(A):(A.deleted="1"===A.deletedOrLocal,A)}var w=x.objectStore(jX),v=x.objectStore(cc),z=v.openCursor();z.onsuccess=function(C){function D(){var H=B.id+"::",F=B.id+"::￿",G=w.index("_doc_id_rev").openCursor(IDBKeyRange.bound(H,F)),I=0;G.onsuccess=function(K){var J=K.target.result;if(!J){return B.seq=I,A()}var L=J.primaryKey;L>I&&(I=L),J["continue"]()}}function A(){var G=eX(B,B.winningRev,B.deleted),F=v.put(G);F.onsuccess=function(){E["continue"]()}}var E=C.target.result;if(E){var B=y(E.value);return B.winningRev=B.winningRev||cI(B),B.seq?A():void D()}}}var r=j.name,o=null;i._meta=null,i.type=function(){return"idb"},i._id=fE(function(v){v(null,i._meta.instanceId)}),i._bulkDocs=function(v,w,x){bj(j,v,w,i,o,cX,x)},i._get=function(D,y,x){function B(){x(v,{doc:C,metadata:A,ctx:z})}var C,A,v,z=y.ctx;if(!z){var w=ep(o,[cc,jX,cv],"readonly");if(w.error){return x(w.error)}z=w.txn}z.objectStore(cc).get(D).onsuccess=function(E){if(A=el(E.target.result),!A){return v=ke(aa,"missing"),B()}if(dH(A)&&!y.rev){return v=ke(aa,"deleted"),B()}var G=z.objectStore(jX),H=y.rev||A.winningRev,F=A.id+"::"+H;G.index("_doc_id_rev").get(F).onsuccess=function(I){return C=I.target.result,C&&(C=fB(C)),C?void B():(v=ke(aa,"missing"),B())}}},i._getAttachment=function(D,y,x,B,C){var A;if(B.ctx){A=B.ctx}else{var v=ep(o,[cc,jX,cv],"readonly");if(v.error){return C(v.error)}A=v.txn}var z=x.digest,w=x.content_type;A.objectStore(cv).get(z).onsuccess=function(E){var F=E.target.result.body;bf(F,w,B.binary,function(G){C(null,G)})}},i._info=function(A){if(null===o||!bL.has(r)){var y=new Error("db isn't open");return y.id="idbNull",A(y)}var B,z,x=ep(o,[jX],"readonly");if(x.error){return A(x.error)}var w=x.txn,v=w.objectStore(jX).openCursor(null,"prev");v.onsuccess=function(D){var C=D.target.result;B=C?C.key:0,z=i._meta.docCount},w.oncomplete=function(){A(null,{doc_count:z,update_seq:B,idb_attachment_format:i._meta.blobSupport?"binary":"base64"})}},i._allDocs=function(v,w){dp(v,i,o,w)},i._changes=function(z){function y(N){function T(){return S.seq!==O?N["continue"]():(v=O,S.winningRev===P._rev?R(P):void Q())}function Q(){var U=P._id+"::"+S.winningRev,V=J.get(U);V.onsuccess=function(W){R(fB(W.target.result))}}function R(V){var W=z.processChange(V,S,z);W.seq=S.seq;var U=A(W);return"object"==typeof U?z.complete(U):(U&&(L++,F&&D.push(W),z.attachments&&z.include_docs?bq(V,z,w,function(){e0([W],z.binary).then(function(){z.onChange(W)})}):z.onChange(W)),void (L!==x&&N["continue"]()))}var P=fB(N.value),O=N.key;if(C&&!C.has(P._id)){return N["continue"]()}var S;return(S=K.get(P._id))?T():void (G.get(P._id).onsuccess=function(U){S=el(U.target.result),K.set(P._id,S),T()})}function I(N){var O=N.target.result;O&&y(O)}function M(){var P=[cc,jX];z.attachments&&P.push(cv);var O=ep(o,P,"readonly");if(O.error){return z.complete(O.error)}w=O.txn,w.onabort=bR(z.complete),w.oncomplete=H,B=w.objectStore(jX),G=w.objectStore(cc),J=B.index("_doc_id_rev");var N;N=z.descending?B.openCursor(null,"prev"):B.openCursor(IDBKeyRange.lowerBound(z.since,!0)),N.onsuccess=I}function H(){function N(){z.complete(null,{results:D,last_seq:v})}!z.continuous&&z.attachments?e0(D).then(N):N()}if(z=d8(z),z.continuous){var E=r+":"+jY();return cX.addListener(r,E,i,z),cX.notify(r),{cancel:function(){cX.removeListener(r,E)}}}var C=z.doc_ids&&new e7.Set(z.doc_ids);z.since=z.since||0;var v=z.since,x="limit" in z?z.limit:-1;0===x&&(x=1);var F;F="return_docs" in z?z.return_docs:"returnDocs" in z?z.returnDocs:!0;var w,B,G,J,D=[],L=0,A=f1(z),K=new e7.Map;M()},i._close=function(v){return null===o?v(ke(dF)):(o.close(),bL["delete"](r),o=null,void v())},i._getRevisionTree=function(x,y){var w=ep(o,[cc],"readonly");if(w.error){return y(w.error)}var v=w.txn,z=v.objectStore(cc).get(x);z.onsuccess=function(B){var A=el(B.target.result);A?y(null,A.rev_tree):y(ke(aa))}},i._doCompaction=function(y,v,z){var A=[cc,jX,cv,cZ],B=ep(o,A,"readwrite");if(B.error){return z(B.error)}var x=B.txn,w=x.objectStore(cc);w.get(y).onsuccess=function(E){var C=el(E.target.result);fQ(C.rev_tree,function(L,H,K,G,J){var I=H+"-"+K;-1!==v.indexOf(I)&&(J.status="missing")}),bM(v,y,x);var D=C.winningRev,F=C.deleted;x.objectStore(cc).put(eX(C,D,F))},x.onabort=bR(z),x.oncomplete=function(){z()}},i._getLocal=function(x,y){var w=ep(o,[az],"readonly");if(w.error){return y(w.error)}var v=w.txn,z=v.objectStore(az).get(x);z.onerror=bR(y),z.onsuccess=function(B){var A=B.target.result;A?(delete A._doc_id_rev,y(null,A)):y(ke(aa))}},i._putLocal=function(E,z,x){"function"==typeof z&&(x=z,z={}),delete E._revisions;var C=E._rev,D=E._id;C?E._rev="0-"+(parseInt(C.split("-")[1],10)+1):E._rev="0-1";var B,w=z.ctx;if(!w){var A=ep(o,[az],"readwrite");if(A.error){return x(A.error)}w=A.txn,w.onerror=bR(x),w.oncomplete=function(){B&&x(null,B)}}var y,v=w.objectStore(az);C?(y=v.get(D),y.onsuccess=function(H){var G=H.target.result;if(G&&G._rev===C){var F=v.put(E);F.onsuccess=function(){B={ok:!0,id:E._id,rev:E._rev},z.ctx&&x(null,B)}}else{x(ke(ba))}}):(y=v.add(E),y.onerror=function(F){x(ke(ba)),F.preventDefault(),F.stopPropagation()},y.onsuccess=function(){B={ok:!0,id:E._id,rev:E._rev},z.ctx&&x(null,B)})},i._removeLocal=function(D,y,x){"function"==typeof y&&(x=y,y={});var B=y.ctx;if(!B){var C=ep(o,[az],"readwrite");if(C.error){return x(C.error)}B=C.txn,B.oncomplete=function(){A&&x(null,A)}}var A,v=D._id,z=B.objectStore(az),w=z.get(v);w.onerror=bR(x),w.onsuccess=function(F){var E=F.target.result;E&&E._rev===D._rev?(z["delete"](v),A={ok:!0,id:v,rev:"0-0"},y.ctx&&x(null,A)):x(ke(aa))}},i._destroy=function(w,y){cX.removeAllListeners(r);var x=dW.get(r);x&&x.result&&(x.result.close(),bL["delete"](r));var v=indexedDB.deleteDatabase(r);v.onsuccess=function(){dW["delete"](r),eE()&&r in localStorage&&delete localStorage[r],y(null,{ok:!0})},v.onerror=bR(y)};var g=bL.get(r);if(g){return o=g.idb,i._meta=g.global,void eR.nextTick(function(){n(null,i)})}var l;l=j.storage?bC(r,j.storage):indexedDB.open(r,dG),dW.set(r,l),l.onupgradeneeded=function(y){function w(){var B=A[v-1];v++,B&&B(x,w)}var z=y.target.result;if(y.oldVersion<1){return p(z)}var x=y.currentTarget.transaction;y.oldVersion<3&&m(z),y.oldVersion<4&&s(z);var A=[q,h,u,k],v=y.oldVersion;w()},l.onsuccess=function(z){o=z.target.result,o.onversionchange=function(){o.close(),bL["delete"](r)},o.onabort=function(B){fJ("error","Database has a global failure",B.target.error),o.close(),bL["delete"](r)};var x=o.transaction([eU,aS,cc],"readwrite"),A=x.objectStore(eU).get(eU),y=null,v=null,w=null;A.onsuccess=function(D){var B=function(){null!==y&&null!==v&&null!==w&&(i._meta={name:r,instanceId:w,blobSupport:y,docCount:v},bL.set(r,{idb:o,global:i._meta}),n(null,i))},E=D.target.result||{id:eU};r+"_id" in E?(w=E[r+"_id"],B()):(w=jY(),E[r+"_id"]=w,x.objectStore(eU).put(E).onsuccess=function(){B()}),dm||(dm=eh(x)),dm.then(function(F){y=F,B()});var C=x.objectStore(cc).index("deletedOrLocal");C.count(IDBKeyRange.only("0")).onsuccess=function(F){v=F.target.result,B()}}},l.onerror=function(){var v="Failed to open indexedDB, are you in private browsing mode?";fJ("error",v),n(ke(aC,v))}}function bC(g,i){try{return indexedDB.open(g,{version:dG,storage:i})}catch(h){return indexedDB.open(g,dG)}}function jP(g){g.adapter("idb",eG,!0)}function bH(g){return decodeURIComponent(escape(g))}function bc(g){return 65>g?g-48:g-55}function cH(g,i,h){for(var j="";h>i;){j+=String.fromCharCode(bc(g.charCodeAt(i++))<<4|bc(g.charCodeAt(i++)))}return j}function dQ(g,i,h){for(var j="";h>i;){j+=String.fromCharCode(bc(g.charCodeAt(i+2))<<12|bc(g.charCodeAt(i+3))<<8|bc(g.charCodeAt(i))<<4|bc(g.charCodeAt(i+1))),i+=4}return j}function jJ(h,g){return"UTF-8"===g?bH(cH(h,0,h.length)):dQ(h,0,h.length)}function cg(g){return"'"+g+"'"}function dj(g){return g.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"")}function b4(g){return g.replace(/\u0001\u0001/g,"\x00").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,"")}function b0(g){return delete g._id,delete g._rev,JSON.stringify(g)}function d7(g,i,h){return g=JSON.parse(g),g._id=i,g._rev=h,g}function a8(h){for(var g="(";h--;){g+="?",h&&(g+=",")}return g+")"}function cU(k,i,h,j,g){return"SELECT "+k+" FROM "+("string"==typeof i?i:i.join(" JOIN "))+(h?" ON "+h:"")+(j?" WHERE "+("string"==typeof j?j:j.join(" AND ")):"")+(g?" ORDER BY "+g:"")}function jG(i,l,g){function m(){++k===i.length&&j()}function j(){if(h.length){var n="SELECT DISTINCT digest AS digest FROM "+cK+" WHERE seq IN "+a8(h.length);g.executeSql(n,h,function(q,o){for(var s=[],p=0;p<o.rows.length;p++){s.push(o.rows.item(p).digest)}if(s.length){var r="DELETE FROM "+cK+" WHERE seq IN ("+h.map(function(){return"?"}).join(",")+")";q.executeSql(r,h,function(v){var u="SELECT digest FROM "+cK+" WHERE digest IN ("+s.map(function(){return"?"}).join(",")+")";v.executeSql(u,s,function(z,w){for(var y=new e7.Set,x=0;x<w.rows.length;x++){y.add(w.rows.item(x).digest)}s.forEach(function(A){y.has(A)||(z.executeSql("DELETE FROM "+cK+" WHERE digest=?",[A]),z.executeSql("DELETE FROM "+aj+" WHERE digest=?",[A]))})})})}})}}if(i.length){var k=0,h=[];i.forEach(function(o){var n="SELECT seq FROM "+aW+" WHERE doc_id=? AND rev=?";g.executeSql(n,[l,o],function(q,p){if(!p.rows.length){return m()}var r=p.rows.item(0).seq;h.push(r),q.executeSql("DELETE FROM "+aW+" WHERE seq=?",[r],m)})})}}function aO(g){return function(h){fJ("error","WebSQL threw an error",h);var k=h&&h.constructor.toString().match(/function ([^\(]+)/),i=k&&k[1]||h.type,j=h.target||h.message;g(ke(eN,j,i))}}function ax(h){if("size" in h){return 1000000*h.size}var g="undefined"!=typeof navigator&&/Android/.test(navigator.userAgent);return g?5000000:1}function bx(C,A,k,g,i,v,w){function n(){return z?w(z):(v.notify(g._name),g._docCount=-1,void w(null,u))}function x(E,D){var F="SELECT count(*) as cnt FROM "+aj+" WHERE digest=?";l.executeSql(F,[E],function(G,H){if(0===H.rows.item(0).cnt){var I=ke(cu,"unknown stub attachment with digest "+E);D(I)}else{D()}})}function q(F){function D(){++G===H.length&&F(E)}var H=[];if(o.forEach(function(I){I.data&&I.data._attachments&&Object.keys(I.data._attachments).forEach(function(J){var K=I.data._attachments[J];K.stub&&H.push(K.digest)})}),!H.length){return F()}var E,G=0;H.forEach(function(I){x(I,function(J){J&&!E&&(E=J),D()})})}function B(I,Q,L,G,E,N,D,P){function K(){function W(ai,ar){function at(){return ++a0===ae.length&&ar(),!1}function an(a3){var a1="INSERT INTO "+cK+" (digest, seq) VALUES (?,?)",a2=[V._attachments[a3].digest,ai];l.executeSql(a1,a2,at,at)}var a0=0,ae=Object.keys(V._attachments||{});if(!ae.length){return ar()}for(var ao=0;ao<ae.length;ao++){an(ae[ao])}}var V=I.data,Y=G?1:0,T=V._id,X=V._rev,Z=b0(V),S="INSERT INTO "+aW+" (doc_id, rev, json, deleted) VALUES (?, ?, ?, ?);",U=[T,X,Z,Y];l.executeSql(S,U,function(ae,an){var ai=an.insertId;W(ai,function(){J(ae,ai)})},function(){var ae=cU("seq",aW,null,"doc_id=? AND rev=?");return l.executeSql(ae,[T,X],function(ao,ar){var at=ar.rows.item(0).seq,an="UPDATE "+aW+" SET json=?, deleted=? WHERE doc_id=? AND rev=?;",ai=[Z,Y,T,X];ao.executeSql(an,ai,function(a0){W(at,function(){J(a0,at)})})}),!1})}function H(S){F||(S?(F=S,P(F)):O===M.length&&K())}function R(S){O++,H(S)}function J(X,W){var S=I.metadata.id,Y=I.stemmedRevs||[];E&&g.auto_compaction&&(Y=dZ(I.metadata).concat(Y)),Y.length&&jG(Y,S,X),I.metadata.seq=W,delete I.metadata.rev;var T=E?"UPDATE "+c5+" SET json=?, max_seq=?, winningseq=(SELECT seq FROM "+aW+" WHERE doc_id="+c5+".id AND rev=?) WHERE id=?":"INSERT INTO "+c5+" (id, winningseq, max_seq, json) VALUES (?,?,?,?);",U=ed(I.metadata),V=E?[U,W,Q,S]:[S,W,W,U];X.executeSql(T,V,function(){u[D]={ok:!0,id:I.metadata.id,rev:Q},r.set(S,I.metadata),P()})}var F=null,O=0;I.data._id=I.metadata.id,I.data._rev=I.metadata.rev;var M=Object.keys(I.data._attachments||{});G&&(I.data._deleted=!0),M.forEach(function(U){var S=I.data._attachments[U];if(S.stub){O++,H()}else{var T=S.data;delete S.data,S.revpos=parseInt(Q,10);var V=S.digest;y(V,T,R)}}),M.length||K()}function s(){aB(C.revs_limit,o,g,r,l,u,B,k)}function m(E){function D(){++F===o.length&&E()}if(!o.length){return E()}var F=0;o.forEach(function(G){if(G._id&&dg(G._id)){return D()}var H=G.metadata.id;l.executeSql("SELECT json FROM "+c5+" WHERE id = ?",[H],function(I,K){if(K.rows.length){var J=eM(K.rows.item(0).json);r.set(H,J)}D()})})}function y(F,D,G){var E="SELECT digest FROM "+aj+" WHERE digest=?";l.executeSql(E,[F],function(H,I){return I.rows.length?G():(E="INSERT INTO "+aj+" (digest, body, escaped) VALUES (?,?,1)",void H.executeSql(E,[F,dj(D)],function(){G()},function(){return G(),!1}))})}var h=k.new_edits,p=A.docs,o=p.map(function(E){if(E._id&&dg(E._id)){return E}var D=cx(E,h);return D}),j=o.filter(function(D){return D.error});if(j.length){return w(j[0])}var l,z,u=new Array(o.length),r=new e7.Map;fP(o,"binary",function(D){return D?w(D):void i.transaction(function(E){l=E,q(function(F){F?z=F:m(s)})},aO(w),n)})}function f4(g){return g.websql(g.name,g.version,g.description,g.size)}function a9(h){try{return{db:f4(h)}}catch(g){return{error:g}}}function cw(h){var g=j4.get(h.name);return g||(g=a9(h),j4.set(h.name,g),g.db&&(g.db._sqlitePlugin="undefined"!=typeof sqlitePlugin)),g}function dM(o,g,l,j,k){function m(){++h===i.length&&k&&k()}function n(q,s){var r=q._attachments[s],p={binary:g.binary,ctx:j};l._getAttachment(q._id,s,r,p,function(u,v){q._attachments[s]=aI.extend(f5(r,["digest","content_type"]),{data:v}),m()})}var i=Object.keys(o._attachments||{});if(!i.length){return k&&k()}var h=0;i.forEach(function(p){g.attachments&&g.include_docs?n(o,p):(o._attachments[p].stub=!0,m())})}function j2(r,o){function y(){eE()&&(window.localStorage["_pouch__websqldb_"+D._name]=!0),o(null,D)}function g(F,E){F.executeSql(kb),F.executeSql("ALTER TABLE "+aW+" ADD COLUMN deleted TINYINT(1) DEFAULT 0",[],function(){F.executeSql(cR),F.executeSql("ALTER TABLE "+c5+" ADD COLUMN local TINYINT(1) DEFAULT 0",[],function(){F.executeSql("CREATE INDEX IF NOT EXISTS 'doc-store-local-idx' ON "+c5+" (local, id)");var G="SELECT "+c5+".winningseq AS seq, "+c5+".json AS metadata FROM "+aW+" JOIN "+c5+" ON "+aW+".seq = "+c5+".winningseq";F.executeSql(G,[],function(O,K){for(var N=[],I=[],J=0;J<K.rows.length;J++){var L=K.rows.item(J),M=L.seq,H=JSON.parse(L.metadata);dH(H)&&N.push(M),dg(H.id)&&I.push(H.id)}O.executeSql("UPDATE "+c5+"SET local = 1 WHERE id IN "+a8(I.length),I,function(){O.executeSql("UPDATE "+aW+" SET deleted = 1 WHERE seq IN "+a8(N.length),N,E)})})})})}function p(F,E){var G="CREATE TABLE IF NOT EXISTS "+bg+" (id UNIQUE, rev, json)";F.executeSql(G,[],function(){var H="SELECT "+c5+".id AS id, "+aW+".json AS data FROM "+aW+" JOIN "+c5+" ON "+aW+".seq = "+c5+".winningseq WHERE local = 1";F.executeSql(H,[],function(I,K){function M(){if(!J.length){return E(I)}var O=J.shift(),N=JSON.parse(O.data)._rev;I.executeSql("INSERT INTO "+bg+" (id, rev, json) VALUES (?,?,?)",[O.id,N,O.data],function(P){P.executeSql("DELETE FROM "+c5+" WHERE id=?",[O.id],function(Q){Q.executeSql("DELETE FROM "+aW+" WHERE seq=?",[O.seq],function(){M()})})})}for(var J=[],L=0;L<K.rows.length;L++){J.push(K.rows.item(L))}M()})})}function B(G,E){function H(J){function I(){if(!J.length){return E(G)}var N=J.shift(),L=jJ(N.hex,i),O=L.lastIndexOf("::"),M=L.substring(0,O),K=L.substring(O+2),P="UPDATE "+aW+" SET doc_id=?, rev=? WHERE doc_id_rev=?";G.executeSql(P,[M,K,L],function(){I()})}I()}var F="ALTER TABLE "+aW+" ADD COLUMN doc_id";G.executeSql(F,[],function(J){var I="ALTER TABLE "+aW+" ADD COLUMN rev";J.executeSql(I,[],function(K){K.executeSql(bN,[],function(L){var M="SELECT hex(doc_id_rev) as hex FROM "+aW;L.executeSql(M,[],function(P,N){for(var O=[],Q=0;Q<N.rows.length;Q++){O.push(N.rows.item(Q))}H(O)})})})})}function x(G,E){function H(I){var J="SELECT COUNT(*) AS cnt FROM "+aj;I.executeSql(J,[],function(M,O){function L(){var Q=cU(cQ+", "+c5+".id AS id",[c5,aW],cT,null,c5+".id ");Q+=" LIMIT "+P+" OFFSET "+K,K+=P,M.executeSql(Q,[],function(ai,V){function an(at,ar){var ao=X[at]=X[at]||[];-1===ao.indexOf(ar)&&ao.push(ar)}if(!V.rows.length){return E(ai)}for(var X={},S=0;S<V.rows.length;S++){for(var U=V.rows.item(S),T=d7(U.data,U.id,U.rev),Z=Object.keys(T._attachments||{}),ae=0;ae<Z.length;ae++){var W=T._attachments[Z[ae]];an(W.digest,U.seq)}}var R=[];if(Object.keys(X).forEach(function(ar){var ao=X[ar];ao.forEach(function(at){R.push([ar,at])})}),!R.length){return L()}var Y=0;R.forEach(function(ao){var ar="INSERT INTO "+cK+" (digest, seq) VALUES (?,?)";ai.executeSql(ar,ao,function(){++Y===R.length&&L()})})})}var N=O.rows.item(0).cnt;if(!N){return E(M)}var K=0,P=10;L()})}var F="CREATE TABLE IF NOT EXISTS "+cK+" (digest, seq INTEGER)";G.executeSql(F,[],function(I){I.executeSql(bZ,[],function(J){J.executeSql(bB,[],H)})})}function q(F,E){var G="ALTER TABLE "+aj+" ADD COLUMN escaped TINYINT(1) DEFAULT 0";F.executeSql(G,[],E)}function A(F,E){var G="ALTER TABLE "+c5+" ADD COLUMN max_seq INTEGER";F.executeSql(G,[],function(I){var H="UPDATE "+c5+" SET max_seq=(SELECT MAX(seq) FROM "+aW+" WHERE doc_id=id)";I.executeSql(H,[],function(J){var K="CREATE UNIQUE INDEX IF NOT EXISTS 'doc-max-seq-idx' ON "+c5+" (max_seq)";J.executeSql(K,[],E)})})}function l(F,E){F.executeSql('SELECT HEX("a") AS hex',[],function(I,G){var H=G.rows.item(0).hex;i=2===H.length?"UTF-8":"UTF-16",E()})}function s(){for(;n.length>0;){var E=n.pop();E(null,w)}}function C(G,O){if(0===O){var L="CREATE TABLE IF NOT EXISTS "+dB+" (dbid, db_version INTEGER)",I="CREATE TABLE IF NOT EXISTS "+aj+" (digest UNIQUE, escaped TINYINT(1), body BLOB)",F="CREATE TABLE IF NOT EXISTS "+cK+" (digest, seq INTEGER)",P="CREATE TABLE IF NOT EXISTS "+c5+" (id unique, json, winningseq, max_seq INTEGER UNIQUE)",E="CREATE TABLE IF NOT EXISTS "+aW+" (seq INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, json, deleted TINYINT(1), doc_id, rev)",K="CREATE TABLE IF NOT EXISTS "+bg+" (id UNIQUE, rev, json)";G.executeSql(I),G.executeSql(K),G.executeSql(F,[],function(){G.executeSql(bB),G.executeSql(bZ)}),G.executeSql(P,[],function(){G.executeSql(kb),G.executeSql(E,[],function(){G.executeSql(cR),G.executeSql(bN),G.executeSql(L,[],function(){var R="INSERT INTO "+dB+" (db_version, dbid) VALUES (?,?)";w=jY();var Q=[jK,w];G.executeSql(R,Q,function(){s()})})})})}else{var M=function(){var Q=jK>O;Q&&G.executeSql("UPDATE "+dB+" SET db_version = "+jK);var R="SELECT dbid FROM "+dB;G.executeSql(R,[],function(T,S){w=S.rows.item(0).dbid,s()})},J=[g,p,B,x,q,A,M],H=O,N=function(Q){J[H-1](Q,N),H++};N(G)}}function j(){h.transaction(function(E){l(E,function(){v(E)})},aO(o),y)}function v(F){var E="SELECT sql FROM sqlite_master WHERE tbl_name = "+dB;F.executeSql(E,[],function(H,G){G.rows.length?/db_version/.test(G.rows.item(0).sql)?H.executeSql("SELECT db_version FROM "+dB,[],function(I,K){var J=K.rows.item(0).db_version;C(I,J)}):H.executeSql("ALTER TABLE "+dB+" ADD COLUMN db_version INTEGER",[],function(){C(H,1)}):C(H,0)})}function m(F,E){if(-1!==D._docCount){return E(D._docCount)}var G=cU("COUNT("+c5+".id) AS 'num'",[c5,aW],cT,aW+".deleted=0");F.executeSql(G,[],function(I,H){D._docCount=H.rows.item(0).num,E(D._docCount)})}var i,D=this,w=null,u=ax(r),n=[];D._docCount=-1,D._name=r.name;var k=aI.extend({},r,{version:aF,description:r.name,size:u}),z=cw(k);if(z.error){return aO(o)(z.error)}var h=z.db;"function"!=typeof h.readTransaction&&(h.readTransaction=h.transaction),j(),D.type=function(){return"websql"},D._id=fE(function(E){E(null,w)}),D._info=function(E){h.readTransaction(function(F){m(F,function(H){var G="SELECT MAX(seq) AS seq FROM "+aW;F.executeSql(G,[],function(K,I){var J=I.rows.item(0).seq||0;E(null,{doc_count:H,update_seq:J,sqlite_plugin:h._sqlitePlugin,websql_encoding:i})})})},aO(E))},D._bulkDocs=function(E,G,F){bx(r,E,G,D,h,bX,F)},D._get=function(H,I,F){function M(){F(K,{doc:N,metadata:G,ctx:E})}var N,G,K,E=I.ctx;if(!E){return h.readTransaction(function(O){D._get(H,aI.extend({ctx:O},I),F)})}var L,J;I.rev?(L=cU(cQ,[c5,aW],c5+".id="+aW+".doc_id",[aW+".doc_id=?",aW+".rev=?"]),J=[H,I.rev]):(L=cU(cQ,[c5,aW],cT,c5+".id=?"),J=[H]),E.executeSql(L,J,function(O,P){if(!P.rows.length){return K=ke(aa,"missing"),M()}var Q=P.rows.item(0);return G=eM(Q.metadata),Q.deleted&&!I.rev?(K=ke(aa,"deleted"),M()):(N=d7(Q.data,G.id,Q.rev),void M())})},D._allDocs=function(E,O){var P,I=[],K="startkey" in E?E.startkey:!1,F="endkey" in E?E.endkey:!1,M="key" in E?E.key:!1,Q="descending" in E?E.descending:!1,N="limit" in E?E.limit:-1,L="skip" in E?E.skip:0,H=E.inclusive_end!==!1,R=[],J=[];if(M!==!1){J.push(c5+".id = ?"),R.push(M)}else{if(K!==!1||F!==!1){if(K!==!1&&(J.push(c5+".id "+(Q?"<=":">=")+" ?"),R.push(K)),F!==!1){var G=Q?">":"<";H&&(G+="="),J.push(c5+".id "+G+" ?"),R.push(F)}M!==!1&&(J.push(c5+".id = ?"),R.push(M))}}"ok"!==E.deleted&&J.push(aW+".deleted = 0"),h.readTransaction(function(S){m(S,function(U){if(P=U,0!==N){var T=cU(cQ,[c5,aW],cT,J,c5+".id "+(Q?"DESC":"ASC"));T+=" LIMIT "+N+" OFFSET "+L,S.executeSql(T,R,function(Z,an){for(var ai=0,V=an.rows.length;V>ai;ai++){var Y=an.rows.item(ai),ae=eM(Y.metadata),ar=ae.id,X=d7(Y.data,ar,Y.rev),W=X._rev,ao={id:ar,key:ar,value:{rev:W}};if(E.include_docs&&(ao.doc=X,ao.doc._rev=W,E.conflicts&&(ao.doc._conflicts=af(ae)),dM(ao.doc,E,D,Z)),Y.deleted){if("ok"!==E.deleted){continue}ao.value.deleted=!0,ao.doc=null}I.push(ao)}})}})},aO(O),function(){O(null,{total_rows:P,offset:E.skip,rows:I})})},D._changes=function(K){function L(){var S=c5+".json AS metadata, "+c5+".max_seq AS maxSeq, "+aW+".json AS winningDoc, "+aW+".rev AS winningRev ",T=c5+" JOIN "+aW,R=c5+".id="+aW+".doc_id AND "+c5+".winningseq="+aW+".seq",Q=["maxSeq > ?"],O=[K.since];K.doc_ids&&(Q.push(c5+".id IN "+a8(K.doc_ids.length)),O=O.concat(K.doc_ids));var U="maxSeq "+(H?"DESC":"ASC"),N=cU(S,T,R,Q,U),M=f1(K);K.view||K.filter||(N+=" LIMIT "+E);var P=K.since||0;h.readTransaction(function(V){V.executeSql(N,O,function(Y,Z){function X(a0){return function(){K.onChange(a0)}}for(var W=0,ao=Z.rows.length;ao>W;W++){var an=Z.rows.item(W),ai=eM(an.metadata);P=an.maxSeq;var ae=d7(an.winningDoc,ai.id,an.winningRev),at=K.processChange(ae,ai,K);at.seq=an.maxSeq;var ar=M(at);if("object"==typeof ar){return K.complete(ar)}if(ar&&(G++,J&&I.push(at),K.attachments&&K.include_docs?dM(ae,K,D,Y,X(at)):X(at)()),G===E){break}}})},aO(K.complete),function(){K.continuous||K.complete(null,{results:I,last_seq:P})})}if(K=d8(K),K.continuous){var F=D._name+":"+jY();return bX.addListener(D._name,F,D,K),bX.notify(D._name),{cancel:function(){bX.removeListener(D._name,F)}}}var H=K.descending;K.since=K.since&&!H?K.since:0;var E="limit" in K?K.limit:-1;0===E&&(E=1);var J;J="return_docs" in K?K.return_docs:"returnDocs" in K?K.returnDocs:!0;var I=[],G=0;L()},D._close=function(E){E()},D._getAttachment=function(H,I,F,M,N){var G,K=M.ctx,E=F.digest,L=F.content_type,J="SELECT escaped, CASE WHEN escaped = 1 THEN body ELSE HEX(body) END AS body FROM "+aj+" WHERE digest=?";K.executeSql(J,[E],function(P,O){var Q=O.rows.item(0),R=Q.escaped?b4(Q.body):jJ(Q.body,i);G=M.binary?dC(R,L):b2(R),N(null,G)})},D._getRevisionTree=function(F,E){h.readTransaction(function(H){var G="SELECT json AS metadata FROM "+c5+" WHERE id = ?";H.executeSql(G,[F],function(I,J){if(J.rows.length){var K=eM(J.rows.item(0).metadata);E(null,K.rev_tree)}else{E(ke(aa))}})})},D._doCompaction=function(F,E,G){return E.length?void h.transaction(function(H){var I="SELECT json AS metadata FROM "+c5+" WHERE id = ?";H.executeSql(I,[F],function(J,L){var M=eM(L.rows.item(0).metadata);fQ(M.rev_tree,function(O,Q,N,P,S){var R=Q+"-"+N;-1!==E.indexOf(R)&&(S.status="missing")});var K="UPDATE "+c5+" SET json = ? WHERE id = ?";J.executeSql(K,[ed(M),F])}),jG(E,F,H)},aO(G),function(){G()}):G()},D._getLocal=function(F,E){h.readTransaction(function(H){var G="SELECT json, rev FROM "+bg+" WHERE id=?";H.executeSql(G,[F],function(J,L){if(L.rows.length){var I=L.rows.item(0),K=d7(I.json,F,I.rev);E(null,K)}else{E(ke(aa))}})})},D._putLocal=function(I,M,G){function E(N){var P,O;H?(P="UPDATE "+bg+" SET rev=?, json=? WHERE id=? AND rev=?",O=[F,L,K,H]):(P="INSERT INTO "+bg+" (id, rev, json) VALUES (?,?,?)",O=[K,F,L]),N.executeSql(P,O,function(R,Q){Q.rowsAffected?(J={ok:!0,id:K,rev:F},M.ctx&&G(null,J)):G(ke(ba))},function(){return G(ke(ba)),!1})}"function"==typeof M&&(G=M,M={}),delete I._revisions;var F,H=I._rev,K=I._id;F=H?I._rev="0-"+(parseInt(H.split("-")[1],10)+1):I._rev="0-1";var J,L=b0(I);M.ctx?E(M.ctx):h.transaction(E,aO(G),function(){J&&G(null,J)})},D._removeLocal=function(H,F,E){function G(L){var K="DELETE FROM "+bg+" WHERE id=? AND rev=?",J=[H._id,H._rev];L.executeSql(K,J,function(N,M){return M.rowsAffected?(I={ok:!0,id:H._id,rev:"0-0"},void (F.ctx&&E(null,I))):E(ke(aa))})}"function"==typeof F&&(E=F,F={});var I;F.ctx?G(F.ctx):h.transaction(G,aO(E),function(){I&&E(null,I)})},D._destroy=function(F,E){bX.removeAllListeners(D._name),h.transaction(function(H){var G=[c5,aW,aj,dB,bg,cK];G.forEach(function(I){H.executeSql("DROP TABLE IF EXISTS "+I,[])})},aO(E),function(){eE()&&(delete window.localStorage["_pouch__websqldb_"+D._name],delete window.localStorage[D._name]),E(null,{ok:!0})})}}function cm(){try{return openDatabase("_pouch_validate_websql",1,"",1),!0}catch(g){return !1}}function cd(){if("undefined"==typeof indexedDB||null===indexedDB||!/iP(hone|od|ad)/.test(navigator.userAgent)){return !0}var g=eE(),i="_pouch__websqldb_valid_"+navigator.userAgent;if(g&&localStorage[i]){return"1"===localStorage[i]}var h=cm();return g&&(localStorage[i]=h?"1":"0"),h}function kj(){return"undefined"!=typeof SQLitePlugin?!0:"undefined"==typeof openDatabase?!1:cd()}function eO(g){return function(i,l,j,k){if("undefined"!=typeof sqlitePlugin){var h=aI.extend({},g,{name:i,version:l,description:j,size:k});return sqlitePlugin.openDatabase(h)}return openDatabase(i,l,j,k)}}function jH(g,i){var h=eO(g),j=aI.extend({websql:h},g);j2.call(this,j,i)}function fM(g){g.adapter("websql",jH,!0)}function eZ(){for(var g={},i=new ca(function(k,l){g.resolve=k,g.reject=l}),h=new Array(arguments.length),j=0;j<h.length;j++){h[j]=arguments[j]}return g.promise=i,ca.resolve().then(function(){return fetch.apply(null,h)}).then(function(k){g.resolve(k)})["catch"](function(k){g.reject(k)}),g}function cJ(i,l){var g,m,j,k=new Headers,h={method:i.method,credentials:"include",headers:k};return i.json&&(k.set("Accept","application/json"),k.set("Content-Type",i.headers["Content-Type"]||"application/json")),i.body&&i.body instanceof Blob?bd(i.body,function(n){h.body=n}):i.body&&i.processData&&"string"!=typeof i.body?h.body=JSON.stringify(i.body):"body" in i?h.body=i.body:h.body=null,Object.keys(i.headers).forEach(function(n){i.headers.hasOwnProperty(n)&&k.set(n,i.headers[n])}),g=eZ(i.url,h),i.timeout>0&&(m=setTimeout(function(){g.reject(new Error("Load timeout for resource: "+i.url))},i.timeout)),g.promise.then(function(n){return j={statusCode:n.status},i.timeout>0&&clearTimeout(m),j.statusCode>=200&&j.statusCode<300?i.binary?n.blob():n.text():n.json()}).then(function(n){j.statusCode>=200&&j.statusCode<300?l(null,j,n):l(n,j)})["catch"](function(n){l(n,j)}),{abort:g.reject}}function e5(o,g){var l,j,k=!1,m=function(){l.abort()},n=function(){k=!0,l.abort()};l=o.xhr?new o.xhr:new XMLHttpRequest;try{l.open(o.method,o.url)}catch(i){g(i,{statusCode:413})}l.withCredentials="withCredentials" in o?o.withCredentials:!0,"GET"===o.method?delete o.headers["Content-Type"]:o.json&&(o.headers.Accept="application/json",o.headers["Content-Type"]=o.headers["Content-Type"]||"application/json",o.body&&o.processData&&"string"!=typeof o.body&&(o.body=JSON.stringify(o.body))),o.binary&&(l.responseType="arraybuffer"),"body" in o||(o.body=null);for(var h in o.headers){o.headers.hasOwnProperty(h)&&l.setRequestHeader(h,o.headers[h])}return o.timeout>0&&(j=setTimeout(n,o.timeout),l.onprogress=function(){clearTimeout(j),4!==l.readyState&&(j=setTimeout(n,o.timeout))},"undefined"!=typeof l.upload&&(l.upload.onprogress=l.onprogress)),l.onreadystatechange=function(){if(4===l.readyState){var s={statusCode:l.status};if(l.status>=200&&l.status<300){var q;q=o.binary?ki([l.response||""],{type:l.getResponseHeader("Content-Type")}):l.responseText,g(null,s,q)}else{var p={};if(k){p=new Error("ETIMEDOUT"),s.statusCode=400}else{try{p=JSON.parse(l.response)}catch(r){}}g(p,s)}}},o.body&&o.body instanceof Blob?bd(o.body,function(p){l.send(p)}):l.send(o.body),{abort:m}}function bk(){try{return new XMLHttpRequest,!0}catch(g){return !1}}function dd(h,g){return aN||h.xhr?e5(h,g):cJ(h,g)}function au(){return""}function d0(k,i){function h(n,m,o){if(!k.binary&&k.json&&"string"==typeof n){try{n=JSON.parse(n)}catch(l){return o(l)}}Array.isArray(n)&&(n=n.map(function(p){return p.error||p.missing?kg(p):p})),k.binary&&dL(n,m),o(null,n,m)}function j(q,o){var m,p;if(q.code&&q.status){var l=new Error(q.message||q.code);return l.status=q.status,o(l)}if(q.message&&"ETIMEDOUT"===q.message){return o(q)}try{m=JSON.parse(q.responseText),p=kg(m)}catch(n){p=kg(q)}o(p)}k=d8(k);var g={method:"GET",headers:{},json:!0,processData:!0,timeout:10000,cache:!1};return k=aI.extend(g,k),k.json&&(k.binary||(k.headers.Accept="application/json"),k.headers["Content-Type"]=k.headers["Content-Type"]||"application/json"),k.binary&&(k.encoding=null,k.json=!1),k.processData||(k.json=!1),dd(k,function(l,p,n){if(l){return l.status=p?p.statusCode:400,j(l,i)}var q,o=p.headers&&p.headers["content-type"],m=n||au();if(!k.binary&&(k.json||!k.processData)&&"object"!=typeof m&&(/json/.test(o)||/^[\s]*\{/.test(m)&&/\}[\s]*$/.test(m))){try{m=JSON.parse(m.toString())}catch(r){}}p.statusCode>=200&&p.statusCode<300?h(m,p,i):(q=kg(m),q.status=p.statusCode,i(q))})}function e8(g,i){var m=navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",k=-1!==m.indexOf("safari")&&-1===m.indexOf("chrome"),l=-1!==m.indexOf("msie"),o=-1!==m.indexOf("edge"),h=k||(l||o)&&"GET"===g.method,j="cache" in g?g.cache:!0,p=/^blob:/.test(g.url);if(!p&&(h||!j)){var n=-1!==g.url.indexOf("?");g.url+=(n?"&":"?")+"_nonce="+Date.now()}return d0(g,i)}function c3(h){var g=h.doc&&h.doc._attachments;g&&Object.keys(g).forEach(function(i){var j=g[i];j.data=aL(j.data,j.content_type)})}function dY(g){return/^_design/.test(g)?"_design/"+encodeURIComponent(g.slice(8)):/^_local/.test(g)?"_local/"+encodeURIComponent(g.slice(7)):encodeURIComponent(g)}function b8(g){return g._attachments&&Object.keys(g._attachments)?ca.all(Object.keys(g._attachments).map(function(h){var i=g._attachments[h];return i.data&&"string"!=typeof i.data?new ca(function(j){dR(i.data,j)}).then(function(j){i.data=j}):void 0})):ca.resolve()}function eP(g){var i=jV(g);(i.user||i.password)&&(i.auth={username:i.user,password:i.password});var h=i.path.replace(/(^\/|\/$)/g,"").split("/");return i.db=h.pop(),-1===i.db.indexOf("%")&&(i.db=encodeURIComponent(i.db)),i.path=h.join("/"),i}function dv(h,g){return cC(h,h.db+"/"+g)}function cC(g,i){var h=g.path?"/":"";return g.protocol+"://"+g.host+(g.port?":"+g.port:"")+"/"+g.path+h+i}function ap(g){return"?"+Object.keys(g).map(function(h){return h+"="+encodeURIComponent(g[h])}).join("&")}function f8(j,o){function k(A,B,y){var z=A.ajax||{},x=aI.extend(d8(g),z,B);return bD(x.method+" "+x.url),p._ajax(x,y)}function w(x,y){return new ca(function(z,A){k(x,y,function(C,B){return C?A(C):void z(B)})})}function v(x,y){return ek(x,fG(function(z){s().then(function(){return y.apply(this,z)})["catch"](function(A){var B=z.pop();B(A)})}))}function s(){if(j.skipSetup||j.skip_setup){return ca.resolve()}if(u){return u}var x={method:"GET",url:r};return u=w({},x)["catch"](function(y){return y&&y.status&&404===y.status?(eY(404,"PouchDB is just detecting if the remote exists."),w({},{method:"PUT",url:r})):ca.reject(y)})["catch"](function(y){return y&&y.status&&412===y.status?!0:ca.reject(y)}),u["catch"](function(){u=null}),u}function l(x){return x.split("/").map(encodeURIComponent).join("/")}var p=this,n=eP;j.getHost&&(n=j.getHost);var h=n(j.name,j),r=dv(h,"");j=d8(j);var g=j.ajax||{};if(p.getUrl=function(){return r},p.getHeaders=function(){return g.headers||{}},j.auth||h.auth){var m=j.auth||h.auth,i=m.username+":"+m.password,q=b2(unescape(encodeURIComponent(i)));g.headers=g.headers||{},g.headers.Authorization="Basic "+q}p._ajax=e8;var u;setTimeout(function(){o(null,p)}),p.type=function(){return"http"},p.id=v("id",function(x){k({},{method:"GET",url:cC(h,"")},function(y,A){var z=A&&A.uuid?A.uuid+h.db:dv(h,"");x(null,z)})}),p.request=v("request",function(x,y){x.url=dv(h,x.url),k({},x,y)}),p.compact=v("compact",function(x,y){"function"==typeof x&&(y=x,x={}),x=d8(x),k(x,{url:dv(h,"_compact"),method:"POST"},function(){function z(){p.info(function(A,B){B&&!B.compact_running?y(null,{ok:!0}):setTimeout(z,x.interval||200)})}z()})}),p.bulkGet=ek("bulkGet",function(y,A){function C(F){var E={};y.revs&&(E.revs=!0),y.attachments&&(E.attachments=!0),k({},{url:dv(h,"_bulk_get"+ap(E)),method:"POST",body:{docs:y.docs}},F)}function B(){function I(L){return function(M,N){E[L]=N.results,++J===G&&A(null,{results:c1(E)})}}for(var F=dz,G=Math.ceil(y.docs.length/F),J=0,E=new Array(G),K=0;G>K;K++){var H=f5(y,["revs","attachments"]);H.ajax=g,H.docs=y.docs.slice(K*F,Math.min(y.docs.length,(K+1)*F)),j8(x,H,I(K))}}var x=this,z=cC(h,""),D=fA[z];"boolean"!=typeof D?C(function(E,F){if(E){var G=Math.floor(E.status/100);4===G||5===G?(fA[z]=!1,eY(E.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),B()):A(E)}else{fA[z]=!0,A(null,F)}}):D?C(A):B()}),p._info=function(x){s().then(function(){k({},{method:"GET",url:dv(h,"")},function(y,z){return y?x(y):(z.host=dv(h,""),void x(null,z))})})["catch"](x)},p.get=v("get",function(C,A,y){function B(F){var G=F._attachments,E=G&&Object.keys(G);return G&&E.length?ca.all(E.map(function(H){var I=G[H],J=dY(F._id)+"/"+l(H)+"?rev="+F._rev;return w(A,{method:"GET",url:dv(h,J),binary:!0}).then(function(K){return A.binary?K:new ca(function(L){dR(K,L)})}).then(function(K){delete I.stub,delete I.length,I.data=K})})):void 0}function x(E){return Array.isArray(E)?ca.all(E.map(function(F){return F.ok?B(F.ok):void 0})):B(E)}"function"==typeof A&&(y=A,A={}),A=d8(A);var D={};A.revs&&(D.revs=!0),A.revs_info&&(D.revs_info=!0),A.open_revs&&("all"!==A.open_revs&&(A.open_revs=JSON.stringify(A.open_revs)),D.open_revs=A.open_revs),A.rev&&(D.rev=A.rev),A.conflicts&&(D.conflicts=A.conflicts),C=dY(C);var z={method:"GET",url:dv(h,C+ap(D))};w(A,z).then(function(E){return ca.resolve().then(function(){return A.attachments?x(E):void 0}).then(function(){y(null,E)})})["catch"](y)}),p.remove=v("remove",function(z,x,y,B){var A;"string"==typeof x?(A={_id:z,_rev:x},"function"==typeof y&&(B=y,y={})):(A=z,"function"==typeof x?(B=x,y={}):(B=y,y=x));var C=A._rev||y.rev;k(y,{method:"DELETE",url:dv(h,dY(A._id))+"?rev="+C},B)}),p.getAttachment=v("getAttachment",function(z,B,x,A){"function"==typeof x&&(A=x,x={});var C=x.rev?"?rev="+x.rev:"",y=dv(h,dY(z))+"/"+l(B)+C;k(x,{method:"GET",url:y,binary:!0},A)}),p.removeAttachment=v("removeAttachment",function(A,y,z,B){var x=dv(h,dY(A)+"/"+l(y))+"?rev="+z;k({},{method:"DELETE",url:x},B)}),p.putAttachment=v("putAttachment",function(G,z,B,C,E,A){"function"==typeof E&&(A=E,E=C,C=B,B=null);var y=dY(G)+"/"+l(z),x=dv(h,y);if(B&&(x+="?rev="+B),"string"==typeof C){var D;try{D=aM(C)}catch(H){return A(ke(eW,"Attachment is not a valid base64 string"))}C=D?dC(D,E):""}var F={headers:{"Content-Type":E},method:"PUT",url:x,processData:!1,body:C,timeout:g.timeout||60000};k({},F,A)}),p._bulkDocs=function(y,z,x){y.new_edits=z.new_edits,s().then(function(){return ca.all(y.docs.map(b8))}).then(function(){k(z,{method:"POST",url:dv(h,"_bulk_docs"),body:y},function(B,A){return B?x(B):(A.forEach(function(C){C.ok=!0}),void x(null,A))})})["catch"](x)},p.allDocs=v("allDocs",function(C,A){"function"==typeof C&&(A=C,C={}),C=d8(C);var B,y={},x="GET";C.conflicts&&(y.conflicts=!0),C.descending&&(y.descending=!0),C.include_docs&&(y.include_docs=!0),C.attachments&&(y.attachments=!0),C.key&&(y.key=JSON.stringify(C.key)),C.start_key&&(C.startkey=C.start_key),C.startkey&&(y.startkey=JSON.stringify(C.startkey)),C.end_key&&(C.endkey=C.end_key),C.endkey&&(y.endkey=JSON.stringify(C.endkey)),"undefined"!=typeof C.inclusive_end&&(y.inclusive_end=!!C.inclusive_end),"undefined"!=typeof C.limit&&(y.limit=C.limit),"undefined"!=typeof C.skip&&(y.skip=C.skip);var z=ap(y);if("undefined"!=typeof C.keys){var D="keys="+encodeURIComponent(JSON.stringify(C.keys));D.length+z.length+1<=b3?z+="&"+D:(x="POST",B={keys:C.keys})}w(C,{method:x,url:dv(h,"_all_docs"+z),body:B}).then(function(E){C.include_docs&&C.attachments&&C.binary&&E.rows.forEach(c3),A(null,E)})["catch"](A)}),p._changes=function(L){var D="batch_size" in L?L.batch_size:dK;L=d8(L),L.timeout="timeout" in L?L.timeout:"timeout" in g?g.timeout:30000;var B,G=L.timeout?{timeout:L.timeout-5000}:{},K="undefined"!=typeof L.limit?L.limit:!1;B="return_docs" in L?L.return_docs:"returnDocs" in L?L.returnDocs:!0;var H=K;if(L.style&&(G.style=L.style),(L.include_docs||L.filter&&"function"==typeof L.filter)&&(G.include_docs=!0),L.attachments&&(G.attachments=!0),L.continuous&&(G.feed="longpoll"),L.conflicts&&(G.conflicts=!0),L.descending&&(G.descending=!0),"heartbeat" in L?L.heartbeat&&(G.heartbeat=L.heartbeat):G.heartbeat=10000,L.filter&&"string"==typeof L.filter&&(G.filter=L.filter),L.view&&"string"==typeof L.view&&(G.filter="_view",G.view=L.view),L.query_params&&"object"==typeof L.query_params){for(var C in L.query_params){L.query_params.hasOwnProperty(C)&&(G[C]=L.query_params[C])}}var F,y="GET";if(L.doc_ids){G.filter="_doc_ids";var E=JSON.stringify(L.doc_ids);E.length<b3?G.doc_ids=E:(y="POST",F={doc_ids:L.doc_ids})}var A,z,x=function(N,M){if(!L.aborted){G.since=N,"object"==typeof G.since&&(G.since=JSON.stringify(G.since)),L.descending?K&&(G.limit=H):G.limit=!K||H>D?D:H;var O={method:y,url:dv(h,"_changes"+ap(G)),timeout:L.timeout,body:F};z=N,L.aborted||s().then(function(){A=k(L,O,M)})["catch"](M)}},J={results:[]},I=function(O,Q){if(!L.aborted){var P=0;if(Q&&Q.results){P=Q.results.length,J.last_seq=Q.last_seq;var M={};M.query=L.query_params,Q.results=Q.results.filter(function(R){H--;var S=f1(L)(R);return S&&(L.include_docs&&L.attachments&&L.binary&&c3(R),B&&J.results.push(R),L.onChange(R)),S})}else{if(O){return L.aborted=!0,void L.complete(O)}}Q&&Q.last_seq&&(z=Q.last_seq);var N=K&&0>=H||Q&&D>P||L.descending;(!L.continuous||K&&0>=H)&&N?L.complete(null,J):setTimeout(function(){x(z,I)},0)}};return x(L.since||0,I),{cancel:function(){L.aborted=!0,A&&A.abort()}}},p.revsDiff=v("revsDiff",function(y,z,x){"function"==typeof z&&(x=z,z={}),k(z,{method:"POST",url:dv(h,"_revs_diff"),body:y},x)}),p._close=function(x){x()},p._destroy=function(x,y){k(x,{url:dv(h,""),method:"DELETE"},function(z,A){return z&&z.status&&404!==z.status?y(z):void y(null,A)})}}function cE(g){g.adapter("http",f8,!1),g.adapter("https",f8,!1)}function am(){this.promise=new ca(function(g){g()})}function d1(l){var n=l.db,i=l.viewName,g=l.map,h=l.reduce,m=l.temporary,k=g.toString()+(h&&h.toString())+"undefined";if(!m&&n._cachedViews){var j=n._cachedViews[k];if(j){return ca.resolve(j)}}return n.info().then(function(p){function o(u){u.views=u.views||{};var r=i;-1===r.indexOf("/")&&(r=i+"/"+i);var s=u.views[r]=u.views[r]||{};if(!s[q]){return s[q]=!0,u}}var q=p.db_name+"-mrview-"+(m?"temp":f9(k));return f2(n,"_local/mrviews",o).then(function(){return n.registerDependentDatabase(q).then(function(s){var u=s.db;u.auto_compaction=!0;var r={name:q,db:u,sourceDB:n,adapter:n.adapter,mapFun:g,reduceFun:h};return r.db.get("_local/lastSeq")["catch"](function(v){if(404!==v.status){throw v}}).then(function(v){return r.seq=v?v.seq:0,m||(n._cachedViews=n._cachedViews||{},n._cachedViews[k]=r,r.db.once("destroyed",function(){delete n._cachedViews[k]})),r})})})})}function e2(l,j,i,k,h,g){return dP("return ("+l.replace(/;\s*$/,"")+");",{emit:j,sum:i,log:k,isArray:h,toJSON:g})}function aY(g){return -1===g.indexOf("/")?[g,g]:g.split("/")}function kd(g){return 1===g.length&&/^1-/.test(g[0].rev)}function fI(g,i){try{g.emit("error",i)}catch(h){fJ("error","The user's map/reduce function threw an uncaught error.\nYou can debug this error by doing:\nmyDatabase.on('error', function (err) { debugger; });\nPlease double-check your map/reduce function."),fJ("error",i)}}function cF(g,i,h){try{return{output:i.apply(null,h)}}catch(j){return fI(g,j),{error:j}}}function b5(g,i){var h=cl.collate(g.key,i.key);return 0!==h?h:cl.collate(g.value,i.value)}function bF(g,i,h){return h=h||0,"number"==typeof i?g.slice(h,i+h):h>0?g.slice(h):g}function bE(g){var i=g.value,h=i&&"object"==typeof i&&i._id||g.id;return h}function d5(g){g.rows.forEach(function(i){var h=i.doc&&i.doc._attachments;h&&Object.keys(h).forEach(function(j){var k=h[j];h[j].data=aL(k.data,k.content_type)})})}function e6(g){return function(h){return g.include_docs&&g.attachments&&g.binary&&d5(h),h}}function f0(h){var g="builtin "+h+" function requires map values to be numbers or number arrays";return new kl(g)}function cG(l){for(var n=0,i=0,g=l.length;g>i;i++){var h=l[i];if("number"!=typeof h){if(!Array.isArray(h)){throw f0("_sum")}n="number"==typeof n?[n]:n;for(var m=0,k=h.length;k>m;m++){var j=h[m];if("number"!=typeof j){throw f0("_sum")}"undefined"==typeof n[m]?n.push(j):n[m]+=j}}else{"number"==typeof n?n+=h:n[0]+=h}}return n}function c2(k,i,h,j){var g=i[k];"undefined"!=typeof g&&(j&&(g=encodeURIComponent(JSON.stringify(g))),h.push(k+"="+g))}function bQ(h){if("undefined"!=typeof h){var g=Number(h);return isNaN(g)||g!==parseInt(h,10)?h:g}}function aG(g){return g.group_level=bQ(g.group_level),g.limit=bQ(g.limit),g.skip=bQ(g.skip),g}function aZ(g){if(g){if("number"!=typeof g){return new kc('Invalid value for integer: "'+g+'"')}if(0>g){return new kc('Invalid value for positive integer: "'+g+'"')}}}function du(g,i){var h=g.descending?"endkey":"startkey",j=g.descending?"startkey":"endkey";if("undefined"!=typeof g[h]&&"undefined"!=typeof g[j]&&cl.collate(g[h],g[j])>0){throw new kc("No rows can match your key range, reverse your start_key and end_key or set {descending : true}")}if(i.reduce&&g.reduce!==!1){if(g.include_docs){throw new kc("{include_docs:true} is invalid for reduce")}if(g.keys&&g.keys.length>1&&!g.group&&!g.group_level){throw new kc("Multi-key fetches for reduce views must use {group: true}")}}["group_level","limit","skip"].forEach(function(k){var l=aZ(g[k]);if(l){throw l}})}function b9(o,g,l){var j,k=[],m="GET";if(c2("reduce",l,k),c2("include_docs",l,k),c2("attachments",l,k),c2("limit",l,k),c2("descending",l,k),c2("group",l,k),c2("group_level",l,k),c2("skip",l,k),c2("stale",l,k),c2("conflicts",l,k),c2("startkey",l,k,!0),c2("start_key",l,k,!0),c2("endkey",l,k,!0),c2("end_key",l,k,!0),c2("inclusive_end",l,k),c2("key",l,k,!0),k=k.join("&"),k=""===k?"":"?"+k,"undefined"!=typeof l.keys){var n=2000,i="keys="+encodeURIComponent(JSON.stringify(l.keys));i.length+k.length+1<=n?k+=("?"===k[0]?"&":"?")+i:(m="POST","string"==typeof g?j={keys:l.keys}:g.keys=l.keys)}if("string"==typeof g){var h=aY(g);return o.request({method:m,url:"_design/"+h[0]+"/_view/"+h[1]+k,body:j}).then(e6(l))}return j=j||{},Object.keys(g).forEach(function(p){Array.isArray(g[p])?j[p]=g[p]:j[p]=g[p].toString()}),o.request({method:"POST",url:"_temp_view"+k,body:j}).then(e6(l))}function c8(g,i,h){return new ca(function(j,k){g._query(i,h,function(m,l){return m?k(m):void j(l)})})}function eC(g){return new ca(function(h,i){g._viewCleanup(function(k,j){return k?i(k):void h(j)})})}function dT(g){return function(h){if(404===h.status){return g}throw h}}function cp(p,j,n){function l(){return kd(q)?ca.resolve(k):j.db.get(g)["catch"](dT(k))}function m(r){return r.keys.length?j.db.allDocs({keys:r.keys,include_docs:!0}):ca.resolve({rows:[]})}function o(v,x){for(var B=[],y={},A=0,r=x.rows.length;r>A;A++){var u=x.rows[A],z=u.doc;if(z&&(B.push(z),y[z._id]=!0,z._deleted=!h[z._id],!z._deleted)){var w=h[z._id];"value" in w&&(z.value=w.value)}}var s=Object.keys(h);return s.forEach(function(C){if(!y[C]){var E={_id:C},D=h[C];"value" in D&&(E.value=D.value),B.push(E)}}),v.keys=cN(s.concat(v.keys)),B.push(v),B}var g="_local/doc_"+p,k={_id:g,keys:[]},i=n[p],h=i.indexableKeysToKeyValues,q=i.changes;return l().then(function(r){return m(r).then(function(s){return o(r,s)})})}function bb(g,i,h){var j="_local/lastSeq";return g.db.get(j)["catch"](dT({_id:j,seq:0})).then(function(k){var l=Object.keys(i);return ca.all(l.map(function(m){return cp(m,g,i)})).then(function(m){var n=c1(m);return k.seq=h,n.push(k),g.db.bulkDocs({docs:n})})})}function dU(g){var i="string"==typeof g?g:g.name,h=d2[i];return h||(h=d2[i]=new am),h}function bi(g){return bT(dU(g),function(){return dN(g)})()}function dN(o){function g(p,r){var q={id:k._id,key:cl.normalizeKey(p)};"undefined"!=typeof r&&null!==r&&(q.value=cl.normalizeKey(r)),j.push(q)}function l(q,p){return function(){return bb(o,q,p)}}var j,k,m;if("function"==typeof o.mapFun&&2===o.mapFun.length){var n=o.mapFun;m=function(p){return n(p,g)}}else{m=e2(o.mapFun.toString(),g,cG,aq,Array.isArray,JSON.parse)}var i=o.seq||0,h=new am;return new ca(function(p,s){function r(){h.finish().then(function(){o.seq=i,p()})}function q(){function u(v){s(v)}o.sourceDB.changes({conflicts:!0,include_docs:!0,style:"all_docs",since:i,limit:db}).on("complete",function(A){var v=A.results;if(!v.length){return r()}for(var D={},F=0,C=v.length;C>F;F++){var w=v[F];if("_"!==w.doc._id[0]){j=[],k=w.doc,k._deleted||cF(o.sourceDB,m,[k]),j.sort(b5);for(var z,H={},y=0,B=j.length;B>y;y++){var E=j[y],G=[E.key,E.id];0===cl.collate(E.key,z)&&G.push(y);var x=cl.toIndexableString(G);H[x]=E,z=E.key}D[w.doc._id]={indexableKeysToKeyValues:H,changes:w.changes}}i=w.seq}return h.add(l(D,i)),v.length<db?r():q()}).on("error",u)}q()})}function c4(p,j,n){0===n.group_level&&delete n.group_level;var l,m=n.group||n.group_level;l=eg[p.reduceFun]?eg[p.reduceFun]:e2(p.reduceFun.toString(),null,cG,aq,Array.isArray,JSON.parse);var o=[],g=isNaN(n.group_level)?Number.POSITIVE_INFINITY:n.group_level;j.forEach(function(r){var u=o[o.length-1],s=m?r.key:null;return m&&Array.isArray(s)&&(s=s.slice(0,g)),u&&0===cl.collate(u.groupKey,s)?(u.keys.push([r.key,r.id]),void u.values.push(r.value)):void o.push({keys:[[r.key,r.id]],values:[r.value],groupKey:s})}),j=[];for(var k=0,i=o.length;i>k;k++){var h=o[k],q=cF(p.sourceDB,l,[h.keys,h.values,!1]);if(q.error&&q.error instanceof kl){throw q.error}j.push({value:q.error?null:q.output,key:h.groupKey})}return{rows:bF(j,n.limit,n.skip)}}function j5(h,g){return bT(dU(h),function(){return b6(h,g)})()}function b6(r,n){function q(u){return u.include_docs=!0,r.db.allDocs(u).then(function(v){return p=v.total_rows,v.rows.map(function(x){if("value" in x.doc&&"object"==typeof x.doc.value&&null!==x.doc.value){var z=Object.keys(x.doc.value).sort(),y=["id","key","value"];if(!(y>z||z>y)){return x.doc.value}}var w=cl.parseIndexableString(x.doc._id);return{key:w[0],id:w[1],value:"value" in x.doc?x.doc.value:null}})})}function o(w){var v;if(v=g?c4(r,w,n):{total_rows:p,offset:l,rows:w},n.include_docs){var u=cN(w.map(bE));return r.sourceDB.allDocs({keys:u,include_docs:!0,conflicts:n.conflicts,attachments:n.attachments,binary:n.binary}).then(function(x){var y={};return x.rows.forEach(function(z){z.doc&&(y["$"+z.id]=z.doc)}),w.forEach(function(A){var B=bE(A),z=y["$"+B];z&&(A.doc=z)}),v})}return v}var p,g=r.reduceFun&&n.reduce!==!1,l=n.skip||0;if("undefined"==typeof n.keys||n.keys.length||(n.limit=0,delete n.keys),"undefined"!=typeof n.keys){var h=n.keys,m=h.map(function(v){var u={startkey:cl.toIndexableString([v]),endkey:cl.toIndexableString([v,{}])};return q(u)});return ca.all(m).then(c1).then(o)}var k={descending:n.descending};if(n.start_key&&(n.startkey=n.start_key),n.end_key&&(n.endkey=n.end_key),"undefined"!=typeof n.startkey&&(k.startkey=n.descending?cl.toIndexableString([n.startkey,{}]):cl.toIndexableString([n.startkey])),"undefined"!=typeof n.endkey){var i=n.inclusive_end!==!1;n.descending&&(i=!i),k.endkey=cl.toIndexableString(i?[n.endkey,{}]:[n.endkey])}if("undefined"!=typeof n.key){var s=cl.toIndexableString([n.key]),j=cl.toIndexableString([n.key,{}]);k.descending?(k.endkey=s,k.startkey=j):(k.startkey=s,k.endkey=j)}return g||("number"==typeof n.limit&&(k.limit=n.limit),k.skip=l),q(k).then(o)}function aJ(g){return g.request({method:"POST",url:"_view_cleanup"})}function by(g){return g.get("_local/mrviews").then(function(h){var j={};Object.keys(h.views).forEach(function(k){var m=aY(k),n="_design/"+m[0],l=m[1];j[n]=j[n]||{},j[n][l]=!0});var i={keys:Object.keys(j),include_docs:!0};return g.allDocs(i).then(function(k){var l={};k.rows.forEach(function(p){var o=p.key.substring(8);Object.keys(j[p.key]).forEach(function(u){var r=o+"/"+u;h.views[r]||(r=u);var q=Object.keys(h.views[r]),s=p.doc&&p.doc.views&&p.doc.views[u];q.forEach(function(v){l[v]=l[v]||s})})});var n=Object.keys(l).filter(function(o){return !l[o]}),m=n.map(function(o){return bT(dU(o),function(){return new g.constructor(o,g.__opts).destroy()})()});return ca.all(m).then(function(){return{ok:!0}})})},dT({ok:!0}))}function fR(h,j,l){if("http"===h.type()){return b9(h,j,l)}if("function"==typeof h._query){return c8(h,j,l)}if("string"!=typeof j){du(l,j);var i={db:h,viewName:"temp_view/temp_view",map:j.map,reduce:j.reduce,temporary:!0};return j9.add(function(){return d1(i).then(function(o){function p(){return o.db.destroy()}return d3(bi(o).then(function(){return j5(o,l)}),p)})}),j9.finish()}var n=j,k=aY(n),g=k[0],m=k[1];return h.get("_design/"+g).then(function(o){var p=o.views&&o.views[m];if(!p||"string"!=typeof p.map){throw new bI("ddoc "+g+" has no view named "+m)}du(l,p);var q={db:h,viewName:n,map:p.map,reduce:p.reduce};return d1(q).then(function(r){return"ok"===l.stale||"update_after"===l.stale?("update_after"===l.stale&&eR.nextTick(function(){bi(r)}),j5(r,l)):bi(r).then(function(){return j5(r,l)})})})}function kc(h){this.status=400,this.name="query_parse_error",this.message=h,this.error=!0;try{Error.captureStackTrace(this,kc)}catch(g){}}function bI(h){this.status=404,this.name="not_found",this.message=h,this.error=!0;try{Error.captureStackTrace(this,bI)}catch(g){}}function kl(h){this.status=500,this.name="invalid_value",this.message=h,this.error=!0;try{Error.captureStackTrace(this,kl)}catch(g){}}function c6(g){return/^1-/.test(g)}function bv(g,i,h){return !g._attachments||!g._attachments[h]||g._attachments[h].digest!==i._attachments[h].digest}function cj(g,i){var h=Object.keys(i._attachments);return ca.all(h.map(function(j){return g.getAttachment(i._id,j,{rev:i._rev})}))}function d6(k,i,h){var j="http"===i.type()&&"http"!==k.type(),g=Object.keys(h._attachments);return j?k.get(h._id).then(function(l){return ca.all(g.map(function(m){return bv(l,h,m)?i.getAttachment(h._id,m):k.getAttachment(l._id,m)}))})["catch"](function(l){if(404!==l.status){throw l}return cj(i,h)}):cj(i,h)}function e9(h){var g=[];return Object.keys(h).forEach(function(j){var i=h[j].missing;i.forEach(function(k){g.push({id:j,rev:k})})}),{docs:g,revs:!0}}function dI(g,k,o,m){function n(){var r=e9(o);if(r.docs.length){return g.bulkGet(r).then(function(s){if(m.cancelled){throw new Error("cancelled")}return ca.all(s.results.map(function(u){return ca.all(u.docs.map(function(w){var v=w.ok;return w.error&&(q=!1),v&&v._attachments?d6(k,g,v).then(function(x){var y=Object.keys(v._attachments);return x.forEach(function(z,B){var A=v._attachments[y[B]];delete A.stub,delete A.length,A.data=z}),v}):v}))})).then(function(u){h=h.concat(c1(u).filter(Boolean))})})}}function p(r){return r._attachments&&Object.keys(r._attachments).length>0}function i(r){return g.allDocs({keys:r,include_docs:!0}).then(function(s){if(m.cancelled){throw new Error("cancelled")}s.rows.forEach(function(u){!u.deleted&&u.doc&&c6(u.value.rev)&&!p(u.doc)&&(h.push(u.doc),delete o[u.id])})})}function l(){var r=Object.keys(o).filter(function(s){var u=o[s].missing;return 1===u.length&&c6(u[0])});return r.length>0?i(r):void 0}function j(){return{ok:q,docs:h}}o=d8(o);var h=[],q=!0;return ca.resolve().then(l).then(n).then(j)}function eV(k,i,h,j,g){return k.get(i)["catch"](function(l){if(404===l.status){return"http"===k.type()&&eY(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:j,_id:i,history:[],replicator:cB,version:dx}}throw l}).then(function(l){return g.cancelled?void 0:(l.history=(l.history||[]).filter(function(m){return m.session_id!==j}),l.history.unshift({last_seq:h,session_id:j}),l.history=l.history.slice(0,aP),l.version=dx,l.replicator=cB,l.session_id=j,l.last_seq=h,k.put(l)["catch"](function(m){if(409===m.status){return eV(k,i,h,j,g)}throw m}))})}function cV(g,i,h,j){this.src=g,this.target=i,this.id=h,this.returnValue=j}function cb(h,g){return h.session_id===g.session_id?{last_seq:h.last_seq,history:h.history}:dO(h.history,g.history)}function dO(l,n){var i=l[0],g=l.slice(1),h=n[0],m=n.slice(1);if(!i||0===n.length){return{last_seq:jZ,history:[]}}var k=i.session_id;if(eF(k,n)){return{last_seq:i.last_seq,history:l}}var j=h.session_id;return eF(j,g)?{last_seq:h.last_seq,history:m}:dO(g,m)}function eF(g,i){var h=i[0],j=i.slice(1);return g&&0!==i.length?g===h.session_id?!0:eF(g,j):!1}function eD(g){return"number"==typeof g.status&&4===Math.floor(g.status/100)}function aA(g,i,h,j){return g.retry===!1?(i.emit("error",h),void i.removeAllListeners()):("function"!=typeof g.back_off_function&&(g.back_off_function=jT),i.emit("requestError",h),"active"!==i.state&&"pending"!==i.state||(i.emit("paused",h),i.state="stopped",i.once("active",function(){g.current_back_off=ej})),g.current_back_off=g.current_back_off||ej,g.current_back_off=g.back_off_function(g.current_back_off),void setTimeout(j,g.current_back_off))}function ak(g){return Object.keys(g).sort(cl.collate).reduce(function(h,i){return h[i]=g[i],h},{})}function ef(i,l,g){var m=g.doc_ids?g.doc_ids.sort(cl.collate):"",j=g.filter?g.filter.toString():"",k="",h="";return g.filter&&g.query_params&&(k=JSON.stringify(ak(g.query_params))),g.filter&&"_view"===g.filter&&(h=g.view.toString()),ca.all([i.id(),l.id()]).then(function(n){var o=n[0]+n[1]+j+h+k+m;return new ca(function(p){jN(o,p)})}).then(function(n){return n=n.replace(/\//g,".").replace(/\+/g,"_"),"_local/"+n})}function bO(E,N,n,i,m){function u(){return A?ca.resolve():ef(E,N,n).then(function(T){L=T,A=new cV(E,N,L,i)})}function h(){if(R=[],0!==C.docs.length){var T=C.docs;return N.bulkDocs({docs:T,new_edits:!1}).then(function(Y){if(i.cancelled){throw l(),new Error("cancelled")}var V=[],X={};Y.forEach(function(Z){Z.error&&(m.doc_write_failures++,V.push(Z),X[Z.id]=Z)}),D=D.concat(V),m.docs_written+=C.docs.length-V.length;var W=V.filter(function(Z){return"unauthorized"!==Z.name&&"forbidden"!==Z.name});if(T.forEach(function(Z){var ae=X[Z._id];ae?i.emit("denied",d8(ae)):R.push(Z)}),W.length>0){var U=new Error("bulkDocs error");throw U.other_errors=V,v("target.bulkDocs failed to write docs",U),new Error("bulkWrite partial failure")}},function(U){throw m.doc_write_failures+=T.length,U})}}function O(){if(C.error){throw new Error("There was a problem getting docs.")}m.last_seq=s=C.seq;var T=d8(m);return R.length&&(T.docs=R,i.emit("change",T)),x=!0,A.writeCheckpoint(C.seq,F).then(function(){if(x=!1,i.cancelled){throw l(),new Error("cancelled")}C=void 0,p()})["catch"](M)}function H(){var T={};return C.changes.forEach(function(U){"_user/"!==U.id&&(T[U.id]=U.changes.map(function(V){return V.rev}))}),N.revsDiff(T).then(function(U){if(i.cancelled){throw l(),new Error("cancelled")}C.diffs=U})}function z(){return dI(E,N,C.diffs,i).then(function(T){C.error=!T.ok,T.docs.forEach(function(U){delete C.diffs[U._id],m.docs_read++,C.docs.push(U)})})}function q(){if(!i.cancelled&&!C){if(0===r.length){return void J(!0)}C=r.shift(),H().then(z).then(h).then(O).then(q)["catch"](function(T){v("batch processing terminated with error",T)})}}function J(T){return 0===k.changes.length?void (0!==r.length||C||((Q&&o.live||g)&&(i.state="pending",i.emit("paused")),g&&l())):void ((T||g||k.changes.length>=I)&&(r.push(k),k={seq:0,changes:[],docs:[]},"pending"!==i.state&&"stopped"!==i.state||(i.state="active",i.emit("active")),q()))}function v(U,T){y||(T.message||(T.message=U),m.ok=!1,m.status="aborting",m.errors.push(T),D=D.concat(T),r=[],k={seq:0,changes:[],docs:[]},l())}function l(){if(!(y||i.cancelled&&(m.status="cancelled",x))){m.status=m.status||"complete",m.end_time=new Date,m.last_seq=s,y=!0;var U=D.filter(function(V){return"unauthorized"!==V.name&&"forbidden"!==V.name});if(U.length>0){var T=D.pop();D.length>0&&(T.other_errors=D),T.result=m,aA(n,i,T,function(){bO(E,N,n,i)})}else{m.errors=D,i.emit("complete",m),i.removeAllListeners()}}}function G(U){if(i.cancelled){return l()}var T=f1(n)(U);T&&(k.seq=U.seq,k.changes.push(U),J(0===r.length&&o.live))}function S(U){if(P=!1,i.cancelled){return l()}if(U.results.length>0){o.since=U.last_seq,p(),J(!0)}else{var T=function(){Q?(o.live=!0,p()):g=!0,J(!0)};C||0!==U.results.length?T():(x=!0,A.writeCheckpoint(U.last_seq,F).then(function(){x=!1,m.last_seq=s=U.last_seq,T()})["catch"](M))}}function j(T){return P=!1,i.cancelled?l():void v("changes rejected",T)}function p(){function T(){V.cancel()}function U(){i.removeListener("cancel",T)}if(!P&&!g&&r.length<K){P=!0,i._changes&&(i.removeListener("cancel",i._abortChanges),i._changes.cancel()),i.once("cancel",T);var V=E.changes(o).on("change",G);V.then(U,U),V.then(S)["catch"](j),n.retry&&(i._changes=V,i._abortChanges=T)}}function w(){u().then(function(){return i.cancelled?void l():A.getCheckpoint().then(function(T){s=T,o={since:s,limit:I,batch_size:I,style:"all_docs",doc_ids:B,return_docs:!0},n.filter&&("string"!=typeof n.filter?o.include_docs=!0:o.filter=n.filter),"heartbeat" in n&&(o.heartbeat=n.heartbeat),"timeout" in n&&(o.timeout=n.timeout),n.query_params&&(o.query_params=n.query_params),n.view&&(o.view=n.view),p()})})["catch"](function(T){v("getCheckpoint rejected with ",T)})}function M(T){throw x=!1,v("writeCheckpoint completed with error",T),T}var C,L,A,r=[],k={seq:0,changes:[],docs:[]},x=!1,g=!1,y=!1,s=0,Q=n.continuous||n.live||!1,I=n.batch_size||100,K=n.batches_limit||10,P=!1,B=n.doc_ids,D=[],R=[],F=jY();m=m||{ok:!0,start_time:new Date,docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var o={};return i.ready(E,N),i.cancelled?void l():(i._addedListeners||(i.once("cancel",l),"function"==typeof n.complete&&(i.once("error",n.complete),i.once("complete",function(T){n.complete(null,T)})),i._addedListeners=!0),void ("undefined"==typeof n.since?w():u().then(function(){return x=!0,A.writeCheckpoint(n.since,F)}).then(function(){return x=!1,i.cancelled?void l():(s=n.since,void w())})["catch"](M)))}function eI(){jS.EventEmitter.call(this),this.cancelled=!1,this.state="pending";var h=this,g=new ca(function(i,j){h.once("complete",i),h.once("error",j)});h.then=function(i,j){return g.then(i,j)},h["catch"]=function(i){return g["catch"](i)},h["catch"](function(){})}function bm(g,i){var h=i.PouchConstructor;return"string"==typeof g?new h(g,i):g}function dc(i,l,g,m){if("function"==typeof g&&(m=g,g={}),"undefined"==typeof g&&(g={}),g.doc_ids&&!Array.isArray(g.doc_ids)){throw ke(dA,"`doc_ids` filter parameter is not a list.")}g.complete=m,g=d8(g),g.continuous=g.continuous||g.live,g.retry="retry" in g?g.retry:!1,g.PouchConstructor=g.PouchConstructor||this;var j=new eI(g),k=bm(i,g),h=bm(l,g);return bO(k,h,g,j),j}function ah(g,i,h,j){return"function"==typeof h&&(j=h,h={}),"undefined"==typeof h&&(h={}),h=d8(h),h.PouchConstructor=h.PouchConstructor||this,g=bm(g,h),i=bm(i,h),new b1(g,i,h,j)}function b1(s,l,m,v){function k(z){q.emit("change",{direction:"pull",change:z})}function p(z){q.emit("change",{direction:"push",change:z})}function y(z){q.emit("denied",{direction:"push",doc:z})}function n(z){q.emit("denied",{direction:"pull",doc:z})}function i(){q.pushPaused=!0,q.pullPaused&&q.emit("paused")}function w(){q.pullPaused=!0,q.pushPaused&&q.emit("paused")}function r(){q.pushPaused=!1,q.pullPaused&&q.emit("active",{direction:"push"})}function o(){q.pullPaused=!1,q.pushPaused&&q.emit("active",{direction:"pull"})}function u(z){return function(D,C){var A="change"===D&&(C===k||C===p),F="denied"===D&&(C===n||C===y),B="paused"===D&&(C===w||C===i),E="active"===D&&(C===o||C===r);(A||F||B||E)&&(D in g||(g[D]={}),g[D][z]=!0,2===Object.keys(g[D]).length&&q.removeAllListeners(D))}}var q=this;this.canceled=!1;var x=m.push?aI.extend({},m,m.push):m,h=m.pull?aI.extend({},m,m.pull):m;this.push=dc(s,l,x),this.pull=dc(l,s,h),this.pushPaused=!0,this.pullPaused=!0;var g={};m.live&&(this.push.on("complete",q.pull.cancel.bind(q.pull)),this.pull.on("complete",q.push.cancel.bind(q.push))),this.on("newListener",function(z){"change"===z?(q.pull.on("change",k),q.push.on("change",p)):"denied"===z?(q.pull.on("denied",n),q.push.on("denied",y)):"active"===z?(q.pull.on("active",o),q.push.on("active",r)):"paused"===z&&(q.pull.on("paused",w),q.push.on("paused",i))}),this.on("removeListener",function(z){"change"===z?(q.pull.removeListener("change",k),q.push.removeListener("change",p)):"denied"===z?(q.pull.removeListener("denied",n),q.push.removeListener("denied",y)):"active"===z?(q.pull.removeListener("active",o),q.push.removeListener("active",r)):"paused"===z&&(q.pull.removeListener("paused",w),q.push.removeListener("paused",i))}),this.pull.on("removeListener",u("pull")),this.push.on("removeListener",u("push"));var j=ca.all([this.push,this.pull]).then(function(A){var z={push:A[0],pull:A[1]};return q.emit("complete",z),v&&v(null,z),q.removeAllListeners(),z},function(z){if(q.cancel(),v?v(z):q.emit("error",z),q.removeAllListeners(),v){throw z}});this.then=function(A,z){return j.then(A,z)},this["catch"]=function(z){return j["catch"](z)}}function eB(g){g.replicate=dc,g.sync=ah}var fD,aI=f(9),bY=dS(f(5)),cs=dS(f(8)),bW=dS(f(10)),e7=f(14),fG=dS(f(4)),jS=f(1),dP=dS(f(15)),cL=dS(f(16)),eQ=dS(f(17)),cl=f(12),ca="function"==typeof Promise?Promise:bW,eH=Function.prototype.toString,dD=eH.call(Object),bw=bY("pouchdb:api"),eT=6;if(bz()){fD=!1}else{try{localStorage.setItem("_pouch_check_localstorage",1),fD=!!localStorage.getItem("_pouch_check_localstorage")}catch(cz){fD=!1}}cs(fF,jS.EventEmitter),fF.prototype.addListener=function(i,l,g,m){function j(){function n(){h=!1}if(k._listeners[l]){if(h){return void (h="waiting")}h=!0;var o=f5(m,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary"]);g.changes(o).on("change",function(p){p.seq>m.since&&!m.cancelled&&(m.since=p.seq,m.onChange(p))}).on("complete",function(){"waiting"===h&&setTimeout(function(){j()},0),h=!1}).on("error",n)}}if(!this._listeners[l]){var k=this,h=!1;this._listeners[l]=j,this.on(i,j)}},fF.prototype.removeListener=function(h,g){g in this._listeners&&jS.EventEmitter.prototype.removeListener.call(this,h,this._listeners[g])},fF.prototype.notifyLocalWindows=function(g){bz()?chrome.storage.local.set({dbName:g}):eE()&&(localStorage[g]="a"===localStorage[g]?"b":"a")},fF.prototype.notify=function(g){this.emit(g),this.notifyLocalWindows(g)},cs(e4,Error),e4.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};var ay=new e4({status:401,error:"unauthorized",reason:"Name or password is incorrect."}),bG=new e4({status:400,error:"bad_request",reason:"Missing JSON list of 'docs'"}),aa=new e4({status:404,error:"not_found",reason:"missing"}),ba=new e4({status:409,error:"conflict",reason:"Document update conflict"}),cf=new e4({status:400,error:"invalid_id",reason:"_id field must contain a string"}),ea=new e4({status:412,error:"missing_id",reason:"_id is required for puts"}),j3=new e4({status:400,error:"bad_request",reason:"Only reserved document ids may start with underscore."}),dF=new e4({status:412,error:"precondition_failed",reason:"Database not open"}),aX=new e4({status:500,error:"unknown_error",reason:"Database encountered an unknown error"}),eW=new e4({status:500,error:"badarg",reason:"Some query argument is invalid"}),dV=new e4({status:400,error:"invalid_request",reason:"Request was invalid"}),j7=new e4({status:400,error:"query_parse_error",reason:"Some query parameter is invalid"}),fO=new e4({status:500,error:"doc_validation",reason:"Bad special document member"}),dA=new e4({status:400,error:"bad_request",reason:"Something wrong with the request"}),dJ=new e4({status:400,error:"bad_request",reason:"Document must be a JSON object"}),cq=new e4({status:404,error:"not_found",reason:"Database not found"}),aC=new e4({status:500,error:"indexed_db_went_bad",reason:"unknown"}),eN=new e4({status:500,error:"web_sql_went_bad",reason:"unknown"}),aw=new e4({status:500,error:"levelDB_went_went_bad",reason:"unknown"}),dq=new e4({status:403,error:"forbidden",reason:"Forbidden by design doc validate_doc_update function"}),cD=new e4({status:400,error:"bad_request",reason:"Invalid rev format"}),dh=new e4({status:412,error:"file_exists",reason:"The database could not be created, the file already exists."}),cu=new e4({status:412,error:"missing_stub"}),eq=new e4({status:413,error:"invalid_url",reason:"Provided URL is invalid"}),eL=[ay,bG,aa,ba,cf,ea,j3,dF,aX,eW,dV,j7,fO,dA,dJ,cq,eN,aw,dq,cD,dh,cu,aC,eq],cA=function(g,i,h){var j=eL.filter(function(k){return k[g]===i});return h&&j.filter(function(k){return k.message===h})[0]||j[0]},aK=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],al="queryKey",fC=/(?:^|&)([^&=]*)=?([^&]*)/g,f7=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,da="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");cs(dw,jS.EventEmitter),dw.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")},dw.prototype.doChanges=function(k){var i=this,h=k.complete;if(k=d8(k),"live" in k&&!("continuous" in k)&&(k.continuous=k.live),k.processChange=aT,"latest"===k.since&&(k.since="now"),k.since||(k.since=0),"now"===k.since){return void this.db.info().then(function(l){return i.isCancelled?void h(null,{status:"cancelled"}):(k.since=l.update_seq,void i.doChanges(k))},h)}if(k.continuous&&"now"!==k.since&&this.db.info().then(function(l){i.startSeq=l.update_seq},function(l){if("idbNull"!==l.id){throw l}}),k.view&&!k.filter&&(k.filter="_view"),k.filter&&"string"==typeof k.filter&&("_view"===k.filter?k.view=km(k.view):k.filter=km(k.filter),"http"!==this.db.type()&&!k.doc_ids)){return this.filterChanges(k)}"descending" in k||(k.descending=!1),k.limit=0===k.limit?1:k.limit,k.complete=h;var j=this.db._changes(k);if(j&&"function"==typeof j.cancel){var g=i.cancel;i.cancel=fG(function(l){j.cancel(),g.apply(this,l)})}},dw.prototype.filterChanges=function(l){var j=this,i=l.complete;if("_view"===l.filter){if(!l.view||"string"!=typeof l.view){var k=ke(dA,"`view` filter parameter not found or invalid.");return i(k)}var h=kh(l.view);this.db.get("_design/"+h[0],function(o,n){if(j.isCancelled){return i(null,{status:"cancelled"})}if(o){return i(kg(o))}var m=n&&n.views&&n.views[h[1]]&&n.views[h[1]].map;return m?(l.filter=aR(m),void j.doChanges(l)):i(ke(aa,n.views?"missing json key: "+h[1]:"missing json key: views"))})}else{var g=kh(l.filter);if(!g){return j.doChanges(l)}this.db.get("_design/"+g[0],function(m,n){if(j.isCancelled){return i(null,{status:"cancelled"})}if(m){return i(kg(m))}var o=n&&n.filters&&n.filters[g[1]];return o?(l.filter=kf(o),void j.doChanges(l)):i(ke(aa,n&&n.filters?"missing json key: "+g[1]:"missing json key: filters"))})}},cs(jL,jS.EventEmitter),jL.prototype.post=ek("post",function(g,i,h){return"function"==typeof i&&(h=i,i={}),"object"!=typeof g||Array.isArray(g)?h(ke(dJ)):void this.bulkDocs({docs:[g]},i,ec(h))}),jL.prototype.put=ek("put",fG(function(o){function g(){n||(fJ("warn","db.put(doc, id, rev) has been deprecated and will be removed in a future release, please use db.put({_id: id, _rev: rev}) instead"),n=!0)}var l,j,k,m,n=!1,i=o.shift(),h="_id" in i;if("object"!=typeof i||Array.isArray(i)){return(m=o.pop())(ke(dJ))}for(;;){if(l=o.shift(),j=typeof l,"string"!==j||h?"string"!==j||!h||"_rev" in i?"object"===j?k=l:"function"===j&&(m=l):(g(),i._rev=l):(g(),i._id=l,h=!0),!o.length){break}}return k=k||{},j1(i._id),dg(i._id)&&"function"==typeof this._putLocal?i._deleted?this._removeLocal(i,m):this._putLocal(i,m):void this.bulkDocs({docs:[i]},k,ec(m))})),jL.prototype.putAttachment=ek("putAttachment",function(i,l,g,m,j){function k(o){var n="_rev" in o?parseInt(o._rev,10):0;return o._attachments=o._attachments||{},o._attachments[l]={content_type:j,data:m,revpos:++n},h.put(o)}var h=this;return"function"==typeof j&&(j=m,m=g,g=null),"undefined"==typeof j&&(j=m,m=g,g=null),h.get(i).then(function(n){if(n._rev!==g){throw ke(ba)}return k(n)},function(n){if(n.reason===aa.message){return k({_id:i})}throw n})}),jL.prototype.removeAttachment=ek("removeAttachment",function(k,i,h,j){var g=this;g.get(k,function(m,l){return m?void j(m):l._rev!==h?void j(ke(ba)):l._attachments?(delete l._attachments[i],0===Object.keys(l._attachments).length&&delete l._attachments,void g.put(l,j)):j()})}),jL.prototype.remove=ek("remove",function(l,j,i,k){var h;"string"==typeof j?(h={_id:l,_rev:j},"function"==typeof i&&(k=i,i={})):(h=l,"function"==typeof j?(k=j,i={}):(k=i,i=j)),i=i||{},i.was_delete=!0;var g={_id:h._id,_rev:h._rev||i.rev};return g._deleted=!0,dg(g._id)&&"function"==typeof this._removeLocal?this._removeLocal(h,k):void this.bulkDocs({docs:[g]},i,ec(k))}),jL.prototype.revsDiff=ek("revsDiff",function(l,n,i){function g(o,p){j.has(o)||j.set(o,{missing:[]}),j.get(o).missing.push(p)}function h(q,p){var o=l[q].slice(0);fQ(p,function(r,x,w,s,y){var v=x+"-"+w,u=o.indexOf(v);-1!==u&&(o.splice(u,1),"available"!==y.status&&g(q,v))}),o.forEach(function(r){g(q,r)})}"function"==typeof n&&(i=n,n={});var m=Object.keys(l);if(!m.length){return i(null,{})}var k=0,j=new e7.Map;m.map(function(o){this._getRevisionTree(o,function(q,p){if(q&&404===q.status&&"missing"===q.message){j.set(o,{missing:l[o]})}else{if(q){return i(q)}h(o,p)}if(++k===m.length){var r={};return j.forEach(function(u,s){r[s]=u}),i(null,r)}})},this)}),jL.prototype.bulkGet=ek("bulkGet",function(h,g){j8(this,h,g)}),jL.prototype.compactDocument=ek("compactDocument",function(g,i,h){var j=this;this._getRevisionTree(g,function(l,o){if(l){return h(l)}var m=ac(o),k=[],n=[];Object.keys(m).forEach(function(p){m[p]>i&&k.push(p)}),fQ(o,function(q,v,s,p,r){var u=v+"-"+s;"available"===r.status&&-1!==k.indexOf(u)&&n.push(u)}),j._doCompaction(g,n,h)})}),jL.prototype.compact=ek("compact",function(g,i){"function"==typeof g&&(i=g,g={});var h=this;g=g||{},h._compactionQueue=h._compactionQueue||[],h._compactionQueue.push({opts:g,callback:i}),1===h._compactionQueue.length&&cP(h)}),jL.prototype._compact=function(i,l){function g(n){h.push(j.compactDocument(n.id,0))}function m(o){var n=o.last_seq;ca.all(h).then(function(){return f2(j,"_local/compaction",function(p){return !p.last_seq||p.last_seq<n?(p.last_seq=n,p):!1})}).then(function(){l(null,{ok:!0})})["catch"](l)}var j=this,k={return_docs:!1,last_seq:i.last_seq||0},h=[];j.changes(k).on("change",g).on("complete",m).on("error",l)},jL.prototype.get=ek("get",function(l,n,i){function g(){var o=[],p=h.length;return p?void h.forEach(function(q){m.get(l,{rev:q,revs:n.revs,attachments:n.attachments},function(s,r){s?o.push({missing:q}):o.push({ok:r}),p--,p||i(null,o)})}):i(null,o)}if("function"==typeof n&&(i=n,n={}),"string"!=typeof l){return i(ke(cf))}if(dg(l)&&"function"==typeof this._getLocal){return this._getLocal(l,i)}var h=[],m=this;if(!n.open_revs){return this._get(l,n,function(p,u){if(p){return i(p)}var s=u.doc,C=u.metadata,v=u.ctx;if(n.conflicts){var y=af(C);y.length&&(s._conflicts=y)}if(dH(C,s._rev)&&(s._deleted=!0),n.revs||n.revs_info){var r=jI(C.rev_tree),o=bU(r,function(D){return -1!==D.ids.map(function(E){return E.id}).indexOf(s._rev.split("-")[1])}),z=o.ids.map(function(D){return D.id}).indexOf(s._rev.split("-")[1])+1,q=o.ids.length-z;if(o.ids.splice(z,q),o.ids.reverse(),n.revs&&(s._revisions={start:o.pos+o.ids.length-1,ids:o.ids.map(function(D){return D.id})}),n.revs_info){var A=o.pos+o.ids.length;s._revs_info=o.ids.map(function(D){return A--,{rev:A+"-"+D.id,status:D.opts.status}})}}if(n.attachments&&s._attachments){var B=s._attachments,x=Object.keys(B).length;if(0===x){return i(null,s)}Object.keys(B).forEach(function(D){this._getAttachment(s._id,D,B[D],{rev:s._rev,binary:n.binary,ctx:v},function(F,G){var E=s._attachments[D];E.data=G,delete E.stub,delete E.length,--x||i(null,s)})},m)}else{if(s._attachments){for(var w in s._attachments){s._attachments.hasOwnProperty(w)&&(s._attachments[w].stub=!0)}}i(null,s)}})}if("all"===n.open_revs){this._getRevisionTree(l,function(o,p){return o?i(o):(h=ad(p).map(function(q){return q.rev}),void g())})}else{if(!Array.isArray(n.open_revs)){return i(ke(aX,"function_clause"))}h=n.open_revs;for(var k=0;k<h.length;k++){var j=h[k];if("string"!=typeof j||!/^\d+-/.test(j)){return i(ke(cD))}}g()}}),jL.prototype.getAttachment=ek("getAttachment",function(k,i,h,j){var g=this;h instanceof Function&&(j=h,h={}),this._get(k,h,function(m,l){return m?j(m):l.doc._attachments&&l.doc._attachments[i]?(h.ctx=l.ctx,h.binary=!0,g._getAttachment(k,i,l.doc._attachments[i],h,j),void 0):j(ke(aa))})}),jL.prototype.allDocs=ek("allDocs",function(g,i){if("function"==typeof g&&(i=g,g={}),g.skip="undefined"!=typeof g.skip?g.skip:0,g.start_key&&(g.startkey=g.start_key),g.end_key&&(g.endkey=g.end_key),"keys" in g){if(!Array.isArray(g.keys)){return i(new TypeError("options.keys must be an array"))}var h=["startkey","endkey","key"].filter(function(j){return j in g})[0];if(h){return void i(ke(j7,"Query parameter `"+h+"` is not compatible with multi-get"))}if("http"!==this.type()){return dX(this,g,i)}}return this._allDocs(g,i)}),jL.prototype.changes=function(h,g){return"function"==typeof h&&(g=h,h={}),new dw(this,h,g)},jL.prototype.close=ek("close",function(g){return this._closed=!0,this._close(g)}),jL.prototype.info=ek("info",function(h){var g=this;this._info(function(j,i){return j?h(j):(i.db_name=i.db_name||g._db_name,i.auto_compaction=!(!g.auto_compaction||"http"===g.type()),i.adapter=g.type(),void h(null,i))})}),jL.prototype.id=ek("id",function(g){return this._id(g)}),jL.prototype.type=function(){return"function"==typeof this._type?this._type():this.adapter},jL.prototype.bulkDocs=ek("bulkDocs",function(k,i,h){if("function"==typeof i&&(h=i,i={}),i=i||{},Array.isArray(k)&&(k={docs:k}),!k||!k.docs||!Array.isArray(k.docs)){return h(ke(bG))}for(var j=0;j<k.docs.length;++j){if("object"!=typeof k.docs[j]||Array.isArray(k.docs[j])){return h(ke(dJ))}}var g;return k.docs.forEach(function(l){l._attachments&&Object.keys(l._attachments).forEach(function(m){g=g||bS(m)})}),g?h(ke(dA,g)):("new_edits" in i||("new_edits" in k?i.new_edits=k.new_edits:i.new_edits=!0),i.new_edits||"http"===this.type()||k.docs.sort(aQ),bl(k.docs),this._bulkDocs(k,i,function(m,l){return m?h(m):(i.new_edits||(l=l.filter(function(n){return n.error})),void h(null,l))}))}),jL.prototype.registerDependentDatabase=ek("registerDependentDatabase",function(g,i){function h(k){return k.dependentDbs=k.dependentDbs||{},k.dependentDbs[g]?!1:(k.dependentDbs[g]=!0,k)}var j=new this.constructor(g,this.__opts);f2(this,"_local/_pouch_dependentDbs",h).then(function(){i(null,{db:j})})["catch"](i)}),jL.prototype.destroy=ek("destroy",function(k,i){function h(){j._destroy(k,function(l,m){return l?i(l):(j._destroyed=!0,j.emit("destroyed"),void i(null,m||{ok:!0}))})}"function"==typeof k&&(i=k,k={});var j=this,g="use_prefix" in j?j.use_prefix:!0;return"http"===j.type()?h():void j.get("_local/_pouch_dependentDbs",function(m,p){if(m){return 404!==m.status?i(m):h()}var n=p.dependentDbs,l=j.constructor,o=Object.keys(n).map(function(r){var q=g?r.replace(new RegExp("^"+l.prefix),""):r;return new l(q,j.__opts).destroy()});ca.all(o).then(h,i)})}),bu.prototype.execute=function(){var g;if(this.failed){for(;g=this.queue.shift();){g(this.failed)}}else{for(;g=this.queue.shift();){g()}}},bu.prototype.fail=function(g){this.failed=g,this.execute()},bu.prototype.ready=function(g){this.isReady=!0,this.db=g,this.execute()},bu.prototype.addTask=function(g){this.queue.push(g),this.failed&&this.execute()},cs(aD,jL),aD.debug=bY,aD.adapters={},aD.preferredAdapters=[],aD.prefix="_pouch_";var bs=new jS.EventEmitter;e1(aD),aD.parseAdapter=function(l,n){var i,g,h=l.match(/([a-z\-]*):\/\/(.*)/);if(h){if(l=/http(s?)/.test(h[1])?h[1]+"://"+h[2]:h[2],i=h[1],!aD.adapters[i].valid()){throw"Invalid adapter"}return{name:l,adapter:h[1]}}var m="idb" in aD.adapters&&"websql" in aD.adapters&&eE()&&localStorage["_pouch__websqldb_"+aD.prefix+l];if(n.adapter){g=n.adapter}else{if("undefined"!=typeof n&&n.db){g="leveldb"}else{for(var k=0;k<aD.preferredAdapters.length;++k){if(g=aD.preferredAdapters[k],g in aD.adapters){if(m&&"idb"===g){fJ("log",'PouchDB is downgrading "'+l+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.');continue}break}}}}i=aD.adapters[g];var j=i&&"use_prefix" in i?i.use_prefix:!0;return{name:j?aD.prefix+l:l,adapter:g}},aD.adapter=function(g,i,h){i.valid()&&(aD.adapters[g]=i,h&&aD.preferredAdapters.push(g))},aD.plugin=function(g){return"function"==typeof g?g(aD):Object.keys(g).forEach(function(h){aD.prototype[h]=g[h]}),aD},aD.defaults=function(h){function g(k,i,j){return this instanceof g?("function"!=typeof i&&"undefined"!=typeof i||(j=i,i={}),k&&"object"==typeof k&&(i=k,k=void 0),i=aI.extend({},h,i),void aD.call(this,k,i,j)):new g(k,i,j)}return cs(g,aD),g.preferredAdapters=aD.preferredAdapters.slice(),Object.keys(aD).forEach(function(i){i in g||(g[i]=aD[i])}),g};var eJ="5.4.4";aD.version=eJ;var dm,ck=bV(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),cS=bV(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]),aM=function(g){return atob(g)},b2=function(g){return btoa(g)},df=eK.setImmediate||eK.setTimeout,cM=32768,dG=5,cc="document-store",jX="by-sequence",cv="attach-store",cZ="attach-seq-store",eU="meta-store",az="local-store",aS="detect-blob-support",eA={running:!1,queue:[]},bL=new e7.Map,cX=new fF,dW=new e7.Map;eG.valid=function(){var g="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform);return !g&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange};var jK=7,c5=cg("document-store"),aW=cg("by-sequence"),aj=cg("attach-store"),bg=cg("local-store"),dB=cg("metadata-store"),cK=cg("attach-seq-store"),j4=new e7.Map,bX=new fF,aF=1,cR="CREATE INDEX IF NOT EXISTS 'by-seq-deleted-idx' ON "+aW+" (seq, deleted)",bN="CREATE UNIQUE INDEX IF NOT EXISTS 'by-seq-doc-id-rev' ON "+aW+" (doc_id, rev)",kb="CREATE INDEX IF NOT EXISTS 'doc-winningseq-idx' ON "+c5+" (winningseq)",bB="CREATE INDEX IF NOT EXISTS 'attach-seq-seq-idx' ON "+cK+" (seq)",bZ="CREATE UNIQUE INDEX IF NOT EXISTS 'attach-seq-digest-idx' ON "+cK+" (digest, seq)",cT=aW+".seq = "+c5+".winningseq",cQ=aW+".seq AS seq, "+aW+".deleted AS deleted, "+aW+".json AS data, "+aW+".rev AS rev, "+c5+".json AS metadata";jH.valid=kj,jH.use_prefix=!0;var aN=bk(),dL=function(){},dK=25,dz=50,fA={},b3=1800,bD=bY("pouchdb:http");f8.valid=function(){return !0},am.prototype.add=function(g){return this.promise=this.promise["catch"](function(){}).then(function(){return g()}),this.promise},am.prototype.finish=function(){return this.promise};var b7=function(h,g){return g&&h.then(function(i){eR.nextTick(function(){g(null,i)})},function(i){eR.nextTick(function(){g(i)})}),h},e3=function(g){return fG(function(h){var j=h.pop(),i=g.apply(this,h);return"function"==typeof j&&b7(i,j),i})},d3=function(h,g){return h.then(function(i){return g().then(function(){return i})},function(i){return g().then(function(){throw i})})},bT=function(h,g){return function(){var j=arguments,i=this;return h.add(function(){return g.apply(i,j)})}},cN=function(l){for(var j={},i=0,k=l.length;k>i;i++){j["$"+l[i]]=!0}var h=Object.keys(j),g=new Array(h.length);for(i=0,k=h.length;k>i;i++){g[i]=h[i].substring(1)}return g},d2={},j9=new am,db=50,aq=fJ.bind(null,"log"),eg={_sum:function(h,g){return cG(g)},_count:function(h,g){return g.length},_stats:function(g,i){function h(n){for(var l=0,k=0,m=n.length;m>k;k++){var j=n[k];l+=j*j}return l}return{sum:cG(i),min:Math.min.apply(null,i),max:Math.max.apply(null,i),count:i.length,sumsqr:h(i)}}},c7=e3(function(){var g=this;return"http"===g.type()?aJ(g):"function"==typeof g._viewCleanup?eC(g):by(g)}),d9=function(k,i,h){"function"==typeof i&&(h=i,i={}),i=i?aG(i):{},"function"==typeof k&&(k={map:k});var j=this,g=ca.resolve().then(function(){return fR(j,k,i)});return b7(g,h),g};cs(kc,Error),cs(bI,Error),cs(kl,Error);var cW={query:d9,viewCleanup:c7},dx=1,cB="pouchdb",aP=5,jZ=0;cV.prototype.writeCheckpoint=function(g,i){var h=this;return this.updateTarget(g,i).then(function(){return h.updateSource(g,i)})},cV.prototype.updateTarget=function(h,g){return eV(this.target,this.id,h,g,this.returnValue)},cV.prototype.updateSource=function(g,i){var h=this;return this.readOnlySource?ca.resolve(!0):eV(this.src,this.id,g,i,this.returnValue)["catch"](function(j){if(eD(j)){return h.readOnlySource=!0,!0}throw j})};var bp={undefined:function(h,g){return 0===cl.collate(h.last_seq,g.last_seq)?g.last_seq:0},1:function(h,g){return cb(g,h).last_seq}};cV.prototype.getCheckpoint=function(){var g=this;return g.target.get(g.id).then(function(h){return g.readOnlySource?ca.resolve(h.last_seq):g.src.get(g.id).then(function(i){if(h.version!==i.version){return jZ}var j;return j=h.version?h.version.toString():"undefined",j in bp?bp[j](h,i):jZ},function(i){if(404===i.status&&h.last_seq){return g.src.put({_id:g.id,last_seq:jZ}).then(function(){return jZ},function(j){return eD(j)?(g.readOnlySource=!0,h.last_seq):jZ})}throw i})})["catch"](function(h){if(404!==h.status){throw h}return jZ})};var ej=0;cs(eI,jS.EventEmitter),eI.prototype.cancel=function(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")},eI.prototype.ready=function(k,i){function h(){g.cancel()}function j(){k.removeListener("destroyed",h),i.removeListener("destroyed",h)}var g=this;g._readyCalled||(g._readyCalled=!0,k.once("destroyed",h),i.once("destroyed",h),g.once("complete",j))},cs(b1,jS.EventEmitter),b1.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())},aD.plugin(jP).plugin(fM).plugin(cE).plugin(cW).plugin(eB),d.exports=aD}).call(this,f(2),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{1:1,10:10,12:12,14:14,15:15,16:16,17:17,2:2,4:4,5:5,8:8,9:9}],4:[function(f,c,g){function d(e){return function(){var h=arguments.length;if(h){for(var j=[],i=-1;++i<h;){j[i]=arguments[i]}return e.call(this,j)}return e.call(this,[])}}c.exports=d},{}],5:[function(h,l,f){function c(){return"WebkitAppearance" in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function d(){var i=arguments,p=this.useColors;if(i[0]=(p?"%c":"")+this.namespace+(p?" %c":" ")+i[0]+(p?"%c ":" ")+"+"+f.humanize(this.diff),!p){return i}var e="color: "+this.color;i=[i[0],e,"color: inherit"].concat(Array.prototype.slice.call(i,1));var n=0,o=0;return i[0].replace(/%[a-z%]/g,function(q){"%%"!==q&&(n++,"%c"===q&&(o=n))}),i.splice(o,0,e),i}function g(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function j(e){try{null==e?f.storage.removeItem("debug"):f.storage.debug=e}catch(i){}}function m(){var e;try{e=f.storage.debug}catch(i){}return e}function k(){try{return window.localStorage}catch(e){}}f=l.exports=h(6),f.log=g,f.formatArgs=d,f.save=j,f.load=m,f.useColors=c,f.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:k(),f.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],f.formatters.j=function(e){return JSON.stringify(e)},f.enable(m())},{6:6}],6:[function(g,l,v){function p(){return v.colors[d++%v.colors.length]}function q(f){function n(){}function e(){var u=e,o=+new Date,x=o-(h||o);u.diff=x,u.prev=h,u.curr=o,h=o,null==u.useColors&&(u.useColors=v.useColors()),null==u.color&&u.useColors&&(u.color=p());var s=Array.prototype.slice.call(arguments);s[0]=v.coerce(s[0]),"string"!=typeof s[0]&&(s=["%o"].concat(s));var r=0;s[0]=s[0].replace(/%([a-z%])/g,function(D,B){if("%%"===D){return D}r++;var w=v.formatters[B];if("function"==typeof w){var C=s[r];D=w.call(u,C),s.splice(r,1),r--}return D}),"function"==typeof v.formatArgs&&(s=v.formatArgs.apply(u,s));var t=e.log||v.log||console.log.bind(console);t.apply(u,s)}n.enabled=!1,e.enabled=!0;var i=v.enabled(f)?e:n;return i.namespace=f,i}function c(e){v.save(e);for(var f=(e||"").split(/[\s,]+/),n=f.length,i=0;n>i;i++){f[i]&&(e=f[i].replace(/\*/g,".*?"),"-"===e[0]?v.skips.push(new RegExp("^"+e.substr(1)+"$")):v.names.push(new RegExp("^"+e+"$")))}}function j(){v.enable("")}function m(i){var e,f;for(e=0,f=v.skips.length;f>e;e++){if(v.skips[e].test(i)){return !1}}for(e=0,f=v.names.length;f>e;e++){if(v.names[e].test(i)){return !0}}return !1}function k(e){return e instanceof Error?e.stack||e.message:e}v=l.exports=q,v.coerce=k,v.disable=j,v.enable=c,v.enabled=m,v.humanize=g(11),v.names=[],v.skips=[],v.formatters={};var h,d=0},{11:11}],7:[function(f,d,c){(function(k){function e(){j=!0;for(var i,n,l=g.length;l;){for(n=g,g=[],i=-1;++i<l;){n[i]()}l=g.length}j=!1}function t(i){1!==g.push(i)||j||v()}var v,h=k.MutationObserver||k.WebKitMutationObserver;if(h){var m=0,q=new h(e),p=k.document.createTextNode("");q.observe(p,{characterData:!0}),v=function(){p.data=m=++m%2}}else{if(k.setImmediate||"undefined"==typeof k.MessageChannel){v="document" in k&&"onreadystatechange" in k.document.createElement("script")?function(){var i=k.document.createElement("script");i.onreadystatechange=function(){e(),i.onreadystatechange=null,i.parentNode.removeChild(i),i=null},k.document.documentElement.appendChild(i)}:function(){setTimeout(e,0)}}else{var w=new k.MessageChannel;w.port1.onmessage=e,v=function(){w.port2.postMessage(0)}}}var j,g=[];d.exports=t}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],8:[function(f,d,c){"function"==typeof Object.create?d.exports=function(g,e){g.super_=e,g.prototype=Object.create(e.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}})}:d.exports=function(g,e){g.super_=e;var h=function(){};h.prototype=e.prototype,g.prototype=new h,g.prototype.constructor=g}},{}],9:[function(f,d,c){(function(){var g=Array.prototype.slice,e=Array.prototype.forEach,h=function(i){if("object"!=typeof i){throw i+" is not an object"}var j=g.call(arguments,1);return e.call(j,function(k){if(k){for(var l in k){"object"==typeof k[l]&&i[l]?h.call(i,i[l],k[l]):i[l]=k[l]}}}),i};this.extend=h}).call(this)},{}],10:[function(A,k,w){function B(){}function j(e){if("function"!=typeof e){throw new TypeError("resolver must be a function")}this.state=F,this.queue=[],this.outcome=void 0,e!==B&&g(this,e)}function J(f,e,h){this.promise=f,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof h&&(this.onRejected=h,this.callRejected=this.otherCallRejected)}function H(f,e,h){E(function(){var i;try{i=e(h)}catch(l){return d.reject(f,l)}i===f?d.reject(f,new TypeError("Cannot resolve promise with itself")):d.resolve(f,i)})}function z(f){var e=f&&f.then;return f&&"object"==typeof f&&"function"==typeof e?function(){e.apply(f,arguments)}:void 0}function g(h,l){function f(o){e||(e=!0,d.reject(h,o))}function m(o){e||(e=!0,d.resolve(h,o))}function i(){l(m,f)}var e=!1,n=D(i);"error"===n.status&&f(n.value)}function D(e,h){var f={};try{f.value=e(h),f.status="success"}catch(i){f.status="error",f.value=i}return f}function x(e){return e instanceof this?e:d.resolve(new this(B),e)}function G(f){var e=new this(B);return d.reject(e,f)}function C(f){function h(r,s){function t(u){p[s]=u,++n!==i||m||(m=!0,d.resolve(o,p))}l.resolve(r).then(t,function(u){m||(m=!0,d.reject(o,u))})}var l=this;if("[object Array]"!==Object.prototype.toString.call(f)){return this.reject(new TypeError("must be an array"))}var i=f.length,m=!1;if(!i){return this.resolve([])}for(var p=new Array(i),n=0,e=-1,o=new this(B);++e<i;){h(f[e],e)}return o}function q(h){function l(o){f.resolve(o).then(function(p){e||(e=!0,d.resolve(m,p))},function(p){e||(e=!0,d.reject(m,p))})}var f=this;if("[object Array]"!==Object.prototype.toString.call(h)){return this.reject(new TypeError("must be an array"))}var i=h.length,e=!1;if(!i){return this.resolve([])}for(var n=-1,m=new this(B);++n<i;){l(h[n])}return m}var E=A(7),d={},c=["REJECTED"],I=["FULFILLED"],F=["PENDING"];k.exports=j,j.prototype["catch"]=function(e){return this.then(null,e)},j.prototype.then=function(i,h){if("function"!=typeof i&&this.state===I||"function"!=typeof h&&this.state===c){return this}var f=new this.constructor(B);if(this.state!==F){var e=this.state===I?i:h;H(f,e,this.outcome)}else{this.queue.push(new J(f,i,h))}return f},J.prototype.callFulfilled=function(e){d.resolve(this.promise,e)},J.prototype.otherCallFulfilled=function(e){H(this.promise,this.onFulfilled,e)},J.prototype.callRejected=function(e){d.reject(this.promise,e)},J.prototype.otherCallRejected=function(e){H(this.promise,this.onRejected,e)},d.resolve=function(m,f){var i=D(z,f);if("error"===i.status){return d.reject(m,i.value)}var l=i.value;if(l){g(m,l)}else{m.state=I,m.outcome=f;for(var h=-1,e=m.queue.length;++h<e;){m.queue[h].callFulfilled(f)}}return m},d.reject=function(e,h){e.state=c,e.outcome=h;for(var f=-1,i=e.queue.length;++f<i;){e.queue[f].callRejected(h)}return e},j.resolve=x,j.reject=G,j.all=C,j.race=q},{7:7}],11:[function(p,x,h){function d(i){if(i=""+i,!(i.length>10000)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(i);if(e){var l=parseFloat(e[1]),f=(e[2]||"ms").toLowerCase();switch(f){case"years":case"year":case"yrs":case"yr":case"y":return l*j;case"days":case"day":case"d":return l*m;case"hours":case"hour":case"hrs":case"hr":case"h":return l*q;case"minutes":case"minute":case"mins":case"min":case"m":return l*w;case"seconds":case"second":case"secs":case"sec":case"s":return l*c;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return l}}}}function g(e){return e>=m?Math.round(e/m)+"d":e>=q?Math.round(e/q)+"h":e>=w?Math.round(e/w)+"m":e>=c?Math.round(e/c)+"s":e+"ms"}function k(e){return v(e,m,"day")||v(e,q,"hour")||v(e,w,"minute")||v(e,c,"second")||e+" ms"}function v(f,e,i){return e>f?void 0:1.5*e>f?Math.floor(f/e)+" "+i:Math.ceil(f/e)+" "+i+"s"}var c=1000,w=60*c,q=60*w,m=24*q,j=365.25*m;x.exports=function(f,e){return e=e||{},"string"==typeof f?d(f):e["long"]?k(f):g(f)}},{}],12:[function(g,C,v){function k(e){if(null!==e){switch(typeof e){case"boolean":return e?1:0;case"number":return z(e);case"string":return e.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var l=Array.isArray(e),f=l?e:Object.keys(e),o=-1,i=f.length,h="";if(l){for(;++o<i;){h+=v.toIndexableString(f[o])}}else{for(;++o<i;){var n=f[o];h+=v.toIndexableString(n)+v.toIndexableString(e[n])}}return h}}return""}function q(e,l){var r,o=l,p="1"===e[l];if(p){r=0,l++}else{var s="0"===e[l];l++;var h="",n=e.substring(l,l+j),i=parseInt(n,10)+B;for(s&&(i=-i),l+=j;;){var f=e[l];if("\x00"===f){break}h+=f,l++}h=h.split("."),r=1===h.length?parseInt(h,10):parseFloat(h[0]+"."+h[1]),s&&(r-=10),0!==i&&(r=parseFloat(r+"e"+i))}return{num:r,length:l-o}}function d(f,o){var l=f.pop();if(o.length){var n=o[o.length-1];l===n.element&&(o.pop(),n=o[o.length-1]);var i=n.element,h=n.index;if(Array.isArray(i)){i.push(l)}else{if(h===f.length-2){var e=f.pop();i[e]=l}else{f.push(l)}}}}function c(f,l){for(var e=Math.min(f.length,l.length),h=0;e>h;h++){var i=v.collate(f[h],l[h]);if(0!==i){return i}}return f.length===l.length?0:f.length>l.length?1:-1}function x(f,e){return f===e?0:f>e?1:-1}function A(e,l){for(var f=Object.keys(e),o=Object.keys(l),i=Math.min(f.length,o.length),h=0;i>h;h++){var n=v.collate(f[h],o[h]);if(0!==n){return n}if(n=v.collate(e[f[h]],l[o[h]]),0!==n){return n}}return f.length===o.length?0:f.length>o.length?1:-1}function y(f){var e=["boolean","number","string","object"],h=e.indexOf(typeof f);return ~h?null===f?1:Array.isArray(f)?5:3>h?h+2:h+3:Array.isArray(f)?5:void 0}function z(r){if(0===r){return"1"}var h=r.toExponential().split(/e\+?/),o=parseInt(h[1],10),l=0>r,n=l?"0":"2",p=(l?-o:o)-B,e=m.padLeft(p.toString(),"0",j);n+=w+e;var i=Math.abs(parseFloat(h[0]));l&&(i=10-i);var f=i.toFixed(20);return f=f.replace(/\.?0+$/,""),n+=w+f}var B=-324,j=3,w="",m=g(13);v.collate=function(h,e){if(h===e){return 0}h=v.normalizeKey(h),e=v.normalizeKey(e);var f=y(h),i=y(e);if(f-i!==0){return f-i}if(null===h){return 0}switch(typeof h){case"number":return h-e;case"boolean":return h===e?0:e>h?-1:1;case"string":return x(h,e)}return Array.isArray(h)?c(h,e):A(h,e)},v.normalizeKey=function(l){switch(typeof l){case"undefined":return null;case"number":return l===1/0||l===-(1/0)||isNaN(l)?null:l;case"object":var h=l;if(Array.isArray(l)){var i=l.length;l=new Array(i);for(var e=0;i>e;e++){l[e]=v.normalizeKey(h[e])}}else{if(l instanceof Date){return l.toJSON()}if(null!==l){l={};for(var n in h){if(h.hasOwnProperty(n)){var f=h[n];"undefined"!=typeof f&&(l[n]=v.normalizeKey(f))}}}}}return l},v.toIndexableString=function(f){var e="\x00";return f=v.normalizeKey(f),y(f)+w+k(f)+e},v.parseIndexableString=function(e){for(var l=[],p=[],o=0;;){var h=e[o++];if("\x00"!==h){switch(h){case"1":l.push(null);break;case"2":l.push("1"===e[o]),o++;break;case"3":var n=q(e,o);l.push(n.num),o+=n.length;break;case"4":for(var i="";;){var f=e[o];if("\x00"===f){break}i+=f,o++}i=i.replace(/\u0001\u0001/g,"\x00").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),l.push(i);break;case"5":var s={element:[],index:l.length};l.push(s.element),p.push(s);break;case"6":var r={element:{},index:l.length};l.push(r.element),p.push(r);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+h)}}else{if(1===l.length){return l.pop()}d(l,p)}}}},{13:13}],13:[function(f,c,g){function d(k,i,h){for(var j="",e=h-k.length;j.length<e;){j+=i}return j}g.padLeft=function(h,e,j){var i=d(h,e,j);return i+h},g.padRight=function(h,e,j){var i=d(h,e,j);return h+i},g.stringLexCompare=function(j,h){var e,p=j.length,m=h.length;for(e=0;p>e;e++){if(e===m){return 1}var l=j.charAt(e),k=h.charAt(e);if(l!==k){return k>l?-1:1}}return m>p?-1:0},g.intToDecimalForm=function(i){var e=0>i,j="";do{var h=e?-Math.ceil(i%10):Math.floor(i%10);j=h+j,i=e?Math.ceil(i/10):Math.floor(i/10)}while(i);return e&&"0"!==j&&(j="-"+j),j}},{}],14:[function(d,h,g){function c(){this.store={}}function f(i){if(this.store=new c,i&&Array.isArray(i)){for(var e=0,j=i.length;j>e;e++){this.add(i[e])}}}g.Map=c,g.Set=f,c.prototype.mangle=function(e){if("string"!=typeof e){throw new TypeError("key must be a string but Got "+e)}return"$"+e},c.prototype.unmangle=function(e){return e.substring(1)},c.prototype.get=function(i){var e=this.mangle(i);return e in this.store?this.store[e]:void 0},c.prototype.set=function(i,e){var j=this.mangle(i);return this.store[j]=e,!0},c.prototype.has=function(i){var e=this.mangle(i);return e in this.store},c.prototype["delete"]=function(i){var e=this.mangle(i);return e in this.store?(delete this.store[e],!0):!1},c.prototype.forEach=function(e){for(var k=Object.keys(this.store),i=0,m=k.length;m>i;i++){var l=k[i],j=this.store[l];l=this.unmangle(l),e(j,l)}},f.prototype.add=function(e){return this.store.set(e,!0)},f.prototype.has=function(e){return this.store.has(e)},f.prototype["delete"]=function(e){return this.store["delete"](e)}},{}],15:[function(f,d,c){(function(){var e={}.hasOwnProperty,g=[].slice;d.exports=function(h,l){var k,j,m,i;j=[],i=[];for(k in l){e.call(l,k)&&(m=l[k],"this"!==k&&(j.push(k),i.push(m)))}return Function.apply(null,g.call(j).concat([h])).apply(l["this"],i)}}).call(this)},{}],16:[function(d,c,e){!function(g){if("object"==typeof e){c.exports=g()}else{if("function"==typeof b&&b.amd){b(g)}else{var h;try{h=window}catch(f){h=self}h.SparkMD5=g()}}}(function(F){function A(m,h,n,l,i,g){return h=B(B(h,m),B(l,g)),B(h<<i|h>>>32-i,n)}function G(m,h,l,i,g,o,n){return A(h&l|~h&i,m,h,g,o,n)}function H(m,h,l,i,g,o,n){return A(h&i|l&~i,m,h,g,o,n)}function E(m,h,l,i,g,o,n){return A(h^l^i,m,h,g,o,n)}function x(m,h,l,i,g,o,n){return A(l^(h|~i),m,h,g,o,n)}function M(m,h){var n=m[0],l=m[1],g=m[2],i=m[3];n=G(n,l,g,i,h[0],7,-680876936),i=G(i,n,l,g,h[1],12,-389564586),g=G(g,i,n,l,h[2],17,606105819),l=G(l,g,i,n,h[3],22,-1044525330),n=G(n,l,g,i,h[4],7,-176418897),i=G(i,n,l,g,h[5],12,1200080426),g=G(g,i,n,l,h[6],17,-1473231341),l=G(l,g,i,n,h[7],22,-45705983),n=G(n,l,g,i,h[8],7,1770035416),i=G(i,n,l,g,h[9],12,-1958414417),g=G(g,i,n,l,h[10],17,-42063),l=G(l,g,i,n,h[11],22,-1990404162),n=G(n,l,g,i,h[12],7,1804603682),i=G(i,n,l,g,h[13],12,-40341101),g=G(g,i,n,l,h[14],17,-1502002290),l=G(l,g,i,n,h[15],22,1236535329),n=H(n,l,g,i,h[1],5,-165796510),i=H(i,n,l,g,h[6],9,-1069501632),g=H(g,i,n,l,h[11],14,643717713),l=H(l,g,i,n,h[0],20,-373897302),n=H(n,l,g,i,h[5],5,-701558691),i=H(i,n,l,g,h[10],9,38016083),g=H(g,i,n,l,h[15],14,-660478335),l=H(l,g,i,n,h[4],20,-405537848),n=H(n,l,g,i,h[9],5,568446438),i=H(i,n,l,g,h[14],9,-1019803690),g=H(g,i,n,l,h[3],14,-187363961),l=H(l,g,i,n,h[8],20,1163531501),n=H(n,l,g,i,h[13],5,-1444681467),i=H(i,n,l,g,h[2],9,-51403784),g=H(g,i,n,l,h[7],14,1735328473),l=H(l,g,i,n,h[12],20,-1926607734),n=E(n,l,g,i,h[5],4,-378558),i=E(i,n,l,g,h[8],11,-2022574463),g=E(g,i,n,l,h[11],16,1839030562),l=E(l,g,i,n,h[14],23,-35309556),n=E(n,l,g,i,h[1],4,-1530992060),i=E(i,n,l,g,h[4],11,1272893353),g=E(g,i,n,l,h[7],16,-155497632),l=E(l,g,i,n,h[10],23,-1094730640),n=E(n,l,g,i,h[13],4,681279174),i=E(i,n,l,g,h[0],11,-358537222),g=E(g,i,n,l,h[3],16,-722521979),l=E(l,g,i,n,h[6],23,76029189),n=E(n,l,g,i,h[9],4,-640364487),i=E(i,n,l,g,h[12],11,-421815835),g=E(g,i,n,l,h[15],16,530742520),l=E(l,g,i,n,h[2],23,-995338651),n=x(n,l,g,i,h[0],6,-198630844),i=x(i,n,l,g,h[7],10,1126891415),g=x(g,i,n,l,h[14],15,-1416354905),l=x(l,g,i,n,h[5],21,-57434055),n=x(n,l,g,i,h[12],6,1700485571),i=x(i,n,l,g,h[3],10,-1894986606),g=x(g,i,n,l,h[10],15,-1051523),l=x(l,g,i,n,h[1],21,-2054922799),n=x(n,l,g,i,h[8],6,1873313359),i=x(i,n,l,g,h[15],10,-30611744),g=x(g,i,n,l,h[6],15,-1560198380),l=x(l,g,i,n,h[13],21,1309151649),n=x(n,l,g,i,h[4],6,-145523070),i=x(i,n,l,g,h[11],10,-1120210379),g=x(g,i,n,l,h[2],15,718787259),l=x(l,g,i,n,h[9],21,-343485551),m[0]=B(n,m[0]),m[1]=B(l,m[1]),m[2]=B(g,m[2]),m[3]=B(i,m[3])}function C(i){var h,g=[];for(h=0;64>h;h+=4){g[h>>2]=i.charCodeAt(h)+(i.charCodeAt(h+1)<<8)+(i.charCodeAt(h+2)<<16)+(i.charCodeAt(h+3)<<24)}return g}function w(i){var h,g=[];for(h=0;64>h;h+=4){g[h>>2]=i[h]+(i[h+1]<<8)+(i[h+2]<<16)+(i[h+3]<<24)}return g}function J(g){var m,i,h,n,p,o,l=g.length,r=[1732584193,-271733879,-1732584194,271733878];for(m=64;l>=m;m+=64){M(r,C(g.substring(m-64,m)))}for(g=g.substring(m-64),i=g.length,h=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],m=0;i>m;m+=1){h[m>>2]|=g.charCodeAt(m)<<(m%4<<3)}if(h[m>>2]|=128<<(m%4<<3),m>55){for(M(r,h),m=0;16>m;m+=1){h[m]=0}}return n=8*l,n=n.toString(16).match(/(.*?)(.{0,8})$/),p=parseInt(n[2],16),o=parseInt(n[1],16)||0,h[14]=p,h[15]=o,M(r,h),r}function D(g){var o,i,h,n,p,m,l=g.length,r=[1732584193,-271733879,-1732584194,271733878];for(o=64;l>=o;o+=64){M(r,w(g.subarray(o-64,o)))}for(g=l>o-64?g.subarray(o-64):new Uint8Array(0),i=g.length,h=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],o=0;i>o;o+=1){h[o>>2]|=g[o]<<(o%4<<3)}if(h[o>>2]|=128<<(o%4<<3),o>55){for(M(r,h),o=0;16>o;o+=1){h[o]=0}}return n=8*l,n=n.toString(16).match(/(.*?)(.{0,8})$/),p=parseInt(n[2],16),m=parseInt(n[1],16)||0,h[14]=p,h[15]=m,M(r,h),r}function q(i){var h,g="";for(h=0;4>h;h+=1){g+=L[i>>8*h+4&15]+L[i>>8*h&15]}return g}function I(h){var g;for(g=0;g<h.length;g+=1){h[g]=q(h[g])}return h.join("")}function z(g){return/[\u0080-\uFFFF]/.test(g)&&(g=unescape(encodeURIComponent(g))),g}function k(m,h){var n,l=m.length,i=new ArrayBuffer(l),g=new Uint8Array(i);for(n=0;l>n;n+=1){g[n]=m.charCodeAt(n)}return h?g:i}function j(g){return String.fromCharCode.apply(null,new Uint8Array(g))}function f(l,g,h){var i=new Uint8Array(l.byteLength+g.byteLength);return i.set(new Uint8Array(l)),i.set(new Uint8Array(g),l.byteLength),h?i:i.buffer}function N(l){var g,h=[],i=l.length;for(g=0;i-1>g;g+=2){h.push(parseInt(l.substr(g,2),16))}return String.fromCharCode.apply(String,h)}function K(){this.reset()}var B=function(h,g){return h+g&4294967295},L=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return"5d41402abc4b2a76b9719d911017c592"!==I(J("hello"))&&(B=function(l,g){var h=(65535&l)+(65535&g),i=(l>>16)+(g>>16)+(h>>16);return i<<16|65535&h}),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||!function(){function g(i,h){return i=0|i||0,0>i?Math.max(i+h,0):Math.min(i,h)}ArrayBuffer.prototype.slice=function(h,r){var o,n,m,l,p=this.byteLength,i=g(h,p),s=p;return r!==F&&(s=g(r,p)),i>s?new ArrayBuffer(0):(o=s-i,n=new ArrayBuffer(o),m=new Uint8Array(n),l=new Uint8Array(this,i,o),m.set(l),n)}}(),K.prototype.append=function(g){return this.appendBinary(z(g)),this},K.prototype.appendBinary=function(i){this._buff+=i,this._length+=i.length;var h,g=this._buff.length;for(h=64;g>=h;h+=64){M(this._hash,C(this._buff.substring(h-64,h)))}return this._buff=this._buff.substring(h-64),this},K.prototype.end=function(m){var h,n,l=this._buff,i=l.length,g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(h=0;i>h;h+=1){g[h>>2]|=l.charCodeAt(h)<<(h%4<<3)}return this._finish(g,i),n=I(this._hash),m&&(n=N(n)),this.reset(),n},K.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},K.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},K.prototype.setState=function(g){return this._buff=g.buff,this._length=g.length,this._hash=g.hash,this},K.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},K.prototype._finish=function(m,h){var n,l,i,g=h;if(m[g>>2]|=128<<(g%4<<3),g>55){for(M(this._hash,m),g=0;16>g;g+=1){m[g]=0}}n=8*this._length,n=n.toString(16).match(/(.*?)(.{0,8})$/),l=parseInt(n[2],16),i=parseInt(n[1],16)||0,m[14]=l,m[15]=i,M(this._hash,m)},K.hash=function(h,g){return K.hashBinary(z(h),g)},K.hashBinary=function(l,g){var h=J(l),i=I(h);return g?N(i):i},K.ArrayBuffer=function(){this.reset()},K.ArrayBuffer.prototype.append=function(l){var g,h=f(this._buff.buffer,l,!0),i=h.length;for(this._length+=l.byteLength,g=64;i>=g;g+=64){M(this._hash,w(h.subarray(g-64,g)))}return this._buff=i>g-64?new Uint8Array(h.buffer.slice(g-64)):new Uint8Array(0),this},K.ArrayBuffer.prototype.end=function(m){var h,n,l=this._buff,i=l.length,g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(h=0;i>h;h+=1){g[h>>2]|=l[h]<<(h%4<<3)}return this._finish(g,i),n=I(this._hash),m&&(n=N(n)),this.reset(),n},K.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},K.ArrayBuffer.prototype.getState=function(){var g=K.prototype.getState.call(this);return g.buff=j(g.buff),g},K.ArrayBuffer.prototype.setState=function(g){return g.buff=k(g.buff,!0),K.prototype.setState.call(this,g)},K.ArrayBuffer.prototype.destroy=K.prototype.destroy,K.ArrayBuffer.prototype._finish=K.prototype._finish,K.ArrayBuffer.hash=function(l,g){var h=D(new Uint8Array(l)),i=I(h);return g?N(i):i},K})},{}],17:[function(f,c,g){function d(j,h,e){var p=e[e.length-1];j===p.element&&(e.pop(),p=e[e.length-1]);var m=p.element,l=p.index;if(Array.isArray(m)){m.push(j)}else{if(l===h.length-2){var k=h.pop();m[k]=j}else{h.push(j)}}}g.stringify=function(j){var q=[];q.push({obj:j});for(var z,x,v,m,B,w,h,e,A,k,p,y="";z=q.pop();){if(x=z.obj,v=z.prefix||"",m=z.val||"",y+=v,m){y+=m}else{if("object"!=typeof x){y+="undefined"==typeof x?null:JSON.stringify(x)}else{if(null===x){y+="null"}else{if(Array.isArray(x)){for(q.push({val:"]"}),B=x.length-1;B>=0;B--){w=0===B?"":",",q.push({obj:x[B],prefix:w})}q.push({val:"["})}else{h=[];for(e in x){x.hasOwnProperty(e)&&h.push(e)}for(q.push({val:"}"}),B=h.length-1;B>=0;B--){A=h[B],k=x[A],p=B>0?",":"",p+=JSON.stringify(A)+":",q.push({obj:k,prefix:p})}q.push({val:"{"})}}}}}return y},g.parse=function(h){for(var p,x,j,q,z,r,e,y,w,m=[],k=[],v=0;;){if(p=h[v++],"}"!==p&&"]"!==p&&"undefined"!=typeof p){switch(p){case" ":case"	":case"\n":case":":case",":break;case"n":v+=3,d(null,m,k);break;case"t":v+=3,d(!0,m,k);break;case"f":v+=4,d(!1,m,k);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(x="",v--;;){if(j=h[v++],!/[\d\.\-e\+]/.test(j)){v--;break}x+=j}d(parseFloat(x),m,k);break;case'"':for(q="",z=void 0,r=0;;){if(e=h[v++],'"'===e&&("\\"!==z||r%2!==1)){break}q+=e,z=e,"\\"===z?r++:r=0}d(JSON.parse('"'+q+'"'),m,k);break;case"[":y={element:[],index:m.length},m.push(y.element),k.push(y);break;case"{":w={element:{},index:m.length},m.push(w.element),k.push(w);break;default:throw new Error("unexpectedly reached end of input: "+p)}}else{if(1===m.length){return m.pop()}d(m.pop(),m,k)}}}},{}]},{},[3])(3)});